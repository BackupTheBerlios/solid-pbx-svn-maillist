<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [solid-pbx-svn] r181 - in trunk: . apps build_tools cdr channels channels/misdn codecs codecs/gsm configs doc funcs include include/asterisk pbx res utils
   </TITLE>
   <LINK REL="Index" HREF="http://lists.berlios.de/pipermail/solid-pbx-svn/2006-May/index.html" >
   <LINK REL="made" HREF="mailto:solid-pbx-svn%40lists.berlios.de?Subject=Re%3A%20%5Bsolid-pbx-svn%5D%20r181%20-%20in%20trunk%3A%20.%20apps%20build_tools%20cdr%20channels%20channels/misdn%20codecs%20codecs/gsm%20configs%20doc%20funcs%20include%20include/asterisk%20pbx%20res%20utils&In-Reply-To=%3C200605262112.k4QLCsll029043%40sheep.berlios.de%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="000175.html">
   <LINK REL="Next"  HREF="000177.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[solid-pbx-svn] r181 - in trunk: . apps build_tools cdr channels channels/misdn codecs codecs/gsm configs doc funcs include include/asterisk pbx res utils</H1>
    <B>solid-pbx-svn-admin at lists.berlios.de</B> 
    <A HREF="mailto:solid-pbx-svn%40lists.berlios.de?Subject=Re%3A%20%5Bsolid-pbx-svn%5D%20r181%20-%20in%20trunk%3A%20.%20apps%20build_tools%20cdr%20channels%20channels/misdn%20codecs%20codecs/gsm%20configs%20doc%20funcs%20include%20include/asterisk%20pbx%20res%20utils&In-Reply-To=%3C200605262112.k4QLCsll029043%40sheep.berlios.de%3E"
       TITLE="[solid-pbx-svn] r181 - in trunk: . apps build_tools cdr channels channels/misdn codecs codecs/gsm configs doc funcs include include/asterisk pbx res utils">solid-pbx-svn-admin at lists.berlios.de
       </A><BR>
    <I>Fri May 26 23:12:54 CEST 2006</I>
    <P><UL>
        <LI>Previous message: <A HREF="000175.html">[solid-pbx-svn] r180 - in trunk: . apps channels pbx
</A></li>
        <LI>Next message: <A HREF="000177.html">[solid-pbx-svn] r182 - in trunk: cdr channels configs contrib doc include/asterisk res
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#176">[ date ]</a>
              <a href="thread.html#176">[ thread ]</a>
              <a href="subject.html#176">[ subject ]</a>
              <a href="author.html#176">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Author: casper2
Date: 2006-05-26 23:12:24 +0200 (Fri, 26 May 2006)
New Revision: 181

Modified:
   trunk/CREDITS
   trunk/Makefile
   trunk/UPGRADE.txt
   trunk/acinclude.m4
   trunk/aclocal.m4
   trunk/app.c
   trunk/apps/app_db.c
   trunk/apps/app_dial.c
   trunk/apps/app_directed_pickup.c
   trunk/apps/app_echo.c
   trunk/apps/app_lookupblacklist.c
   trunk/apps/app_lookupcidname.c
   trunk/apps/app_meetme.c
   trunk/apps/app_queue.c
   trunk/apps/app_record.c
   trunk/apps/app_rpt.c
   trunk/apps/app_setcdruserfield.c
   trunk/apps/app_settransfercapability.c
   trunk/apps/app_sms.c
   trunk/apps/app_speech_utils.c
   trunk/apps/app_userevent.c
   trunk/asterisk.c
   trunk/build_tools/cflags.xml
   trunk/build_tools/menuselect-deps.in
   trunk/cdr/Makefile
   trunk/cdr/cdr_pgsql.c
   trunk/channels/Makefile
   trunk/channels/chan_iax2.c
   trunk/channels/chan_local.c
   trunk/channels/chan_misdn.c
   trunk/channels/chan_sip.c
   trunk/channels/chan_zap.c
   trunk/channels/misdn/chan_misdn_config.h
   trunk/channels/misdn/isdn_lib.c
   trunk/channels/misdn/isdn_lib.h
   trunk/channels/misdn/isdn_msg_parser.c
   trunk/channels/misdn_config.c
   trunk/codecs/codec_a_mu.c
   trunk/codecs/codec_adpcm.c
   trunk/codecs/codec_alaw.c
   trunk/codecs/codec_ulaw.c
   trunk/codecs/gsm/Makefile
   trunk/configs/cdr.conf.sample
   trunk/configs/extensions.conf.sample
   trunk/configs/features.conf.sample
   trunk/configs/func_odbc.conf.sample
   trunk/configs/misdn.conf.sample
   trunk/configs/sip.conf.sample
   trunk/configure
   trunk/configure.ac
   trunk/doc/cdrdriver.txt
   trunk/doc/channelvariables.txt
   trunk/funcs/func_channel.c
   trunk/funcs/func_db.c
   trunk/funcs/func_odbc.c
   trunk/funcs/func_realtime.c
   trunk/include/asterisk/app.h
   trunk/include/asterisk/channel.h
   trunk/include/asterisk/devicestate.h
   trunk/include/asterisk/linkedlists.h
   trunk/include/asterisk/lock.h
   trunk/include/autoconfig.h.in
   trunk/logger.c
   trunk/makeopts.in
   trunk/manager.c
   trunk/pbx.c
   trunk/pbx/Makefile
   trunk/pbx/pbx_spool.c
   trunk/res/Makefile
   trunk/res/res_agi.c
   trunk/res/res_features.c
   trunk/sample.call
   trunk/utils/Makefile
   trunk/utils/ael_main.c
Log:
Update to Asterisk SVN trunk r30388

------------------------------------------------------------------------
r28894 | russell | 2006-05-20 02:36:18 +0200 (Sat, 20 May 2006) | 5 lines

defaults.h must be listed as a dependency after the cleantest because if it
forces a make clean, it has to be regenerated.  This fixes the problem that
people have been seeing where the build would fail complaining about defaults.h
not being present.

------------------------------------------------------------------------
r28895 | russell | 2006-05-20 02:41:36 +0200 (Sat, 20 May 2006) | 3 lines

fix the build of func_realtime and aelparse with MTX_PROFILE enabled
(issue #7187, #7188, casper)

------------------------------------------------------------------------
r28897 | russell | 2006-05-20 02:57:04 +0200 (Sat, 20 May 2006) | 3 lines

if a hostname is not specified, connect over a unix socket instead of
connecting to localhost (issue #7145, Mithraen)

------------------------------------------------------------------------
r28903 | kpfleming | 2006-05-20 03:01:20 +0200 (Sat, 20 May 2006) | 10 lines

Merged revisions 28896 via svnmerge from 
<A HREF="https://origsvn.digium.com/svn/asterisk/branches/1.2">https://origsvn.digium.com/svn/asterisk/branches/1.2</A>

.......
r28896 | kpfleming | 2006-05-19 19:55:31 -0500 (Fri, 19 May 2006) | 2 lines

don't try to predict where the compiler will place things on the stack... put them in the right place explicitly (issues #7029 and #7100, maybe others)

.......

------------------------------------------------------------------------
r28934 | russell | 2006-05-20 03:28:14 +0200 (Sat, 20 May 2006) | 3 lines

fix up another place where the code made assumptions about how space for
variables would be allocatted on the stack

------------------------------------------------------------------------
r28935 | russell | 2006-05-20 03:29:08 +0200 (Sat, 20 May 2006) | 2 lines

various fixes regarding coding guidelines issues

------------------------------------------------------------------------
r28936 | russell | 2006-05-20 03:35:12 +0200 (Sat, 20 May 2006) | 3 lines

remove an unused variable, and default the user to asterisk if not specified
in the config file (issue #7153, Mithraen)

------------------------------------------------------------------------
r28967 | russell | 2006-05-20 04:32:54 +0200 (Sat, 20 May 2006) | 1 line


------------------------------------------------------------------------
r28970 | kpfleming | 2006-05-20 04:51:53 +0200 (Sat, 20 May 2006) | 10 lines

Merged revisions 28968 via svnmerge from 
<A HREF="https://origsvn.digium.com/svn/asterisk/branches/1.2">https://origsvn.digium.com/svn/asterisk/branches/1.2</A>

.......
r28968 | kpfleming | 2006-05-19 21:35:53 -0500 (Fri, 19 May 2006) | 2 lines

don't allow queue member devices to ring longer than the total queue timeout (issue #6423, reported and patched by bcnit)

.......

------------------------------------------------------------------------
r29017 | russell | 2006-05-20 15:29:22 +0200 (Sat, 20 May 2006) | 6 lines

- add a UserEvent action that allows a manager client to &quot;broadcast&quot; an event
  to all connected manager clients
- update the UserEvent application to use the application argument parsing
  macros and to allow headers to be specified as pipe delimeted arguments
  (issue #5324, original patch by outtolunc, committed patch by Corydon)

------------------------------------------------------------------------
r29018 | russell | 2006-05-20 15:37:11 +0200 (Sat, 20 May 2006) | 3 lines

add some code optimizations, see the report for an explanation 
(issue #7105, Mithraen)

------------------------------------------------------------------------
r29053 | russell | 2006-05-20 21:54:14 +0200 (Sat, 20 May 2006) | 3 lines

fix the possibility of writing one byte past the end of a buffer.
(issue #7189, Mithraen)

------------------------------------------------------------------------
r29094 | russell | 2006-05-21 00:30:05 +0200 (Sun, 21 May 2006) | 5 lines

Add support for logging CDR recrods to a radius server (issue #6639, phsultan)
 - with contributions from miconda, jcollie, and sb
 - branch maintained by oej
Thanks everyone!

------------------------------------------------------------------------
r29095 | russell | 2006-05-21 00:37:18 +0200 (Sun, 21 May 2006) | 2 lines

remove unused variable

------------------------------------------------------------------------
r29129 | rizzo | 2006-05-21 11:56:38 +0200 (Sun, 21 May 2006) | 4 lines

remove an unused variable, and while at it
add some very minor optimizations.


------------------------------------------------------------------------
r29164 | russell | 2006-05-21 16:06:37 +0200 (Sun, 21 May 2006) | 2 lines

remove a CLI command that has been marked deprecated since before Asterisk 1.0

------------------------------------------------------------------------
r29195 | russell | 2006-05-21 17:13:19 +0200 (Sun, 21 May 2006) | 2 lines

put a bunch of defines in enums, and convert comments to doxygen format

------------------------------------------------------------------------
r29197 | bweschke | 2006-05-21 17:25:31 +0200 (Sun, 21 May 2006) | 11 lines

Merged revisions 29196 via svnmerge from 
<A HREF="https://origsvn.digium.com/svn/asterisk/branches/1.2">https://origsvn.digium.com/svn/asterisk/branches/1.2</A>

.......
r29196 | bweschke | 2006-05-21 10:16:59 -0500 (Sun, 21 May 2006) | 3 lines

 When an application that is executed via applicationmap and exits non-zero, make sure that we pass through the correct return value from the application to make sure a segfault doesn't occur by a bridge trying to continue when it should not. Also, when executing applications via applicationmap, make sure that the application is executed against the channel whose DTMF caused it to be fired off in the first place. (part 1/2 of #7090 - this is the only fix that will be applied to both 1.2 and /trunk) acunningham and blitzrage on testing...


.......

------------------------------------------------------------------------
r29234 | rizzo | 2006-05-22 01:54:28 +0200 (Mon, 22 May 2006) | 4 lines

strcmp() is the right function to use here, not strncmp().
On passing simplify an ast_cli message nearby.


------------------------------------------------------------------------
r29264 | rizzo | 2006-05-22 02:07:48 +0200 (Mon, 22 May 2006) | 5 lines

simplify logic in realtime_peer(), removing an unnecessary
initialization, an extra variable (newpeername) and a 
variable newpeername, and an 'else' branch.


------------------------------------------------------------------------
r29265 | rizzo | 2006-05-22 02:17:46 +0200 (Mon, 22 May 2006) | 3 lines

simplify logic in function create_addr()


------------------------------------------------------------------------
r29266 | rizzo | 2006-05-22 02:29:12 +0200 (Mon, 22 May 2006) | 3 lines

minor logic simplification in get_sip_pvt_byid_locked()


------------------------------------------------------------------------
r29267 | rizzo | 2006-05-22 02:32:36 +0200 (Mon, 22 May 2006) | 3 lines

src is const in parse_copy()


------------------------------------------------------------------------
r29268 | rizzo | 2006-05-22 02:46:04 +0200 (Mon, 22 May 2006) | 3 lines

annotate const parameters of copy_header()


------------------------------------------------------------------------
r29298 | rizzo | 2006-05-22 03:08:41 +0200 (Mon, 22 May 2006) | 4 lines

use a more compact method to trim the trailing ;... from SIP lines.
These are just the first two instances, there are many more to replace.


------------------------------------------------------------------------
r29299 | rizzo | 2006-05-22 03:27:52 +0200 (Mon, 22 May 2006) | 6 lines

use strsep() to trim away ;xxx from SIP messages.
Note that in a couple of places the code overwrites the string
in the buffer - mark the two places with XXX but do not fix the
bug yet.


------------------------------------------------------------------------
r29315 | rizzo | 2006-05-22 04:02:57 +0200 (Mon, 22 May 2006) | 3 lines

simplify register_peer_exten() removing some duplicated code.


------------------------------------------------------------------------
r29328 | rizzo | 2006-05-22 04:16:04 +0200 (Mon, 22 May 2006) | 3 lines

fix indentation to make a table more readable


------------------------------------------------------------------------
r29329 | rizzo | 2006-05-22 04:17:52 +0200 (Mon, 22 May 2006) | 3 lines

mark const the source of copy_request


------------------------------------------------------------------------
r29330 | rizzo | 2006-05-22 04:19:14 +0200 (Mon, 22 May 2006) | 3 lines

mark const the 'header' argument of gettag


------------------------------------------------------------------------
r29331 | rizzo | 2006-05-22 04:22:39 +0200 (Mon, 22 May 2006) | 3 lines

the msg argument of the various transmi_response*() functions is const.


------------------------------------------------------------------------
r29332 | rizzo | 2006-05-22 04:27:33 +0200 (Mon, 22 May 2006) | 5 lines

various constification of function arguments to prevent erroneous
usage and to ease understanding of the function themselves.



------------------------------------------------------------------------
r29333 | rizzo | 2006-05-22 04:31:58 +0200 (Mon, 22 May 2006) | 3 lines

more constifications


------------------------------------------------------------------------
r29334 | rizzo | 2006-05-22 04:43:24 +0200 (Mon, 22 May 2006) | 4 lines

use the functional form of time(), and mark XXX a couple of places
with dubious assignments.


------------------------------------------------------------------------
r29335 | rizzo | 2006-05-22 04:51:04 +0200 (Mon, 22 May 2006) | 3 lines

use functional form of time()


------------------------------------------------------------------------
r29363 | rizzo | 2006-05-22 05:16:38 +0200 (Mon, 22 May 2006) | 3 lines

remove code duplication generating some ast_verbose messages .


------------------------------------------------------------------------
r29364 | tilghman | 2006-05-22 05:40:31 +0200 (Mon, 22 May 2006) | 2 lines

Escaping commas within fields isn't always desireable.

------------------------------------------------------------------------
r29395 | tilghman | 2006-05-22 16:39:10 +0200 (Mon, 22 May 2006) | 9 lines

Blocked revisions 29394 via svnmerge

.......
r29394 | tilghman | 2006-05-22 09:34:34 -0500 (Mon, 22 May 2006) | 2 lines

Bug 7196 - month range did not work

.......

------------------------------------------------------------------------
r29407 | tilghman | 2006-05-22 17:01:36 +0200 (Mon, 22 May 2006) | 10 lines

Merged revisions 29398 via svnmerge from 
<A HREF="https://origsvn.digium.com/svn/asterisk/branches/1.2">https://origsvn.digium.com/svn/asterisk/branches/1.2</A>

.......
r29398 | tilghman | 2006-05-22 09:59:59 -0500 (Mon, 22 May 2006) | 2 lines

Bug 7194 - spelling fix

.......

------------------------------------------------------------------------
r29411 | crichter | 2006-05-22 17:02:03 +0200 (Mon, 22 May 2006) | 1 line

added callcounters for incoming and outgoing calls
------------------------------------------------------------------------
r29434 | bweschke | 2006-05-22 17:28:28 +0200 (Mon, 22 May 2006) | 3 lines

 Add UniqueID to the leave manager event.


------------------------------------------------------------------------
r29435 | file | 2006-05-22 17:48:22 +0200 (Mon, 22 May 2006) | 2 lines

don't stop recording until hangup (no terminator) (issue #7168 reported by julien23)

------------------------------------------------------------------------
r29463 | file | 2006-05-22 18:08:23 +0200 (Mon, 22 May 2006) | 2 lines

Add PICKUPMARK support to app_directed_pickup (issue #7104 reported by thaeger)

------------------------------------------------------------------------
r29465 | russell | 2006-05-22 18:34:45 +0200 (Mon, 22 May 2006) | 2 lines

add DEBUG_CHANNEL_LOCKS to menuselect

------------------------------------------------------------------------
r29466 | file | 2006-05-22 18:36:13 +0200 (Mon, 22 May 2006) | 10 lines

Merged revisions 29464 via svnmerge from 
<A HREF="https://origsvn.digium.com/svn/asterisk/branches/1.2">https://origsvn.digium.com/svn/asterisk/branches/1.2</A>

.......
r29464 | file | 2006-05-22 13:33:03 -0300 (Mon, 22 May 2006) | 2 lines

Preserve presentation bit when going through chan_local (issue #7002 reported by acunningham)

.......

------------------------------------------------------------------------
r29467 | bweschke | 2006-05-22 18:43:43 +0200 (Mon, 22 May 2006) | 3 lines

 This is part 2/2 of the patches for #7090. Adds one-step call parking to /trunk via builtin functions and 'k' 'K' application options added to app_dial. This also resolves #6340.


------------------------------------------------------------------------
r29514 | file | 2006-05-22 22:19:00 +0200 (Mon, 22 May 2006) | 10 lines

Merged revisions 29512 via svnmerge from 
<A HREF="https://origsvn.digium.com/svn/asterisk/branches/1.2">https://origsvn.digium.com/svn/asterisk/branches/1.2</A>

.......
r29512 | file | 2006-05-22 17:15:04 -0300 (Mon, 22 May 2006) | 2 lines

Use the correct language when playing the transfer sound (issue #7109 reported by casper)

.......

------------------------------------------------------------------------
r29553 | mogorman | 2006-05-22 23:12:30 +0200 (Mon, 22 May 2006) | 1 line

asterisk-xmpp merge in
------------------------------------------------------------------------
r29554 | kpfleming | 2006-05-22 23:20:01 +0200 (Mon, 22 May 2006) | 2 lines

bootstrap updates to include xmpp related stuff

------------------------------------------------------------------------
r29556 | file | 2006-05-22 23:28:32 +0200 (Mon, 22 May 2006) | 10 lines

Merged revisions 29555 via svnmerge from 
<A HREF="https://origsvn.digium.com/svn/asterisk/branches/1.2">https://origsvn.digium.com/svn/asterisk/branches/1.2</A>

.......
r29555 | file | 2006-05-22 18:27:12 -0300 (Mon, 22 May 2006) | 2 lines

Increase the silence threshold to 128 to &quot;fix&quot; it, so I'm told. (issue #6595 reported by davetroy fixed by casper)

.......

------------------------------------------------------------------------
r29570 | kpfleming | 2006-05-23 00:02:38 +0200 (Tue, 23 May 2006) | 2 lines

remove properties from the xmpp merge

------------------------------------------------------------------------
r29592 | mogorman | 2006-05-23 00:51:56 +0200 (Tue, 23 May 2006) | 3 lines

patch from bug 0007204 to make bug 5750 follow standard
manager naming convention.

------------------------------------------------------------------------
r29619 | markster | 2006-05-23 06:49:31 +0200 (Tue, 23 May 2006) | 2 lines

Handle ringing (early) state properly on SIP

------------------------------------------------------------------------
r29641 | oej | 2006-05-23 13:15:57 +0200 (Tue, 23 May 2006) | 2 lines

Formatting, typos

------------------------------------------------------------------------
r29665 | oej | 2006-05-23 14:14:35 +0200 (Tue, 23 May 2006) | 2 lines

Code formatting

------------------------------------------------------------------------
r29667 | crichter | 2006-05-23 14:38:06 +0200 (Tue, 23 May 2006) | 10 lines

* export_ies uses now _VAR else the vars are not copied to the dest chan
* when receiving a connect from the NT Side we wait until we have the final
  l3id until we queue the answer to asterisk to avoid bridging conflicts
* when not bridged to misdn we had a segfault after receiving the connect 
  due to a strcasecmp bug.. this didn't happen before, cause we hadn't had
  the bridge before
* cleanup of the bchannels is queued now, due to possible race conditions
* added mISDN_clear_stack when cleaning the bchannel


------------------------------------------------------------------------
r29668 | oej | 2006-05-23 14:39:48 +0200 (Tue, 23 May 2006) | 2 lines

Breaking once will stop us... :-)

------------------------------------------------------------------------
r29703 | russell | 2006-05-23 18:25:37 +0200 (Tue, 23 May 2006) | 2 lines

update chan_jingle to reflect the recent change to the indicate prototype

------------------------------------------------------------------------
r29704 | russell | 2006-05-23 18:33:04 +0200 (Tue, 23 May 2006) | 2 lines

remove an unnecessary error message that is really an old debug message

------------------------------------------------------------------------
r29705 | bweschke | 2006-05-23 18:35:46 +0200 (Tue, 23 May 2006) | 3 lines

  app_meetme Muting and Manager API enhancements #6731 (softins w/some minor mods to accomodate recent enum work)


------------------------------------------------------------------------
r29706 | bweschke | 2006-05-23 18:37:40 +0200 (Tue, 23 May 2006) | 11 lines

Merged revisions 29696 via svnmerge from 
<A HREF="https://origsvn.digium.com/svn/asterisk/branches/1.2">https://origsvn.digium.com/svn/asterisk/branches/1.2</A>

.......
r29696 | bweschke | 2006-05-23 11:58:24 -0400 (Tue, 23 May 2006) | 3 lines

 Fix a potential leak and correct (hopefully) a segfault under certain conditions. #6784 (vovan and perry testing)


.......

------------------------------------------------------------------------
r29707 | russell | 2006-05-23 18:37:46 +0200 (Tue, 23 May 2006) | 2 lines

remove another excess &quot;debug&quot; message

------------------------------------------------------------------------
r29708 | mogorman | 2006-05-23 18:43:58 +0200 (Tue, 23 May 2006) | 3 lines

finish cleaning up some more stuff before russell
gets a chance to.

------------------------------------------------------------------------
r29727 | kpfleming | 2006-05-23 19:04:07 +0200 (Tue, 23 May 2006) | 3 lines

restore AST_LIST_HEAD_INIT (with no users in the tree right now)
update ast_mutex_init to allow mutexes that are all zero bytes to be initialized (in the case of a dynamically-allocated structure containing a mutex)

------------------------------------------------------------------------
r29731 | russell | 2006-05-23 19:09:51 +0200 (Tue, 23 May 2006) | 2 lines

on a clean, we have to clean out the ael directory too

------------------------------------------------------------------------
r29734 | bweschke | 2006-05-23 19:21:02 +0200 (Tue, 23 May 2006) | 3 lines

 What's good for 1.2 isn't good for /trunk. Fix for /trunk coming next...


------------------------------------------------------------------------
r29735 | bweschke | 2006-05-23 19:31:05 +0200 (Tue, 23 May 2006) | 3 lines

 Sanity check code for an extended failure in trying to obtain a channel lock that may have been obtained elsewhere. Prevents the monitor thread of the SIP module from going into an infinite loop, effectively, breaking SIP until you restart Asterisk or the mutex is unlocked, whichever comes first.


------------------------------------------------------------------------
r29765 | kpfleming | 2006-05-23 20:17:40 +0200 (Tue, 23 May 2006) | 10 lines

Merged revisions 29764 via svnmerge from 
<A HREF="https://origsvn.digium.com/svn/asterisk/branches/1.2">https://origsvn.digium.com/svn/asterisk/branches/1.2</A>

.......
r29764 | kpfleming | 2006-05-23 13:16:40 -0500 (Tue, 23 May 2006) | 2 lines

simplify/fix lock retry, and fix comment

.......

------------------------------------------------------------------------
r29766 | mogorman | 2006-05-23 20:23:05 +0200 (Tue, 23 May 2006) | 3 lines

allows for configurable answer timeout on attended transfer
patch 0006763 with minor changes.

------------------------------------------------------------------------
r29803 | crichter | 2006-05-23 21:40:16 +0200 (Tue, 23 May 2006) | 1 line

added a l1watcher timeout, therefore removed the old behaviour of guessing the l1state.
------------------------------------------------------------------------
r29825 | mogorman | 2006-05-23 22:25:23 +0200 (Tue, 23 May 2006) | 2 lines

fixes bug where server goes away.

------------------------------------------------------------------------
r29846 | mattf | 2006-05-23 23:10:55 +0200 (Tue, 23 May 2006) | 2 lines

Bump up the echo tail length option

------------------------------------------------------------------------
r29847 | mogorman | 2006-05-23 23:18:07 +0200 (Tue, 23 May 2006) | 3 lines

hmm still need a way to get rid of connections
later on.

------------------------------------------------------------------------
r29848 | mogorman | 2006-05-23 23:28:14 +0200 (Tue, 23 May 2006) | 2 lines

get rid of that transport sillyness

------------------------------------------------------------------------
r29850 | russell | 2006-05-23 23:46:26 +0200 (Tue, 23 May 2006) | 10 lines

Merged revisions 29849 via svnmerge from 
<A HREF="https://origsvn.digium.com/svn/asterisk/branches/1.2">https://origsvn.digium.com/svn/asterisk/branches/1.2</A>

.......
r29849 | russell | 2006-05-23 17:44:52 -0400 (Tue, 23 May 2006) | 2 lines

fix the sourceaddress option (issue #7213, alphaque)

.......

------------------------------------------------------------------------
r29880 | russell | 2006-05-24 00:57:03 +0200 (Wed, 24 May 2006) | 3 lines

further codec module optimization based on codec_alaw changes by rizzo
(issue #7190, Mithraen)

------------------------------------------------------------------------
r29903 | kpfleming | 2006-05-24 05:28:49 +0200 (Wed, 24 May 2006) | 4 lines

add a new option for 'obscuring' SIP user/peer names from fishers
use an enum for authentication results and clean up code
fix a bug where SUBSCRIBE for an unknown user/peer would not generate a response

------------------------------------------------------------------------
r29905 | kpfleming | 2006-05-24 05:32:55 +0200 (Wed, 24 May 2006) | 2 lines

block SIP obscurity fix from merging... trunk version was different

------------------------------------------------------------------------
r29935 | jdixon | 2006-05-24 09:01:02 +0200 (Wed, 24 May 2006) | 2 lines

Added incoming audio notch filtering, plus a bunch of command improvements, etc.

------------------------------------------------------------------------
r29938 | crichter | 2006-05-24 09:58:52 +0200 (Wed, 24 May 2006) | 1 line

fixed to early connect bug which came in yesterday.., also added the transmit of progress indicators through channel vars
------------------------------------------------------------------------
r29970 | kpfleming | 2006-05-24 18:19:57 +0200 (Wed, 24 May 2006) | 10 lines

Merged revisions 29969 via svnmerge from 
<A HREF="https://origsvn.digium.com/svn/asterisk/branches/1.2">https://origsvn.digium.com/svn/asterisk/branches/1.2</A>

.......
r29969 | kpfleming | 2006-05-24 11:17:26 -0500 (Wed, 24 May 2006) | 2 lines

respect 'usecallingpres' in zapata.conf even if CLID has not been set for the channel (issue #7123)

.......

------------------------------------------------------------------------
r29972 | kpfleming | 2006-05-24 18:54:10 +0200 (Wed, 24 May 2006) | 10 lines

Merged revisions 29971 via svnmerge from 
<A HREF="https://origsvn.digium.com/svn/asterisk/branches/1.2">https://origsvn.digium.com/svn/asterisk/branches/1.2</A>

.......
r29971 | kpfleming | 2006-05-24 11:52:08 -0500 (Wed, 24 May 2006) | 2 lines

fix various bugs related to exiting from queue via keypress and moh handling (issue #6776, different fix)

.......

------------------------------------------------------------------------
r29988 | kpfleming | 2006-05-24 19:02:54 +0200 (Wed, 24 May 2006) | 10 lines

Merged revisions 29973 via svnmerge from 
<A HREF="https://origsvn.digium.com/svn/asterisk/branches/1.2">https://origsvn.digium.com/svn/asterisk/branches/1.2</A>

.......
r29973 | kpfleming | 2006-05-24 11:59:20 -0500 (Wed, 24 May 2006) | 2 lines

support video recording via AGI 'RECORD FILE' command (issue #7068)

.......

------------------------------------------------------------------------
r30010 | oej | 2006-05-24 20:17:50 +0200 (Wed, 24 May 2006) | 2 lines

Typo fix. Thanks Peter!

------------------------------------------------------------------------
r30012 | kpfleming | 2006-05-24 20:18:14 +0200 (Wed, 24 May 2006) | 2 lines

don't force the compiler name

------------------------------------------------------------------------
r30034 | file | 2006-05-24 21:16:07 +0200 (Wed, 24 May 2006) | 10 lines

Merged revisions 30033 via svnmerge from 
<A HREF="https://origsvn.digium.com/svn/asterisk/branches/1.2">https://origsvn.digium.com/svn/asterisk/branches/1.2</A>

.......
r30033 | file | 2006-05-24 16:14:01 -0300 (Wed, 24 May 2006) | 2 lines

Fix deadlock caused by a race condition in the logger when reloading (issue #7195 reported and fixed by softins)

.......

------------------------------------------------------------------------
r30036 | file | 2006-05-24 21:46:14 +0200 (Wed, 24 May 2006) | 9 lines

Blocked revisions 30035 via svnmerge

.......
r30035 | file | 2006-05-24 16:44:26 -0300 (Wed, 24 May 2006) | 2 lines

Merge branch for bug 6264 (Privacy option 2 returns dial-status ANSWER / option_priority_jumping not respected) (reported by jkoopmann and branch by murf

.......

------------------------------------------------------------------------
r30038 | oej | 2006-05-24 21:58:36 +0200 (Wed, 24 May 2006) | 2 lines

Typo

------------------------------------------------------------------------
r30039 | mogorman | 2006-05-24 21:59:04 +0200 (Wed, 24 May 2006) | 2 lines

reset timeout on reconnect.

------------------------------------------------------------------------
r30040 | file | 2006-05-24 22:00:10 +0200 (Wed, 24 May 2006) | 2 lines

Merge branch for bug 6264 (Privacy option 2 returns dial-status ANSWER / option_priority_jumping not respected) (reported by jkoopmann and branch by murf)

------------------------------------------------------------------------
r30068 | mogorman | 2006-05-24 22:07:02 +0200 (Wed, 24 May 2006) | 11 lines

Merged revisions 30037 via svnmerge from 
<A HREF="https://svn.digium.com/svn/asterisk/branches/1.2">https://svn.digium.com/svn/asterisk/branches/1.2</A>

.......
r30037 | mogorman | 2006-05-24 14:55:21 -0500 (Wed, 24 May 2006) | 3 lines

app_meemte used the ast_max_exten instead of path_max
solves bug 6822

.......

------------------------------------------------------------------------
r30070 | kpfleming | 2006-05-24 22:37:45 +0200 (Wed, 24 May 2006) | 2 lines

don't send CANCEL for an INVITE that we haven't received a provisional response for yet... mark it pending until a response arrives (issue #7079)

------------------------------------------------------------------------
r30099 | kpfleming | 2006-05-24 23:25:46 +0200 (Wed, 24 May 2006) | 2 lines

block chan_sip fix that is not broken here :-)

------------------------------------------------------------------------
r30104 | file | 2006-05-25 00:00:37 +0200 (Thu, 25 May 2006) | 2 lines

Update some documentation (file internal brain bug #42)

------------------------------------------------------------------------
r30131 | file | 2006-05-25 01:08:39 +0200 (Thu, 25 May 2006) | 2 lines

Nothing to see here... move along

------------------------------------------------------------------------
r30132 | crichter | 2006-05-25 01:21:03 +0200 (Thu, 25 May 2006) | 1 line

added EVENT_NEW_CHANNEL. We change the channel name now when we got the real channel, also changed name generation to new stringfield api
------------------------------------------------------------------------
r30152 | bweschke | 2006-05-25 02:11:30 +0200 (Thu, 25 May 2006) | 3 lines

 Make sure we catch all the instances where a member didn't answer the call sent to them rather than just on a timeout after a dial attempt and some minor code cleanup/reuse.


------------------------------------------------------------------------
r30173 | bweschke | 2006-05-25 03:40:20 +0200 (Thu, 25 May 2006) | 3 lines

 Doxygen comment for Qwell


------------------------------------------------------------------------
r30194 | bweschke | 2006-05-25 15:51:44 +0200 (Thu, 25 May 2006) | 3 lines

 Making sure a char ptr is initialized before we strchr on it is a GOOD thing. Ya! Testing! 


------------------------------------------------------------------------
r30216 | bweschke | 2006-05-25 16:32:15 +0200 (Thu, 25 May 2006) | 3 lines

 Properly initialize destination variables before we send them into pbx_substitute_variables_helper(..). Ya! Testing! Take 2.


------------------------------------------------------------------------
r30240 | file | 2006-05-25 17:29:30 +0200 (Thu, 25 May 2006) | 10 lines

Merged revisions 30239 via svnmerge from 
<A HREF="https://origsvn.digium.com/svn/asterisk/branches/1.2">https://origsvn.digium.com/svn/asterisk/branches/1.2</A>

.......
r30239 | file | 2006-05-25 12:27:44 -0300 (Thu, 25 May 2006) | 2 lines

Get rid of an incorrect SIP dial string in the sample extensions.conf - I even tried variations... no go (issue #7222 reported by arkadia)

.......

------------------------------------------------------------------------
r30241 | russell | 2006-05-25 17:40:38 +0200 (Thu, 25 May 2006) | 3 lines

add DB_DELETE function for the common case of retrieving and deleting a key in
a single operation (issue #7214, twilson)

------------------------------------------------------------------------
r30242 | file | 2006-05-25 17:42:11 +0200 (Thu, 25 May 2006) | 2 lines

Only get the low 16 bits if we actually have a message count

------------------------------------------------------------------------
r30271 | file | 2006-05-25 18:14:17 +0200 (Thu, 25 May 2006) | 2 lines

Safely traverse the thread lists and wait until each thread is done before moving on to the next.

------------------------------------------------------------------------
r30272 | russell | 2006-05-25 18:44:22 +0200 (Thu, 25 May 2006) | 8 lines

- add support for setting an AGISTATUS variable that indicates successful
  execution, failure, or if the channel requested hangup.
- only return -1 from the application if the application requested hangup. If
  there was just a failure in execution of the AGI, just set the status
  variable appropriately and move on in the dialplan.
(issue #7121, original patch by Alessandro Polverini, updated patch by srt,
 committed patch is heavily modified to allow still returning -1 on hangup)

------------------------------------------------------------------------
r30294 | kpfleming | 2006-05-25 19:22:26 +0200 (Thu, 25 May 2006) | 10 lines

Merged revisions 30293 via svnmerge from 
<A HREF="https://origsvn.digium.com/svn/asterisk/branches/1.2">https://origsvn.digium.com/svn/asterisk/branches/1.2</A>

.......
r30293 | kpfleming | 2006-05-25 12:18:01 -0500 (Thu, 25 May 2006) | 2 lines

allow SIPCHANINFO(peername) to work for calls from users as well (issue #7215)

.......

------------------------------------------------------------------------
r30297 | kpfleming | 2006-05-25 19:39:46 +0200 (Thu, 25 May 2006) | 10 lines

Merged revisions 30296 via svnmerge from 
<A HREF="https://origsvn.digium.com/svn/asterisk/branches/1.2">https://origsvn.digium.com/svn/asterisk/branches/1.2</A>

.......
r30296 | kpfleming | 2006-05-25 12:39:33 -0500 (Thu, 25 May 2006) | 2 lines

don't try to use -march=s390 when building on S/390 systems (reported via asterisk-users mailing list)

.......

------------------------------------------------------------------------
r30299 | file | 2006-05-25 19:58:55 +0200 (Thu, 25 May 2006) | 2 lines

Add Archive option to call files and add documentation on them. (issue #5426 reported by ezio - props to blitzrage for proof reading the documentation)

------------------------------------------------------------------------
r30328 | russell | 2006-05-25 20:31:19 +0200 (Thu, 25 May 2006) | 5 lines

Add the ability to retrieve the exit code of the forked AGI process.  If there
is an error executing the AGI script, or the AGI script itself returns a
non-zero value, the AGISTATUS variable will now be set to FAILURE instead of
SUCCESS.

------------------------------------------------------------------------
r30337 | russell | 2006-05-25 21:01:26 +0200 (Thu, 25 May 2006) | 4 lines

allow setting a channel variable to disable sending SIGHUP to the AGI process
(issue #6491, original patch by juggie, channel variable patch by corydon,
 committed patch modified to change variable name and update documentation)

------------------------------------------------------------------------
r30359 | russell | 2006-05-25 21:07:31 +0200 (Thu, 25 May 2006) | 6 lines

- mark some applications deprecated that already have replacements
- add BLACKLIST and mark LookupBlacklist deprecated
- add transfercapability support to CHANNEL and mark SetTransferCapability
  deprecated
(issue #7225, Corydon)

------------------------------------------------------------------------
r30360 | russell | 2006-05-25 21:21:09 +0200 (Thu, 25 May 2006) | 3 lines

add the ability to be able to echo DTMF_BEGIN/END, HTML, and IMAGE frames, too 
(issue #7193, Mithraen, with some mods)

------------------------------------------------------------------------
r30361 | kpfleming | 2006-05-25 21:26:26 +0200 (Thu, 25 May 2006) | 2 lines

use the proper method for adding a new entry

------------------------------------------------------------------------
r30384 | file | 2006-05-25 22:05:52 +0200 (Thu, 25 May 2006) | 10 lines

Merged revisions 30373 via svnmerge from 
<A HREF="https://origsvn.digium.com/svn/asterisk/branches/1.2">https://origsvn.digium.com/svn/asterisk/branches/1.2</A>

.......
r30373 | file | 2006-05-25 17:03:11 -0300 (Thu, 25 May 2006) | 2 lines

Don't play the enter sound twice when a person joins a conference after the leader has joined it. (issue #6138 reported by shanermn)

.......

------------------------------------------------------------------------


Modified: trunk/CREDITS
===================================================================
--- trunk/CREDITS	2006-05-25 20:48:20 UTC (rev 180)
+++ trunk/CREDITS	2006-05-26 21:12:24 UTC (rev 181)
@@ -79,6 +79,8 @@
 Steve Murphy - privacy support, $[ ] parser upgrade, AEL2 parser upgrade
 Claude Patry - bug fixes, feature enhancements, and bug marshalling
 	<A HREF="https://lists.berlios.de/mailman/listinfo/solid-pbx-svn">cpatry at gmail.com</A>
+Miroslav Nachev, <A HREF="https://lists.berlios.de/mailman/listinfo/solid-pbx-svn">miro at space-comm.com</A> COSMOS Software Enterprises, Ltd.
+	- for Variable for No Answer Timeout for Attended Transfer
 
 === OTHER CONTRIBUTIONS ===
 John Todd - Monkey sounds and associated teletorture prompt
@@ -92,8 +94,9 @@
 Music provided by www.freeplaymusic.com
 
 === OTHER SOURCE CODE IN ASTERISK ===
-Asterisk uses libedit, the lightweight readline replacement from
-NetBSD. It is BSD-licensed and requires the following statement:
+Asterisk uses libedit, the lightweight readline replacement from NetBSD.
+The cdr_radius module uses libradiusclient-ng, which is also from NetBSD.
+They are BSD-licensed and require the following statement:
 
       This product includes software developed by the NetBSD
       Foundation, Inc. and its contributors.

Modified: trunk/Makefile
===================================================================
--- trunk/Makefile	2006-05-25 20:48:20 UTC (rev 180)
+++ trunk/Makefile	2006-05-26 21:12:24 UTC (rev 181)
@@ -367,7 +367,7 @@
 	@echo &quot; +               make install                +&quot;  
 	@echo &quot; +-------------------------------------------+&quot;  
 
-all: cleantest config.status menuselect.makeopts depend asterisk subdirs
+all: cleantest defaults.h config.status menuselect.makeopts depend asterisk subdirs
 
 config.status: configure
 	@CFLAGS=&quot;&quot; ./configure

Modified: trunk/UPGRADE.txt
===================================================================
--- trunk/UPGRADE.txt	2006-05-25 20:48:20 UTC (rev 180)
+++ trunk/UPGRADE.txt	2006-05-26 21:12:24 UTC (rev 181)
@@ -97,6 +97,12 @@
   record conversations queue members are having with queue callers. Please
   see configs/queues.conf.sample for more information on this option.
 
+* app_meetme: The 'm' option (monitor) is renamed to 'l' (listen only), and
+  the 'm' option now provides the functionality of &quot;initially muted&quot;. 
+  In practice, most existing dialplans using the 'm' flag should not notice
+  any difference, unless the keypad menu is enabled, allowing the user 
+  to unmute themsleves.
+
 * ast_play_and_record would attempt to cancel the recording if a DTMF
   '0' was received.  This behavior was not documented in most of the
   applications that used ast_play_and_record and the return codes from
@@ -127,6 +133,17 @@
   call. This is useful when trying to link recording filenames back to 
   a particular call from the queue.
 
+* app_userevent has been modified to always send Event: UserEvent with the
+  additional header UserEvent: &lt;userspec&gt;.  Also, the Channel and UniqueID
+  headers are not automatically sent, unless you specify them as separate
+  arguments.  Please see the application help for the new syntax.
+
+* app_meetme: Mute and Unmute events are now reported via the Manager API.
+  Native Manager API commands MeetMeMute and MeetMeUnmute are provided, which
+  are easier to use than &quot;Action Command:&quot;. The MeetMeStopTalking event has
+  also been deprecated in favor of the already existing MeetmeTalking event
+  with a &quot;Status&quot; of &quot;on&quot; or &quot;off&quot; added.
+
 Variables:
 
 * The builtin variables ${CALLERID}, ${CALLERIDNAME}, ${CALLERIDNUM},

Modified: trunk/acinclude.m4
===================================================================
--- trunk/acinclude.m4	2006-05-25 20:48:20 UTC (rev 180)
+++ trunk/acinclude.m4	2006-05-26 21:12:24 UTC (rev 181)
@@ -5,35 +5,35 @@
 AC_ARG_WITH([$1], AC_HELP_STRING([--with-$1=PATH],[use $5 files in PATH]),[
 case ${withval} in
      n|no)
-     USE_$1=no
+     USE_$4=no
      ;;
      y|ye|yes)
-     $1_MANDATORY=&quot;yes&quot;
+     $4_MANDATORY=&quot;yes&quot;
      ;;
      *)
-     $1_DIR=&quot;${withval}&quot;
-     $1_MANDATORY=&quot;yes&quot;
+     $4_DIR=&quot;${withval}&quot;
+     $4_MANDATORY=&quot;yes&quot;
      ;;
 esac
 ])
 
-PBX_LIB$1=0
+PBX_LIB$4=0
 
-if test &quot;${USE_$1}&quot; != &quot;no&quot;; then
+if test &quot;${USE_$4}&quot; != &quot;no&quot;; then
    pbxlibdir=&quot;&quot;
-   if test &quot;x${$1_DIR}&quot; != &quot;x&quot;; then
+   if test &quot;x${$4_DIR}&quot; != &quot;x&quot;; then
       pbxlibdir=&quot;-L${$1_DIR}/lib&quot;
    fi
-   AC_CHECK_LIB([$1], [$2], [:], [], ${pbxlibdir} $6)
+   AC_CHECK_LIB([$1], [$2], [AST_$4_FOUND=yes], [AST_$4_FOUND=no], ${pbxlibdir} $6)
 
-   if test &quot;${ac_cv_lib_$1_$2}&quot; = &quot;yes&quot;; then
-      $1_LIB=&quot;-l$1 $6&quot;
+   if test &quot;${AST_$4_FOUND}&quot; = &quot;yes&quot;; then
+      $4_LIB=&quot;-l$1 $6&quot;
       $4_HEADER_FOUND=&quot;1&quot;
-      if test &quot;x${$1_DIR}&quot; != &quot;x&quot;; then
-         $1_LIB=&quot;${pbxlibdir} ${$1_LIB}&quot;
-	 $1_INCLUDE=&quot;-I${$1_DIR}/include&quot;
+      if test &quot;x${$4_DIR}&quot; != &quot;x&quot;; then
+         $4_LIB=&quot;${pbxlibdir} ${$4_LIB}&quot;
+	 $4_INCLUDE=&quot;-I${$4_DIR}/include&quot;
 	 if test &quot;x$3&quot; != &quot;x&quot; ; then
-	    AC_CHECK_HEADER([${$1_DIR}/include/$3], [$4_HEADER_FOUND=1], [$4_HEADER_FOUND=0] )
+	    AC_CHECK_HEADER([${$4_DIR}/include/$3], [$4_HEADER_FOUND=1], [$4_HEADER_FOUND=0] )
 	 fi
       else
 	 if test &quot;x$3&quot; != &quot;x&quot; ; then
@@ -41,7 +41,7 @@
 	 fi
       fi
       if test &quot;x${$4_HEADER_FOUND}&quot; = &quot;x0&quot; ; then
-         if test ! -z &quot;${$1_MANDATORY}&quot; ;
+         if test ! -z &quot;${$4_MANDATORY}&quot; ;
          then
             echo &quot; ***&quot;
             echo &quot; *** It appears that you do not have the $1 development package installed.&quot;
@@ -49,14 +49,14 @@
             echo &quot; *** without explicitly specifying --with-$1&quot;
             exit 1
          fi
-         $1_LIB=&quot;&quot;
-         $1_INCLUDE=&quot;&quot;
-         PBX_LIB$1=0
+         $4_LIB=&quot;&quot;
+         $4_INCLUDE=&quot;&quot;
+         PBX_LIB$4=0
       else
-         PBX_LIB$1=1
+         PBX_LIB$4=1
          AC_DEFINE_UNQUOTED([HAVE_$4], 1, [Define to indicate the $5 library])
       fi
-   elif test ! -z &quot;${$1_MANDATORY}&quot;;
+   elif test ! -z &quot;${$4_MANDATORY}&quot;;
    then
       echo &quot;***&quot;
       echo &quot;*** The $5 installation on this system appears to be broken.&quot;
@@ -65,9 +65,9 @@
       exit 1
    fi
 fi
-AC_SUBST([$1_LIB])
-AC_SUBST([$1_INCLUDE])
-AC_SUBST([PBX_LIB$1])
+AC_SUBST([$4_LIB])
+AC_SUBST([$4_INCLUDE])
+AC_SUBST([PBX_LIB$4])
 ])
 
 

Modified: trunk/aclocal.m4
===================================================================
--- trunk/aclocal.m4	2006-05-25 20:48:20 UTC (rev 180)
+++ trunk/aclocal.m4	2006-05-26 21:12:24 UTC (rev 181)
@@ -1,14 +1,922 @@
-# generated automatically by aclocal 1.9.6 -*- Autoconf -*-
+dnl aclocal.m4 generated automatically by aclocal 1.4-p6
 
-# Copyright (C) 1996, 1997, 1998, 1999, 2000, 2001, 2002, 2003, 2004,
-# 2005  Free Software Foundation, Inc.
-# This file is free software; the Free Software Foundation
-# gives unlimited permission to copy and/or distribute it,
-# with or without modifications, as long as this notice is preserved.
+dnl Copyright (C) 1994, 1995-8, 1999, 2001 Free Software Foundation, Inc.
+dnl This file is free software; the Free Software Foundation
+dnl gives unlimited permission to copy and/or distribute it,
+dnl with or without modifications, as long as this notice is preserved.
 
-# This program is distributed in the hope that it will be useful,
-# but WITHOUT ANY WARRANTY, to the extent permitted by law; without
-# even the implied warranty of MERCHANTABILITY or FITNESS FOR A
-# PARTICULAR PURPOSE.
+dnl This program is distributed in the hope that it will be useful,
+dnl but WITHOUT ANY WARRANTY, to the extent permitted by law; without
+dnl even the implied warranty of MERCHANTABILITY or FITNESS FOR A
+dnl PARTICULAR PURPOSE.
 
-m4_include([acinclude.m4])
+# AST_EXT_LIB([NAME], [FUNCTION], [package header], [package symbol name], [package friendly name], [additional LIB data])
+
+AC_DEFUN([AST_EXT_LIB],
+[
+AC_ARG_WITH([$1], AC_HELP_STRING([--with-$1=PATH],[use $5 files in PATH]),[
+case ${withval} in
+     n|no)
+     USE_$4=no
+     ;;
+     y|ye|yes)
+     $4_MANDATORY=&quot;yes&quot;
+     ;;
+     *)
+     $4_DIR=&quot;${withval}&quot;
+     $4_MANDATORY=&quot;yes&quot;
+     ;;
+esac
+])
+
+PBX_LIB$4=0
+
+if test &quot;${USE_$4}&quot; != &quot;no&quot;; then
+   pbxlibdir=&quot;&quot;
+   if test &quot;x${$4_DIR}&quot; != &quot;x&quot;; then
+      pbxlibdir=&quot;-L${$1_DIR}/lib&quot;
+   fi
+   AC_CHECK_LIB([$1], [$2], [AST_$4_FOUND=yes], [AST_$4_FOUND=no], ${pbxlibdir} $6)
+
+   if test &quot;${AST_$4_FOUND}&quot; = &quot;yes&quot;; then
+      $4_LIB=&quot;-l$1 $6&quot;
+      $4_HEADER_FOUND=&quot;1&quot;
+      if test &quot;x${$4_DIR}&quot; != &quot;x&quot;; then
+         $4_LIB=&quot;${pbxlibdir} ${$4_LIB}&quot;
+	 $4_INCLUDE=&quot;-I${$4_DIR}/include&quot;
+	 if test &quot;x$3&quot; != &quot;x&quot; ; then
+	    AC_CHECK_HEADER([${$4_DIR}/include/$3], [$4_HEADER_FOUND=1], [$4_HEADER_FOUND=0] )
+	 fi
+      else
+	 if test &quot;x$3&quot; != &quot;x&quot; ; then
+            AC_CHECK_HEADER([$3], [$4_HEADER_FOUND=1], [$4_HEADER_FOUND=0] )
+	 fi
+      fi
+      if test &quot;x${$4_HEADER_FOUND}&quot; = &quot;x0&quot; ; then
+         if test ! -z &quot;${$4_MANDATORY}&quot; ;
+         then
+            echo &quot; ***&quot;
+            echo &quot; *** It appears that you do not have the $1 development package installed.&quot;
+            echo &quot; *** Please install it to include $5 support, or re-run configure&quot;
+            echo &quot; *** without explicitly specifying --with-$1&quot;
+            exit 1
+         fi
+         $4_LIB=&quot;&quot;
+         $4_INCLUDE=&quot;&quot;
+         PBX_LIB$4=0
+      else
+         PBX_LIB$4=1
+         AC_DEFINE_UNQUOTED([HAVE_$4], 1, [Define to indicate the $5 library])
+      fi
+   elif test ! -z &quot;${$4_MANDATORY}&quot;;
+   then
+      echo &quot;***&quot;
+      echo &quot;*** The $5 installation on this system appears to be broken.&quot;
+      echo &quot;*** Either correct the installation, or run configure&quot;
+      echo &quot;*** without explicity specifying --with-$1&quot;
+      exit 1
+   fi
+fi
+AC_SUBST([$4_LIB])
+AC_SUBST([$4_INCLUDE])
+AC_SUBST([PBX_LIB$4])
+])
+
+
+AC_DEFUN(
+[AST_CHECK_GNU_MAKE], [AC_CACHE_CHECK(for GNU make, GNU_MAKE,
+   GNU_MAKE='Not Found' ;
+   for a in make gmake gnumake ; do
+      if test -z &quot;$a&quot; ; then continue ; fi ;
+      if ( sh -c &quot;$a --version&quot; 2&gt; /dev/null | grep GNU  2&gt;&amp;1 &gt; /dev/null ) ;  then
+         GNU_MAKE=$a ;
+         break;
+      fi
+   done ;
+) ;
+if test  &quot;x$GNU_MAKE&quot; = &quot;xNot Found&quot;  ; then
+   echo &quot; *** Please install GNU make.  It is required to build Asterisk!&quot;
+   exit 1
+fi
+AC_SUBST([GNU_MAKE])
+])
+
+# lib-prefix.m4 serial 4 (gettext-0.14.2)
+dnl Copyright (C) 2001-2005 Free Software Foundation, Inc.
+dnl This file is free software; the Free Software Foundation
+dnl gives unlimited permission to copy and/or distribute it,
+dnl with or without modifications, as long as this notice is preserved.
+
+dnl From Bruno Haible.
+
+dnl AC_LIB_ARG_WITH is synonymous to AC_ARG_WITH in autoconf-2.13, and
+dnl similar to AC_ARG_WITH in autoconf 2.52...2.57 except that is doesn't
+dnl require excessive bracketing.
+ifdef([AC_HELP_STRING],
+[AC_DEFUN([AC_LIB_ARG_WITH], [AC_ARG_WITH([$1],[[$2]],[$3],[$4])])],
+[AC_DEFUN([AC_][LIB_ARG_WITH], [AC_ARG_WITH([$1],[$2],[$3],[$4])])])
+
+dnl AC_LIB_PREFIX adds to the CPPFLAGS and LDFLAGS the flags that are needed
+dnl to access previously installed libraries. The basic assumption is that
+dnl a user will want packages to use other packages he previously installed
+dnl with the same --prefix option.
+dnl This macro is not needed if only AC_LIB_LINKFLAGS is used to locate
+dnl libraries, but is otherwise very convenient.
+AC_DEFUN([AC_LIB_PREFIX],
+[
+  AC_BEFORE([$0], [AC_LIB_LINKFLAGS])
+  AC_REQUIRE([AC_PROG_CC])
+  AC_REQUIRE([AC_CANONICAL_HOST])
+  AC_REQUIRE([AC_LIB_PREPARE_PREFIX])
+  dnl By default, look in $includedir and $libdir.
+  use_additional=yes
+  AC_LIB_WITH_FINAL_PREFIX([
+    eval additional_includedir=\&quot;$includedir\&quot;
+    eval additional_libdir=\&quot;$libdir\&quot;
+  ])
+  AC_LIB_ARG_WITH([lib-prefix],
+[  --with-lib-prefix[=DIR] search for libraries in DIR/include and DIR/lib
+  --without-lib-prefix    don't search for libraries in includedir and libdir],
+[
+    if test &quot;X$withval&quot; = &quot;Xno&quot;; then
+      use_additional=no
+    else
+      if test &quot;X$withval&quot; = &quot;X&quot;; then
+        AC_LIB_WITH_FINAL_PREFIX([
+          eval additional_includedir=\&quot;$includedir\&quot;
+          eval additional_libdir=\&quot;$libdir\&quot;
+        ])
+      else
+        additional_includedir=&quot;$withval/include&quot;
+        additional_libdir=&quot;$withval/lib&quot;
+      fi
+    fi
+])
+  if test $use_additional = yes; then
+    dnl Potentially add $additional_includedir to $CPPFLAGS.
+    dnl But don't add it
+    dnl   1. if it's the standard /usr/include,
+    dnl   2. if it's already present in $CPPFLAGS,
+    dnl   3. if it's /usr/local/include and we are using GCC on Linux,
+    dnl   4. if it doesn't exist as a directory.
+    if test &quot;X$additional_includedir&quot; != &quot;X/usr/include&quot;; then
+      haveit=
+      for x in $CPPFLAGS; do
+        AC_LIB_WITH_FINAL_PREFIX([eval x=\&quot;$x\&quot;])
+        if test &quot;X$x&quot; = &quot;X-I$additional_includedir&quot;; then
+          haveit=yes
+          break
+        fi
+      done
+      if test -z &quot;$haveit&quot;; then
+        if test &quot;X$additional_includedir&quot; = &quot;X/usr/local/include&quot;; then
+          if test -n &quot;$GCC&quot;; then
+            case $host_os in
+              linux* | gnu* | k*bsd*-gnu) haveit=yes;;
+            esac
+          fi
+        fi
+        if test -z &quot;$haveit&quot;; then
+          if test -d &quot;$additional_includedir&quot;; then
+            dnl Really add $additional_includedir to $CPPFLAGS.
+            CPPFLAGS=&quot;${CPPFLAGS}${CPPFLAGS:+ }-I$additional_includedir&quot;
+          fi
+        fi
+      fi
+    fi
+    dnl Potentially add $additional_libdir to $LDFLAGS.
+    dnl But don't add it
+    dnl   1. if it's the standard /usr/lib,
+    dnl   2. if it's already present in $LDFLAGS,
+    dnl   3. if it's /usr/local/lib and we are using GCC on Linux,
+    dnl   4. if it doesn't exist as a directory.
+    if test &quot;X$additional_libdir&quot; != &quot;X/usr/lib&quot;; then
+      haveit=
+      for x in $LDFLAGS; do
+        AC_LIB_WITH_FINAL_PREFIX([eval x=\&quot;$x\&quot;])
+        if test &quot;X$x&quot; = &quot;X-L$additional_libdir&quot;; then
+          haveit=yes
+          break
+        fi
+      done
+      if test -z &quot;$haveit&quot;; then
+        if test &quot;X$additional_libdir&quot; = &quot;X/usr/local/lib&quot;; then
+          if test -n &quot;$GCC&quot;; then
+            case $host_os in
+              linux*) haveit=yes;;
+            esac
+          fi
+        fi
+        if test -z &quot;$haveit&quot;; then
+          if test -d &quot;$additional_libdir&quot;; then
+            dnl Really add $additional_libdir to $LDFLAGS.
+            LDFLAGS=&quot;${LDFLAGS}${LDFLAGS:+ }-L$additional_libdir&quot;
+          fi
+        fi
+      fi
+    fi
+  fi
+])
+
+dnl AC_LIB_PREPARE_PREFIX creates variables acl_final_prefix,
+dnl acl_final_exec_prefix, containing the values to which $prefix and
+dnl $exec_prefix will expand at the end of the configure script.
+AC_DEFUN([AC_LIB_PREPARE_PREFIX],
+[
+  dnl Unfortunately, prefix and exec_prefix get only finally determined
+  dnl at the end of configure.
+  if test &quot;X$prefix&quot; = &quot;XNONE&quot;; then
+    acl_final_prefix=&quot;$ac_default_prefix&quot;
+  else
+    acl_final_prefix=&quot;$prefix&quot;
+  fi
+  if test &quot;X$exec_prefix&quot; = &quot;XNONE&quot;; then
+    acl_final_exec_prefix='${prefix}'
+  else
+    acl_final_exec_prefix=&quot;$exec_prefix&quot;
+  fi
+  acl_save_prefix=&quot;$prefix&quot;
+  prefix=&quot;$acl_final_prefix&quot;
+  eval acl_final_exec_prefix=\&quot;$acl_final_exec_prefix\&quot;
+  prefix=&quot;$acl_save_prefix&quot;
+])
+
+dnl AC_LIB_WITH_FINAL_PREFIX([statement]) evaluates statement, with the
+dnl variables prefix and exec_prefix bound to the values they will have
+dnl at the end of the configure script.
+AC_DEFUN([AC_LIB_WITH_FINAL_PREFIX],
+[
+  acl_save_prefix=&quot;$prefix&quot;
+  prefix=&quot;$acl_final_prefix&quot;
+  acl_save_exec_prefix=&quot;$exec_prefix&quot;
+  exec_prefix=&quot;$acl_final_exec_prefix&quot;
+  $1
+  exec_prefix=&quot;$acl_save_exec_prefix&quot;
+  prefix=&quot;$acl_save_prefix&quot;
+])
+
+# lib-link.m4 serial 6 (gettext-0.14.3)
+dnl Copyright (C) 2001-2005 Free Software Foundation, Inc.
+dnl This file is free software; the Free Software Foundation
+dnl gives unlimited permission to copy and/or distribute it,
+dnl with or without modifications, as long as this notice is preserved.
+
+dnl From Bruno Haible.
+
+AC_PREREQ(2.50)
+
+dnl AC_LIB_LINKFLAGS(name [, dependencies]) searches for libname and
+dnl the libraries corresponding to explicit and implicit dependencies.
+dnl Sets and AC_SUBSTs the LIB${NAME} and LTLIB${NAME} variables and
+dnl augments the CPPFLAGS variable.
+AC_DEFUN([AC_LIB_LINKFLAGS],
+[
+  AC_REQUIRE([AC_LIB_PREPARE_PREFIX])
+  AC_REQUIRE([AC_LIB_RPATH])
+  define([Name],[translit([$1],[./-], [___])])
+  define([NAME],[translit([$1],[abcdefghijklmnopqrstuvwxyz./-],
+                               [ABCDEFGHIJKLMNOPQRSTUVWXYZ___])])
+  AC_CACHE_CHECK([how to link with lib[]$1], [ac_cv_lib[]Name[]_libs], [
+    AC_LIB_LINKFLAGS_BODY([$1], [$2])
+    ac_cv_lib[]Name[]_libs=&quot;$LIB[]NAME&quot;
+    ac_cv_lib[]Name[]_ltlibs=&quot;$LTLIB[]NAME&quot;
+    ac_cv_lib[]Name[]_cppflags=&quot;$INC[]NAME&quot;
+  ])
+  LIB[]NAME=&quot;$ac_cv_lib[]Name[]_libs&quot;
+  LTLIB[]NAME=&quot;$ac_cv_lib[]Name[]_ltlibs&quot;
+  INC[]NAME=&quot;$ac_cv_lib[]Name[]_cppflags&quot;
+  AC_LIB_APPENDTOVAR([CPPFLAGS], [$INC]NAME)
+  AC_SUBST([LIB]NAME)
+  AC_SUBST([LTLIB]NAME)
+  dnl Also set HAVE_LIB[]NAME so that AC_LIB_HAVE_LINKFLAGS can reuse the
+  dnl results of this search when this library appears as a dependency.
+  HAVE_LIB[]NAME=yes
+  undefine([Name])
+  undefine([NAME])
+])
+
+dnl AC_LIB_HAVE_LINKFLAGS(name, dependencies, includes, testcode)
+dnl searches for libname and the libraries corresponding to explicit and
+dnl implicit dependencies, together with the specified include files and
+dnl the ability to compile and link the specified testcode. If found, it
+dnl sets and AC_SUBSTs HAVE_LIB${NAME}=yes and the LIB${NAME} and
+dnl LTLIB${NAME} variables and augments the CPPFLAGS variable, and
+dnl #defines HAVE_LIB${NAME} to 1. Otherwise, it sets and AC_SUBSTs
+dnl HAVE_LIB${NAME}=no and LIB${NAME} and LTLIB${NAME} to empty.
+AC_DEFUN([AC_LIB_HAVE_LINKFLAGS],
+[
+  AC_REQUIRE([AC_LIB_PREPARE_PREFIX])
+  AC_REQUIRE([AC_LIB_RPATH])
+  define([Name],[translit([$1],[./-], [___])])
+  define([NAME],[translit([$1],[abcdefghijklmnopqrstuvwxyz./-],
+                               [ABCDEFGHIJKLMNOPQRSTUVWXYZ___])])
+
+  dnl Search for lib[]Name and define LIB[]NAME, LTLIB[]NAME and INC[]NAME
+  dnl accordingly.
+  AC_LIB_LINKFLAGS_BODY([$1], [$2])
+
+  dnl Add $INC[]NAME to CPPFLAGS before performing the following checks,
+  dnl because if the user has installed lib[]Name and not disabled its use
+  dnl via --without-lib[]Name-prefix, he wants to use it.
+  ac_save_CPPFLAGS=&quot;$CPPFLAGS&quot;
+  AC_LIB_APPENDTOVAR([CPPFLAGS], [$INC]NAME)
+
+  AC_CACHE_CHECK([for lib[]$1], [ac_cv_lib[]Name], [
+    ac_save_LIBS=&quot;$LIBS&quot;
+    LIBS=&quot;$LIBS $LIB[]NAME&quot;
+    AC_TRY_LINK([$3], [$4], [ac_cv_lib[]Name=yes], [ac_cv_lib[]Name=no])
+    LIBS=&quot;$ac_save_LIBS&quot;
+  ])
+  if test &quot;$ac_cv_lib[]Name&quot; = yes; then
+    HAVE_LIB[]NAME=yes
+    AC_DEFINE([HAVE_LIB]NAME, 1, [Define if you have the $1 library.])
+    AC_MSG_CHECKING([how to link with lib[]$1])
+    AC_MSG_RESULT([$LIB[]NAME])
+  else
+    HAVE_LIB[]NAME=no
+    dnl If $LIB[]NAME didn't lead to a usable library, we don't need
+    dnl $INC[]NAME either.
+    CPPFLAGS=&quot;$ac_save_CPPFLAGS&quot;
+    LIB[]NAME=
+    LTLIB[]NAME=
+  fi
+  AC_SUBST([HAVE_LIB]NAME)
+  AC_SUBST([LIB]NAME)
+  AC_SUBST([LTLIB]NAME)
+  undefine([Name])
+  undefine([NAME])
+])
+
+dnl Determine the platform dependent parameters needed to use rpath:
+dnl libext, shlibext, hardcode_libdir_flag_spec, hardcode_libdir_separator,
+dnl hardcode_direct, hardcode_minus_L.
+AC_DEFUN([AC_LIB_RPATH],
+[
+  dnl Tell automake &gt;= 1.10 to complain if config.rpath is missing.
+  m4_ifdef([AC_REQUIRE_AUX_FILE], [AC_REQUIRE_AUX_FILE([config.rpath])])
+  AC_REQUIRE([AC_PROG_CC])                dnl we use $CC, $GCC, $LDFLAGS
+  AC_REQUIRE([AC_LIB_PROG_LD])            dnl we use $LD, $with_gnu_ld
+  AC_REQUIRE([AC_CANONICAL_HOST])         dnl we use $host
+  AC_REQUIRE([AC_CONFIG_AUX_DIR_DEFAULT]) dnl we use $ac_aux_dir
+  AC_CACHE_CHECK([for shared library run path origin], acl_cv_rpath, [
+    CC=&quot;$CC&quot; GCC=&quot;$GCC&quot; LDFLAGS=&quot;$LDFLAGS&quot; LD=&quot;$LD&quot; with_gnu_ld=&quot;$with_gnu_ld&quot; \
+    ${CONFIG_SHELL-/bin/sh} &quot;$ac_aux_dir/config.rpath&quot; &quot;$host&quot; &gt; conftest.sh
+    . ./conftest.sh
+    rm -f ./conftest.sh
+    acl_cv_rpath=done
+  ])
+  wl=&quot;$acl_cv_wl&quot;
+  libext=&quot;$acl_cv_libext&quot;
+  shlibext=&quot;$acl_cv_shlibext&quot;
+  hardcode_libdir_flag_spec=&quot;$acl_cv_hardcode_libdir_flag_spec&quot;
+  hardcode_libdir_separator=&quot;$acl_cv_hardcode_libdir_separator&quot;
+  hardcode_direct=&quot;$acl_cv_hardcode_direct&quot;
+  hardcode_minus_L=&quot;$acl_cv_hardcode_minus_L&quot;
+  dnl Determine whether the user wants rpath handling at all.
+  AC_ARG_ENABLE(rpath,
+    [  --disable-rpath         do not hardcode runtime library paths],
+    :, enable_rpath=yes)
+])
+
+dnl AC_LIB_LINKFLAGS_BODY(name [, dependencies]) searches for libname and
+dnl the libraries corresponding to explicit and implicit dependencies.
+dnl Sets the LIB${NAME}, LTLIB${NAME} and INC${NAME} variables.
+AC_DEFUN([AC_LIB_LINKFLAGS_BODY],
+[
+  define([NAME],[translit([$1],[abcdefghijklmnopqrstuvwxyz./-],
+                               [ABCDEFGHIJKLMNOPQRSTUVWXYZ___])])
+  dnl By default, look in $includedir and $libdir.
+  use_additional=yes
+  AC_LIB_WITH_FINAL_PREFIX([
+    eval additional_includedir=\&quot;$includedir\&quot;
+    eval additional_libdir=\&quot;$libdir\&quot;
+  ])
+  AC_LIB_ARG_WITH([lib$1-prefix],
+[  --with-lib$1-prefix[=DIR]  search for lib$1 in DIR/include and DIR/lib
+  --without-lib$1-prefix     don't search for lib$1 in includedir and libdir],
+[
+    if test &quot;X$withval&quot; = &quot;Xno&quot;; then
+      use_additional=no
+    else
+      if test &quot;X$withval&quot; = &quot;X&quot;; then
+        AC_LIB_WITH_FINAL_PREFIX([
+          eval additional_includedir=\&quot;$includedir\&quot;
+          eval additional_libdir=\&quot;$libdir\&quot;
+        ])
+      else
+        additional_includedir=&quot;$withval/include&quot;
+        additional_libdir=&quot;$withval/lib&quot;
+      fi
+    fi
+])
+  dnl Search the library and its dependencies in $additional_libdir and
+  dnl $LDFLAGS. Using breadth-first-seach.
+  LIB[]NAME=
+  LTLIB[]NAME=
+  INC[]NAME=
+  rpathdirs=
+  ltrpathdirs=
+  names_already_handled=
+  names_next_round='$1 $2'
+  while test -n &quot;$names_next_round&quot;; do
+    names_this_round=&quot;$names_next_round&quot;
+    names_next_round=
+    for name in $names_this_round; do
+      already_handled=
+      for n in $names_already_handled; do
+        if test &quot;$n&quot; = &quot;$name&quot;; then
+          already_handled=yes
+          break
+        fi
+      done
+      if test -z &quot;$already_handled&quot;; then
+        names_already_handled=&quot;$names_already_handled $name&quot;
+        dnl See if it was already located by an earlier AC_LIB_LINKFLAGS
+        dnl or AC_LIB_HAVE_LINKFLAGS call.
+        uppername=`echo &quot;$name&quot; | sed -e 'y|abcdefghijklmnopqrstuvwxyz./-|ABCDEFGHIJKLMNOPQRSTUVWXYZ___|'`
+        eval value=\&quot;\$HAVE_LIB$uppername\&quot;
+        if test -n &quot;$value&quot;; then
+          if test &quot;$value&quot; = yes; then
+            eval value=\&quot;\$LIB$uppername\&quot;
+            test -z &quot;$value&quot; || LIB[]NAME=&quot;${LIB[]NAME}${LIB[]NAME:+ }$value&quot;
+            eval value=\&quot;\$LTLIB$uppername\&quot;
+            test -z &quot;$value&quot; || LTLIB[]NAME=&quot;${LTLIB[]NAME}${LTLIB[]NAME:+ }$value&quot;
+          else
+            dnl An earlier call to AC_LIB_HAVE_LINKFLAGS has determined
+            dnl that this library doesn't exist. So just drop it.
+            :
+          fi
+        else
+          dnl Search the library lib$name in $additional_libdir and $LDFLAGS
+          dnl and the already constructed $LIBNAME/$LTLIBNAME.
+          found_dir=
+          found_la=
+          found_so=
+          found_a=
+          if test $use_additional = yes; then
+            if test -n &quot;$shlibext&quot; &amp;&amp; test -f &quot;$additional_libdir/lib$name.$shlibext&quot;; then
+              found_dir=&quot;$additional_libdir&quot;
+              found_so=&quot;$additional_libdir/lib$name.$shlibext&quot;
+              if test -f &quot;$additional_libdir/lib$name.la&quot;; then
+                found_la=&quot;$additional_libdir/lib$name.la&quot;
+              fi
+            else
+              if test -f &quot;$additional_libdir/lib$name.$libext&quot;; then
+                found_dir=&quot;$additional_libdir&quot;
+                found_a=&quot;$additional_libdir/lib$name.$libext&quot;
+                if test -f &quot;$additional_libdir/lib$name.la&quot;; then
+                  found_la=&quot;$additional_libdir/lib$name.la&quot;
+                fi
+              fi
+            fi
+          fi
+          if test &quot;X$found_dir&quot; = &quot;X&quot;; then
+            for x in $LDFLAGS $LTLIB[]NAME; do
+              AC_LIB_WITH_FINAL_PREFIX([eval x=\&quot;$x\&quot;])
+              case &quot;$x&quot; in
+                -L*)
+                  dir=`echo &quot;X$x&quot; | sed -e 's/^X-L//'`
+                  if test -n &quot;$shlibext&quot; &amp;&amp; test -f &quot;$dir/lib$name.$shlibext&quot;; then
+                    found_dir=&quot;$dir&quot;
+                    found_so=&quot;$dir/lib$name.$shlibext&quot;
+                    if test -f &quot;$dir/lib$name.la&quot;; then
+                      found_la=&quot;$dir/lib$name.la&quot;
+                    fi
+                  else
+                    if test -f &quot;$dir/lib$name.$libext&quot;; then
+                      found_dir=&quot;$dir&quot;
+                      found_a=&quot;$dir/lib$name.$libext&quot;
+                      if test -f &quot;$dir/lib$name.la&quot;; then
+                        found_la=&quot;$dir/lib$name.la&quot;
+                      fi
+                    fi
+                  fi
+                  ;;
+              esac
+              if test &quot;X$found_dir&quot; != &quot;X&quot;; then
+                break
+              fi
+            done
+          fi
+          if test &quot;X$found_dir&quot; != &quot;X&quot;; then
+            dnl Found the library.
+            LTLIB[]NAME=&quot;${LTLIB[]NAME}${LTLIB[]NAME:+ }-L$found_dir -l$name&quot;
+            if test &quot;X$found_so&quot; != &quot;X&quot;; then
+              dnl Linking with a shared library. We attempt to hardcode its
+              dnl directory into the executable's runpath, unless it's the
+              dnl standard /usr/lib.
+              if test &quot;$enable_rpath&quot; = no || test &quot;X$found_dir&quot; = &quot;X/usr/lib&quot;; then
+                dnl No hardcoding is needed.
+                LIB[]NAME=&quot;${LIB[]NAME}${LIB[]NAME:+ }$found_so&quot;
+              else
+                dnl Use an explicit option to hardcode DIR into the resulting
+                dnl binary.
+                dnl Potentially add DIR to ltrpathdirs.
+                dnl The ltrpathdirs will be appended to $LTLIBNAME at the end.
+                haveit=
+                for x in $ltrpathdirs; do
+                  if test &quot;X$x&quot; = &quot;X$found_dir&quot;; then
+                    haveit=yes
+                    break
+                  fi
+                done
+                if test -z &quot;$haveit&quot;; then
+                  ltrpathdirs=&quot;$ltrpathdirs $found_dir&quot;
+                fi
+                dnl The hardcoding into $LIBNAME is system dependent.
+                if test &quot;$hardcode_direct&quot; = yes; then
+                  dnl Using DIR/libNAME.so during linking hardcodes DIR into the
+                  dnl resulting binary.
+                  LIB[]NAME=&quot;${LIB[]NAME}${LIB[]NAME:+ }$found_so&quot;
+                else
+                  if test -n &quot;$hardcode_libdir_flag_spec&quot; &amp;&amp; test &quot;$hardcode_minus_L&quot; = no; then
+                    dnl Use an explicit option to hardcode DIR into the resulting
+                    dnl binary.
+                    LIB[]NAME=&quot;${LIB[]NAME}${LIB[]NAME:+ }$found_so&quot;
+                    dnl Potentially add DIR to rpathdirs.
+                    dnl The rpathdirs will be appended to $LIBNAME at the end.
+                    haveit=
+                    for x in $rpathdirs; do
+                      if test &quot;X$x&quot; = &quot;X$found_dir&quot;; then
+                        haveit=yes
+                        break
+                      fi
+                    done
+                    if test -z &quot;$haveit&quot;; then
+                      rpathdirs=&quot;$rpathdirs $found_dir&quot;
+                    fi
+                  else
+                    dnl Rely on &quot;-L$found_dir&quot;.
+                    dnl But don't add it if it's already contained in the LDFLAGS
+                    dnl or the already constructed $LIBNAME
+                    haveit=
+                    for x in $LDFLAGS $LIB[]NAME; do
+                      AC_LIB_WITH_FINAL_PREFIX([eval x=\&quot;$x\&quot;])
+                      if test &quot;X$x&quot; = &quot;X-L$found_dir&quot;; then
+                        haveit=yes
+                        break
+                      fi
+                    done
+                    if test -z &quot;$haveit&quot;; then
+                      LIB[]NAME=&quot;${LIB[]NAME}${LIB[]NAME:+ }-L$found_dir&quot;
+                    fi
+                    if test &quot;$hardcode_minus_L&quot; != no; then
+                      dnl FIXME: Not sure whether we should use
+                      dnl &quot;-L$found_dir -l$name&quot; or &quot;-L$found_dir $found_so&quot;
+                      dnl here.
+                      LIB[]NAME=&quot;${LIB[]NAME}${LIB[]NAME:+ }$found_so&quot;
+                    else
+                      dnl We cannot use $hardcode_runpath_var and LD_RUN_PATH
+                      dnl here, because this doesn't fit in flags passed to the
+                      dnl compiler. So give up. No hardcoding. This affects only
+                      dnl very old systems.
+                      dnl FIXME: Not sure whether we should use
+                      dnl &quot;-L$found_dir -l$name&quot; or &quot;-L$found_dir $found_so&quot;
+                      dnl here.
+                      LIB[]NAME=&quot;${LIB[]NAME}${LIB[]NAME:+ }-l$name&quot;
+                    fi
+                  fi
+                fi
+              fi
+            else
+              if test &quot;X$found_a&quot; != &quot;X&quot;; then
+                dnl Linking with a static library.
+                LIB[]NAME=&quot;${LIB[]NAME}${LIB[]NAME:+ }$found_a&quot;
+              else
+                dnl We shouldn't come here, but anyway it's good to have a
+                dnl fallback.
+                LIB[]NAME=&quot;${LIB[]NAME}${LIB[]NAME:+ }-L$found_dir -l$name&quot;
+              fi
+            fi
+            dnl Assume the include files are nearby.
+            additional_includedir=
+            case &quot;$found_dir&quot; in
+              */lib | */lib/)
+                basedir=`echo &quot;X$found_dir&quot; | sed -e 's,^X,,' -e 's,/lib/*$,,'`
+                additional_includedir=&quot;$basedir/include&quot;
+                ;;
+            esac
+            if test &quot;X$additional_includedir&quot; != &quot;X&quot;; then
+              dnl Potentially add $additional_includedir to $INCNAME.
+              dnl But don't add it
+              dnl   1. if it's the standard /usr/include,
+              dnl   2. if it's /usr/local/include and we are using GCC on Linux,
+              dnl   3. if it's already present in $CPPFLAGS or the already
+              dnl      constructed $INCNAME,
+              dnl   4. if it doesn't exist as a directory.
+              if test &quot;X$additional_includedir&quot; != &quot;X/usr/include&quot;; then
+                haveit=
+                if test &quot;X$additional_includedir&quot; = &quot;X/usr/local/include&quot;; then
+                  if test -n &quot;$GCC&quot;; then
+                    case $host_os in
+                      linux* | gnu* | k*bsd*-gnu) haveit=yes;;
+                    esac
+                  fi
+                fi
+                if test -z &quot;$haveit&quot;; then
+                  for x in $CPPFLAGS $INC[]NAME; do
+                    AC_LIB_WITH_FINAL_PREFIX([eval x=\&quot;$x\&quot;])
+                    if test &quot;X$x&quot; = &quot;X-I$additional_includedir&quot;; then
+                      haveit=yes
+                      break
+                    fi
+                  done
+                  if test -z &quot;$haveit&quot;; then
+                    if test -d &quot;$additional_includedir&quot;; then
+                      dnl Really add $additional_includedir to $INCNAME.
+                      INC[]NAME=&quot;${INC[]NAME}${INC[]NAME:+ }-I$additional_includedir&quot;
+                    fi
+                  fi
+                fi
+              fi
+            fi
+            dnl Look for dependencies.
+            if test -n &quot;$found_la&quot;; then
+              dnl Read the .la file. It defines the variables
+              dnl dlname, library_names, old_library, dependency_libs, current,
+              dnl age, revision, installed, dlopen, dlpreopen, libdir.
+              save_libdir=&quot;$libdir&quot;
+              case &quot;$found_la&quot; in
+                */* | *\\*) . &quot;$found_la&quot; ;;
+                *) . &quot;./$found_la&quot; ;;
+              esac
+              libdir=&quot;$save_libdir&quot;
+              dnl We use only dependency_libs.
+              for dep in $dependency_libs; do
+                case &quot;$dep&quot; in
+                  -L*)
+                    additional_libdir=`echo &quot;X$dep&quot; | sed -e 's/^X-L//'`
+                    dnl Potentially add $additional_libdir to $LIBNAME and $LTLIBNAME.
+                    dnl But don't add it
+                    dnl   1. if it's the standard /usr/lib,
+                    dnl   2. if it's /usr/local/lib and we are using GCC on Linux,
+                    dnl   3. if it's already present in $LDFLAGS or the already
+                    dnl      constructed $LIBNAME,
+                    dnl   4. if it doesn't exist as a directory.
+                    if test &quot;X$additional_libdir&quot; != &quot;X/usr/lib&quot;; then
+                      haveit=
+                      if test &quot;X$additional_libdir&quot; = &quot;X/usr/local/lib&quot;; then
+                        if test -n &quot;$GCC&quot;; then
+                          case $host_os in
+                            linux* | gnu* | k*bsd*-gnu) haveit=yes;;
+                          esac
+                        fi
+                      fi
+                      if test -z &quot;$haveit&quot;; then
+                        haveit=
+                        for x in $LDFLAGS $LIB[]NAME; do
+                          AC_LIB_WITH_FINAL_PREFIX([eval x=\&quot;$x\&quot;])
+                          if test &quot;X$x&quot; = &quot;X-L$additional_libdir&quot;; then
+                            haveit=yes
+                            break
+                          fi
+                        done
+                        if test -z &quot;$haveit&quot;; then
+                          if test -d &quot;$additional_libdir&quot;; then
+                            dnl Really add $additional_libdir to $LIBNAME.
+                            LIB[]NAME=&quot;${LIB[]NAME}${LIB[]NAME:+ }-L$additional_libdir&quot;
+                          fi
+                        fi
+                        haveit=
+                        for x in $LDFLAGS $LTLIB[]NAME; do
+                          AC_LIB_WITH_FINAL_PREFIX([eval x=\&quot;$x\&quot;])
+                          if test &quot;X$x&quot; = &quot;X-L$additional_libdir&quot;; then
+                            haveit=yes
+                            break
+                          fi
+                        done
+                        if test -z &quot;$haveit&quot;; then
+                          if test -d &quot;$additional_libdir&quot;; then
+                            dnl Really add $additional_libdir to $LTLIBNAME.
+                            LTLIB[]NAME=&quot;${LTLIB[]NAME}${LTLIB[]NAME:+ }-L$additional_libdir&quot;
+                          fi
+                        fi
+                      fi
+                    fi
+                    ;;
+                  -R*)
+                    dir=`echo &quot;X$dep&quot; | sed -e 's/^X-R//'`
+                    if test &quot;$enable_rpath&quot; != no; then
+                      dnl Potentially add DIR to rpathdirs.
+                      dnl The rpathdirs will be appended to $LIBNAME at the end.
+                      haveit=
+                      for x in $rpathdirs; do
+                        if test &quot;X$x&quot; = &quot;X$dir&quot;; then
+                          haveit=yes
+                          break
+                        fi
+                      done
+                      if test -z &quot;$haveit&quot;; then
+                        rpathdirs=&quot;$rpathdirs $dir&quot;
+                      fi
+                      dnl Potentially add DIR to ltrpathdirs.
+                      dnl The ltrpathdirs will be appended to $LTLIBNAME at the end.
+                      haveit=
+                      for x in $ltrpathdirs; do
+                        if test &quot;X$x&quot; = &quot;X$dir&quot;; then
+                          haveit=yes
+                          break
+                        fi
+                      done
+                      if test -z &quot;$haveit&quot;; then
+                        ltrpathdirs=&quot;$ltrpathdirs $dir&quot;
+                      fi
+                    fi
+                    ;;
+                  -l*)
+                    dnl Handle this in the next round.
+                    names_next_round=&quot;$names_next_round &quot;`echo &quot;X$dep&quot; | sed -e 's/^X-l//'`
+                    ;;
+                  *.la)
+                    dnl Handle this in the next round. Throw away the .la's
+                    dnl directory; it is already contained in a preceding -L
+                    dnl option.
+                    names_next_round=&quot;$names_next_round &quot;`echo &quot;X$dep&quot; | sed -e 's,^X.*/,,' -e 's,^lib,,' -e 's,\.la$,,'`
+                    ;;
+                  *)
+                    dnl Most likely an immediate library name.
+                    LIB[]NAME=&quot;${LIB[]NAME}${LIB[]NAME:+ }$dep&quot;
+                    LTLIB[]NAME=&quot;${LTLIB[]NAME}${LTLIB[]NAME:+ }$dep&quot;
+                    ;;
+                esac
+              done
+            fi
+          else
+            dnl Didn't find the library; assume it is in the system directories
+            dnl known to the linker and runtime loader. (All the system
+            dnl directories known to the linker should also be known to the
+            dnl runtime loader, otherwise the system is severely misconfigured.)
+            LIB[]NAME=&quot;${LIB[]NAME}${LIB[]NAME:+ }-l$name&quot;
+            LTLIB[]NAME=&quot;${LTLIB[]NAME}${LTLIB[]NAME:+ }-l$name&quot;
+          fi
+        fi
+      fi
+    done
+  done
+  if test &quot;X$rpathdirs&quot; != &quot;X&quot;; then
+    if test -n &quot;$hardcode_libdir_separator&quot;; then
+      dnl Weird platform: only the last -rpath option counts, the user must
+      dnl pass all path elements in one option. We can arrange that for a
+      dnl single library, but not when more than one $LIBNAMEs are used.
+      alldirs=
+      for found_dir in $rpathdirs; do
+        alldirs=&quot;${alldirs}${alldirs:+$hardcode_libdir_separator}$found_dir&quot;
+      done
+      dnl Note: hardcode_libdir_flag_spec uses $libdir and $wl.
+      acl_save_libdir=&quot;$libdir&quot;
+      libdir=&quot;$alldirs&quot;
+      eval flag=\&quot;$hardcode_libdir_flag_spec\&quot;
+      libdir=&quot;$acl_save_libdir&quot;
+      LIB[]NAME=&quot;${LIB[]NAME}${LIB[]NAME:+ }$flag&quot;
+    else
+      dnl The -rpath options are cumulative.
+      for found_dir in $rpathdirs; do
+        acl_save_libdir=&quot;$libdir&quot;
+        libdir=&quot;$found_dir&quot;
+        eval flag=\&quot;$hardcode_libdir_flag_spec\&quot;
+        libdir=&quot;$acl_save_libdir&quot;
+        LIB[]NAME=&quot;${LIB[]NAME}${LIB[]NAME:+ }$flag&quot;
+      done
+    fi
+  fi
+  if test &quot;X$ltrpathdirs&quot; != &quot;X&quot;; then
+    dnl When using libtool, the option that works for both libraries and
+    dnl executables is -R. The -R options are cumulative.
+    for found_dir in $ltrpathdirs; do
+      LTLIB[]NAME=&quot;${LTLIB[]NAME}${LTLIB[]NAME:+ }-R$found_dir&quot;
+    done
+  fi
+])
+
+dnl AC_LIB_APPENDTOVAR(VAR, CONTENTS) appends the elements of CONTENTS to VAR,
+dnl unless already present in VAR.
+dnl Works only for CPPFLAGS, not for LIB* variables because that sometimes
+dnl contains two or three consecutive elements that belong together.
+AC_DEFUN([AC_LIB_APPENDTOVAR],
+[
+  for element in [$2]; do
+    haveit=
+    for x in $[$1]; do
+      AC_LIB_WITH_FINAL_PREFIX([eval x=\&quot;$x\&quot;])
+      if test &quot;X$x&quot; = &quot;X$element&quot;; then
+        haveit=yes
+        break
+      fi
+    done
+    if test -z &quot;$haveit&quot;; then
+      [$1]=&quot;${[$1]}${[$1]:+ }$element&quot;
+    fi
+  done
+])
+
+# lib-ld.m4 serial 3 (gettext-0.13)
+dnl Copyright (C) 1996-2003 Free Software Foundation, Inc.
+dnl This file is free software; the Free Software Foundation
+dnl gives unlimited permission to copy and/or distribute it,
+dnl with or without modifications, as long as this notice is preserved.
+
+dnl Subroutines of libtool.m4,
+dnl with replacements s/AC_/AC_LIB/ and s/lt_cv/acl_cv/ to avoid collision
+dnl with libtool.m4.
+
+dnl From libtool-1.4. Sets the variable with_gnu_ld to yes or no.
+AC_DEFUN([AC_LIB_PROG_LD_GNU],
+[AC_CACHE_CHECK([if the linker ($LD) is GNU ld], acl_cv_prog_gnu_ld,
+[# I'd rather use --version here, but apparently some GNU ld's only accept -v.
+case `$LD -v 2&gt;&amp;1 &lt;/dev/null` in
+*GNU* | *'with BFD'*)
+  acl_cv_prog_gnu_ld=yes ;;
+*)
+  acl_cv_prog_gnu_ld=no ;;
+esac])
+with_gnu_ld=$acl_cv_prog_gnu_ld
+])
+
+dnl From libtool-1.4. Sets the variable LD.
+AC_DEFUN([AC_LIB_PROG_LD],
+[AC_ARG_WITH(gnu-ld,
+[  --with-gnu-ld           assume the C compiler uses GNU ld [default=no]],
+test &quot;$withval&quot; = no || with_gnu_ld=yes, with_gnu_ld=no)
+AC_REQUIRE([AC_PROG_CC])dnl
+AC_REQUIRE([AC_CANONICAL_HOST])dnl
+# Prepare PATH_SEPARATOR.
+# The user is always right.
+if test &quot;${PATH_SEPARATOR+set}&quot; != set; then
+  echo &quot;#! /bin/sh&quot; &gt;conf$$.sh
+  echo  &quot;exit 0&quot;   &gt;&gt;conf$$.sh
+  chmod +x conf$$.sh
+  if (PATH=&quot;/nonexistent;.&quot;; conf$$.sh) &gt;/dev/null 2&gt;&amp;1; then
+    PATH_SEPARATOR=';'
+  else
+    PATH_SEPARATOR=:
+  fi
+  rm -f conf$$.sh
+fi
+ac_prog=ld
+if test &quot;$GCC&quot; = yes; then
+  # Check if gcc -print-prog-name=ld gives a path.
+  AC_MSG_CHECKING([for ld used by GCC])
+  case $host in
+  *-*-mingw*)
+    # gcc leaves a trailing carriage return which upsets mingw
+    ac_prog=`($CC -print-prog-name=ld) 2&gt;&amp;5 | tr -d '\015'` ;;
+  *)
+    ac_prog=`($CC -print-prog-name=ld) 2&gt;&amp;5` ;;
+  esac
+  case $ac_prog in
+    # Accept absolute paths.
+    [[\\/]* | [A-Za-z]:[\\/]*)]
+      [re_direlt='/[^/][^/]*/\.\./']
+      # Canonicalize the path of ld
+      ac_prog=`echo $ac_prog| sed 's%\\\\%/%g'`
+      while echo $ac_prog | grep &quot;$re_direlt&quot; &gt; /dev/null 2&gt;&amp;1; do
+	ac_prog=`echo $ac_prog| sed &quot;s%$re_direlt%/%&quot;`
+      done
+      test -z &quot;$LD&quot; &amp;&amp; LD=&quot;$ac_prog&quot;
+      ;;
+  &quot;&quot;)
+    # If it fails, then pretend we aren't using GCC.
+    ac_prog=ld
+    ;;
+  *)
+    # If it is relative, then search for the first ld in PATH.
+    with_gnu_ld=unknown
+    ;;
+  esac
+elif test &quot;$with_gnu_ld&quot; = yes; then
+  AC_MSG_CHECKING([for GNU ld])
+else
+  AC_MSG_CHECKING([for non-GNU ld])
+fi
+AC_CACHE_VAL(acl_cv_path_LD,
+[if test -z &quot;$LD&quot;; then
+  IFS=&quot;${IFS= 	}&quot;; ac_save_ifs=&quot;$IFS&quot;; IFS=&quot;${IFS}${PATH_SEPARATOR-:}&quot;
+  for ac_dir in $PATH; do
+    test -z &quot;$ac_dir&quot; &amp;&amp; ac_dir=.
+    if test -f &quot;$ac_dir/$ac_prog&quot; || test -f &quot;$ac_dir/$ac_prog$ac_exeext&quot;; then
+      acl_cv_path_LD=&quot;$ac_dir/$ac_prog&quot;
+      # Check to see if the program is GNU ld.  I'd rather use --version,
+      # but apparently some GNU ld's only accept -v.
+      # Break only if it was the GNU/non-GNU ld that we prefer.
+      case `&quot;$acl_cv_path_LD&quot; -v 2&gt;&amp;1 &lt; /dev/null` in
+      *GNU* | *'with BFD'*)
+	test &quot;$with_gnu_ld&quot; != no &amp;&amp; break ;;
+      *)
+	test &quot;$with_gnu_ld&quot; != yes &amp;&amp; break ;;
+      esac
+    fi
+  done
+  IFS=&quot;$ac_save_ifs&quot;
+else
+  acl_cv_path_LD=&quot;$LD&quot; # Let the user override the test with a path.
+fi])
+LD=&quot;$acl_cv_path_LD&quot;
+if test -n &quot;$LD&quot;; then
+  AC_MSG_RESULT($LD)
+else
+  AC_MSG_RESULT(no)
+fi
+test -z &quot;$LD&quot; &amp;&amp; AC_MSG_ERROR([no acceptable ld found in \$PATH])
+AC_LIB_PROG_LD_GNU
+])
+

Modified: trunk/app.c
===================================================================
--- trunk/app.c	2006-05-25 20:48:20 UTC (rev 180)
+++ trunk/app.c	2006-05-26 21:12:24 UTC (rev 181)
@@ -549,8 +549,7 @@
 		sfmt[fmtcnt++] = ast_strdupa(fmt);
 	}
 
-	time(&amp;start);
-	end = start;  /* pre-initialize end to be same as start in case we never get into loop */
+	end = start = time(NULL);  /* pre-initialize end to be same as start in case we never get into loop */
 	for (x = 0; x &lt; fmtcnt; x++) {
 		others[x] = ast_writefile(prepend ? prependfile : recordfile, sfmt[x], comment, O_TRUNC, 0, 0700);
 		if (option_verbose &gt; 2)
@@ -670,7 +669,7 @@
 				}
 			}
 			if (maxtime) {
-				time(&amp;end);
+				end = time(NULL);
 				if (maxtime &lt; (end - start)) {
 					if (option_verbose &gt; 2)
 						ast_verbose(VERBOSE_PREFIX_3 &quot;Took too long, cutting it short...\n&quot;);
@@ -689,7 +688,8 @@
 		} else {
 			ast_frfree(f);
 		}
-		if (end == start) time(&amp;end);
+		if (end == start)
+			end = time(NULL);
 	} else {
 		ast_log(LOG_WARNING, &quot;Error creating writestream '%s', format '%s'\n&quot;, recordfile, sfmt[x]);
 	}
@@ -931,7 +931,7 @@
 	close(fd);
 
 	snprintf(s, strlen(path) + 9, &quot;%s/.lock&quot;, path);
-	time(&amp;start);
+	start = time(NULL);
 	while (((res = link(fs, s)) &lt; 0) &amp;&amp; (errno == EEXIST) &amp;&amp; (time(NULL) - start &lt; 5))
 		usleep(1);
 	if (res) {

Modified: trunk/apps/app_db.c
===================================================================
--- trunk/apps/app_db.c	2006-05-25 20:48:20 UTC (rev 180)
+++ trunk/apps/app_db.c	2006-05-26 21:12:24 UTC (rev 181)
@@ -48,9 +48,11 @@
 #include &quot;asterisk/lock.h&quot;
 #include &quot;asterisk/options.h&quot;
 
+/*! \todo XXX Remove this application after 1.4 is relased */
 static char *d_descrip =
 &quot;  DBdel(family/key): This applicaiton will delete a key from the Asterisk\n&quot;
-&quot;database.\n&quot;;
+&quot;database.\n&quot;
+&quot;  This application has been DEPRECATED in favor of the DB_DELETE function.\n&quot;;
 
 static char *dt_descrip =
 &quot;  DBdeltree(family[/keytree]): This application will delete a family or keytree\n&quot;
@@ -109,9 +111,15 @@
 {
 	char *argv, *family, *key;
 	struct localuser *u;
+	static int deprecation_warning = 0;
 
 	LOCAL_USER_ADD(u);
 
+	if (!deprecation_warning) {
+		deprecation_warning = 1;
+		ast_log(LOG_WARNING, &quot;The DBdel application has been deprecated in favor of the DB_DELETE dialplan function!\n&quot;);
+	}
+
 	argv = ast_strdupa(data);
 
 	if (strchr(argv, '/')) {

Modified: trunk/apps/app_dial.c
===================================================================
--- trunk/apps/app_dial.c	2006-05-25 20:48:20 UTC (rev 180)
+++ trunk/apps/app_dial.c	2006-05-26 21:12:24 UTC (rev 181)
@@ -183,7 +183,11 @@
 &quot;    w    - Allow the called party to enable recording of the call by sending\n&quot;
 &quot;           the DTMF sequence defined for one-touch recording in features.conf.\n&quot;
 &quot;    W    - Allow the calling party to enable recording of the call by sending\n&quot;
-&quot;           the DTMF sequence defined for one-touch recording in features.conf.\n&quot;;
+&quot;           the DTMF sequence defined for one-touch recording in features.conf.\n&quot;
+&quot;    k    - Allow the called party to enable parking of the call by sending\n&quot;
+&quot;           the DTMF sequence defined for call parking in features.conf.\n&quot;
+&quot;    K    - Allow the calling party to enable parking of the call by sending\n&quot;
+&quot;           the DTMF sequence defined for call parking in features.conf.\n&quot;;
 
 /* RetryDial App by Anthony Minessale II &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/solid-pbx-svn">anthmct at yahoo.com</A>&gt; Jan/2005 */
 static char *rapp = &quot;RetryDial&quot;;
@@ -227,6 +231,8 @@
 	OPT_CALLER_MONITOR =	(1 &lt;&lt; 22),
 	OPT_GOTO =		(1 &lt;&lt; 23),
 	OPT_OPERMODE = 		(1 &lt;&lt; 24),
+	OPT_CALLEE_PARK =	(1 &lt;&lt; 25),
+	OPT_CALLER_PARK =	(1 &lt;&lt; 26),
 } dial_exec_option_flags;
 
 #define DIAL_STILLGOING			(1 &lt;&lt; 30)
@@ -272,6 +278,8 @@
 	AST_APP_OPTION('T', OPT_CALLER_TRANSFER),
 	AST_APP_OPTION('w', OPT_CALLEE_MONITOR),
 	AST_APP_OPTION('W', OPT_CALLER_MONITOR),
+	AST_APP_OPTION('k', OPT_CALLEE_PARK),
+	AST_APP_OPTION('K', OPT_CALLER_PARK),
 });
 
 /* We define a custom &quot;local user&quot; structure because we
@@ -441,6 +449,7 @@
 						       OPT_CALLEE_TRANSFER | OPT_CALLER_TRANSFER |
 						       OPT_CALLEE_HANGUP | OPT_CALLER_HANGUP |
 						       OPT_CALLEE_MONITOR | OPT_CALLER_MONITOR |
+						       OPT_CALLEE_PARK | OPT_CALLER_PARK |
 						       DIAL_NOFORWARDHTML);
 				}
 				continue;
@@ -551,6 +560,7 @@
 							       OPT_CALLEE_TRANSFER | OPT_CALLER_TRANSFER |
 							       OPT_CALLEE_HANGUP | OPT_CALLER_HANGUP |
 							       OPT_CALLEE_MONITOR | OPT_CALLER_MONITOR |
+							       OPT_CALLEE_PARK | OPT_CALLER_PARK |
 							       DIAL_NOFORWARDHTML);
 						/* Setup early media if appropriate */
 						ast_rtp_early_media(in, peer);
@@ -949,21 +959,27 @@
 		}
 		
 		if(privdb_val == AST_PRIVACY_DENY ) {
+			ast_copy_string(status, &quot;NOANSWER&quot;, sizeof(status));
 			if (option_verbose &gt; 2)
 				ast_verbose( VERBOSE_PREFIX_3  &quot;Privacy DB reports PRIVACY_DENY for this callerid. Dial reports unavailable\n&quot;);
 			res=0;
 			goto out;
 		}
 		else if(privdb_val == AST_PRIVACY_KILL ) {
-			ast_goto_if_exists(chan, chan-&gt;context, chan-&gt;exten, chan-&gt;priority + 201);
+			ast_copy_string(status, &quot;DONTCALL&quot;, sizeof(status));
+			if (ast_opt_priority_jumping || ast_test_flag(&amp;opts, OPT_PRIORITY_JUMP)) {
+				ast_goto_if_exists(chan, chan-&gt;context, chan-&gt;exten, chan-&gt;priority + 201);
+			}
 			res = 0;
 			goto out; /* Is this right? */
 		}
 		else if(privdb_val == AST_PRIVACY_TORTURE ) {
-			ast_goto_if_exists(chan, chan-&gt;context, chan-&gt;exten, chan-&gt;priority + 301);
+			ast_copy_string(status, &quot;TORTURE&quot;, sizeof(status));
+			if (ast_opt_priority_jumping || ast_test_flag(&amp;opts, OPT_PRIORITY_JUMP)) {
+				ast_goto_if_exists(chan, chan-&gt;context, chan-&gt;exten, chan-&gt;priority + 301);
+			}
 			res = 0;
 			goto out; /* is this right??? */
-
 		}
 		else if(privdb_val == AST_PRIVACY_UNKNOWN ) {
 			/* Get the user's intro, store it in priv-callerintros/$CID, 
@@ -990,6 +1006,8 @@
 				ast_play_and_record(chan, &quot;priv-recordintro&quot;, privintro, 4, &quot;gsm&quot;, &amp;duration, 128, 2000, 0);  /* NOTE: I've reduced the total time to 4 sec */
 										/* don't think we'll need a lock removed, we took care of
 										   conflicts by naming the privintro file */
+				if( !ast_streamfile(chan, &quot;vm-dialout&quot;, chan-&gt;language) )
+					ast_waitstream(chan, &quot;&quot;);
 			}
 		}
 	}
@@ -1016,6 +1034,7 @@
 				       OPT_CALLEE_TRANSFER | OPT_CALLER_TRANSFER |
 				       OPT_CALLEE_HANGUP | OPT_CALLER_HANGUP |
 				       OPT_CALLEE_MONITOR | OPT_CALLER_MONITOR |
+				       OPT_CALLEE_PARK | OPT_CALLER_PARK |
 				       OPT_RINGBACK | OPT_MUSICBACK | OPT_FORCECLID);
 			ast_set2_flag(tmp, args.url, DIAL_NOFORWARDHTML);	
 		}
@@ -1301,6 +1320,7 @@
 							     opt_args[OPT_ARG_PRIVACY], privcid);
 					ast_privacy_set(opt_args[OPT_ARG_PRIVACY], privcid, AST_PRIVACY_DENY);
 				}
+				ast_copy_string(status, &quot;NOANSWER&quot;, sizeof(status));
 				ast_hangup(peer); /* hang up on the callee -- he didn't want to talk anyway! */
 				res=0;
 				goto out;
@@ -1497,6 +1517,10 @@
 				ast_set_flag(&amp;(config.features_callee), AST_FEATURE_AUTOMON);
 			if (ast_test_flag(peerflags, OPT_CALLER_MONITOR)) 
 				ast_set_flag(&amp;(config.features_caller), AST_FEATURE_AUTOMON);
+			if (ast_test_flag(peerflags, OPT_CALLEE_PARK))
+				ast_set_flag(&amp;(config.features_callee), AST_FEATURE_PARKCALL);
+			if (ast_test_flag(peerflags, OPT_CALLER_PARK))
+				ast_set_flag(&amp;(config.features_caller), AST_FEATURE_PARKCALL);
 
 			config.timelimit = timelimit;
 			config.play_warning = play_warning;

Modified: trunk/apps/app_directed_pickup.c
===================================================================
--- trunk/apps/app_directed_pickup.c	2006-05-25 20:48:20 UTC (rev 180)
+++ trunk/apps/app_directed_pickup.c	2006-05-26 21:12:24 UTC (rev 181)
@@ -20,7 +20,7 @@
  *
  * \brief Directed Call Pickup Support
  *
- * \author Joshua Colp &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/solid-pbx-svn">jcolp at asterlink.com</A>&gt;
+ * \author Joshua Colp &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/solid-pbx-svn">jcolp at digium.com</A>&gt;
  *
  * \ingroup applications
  */
@@ -42,12 +42,16 @@
 #include &quot;asterisk/lock.h&quot;
 #include &quot;asterisk/app.h&quot;
 
+#define PICKUPMARK &quot;PICKUPMARK&quot;
+
 static const char *app = &quot;Pickup&quot;;
 static const char *synopsis = &quot;Directed Call Pickup&quot;;
 static const char *descrip =
 &quot;  Pickup(extension[@context][&amp;<A HREF="https://lists.berlios.de/mailman/listinfo/solid-pbx-svn">extension2 at context...</A>]): This application can pickup any ringing channel\n&quot;
 &quot;that is calling the specified extension. If no context is specified, the current\n&quot;
-&quot;context will be used.\n&quot;;
+&quot;context will be used. If you use the special string \&quot;PICKUPMARK\&quot; for the context parameter, for example\n&quot;
+&quot;<A HREF="https://lists.berlios.de/mailman/listinfo/solid-pbx-svn">10 at PICKUPMARK</A>, this application tries to find a channel which has defined a channel variable with the same context\n&quot;
+&quot;as \&quot;extension\&quot;.&quot;;
 
 LOCAL_USER_DECL;
 
@@ -58,6 +62,7 @@
 	struct ast_channel *origin = NULL, *target = NULL;
 	char *tmp = NULL, *exten = NULL, *context = NULL, *rest=data;
 	char workspace[256] = &quot;&quot;;
+	const char *tmp2 = NULL;
 
 	if (ast_strlen_zero(data)) {
 		ast_log(LOG_WARNING, &quot;Pickup requires an argument (extension) !\n&quot;);
@@ -77,8 +82,21 @@
 		if (context)
 			*context++ = '\0';
 
-		/* Find a channel to pickup */
-		origin = ast_get_channel_by_exten_locked(exten, context);
+		/* If the context is the pickup mark, iterate through all channels finding the right origin one */
+		if (!strcmp(context, PICKUPMARK)) {
+			while ((origin = ast_channel_walk_locked(origin))) {
+				if (origin) {
+					tmp2 = pbx_builtin_getvar_helper(origin, PICKUPMARK);
+					if (tmp2 &amp;&amp; !strcmp(tmp2, exten))
+						break;
+					ast_mutex_unlock(&amp;origin-&gt;lock);
+				}
+			}
+		} else {
+			/* Use the classic mode of searching */
+			origin = ast_get_channel_by_exten_locked(exten, context);
+		}
+
 		if (origin) {
 			ast_cdr_getvar(origin-&gt;cdr, &quot;dstchannel&quot;, &amp;tmp, workspace,
 					sizeof(workspace), 0, 0);

Modified: trunk/apps/app_echo.c
===================================================================
--- trunk/apps/app_echo.c	2006-05-25 20:48:20 UTC (rev 180)
+++ trunk/apps/app_echo.c	2006-05-26 21:12:24 UTC (rev 181)
@@ -72,26 +72,30 @@
 			break;
 		f-&gt;delivery.tv_sec = 0;
 		f-&gt;delivery.tv_usec = 0;
-		if (f-&gt;frametype == AST_FRAME_VOICE) {
-			if (ast_write(chan, f)) 
-				break;
-		} else if (f-&gt;frametype == AST_FRAME_VIDEO) {
-			if (ast_write(chan, f)) 
-				break;
-		} else if (f-&gt;frametype == AST_FRAME_DTMF) {
+		switch (f-&gt;frametype) {
+		case AST_FRAME_DTMF:
+		case AST_FRAME_DTMF_END:
 			if (f-&gt;subclass == '#') {
 				res = 0;
-				break;
-			} else {
-				if (ast_write(chan, f))
-					break;
+				ast_frfree(f);
+				goto end;
 			}
+			/* fall through */
+		case AST_FRAME_DTMF_BEGIN:
+		case AST_FRAME_VOICE:
+		case AST_FRAME_VIDEO:
+		case AST_FRAME_TEXT:
+		case AST_FRAME_HTML:
+		case AST_FRAME_IMAGE:
+			if (ast_write(chan, f)) {
+				ast_frfree(f);
+				goto end;
+			}
 		}
 		ast_frfree(f);
 	}
-
+end:
 	LOCAL_USER_REMOVE(u);
-
 	return res;
 }
 

Modified: trunk/apps/app_lookupblacklist.c
===================================================================
--- trunk/apps/app_lookupblacklist.c	2006-05-25 20:48:20 UTC (rev 180)
+++ trunk/apps/app_lookupblacklist.c	2006-05-26 21:12:24 UTC (rev 181)
@@ -65,6 +65,32 @@
 
 LOCAL_USER_DECL;
 
+static int blacklist_read(struct ast_channel *chan, char *cmd, char *data, char *buf, size_t len)
+{
+	char blacklist[1];
+	int bl = 0;
+
+	if (chan-&gt;cid.cid_num) {
+		if (!ast_db_get(&quot;blacklist&quot;, chan-&gt;cid.cid_num, blacklist, sizeof (blacklist)))
+			bl = 1;
+	}
+	if (chan-&gt;cid.cid_name) {
+		if (!ast_db_get(&quot;blacklist&quot;, chan-&gt;cid.cid_name, blacklist, sizeof (blacklist)))
+			bl = 1;
+	}
+
+	snprintf(buf, len, &quot;%d&quot;, bl);
+	return 0;
+}
+
+static struct ast_custom_function blacklist_function = {
+	.name = &quot;BLACKLIST&quot;,
+	.synopsis = &quot;Check if the callerid is on the blacklist&quot;,
+	.desc = &quot;Uses astdb to check if the Caller*ID is in family 'blacklist'.  Returns 1 or 0.\n&quot;,
+	.syntax = &quot;BLACKLIST()&quot;,
+	.read = blacklist_read,
+};
+
 static int
 lookupblacklist_exec (struct ast_channel *chan, void *data)
 {
@@ -72,9 +98,15 @@
 	struct localuser *u;
 	int bl = 0;
 	int priority_jump = 0;
+	static int dep_warning = 0;
 
 	LOCAL_USER_ADD(u);
 
+	if (!dep_warning) {
+		dep_warning = 1;
+		ast_log(LOG_WARNING, &quot;LookupBlacklist is deprecated.  Please use ${BLACKLIST()} instead.\n&quot;);
+	}
+
 	if (!ast_strlen_zero(data)) {
 		if (strchr(data, 'j'))
 			priority_jump = 1;
@@ -112,6 +144,7 @@
 	int res;
 
 	res = ast_unregister_application(app);
+	res |= ast_custom_function_unregister(&amp;blacklist_function);
 
 	STANDARD_HANGUP_LOCALUSERS;
 
@@ -120,7 +153,9 @@
 
 static int load_module(void *mod)
 {
-	return ast_register_application (app, lookupblacklist_exec, synopsis,descrip);
+	int res = ast_custom_function_register(&amp;blacklist_function);
+	res |= ast_register_application (app, lookupblacklist_exec, synopsis,descrip);
+	return res;
 }
 
 static const char *description(void)

Modified: trunk/apps/app_lookupcidname.c
===================================================================
--- trunk/apps/app_lookupcidname.c	2006-05-25 20:48:20 UTC (rev 180)
+++ trunk/apps/app_lookupcidname.c	2006-05-26 21:12:24 UTC (rev 181)
@@ -66,8 +66,13 @@
 {
   char dbname[64];
   struct localuser *u;
+	static int dep_warning = 0;
 
   LOCAL_USER_ADD (u);
+	if (!dep_warning) {
+		dep_warning = 1;
+		ast_log(LOG_WARNING, &quot;LookupCIDName is deprecated.  Please use ${DB(cidname/${CALLERID(num)})} instead.\n&quot;);
+	}
   if (chan-&gt;cid.cid_num) {
 	if (!ast_db_get (&quot;cidname&quot;, chan-&gt;cid.cid_num, dbname, sizeof (dbname))) {
 		ast_set_callerid (chan, NULL, dbname, NULL);

Modified: trunk/apps/app_meetme.c
===================================================================
--- trunk/apps/app_meetme.c	2006-05-25 20:48:20 UTC (rev 180)
+++ trunk/apps/app_meetme.c	2006-05-26 21:12:24 UTC (rev 181)
@@ -63,7 +63,125 @@
 #include &quot;asterisk/translate.h&quot;
 #include &quot;asterisk/ulaw.h&quot;
 
+#include &quot;enter.h&quot;
+#include &quot;leave.h&quot;
 
+LOCAL_USER_DECL;
+
+#define CONFIG_FILE_NAME &quot;meetme.conf&quot;
+
+/*! each buffer is 20ms, so this is 640ms total */
+#define DEFAULT_AUDIO_BUFFERS  32
+
+enum {
+	ADMINFLAG_MUTED =     (1 &lt;&lt; 1), /*!&lt; User is muted */
+	ADMINFLAG_SELFMUTED = (1 &lt;&lt; 2), /*!&lt; User muted self */
+	ADMINFLAG_KICKME =    (1 &lt;&lt; 3)  /*!&lt; User has been kicked */
+};
+
+#define MEETME_DELAYDETECTTALK     300
+#define MEETME_DELAYDETECTENDTALK  1000
+
+#define AST_FRAME_BITS  32
+
+enum volume_action {
+	VOL_UP,
+	VOL_DOWN
+};
+
+enum entrance_sound {
+	ENTER,
+	LEAVE
+};
+
+enum recording_state {
+	MEETME_RECORD_OFF,
+	MEETME_RECORD_STARTED,
+	MEETME_RECORD_ACTIVE,
+	MEETME_RECORD_TERMINATE
+};
+
+#define CONF_SIZE  320
+
+enum {
+	/*! user has admin access on the conference */
+	CONFFLAG_ADMIN = (1 &lt;&lt; 0),
+	/*! If set the user can only receive audio from the conference */
+	CONFFLAG_MONITOR = (1 &lt;&lt; 1),
+	/*! If set asterisk will exit conference when '#' is pressed */
+	CONFFLAG_POUNDEXIT = (1 &lt;&lt; 2),
+	/*! If set asterisk will provide a menu to the user when '*' is pressed */
+	CONFFLAG_STARMENU = (1 &lt;&lt; 3),
+	/*! If set the use can only send audio to the conference */
+	CONFFLAG_TALKER = (1 &lt;&lt; 4),
+	/*! If set there will be no enter or leave sounds */
+	CONFFLAG_QUIET = (1 &lt;&lt; 5),
+	/*! If set, when user joins the conference, they will be told the number 
+	 *  of users that are already in */
+	CONFFLAG_ANNOUNCEUSERCOUNT = (1 &lt;&lt; 6),
+	/*! Set to run AGI Script in Background */
+	CONFFLAG_AGI = (1 &lt;&lt; 7),
+	/*! Set to have music on hold when user is alone in conference */
+	CONFFLAG_MOH = (1 &lt;&lt; 8),
+	/*! If set the MeetMe will return if all marked with this flag left */
+	CONFFLAG_MARKEDEXIT = (1 &lt;&lt; 9),
+	/*! If set, the MeetMe will wait until a marked user enters */
+	CONFFLAG_WAITMARKED = (1 &lt;&lt; 10),
+	/*! If set, the MeetMe will exit to the specified context */
+	CONFFLAG_EXIT_CONTEXT = (1 &lt;&lt; 11),
+	/*! If set, the user will be marked */
+	CONFFLAG_MARKEDUSER = (1 &lt;&lt; 12),
+	/*! If set, user will be ask record name on entry of conference */
+	CONFFLAG_INTROUSER = (1 &lt;&lt; 13),
+	/*! If set, the MeetMe will be recorded */
+	CONFFLAG_RECORDCONF = (1&lt;&lt; 14),
+	/*! If set, the user will be monitored if the user is talking or not */
+	CONFFLAG_MONITORTALKER = (1 &lt;&lt; 15),
+	CONFFLAG_DYNAMIC = (1 &lt;&lt; 16),
+	CONFFLAG_DYNAMICPIN = (1 &lt;&lt; 17),
+	CONFFLAG_EMPTY = (1 &lt;&lt; 18),
+	CONFFLAG_EMPTYNOPIN = (1 &lt;&lt; 19),
+	CONFFLAG_ALWAYSPROMPT = (1 &lt;&lt; 20),
+	/*! If set, treats talking users as muted users */
+	CONFFLAG_OPTIMIZETALKER = (1 &lt;&lt; 21),
+	/*! If set, won't speak the extra prompt when the first person 
+	 *  enters the conference */
+	CONFFLAG_NOONLYPERSON = (1 &lt;&lt; 22),
+	CONFFLAG_INTROUSERNOREVIEW = (1 &lt;&lt; 23),
+	/*! If set, user will be asked to record name on entry of conference 
+	 *  without review */
+	CONFFLAG_STARTMUTED = (1 &lt;&lt; 24)
+	/*! If set, the user will be initially muted by admin */
+};
+
+AST_APP_OPTIONS(meetme_opts, {
+	AST_APP_OPTION('A', CONFFLAG_MARKEDUSER ),
+	AST_APP_OPTION('a', CONFFLAG_ADMIN ),
+	AST_APP_OPTION('b', CONFFLAG_AGI ),
+	AST_APP_OPTION('c', CONFFLAG_ANNOUNCEUSERCOUNT ),
+	AST_APP_OPTION('D', CONFFLAG_DYNAMICPIN ),
+	AST_APP_OPTION('d', CONFFLAG_DYNAMIC ),
+	AST_APP_OPTION('E', CONFFLAG_EMPTYNOPIN ),
+	AST_APP_OPTION('e', CONFFLAG_EMPTY ),
+	AST_APP_OPTION('i', CONFFLAG_INTROUSER ),
+	AST_APP_OPTION('I', CONFFLAG_INTROUSERNOREVIEW ),
+	AST_APP_OPTION('M', CONFFLAG_MOH ),
+	AST_APP_OPTION('m', CONFFLAG_STARTMUTED ),
+	AST_APP_OPTION('o', CONFFLAG_OPTIMIZETALKER ),
+	AST_APP_OPTION('P', CONFFLAG_ALWAYSPROMPT ),
+	AST_APP_OPTION('p', CONFFLAG_POUNDEXIT ),
+	AST_APP_OPTION('q', CONFFLAG_QUIET ),
+	AST_APP_OPTION('r', CONFFLAG_RECORDCONF ),
+	AST_APP_OPTION('s', CONFFLAG_STARMENU ),
+	AST_APP_OPTION('T', CONFFLAG_MONITORTALKER ),
+	AST_APP_OPTION('l', CONFFLAG_MONITOR ),
+	AST_APP_OPTION('t', CONFFLAG_TALKER ),
+	AST_APP_OPTION('w', CONFFLAG_WAITMARKED ),
+	AST_APP_OPTION('X', CONFFLAG_EXIT_CONTEXT ),
+	AST_APP_OPTION('x', CONFFLAG_MARKEDEXIT ),
+	AST_APP_OPTION('1', CONFFLAG_NOONLYPERSON ),
+});
+
 static const char *app = &quot;MeetMe&quot;;
 static const char *app2 = &quot;MeetMeCount&quot;;
 static const char *app3 = &quot;MeetMeAdmin&quot;;
@@ -93,7 +211,8 @@
 &quot;      'E' -- select an empty pinless conference\n&quot;
 &quot;      'i' -- announce user join/leave with review\n&quot;
 &quot;      'I' -- announce user join/leave without review\n&quot;
-&quot;      'm' -- set monitor only mode (Listen only, no talking)\n&quot;
+&quot;      'l' -- set listen only mode (Listen only, no talking)\n&quot;
+&quot;      'm' -- set initially muted by admin\n&quot;
 &quot;      'M' -- enable music on hold when the conference has a single caller\n&quot;
 &quot;      'o' -- set talker optimization - treats talkers who aren't speaking as\n&quot;
 &quot;             being muted, meaning (a) No encode is done on transmission and\n&quot;
@@ -137,31 +256,27 @@
 &quot;      'N' -- Mute entire conference (except admin)\n&quot;
 &quot;&quot;;
 
-#define CONFIG_FILE_NAME &quot;meetme.conf&quot;
-
-LOCAL_USER_DECL;
-
 struct ast_conference {
-	ast_mutex_t playlock;				/* Conference specific lock (players) */
-	ast_mutex_t listenlock;				/* Conference specific lock (listeners) */
-	char confno[AST_MAX_EXTENSION];		/* Conference */
-	struct ast_channel *chan;		/* Announcements channel */
-	struct ast_channel *lchan;		/* Listen/Record channel */
-	int fd;					/* Announcements fd */
-	int zapconf;				/* Zaptel Conf # */
-	int users;				/* Number of active users */
-	int markedusers;			/* Number of marked users */
-	time_t start;				/* Start time (s) */
-	int refcount;				/* reference count of usage */
-	unsigned int recording:2;				/* recording status */
-	unsigned int isdynamic:1;				/* Created on the fly? */
-	unsigned int locked:1;				/* Is the conference locked? */
-	pthread_t recordthread;			/* thread for recording */
-	pthread_attr_t attr;			/* thread attribute */
-	const char *recordingfilename;		/* Filename to record the Conference into */
-	const char *recordingformat;			/* Format to record the Conference in */
-	char pin[AST_MAX_EXTENSION];		/* If protected by a PIN */
-	char pinadmin[AST_MAX_EXTENSION];	/* If protected by a admin PIN */
+	ast_mutex_t playlock;                   /*!&lt; Conference specific lock (players) */
+	ast_mutex_t listenlock;                 /*!&lt; Conference specific lock (listeners) */
+	char confno[AST_MAX_EXTENSION];         /*!&lt; Conference */
+	struct ast_channel *chan;               /*!&lt; Announcements channel */
+	struct ast_channel *lchan;              /*!&lt; Listen/Record channel */
+	int fd;                                 /*!&lt; Announcements fd */
+	int zapconf;                            /*!&lt; Zaptel Conf # */
+	int users;                              /*!&lt; Number of active users */
+	int markedusers;                        /*!&lt; Number of marked users */
+	time_t start;                           /*!&lt; Start time (s) */
+	int refcount;                           /*!&lt; reference count of usage */
+	enum recording_state recording:2;               /*!&lt; recording status */
+	unsigned int isdynamic:1;               /*!&lt; Created on the fly? */
+	unsigned int locked:1;                  /*!&lt; Is the conference locked? */
+	pthread_t recordthread;                 /*!&lt; thread for recording */
+	pthread_attr_t attr;                    /*!&lt; thread attribute */
+	const char *recordingfilename;          /*!&lt; Filename to record the Conference into */
+	const char *recordingformat;            /*!&lt; Format to record the Conference in */
+	char pin[AST_MAX_EXTENSION];            /*!&lt; If protected by a PIN */
+	char pinadmin[AST_MAX_EXTENSION];       /*!&lt; If protected by a admin PIN */
 	struct ast_frame *transframe[32];
 	struct ast_frame *origframe;
 	struct ast_trans_pvt *transpath[32];
@@ -172,112 +287,53 @@
 static AST_LIST_HEAD_STATIC(confs, ast_conference);
 
 struct volume {
-	int desired;				/* Desired volume adjustment */
-	int actual;				/* Actual volume adjustment (for channels that can't adjust) */
+	int desired;                            /*!&lt; Desired volume adjustment */
+	int actual;                             /*!&lt; Actual volume adjustment (for channels that can't adjust) */
 };
 
 struct ast_conf_user {
-	int user_no;				/* User Number */
-	int userflags;				/* Flags as set in the conference */
-	int adminflags;				/* Flags set by the Admin */
-	struct ast_channel *chan;		/* Connected channel */
-	int talking;				/* Is user talking */
-	int zapchannel;				/* Is a Zaptel channel */
-	char usrvalue[50];			/* Custom User Value */
-	char namerecloc[AST_MAX_EXTENSION];	/* Name Recorded file Location */
-	time_t jointime;			/* Time the user joined the conference */
+	int user_no;                            /*!&lt; User Number */
+	int userflags;                          /*!&lt; Flags as set in the conference */
+	int adminflags;                         /*!&lt; Flags set by the Admin */
+	struct ast_channel *chan;               /*!&lt; Connected channel */
+	int talking;                            /*!&lt; Is user talking */
+	int zapchannel;                         /*!&lt; Is a Zaptel channel */
+	char usrvalue[50];                      /*!&lt; Custom User Value */
+	char namerecloc[PATH_MAX];		/*!&lt; Name Recorded file Location */
+	time_t jointime;                        /*!&lt; Time the user joined the conference */
 	struct volume talk;
 	struct volume listen;
 	AST_LIST_ENTRY(ast_conf_user) list;
 };
 
-static int audio_buffers;			/* The number of audio buffers to be allocated on pseudo channels
-						   when in a conference
-						*/
+/*! The number of audio buffers to be allocated on pseudo channels
+ *  when in a conference */
+static int audio_buffers;
 
-#define DEFAULT_AUDIO_BUFFERS 32		/* each buffer is 20ms, so this is 640ms total */
+/*! Map 'volume' levels from -5 through +5 into
+ *  decibel (dB) settings for channel drivers
+ *  Note: these are not a straight linear-to-dB
+ *  conversion... the numbers have been modified
+ *  to give the user a better level of adjustability
+ */
+static signed char gain_map[] = {
+	-15,
+	-13,
+	-10,
+	-6,
+	0,
+	0,
+	0,
+	6,
+	10,
+	13,
+	15,
+};
 
-#define ADMINFLAG_MUTED (1 &lt;&lt; 1)		/* User is muted */
-#define ADMINFLAG_KICKME (1 &lt;&lt; 2)		/* User is kicked */
-#define MEETME_DELAYDETECTTALK 		300
-#define MEETME_DELAYDETECTENDTALK 	1000
 
-#define AST_FRAME_BITS 32
-
-enum volume_action {
-	VOL_UP,
-	VOL_DOWN,
-};
-
 static int admin_exec(struct ast_channel *chan, void *data);
-
 static void *recordthread(void *args);
 
-#include &quot;enter.h&quot;
-#include &quot;leave.h&quot;
-
-#define ENTER	0
-#define LEAVE	1
-
-#define MEETME_RECORD_OFF	0
-#define MEETME_RECORD_STARTED	1
-#define MEETME_RECORD_ACTIVE	2
-#define MEETME_RECORD_TERMINATE	3
-
-#define CONF_SIZE 320
-
-#define CONFFLAG_ADMIN	(1 &lt;&lt; 1)		/* If set the user has admin access on the conference */
-#define CONFFLAG_MONITOR (1 &lt;&lt; 2)		/* If set the user can only receive audio from the conference */
-#define CONFFLAG_POUNDEXIT (1 &lt;&lt; 3)		/* If set asterisk will exit conference when '#' is pressed */
-#define CONFFLAG_STARMENU (1 &lt;&lt; 4)		/* If set asterisk will provide a menu to the user when '*' is pressed */
-#define CONFFLAG_TALKER (1 &lt;&lt; 5)		/* If set the use can only send audio to the conference */
-#define CONFFLAG_QUIET (1 &lt;&lt; 6)			/* If set there will be no enter or leave sounds */
-#define CONFFLAG_ANNOUNCEUSERCOUNT (1 &lt;&lt; 7)	/* If set, when user joins the conference, they will be told the number of users that are already in */
-#define CONFFLAG_AGI (1 &lt;&lt; 8)			/* Set to run AGI Script in Background */
-#define CONFFLAG_MOH (1 &lt;&lt; 9)			/* Set to have music on hold when user is alone in conference */
-#define CONFFLAG_MARKEDEXIT (1 &lt;&lt; 10)		/* If set the MeetMe will return if all marked with this flag left */
-#define CONFFLAG_WAITMARKED (1 &lt;&lt; 11)		/* If set, the MeetMe will wait until a marked user enters */
-#define CONFFLAG_EXIT_CONTEXT (1 &lt;&lt; 12)		/* If set, the MeetMe will exit to the specified context */
-#define CONFFLAG_MARKEDUSER (1 &lt;&lt; 13)		/* If set, the user will be marked */
-#define CONFFLAG_INTROUSER (1 &lt;&lt; 14)		/* If set, user will be ask record name on entry of conference */
-#define CONFFLAG_RECORDCONF (1&lt;&lt; 15)		/* If set, the MeetMe will be recorded */
-#define CONFFLAG_MONITORTALKER (1 &lt;&lt; 16)	/* If set, the user will be monitored if the user is talking or not */
-#define CONFFLAG_DYNAMIC (1 &lt;&lt; 17)
-#define CONFFLAG_DYNAMICPIN (1 &lt;&lt; 18)
-#define CONFFLAG_EMPTY (1 &lt;&lt; 19)
-#define CONFFLAG_EMPTYNOPIN (1 &lt;&lt; 20)
-#define CONFFLAG_ALWAYSPROMPT (1 &lt;&lt; 21)
-#define CONFFLAG_OPTIMIZETALKER (1 &lt;&lt; 22)	/* If set, treats talking users as muted users */
-#define CONFFLAG_NOONLYPERSON (1 &lt;&lt; 23)		/* If set, won't speak the extra prompt when the first person enters the conference */
-#define CONFFLAG_INTROUSERNOREVIEW (1 &lt;&lt; 24)	/* If set, user will be asked to record name on entry of conference without review */
-
-AST_APP_OPTIONS(meetme_opts, {
-	AST_APP_OPTION('A', CONFFLAG_MARKEDUSER ),
-	AST_APP_OPTION('a', CONFFLAG_ADMIN ),
-	AST_APP_OPTION('b', CONFFLAG_AGI ),
-	AST_APP_OPTION('c', CONFFLAG_ANNOUNCEUSERCOUNT ),
-	AST_APP_OPTION('D', CONFFLAG_DYNAMICPIN ),
-	AST_APP_OPTION('d', CONFFLAG_DYNAMIC ),
-	AST_APP_OPTION('E', CONFFLAG_EMPTYNOPIN ),
-	AST_APP_OPTION('e', CONFFLAG_EMPTY ),
-	AST_APP_OPTION('i', CONFFLAG_INTROUSER ),
-	AST_APP_OPTION('I', CONFFLAG_INTROUSERNOREVIEW ),
-	AST_APP_OPTION('M', CONFFLAG_MOH ),
-	AST_APP_OPTION('m', CONFFLAG_MONITOR ),
-	AST_APP_OPTION('o', CONFFLAG_OPTIMIZETALKER ),
-	AST_APP_OPTION('P', CONFFLAG_ALWAYSPROMPT ),
-	AST_APP_OPTION('p', CONFFLAG_POUNDEXIT ),
-	AST_APP_OPTION('q', CONFFLAG_QUIET ),
-	AST_APP_OPTION('r', CONFFLAG_RECORDCONF ),
-	AST_APP_OPTION('s', CONFFLAG_STARMENU ),
-	AST_APP_OPTION('T', CONFFLAG_MONITORTALKER ),
-	AST_APP_OPTION('t', CONFFLAG_TALKER ),
-	AST_APP_OPTION('w', CONFFLAG_WAITMARKED ),
-	AST_APP_OPTION('X', CONFFLAG_EXIT_CONTEXT ),
-	AST_APP_OPTION('x', CONFFLAG_MARKEDEXIT ),
-	AST_APP_OPTION('1', CONFFLAG_NOONLYPERSON ),
-});
-
 static char *istalking(int x)
 {
 	if (x &gt; 0)
@@ -315,26 +371,6 @@
 	return 0;
 }
 
-/* Map 'volume' levels from -5 through +5 into
-   decibel (dB) settings for channel drivers
-   Note: these are not a straight linear-to-dB
-   conversion... the numbers have been modified
-   to give the user a better level of adjustability
-*/
-static signed char gain_map[] = {
-	-15,
-	-13,
-	-10,
-	-6,
-	0,
-	0,
-	0,
-	6,
-	10,
-	13,
-	15,
-};
-
 static int set_talk_volume(struct ast_conf_user *user, int volume)
 {
 	signed char gain_adjust;
@@ -426,7 +462,7 @@
 	ast_channel_setoption(user-&gt;chan, AST_OPTION_RXGAIN, &amp;zero_volume, sizeof(zero_volume), 0);
 }
 
-static void conf_play(struct ast_channel *chan, struct ast_conference *conf, int sound)
+static void conf_play(struct ast_channel *chan, struct ast_conference *conf, enum entrance_sound sound)
 {
 	unsigned char *data;
 	int len;
@@ -541,20 +577,6 @@
 	return cnf;
 }
 
-static int confs_show(int fd, int argc, char **argv)
-{
-	ast_cli(fd, &quot;Deprecated! Please use 'meetme' instead.\n&quot;);
-
-	return RESULT_SUCCESS;
-}
-
-static char show_confs_usage[] =
-&quot;Deprecated! Please use 'meetme' instead.\n&quot;;
-
-static struct ast_cli_entry cli_show_confs = {
-	{ &quot;show&quot;, &quot;conferences&quot;, NULL }, confs_show,
-	&quot;Show status of conferences&quot;, show_confs_usage, NULL };
-	
 static int conf_cmd(int fd, int argc, char **argv) {
 	/* Process the command */
 	struct ast_conference *cnf;
@@ -671,7 +693,7 @@
 					user-&gt;chan-&gt;name,
 					user-&gt;userflags &amp; CONFFLAG_ADMIN ? &quot;(Admin)&quot; : &quot;&quot;,
 					user-&gt;userflags &amp; CONFFLAG_MONITOR ? &quot;(Listen only)&quot; : &quot;&quot;,
-					user-&gt;adminflags &amp; ADMINFLAG_MUTED ? &quot;(Admn Muted)&quot; : &quot;&quot;,
+					user-&gt;adminflags &amp; ADMINFLAG_MUTED ? &quot;(Admin Muted)&quot; : &quot;&quot;,
 					istalking(user-&gt;talking), hr, min, sec);
 			else 
 				ast_cli(fd, &quot;%d!%s!%s!%s!%s!%s!%s!%d!%02d:%02d:%02d\n&quot;,
@@ -931,7 +953,7 @@
 
 	user-&gt;chan = chan;
 	user-&gt;userflags = confflags;
-	user-&gt;adminflags = 0;
+	user-&gt;adminflags = (confflags &amp; CONFFLAG_STARTMUTED) ? ADMINFLAG_MUTED : 0;
 	user-&gt;talking = -1;
 	conf-&gt;users++;
 	/* Update table */
@@ -1123,7 +1145,7 @@
 	if (!firstpass &amp;&amp; !(confflags &amp; CONFFLAG_MONITOR) &amp;&amp; !(confflags &amp; CONFFLAG_ADMIN)) {
 		firstpass = 1;
 		if (!(confflags &amp; CONFFLAG_QUIET))
-			if (!(confflags &amp; CONFFLAG_WAITMARKED) || (conf-&gt;markedusers &gt;= 1))
+			if (!(confflags &amp; CONFFLAG_WAITMARKED) || ((confflags &amp; CONFFLAG_MARKEDUSER) &amp;&amp; (conf-&gt;markedusers &gt;= 1)))
 				conf_play(chan, conf, ENTER);
 	}
 
@@ -1281,41 +1303,53 @@
 				break;
 			}
 	
-			/* Check if the admin changed my modes */
-			if (user-&gt;adminflags) {			
-				/* Set the new modes */
-				if ((user-&gt;adminflags &amp; ADMINFLAG_MUTED) &amp;&amp; (ztc.confmode &amp; ZT_CONF_TALKER)) {
-					ztc.confmode ^= ZT_CONF_TALKER;
-					if (ioctl(fd, ZT_SETCONF, &amp;ztc)) {
-						ast_log(LOG_WARNING, &quot;Error setting conference - Un/Mute \n&quot;);
-						ret = -1;
-						break;
-					}
-				}
-				if (!(user-&gt;adminflags &amp; ADMINFLAG_MUTED) &amp;&amp; !(confflags &amp; CONFFLAG_MONITOR) &amp;&amp; !(ztc.confmode &amp; ZT_CONF_TALKER)) {
-					ztc.confmode |= ZT_CONF_TALKER;
-					if (ioctl(fd, ZT_SETCONF, &amp;ztc)) {
-						ast_log(LOG_WARNING, &quot;Error setting conference - Un/Mute \n&quot;);
-						ret = -1;
-						break;
-					}
-				}
-				if (user-&gt;adminflags &amp; ADMINFLAG_KICKME) {
-					/* You have been kicked. */
-					if (!ast_streamfile(chan, &quot;conf-kicked&quot;, chan-&gt;language))
-						ast_waitstream(chan, &quot;&quot;);
-					ret = 0;
+			/* Check if my modes have changed */
+
+			/* If I should be muted but am still talker, mute me */
+			if ((user-&gt;adminflags &amp; (ADMINFLAG_MUTED | ADMINFLAG_SELFMUTED)) &amp;&amp; (ztc.confmode &amp; ZT_CONF_TALKER)) {
+				ztc.confmode ^= ZT_CONF_TALKER;
+				if (ioctl(fd, ZT_SETCONF, &amp;ztc)) {
+					ast_log(LOG_WARNING, &quot;Error setting conference - Un/Mute \n&quot;);
+					ret = -1;
 					break;
 				}
-			} else if (!(confflags &amp; CONFFLAG_MONITOR) &amp;&amp; !(ztc.confmode &amp; ZT_CONF_TALKER)) {
+
+				manager_event(EVENT_FLAG_CALL, &quot;MeetmeMute&quot;, 
+						&quot;Channel: %s\r\n&quot;
+						&quot;Uniqueid: %s\r\n&quot;
+						&quot;Meetme: %s\r\n&quot;
+						&quot;Usernum: %i\r\n&quot;
+						&quot;Status: on\r\n&quot;,
+						chan-&gt;name, chan-&gt;uniqueid, conf-&gt;confno, user-&gt;user_no);
+			}
+
+			/* If I should be un-muted but am not talker, un-mute me */
+			if (!(user-&gt;adminflags &amp; (ADMINFLAG_MUTED | ADMINFLAG_SELFMUTED)) &amp;&amp; !(confflags &amp; CONFFLAG_MONITOR) &amp;&amp; !(ztc.confmode &amp; ZT_CONF_TALKER)) {
 				ztc.confmode |= ZT_CONF_TALKER;
 				if (ioctl(fd, ZT_SETCONF, &amp;ztc)) {
 					ast_log(LOG_WARNING, &quot;Error setting conference - Un/Mute \n&quot;);
 					ret = -1;
 					break;
 				}
+
+				manager_event(EVENT_FLAG_CALL, &quot;MeetmeMute&quot;, 
+						&quot;Channel: %s\r\n&quot;
+						&quot;Uniqueid: %s\r\n&quot;
+						&quot;Meetme: %s\r\n&quot;
+						&quot;Usernum: %i\r\n&quot;
+						&quot;Status: off\r\n&quot;,
+						chan-&gt;name, chan-&gt;uniqueid, conf-&gt;confno, user-&gt;user_no);
 			}
 
+			/* If I have been kicked, exit the conference */
+			if (user-&gt;adminflags &amp; ADMINFLAG_KICKME) {
+				//You have been kicked.
+				if (!ast_streamfile(chan, &quot;conf-kicked&quot;, chan-&gt;language))
+					ast_waitstream(chan, &quot;&quot;);
+				ret = 0;
+				break;
+			}
+
 			if (c) {
 				if (c-&gt;fds[0] != origfd) {
 					if (using_pseudo) {
@@ -1352,17 +1386,19 @@
 								      &quot;Channel: %s\r\n&quot;
 								      &quot;Uniqueid: %s\r\n&quot;
 								      &quot;Meetme: %s\r\n&quot;
-								      &quot;Usernum: %d\r\n&quot;,
+								      &quot;Usernum: %d\r\n&quot;
+								      &quot;Status: on\r\n&quot;,
 								      chan-&gt;name, chan-&gt;uniqueid, conf-&gt;confno, user-&gt;user_no);
 						}
 						if (user-&gt;talking &amp;&amp; totalsilence &gt; MEETME_DELAYDETECTENDTALK) {
 							user-&gt;talking = 0;
 							if (confflags &amp; CONFFLAG_MONITORTALKER)
-								manager_event(EVENT_FLAG_CALL, &quot;MeetmeStopTalking&quot;,
+								manager_event(EVENT_FLAG_CALL, &quot;MeetmeTalking&quot;,
 								      &quot;Channel: %s\r\n&quot;
 								      &quot;Uniqueid: %s\r\n&quot;
 								      &quot;Meetme: %s\r\n&quot;
-								      &quot;Usernum: %d\r\n&quot;,
+								      &quot;Usernum: %d\r\n&quot;
+								      &quot;Status: off\r\n&quot;,
 								      chan-&gt;name, chan-&gt;uniqueid, conf-&gt;confno, user-&gt;user_no);
 						}
 					}
@@ -1428,22 +1464,14 @@
 							switch(dtmf) {
 							case '1': /* Un/Mute */
 								menu_active = 0;
-								if (ztc.confmode &amp; ZT_CONF_TALKER) {
-	 						       		ztc.confmode = ZT_CONF_CONF | ZT_CONF_LISTENER;
-	 						       		confflags |= CONFFLAG_MONITOR ^ CONFFLAG_TALKER;
-								} else {
-									ztc.confmode = ZT_CONF_CONF | ZT_CONF_TALKER | ZT_CONF_LISTENER;
-									confflags ^= CONFFLAG_MONITOR | CONFFLAG_TALKER;
-								}
-								if (ioctl(fd, ZT_SETCONF, &amp;ztc)) {
-									ast_log(LOG_WARNING, &quot;Error setting conference - Un/Mute \n&quot;);
-									ret = -1;
-									break;
-								}
-								if (ztc.confmode &amp; ZT_CONF_TALKER) {
+
+								/* for admin, change both admin and use flags */
+								if (user-&gt;adminflags &amp; (ADMINFLAG_MUTED | ADMINFLAG_SELFMUTED)) {
+									user-&gt;adminflags &amp;= ~(ADMINFLAG_MUTED | ADMINFLAG_SELFMUTED);
 									if (!ast_streamfile(chan, &quot;conf-unmuted&quot;, chan-&gt;language))
 										ast_waitstream(chan, &quot;&quot;);
 								} else {
+									user-&gt;adminflags |= (ADMINFLAG_MUTED | ADMINFLAG_SELFMUTED);
 									if (!ast_streamfile(chan, &quot;conf-muted&quot;, chan-&gt;language))
 										ast_waitstream(chan, &quot;&quot;);
 								}
@@ -1508,23 +1536,16 @@
 							switch(dtmf) {
 							case '1': /* Un/Mute */
 								menu_active = 0;
-								if (ztc.confmode &amp; ZT_CONF_TALKER) {
-	 						       		ztc.confmode = ZT_CONF_CONF | ZT_CONF_LISTENER;
-	 						       		confflags |= CONFFLAG_MONITOR ^ CONFFLAG_TALKER;
-								} else if (!(user-&gt;adminflags &amp; ADMINFLAG_MUTED)) {
-									ztc.confmode = ZT_CONF_CONF | ZT_CONF_TALKER | ZT_CONF_LISTENER;
-									confflags ^= CONFFLAG_MONITOR | CONFFLAG_TALKER;
-								}
-								if (ioctl(fd, ZT_SETCONF, &amp;ztc)) {
-									ast_log(LOG_WARNING, &quot;Error setting conference - Un/Mute \n&quot;);
-									ret = -1;
-									break;
-								}
-								if (ztc.confmode &amp; ZT_CONF_TALKER) {
-									if (!ast_streamfile(chan, &quot;conf-unmuted&quot;, chan-&gt;language))
+
+								/* user can only toggle the self-muted state */
+								user-&gt;adminflags ^= ADMINFLAG_SELFMUTED;
+
+								/* they can't override the admin mute state */
+								if (user-&gt;adminflags &amp; (ADMINFLAG_MUTED | ADMINFLAG_SELFMUTED)) {
+									if (!ast_streamfile(chan, &quot;conf-muted&quot;, chan-&gt;language))
 										ast_waitstream(chan, &quot;&quot;);
 								} else {
-									if (!ast_streamfile(chan, &quot;conf-muted&quot;, chan-&gt;language))
+									if (!ast_streamfile(chan, &quot;conf-unmuted&quot;, chan-&gt;language))
 										ast_waitstream(chan, &quot;&quot;);
 								}
 								break;
@@ -1677,14 +1698,14 @@
 			&quot;Uniqueid: %s\r\n&quot;
 			&quot;Meetme: %s\r\n&quot;
 			&quot;Usernum: %d\r\n&quot;
-		        &quot;CIDnum: %s\r\n&quot;
-			&quot;CIDname: %s\r\n&quot;
-		        &quot;Duration: %02d:%02d:%02d\r\n&quot;,
+		        &quot;CallerIDnum: %s\r\n&quot;
+			&quot;CallerIDname: %s\r\n&quot;
+		        &quot;Duration: %ld\r\n&quot;,
 			chan-&gt;name, chan-&gt;uniqueid, conf-&gt;confno, 
 			user-&gt;user_no,
 			S_OR(user-&gt;chan-&gt;cid.cid_num, &quot;&lt;unknown&gt;&quot;),
-		        S_OR(user-&gt;chan-&gt;cid.cid_name, &quot;&lt;no name&gt;&quot;),
-			hr, min, sec);
+			S_OR(user-&gt;chan-&gt;cid.cid_name, &quot;&lt;unknown&gt;&quot;),
+			(now - user-&gt;jointime));
 
 		conf-&gt;users--;
 		conf-&gt;refcount--;
@@ -2249,31 +2270,21 @@
 			case 77: /* M: Mute */ 
 				if (user) {
 					user-&gt;adminflags |= ADMINFLAG_MUTED;
-					manager_event(EVENT_FLAG_CALL, &quot;MeetmeMute&quot;,
-						&quot;Status: on&quot;
-						&quot;Meetme: %s\r\n&quot;
-						&quot;Usernum: %d\r\n&quot;,
-						cnf-&gt;confno, user-&gt;user_no);
 				} else {
 					ast_log(LOG_NOTICE, &quot;Specified User not found!\n&quot;);
 				}
 				break;
-			case 78: /* N: Mute all users */
+			case 78: /* N: Mute all (non-admin) users */
 				AST_LIST_TRAVERSE(&amp;cnf-&gt;userlist, user, list) {
 					if (!(user-&gt;userflags &amp; CONFFLAG_ADMIN))
 						user-&gt;adminflags |= ADMINFLAG_MUTED;
 				}
 				break;					
 			case 109: /* m: Unmute */ 
-				if (user &amp;&amp; (user-&gt;adminflags &amp; ADMINFLAG_MUTED)) {
-					user-&gt;adminflags ^= ADMINFLAG_MUTED;
-					manager_event(EVENT_FLAG_CALL, &quot;MeetmeMute&quot;,
-						&quot;Status: off&quot;
-						&quot;Meetme: %s\r\n&quot;
-						&quot;Usernum: %d\r\n&quot;,
-						cnf-&gt;confno, user-&gt;user_no);
+				if (user) {
+					user-&gt;adminflags &amp;= ~ADMINFLAG_MUTED;
 				} else {
-					ast_log(LOG_NOTICE, &quot;Specified User not found or he muted himself!\n&quot;);
+					ast_log(LOG_NOTICE, &quot;Specified User not found!\n&quot;);
 				}
 				break;
 			case 110: /* n: Unmute all users */
@@ -2298,6 +2309,77 @@
 	return 0;
 }
 
+static int meetmemute(struct mansession *s, struct message *m, int mute)
+{
+	struct ast_conference *conf;
+	struct ast_conf_user *user;
+	char *confid = astman_get_header(m, &quot;Meetme&quot;);
+	char *userid = astman_get_header(m, &quot;Usernum&quot;);
+	int userno;
+
+	if (!confid || ast_strlen_zero(confid)) {
+		astman_send_error(s, m, &quot;Meetme conference not specified&quot;);
+		return 0;
+	}
+
+	if (!userid || ast_strlen_zero(userid)) {
+		astman_send_error(s, m, &quot;Meetme user number not specified&quot;);
+		return 0;
+	}
+
+	userno = strtoul(userid, &amp;userid, 10);
+
+	if (*userid) {
+		astman_send_error(s, m, &quot;Invalid user number&quot;);
+		return 0;
+	}
+
+	/* Look in the conference list */
+	AST_LIST_LOCK(&amp;confs);
+	AST_LIST_TRAVERSE(&amp;confs, conf, list) {
+		if (!strcmp(confid, conf-&gt;confno))
+			break;
+	}
+
+	if (!conf) {
+		AST_LIST_UNLOCK(&amp;confs);
+		astman_send_error(s, m, &quot;Meetme conference does not exist&quot;);
+		return 0;
+	}
+
+	AST_LIST_TRAVERSE(&amp;conf-&gt;userlist, user, list)
+		if (user-&gt;user_no == userno)
+			break;
+
+	if (!user) {
+		AST_LIST_UNLOCK(&amp;confs);
+		astman_send_error(s, m, &quot;User number not found&quot;);
+		return 0;
+	}
+
+	if (mute)
+		user-&gt;adminflags |= ADMINFLAG_MUTED;	/* request user muting */
+	else
+		user-&gt;adminflags &amp;= ~ADMINFLAG_MUTED;	/* request user unmuting */
+
+	AST_LIST_UNLOCK(&amp;confs);
+
+	ast_log(LOG_NOTICE, &quot;Requested to %smute conf %s user %d userchan %s uniqueid %s\n&quot;, mute ? &quot;&quot; : &quot;un&quot;, conf-&gt;confno, user-&gt;user_no, user-&gt;chan-&gt;name, user-&gt;chan-&gt;uniqueid);
+
+	astman_send_ack(s, m, mute ? &quot;User muted&quot; : &quot;User unmuted&quot;);
+	return 0;
+}
+
+static int action_meetmemute(struct mansession *s, struct message *m)
+{
+	return meetmemute(s, m, 1);
+}
+
+static int action_meetmeunmute(struct mansession *s, struct message *m)
+{
+	return meetmemute(s, m, 0);
+}
+
 static void *recordthread(void *args)
 {
 	struct ast_conference *cnf = args;
@@ -2392,8 +2474,9 @@
 {
 	int res;
 	
-	res = ast_cli_unregister(&amp;cli_show_confs);
-	res |= ast_cli_unregister(&amp;cli_conf);
+	res = ast_cli_unregister(&amp;cli_conf);
+	res |= ast_manager_unregister(&quot;MeetmeMute&quot;);
+	res |= ast_manager_unregister(&quot;MeetmeUnmute&quot;);
 	res |= ast_unregister_application(app3);
 	res |= ast_unregister_application(app2);
 	res |= ast_unregister_application(app);
@@ -2409,8 +2492,9 @@
 
 	load_config();
 
-	res = ast_cli_register(&amp;cli_show_confs);
-	res |= ast_cli_register(&amp;cli_conf);
+	res = ast_cli_register(&amp;cli_conf);
+	res |= ast_manager_register(&quot;MeetmeMute&quot;, EVENT_FLAG_CALL, action_meetmemute, &quot;Mute a Meetme user&quot;);
+	res |= ast_manager_register(&quot;MeetmeUnmute&quot;, EVENT_FLAG_CALL, action_meetmeunmute, &quot;Unmute a Meetme user&quot;);
 	res |= ast_register_application(app3, admin_exec, synopsis3, descrip3);
 	res |= ast_register_application(app2, count_exec, synopsis2, descrip2);
 	res |= ast_register_application(app, conf_exec, synopsis, descrip);

Modified: trunk/apps/app_queue.c
===================================================================
--- trunk/apps/app_queue.c	2006-05-25 20:48:20 UTC (rev 180)
+++ trunk/apps/app_queue.c	2006-05-26 21:12:24 UTC (rev 181)
@@ -1213,13 +1213,16 @@
 		ast_verbose(VERBOSE_PREFIX_3 &quot;Told %s in %s their queue position (which was %d)\n&quot;,
 			    qe-&gt;chan-&gt;name, qe-&gt;parent-&gt;name, qe-&gt;pos);
 	res = play_file(qe-&gt;chan, qe-&gt;parent-&gt;sound_thanks);
+	if (res &amp;&amp; !valid_exit(qe, res))
+		res = 0;
 
  playout:
 	/* Set our last_pos indicators */
  	qe-&gt;last_pos = now;
 	qe-&gt;last_pos_said = qe-&gt;pos;
+
 	/* Don't restart music on hold if we're about to exit the caller from the queue */
-	if (res)
+	if (!res)
 		ast_moh_start(qe-&gt;chan, qe-&gt;moh);
 
 	return res;
@@ -1263,8 +1266,8 @@
 
 			/* Take us out of the queue */
 			manager_event(EVENT_FLAG_CALL, &quot;Leave&quot;,
-				&quot;Channel: %s\r\nQueue: %s\r\nCount: %d\r\n&quot;,
-				qe-&gt;chan-&gt;name, q-&gt;name,  q-&gt;count);
+				&quot;Channel: %s\r\nQueue: %s\r\nCount: %d\r\nUniqueid: %s\r\n&quot;,
+				qe-&gt;chan-&gt;name, q-&gt;name,  q-&gt;count, qe-&gt;chan-&gt;uniqueid);
 			if (option_debug)
 				ast_log(LOG_DEBUG, &quot;Queue '%s' Leave, Channel '%s'\n&quot;, q-&gt;name, qe-&gt;chan-&gt;name );
 			/* Take us out of the queue */
@@ -1585,7 +1588,7 @@
 	if (!res) {
 		/* Wait for a keypress */
 		res = ast_waitstream(chan, AST_DIGIT_ANY);
-		if (res &lt;= 0 || !valid_exit(qe, res))
+		if (res &lt; 0 || !valid_exit(qe, res))
 			res = 0;
 
 		/* Stop playback */
@@ -1628,8 +1631,9 @@
 	/* play the announcement */
 	res = background_file(qe, qe-&gt;chan, qe-&gt;parent-&gt;sound_periodicannounce[qe-&gt;last_periodic_announce_sound]);
 
-	/* Resume Music on Hold */
-	ast_moh_start(qe-&gt;chan, qe-&gt;moh);
+	/* Resume Music on Hold if the caller is going to stay in the queue */
+	if (!res)
+		ast_moh_start(qe-&gt;chan, qe-&gt;moh);
 
 	/* update last_periodic_announce_time */
 	qe-&gt;last_periodic_announce_time = now;
@@ -1655,7 +1659,25 @@
 	ast_mutex_unlock(&amp;qe-&gt;parent-&gt;lock);
 }
 
+/*! \brief RNA == Ring No Answer. Common code that is executed when we try a queue member and they don't answer. */
+static void rna(int rnatime, struct queue_ent *qe, char *membername)
+{
 
+	if (option_verbose &gt; 2)
+		ast_verbose( VERBOSE_PREFIX_3 &quot;Nobody picked up in %d ms\n&quot;, rnatime);
+	ast_queue_log(qe-&gt;parent-&gt;name, qe-&gt;chan-&gt;uniqueid, membername, &quot;RINGNOANSWER&quot;, &quot;%d&quot;, rnatime);
+	if (qe-&gt;parent-&gt;autopause) {
+		if (!set_member_paused(qe-&gt;parent-&gt;name, membername, 1)) {
+			if (option_verbose &gt; 2)
+				ast_verbose( VERBOSE_PREFIX_3 &quot;Auto-Pausing Queue Member %s in queue %s since they failed to answer.\n&quot;, membername, qe-&gt;parent-&gt;name);
+		} else {
+			if (option_verbose &gt; 2)
+				ast_verbose( VERBOSE_PREFIX_3 &quot;Failed to pause Queue Member %s in queue %s!\n&quot;, membername, qe-&gt;parent-&gt;name);
+		}
+	}
+ return;
+} 
+
 #define AST_MAX_WATCHERS 256
 
 static struct callattempt *wait_for_answer(struct queue_ent *qe, struct callattempt *outgoing, int *to, char *digit, int prebusies, int caller_disconnect)
@@ -1673,6 +1695,10 @@
 	struct ast_channel *winner;
 	struct ast_channel *in = qe-&gt;chan;
 	char on[256] = &quot;&quot;;
+	long starttime = 0;
+	long endtime = 0;	
+
+	starttime = (long)time(NULL);
 	
 	while(*to &amp;&amp; !peer) {
 		int numlines, retry, pos = 1;
@@ -1788,6 +1814,9 @@
 							if (in-&gt;cdr)
 								ast_cdr_busy(in-&gt;cdr);
 							do_hang(o);
+							endtime = (long)time(NULL);
+							endtime -= starttime;
+							rna(endtime*1000, qe, on);
 							if (qe-&gt;parent-&gt;strategy != QUEUE_STRATEGY_RINGALL) {
 								if (qe-&gt;parent-&gt;timeoutrestart)
 									*to = orig;
@@ -1800,6 +1829,9 @@
 								ast_verbose( VERBOSE_PREFIX_3 &quot;%s is circuit-busy\n&quot;, o-&gt;chan-&gt;name);
 							if (in-&gt;cdr)
 								ast_cdr_busy(in-&gt;cdr);
+							endtime = (long)time(NULL);
+							endtime -= starttime;
+							rna(endtime*1000, qe, on);
 							do_hang(o);
 							if (qe-&gt;parent-&gt;strategy != QUEUE_STRATEGY_RINGALL) {
 								if (qe-&gt;parent-&gt;timeoutrestart)
@@ -1827,6 +1859,9 @@
 					}
 					ast_frfree(f);
 				} else {
+					endtime = (long)time(NULL);
+					endtime -= starttime;
+					rna(endtime*1000, qe, on);
 					do_hang(o);
 					if (qe-&gt;parent-&gt;strategy != QUEUE_STRATEGY_RINGALL) {
 						if (qe-&gt;parent-&gt;timeoutrestart)
@@ -1868,20 +1903,8 @@
 			}
 			ast_frfree(f);
 		}
-		if (!*to) {
-			if (option_verbose &gt; 2)
-				ast_verbose( VERBOSE_PREFIX_3 &quot;Nobody picked up in %d ms\n&quot;, orig);
-			ast_queue_log(qe-&gt;parent-&gt;name, qe-&gt;chan-&gt;uniqueid, on, &quot;RINGNOANSWER&quot;, &quot;%d&quot;, orig);
-			if (qe-&gt;parent-&gt;autopause) {
-				if (!set_member_paused(qe-&gt;parent-&gt;name, on, 1)) {
-					if (option_verbose &gt; 2)
-						ast_verbose( VERBOSE_PREFIX_3 &quot;Auto-Pausing Queue Member %s in queue %s since they failed to answer.\n&quot;, on, qe-&gt;parent-&gt;name);
-				} else {
-					if (option_verbose &gt; 2)
-						ast_verbose( VERBOSE_PREFIX_3 &quot;Failed to pause Queue Member %s in queue %s!\n&quot;, on, qe-&gt;parent-&gt;name);
-				}
-			}
-		}
+		if (!*to) 
+			rna(orig, qe, on);
 	}
 
 	return peer;
@@ -1993,18 +2016,17 @@
 		}
 
 		/* Make a position announcement, if enabled */
-		if (qe-&gt;parent-&gt;announcefrequency &amp;&amp; !ringing)
-			res = say_position(qe);
-		if (res)
+		if (qe-&gt;parent-&gt;announcefrequency &amp;&amp; !ringing &amp;&amp;
+		    (res = say_position(qe)))
 			break;
 
 		/* Make a periodic announcement, if enabled */
-		if (qe-&gt;parent-&gt;periodicannouncefrequency &amp;&amp; !ringing)
-			res = say_periodic_announcement(qe);
+		if (qe-&gt;parent-&gt;periodicannouncefrequency &amp;&amp; !ringing &amp;&amp;
+		    (res = say_periodic_announcement(qe)))
+			break;
 
 		/* Wait a second before checking again */
-		if (!res) res = ast_waitfordigit(qe-&gt;chan, RECHECK * 1000);
-		if (res)
+		if ((res = ast_waitfordigit(qe-&gt;chan, RECHECK * 1000)))
 			break;
 	}
 	return res;
@@ -2201,7 +2223,10 @@
 			free(tmp);
 		}
 	}
-	to = (qe-&gt;parent-&gt;timeout) ? qe-&gt;parent-&gt;timeout * 1000 : -1;
+	if (qe-&gt;expire &amp;&amp; (!qe-&gt;parent-&gt;timeout || (qe-&gt;expire - now) &lt;= qe-&gt;parent-&gt;timeout))
+		to = (qe-&gt;expire - now) * 1000;
+	else
+		to = (qe-&gt;parent-&gt;timeout) ? qe-&gt;parent-&gt;timeout * 1000 : -1;
 	ring_one(qe, outgoing, &amp;numbusies);
 	ast_mutex_unlock(&amp;qe-&gt;parent-&gt;lock);
 	if (use_weight) 
@@ -2298,7 +2323,7 @@
 		if (res &lt; 0) {
 			ast_queue_log(queuename, qe-&gt;chan-&gt;uniqueid, peer-&gt;name, &quot;SYSCOMPAT&quot;, &quot;%s&quot;, &quot;&quot;);
 			ast_log(LOG_WARNING, &quot;Had to drop call because I couldn't make %s compatible with %s\n&quot;, qe-&gt;chan-&gt;name, peer-&gt;name);
-		record_abandoned(qe);
+			record_abandoned(qe);
 			ast_hangup(peer);
 			return -1;
 		}
@@ -2340,6 +2365,7 @@
 						}
 					}
 
+					memset(tmpid, 0, sizeof(tmpid));
 					pbx_substitute_variables_helper(qe-&gt;chan, tmpid2, tmpid, sizeof(tmpid) - 1);
 				}
 
@@ -2353,6 +2379,8 @@
 							*p = '$';
 						}
 					}
+
+					memset(meid, 0, sizeof(meid));
 					pbx_substitute_variables_helper(qe-&gt;chan, meid2, meid, sizeof(meid) - 1);
 				} 
 	
@@ -2364,14 +2392,15 @@
 					ast_log(LOG_WARNING, &quot;monitor-format (in queues.conf) and MONITOR_FILENAME cannot contain a '|'! Not recording.\n&quot;);
 					mixmonapp = NULL;
 				}
+
+				if (!monitor_options)
+					monitor_options = ast_strdupa(&quot;&quot;);
 				
 				if (strchr(monitor_options, '|')) {
 					ast_log(LOG_WARNING, &quot;MONITOR_OPTIONS cannot contain a '|'! Not recording.\n&quot;);
 					mixmonapp = NULL;
 				}
 
-				if (!monitor_options)
-					monitor_options = ast_strdupa(&quot;&quot;);
 
 				if (mixmonapp) {
 					if (!ast_strlen_zero(monitor_exec) &amp;&amp; !ast_strlen_zero(monitor_options)) 
@@ -2456,13 +2485,10 @@
 					      (long)(time(NULL) - callstart));
 		}
 
-		if(bridge != AST_PBX_NO_HANGUP_PEER)
+		if (bridge != AST_PBX_NO_HANGUP_PEER)
 			ast_hangup(peer);
 		update_queue(qe-&gt;parent, member);
-		if (bridge == 0) 
-			res = 1; /* JDG: bridge successfully, leave app_queue */
-		else 
-			res = bridge; /* bridge error, stay in the queue */
+		res = bridge ? 0 : -1;
 	}
 out:
 	hangupcalls(outgoing, NULL);
@@ -3139,9 +3165,8 @@
 
 				if (makeannouncement) {
 					/* Make a position announcement, if enabled */
-					if (qe.parent-&gt;announcefrequency &amp;&amp; !ringing)
-						res = say_position(&amp;qe);
-					if (res) {
+					if (qe.parent-&gt;announcefrequency &amp;&amp; !ringing &amp;&amp;
+					    (res = say_position(&amp;qe))) {
 						 ast_queue_log(args.queuename, chan-&gt;uniqueid, &quot;NONE&quot;, &quot;EXITWITHKEY&quot;, &quot;%s|%d&quot;, qe.digits, qe.pos);
 						break;
 					}
@@ -3150,10 +3175,8 @@
 				makeannouncement = 1;
 
 				/* Make a periodic announcement, if enabled */
-				if (qe.parent-&gt;periodicannouncefrequency &amp;&amp; !ringing)
-					res = say_periodic_announcement(&amp;qe);
-
-				if (res &amp;&amp; valid_exit(&amp;qe, res)) {
+				if (qe.parent-&gt;periodicannouncefrequency &amp;&amp; !ringing &amp;&amp;
+				    (res = say_periodic_announcement(&amp;qe))) {
 					ast_queue_log(args.queuename, chan-&gt;uniqueid, &quot;NONE&quot;, &quot;EXITWITHKEY&quot;, &quot;%c|%d&quot;, res, qe.pos);
 					break;
 				}
@@ -3167,8 +3190,9 @@
 							record_abandoned(&amp;qe);
 							ast_queue_log(args.queuename, chan-&gt;uniqueid, &quot;NONE&quot;, &quot;ABANDON&quot;, &quot;%d|%d|%ld&quot;, qe.pos, qe.opos, (long)time(NULL) - qe.start);
 						}
-					} else if (res &gt; 0)
+					} else if (valid_exit(&amp;qe, res)) {
 						 ast_queue_log(args.queuename, chan-&gt;uniqueid, &quot;NONE&quot;, &quot;EXITWITHKEY&quot;, &quot;%s|%d&quot;, qe.digits, qe.pos);
+					}
 					break;
 				}
 
@@ -3231,7 +3255,7 @@
 				if (!is_our_turn(&amp;qe)) {
 					if (option_debug)
 						ast_log(LOG_DEBUG, &quot;Darn priorities, going back in queue (%s)!\n&quot;,
-								qe.chan-&gt;name);
+							qe.chan-&gt;name);
 					goto check_turns;
 				}
 			}

Modified: trunk/apps/app_record.c
===================================================================
--- trunk/apps/app_record.c	2006-05-25 20:48:20 UTC (rev 180)
+++ trunk/apps/app_record.c	2006-05-26 21:12:24 UTC (rev 181)
@@ -62,7 +62,8 @@
 &quot;     'n' : do not answer, but record anyway if line not yet answered\n&quot;
 &quot;     'q' : quiet (do not play a beep tone)\n&quot;
 &quot;     's' : skip recording if the line is not yet answered\n&quot;
-&quot;     't' : use alternate '*' terminator key instead of default '#'\n&quot;
+&quot;     't' : use alternate '*' terminator key (DTMF) instead of default '#'\n&quot;
+&quot;     'x' : ignore all terminator keys (DTMF) and keep recording until hangup\n&quot;
 &quot;\n&quot;
 &quot;If filename contains '%d', these characters will be replaced with a number\n&quot;
 &quot;incremented by one each time the file is recorded. \n\n&quot;
@@ -167,6 +168,8 @@
 				option_append = 1;
 			if (strchr(options, 't'))
 				terminator = '*';
+			if (strchr(options, 'x'))
+				terminator = 0;
 			if (strchr(options, 'q'))
 				option_quiet = 1;
 		}

Modified: trunk/apps/app_rpt.c
===================================================================
--- trunk/apps/app_rpt.c	2006-05-25 20:48:20 UTC (rev 180)
+++ trunk/apps/app_rpt.c	2006-05-26 21:12:24 UTC (rev 181)
@@ -1,3 +1,4 @@
+/* #define OLD_ASTERISK */
 /*
  * Asterisk -- An open source telephony toolkit.
  *
@@ -20,7 +21,7 @@
 /*! \file
  *
  * \brief Radio Repeater / Remote Base program 
- *  version 0.42 02/25/06
+ *  version 0.47 05/23/06
  * 
  * \author Jim Dixon, WB6NIL &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/solid-pbx-svn">jim at lambdatel.com</A>&gt;
  *
@@ -32,8 +33,19 @@
  * Repeater / Remote Functions:
  * &quot;Simple&quot; Mode:  * - autopatch access, # - autopatch hangup
  * Normal mode:
- * See the function list in rpt.conf
+ * See the function list in rpt.conf (autopatchup, autopatchdn)
+ * autopatchup can optionally take comma delimited setting=value pairs:
+ *  
  *
+ * context=string		:	Override default context with &quot;string&quot;
+ * dialtime=ms			:	Specify the max number of milliseconds between phone number digits (1000 milliseconds = 1 second)
+ * farenddisconnect=1		:	Automatically disconnect when called party hangs up
+ * noct=1			:	Don't send repeater courtesy tone during autopatch calls
+ * quiet=1			:	Don't send dial tone, or connect messages. Do not send patch down message when called party hangs up
+ *
+ *
+ * Example: 123=autopatchup,dialtime=20000,noct=1,farenddisconnect=1
+ *
  *  To send an asterisk (*) while dialing or talking on phone,
  *  use the autopatch acess code.
  *
@@ -93,6 +105,15 @@
  *  140 - Link Status (brief)
  *
  *
+ *
+ * 'duplex' modes:  (defaults to duplex=2)
+ *
+ * 0 - Only remote links key Tx and no main repeat audio.
+ * 1 - Everything other then main Rx keys Tx, no main repeat audio.
+ * 2 - Normal mode
+ * 3 - Normal except no main repeat audio.
+ * 4 - Normal except no main repeat audio during autopatch only
+ *
 */
 
 /*** MODULEINFO
@@ -100,15 +121,16 @@
 	&lt;defaultenabled&gt;no&lt;/defaultenabled&gt;
  ***/
 
-/* The following is JUST GROSS!! There is some soft of underlying problem,
-   probably in channel_iax2.c, that causes an IAX2 connection to sometimes
-   stop transmitting randomly. We have been working for weeks to try to
-   locate it and fix it, but to no avail We finally decided to put our
-   tail between our legs, and just make the radio system re-connect upon
-   network failure. This just shouldnt have to be done. For normal operation,
-   comment-out the following line */
-#define	RECONNECT_KLUDGE 
+/* Un-comment the following to include support for MDC-1200 digital tone
+   signalling protocol (using KA6SQG's GPL'ed implementation) */
+/* file must be downloaded separately, not part of Asterisk distribution */
+/* #include &quot;mdc_decode.c&quot; */
 
+/* Un-comment the following to include support for notch filters in the
+   rx audio stream (using Tony Fisher's mknotch (mkfilter) implementation) */
+/* file must be downloaded separately, not part of Asterisk distribution */
+/* #include &quot;rpt_notch.c&quot; */
+
 /* maximum digits in DTMF buffer, and seconds after * for DTMF command timeout */
 
 #define	MAXDTMF 32
@@ -117,6 +139,10 @@
 #define	MACROPTIME 500
 #define	DTMF_TIMEOUT 3
 
+#ifdef	__RPT_NOTCH
+#define	MAXFILTERS 10
+#endif
+
 #define	DISC_TIME 10000  /* report disc after 10 seconds of no connect */
 #define	MAX_RETRIES 5
 
@@ -124,6 +150,7 @@
 
 #define	RETRY_TIMER_MS 5000
 
+#define MAXPEERSTR 31
 #define	MAXREMSTR 15
 
 #define	DELIMCHR ','
@@ -144,6 +171,8 @@
 
 #define MAXNODESTR 300
 
+#define MAXPATCHCONTEXT 100
+
 #define ACTIONSIZE 32
 
 #define TELEPARAMSIZE 256
@@ -156,7 +185,7 @@
 enum{ID,PROC,TERM,COMPLETE,UNKEY,REMDISC,REMALREADY,REMNOTFOUND,REMGO,
 	CONNECTED,CONNFAIL,STATUS,TIMEOUT,ID1, STATS_TIME,
 	STATS_VERSION, IDTALKOVER, ARB_ALPHA, TEST_TONE, REV_PATCH,
-	TAILMSG, MACRO_NOTFOUND, MACRO_BUSY};
+	TAILMSG, MACRO_NOTFOUND, MACRO_BUSY, LASTNODEKEY};
 
 enum {REM_SIMPLEX,REM_MINUS,REM_PLUS};
 
@@ -215,7 +244,7 @@
 #include &quot;asterisk/say.h&quot;
 #include &quot;asterisk/localtime.h&quot;
 
-static  char *tdesc = &quot;Radio Repeater / Remote Base  version 0.42  02/25/2006&quot;;
+static  char *tdesc = &quot;Radio Repeater / Remote Base  version 0.47  05/23/2006&quot;;
 
 static char *app = &quot;Rpt&quot;;
 
@@ -263,7 +292,9 @@
 static char *remote_rig_ft897=&quot;ft897&quot;;
 static char *remote_rig_rbi=&quot;rbi&quot;;
 
-struct	ast_config *cfg;
+#ifdef	OLD_ASTERISK
+STANDARD_LOCAL_USER;
+#endif
 
 LOCAL_USER_DECL;
 
@@ -272,6 +303,7 @@
 #define	TOTIME 180000
 #define	IDTIME 300000
 #define	MAXRPTS 20
+#define MAX_STAT_LINKS 32
 #define POLITEID 30000
 #define FUNCTDELAY 1500
 
@@ -299,10 +331,24 @@
 	long 	retrytimer;
 	long	retxtimer;
 	int	retries;
+	int	reconnects;
+	long long connecttime;
 	struct ast_channel *chan;	
 	struct ast_channel *pchan;	
 } ;
 
+struct rpt_lstat
+{
+	struct	rpt_lstat *next;
+	struct	rpt_lstat *prev;
+	char	peer[MAXPEERSTR];
+	char	name[MAXNODESTR];
+	char	mode;
+	char	outbound;
+	char	reconnects;
+	long long	connecttime;
+} ;
+
 struct rpt_tele
 {
 	struct rpt_tele *next;
@@ -339,53 +385,77 @@
 
 static struct rpt
 {
+	ast_mutex_t lock;
+	struct ast_config *cfg;
+	char reload;
+
 	char *name;
-	ast_mutex_t lock;
 	char *rxchanname;
 	char *txchanname;
-	char *ourcontext;
-	char *ourcallerid;
-	char *acctcode;
-	char *ident;
-	char *tonezone;
-	char *functions;
-	char *link_functions;
-	char *phone_functions;
-	char *dphone_functions;
-	char *nodes;
+	char *remote;
+
+	struct {
+
+		char *ourcontext;
+		char *ourcallerid;
+		char *acctcode;
+		char *ident;
+		char *tonezone;
+		char simple;
+		char *functions;
+		char *link_functions;
+		char *phone_functions;
+		char *dphone_functions;
+		char *nodes;
+		int hangtime;
+		int totime;
+		int idtime;
+		int tailmessagetime;
+		int tailsquashedtime;
+		int duplex;
+		int politeid;
+		char *tailmessages[500];
+		int tailmessagemax;
+		char	*memory;
+		char	*macro;
+		char	*startupmacro;
+		int iobase;
+		char funcchar;
+		char endchar;
+		char	nobusyout;
+	} p;
 	struct rpt_link links;
-	int hangtime;
-	int totime;
-	int idtime;
 	int unkeytocttimer;
-	int duplex;
 	char keyed;
 	char exttx;
 	char localtx;
 	char remoterx;
 	char remotetx;
 	char remoteon;
-	char simple;
-	char *remote;
 	char tounkeyed;
 	char tonotify;
 	char enable;
 	char dtmfbuf[MAXDTMF];
 	char macrobuf[MAXMACRO];
 	char rem_dtmfbuf[MAXDTMF];
+	char lastdtmfcommand[MAXDTMF];
 	char cmdnode[50];
 	struct ast_channel *rxchannel,*txchannel;
 	struct ast_channel *pchannel,*txpchannel, *remchannel;
 	struct rpt_tele tele;
+	struct timeval lasttv,curtv;
 	pthread_t rpt_call_thread,rpt_thread;
 	time_t dtmf_time,rem_dtmf_time,dtmf_time_rem;
-	int tailtimer,totimer,idtimer,txconf,conf,callmode,cidx,scantimer,tmsgtimer;
+	int tailtimer,totimer,idtimer,txconf,conf,callmode,cidx,scantimer,tmsgtimer,skedtimer;
 	int mustid,tailid;
-	int politeid;
+	int tailevent;
+	int telemrefcount;
 	int dtmfidx,rem_dtmfidx;
+	int dailytxtime,dailykerchunks,totalkerchunks,dailykeyups,totalkeyups,timeouts;
+	int totalexecdcommands, dailyexecdcommands;
 	long	retxtimer;
+	long long totaltxtime;
 	char mydtmf;
-	int iobase;
 	char exten[AST_MAX_EXTENSION];
 	char freq[MAXREMSTR],rxpl[MAXREMSTR],txpl[MAXREMSTR];
 	char offset;
@@ -397,9 +467,12 @@
 	char hfscanmode;
 	int hfscanstatus;
 	char lastlinknode[MAXNODESTR];
-	char funcchar;
-	char endchar;
 	char stopgen;
+	char patchfarenddisconnect;
+	char patchnoct;
+	char patchquiet;
+	char patchcontext[MAXPATCHCONTEXT];
+	int patchdialtime;
 	int macro_longest;
 	int phone_longestfunc;
 	int dphone_longestfunc;
@@ -407,18 +480,31 @@
 	int longestfunc;
 	int longestnode;
 	int threadrestarts;		
-	int tailmessagetime;
-	int tailsquashedtime;
-	char *tailmessages[500];
-	int tailmessagemax;
 	int tailmessagen;
 	time_t disgorgetime;
 	time_t lastthreadrestarttime;
 	long	macrotimer;
-	char	*macro;
-	char	*startupmacro;
-	char	*memory;
-	char	nobusyout;
+	char	lastnodewhichkeyedusup[MAXNODESTR];
+#ifdef	__RPT_NOTCH
+	struct rptfilter
+	{
+		char	desc[100];
+		float	x0;
+		float	x1;
+		float	x2;
+		float	y0;
+		float	y1;
+		float	y2;
+		float	gain;
+		float	const0;
+		float	const1;
+		float	const2;
+	} filters[MAXFILTERS];
+#endif
+#ifdef	_MDC_DECODE_H_
+	mdc_decoder_t *mdc;
+	unsigned short lastunit;
+#endif
 } rpt_vars[MAXRPTS];	
 
 
@@ -613,6 +699,10 @@
 /* Debug mode */
 static int rpt_do_debug(int fd, int argc, char *argv[]);
 static int rpt_do_dump(int fd, int argc, char *argv[]);
+static int rpt_do_stats(int fd, int argc, char *argv[]);
+static int rpt_do_lstats(int fd, int argc, char *argv[]);
+static int rpt_do_reload(int fd, int argc, char *argv[]);
+static int rpt_do_restart(int fd, int argc, char *argv[]);
 
 static char debug_usage[] =
 &quot;Usage: rpt debug level {0-7}\n&quot;
@@ -622,6 +712,22 @@
 &quot;Usage: rpt dump &lt;nodename&gt;\n&quot;
 &quot;       Dumps struct debug info to log\n&quot;;
 
+static char dump_stats[] =
+&quot;Usage: rpt stats &lt;nodename&gt;\n&quot;
+&quot;       Dumps node statistics to console\n&quot;;
+
+static char dump_lstats[] =
+&quot;Usage: rpt lstats &lt;nodename&gt;\n&quot;
+&quot;       Dumps link statistics to console\n&quot;;
+
+static char reload_usage[] =
+&quot;Usage: rpt reload\n&quot;
+&quot;       Reloads app_rpt running config parameters\n&quot;;
+
+static char restart_usage[] =
+&quot;Usage: rpt restart\n&quot;
+&quot;       Restarts app_rpt\n&quot;;
+
 static struct ast_cli_entry  cli_debug =
         { { &quot;rpt&quot;, &quot;debug&quot;, &quot;level&quot; }, rpt_do_debug, 
 		&quot;Enable app_rpt debugging&quot;, debug_usage };
@@ -630,6 +736,22 @@
         { { &quot;rpt&quot;, &quot;dump&quot; }, rpt_do_dump,
 		&quot;Dump app_rpt structs for debugging&quot;, dump_usage };
 
+static struct ast_cli_entry  cli_stats =
+        { { &quot;rpt&quot;, &quot;stats&quot; }, rpt_do_stats,
+		&quot;Dump node statistics&quot;, dump_stats };
+
+static struct ast_cli_entry  cli_lstats =
+        { { &quot;rpt&quot;, &quot;lstats&quot; }, rpt_do_lstats,
+		&quot;Dump link statistics&quot;, dump_lstats };
+
+static struct ast_cli_entry  cli_reload =
+        { { &quot;rpt&quot;, &quot;reload&quot; }, rpt_do_reload,
+		&quot;Reload app_rpt config&quot;, reload_usage };
+
+static struct ast_cli_entry  cli_restart =
+        { { &quot;rpt&quot;, &quot;restart&quot; }, rpt_do_restart,
+		&quot;Restart app_rpt&quot;, restart_usage };
+
 /*
 * Telemetry defaults
 */
@@ -682,10 +804,20 @@
 	{&quot;remote&quot;, function_remote},
 	{&quot;macro&quot;, function_macro}
 } ;
+
+/*
+* Break up a delimited string into a table of substrings
+*
+* str - delimited string ( will be modified )
+* strp- list of pointers to substrings (this is built by this function), NULL will be placed at end of list
+* limit- maximum number of substrings to process
+*/
 	
-static int finddelim(char *str,char *strp[])
+
+
+static int finddelim(char *str, char *strp[], int limit)
 {
-int     i,inquo;
+int     i,l,inquo;
 
         inquo = 0;
         i = 0;
@@ -695,7 +827,7 @@
                 strp[0] = 0;
                 return(0);
            }
-        for(; *str; str++)
+        for(l = 0; *str &amp;&amp; (l &lt; limit) ; str++)
            {
                 if (*str == QUOTECHR)
                    {
@@ -713,6 +845,7 @@
                 if ((*str == DELIMCHR) &amp;&amp; (!inquo))
                 {
                         *str = 0;
+			l++;
                         strp[i++] = str + 1;
                 }
            }
@@ -721,6 +854,53 @@
 
 }
 
+/*
+* Match a keyword in a list, and return index of string plus 1 if there was a match,
+* else return 0. If param is passed in non-null, then it will be set to the first character past the match
+*/
+
+static int matchkeyword(char *string, char **param, char *keywords[])
+{
+int	i,ls;
+	for( i = 0 ; keywords[i] ; i++){
+		ls = strlen(keywords[i]);
+		if(!ls){
+			*param = NULL;
+			return 0;
+		}
+		if(!strncmp(string, keywords[i], ls)){
+			if(param)
+				*param = string + ls;
+			return i + 1; 
+		}
+	}
+	param = NULL;
+	return 0;
+}
+
+/*
+* Skip characters in string which are in charlist, and return a pointer to the
+* first non-matching character
+*/
+
+static char *skipchars(char *string, char *charlist)
+{
+int i;	
+	while(*string){
+		for(i = 0; charlist[i] ; i++){
+			if(*string == charlist[i]){
+				string++;
+				break;
+			}
+		}
+		if(!charlist[i])
+			return string;
+	}
+	return string;
+}	
+					
+
+
 static int myatoi(char *str)
 {
 int	ret;
@@ -731,6 +911,248 @@
 	return ret;
 }
 
+
+#ifdef	__RPT_NOTCH
+
+/* rpt filter routine */
+static void rpt_filter(struct rpt *myrpt, volatile short *buf, int len)
+{
+int	i,j;
+struct	rptfilter *f;
+
+	for(i = 0; i &lt; len; i++)
+	{
+		for(j = 0; j &lt; MAXFILTERS; j++)
+		{
+			f = &amp;myrpt-&gt;filters[j];
+			if (!*f-&gt;desc) continue;
+			f-&gt;x0 = f-&gt;x1; f-&gt;x1 = f-&gt;x2;
+		        f-&gt;x2 = ((float)buf[i]) / f-&gt;gain;
+		        f-&gt;y0 = f-&gt;y1; f-&gt;y1 = f-&gt;y2;
+		        f-&gt;y2 =   (f-&gt;x0 + f-&gt;x2) +   f-&gt;const0 * f-&gt;x1
+		                     + (f-&gt;const1 * f-&gt;y0) + (f-&gt;const2 * f-&gt;y1);
+			buf[i] = (short)f-&gt;y2;
+		}
+	}
+}
+
+#endif
+
+/* Retrieve an int from a config file */
+                                                                                
+static int retrieve_astcfgint(struct rpt *myrpt,char *category, char *name, int min, int max, int defl)
+{
+        char *var;
+        int ret;
+                                                                                
+        var = ast_variable_retrieve(myrpt-&gt;cfg, category, name);
+        if(var){
+                ret = myatoi(var);
+                if(ret &lt; min)
+                        ret = min;
+                if(ret &gt; max)
+                        ret = max;
+        }
+        else
+                ret = defl;
+        return ret;
+}
+
+
+static void load_rpt_vars(int n,int init)
+{
+char *this,*val;
+int	j,longestnode;
+struct ast_variable *vp;
+struct ast_config *cfg;
+#ifdef	__RPT_NOTCH
+int	i;
+char *strs[100];
+#endif
+
+	if (option_verbose &gt; 2)
+		ast_verbose(VERBOSE_PREFIX_3 &quot;%s config for repeater %s\n&quot;,
+			(init) ? &quot;Loading initial&quot; : &quot;Re-Loading&quot;,rpt_vars[n].name);
+	ast_mutex_lock(&amp;rpt_vars[n].lock);
+	if (rpt_vars[n].cfg) ast_config_destroy(rpt_vars[n].cfg);
+	cfg = ast_config_load(&quot;rpt.conf&quot;);
+	if (!cfg) {
+		ast_mutex_unlock(&amp;rpt_vars[n].lock);
+ 		ast_log(LOG_NOTICE, &quot;Unable to open radio repeater configuration rpt.conf.  Radio Repeater disabled.\n&quot;);
+		pthread_exit(NULL);
+	}
+	rpt_vars[n].cfg = cfg; 
+	this = rpt_vars[n].name;
+ 	memset(&amp;rpt_vars[n].p,0,sizeof(rpt_vars[n].p));
+	if (init)
+	{
+		char *cp;
+		int savearea = (char *)&amp;rpt_vars[n].p - (char *)&amp;rpt_vars[n];
+
+		cp = (char *) &amp;rpt_vars[n].p;
+		memset(cp + sizeof(rpt_vars[n].p),0,
+			sizeof(rpt_vars[n]) - (sizeof(rpt_vars[n].p) + savearea));
+		rpt_vars[n].tele.next = &amp;rpt_vars[n].tele;
+		rpt_vars[n].tele.prev = &amp;rpt_vars[n].tele;
+		rpt_vars[n].rpt_thread = AST_PTHREADT_NULL;
+		rpt_vars[n].tailmessagen = 0;
+	}
+#ifdef	__RPT_NOTCH
+	/* zot out filters stuff */
+	memset(&amp;rpt_vars[n].filters,0,sizeof(rpt_vars[n].filters));
+#endif
+	val = ast_variable_retrieve(cfg,this,&quot;context&quot;);
+	if (val) rpt_vars[n].p.ourcontext = val;
+	else rpt_vars[n].p.ourcontext = this;
+	val = ast_variable_retrieve(cfg,this,&quot;callerid&quot;);
+	if (val) rpt_vars[n].p.ourcallerid = val;
+	val = ast_variable_retrieve(cfg,this,&quot;accountcode&quot;);
+	if (val) rpt_vars[n].p.acctcode = val;
+	val = ast_variable_retrieve(cfg,this,&quot;idrecording&quot;);
+	if (val) rpt_vars[n].p.ident = val;
+	val = ast_variable_retrieve(cfg,this,&quot;hangtime&quot;);
+	if (val) rpt_vars[n].p.hangtime = atoi(val);
+		else rpt_vars[n].p.hangtime = HANGTIME;
+	val = ast_variable_retrieve(cfg,this,&quot;totime&quot;);
+	if (val) rpt_vars[n].p.totime = atoi(val);
+		else rpt_vars[n].p.totime = TOTIME;
+	rpt_vars[n].p.tailmessagetime = retrieve_astcfgint(&amp;rpt_vars[n],this, &quot;tailmessagetime&quot;, 0, 2400000, 0);		
+	rpt_vars[n].p.tailsquashedtime = retrieve_astcfgint(&amp;rpt_vars[n],this, &quot;tailsquashedtime&quot;, 0, 2400000, 0);		
+	rpt_vars[n].p.duplex = retrieve_astcfgint(&amp;rpt_vars[n],this,&quot;duplex&quot;,0,4,2);
+	rpt_vars[n].p.idtime = retrieve_astcfgint(&amp;rpt_vars[n],this, &quot;idtime&quot;, 60000, 2400000, IDTIME);	/* Enforce a min max */
+	rpt_vars[n].p.politeid = retrieve_astcfgint(&amp;rpt_vars[n],this, &quot;politeid&quot;, 30000, 300000, POLITEID); /* Enforce a min max */
+	val = ast_variable_retrieve(cfg,this,&quot;tonezone&quot;);
+	if (val) rpt_vars[n].p.tonezone = val;
+	rpt_vars[n].p.tailmessages[0] = 0;
+	rpt_vars[n].p.tailmessagemax = 0;
+	val = ast_variable_retrieve(cfg,this,&quot;tailmessagelist&quot;);
+	if (val) rpt_vars[n].p.tailmessagemax = finddelim(val, rpt_vars[n].p.tailmessages, 500);
+	val = ast_variable_retrieve(cfg,this,&quot;memory&quot;);
+	if (!val) val = MEMORY;
+	rpt_vars[n].p.memory = val;
+	val = ast_variable_retrieve(cfg,this,&quot;macro&quot;);
+	if (!val) val = MACRO;
+	rpt_vars[n].p.macro = val;
+	val = ast_variable_retrieve(cfg,this,&quot;startup_macro&quot;);
+	if (val) rpt_vars[n].p.startupmacro = val;
+	val = ast_variable_retrieve(cfg,this,&quot;iobase&quot;);
+	/* do not use atoi() here, we need to be able to have
+		the input specified in hex or decimal so we use
+		sscanf with a %i */
+	if ((!val) || (sscanf(val,&quot;%i&quot;,&amp;rpt_vars[n].p.iobase) != 1))
+	rpt_vars[n].p.iobase = DEFAULT_IOBASE;
+	val = ast_variable_retrieve(cfg,this,&quot;functions&quot;);
+	if (!val)
+		{
+			val = FUNCTIONS;
+			rpt_vars[n].p.simple = 1;
+		} 
+	rpt_vars[n].p.functions = val;
+	val =  ast_variable_retrieve(cfg,this,&quot;link_functions&quot;);
+	if (val) rpt_vars[n].p.link_functions = val;
+	else 
+		rpt_vars[n].p.link_functions = rpt_vars[n].p.functions;
+	val = ast_variable_retrieve(cfg,this,&quot;phone_functions&quot;);
+	if (val) rpt_vars[n].p.phone_functions = val;
+	val = ast_variable_retrieve(cfg,this,&quot;dphone_functions&quot;);
+	if (val) rpt_vars[n].p.dphone_functions = val;
+	val = ast_variable_retrieve(cfg,this,&quot;funcchar&quot;);
+	if (!val) rpt_vars[n].p.funcchar = FUNCCHAR; else 
+		rpt_vars[n].p.funcchar = *val;		
+	val = ast_variable_retrieve(cfg,this,&quot;endchar&quot;);
+	if (!val) rpt_vars[n].p.endchar = ENDCHAR; else 
+		rpt_vars[n].p.endchar = *val;		
+	val = ast_variable_retrieve(cfg,this,&quot;nobusyout&quot;);
+	if (val) rpt_vars[n].p.nobusyout = ast_true(val);
+	val = ast_variable_retrieve(cfg,this,&quot;nodes&quot;);
+	if (!val) val = NODES;
+	rpt_vars[n].p.nodes = val;
+#ifdef	__RPT_NOTCH
+	val = ast_variable_retrieve(cfg,this,&quot;rxnotch&quot;);
+	if (val) {
+		i = finddelim(val,strs,MAXFILTERS * 2);
+		i &amp;= ~1; /* force an even number, rounded down */
+		if (i &gt;= 2) for(j = 0; j &lt; i; j += 2)
+		{
+			rpt_mknotch(atof(strs[j]),atof(strs[j + 1]),
+			  &amp;rpt_vars[n].filters[j &gt;&gt; 1].gain,
+			    &amp;rpt_vars[n].filters[j &gt;&gt; 1].const0,
+				&amp;rpt_vars[n].filters[j &gt;&gt; 1].const1,
+				    &amp;rpt_vars[n].filters[j &gt;&gt; 1].const2);
+			sprintf(rpt_vars[n].filters[j &gt;&gt; 1].desc,&quot;%s Hz, BW = %s&quot;,
+				strs[j],strs[j + 1]);
+		}
+
+	}
+#endif
+	longestnode = 0;
+
+	vp = ast_variable_browse(cfg, rpt_vars[n].p.nodes);
+		
+	while(vp){
+		j = strlen(vp-&gt;name);
+		if (j &gt; longestnode)
+			longestnode = j;
+		vp = vp-&gt;next;
+	}
+
+	rpt_vars[n].longestnode = longestnode;
+		
+	/*
+	* For this repeater, Determine the length of the longest function 
+	*/
+	rpt_vars[n].longestfunc = 0;
+	vp = ast_variable_browse(cfg, rpt_vars[n].p.functions);
+	while(vp){
+		j = strlen(vp-&gt;name);
+		if (j &gt; rpt_vars[n].longestfunc)
+			rpt_vars[n].longestfunc = j;
+		vp = vp-&gt;next;
+	}
+	/*
+	* For this repeater, Determine the length of the longest function 
+	*/
+	rpt_vars[n].link_longestfunc = 0;
+	vp = ast_variable_browse(cfg, rpt_vars[n].p.link_functions);
+	while(vp){
+		j = strlen(vp-&gt;name);
+		if (j &gt; rpt_vars[n].link_longestfunc)
+			rpt_vars[n].link_longestfunc = j;
+		vp = vp-&gt;next;
+	}
+	rpt_vars[n].phone_longestfunc = 0;
+	if (rpt_vars[n].p.phone_functions)
+	{
+		vp = ast_variable_browse(cfg, rpt_vars[n].p.phone_functions);
+		while(vp){
+			j = strlen(vp-&gt;name);
+			if (j &gt; rpt_vars[n].phone_longestfunc)
+				rpt_vars[n].phone_longestfunc = j;
+			vp = vp-&gt;next;
+		}
+	}
+	rpt_vars[n].dphone_longestfunc = 0;
+	if (rpt_vars[n].p.dphone_functions)
+	{
+		vp = ast_variable_browse(cfg, rpt_vars[n].p.dphone_functions);
+		while(vp){
+			j = strlen(vp-&gt;name);
+			if (j &gt; rpt_vars[n].dphone_longestfunc)
+				rpt_vars[n].dphone_longestfunc = j;
+			vp = vp-&gt;next;
+		}
+	}
+	rpt_vars[n].macro_longest = 1;
+	vp = ast_variable_browse(cfg, rpt_vars[n].p.macro);
+	while(vp){
+		j = strlen(vp-&gt;name);
+		if (j &gt; rpt_vars[n].macro_longest)
+			rpt_vars[n].macro_longest = j;
+		vp = vp-&gt;next;
+	}
+	ast_mutex_unlock(&amp;rpt_vars[n].lock);
+}
+
 /*
 * Enable or disable debug output at a given level at the console
 */
@@ -776,6 +1198,307 @@
 	return RESULT_FAILURE;
 }
 
+/*
+* Dump statistics onto console
+*/
+
+static int rpt_do_stats(int fd, int argc, char *argv[])
+{
+	int i,j;
+	int dailytxtime, dailykerchunks;
+	int totalkerchunks, dailykeyups, totalkeyups, timeouts;
+	int totalexecdcommands, dailyexecdcommands, hours, minutes, seconds;
+	long long totaltxtime;
+	struct	rpt_link *l;
+	char *listoflinks[MAX_STAT_LINKS];	
+	char *lastnodewhichkeyedusup, *lastdtmfcommand;
+	char *tot_state, *ider_state, *patch_state;
+	char *reverse_patch_state, *enable_state, *input_signal, *called_number;
+	struct rpt *myrpt;
+
+	static char *not_applicable = &quot;N/A&quot;;
+
+	if(argc != 3)
+		return RESULT_SHOWUSAGE;
+
+	for(i = 0 ; i &lt;= MAX_STAT_LINKS; i++)
+		listoflinks[i] = NULL;
+
+	tot_state = ider_state = 
+	patch_state = reverse_patch_state = 
+	input_signal = called_number = 
+	lastdtmfcommand = not_applicable;
+
+	for(i = 0; i &lt; nrpts; i++)
+	{
+		if (!strcmp(argv[2],rpt_vars[i].name)){
+			/* Make a copy of all stat variables while locked */
+			myrpt = &amp;rpt_vars[i];
+			rpt_mutex_lock(&amp;myrpt-&gt;lock); /* LOCK */
+
+			dailytxtime = myrpt-&gt;dailytxtime;
+			totaltxtime = myrpt-&gt;totaltxtime;
+			dailykeyups = myrpt-&gt;dailykeyups;
+			totalkeyups = myrpt-&gt;totalkeyups;
+			dailykerchunks = myrpt-&gt;dailykerchunks;
+			totalkerchunks = myrpt-&gt;totalkerchunks;
+			dailyexecdcommands = myrpt-&gt;dailyexecdcommands;
+			totalexecdcommands = myrpt-&gt;totalexecdcommands;
+			timeouts = myrpt-&gt;timeouts;
+
+			/* Traverse the list of connected nodes */
+			reverse_patch_state = &quot;DOWN&quot;;
+			j = 0;
+			l = myrpt-&gt;links.next;
+			while(l != &amp;myrpt-&gt;links){
+				if (l-&gt;name[0] == '0'){ /* Skip '0' nodes */
+					reverse_patch_state = &quot;UP&quot;;
+					l = l-&gt;next;
+					continue;
+				}
+				listoflinks[j] = ast_strdupa(l-&gt;name);
+				if(listoflinks[j])
+					j++;
+				l = l-&gt;next;
+			}
+
+			lastnodewhichkeyedusup = ast_strdupa(myrpt-&gt;lastnodewhichkeyedusup);			
+			if((!lastnodewhichkeyedusup) || (!strlen(lastnodewhichkeyedusup)))
+				lastnodewhichkeyedusup = not_applicable;
+
+			if(myrpt-&gt;keyed)
+				input_signal = &quot;YES&quot;;
+			else
+				input_signal = &quot;NO&quot;;
+
+			if(myrpt-&gt;enable)
+				enable_state = &quot;YES&quot;;
+			else
+				enable_state = &quot;NO&quot;;
+
+			if(!myrpt-&gt;totimer)
+				tot_state = &quot;TIMED OUT!&quot;;
+			else if(myrpt-&gt;totimer != myrpt-&gt;p.totime)
+				tot_state = &quot;ARMED&quot;;
+			else
+				tot_state = &quot;RESET&quot;;
+
+			if(myrpt-&gt;tailid)
+				ider_state = &quot;QUEUED IN TAIL&quot;;
+			else if(myrpt-&gt;mustid)
+				ider_state = &quot;QUEUED FOR CLEANUP&quot;;
+			else
+				ider_state = &quot;CLEAN&quot;;
+
+			switch(myrpt-&gt;callmode){
+				case 1:
+					patch_state = &quot;DIALING&quot;;
+					break;
+				case 2:
+					patch_state = &quot;CONNECTING&quot;;
+					break;
+				case 3:
+					patch_state = &quot;UP&quot;;
+					break;
+
+				case 4:
+					patch_state = &quot;CALL FAILED&quot;;
+					break;
+
+				default:
+					patch_state = &quot;DOWN&quot;;
+			}
+
+			if(strlen(myrpt-&gt;exten)){
+				called_number = ast_strdupa(myrpt-&gt;exten);
+				if(!called_number)
+					called_number = not_applicable;
+			}
+
+			if(strlen(myrpt-&gt;lastdtmfcommand)){
+				lastdtmfcommand = ast_strdupa(myrpt-&gt;lastdtmfcommand);
+				if(!lastdtmfcommand)
+					lastdtmfcommand = not_applicable;
+			}
+
+			rpt_mutex_unlock(&amp;myrpt-&gt;lock); /* UNLOCK */
+
+			ast_cli(fd, &quot;************************ NODE %s STATISTICS *************************\n\n&quot;, myrpt-&gt;name);
+			ast_cli(fd, &quot;Signal on input..................................: %s\n&quot;, input_signal);
+			ast_cli(fd, &quot;Transmitter enabled..............................: %s\n&quot;, enable_state);
+			ast_cli(fd, &quot;Time out timer state.............................: %s\n&quot;, tot_state);
+			ast_cli(fd, &quot;Time outs since system initialization............: %d\n&quot;, timeouts);
+			ast_cli(fd, &quot;Identifier state.................................: %s\n&quot;, ider_state);
+			ast_cli(fd, &quot;Kerchunks today..................................: %d\n&quot;, dailykerchunks);
+			ast_cli(fd, &quot;Kerchunks since system initialization............: %d\n&quot;, totalkerchunks);
+			ast_cli(fd, &quot;Keyups today.....................................: %d\n&quot;, dailykeyups);
+			ast_cli(fd, &quot;Keyups since system initialization...............: %d\n&quot;, totalkeyups);
+			ast_cli(fd, &quot;DTMF commands today..............................: %d\n&quot;, dailyexecdcommands);
+			ast_cli(fd, &quot;DTMF commands since system initialization........: %d\n&quot;, totalexecdcommands);
+			ast_cli(fd, &quot;Last DTMF command executed.......................: %s\n&quot;, lastdtmfcommand);
+
+			hours = dailytxtime/3600000;
+			dailytxtime %= 3600000;
+			minutes = dailytxtime/60000;
+			dailytxtime %= 60000;
+			seconds = dailytxtime/1000;
+			dailytxtime %= 1000;
+
+			ast_cli(fd, &quot;TX time today ...................................: %02d:%02d:%02d.%d\n&quot;,
+				hours, minutes, seconds, dailytxtime);
+
+			hours = (int) totaltxtime/3600000;
+			totaltxtime %= 3600000;
+			minutes = (int) totaltxtime/60000;
+			totaltxtime %= 60000;
+			seconds = (int)  totaltxtime/1000;
+			totaltxtime %= 1000;
+
+			ast_cli(fd, &quot;TX time since system initialization..............: %02d:%02d:%02d.%d\n&quot;,
+				 hours, minutes, seconds, (int) totaltxtime);
+			ast_cli(fd, &quot;Nodes currently connected to us..................: &quot;);
+			for(j = 0 ;; j++){
+				if(!listoflinks[j]){
+					if(!j){
+						ast_cli(fd,&quot;&lt;NONE&gt;&quot;);
+					}
+					break;
+				}
+				ast_cli(fd, &quot;%s&quot;, listoflinks[j]);
+				if(j % 4 == 3){
+					ast_cli(fd, &quot;\n&quot;);
+					ast_cli(fd, &quot;                                                 : &quot;);
+				}
+				else{
+					if(listoflinks[j + 1])
+						ast_cli(fd, &quot;, &quot;);
+				}
+			}
+			ast_cli(fd,&quot;\n&quot;);
+
+			ast_cli(fd, &quot;Last node which transmitted to us................: %s\n&quot;, lastnodewhichkeyedusup);
+			ast_cli(fd, &quot;Autopatch state..................................: %s\n&quot;, patch_state);
+			ast_cli(fd, &quot;Autopatch called number..........................: %s\n&quot;, called_number);
+			ast_cli(fd, &quot;Reverse patch/IAXRPT connected...................: %s\n\n&quot;, reverse_patch_state);
+
+		        return RESULT_SUCCESS;
+		}
+	}
+	return RESULT_FAILURE;
+}
+
+/*
+* Link stats function
+*/
+
+static int rpt_do_lstats(int fd, int argc, char *argv[])
+{
+	int i,j;
+	struct rpt *myrpt;
+	struct rpt_link *l;
+	struct rpt_lstat *s,*t;
+	struct rpt_lstat s_head;
+	if(argc != 3)
+		return RESULT_SHOWUSAGE;
+
+	s = NULL;
+	s_head.next = &amp;s_head;
+	s_head.prev = &amp;s_head;
+
+	for(i = 0; i &lt; nrpts; i++)
+	{
+		if (!strcmp(argv[2],rpt_vars[i].name)){
+			/* Make a copy of all stat variables while locked */
+			myrpt = &amp;rpt_vars[i];
+			rpt_mutex_lock(&amp;myrpt-&gt;lock); /* LOCK */
+			/* Traverse the list of connected nodes */
+			j = 0;
+			l = myrpt-&gt;links.next;
+			while(l != &amp;myrpt-&gt;links){
+				if (l-&gt;name[0] == '0'){ /* Skip '0' nodes */
+					l = l-&gt;next;
+					continue;
+				}
+				if((s = (struct rpt_lstat *) malloc(sizeof(struct rpt_lstat))) == NULL){
+					ast_log(LOG_ERROR, &quot;Malloc failed in rpt_do_lstats\n&quot;);
+					rpt_mutex_unlock(&amp;myrpt-&gt;lock); /* UNLOCK */
+					return RESULT_FAILURE;
+				}
+				memset(s, 0, sizeof(struct rpt_lstat));
+				strncpy(s-&gt;name, l-&gt;name, MAXREMSTR - 1);
+				pbx_substitute_variables_helper(l-&gt;chan, &quot;${IAXPEER(CURRENTCHANNEL)}&quot;, s-&gt;peer, MAXPEERSTR - 1);
+				s-&gt;mode = l-&gt;mode;
+				s-&gt;outbound = l-&gt;outbound;
+				s-&gt;reconnects = l-&gt;reconnects;
+				s-&gt;connecttime = l-&gt;connecttime;
+				insque((struct qelem *) s, (struct qelem *) s_head.next);
+				l = l-&gt;next;
+			}
+			rpt_mutex_unlock(&amp;myrpt-&gt;lock); /* UNLOCK */
+			ast_cli(fd, &quot;NODE      PEER                RECONNECTS  DIRECTION  CONNECT TIME\n&quot;);
+			ast_cli(fd, &quot;----      ----                ----------  ---------  ------------\n&quot;);
+
+			for(s = s_head.next; s != &amp;s_head; s = s-&gt;next){
+				int hours, minutes, seconds;
+				long long connecttime = s-&gt;connecttime;
+				char conntime[31];
+				hours = (int) connecttime/3600000;
+				connecttime %= 3600000;
+				minutes = (int) connecttime/60000;
+				connecttime %= 60000;
+				seconds = (int)  connecttime/1000;
+				connecttime %= 1000;
+				snprintf(conntime, 30, &quot;%02d:%02d:%02d.%d&quot;,
+					hours, minutes, seconds, (int) connecttime);
+				conntime[30] = 0;
+				ast_cli(fd, &quot;%-10s%-20s%-12d%-11s%-30s\n&quot;,
+					s-&gt;name, s-&gt;peer, s-&gt;reconnects, (s-&gt;outbound)? &quot;OUT&quot;:&quot;IN&quot;, conntime);
+			}	
+			/* destroy our local link queue */
+			s = s_head.next;
+			while(s != &amp;s_head){
+				t = s;
+				s = s-&gt;next;
+				remque((struct qelem *)t);
+				free(t);
+			}			
+			return RESULT_SUCCESS;
+		}
+	}
+	return RESULT_FAILURE;
+}
+
+/*
+* reload vars 
+*/
+                                                                                                                                 
+static int rpt_do_reload(int fd, int argc, char *argv[])
+{
+int	n;
+
+        if (argc &gt; 2) return RESULT_SHOWUSAGE;
+
+	for(n = 0; n &lt; nrpts; n++) rpt_vars[n].reload = 1;
+
+	return RESULT_FAILURE;
+}
+
+/*
+* restart app_rpt
+*/
+                                                                                                                                 
+static int rpt_do_restart(int fd, int argc, char *argv[])
+{
+int	i;
+
+        if (argc &gt; 2) return RESULT_SHOWUSAGE;
+	for(i = 0; i &lt; nrpts; i++)
+	{
+		if (rpt_vars[i].rxchannel) ast_softhangup(rpt_vars[i].rxchannel,AST_SOFTHANGUP_DEV);
+	}
+	return RESULT_FAILURE;
+}
+
 static int play_tone_pair(struct ast_channel *chan, int f1, int f2, int duration, int amplitude)
 {
 	int res;
@@ -1054,28 +1777,8 @@
 }
 
 
-/* Retrieve an int from a config file */
-                                                                                
-static int retrieve_astcfgint(char *category, char *name, int min, int max, int defl)
+static int telem_any(struct rpt *myrpt,struct ast_channel *chan, char *entry)
 {
-        char *var;
-        int ret;
-                                                                                
-        var = ast_variable_retrieve(cfg, category, name);
-        if(var){
-                ret = myatoi(var);
-                if(ret &lt; min)
-                        ret = min;
-                if(ret &gt; max)
-                        ret = max;
-        }
-        else
-                ret = defl;
-        return ret;
-}
-
-static int telem_any(struct ast_channel *chan, char *entry)
-{
 	int res;
 	char c;
 	
@@ -1089,11 +1792,11 @@
 	res = 0;
 	
 	if(!morseidfreq){ /* Get the morse parameters if not already loaded */
-		morsespeed = retrieve_astcfgint( mcat, &quot;speed&quot;, 5, 20, 20);
-        	morsefreq = retrieve_astcfgint( mcat, &quot;frequency&quot;, 300, 3000, 800);
-        	morseampl = retrieve_astcfgint( mcat, &quot;amplitude&quot;, 200, 8192, 4096);
-		morseidampl = retrieve_astcfgint( mcat, &quot;idamplitude&quot;, 200, 8192, 2048);
-		morseidfreq = retrieve_astcfgint( mcat, &quot;idfrequency&quot;, 300, 3000, 330);	
+		morsespeed = retrieve_astcfgint(myrpt, mcat, &quot;speed&quot;, 5, 20, 20);
+        	morsefreq = retrieve_astcfgint(myrpt, mcat, &quot;frequency&quot;, 300, 3000, 800);
+        	morseampl = retrieve_astcfgint(myrpt, mcat, &quot;amplitude&quot;, 200, 8192, 4096);
+		morseidampl = retrieve_astcfgint(myrpt, mcat, &quot;idamplitude&quot;, 200, 8192, 2048);
+		morseidfreq = retrieve_astcfgint(myrpt, mcat, &quot;idfrequency&quot;, 300, 3000, 330);	
 	}
 	
 	/* Is it a file, or a tone sequence? */
@@ -1130,7 +1833,7 @@
 * 4 types of telemtry are handled: Morse ID, Morse Message, Tone Sequence, and a File containing a recording.
 */
 
-static int telem_lookup(struct ast_channel *chan, char *node, char *name)
+static int telem_lookup(struct rpt *myrpt,struct ast_channel *chan, char *node, char *name)
 {
 	
 	int res;
@@ -1143,21 +1846,19 @@
 	telemetry_save = NULL;
 	entry = NULL;
 	
-	
 	/* Retrieve the section name for telemetry from the node section */
-	
-	telemetry = ast_variable_retrieve(cfg, node, TELEMETRY);
-	if(telemetry){
+	telemetry = ast_variable_retrieve(myrpt-&gt;cfg, node, TELEMETRY);
+	if(telemetry ){
 		telemetry_save = ast_strdupa(telemetry);
 		if(!telemetry_save){
 			ast_log(LOG_WARNING,&quot;ast_strdupa() failed in telem_lookup()\n&quot;);
 			return res;
 		}
-		entry = ast_variable_retrieve(cfg, telemetry_save, name);
+		entry = ast_variable_retrieve(myrpt-&gt;cfg, telemetry_save, name);
 	}
 	
-	/* Try to look up the telemetry name */
-	
+	/* Try to look up the telemetry name */	
+
 	if(!entry){
 		/* Telemetry name wasn't found in the config file, use the default */
 		for(i = 0; i &lt; sizeof(tele_defs)/sizeof(struct telem_defaults) ; i++){
@@ -1165,10 +1866,11 @@
 				entry = tele_defs[i].value;
 		}
 	}
-	if(entry)	
-		telem_any(chan, entry);
+	if(entry){	
+		if(strlen(entry))
+			telem_any(myrpt,chan, entry);
+	}
 	else{
-		ast_log(LOG_WARNING, &quot;Telemetry name not found: %s\n&quot;, name);
 		res = -1;
 	}
 	return res;
@@ -1185,7 +1887,7 @@
         char *wait_times_save;
                                                                                                                   
         wait_times_save = NULL;
-        wait_times = ast_variable_retrieve(cfg, myrpt-&gt;name, &quot;wait_times&quot;);
+        wait_times = ast_variable_retrieve(myrpt-&gt;cfg, myrpt-&gt;name, &quot;wait_times&quot;);
                                                                                                                   
         if(wait_times){
                 wait_times_save = ast_strdupa(wait_times);
@@ -1198,28 +1900,28 @@
         switch(type){
                 case DLY_TELEM:
                         if(wait_times)
-                                interval = retrieve_astcfgint(wait_times_save, &quot;telemwait&quot;, 500, 5000, 1000);
+                                interval = retrieve_astcfgint(myrpt,wait_times_save, &quot;telemwait&quot;, 500, 5000, 1000);
                         else
                                 interval = 1000;
                         break;
                                                                                                                   
                 case DLY_ID:
                         if(wait_times)
-                                interval = retrieve_astcfgint(wait_times_save, &quot;idwait&quot;,250,5000,500);
+                                interval = retrieve_astcfgint(myrpt,wait_times_save, &quot;idwait&quot;,250,5000,500);
                         else
                                 interval = 500;
                         break;
                                                                                                                   
                 case DLY_UNKEY:
                         if(wait_times)
-                                interval = retrieve_astcfgint(wait_times_save, &quot;unkeywait&quot;,500,5000,1000);
+                                interval = retrieve_astcfgint(myrpt,wait_times_save, &quot;unkeywait&quot;,500,5000,1000);
                         else
                                 interval = 1000;
                         break;
                                                                                                                   
                 case DLY_CALLTERM:
                         if(wait_times)
-                                interval = retrieve_astcfgint(wait_times_save, &quot;calltermwait&quot;,500,5000,1500);
+                                interval = retrieve_astcfgint(myrpt,wait_times_save, &quot;calltermwait&quot;,500,5000,1500);
                         else
                                 interval = 1500;
                         break;
@@ -1239,8 +1941,13 @@
 static void wait_interval(struct rpt *myrpt, int type, struct ast_channel *chan)
 {
 	int interval;
-	if((interval = get_wait_interval(myrpt, type)))
+	interval = get_wait_interval(myrpt, type);
+	if(debug)
+		ast_log(LOG_NOTICE,&quot; Delay interval = %d\n&quot;, interval);
+	if(interval)
 		ast_safe_sleep(chan,interval);
+	if(debug)
+		ast_log(LOG_NOTICE,&quot;Delay complete\n&quot;);
 	return;
 }
 
@@ -1264,9 +1971,8 @@
 
 	/* Snag copies of a few key myrpt variables */
 	rpt_mutex_lock(&amp;myrpt-&gt;lock);
-	insque((struct qelem *)mytele, (struct qelem *)myrpt-&gt;tele.next); /* Moved from rpt_telemetry() */
 	nodename = ast_strdupa(myrpt-&gt;name);
-	ident = ast_strdupa(myrpt-&gt;ident);
+	ident = ast_strdupa(myrpt-&gt;p.ident);
 	rpt_mutex_unlock(&amp;myrpt-&gt;lock);
 	
 	/* allocate a pseudo-channel thru asterisk */
@@ -1314,35 +2020,41 @@
 	    case ID1:
 		/* wait a bit */
 		wait_interval(myrpt, (mytele-&gt;mode == ID) ? DLY_ID : DLY_TELEM,mychannel);
-		res = telem_any(mychannel, ident); 
+		res = telem_any(myrpt,mychannel, ident); 
 		imdone=1;	
 		break;
 		
 	    case TAILMSG:
-		res = ast_streamfile(mychannel, myrpt-&gt;tailmessages[myrpt-&gt;tailmessagen], mychannel-&gt;language); 
+		res = ast_streamfile(mychannel, myrpt-&gt;p.tailmessages[myrpt-&gt;tailmessagen], mychannel-&gt;language); 
 		break;
 		
 	    case IDTALKOVER:
-	    	p = ast_variable_retrieve(cfg, nodename, &quot;idtalkover&quot;);
+	    	p = ast_variable_retrieve(myrpt-&gt;cfg, nodename, &quot;idtalkover&quot;);
 	    	if(p)
-			res = telem_any(mychannel, p); 
+			res = telem_any(myrpt,mychannel, p); 
 		imdone=1;	
 	    	break;
 	    		
 	    case PROC:
 		/* wait a little bit longer */
 		wait_interval(myrpt, DLY_TELEM, mychannel);
-		res = ast_streamfile(mychannel, &quot;rpt/callproceeding&quot;, mychannel-&gt;language);
+		res = telem_lookup(myrpt, mychannel, myrpt-&gt;name, &quot;patchup&quot;);
+		if(res &lt; 0){ /* Then default message */
+			res = ast_streamfile(mychannel, &quot;rpt/callproceeding&quot;, mychannel-&gt;language);
+		}
 		break;
 	    case TERM:
 		/* wait a little bit longer */
 		wait_interval(myrpt, DLY_CALLTERM, mychannel);
-		res = ast_streamfile(mychannel, &quot;rpt/callterminated&quot;, mychannel-&gt;language);
+		res = telem_lookup(myrpt, mychannel, myrpt-&gt;name, &quot;patchdown&quot;);
+		if(res &lt; 0){ /* Then default message */
+			res = ast_streamfile(mychannel, &quot;rpt/callterminated&quot;, mychannel-&gt;language);
+		}
 		break;
 	    case COMPLETE:
 		/* wait a little bit */
 		wait_interval(myrpt, DLY_TELEM, mychannel);
-		res = telem_lookup(mychannel, myrpt-&gt;name, &quot;functcomplete&quot;);
+		res = telem_lookup(myrpt,mychannel, myrpt-&gt;name, &quot;functcomplete&quot;);
 		break;
 	    case MACRO_NOTFOUND:
 		/* wait a little bit */
@@ -1355,7 +2067,11 @@
 		res = ast_streamfile(mychannel, &quot;rpt/macro_busy&quot;, mychannel-&gt;language);
 		break;
 	    case UNKEY:
-
+		if(myrpt-&gt;patchnoct &amp;&amp; myrpt-&gt;callmode){ /* If no CT during patch configured, then don't send one */
+			imdone = 1;
+			break;
+		}
+			
 		/*
 		* Reset the Unkey to CT timer
 		*/
@@ -1411,7 +2127,12 @@
 			imdone = 1;
 			break;
 		}
-			
+		
+		rpt_mutex_lock(&amp;myrpt-&gt;lock); /* Update the kerchunk counters */
+		myrpt-&gt;dailykerchunks++;
+		myrpt-&gt;totalkerchunks++;
+		rpt_mutex_unlock(&amp;myrpt-&gt;lock);
+	
 		haslink = 0;
 		hastx = 0;
 		hasremote = 0;		
@@ -1438,7 +2159,7 @@
 		if (haslink)
 		{
 
-			res = telem_lookup(mychannel, myrpt-&gt;name, (!hastx) ? &quot;remotemon&quot; : &quot;remotetx&quot;);
+			res = telem_lookup(myrpt,mychannel, myrpt-&gt;name, (!hastx) ? &quot;remotemon&quot; : &quot;remotetx&quot;);
 			if(res)
 				ast_log(LOG_WARNING, &quot;telem_lookup:remotexx failed on %s\n&quot;, mychannel-&gt;name);
 			
@@ -1447,15 +2168,15 @@
 			if (myrpt-&gt;cmdnode[0])
 			{
 				ast_safe_sleep(mychannel,200);
-				res = telem_lookup(mychannel, myrpt-&gt;name, &quot;cmdmode&quot;);
+				res = telem_lookup(myrpt,mychannel, myrpt-&gt;name, &quot;cmdmode&quot;);
 				if(res)
 				 	ast_log(LOG_WARNING, &quot;telem_lookup:cmdmode failed on %s\n&quot;, mychannel-&gt;name);
 				ast_stopstream(mychannel);
 			}
 		}
-		else if((ct = ast_variable_retrieve(cfg, nodename, &quot;unlinkedct&quot;))){ /* Unlinked Courtesy Tone */
+		else if((ct = ast_variable_retrieve(myrpt-&gt;cfg, nodename, &quot;unlinkedct&quot;))){ /* Unlinked Courtesy Tone */
 			ct_copy = ast_strdupa(ct);
-			res = telem_lookup(mychannel, myrpt-&gt;name, ct_copy);
+			res = telem_lookup(myrpt,mychannel, myrpt-&gt;name, ct_copy);
 			if(res)
 			 	ast_log(LOG_WARNING, &quot;telem_lookup:ctx failed on %s\n&quot;, mychannel-&gt;name);		
 		}	
@@ -1477,14 +2198,42 @@
 				ast_hangup(mychannel);
 				pthread_exit(NULL);
 			}
-			if((ct = ast_variable_retrieve(cfg, nodename, &quot;remotect&quot;))){ /* Unlinked Courtesy Tone */
+			if((ct = ast_variable_retrieve(myrpt-&gt;cfg, nodename, &quot;remotect&quot;))){ /* Unlinked Courtesy Tone */
 				ast_safe_sleep(mychannel,200);
 				ct_copy = ast_strdupa(ct);
-				res = telem_lookup(mychannel, myrpt-&gt;name, ct_copy);
+				res = telem_lookup(myrpt,mychannel, myrpt-&gt;name, ct_copy);
 				if(res)
 				 	ast_log(LOG_WARNING, &quot;telem_lookup:ctx failed on %s\n&quot;, mychannel-&gt;name);		
 			}	
 		}
+#ifdef	_MDC_DECODE_H_
+		if (myrpt-&gt;lastunit)
+		{
+			char mystr[10];
+
+			ast_safe_sleep(mychannel,200);
+			/* set for all to hear */
+			ci.chan = 0;
+			ci.confno = myrpt-&gt;txconf;
+			ci.confmode = ZT_CONF_CONFANN;
+			/* first put the channel on the conference in announce mode */
+			if (ioctl(mychannel-&gt;fds[0],ZT_SETCONF,&amp;ci) == -1)
+			{
+				ast_log(LOG_WARNING, &quot;Unable to set conference mode to Announce\n&quot;);
+				rpt_mutex_lock(&amp;myrpt-&gt;lock);
+				remque((struct qelem *)mytele);
+				rpt_mutex_unlock(&amp;myrpt-&gt;lock);
+				ast_log(LOG_NOTICE,&quot;Telemetry thread aborted at line %d, mode: %d\n&quot;,__LINE__, mytele-&gt;mode); /*@@@@@@@@@@@*/
+				free(mytele);		
+				ast_hangup(mychannel);
+				pthread_exit(NULL);
+			}
+			sprintf(mystr,&quot;%04x&quot;,myrpt-&gt;lastunit);
+			myrpt-&gt;lastunit = 0;
+			ast_say_character_str(mychannel,mystr,NULL,mychannel-&gt;language);
+			break;
+		}
+#endif
 		imdone = 1;
 		break;
 	    case REMDISC:
@@ -1637,6 +2386,34 @@
 		}			
 		imdone = 1;
 		break;
+
+	    case LASTNODEKEY: /* Identify last node which keyed us up */
+		rpt_mutex_lock(&amp;myrpt-&gt;lock);
+		if(myrpt-&gt;lastnodewhichkeyedusup)
+			p = ast_strdupa(myrpt-&gt;lastnodewhichkeyedusup); /* Make a local copy of the node name */
+		else
+			p = NULL;
+		rpt_mutex_unlock(&amp;myrpt-&gt;lock);
+		if(!p){
+			imdone = 1; /* no node previously keyed us up, or the node which did has been disconnected */
+			break;
+		}
+		wait_interval(myrpt, DLY_TELEM, mychannel);
+		res = ast_streamfile(mychannel, &quot;rpt/node&quot;, mychannel-&gt;language);
+		if (!res) 
+			res = ast_waitstream(mychannel, &quot;&quot;);
+		else
+			 ast_log(LOG_WARNING, &quot;ast_streamfile failed on %s\n&quot;, mychannel-&gt;name);
+		ast_stopstream(mychannel);
+		ast_say_character_str(mychannel, p, NULL, mychannel-&gt;language);
+		if (!res) 
+			res = ast_waitstream(mychannel, &quot;&quot;);
+		else
+			ast_log(LOG_WARNING, &quot;ast_streamfile failed on %s\n&quot;, mychannel-&gt;name);
+		ast_stopstream(mychannel);
+		imdone = 1;
+		break;		
+
 	    case TIMEOUT:
 		res = ast_streamfile(mychannel, &quot;rpt/node&quot;, mychannel-&gt;language);
 		if (!res) 
@@ -1784,11 +2561,11 @@
 		if (!res)
 		{
 			myrpt-&gt;tailmessagen++;
-			if(myrpt-&gt;tailmessagen &gt;= myrpt-&gt;tailmessagemax) myrpt-&gt;tailmessagen = 0;
+			if(myrpt-&gt;tailmessagen &gt;= myrpt-&gt;p.tailmessagemax) myrpt-&gt;tailmessagen = 0;
 		}
 		else
 		{
-			myrpt-&gt;tmsgtimer = myrpt-&gt;tailsquashedtime;
+			myrpt-&gt;tmsgtimer = myrpt-&gt;p.tailsquashedtime;
 		}
 	}
 	remque((struct qelem *)mytele);
@@ -1838,12 +2615,17 @@
 		strncpy(tele-&gt;param, (char *) data, TELEPARAMSIZE - 1);
 		tele-&gt;param[TELEPARAMSIZE - 1] = 0;
 	}
+	insque((struct qelem *)tele, (struct qelem *)myrpt-&gt;tele.next);
 	rpt_mutex_unlock(&amp;myrpt-&gt;lock);
         pthread_attr_init(&amp;attr);
         pthread_attr_setdetachstate(&amp;attr, PTHREAD_CREATE_DETACHED);
 	res = ast_pthread_create(&amp;tele-&gt;threadid,&amp;attr,rpt_tele_thread,(void *) tele);
-	if(res &lt; 0)
+	if(res &lt; 0){
+		rpt_mutex_lock(&amp;myrpt-&gt;lock);
+		remque((struct qlem *) tele); /* We don't like stuck transmitters, remove it from the queue */
+		rpt_mutex_unlock(&amp;myrpt-&gt;lock);	
 		ast_log(LOG_WARNING, &quot;Could not create telemetry thread: %s&quot;,strerror(res));
+	}
 	return;
 }
 
@@ -1853,9 +2635,10 @@
 struct	rpt *myrpt = (struct rpt *)this;
 int	res;
 struct	ast_frame wf;
-int stopped,congstarted;
+int stopped,congstarted,dialtimer,lastcidx,aborted;
 struct ast_channel *mychannel,*genchannel;
 
+
 	myrpt-&gt;mydtmf = 0;
 	/* allocate a pseudo-channel thru asterisk */
 	mychannel = ast_request(&quot;zap&quot;,AST_FORMAT_SLINEAR,&quot;pseudo&quot;,NULL);
@@ -1897,24 +2680,24 @@
 		myrpt-&gt;callmode = 0;
 		pthread_exit(NULL);
 	}
-	if (myrpt-&gt;tonezone &amp;&amp; (tone_zone_set_zone(mychannel-&gt;fds[0],myrpt-&gt;tonezone) == -1))
+	if (myrpt-&gt;p.tonezone &amp;&amp; (tone_zone_set_zone(mychannel-&gt;fds[0],myrpt-&gt;p.tonezone) == -1))
 	{
-		ast_log(LOG_WARNING, &quot;Unable to set tone zone %s\n&quot;,myrpt-&gt;tonezone);
+		ast_log(LOG_WARNING, &quot;Unable to set tone zone %s\n&quot;,myrpt-&gt;p.tonezone);
 		ast_hangup(mychannel);
 		ast_hangup(genchannel);
 		myrpt-&gt;callmode = 0;
 		pthread_exit(NULL);
 	}
-	if (myrpt-&gt;tonezone &amp;&amp; (tone_zone_set_zone(genchannel-&gt;fds[0],myrpt-&gt;tonezone) == -1))
+	if (myrpt-&gt;p.tonezone &amp;&amp; (tone_zone_set_zone(genchannel-&gt;fds[0],myrpt-&gt;p.tonezone) == -1))
 	{
-		ast_log(LOG_WARNING, &quot;Unable to set tone zone %s\n&quot;,myrpt-&gt;tonezone);
+		ast_log(LOG_WARNING, &quot;Unable to set tone zone %s\n&quot;,myrpt-&gt;p.tonezone);
 		ast_hangup(mychannel);
 		ast_hangup(genchannel);
 		myrpt-&gt;callmode = 0;
 		pthread_exit(NULL);
 	}
-	/* start dialtone */
-	if (tone_zone_play_tone(mychannel-&gt;fds[0],ZT_TONE_DIALTONE) &lt; 0)
+	/* start dialtone if patchquiet is 0. Special patch modes don't send dial tone */
+	if ((!myrpt-&gt;patchquiet) &amp;&amp; (tone_zone_play_tone(mychannel-&gt;fds[0],ZT_TONE_DIALTONE) &lt; 0))
 	{
 		ast_log(LOG_WARNING, &quot;Cannot start dialtone\n&quot;);
 		ast_hangup(mychannel);
@@ -1924,20 +2707,40 @@
 	}
 	stopped = 0;
 	congstarted = 0;
+	dialtimer = 0;
+	lastcidx = 0;
+	aborted = 0;
+
+
 	while ((myrpt-&gt;callmode == 1) || (myrpt-&gt;callmode == 4))
 	{
 
-		if ((myrpt-&gt;callmode == 1) &amp;&amp; (myrpt-&gt;cidx &gt; 0) &amp;&amp; (!stopped))
+		if((myrpt-&gt;patchdialtime)&amp;&amp;(myrpt-&gt;callmode == 1)&amp;&amp;(myrpt-&gt;cidx != lastcidx)){
+			dialtimer = 0;
+			lastcidx = myrpt-&gt;cidx;
+		}		
+
+		if((myrpt-&gt;patchdialtime)&amp;&amp;(dialtimer &gt;= myrpt-&gt;patchdialtime)){ 
+			rpt_mutex_lock(&amp;myrpt-&gt;lock);
+			aborted = 1;
+			myrpt-&gt;callmode = 0;
+			rpt_mutex_unlock(&amp;myrpt-&gt;lock);
+			break;
+		}
+	
+		if ((!myrpt-&gt;patchquiet) &amp;&amp; (!stopped) &amp;&amp; (myrpt-&gt;callmode == 1) &amp;&amp; (myrpt-&gt;cidx &gt; 0))
 		{
 			stopped = 1;
 			/* stop dial tone */
 			tone_zone_play_tone(mychannel-&gt;fds[0],-1);
 		}
-		if ((myrpt-&gt;callmode == 4) &amp;&amp; (!congstarted))
+		if (myrpt-&gt;callmode == 4)
 		{
-			congstarted = 1;
-			/* start congestion tone */
-			tone_zone_play_tone(mychannel-&gt;fds[0],ZT_TONE_CONGESTION);
+			if(!congstarted){
+				congstarted = 1;
+				/* start congestion tone */
+				tone_zone_play_tone(mychannel-&gt;fds[0],ZT_TONE_CONGESTION);
+			}
 		}
 		res = ast_safe_sleep(mychannel, MSWAIT);
 		if (res &lt; 0)
@@ -1949,6 +2752,7 @@
 			rpt_mutex_unlock(&amp;myrpt-&gt;lock);
 			pthread_exit(NULL);
 		}
+		dialtimer += MSWAIT;
 	}
 	/* stop any tone generation */
 	tone_zone_play_tone(mychannel-&gt;fds[0],-1);
@@ -1960,12 +2764,14 @@
 		rpt_mutex_lock(&amp;myrpt-&gt;lock);
 		myrpt-&gt;callmode = 0;
 		rpt_mutex_unlock(&amp;myrpt-&gt;lock);
+		if((!myrpt-&gt;patchquiet) &amp;&amp; aborted)
+			rpt_telemetry(myrpt, TERM, NULL);
 		pthread_exit(NULL);			
 	}
 
-	if (myrpt-&gt;ourcallerid &amp;&amp; *myrpt-&gt;ourcallerid){
+	if (myrpt-&gt;p.ourcallerid &amp;&amp; *myrpt-&gt;p.ourcallerid){
 		char *name, *loc, *instr;
-		instr = strdup(myrpt-&gt;ourcallerid);
+		instr = strdup(myrpt-&gt;p.ourcallerid);
 		if(instr){
 			ast_callerid_parse(instr, &amp;name, &amp;loc);
 			if(loc){
@@ -1983,9 +2789,10 @@
 	}
 
 	strncpy(mychannel-&gt;exten, myrpt-&gt;exten, sizeof(mychannel-&gt;exten) - 1);
-	strncpy(mychannel-&gt;context, myrpt-&gt;ourcontext, sizeof(mychannel-&gt;context) - 1);
-	if (myrpt-&gt;acctcode)
-		ast_string_field_set(mychannel, accountcode, myrpt-&gt;acctcode);
+	strncpy(mychannel-&gt;context, myrpt-&gt;patchcontext, sizeof(mychannel-&gt;context) - 1);
+	
+	if (myrpt-&gt;p.acctcode)
+		strncpy((char *)mychannel-&gt;accountcode, myrpt-&gt;p.acctcode, sizeof(mychannel-&gt;accountcode) - 1);
 	mychannel-&gt;priority = 1;
 	ast_channel_undefer_dtmf(mychannel);
 	if (ast_pbx_start(mychannel) &lt; 0)
@@ -2001,15 +2808,39 @@
 	usleep(10000);
 	rpt_mutex_lock(&amp;myrpt-&gt;lock);
 	myrpt-&gt;callmode = 3;
+	/* set appropriate conference for the pseudo */
+	ci.chan = 0;
+	ci.confno = myrpt-&gt;conf;
+	ci.confmode = (myrpt-&gt;p.duplex == 2) ? ZT_CONF_CONFANNMON :
+		(ZT_CONF_CONF | ZT_CONF_LISTENER | ZT_CONF_TALKER);
+	/* first put the channel on the conference in announce mode */
+	if (ioctl(myrpt-&gt;pchannel-&gt;fds[0],ZT_SETCONF,&amp;ci) == -1)
+	{
+		ast_log(LOG_WARNING, &quot;Unable to set conference mode to Announce\n&quot;);
+		ast_hangup(mychannel);
+		ast_hangup(genchannel);
+		myrpt-&gt;callmode = 0;
+		pthread_exit(NULL);
+	}
 	while(myrpt-&gt;callmode)
 	{
 		if ((!mychannel-&gt;pbx) &amp;&amp; (myrpt-&gt;callmode != 4))
 		{
-			myrpt-&gt;callmode = 4;
-			rpt_mutex_unlock(&amp;myrpt-&gt;lock);
-			/* start congestion tone */
-			tone_zone_play_tone(genchannel-&gt;fds[0],ZT_TONE_CONGESTION);
-			rpt_mutex_lock(&amp;myrpt-&gt;lock);
+			if(myrpt-&gt;patchfarenddisconnect){ /* If patch is setup for far end disconnect */
+				myrpt-&gt;callmode = 0;
+				if(!myrpt-&gt;patchquiet){
+					rpt_mutex_unlock(&amp;myrpt-&gt;lock);
+					rpt_telemetry(myrpt, TERM, NULL);
+					rpt_mutex_lock(&amp;myrpt-&gt;lock);
+				}
+			}
+			else{ /* Send congestion until patch is downed by command */
+				myrpt-&gt;callmode = 4;
+				rpt_mutex_unlock(&amp;myrpt-&gt;lock);
+				/* start congestion tone */
+				tone_zone_play_tone(genchannel-&gt;fds[0],ZT_TONE_CONGESTION);
+				rpt_mutex_lock(&amp;myrpt-&gt;lock);
+			}
 		}
 		if (myrpt-&gt;mydtmf)
 		{
@@ -2036,6 +2867,16 @@
 	rpt_mutex_lock(&amp;myrpt-&gt;lock);
 	myrpt-&gt;callmode = 0;
 	rpt_mutex_unlock(&amp;myrpt-&gt;lock);
+	/* set appropriate conference for the pseudo */
+	ci.chan = 0;
+	ci.confno = myrpt-&gt;conf;
+	ci.confmode = ((myrpt-&gt;p.duplex == 2) || (myrpt-&gt;p.duplex == 4)) ? ZT_CONF_CONFANNMON :
+		(ZT_CONF_CONF | ZT_CONF_LISTENER | ZT_CONF_TALKER);
+	/* first put the channel on the conference in announce mode */
+	if (ioctl(myrpt-&gt;pchannel-&gt;fds[0],ZT_SETCONF,&amp;ci) == -1)
+	{
+		ast_log(LOG_WARNING, &quot;Unable to set conference mode to Announce\n&quot;);
+	}
 	pthread_exit(NULL);
 }
 
@@ -2092,6 +2933,7 @@
 	char tmp[300], deststr[300] = &quot;&quot;,modechange = 0;
 	char digitbuf[MAXNODESTR];
 	struct rpt_link *l;
+	int reconnects = 0;
 	ZT_CONFINFO ci;  /* conference info */
 
 	if(!param)
@@ -2110,7 +2952,7 @@
 		case 1: /* Link off */
 			if ((digitbuf[0] == '0') &amp;&amp; (myrpt-&gt;lastlinknode[0]))
 				strcpy(digitbuf,myrpt-&gt;lastlinknode);
-			val = ast_variable_retrieve(cfg, myrpt-&gt;nodes, digitbuf);
+			val = ast_variable_retrieve(myrpt-&gt;cfg, myrpt-&gt;p.nodes, digitbuf);
 			if (!val){
 				if(strlen(digitbuf) &gt;= myrpt-&gt;longestnode)
 					return DC_ERROR;
@@ -2136,7 +2978,6 @@
 			}
 			if (l != &amp;myrpt-&gt;links){ /* if found */
 				struct	ast_frame wf;
-
 				strncpy(myrpt-&gt;lastlinknode,digitbuf,MAXNODESTR - 1);
 				l-&gt;retries = MAX_RETRIES + 1;
 				l-&gt;disced = 1;
@@ -2162,7 +3003,7 @@
 		case 2: /* Link Monitor */
 			if ((digitbuf[0] == '0') &amp;&amp; (myrpt-&gt;lastlinknode[0]))
 				strcpy(digitbuf,myrpt-&gt;lastlinknode);
-			val = ast_variable_retrieve(cfg, myrpt-&gt;nodes, digitbuf);
+			val = ast_variable_retrieve(myrpt-&gt;cfg, myrpt-&gt;p.nodes, digitbuf);
 			if (!val){
 				if(strlen(digitbuf) &gt;= myrpt-&gt;longestnode)
 					return DC_ERROR;
@@ -2196,6 +3037,7 @@
 					return DC_COMPLETE;
 					
 				}
+				reconnects = l-&gt;reconnects;
 				rpt_mutex_unlock(&amp;myrpt-&gt;lock);
 				if (l-&gt;chan) ast_softhangup(l-&gt;chan,AST_SOFTHANGUP_DEV);
 				l-&gt;retries = MAX_RETRIES + 1;
@@ -2270,6 +3112,7 @@
 				return DC_ERROR;
 			}
 			rpt_mutex_lock(&amp;myrpt-&gt;lock);
+			l-&gt;reconnects = reconnects;
 			/* insert at end of queue */
 			insque((struct qelem *)l,(struct qelem *)myrpt-&gt;links.next);
 			rpt_mutex_unlock(&amp;myrpt-&gt;lock);
@@ -2278,7 +3121,7 @@
 		case 3: /* Link transceive */
 			if ((digitbuf[0] == '0') &amp;&amp; (myrpt-&gt;lastlinknode[0]))
 				strcpy(digitbuf,myrpt-&gt;lastlinknode);
-			val = ast_variable_retrieve(cfg, myrpt-&gt;nodes, digitbuf);
+			val = ast_variable_retrieve(myrpt-&gt;cfg, myrpt-&gt;p.nodes, digitbuf);
 			if (!val){
 				if(strlen(digitbuf) &gt;= myrpt-&gt;longestnode)
 					return DC_ERROR;
@@ -2310,6 +3153,7 @@
 					rpt_telemetry(myrpt, REMALREADY, NULL);
 					return DC_COMPLETE;
 				}
+				reconnects = l-&gt;reconnects;
 				rpt_mutex_unlock(&amp;myrpt-&gt;lock);
 				if (l-&gt;chan) ast_softhangup(l-&gt;chan, AST_SOFTHANGUP_DEV);
 				l-&gt;retries = MAX_RETRIES + 1;
@@ -2386,6 +3230,7 @@
 				return DC_ERROR;
 			}
 			rpt_mutex_lock(&amp;myrpt-&gt;lock);
+			l-&gt;reconnects = reconnects;
 			/* insert at end of queue */
 			insque((struct qelem *)l,(struct qelem *)myrpt-&gt;links.next);
 			rpt_mutex_unlock(&amp;myrpt-&gt;lock);
@@ -2406,7 +3251,7 @@
 			if ((digitbuf[0] == '0') &amp;&amp; (myrpt-&gt;lastlinknode[0]))
 				strcpy(digitbuf,myrpt-&gt;lastlinknode);
 			/* node must at least exist in list */
-			val = ast_variable_retrieve(cfg, myrpt-&gt;nodes, digitbuf);
+			val = ast_variable_retrieve(myrpt-&gt;cfg, myrpt-&gt;p.nodes, digitbuf);
 			if (!val){
 				if(strlen(digitbuf) &gt;= myrpt-&gt;longestnode)
 					return DC_ERROR;
@@ -2428,12 +3273,16 @@
 		case 6: /* All Links Off */
 			l = myrpt-&gt;links.next;
 			
-			while(l != &amp;myrpt-&gt;links){
+			while(l != &amp;myrpt-&gt;links){ /* This code is broke and needs to be changed to work with the reconnect kludge */
 				if (l-&gt;chan) ast_softhangup(l-&gt;chan, AST_SOFTHANGUP_DEV); /* Hang 'em up */
 				l = l-&gt;next;
 			}
 			rpt_telemetry(myrpt, COMPLETE, NULL);
 			break;
+
+		case 7: /* Identify last node which keyed us up */
+			rpt_telemetry(myrpt, LASTNODEKEY, NULL);
+			break;
 	
 		default:
 			return DC_ERROR;
@@ -2450,7 +3299,19 @@
 static int function_autopatchup(struct rpt *myrpt, char *param, char *digitbuf, int command_source, struct rpt_link *mylink)
 {
 	pthread_attr_t attr;
-	
+	int i, index, paramlength;
+	char *lparam;
+	char *value = NULL;
+	char *paramlist[20];
+
+	static char *keywords[] = {
+	&quot;context&quot;,
+	&quot;dialtime&quot;,
+	&quot;farenddisconnect&quot;,
+	&quot;noct&quot;,
+	&quot;quiet&quot;,
+	NULL
+	};
 		
 	if (!myrpt-&gt;enable)
 		return DC_ERROR;
@@ -2458,12 +3319,61 @@
 	if(debug)
 		printf(&quot;@@@@ Autopatch up\n&quot;);
 
+	if(!myrpt-&gt;callmode){
+		/* Set defaults */
+		myrpt-&gt;patchnoct = 0;
+		myrpt-&gt;patchdialtime = 0;
+		myrpt-&gt;patchfarenddisconnect = 0;
+		myrpt-&gt;patchquiet = 0;
+		strncpy(myrpt-&gt;patchcontext, myrpt-&gt;p.ourcontext, MAXPATCHCONTEXT);
+
+		if(param){
+			/* Process parameter list */
+			lparam = ast_strdupa(param);
+			if(!lparam){
+				ast_log(LOG_ERROR,&quot;App_rpt out of memory on line %d\n&quot;,__LINE__);
+				return DC_ERROR;	
+			}
+			paramlength = finddelim(lparam, paramlist, 20); 			
+			for(i = 0; i &lt; paramlength; i++){
+				index = matchkeyword(paramlist[i], &amp;value, keywords);
+				if(value)
+					value = skipchars(value, &quot;= &quot;);
+				switch(index){
+
+					case 1: /* context */
+						strncpy(myrpt-&gt;patchcontext, value, MAXPATCHCONTEXT - 1) ;
+						break;
+						
+					case 2: /* dialtime */
+						myrpt-&gt;patchdialtime = atoi(value);
+						break;
+
+					case 3: /* farenddisconnect */
+						myrpt-&gt;patchfarenddisconnect = atoi(value);
+						break;
+
+					case 4:	/* noct */
+						myrpt-&gt;patchnoct = atoi(value);
+						break;
+
+					case 5: /* quiet */
+						myrpt-&gt;patchquiet = atoi(value);
+						break;
+				 					
+					default:
+						break;
+				}
+			}
+		}
+	}
+					
 	rpt_mutex_lock(&amp;myrpt-&gt;lock);
-	
+
 	/* if on call, force * into current audio stream */
 	
 	if ((myrpt-&gt;callmode == 2) || (myrpt-&gt;callmode == 3)){
-		myrpt-&gt;mydtmf = myrpt-&gt;funcchar;
+		myrpt-&gt;mydtmf = myrpt-&gt;p.funcchar;
 	}
 	if (myrpt-&gt;callmode){
 		rpt_mutex_unlock(&amp;myrpt-&gt;lock);
@@ -2562,8 +3472,8 @@
 			return DC_ERROR;
 	}
    
-	if (*digitbuf == '0') val = myrpt-&gt;startupmacro;
-	else val = ast_variable_retrieve(cfg, myrpt-&gt;macro, digitbuf);
+	if (*digitbuf == '0') val = myrpt-&gt;p.startupmacro;
+	else val = ast_variable_retrieve(myrpt-&gt;cfg, myrpt-&gt;p.macro, digitbuf);
 	/* param was 1 for local buf */
 	if (!val){
 		rpt_telemetry(myrpt, MACRO_NOTFOUND, NULL);
@@ -2631,7 +3541,7 @@
 	int i;
 	char *stringp,*action,*param,*functiondigits;
 	char function_table_name[30] = &quot;&quot;;
-	char workstring[80];
+	char workstring[200];
 	
 	struct ast_variable *vp;
 	
@@ -2639,18 +3549,18 @@
 		printf(&quot;@@@@ Digits collected: %s, source: %d\n&quot;, digits, command_source);
 	
 	if (command_source == SOURCE_DPHONE) {
-		if (!myrpt-&gt;dphone_functions) return DC_INDETERMINATE;
-		strncpy(function_table_name, myrpt-&gt;dphone_functions, sizeof(function_table_name) - 1);
+		if (!myrpt-&gt;p.dphone_functions) return DC_INDETERMINATE;
+		strncpy(function_table_name, myrpt-&gt;p.dphone_functions, sizeof(function_table_name) - 1);
 		}
 	else if (command_source == SOURCE_PHONE) {
-		if (!myrpt-&gt;phone_functions) return DC_INDETERMINATE;
-		strncpy(function_table_name, myrpt-&gt;phone_functions, sizeof(function_table_name) - 1);
+		if (!myrpt-&gt;p.phone_functions) return DC_INDETERMINATE;
+		strncpy(function_table_name, myrpt-&gt;p.phone_functions, sizeof(function_table_name) - 1);
 		}
 	else if (command_source == SOURCE_LNK)
-		strncpy(function_table_name, myrpt-&gt;link_functions, sizeof(function_table_name) - 1);
+		strncpy(function_table_name, myrpt-&gt;p.link_functions, sizeof(function_table_name) - 1);
 	else
-		strncpy(function_table_name, myrpt-&gt;functions, sizeof(function_table_name) - 1);
-	vp = ast_variable_browse(cfg, function_table_name);
+		strncpy(function_table_name, myrpt-&gt;p.functions, sizeof(function_table_name) - 1);
+	vp = ast_variable_browse(myrpt-&gt;cfg, function_table_name);
 	while(vp) {
 		if(!strncasecmp(vp-&gt;name, digits, strlen(vp-&gt;name)))
 			break;
@@ -2795,21 +3705,23 @@
 		return;
 	}
 	rpt_mutex_lock(&amp;myrpt-&gt;lock);
-	if (c == myrpt-&gt;endchar) myrpt-&gt;stopgen = 1;
+	if (c == myrpt-&gt;p.endchar) myrpt-&gt;stopgen = 1;
 	if (myrpt-&gt;callmode == 1)
 	{
 		myrpt-&gt;exten[myrpt-&gt;cidx++] = c;
 		myrpt-&gt;exten[myrpt-&gt;cidx] = 0;
 		/* if this exists */
-		if (ast_exists_extension(myrpt-&gt;pchannel,myrpt-&gt;ourcontext,myrpt-&gt;exten,1,NULL))
+		if (ast_exists_extension(myrpt-&gt;pchannel,myrpt-&gt;patchcontext,myrpt-&gt;exten,1,NULL))
 		{
 			myrpt-&gt;callmode = 2;
-			rpt_mutex_unlock(&amp;myrpt-&gt;lock);
-			rpt_telemetry(myrpt,PROC,NULL); 
-			rpt_mutex_lock(&amp;myrpt-&gt;lock);
+			if(!myrpt-&gt;patchquiet){
+				rpt_mutex_unlock(&amp;myrpt-&gt;lock);
+				rpt_telemetry(myrpt,PROC,NULL); 
+				rpt_mutex_lock(&amp;myrpt-&gt;lock);
+			}
 		}
 		/* if can continue, do so */
-		if (!ast_canmatch_extension(myrpt-&gt;pchannel,myrpt-&gt;ourcontext,myrpt-&gt;exten,1,NULL)) 
+		if (!ast_canmatch_extension(myrpt-&gt;pchannel,myrpt-&gt;patchcontext,myrpt-&gt;exten,1,NULL)) 
 		{
 			/* call has failed, inform user */
 			myrpt-&gt;callmode = 4;
@@ -2819,7 +3731,7 @@
 	{
 		myrpt-&gt;mydtmf = c;
 	}
-	if (c == myrpt-&gt;funcchar)
+	if (c == myrpt-&gt;p.funcchar)
 	{
 		myrpt-&gt;rem_dtmfidx = 0;
 		myrpt-&gt;rem_dtmfbuf[myrpt-&gt;rem_dtmfidx] = 0;
@@ -2827,7 +3739,7 @@
 		rpt_mutex_unlock(&amp;myrpt-&gt;lock);
 		return;
 	} 
-	else if ((c != myrpt-&gt;endchar) &amp;&amp; (myrpt-&gt;rem_dtmfidx &gt;= 0))
+	else if ((c != myrpt-&gt;p.endchar) &amp;&amp; (myrpt-&gt;rem_dtmfidx &gt;= 0))
 	{
 		time(&amp;myrpt-&gt;rem_dtmf_time);
 		if (myrpt-&gt;rem_dtmfidx &lt; MAXDTMF)
@@ -2852,6 +3764,10 @@
 				
 				
 				case DC_COMPLETE:
+					myrpt-&gt;totalexecdcommands++;
+					myrpt-&gt;dailyexecdcommands++;
+					strncpy(myrpt-&gt;lastdtmfcommand, cmd, MAXDTMF-1);
+					myrpt-&gt;lastdtmfcommand[MAXDTMF-1] = '\0';
 					myrpt-&gt;rem_dtmfbuf[0] = 0;
 					myrpt-&gt;rem_dtmfidx = -1;
 					myrpt-&gt;rem_dtmf_time = 0;
@@ -2879,7 +3795,7 @@
 int	res;
 
 	rpt_mutex_lock(&amp;myrpt-&gt;lock);
-	if (c == myrpt-&gt;endchar)
+	if (c == myrpt-&gt;p.endchar)
 	{
 		if (mylink-&gt;lastrx)
 		{
@@ -2909,15 +3825,17 @@
 		myrpt-&gt;exten[myrpt-&gt;cidx++] = c;
 		myrpt-&gt;exten[myrpt-&gt;cidx] = 0;
 		/* if this exists */
-		if (ast_exists_extension(myrpt-&gt;pchannel,myrpt-&gt;ourcontext,myrpt-&gt;exten,1,NULL))
+		if (ast_exists_extension(myrpt-&gt;pchannel,myrpt-&gt;patchcontext,myrpt-&gt;exten,1,NULL))
 		{
 			myrpt-&gt;callmode = 2;
-			rpt_mutex_unlock(&amp;myrpt-&gt;lock);
-			rpt_telemetry(myrpt,PROC,NULL); 
-			rpt_mutex_lock(&amp;myrpt-&gt;lock);
+			if(!myrpt-&gt;patchquiet){
+				rpt_mutex_unlock(&amp;myrpt-&gt;lock);
+				rpt_telemetry(myrpt,PROC,NULL); 
+				rpt_mutex_lock(&amp;myrpt-&gt;lock);
+			}
 		}
 		/* if can continue, do so */
-		if (!ast_canmatch_extension(myrpt-&gt;pchannel,myrpt-&gt;ourcontext,myrpt-&gt;exten,1,NULL)) 
+		if (!ast_canmatch_extension(myrpt-&gt;pchannel,myrpt-&gt;patchcontext,myrpt-&gt;exten,1,NULL)) 
 		{
 			/* call has failed, inform user */
 			myrpt-&gt;callmode = 4;
@@ -2927,7 +3845,7 @@
 	{
 		myrpt-&gt;mydtmf = c;
 	}
-	if (c == myrpt-&gt;funcchar)
+	if (c == myrpt-&gt;p.funcchar)
 	{
 		myrpt-&gt;rem_dtmfidx = 0;
 		myrpt-&gt;rem_dtmfbuf[myrpt-&gt;rem_dtmfidx] = 0;
@@ -2935,7 +3853,7 @@
 		rpt_mutex_unlock(&amp;myrpt-&gt;lock);
 		return;
 	} 
-	else if ((c != myrpt-&gt;endchar) &amp;&amp; (myrpt-&gt;rem_dtmfidx &gt;= 0))
+	else if ((c != myrpt-&gt;p.endchar) &amp;&amp; (myrpt-&gt;rem_dtmfidx &gt;= 0))
 	{
 		time(&amp;myrpt-&gt;rem_dtmf_time);
 		if (myrpt-&gt;rem_dtmfidx &lt; MAXDTMF)
@@ -2979,6 +3897,10 @@
 				
 				
 				case DC_COMPLETE:
+					myrpt-&gt;totalexecdcommands++;
+					myrpt-&gt;dailyexecdcommands++;
+					strncpy(myrpt-&gt;lastdtmfcommand, cmd, MAXDTMF-1);
+					myrpt-&gt;lastdtmfcommand[MAXDTMF-1] = '\0';
 					myrpt-&gt;rem_dtmfbuf[0] = 0;
 					myrpt-&gt;rem_dtmfidx = -1;
 					myrpt-&gt;rem_dtmf_time = 0;
@@ -3170,14 +4092,14 @@
         od = *data++; 
         for(j = 0 ; j &lt; 8 ; j++){
             d = od &amp; 1;
-            outb(d,myrpt-&gt;iobase);
+            outb(d,myrpt-&gt;p.iobase);
 	    /* &gt;= 15 us */
 	    for(delayvar = 1; delayvar &lt; 15000; delayvar++); 
             od &gt;&gt;= 1;
-            outb(d | 2,myrpt-&gt;iobase);
+            outb(d | 2,myrpt-&gt;p.iobase);
 	    /* &gt;= 30 us */
 	    for(delayvar = 1; delayvar &lt; 30000; delayvar++); 
-            outb(d,myrpt-&gt;iobase);
+            outb(d,myrpt-&gt;p.iobase);
 	    /* &gt;= 10 us */
 	    for(delayvar = 1; delayvar &lt; 10000; delayvar++); 
             }
@@ -3799,6 +4721,7 @@
 
 static int setrem(struct rpt *myrpt)
 {
+	return 0; /* XXX BROKEN!! */
 	if(!strcmp(myrpt-&gt;remote, remote_rig_ft897))
 		return set_ft897(myrpt);
 	else if(!strcmp(myrpt-&gt;remote, remote_rig_rbi))
@@ -3809,6 +4732,7 @@
 
 static int closerem(struct rpt *myrpt)
 {
+	return 0; /* XXX BROKEN!! */
 	if(!strcmp(myrpt-&gt;remote, remote_rig_ft897))
 		return closerem_ft897(myrpt);
 	else
@@ -4030,7 +4954,7 @@
 					return DC_ERROR;
 			}
 	    
-			val = ast_variable_retrieve(cfg, myrpt-&gt;memory, digitbuf);
+			val = ast_variable_retrieve(myrpt-&gt;cfg, myrpt-&gt;p.memory, digitbuf);
 			if (!val){
 				if (ast_safe_sleep(mychannel,1000) == -1)
 					return DC_ERROR;
@@ -4717,7 +5641,7 @@
 	if (myrpt-&gt;dtmfidx == -1)
 	{
 		/* if not lead-in digit, dont worry */
-		if (c != myrpt-&gt;funcchar) return 0;
+		if (c != myrpt-&gt;p.funcchar) return 0;
 		myrpt-&gt;dtmfidx = 0;
 		myrpt-&gt;dtmfbuf[0] = 0;
 		myrpt-&gt;dtmf_time_rem = now;
@@ -4730,11 +5654,11 @@
 		myrpt-&gt;dtmfbuf[0] = 0;
 		myrpt-&gt;dtmf_time_rem = now;
 	}
-	if (c == myrpt-&gt;funcchar)
+	if (c == myrpt-&gt;p.funcchar)
 	{
 		/* if star at beginning, or 2 together, erase buffer */
 		if ((myrpt-&gt;dtmfidx &lt; 1) || 
-			(myrpt-&gt;dtmfbuf[myrpt-&gt;dtmfidx - 1] == myrpt-&gt;funcchar))
+			(myrpt-&gt;dtmfbuf[myrpt-&gt;dtmfidx - 1] == myrpt-&gt;p.funcchar))
 		{
 			myrpt-&gt;dtmfidx = 0;
 			myrpt-&gt;dtmfbuf[0] = 0;
@@ -4771,6 +5695,10 @@
 				
 				
 		case DC_COMPLETE:
+			myrpt-&gt;totalexecdcommands++;
+			myrpt-&gt;dailyexecdcommands++;
+			strncpy(myrpt-&gt;lastdtmfcommand, myrpt-&gt;dtmfbuf, MAXDTMF-1);
+			myrpt-&gt;lastdtmfcommand[MAXDTMF-1] = '\0';
 			myrpt-&gt;dtmfbuf[0] = 0;
 			myrpt-&gt;dtmfidx = -1;
 			myrpt-&gt;dtmf_time_rem = 0;
@@ -4819,7 +5747,7 @@
 		ast_indicate(myrpt-&gt;remchannel,AST_CONTROL_RADIO_KEY);
 	}
 	if (ast_safe_sleep(myrpt-&gt;remchannel,1000) == -1) return -1;
-	res = telem_lookup(myrpt-&gt;remchannel, myrpt-&gt;name, &quot;functcomplete&quot;);
+	res = telem_lookup(myrpt,myrpt-&gt;remchannel, myrpt-&gt;name, &quot;functcomplete&quot;);
 	rmt_telem_finish(myrpt,myrpt-&gt;remchannel);
 	return res;
 }
@@ -4829,7 +5757,7 @@
 int	res;
 
 
-	if (keyed &amp;&amp; *keyed &amp;&amp; (c == myrpt-&gt;endchar))
+	if (keyed &amp;&amp; *keyed &amp;&amp; (c == myrpt-&gt;p.endchar))
 	{
 		*keyed = 0;
 		return DC_INDETERMINATE;
@@ -4845,7 +5773,7 @@
 		ast_indicate(myrpt-&gt;remchannel,AST_CONTROL_RADIO_KEY);
 	}
 	if (ast_safe_sleep(myrpt-&gt;remchannel,1000) == -1) return -1;
-	res = telem_lookup(myrpt-&gt;remchannel, myrpt-&gt;name, &quot;functcomplete&quot;);
+	res = telem_lookup(myrpt,myrpt-&gt;remchannel, myrpt-&gt;name, &quot;functcomplete&quot;);
 	rmt_telem_finish(myrpt,myrpt-&gt;remchannel);
 	return res;
 }
@@ -4855,7 +5783,7 @@
 	char *val, *s, *s1, *s2, *tele;
 	char tmp[300], deststr[300] = &quot;&quot;;
 
-	val = ast_variable_retrieve(cfg, myrpt-&gt;nodes, l-&gt;name);
+	val = ast_variable_retrieve(myrpt-&gt;cfg, myrpt-&gt;p.nodes, l-&gt;name);
 	if (!val)
 	{
 		fprintf(stderr,&quot;attempt_reconnect: cannot find node %s\n&quot;,l-&gt;name);
@@ -4878,6 +5806,7 @@
 	}
 	*tele++ = 0;
 	l-&gt;elaptime = 0;
+	l-&gt;connecttime = 0;
 	l-&gt;chan = ast_request(deststr, AST_FORMAT_SLINEAR, tele,NULL);
 	if (l-&gt;chan){
 		ast_set_read_format(l-&gt;chan, AST_FORMAT_SLINEAR);
@@ -4902,7 +5831,7 @@
 		return -1;
 	}
 	rpt_mutex_lock(&amp;myrpt-&gt;lock);
-	/* put back in queue queue */
+	/* put back in queue */
 	insque((struct qelem *)l,(struct qelem *)myrpt-&gt;links.next);
 	rpt_mutex_unlock(&amp;myrpt-&gt;lock);
 	ast_log(LOG_NOTICE,&quot;Reconnect Attempt to %s in process\n&quot;,l-&gt;name);
@@ -4916,10 +5845,10 @@
 pthread_attr_t	attr;
 char	cmd[MAXDTMF+1] = &quot;&quot;;
 
-	if (c == myrpt-&gt;endchar)
+	if (c == myrpt-&gt;p.endchar)
 	{
 	/* if in simple mode, kill autopatch */
-		if (myrpt-&gt;simple &amp;&amp; myrpt-&gt;callmode)
+		if (myrpt-&gt;p.simple &amp;&amp; myrpt-&gt;callmode)
 		{
 			rpt_mutex_lock(&amp;myrpt-&gt;lock);
 			myrpt-&gt;callmode = 0;
@@ -4946,9 +5875,9 @@
 		send_link_dtmf(myrpt,c);
 		return;
 	}
-	if (!myrpt-&gt;simple)
+	if (!myrpt-&gt;p.simple)
 	{
-		if (c == myrpt-&gt;funcchar)
+		if (c == myrpt-&gt;p.funcchar)
 		{
 			myrpt-&gt;dtmfidx = 0;
 			myrpt-&gt;dtmfbuf[myrpt-&gt;dtmfidx] = 0;
@@ -4956,7 +5885,7 @@
 			time(&amp;myrpt-&gt;dtmf_time);
 			return;
 		} 
-		else if ((c != myrpt-&gt;endchar) &amp;&amp; (myrpt-&gt;dtmfidx &gt;= 0))
+		else if ((c != myrpt-&gt;p.endchar) &amp;&amp; (myrpt-&gt;dtmfidx &gt;= 0))
 		{
 			time(&amp;myrpt-&gt;dtmf_time);
 			
@@ -4978,6 +5907,10 @@
 					myrpt-&gt;dtmfbuf[0] = 0;
 					break;
 				    case DC_COMPLETE:
+					myrpt-&gt;totalexecdcommands++;
+					myrpt-&gt;dailyexecdcommands++;
+					strncpy(myrpt-&gt;lastdtmfcommand, cmd, MAXDTMF-1);
+					myrpt-&gt;lastdtmfcommand[MAXDTMF-1] = '\0';
 					myrpt-&gt;dtmfbuf[0] = 0;
 					myrpt-&gt;dtmfidx = -1;
 					myrpt-&gt;dtmf_time = 0;
@@ -4999,9 +5932,14 @@
 	}
 	else /* if simple */
 	{
-		if ((!myrpt-&gt;callmode) &amp;&amp; (c == myrpt-&gt;funcchar))
+		if ((!myrpt-&gt;callmode) &amp;&amp; (c == myrpt-&gt;p.funcchar))
 		{
 			myrpt-&gt;callmode = 1;
+			myrpt-&gt;patchnoct = 0;
+			myrpt-&gt;patchquiet = 0;
+			myrpt-&gt;patchfarenddisconnect = 0;
+			myrpt-&gt;patchdialtime = 0;
+			strncpy(myrpt-&gt;patchcontext, myrpt-&gt;p.ourcontext, MAXPATCHCONTEXT);
 			myrpt-&gt;cidx = 0;
 			myrpt-&gt;exten[myrpt-&gt;cidx] = 0;
 			rpt_mutex_unlock(&amp;myrpt-&gt;lock);
@@ -5016,15 +5954,16 @@
 		myrpt-&gt;exten[myrpt-&gt;cidx++] = c;
 		myrpt-&gt;exten[myrpt-&gt;cidx] = 0;
 		/* if this exists */
-		if (ast_exists_extension(myrpt-&gt;pchannel,myrpt-&gt;ourcontext,myrpt-&gt;exten,1,NULL))
+		if (ast_exists_extension(myrpt-&gt;pchannel,myrpt-&gt;patchcontext,myrpt-&gt;exten,1,NULL))
 		{
 			myrpt-&gt;callmode = 2;
 			rpt_mutex_unlock(&amp;myrpt-&gt;lock);
-			rpt_telemetry(myrpt,PROC,NULL); 
+			if(!myrpt-&gt;patchquiet)
+				rpt_telemetry(myrpt,PROC,NULL); 
 			return;
 		}
 		/* if can continue, do so */
-		if (!ast_canmatch_extension(myrpt-&gt;pchannel,myrpt-&gt;ourcontext,myrpt-&gt;exten,1,NULL))
+		if (!ast_canmatch_extension(myrpt-&gt;pchannel,myrpt-&gt;patchcontext,myrpt-&gt;exten,1,NULL))
 		{
 			/* call has failed, inform user */
 			myrpt-&gt;callmode = 4;
@@ -5046,19 +5985,48 @@
 static void queue_id(struct rpt *myrpt)
 {
 	myrpt-&gt;mustid = myrpt-&gt;tailid = 0;
-	myrpt-&gt;idtimer = myrpt-&gt;idtime; /* Reset our ID timer */
+	myrpt-&gt;idtimer = myrpt-&gt;p.idtime; /* Reset our ID timer */
 	rpt_mutex_unlock(&amp;myrpt-&gt;lock);
 	rpt_telemetry(myrpt,ID,NULL);
 	rpt_mutex_lock(&amp;myrpt-&gt;lock);
 }
 
+/* Scheduler */
 
+static void do_scheduler(struct rpt *myrpt)
+{
+	int res;
+	struct tm tmnow;
+
+	memcpy(&amp;myrpt-&gt;lasttv, &amp;myrpt-&gt;curtv, sizeof(struct timeval));
+	
+	if( (res = gettimeofday(&amp;myrpt-&gt;curtv, NULL)) &lt; 0)
+		ast_log(LOG_NOTICE, &quot;Scheduler gettime of day returned: %s\n&quot;, strerror(res));
+
+	/* Try to get close to a 1 second resolution */
+	
+	if(myrpt-&gt;lasttv.tv_sec == myrpt-&gt;curtv.tv_sec)
+		return;
+
+	ast_localtime(&amp;myrpt-&gt;curtv.tv_sec, &amp;tmnow, NULL);
+
+	/* If midnight, then reset all daily statistics */
+	
+	if((tmnow.tm_hour == 0)&amp;&amp;(tmnow.tm_min == 0)&amp;&amp;(tmnow.tm_sec == 0)){
+		myrpt-&gt;dailykeyups = 0;
+		myrpt-&gt;dailytxtime = 0;
+		myrpt-&gt;dailykerchunks = 0;
+		myrpt-&gt;dailyexecdcommands = 0;
+	}
+}
+
+
 /* single thread with one file (request) to dial */
 static void *rpt(void *this)
 {
 struct	rpt *myrpt = (struct rpt *)this;
 char *tele,*idtalkover,c;
-int ms = MSWAIT,i,lasttx=0,val,remrx=0,identqueued,nonidentqueued,tailmessagequeued,ctqueued;
+int ms = MSWAIT,i,lasttx=0,val,remrx=0,identqueued,othertelemqueued,tailmessagequeued,ctqueued;
 struct ast_channel *who;
 ZT_CONFINFO ci;  /* conference info */
 time_t	t;
@@ -5066,13 +6034,30 @@
 struct rpt_tele *telem;
 char tmpstr[300];
 
+	rpt_mutex_lock(&amp;myrpt-&gt;lock);
 
+	telem = myrpt-&gt;tele.next;
+	while(telem != &amp;myrpt-&gt;tele)
+	{
+		ast_softhangup(telem-&gt;chan,AST_SOFTHANGUP_DEV);
+		telem = telem-&gt;next;
+	}
+	rpt_mutex_unlock(&amp;myrpt-&gt;lock);
+	/* find our index, and load the vars initially */
+	for(i = 0; i &lt; nrpts; i++)
+	{
+		if (&amp;rpt_vars[i] == myrpt)
+		{
+			load_rpt_vars(i,0);
+			break;
+		}
+	}
 	rpt_mutex_lock(&amp;myrpt-&gt;lock);
 	strncpy(tmpstr,myrpt-&gt;rxchanname,sizeof(tmpstr) - 1);
 	tele = strchr(tmpstr,'/');
 	if (!tele)
 	{
-		fprintf(stderr,&quot;rpt:Dial number (%s) must be in format tech/number\n&quot;,myrpt-&gt;rxchanname);
+		fprintf(stderr,&quot;rpt:Rxchannel Dial number (%s) must be in format tech/number\n&quot;,myrpt-&gt;rxchanname);
 		rpt_mutex_unlock(&amp;myrpt-&gt;lock);
 		myrpt-&gt;rpt_thread = AST_PTHREADT_STOP;
 		pthread_exit(NULL);
@@ -5119,7 +6104,7 @@
 		tele = strchr(tmpstr,'/');
 		if (!tele)
 		{
-			fprintf(stderr,&quot;rpt:Dial number (%s) must be in format tech/number\n&quot;,myrpt-&gt;txchanname);
+			fprintf(stderr,&quot;rpt:Txchannel Dial number (%s) must be in format tech/number\n&quot;,myrpt-&gt;txchanname);
 			rpt_mutex_unlock(&amp;myrpt-&gt;lock);
 			ast_hangup(myrpt-&gt;rxchannel);
 			myrpt-&gt;rpt_thread = AST_PTHREADT_STOP;
@@ -5204,7 +6189,7 @@
 	/* make a conference for the pseudo */
 	ci.chan = 0;
 	ci.confno = -1; /* make a new conf */
-	ci.confmode = (myrpt-&gt;duplex == 2) ? ZT_CONF_CONFANNMON :
+	ci.confmode = ((myrpt-&gt;p.duplex == 2) || (myrpt-&gt;p.duplex == 4)) ? ZT_CONF_CONFANNMON :
 		(ZT_CONF_CONF | ZT_CONF_LISTENER | ZT_CONF_TALKER);
 	/* first put the channel on the conference in announce mode */
 	if (ioctl(myrpt-&gt;pchannel-&gt;fds[0],ZT_SETCONF,&amp;ci) == -1)
@@ -5257,16 +6242,18 @@
 	myrpt-&gt;links.prev = &amp;myrpt-&gt;links;
 	myrpt-&gt;tailtimer = 0;
 	myrpt-&gt;totimer = 0;
-	myrpt-&gt;tmsgtimer = myrpt-&gt;tailmessagetime;
-	myrpt-&gt;idtimer = myrpt-&gt;politeid;
+	myrpt-&gt;tmsgtimer = myrpt-&gt;p.tailmessagetime;
+	myrpt-&gt;idtimer = myrpt-&gt;p.politeid;
 	myrpt-&gt;mustid = myrpt-&gt;tailid = 0;
 	myrpt-&gt;callmode = 0;
 	myrpt-&gt;tounkeyed = 0;
 	myrpt-&gt;tonotify = 0;
 	myrpt-&gt;retxtimer = 0;
+	myrpt-&gt;skedtimer = 0;
+	myrpt-&gt;tailevent = 0;
 	lasttx = 0;
 	myrpt-&gt;keyed = 0;
-	idtalkover = ast_variable_retrieve(cfg, myrpt-&gt;name, &quot;idtalkover&quot;);
+	idtalkover = ast_variable_retrieve(myrpt-&gt;cfg, myrpt-&gt;name, &quot;idtalkover&quot;);
 	myrpt-&gt;dtmfidx = -1;
 	myrpt-&gt;dtmfbuf[0] = 0;
 	myrpt-&gt;rem_dtmfidx = -1;
@@ -5275,9 +6262,21 @@
 	myrpt-&gt;rem_dtmf_time = 0;
 	myrpt-&gt;enable = 1;
 	myrpt-&gt;disgorgetime = 0;
-	if (myrpt-&gt;startupmacro)
+	myrpt-&gt;lastnodewhichkeyedusup[0] = '\0';
+	myrpt-&gt;dailytxtime = 0;
+	myrpt-&gt;totaltxtime = 0;
+	myrpt-&gt;dailykeyups = 0;
+	myrpt-&gt;totalkeyups = 0;
+	myrpt-&gt;dailykerchunks = 0;
+	myrpt-&gt;totalkerchunks = 0;
+	myrpt-&gt;dailyexecdcommands = 0;
+	myrpt-&gt;totalexecdcommands = 0;
+	myrpt-&gt;timeouts = 0;
+	myrpt-&gt;exten[0] = '\0';
+	myrpt-&gt;lastdtmfcommand[0] = '\0';
+	if (myrpt-&gt;p.startupmacro)
 	{
-		snprintf(myrpt-&gt;macrobuf,MAXMACRO - 1,&quot;PPPP%s&quot;,myrpt-&gt;startupmacro);
+		snprintf(myrpt-&gt;macrobuf,MAXMACRO - 1,&quot;PPPP%s&quot;,myrpt-&gt;p.startupmacro);
 	}
 	rpt_mutex_unlock(&amp;myrpt-&gt;lock);
 	val = 0;
@@ -5313,8 +6312,7 @@
 			ast_log(LOG_NOTICE,&quot;myrpt-&gt;retxtimer = %ld\n&quot;,myrpt-&gt;retxtimer);
 			ast_log(LOG_NOTICE,&quot;myrpt-&gt;totimer = %d\n&quot;,myrpt-&gt;totimer);
 			ast_log(LOG_NOTICE,&quot;myrpt-&gt;tailtimer = %d\n&quot;,myrpt-&gt;tailtimer);
-			ast_log(LOG_NOTICE,&quot;myrpt-&gt;mustid = %d\n&quot;,myrpt-&gt;mustid);
-			ast_log(LOG_NOTICE,&quot;myrpt-&gt;tailid = %d\n&quot;,myrpt-&gt;tailid);
+			ast_log(LOG_NOTICE,&quot;myrpt-&gt;tailevent = %d\n&quot;,myrpt-&gt;tailevent);
 
 			zl = myrpt-&gt;links.next;
               		while(zl != &amp;myrpt-&gt;links){
@@ -5329,7 +6327,7 @@
 				ast_log(LOG_NOTICE,&quot;        link-&gt;disctime %ld\n&quot;,zl-&gt;disctime);
 				ast_log(LOG_NOTICE,&quot;        link-&gt;retrytimer %ld\n&quot;,zl-&gt;retrytimer);
 				ast_log(LOG_NOTICE,&quot;        link-&gt;retries = %d\n&quot;,zl-&gt;retries);
-
+				ast_log(LOG_NOTICE,&quot;        link-&gt;reconnects = %d\n&quot;,zl-&gt;reconnects);
                         	zl = zl-&gt;next;
                 	}
                                                                                                                                
@@ -5345,98 +6343,122 @@
 		}	
 
 
+		if (myrpt-&gt;reload)
+		{
+			struct rpt_tele *telem;
+
+			rpt_mutex_lock(&amp;myrpt-&gt;lock);
+			telem = myrpt-&gt;tele.next;
+			while(telem != &amp;myrpt-&gt;tele)
+			{
+				ast_softhangup(telem-&gt;chan,AST_SOFTHANGUP_DEV);
+				telem = telem-&gt;next;
+			}
+			myrpt-&gt;reload = 0;
+			rpt_mutex_unlock(&amp;myrpt-&gt;lock);
+			usleep(10000);
+			/* find our index, and load the vars */
+			for(i = 0; i &lt; nrpts; i++)
+			{
+				if (&amp;rpt_vars[i] == myrpt)
+				{
+					load_rpt_vars(i,0);
+					break;
+				}
+			}
+		}
+
 		rpt_mutex_lock(&amp;myrpt-&gt;lock);
 		if (ast_check_hangup(myrpt-&gt;rxchannel)) break;
 		if (ast_check_hangup(myrpt-&gt;txchannel)) break;
 		if (ast_check_hangup(myrpt-&gt;pchannel)) break;
 		if (ast_check_hangup(myrpt-&gt;txpchannel)) break;
+
+		/* Update local tx with keyed if not parsing a command */
 		myrpt-&gt;localtx = myrpt-&gt;keyed &amp;&amp; (myrpt-&gt;dtmfidx == -1) &amp;&amp; (!myrpt-&gt;cmdnode[0]);
-		
 		/* If someone's connected, and they're transmitting from their end to us, set remrx true */
-		
 		l = myrpt-&gt;links.next;
 		remrx = 0;
 		while(l != &amp;myrpt-&gt;links)
 		{
-			if (l-&gt;lastrx) remrx = 1;
+			if (l-&gt;lastrx){
+				remrx = 1;
+				if(l-&gt;name[0] != '0') /* Ignore '0' nodes */
+					strcpy(myrpt-&gt;lastnodewhichkeyedusup, l-&gt;name); /* Note the node which is doing the key up */
+			}
 			l = l-&gt;next;
 		}
-		
-		/* Create a &quot;must_id&quot; flag for the cleanup ID */	
-			
+		/* Create a &quot;must_id&quot; flag for the cleanup ID */		
 		myrpt-&gt;mustid |= (myrpt-&gt;idtimer) &amp;&amp; (myrpt-&gt;keyed || remrx) ;
-
 		/* Build a fresh totx from myrpt-&gt;keyed and autopatch activated */
-		
 		totx = myrpt-&gt;callmode;
-		if (myrpt-&gt;duplex &gt; 1) totx = totx || myrpt-&gt;localtx;
-		 
-		/* Traverse the telemetry list to see if there's an ID queued and if there is not an ID queued */
-		
+		/* If full duplex, add local tx to totx */
+		if (myrpt-&gt;p.duplex &gt; 1) totx = totx || myrpt-&gt;localtx;
+		/* Traverse the telemetry list to see what's queued */
 		identqueued = 0;
-		nonidentqueued = 0;
+		othertelemqueued = 0;
 		tailmessagequeued = 0;
 		ctqueued = 0;
 		telem = myrpt-&gt;tele.next;
 		while(telem != &amp;myrpt-&gt;tele)
 		{
 			if((telem-&gt;mode == ID) || (telem-&gt;mode == IDTALKOVER)){
-				identqueued = 1;
+				identqueued = 1; /* Identification telemetry */
 			}
 			else if(telem-&gt;mode == TAILMSG)
 			{
-				tailmessagequeued = 1;
+				tailmessagequeued = 1; /* Tail message telemetry */
 			}
 			else
 			{
 				if (telem-&gt;mode != UNKEY)
-					nonidentqueued = 1;
+					othertelemqueued = 1;  /* Other telemetry */
 				else
-					ctqueued = 1;
+					ctqueued = 1; /* Courtesy tone telemetry */
 			}
 			telem = telem-&gt;next;
 		}
 	
-		/* Add in any non-id telemetry */
-		
-		if (myrpt-&gt;duplex &gt; 0) totx = totx || nonidentqueued;
-		
-		/* Update external transmitter PTT state with everything but ID telemetry */
-		
+		/* Add in any &quot;other&quot; telemetry, if 3/4 or full duplex */
+		if (myrpt-&gt;p.duplex &gt; 0) totx = totx || othertelemqueued;
+		/* Update external (to links) transmitter PTT state with everything but ID, CT, and tailmessage telemetry */
 		myrpt-&gt;exttx = totx;
-		if (myrpt-&gt;duplex &lt; 2) myrpt-&gt;exttx = myrpt-&gt;exttx || myrpt-&gt;localtx;
-		
+		/* If half or 3/4 duplex, add localtx to external link tx */
+		if (myrpt-&gt;p.duplex &lt; 2) myrpt-&gt;exttx = myrpt-&gt;exttx || myrpt-&gt;localtx;
 		/* Add in ID telemetry to local transmitter */
 		totx = totx || remrx;
-		if (myrpt-&gt;duplex &gt; 0)
+		/* If 3/4 or full duplex, add in ident and CT telemetry */
+		if (myrpt-&gt;p.duplex &gt; 0)
 			totx = totx || identqueued || ctqueued;
+		/* Reset time out timer variables if there is no activity */
 		if (!totx) 
 		{
-			myrpt-&gt;totimer = myrpt-&gt;totime;
+			myrpt-&gt;totimer = myrpt-&gt;p.totime;
 			myrpt-&gt;tounkeyed = 0;
 			myrpt-&gt;tonotify = 0;
 		}
 		else
-			myrpt-&gt;tailtimer = myrpt-&gt;hangtime; /* Initialize tail timer */
-
+			myrpt-&gt;tailtimer = myrpt-&gt;p.hangtime; /* Initialize tail timer */
+		/* Disable the local transmitter if we are timed out */
 		totx = totx &amp;&amp; myrpt-&gt;totimer;
 		/* if timed-out and not said already, say it */
 		if ((!myrpt-&gt;totimer) &amp;&amp; (!myrpt-&gt;tonotify))
 		{
 			myrpt-&gt;tonotify = 1;
+			myrpt-&gt;timeouts++;
 			rpt_mutex_unlock(&amp;myrpt-&gt;lock);
 			rpt_telemetry(myrpt,TIMEOUT,NULL);
 			rpt_mutex_lock(&amp;myrpt-&gt;lock);
 		}
-		/* if wants to transmit and in phone call, but timed out, 
-			reset time-out timer if keyed */
+
+		/* If unkey and re-key, reset time out timer */
 		if ((!totx) &amp;&amp; (!myrpt-&gt;totimer) &amp;&amp; (!myrpt-&gt;tounkeyed) &amp;&amp; (!myrpt-&gt;keyed))
 		{
 			myrpt-&gt;tounkeyed = 1;
 		}
 		if ((!totx) &amp;&amp; (!myrpt-&gt;totimer) &amp;&amp; myrpt-&gt;tounkeyed &amp;&amp; myrpt-&gt;keyed)
 		{
-			myrpt-&gt;totimer = myrpt-&gt;totime;
+			myrpt-&gt;totimer = myrpt-&gt;p.totime;
 			myrpt-&gt;tounkeyed = 0;
 			myrpt-&gt;tonotify = 0;
 			rpt_mutex_unlock(&amp;myrpt-&gt;lock);
@@ -5477,35 +6499,42 @@
 		/* If within 30 seconds of the time to ID, try do it in the tail */
 		/* else if at ID time limit, do it right over the top of them */
 		/* Lastly, if the repeater has been keyed, and the ID timer is expired, do a clean up ID */
-
-/*		if (((totx &amp;&amp; (!myrpt-&gt;exttx) &amp;&amp; (myrpt-&gt;idtimer &lt;= myrpt-&gt;politeid) &amp;&amp; myrpt-&gt;tailtimer)) ||
-		   (myrpt-&gt;mustid &amp;&amp; (!myrpt-&gt;idtimer)))
-		{
-			myrpt-&gt;mustid = 0;
-			myrpt-&gt;idtimer = myrpt-&gt;idtime; 
-			rpt_mutex_unlock(&amp;myrpt-&gt;lock);
-			rpt_telemetry(myrpt,ID,NULL);
-			rpt_mutex_lock(&amp;myrpt-&gt;lock);
-		}
-*/
-
 		if(myrpt-&gt;mustid &amp;&amp; (!myrpt-&gt;idtimer))
 			queue_id(myrpt);
 
 		if ((totx &amp;&amp; (!myrpt-&gt;exttx) &amp;&amp;
-			 (myrpt-&gt;idtimer &lt;= myrpt-&gt;politeid) &amp;&amp; myrpt-&gt;tailtimer)) 
+			 (myrpt-&gt;idtimer &lt;= myrpt-&gt;p.politeid) &amp;&amp; myrpt-&gt;tailtimer)) 
 			{
 				myrpt-&gt;tailid = 1;
 			}
 
+		/* If tail timer expires, then check for tail messages */
 
+		if(myrpt-&gt;tailevent){
+			myrpt-&gt;tailevent = 0;
+			if(myrpt-&gt;tailid){
+				totx = 1;
+				queue_id(myrpt);
+			}
+			else if ((myrpt-&gt;p.tailmessages[0]) &amp;&amp;
+				(myrpt-&gt;p.tailmessagetime) &amp;&amp; (myrpt-&gt;tmsgtimer == 0)){
+					totx = 1;
+					myrpt-&gt;tmsgtimer = myrpt-&gt;p.tailmessagetime;	
+					rpt_mutex_unlock(&amp;myrpt-&gt;lock);
+					rpt_telemetry(myrpt, TAILMSG, NULL);
+					rpt_mutex_lock(&amp;myrpt-&gt;lock);
+			}	
+		}
 
+		/* Main TX control */
 
 		/* let telemetry transmit anyway (regardless of timeout) */
-		if (myrpt-&gt;duplex &gt; 0) totx = totx || (myrpt-&gt;tele.next != &amp;myrpt-&gt;tele);
+		if (myrpt-&gt;p.duplex &gt; 0) totx = totx || (myrpt-&gt;tele.next != &amp;myrpt-&gt;tele);
 		if (totx &amp;&amp; (!lasttx))
 		{
 			lasttx = 1;
+			myrpt-&gt;dailykeyups++;
+			myrpt-&gt;totalkeyups++;
 			rpt_mutex_unlock(&amp;myrpt-&gt;lock);
 			ast_indicate(myrpt-&gt;txchannel,AST_CONTROL_RADIO_KEY);
 			rpt_mutex_lock(&amp;myrpt-&gt;lock);
@@ -5531,8 +6560,9 @@
 			myrpt-&gt;rem_dtmfidx = -1;
 			myrpt-&gt;rem_dtmfbuf[0] = 0;
 		}	
-		
-		/* Reconnect kludge */
+
+		/* Reconnect */
+	
 		l = myrpt-&gt;links.next;
 		while(l != &amp;myrpt-&gt;links)
 		{
@@ -5586,7 +6616,6 @@
 					if (l-&gt;chan) ast_indicate(l-&gt;chan,AST_CONTROL_RADIO_UNKEY);
 				}
 			} else l-&gt;retxtimer = 0;
-#ifdef	RECONNECT_KLUDGE
 			if (l-&gt;disctime) /* Disconnect timer active on a channel ? */
 			{
 				l-&gt;disctime -= elap;
@@ -5599,7 +6628,10 @@
 				l-&gt;retrytimer -= elap;
 				if (l-&gt;retrytimer &lt; 0) l-&gt;retrytimer = 0;
 			}
-#endif
+
+			/* Tally connect time */
+			l-&gt;connecttime += elap;
+
 			/* ignore non-timing channels */
 			if (l-&gt;elaptime &lt; 0)
 			{
@@ -5614,13 +6646,9 @@
 				l-&gt;elaptime = 0;
 				rpt_mutex_unlock(&amp;myrpt-&gt;lock);
 				if (l-&gt;chan) ast_softhangup(l-&gt;chan,AST_SOFTHANGUP_DEV);
-#ifndef	RECONNECT_KLUDGE
-				rpt_telemetry(myrpt,CONNFAIL,l);
-#endif
 				rpt_mutex_lock(&amp;myrpt-&gt;lock);
 				break;
 			}
-#ifdef	RECONNECT_KLUDGE
 			if ((!l-&gt;chan) &amp;&amp; (!l-&gt;retrytimer) &amp;&amp; l-&gt;outbound &amp;&amp; 
 				(l-&gt;retries++ &lt; MAX_RETRIES) &amp;&amp; (l-&gt;hasconnected))
 			{
@@ -5677,26 +6705,17 @@
                                 rpt_mutex_lock(&amp;myrpt-&gt;lock);
                                 break;
                         }
-#endif
 			l = l-&gt;next;
 		}
+		if(totx){
+			myrpt-&gt;dailytxtime += elap;
+			myrpt-&gt;totaltxtime += elap;
+		}
 		i = myrpt-&gt;tailtimer;
 		if (myrpt-&gt;tailtimer) myrpt-&gt;tailtimer -= elap;
 		if (myrpt-&gt;tailtimer &lt; 0) myrpt-&gt;tailtimer = 0;
-
-		if((i) &amp;&amp; (myrpt-&gt;tailtimer == 0)){
-			if(myrpt-&gt;tailid){
-				queue_id(myrpt);
-			}
-			else if ((myrpt-&gt;tailmessages[0]) &amp;&amp;
-				(myrpt-&gt;tailmessagetime) &amp;&amp; (myrpt-&gt;tmsgtimer == 0)){
-					myrpt-&gt;tmsgtimer = myrpt-&gt;tailmessagetime;	
-					rpt_mutex_unlock(&amp;myrpt-&gt;lock);
-					rpt_telemetry(myrpt, TAILMSG, NULL);
-					rpt_mutex_lock(&amp;myrpt-&gt;lock);
-			}	
-		}
-		if (myrpt-&gt;tailtimer &lt; 0) myrpt-&gt;tailtimer = 0;
+		if((i) &amp;&amp; (myrpt-&gt;tailtimer == 0))
+			myrpt-&gt;tailevent = 1;
 		if (myrpt-&gt;totimer) myrpt-&gt;totimer -= elap;
 		if (myrpt-&gt;totimer &lt; 0) myrpt-&gt;totimer = 0;
 		if (myrpt-&gt;idtimer) myrpt-&gt;idtimer -= elap;
@@ -5706,6 +6725,13 @@
 		/* do macro timers */
 		if (myrpt-&gt;macrotimer) myrpt-&gt;macrotimer -= elap;
 		if (myrpt-&gt;macrotimer &lt; 0) myrpt-&gt;macrotimer = 0;
+		/* Execute scheduler appx. every 2 tenths of a second */
+		if (myrpt-&gt;skedtimer &lt;= 0){
+			myrpt-&gt;skedtimer = 200;
+			do_scheduler(myrpt);
+		}
+		else
+			myrpt-&gt;skedtimer -=elap;
 		if (!ms) 
 		{
 			rpt_mutex_unlock(&amp;myrpt-&gt;lock);
@@ -5731,8 +6757,59 @@
 			}
 			if (f-&gt;frametype == AST_FRAME_VOICE)
 			{
-				if (!myrpt-&gt;localtx)
+#ifdef	_MDC_DECODE_H_
+				unsigned char ubuf[2560];
+				short *sp;
+				int n;
+#endif
+
+				if (!myrpt-&gt;localtx) {
 					memset(f-&gt;data,0,f-&gt;datalen);
+				}
+
+#ifdef	_MDC_DECODE_H_
+				sp = (short *) f-&gt;data;
+				/* convert block to unsigned char */
+				for(n = 0; n &lt; f-&gt;datalen / 2; n++)
+				{
+					ubuf[n] = (*sp++ &gt;&gt; 8) + 128;
+				}
+				n = mdc_decoder_process_samples(myrpt-&gt;mdc,ubuf,f-&gt;datalen / 2);
+				if (n == 1)
+				{
+						unsigned char op,arg;
+						unsigned short unitID;
+
+						mdc_decoder_get_packet(myrpt-&gt;mdc,&amp;op,&amp;arg,&amp;unitID);
+						if (debug &gt; 2)
+						{
+							ast_log(LOG_NOTICE,&quot;Got (single-length) packet:\n&quot;);
+							ast_log(LOG_NOTICE,&quot;op: %02x, arg: %02x, UnitID: %04x\n&quot;,
+								op &amp; 255,arg &amp; 255,unitID);
+						}
+						if ((op == 1) &amp;&amp; (arg == 0))
+						{
+							myrpt-&gt;lastunit = unitID;
+						}
+				}
+				if ((debug &gt; 2) &amp;&amp; (i == 2))
+				{
+					unsigned char op,arg,ex1,ex2,ex3,ex4;
+					unsigned short unitID;
+
+					mdc_decoder_get_double_packet(myrpt-&gt;mdc,&amp;op,&amp;arg,&amp;unitID,
+						&amp;ex1,&amp;ex2,&amp;ex3,&amp;ex4);
+					ast_log(LOG_NOTICE,&quot;Got (double-length) packet:\n&quot;);
+					ast_log(LOG_NOTICE,&quot;op: %02x, arg: %02x, UnitID: %04x\n&quot;,
+						op &amp; 255,arg &amp; 255,unitID);
+					ast_log(LOG_NOTICE,&quot;ex1: %02x, ex2: %02x, ex3: %02x, ex4: %02x\n&quot;,
+						ex1 &amp; 255, ex2 &amp; 255, ex3 &amp; 255, ex4 &amp; 255);
+				}
+#endif
+#ifdef	__RPT_NOTCH
+				/* apply inbound filters, if any */
+				rpt_filter(myrpt,f-&gt;data,f-&gt;datalen / 2);
+#endif
 				ast_write(myrpt-&gt;pchannel,f);
 			}
 			else if (f-&gt;frametype == AST_FRAME_DTMF)
@@ -5853,7 +6930,6 @@
 				f = ast_read(l-&gt;chan);
 				if (!f)
 				{
-#ifdef	RECONNECT_KLUDGE
 					if ((!l-&gt;disced) &amp;&amp; (!l-&gt;outbound))
 					{
 						if ((l-&gt;name[0] == '0') || l-&gt;isremote)
@@ -5884,7 +6960,6 @@
 						rpt_mutex_lock(&amp;myrpt-&gt;lock);
 						break;
 					}
-#endif
 					rpt_mutex_lock(&amp;myrpt-&gt;lock);
 					/* remove from queue */
 					remque((struct qelem *) l);
@@ -5926,7 +7001,10 @@
 						l-&gt;hasconnected = 1;
 						l-&gt;elaptime = -1;
 						l-&gt;retries = 0;
-						if (!lconnected) rpt_telemetry(myrpt,CONNECTED,l);
+						if (!lconnected) 
+							rpt_telemetry(myrpt,CONNECTED,l);
+						else
+							l-&gt;reconnects++;
 					}
 					/* if RX key */
 					if (f-&gt;subclass == AST_CONTROL_RADIO_KEY)
@@ -5943,7 +7021,6 @@
 					if (f-&gt;subclass == AST_CONTROL_HANGUP)
 					{
 						ast_frfree(f);
-#ifdef	RECONNECT_KLUDGE
 						if ((!l-&gt;outbound) &amp;&amp; (!l-&gt;disced))
 						{
 							if ((l-&gt;name[0] == '0') || l-&gt;isremote)
@@ -5973,7 +7050,6 @@
 							rpt_mutex_lock(&amp;myrpt-&gt;lock);
 							break;
 						}
-#endif
 						rpt_mutex_lock(&amp;myrpt-&gt;lock);
 						/* remove from queue */
 						remque((struct qelem *) l);
@@ -6075,187 +7151,56 @@
 	return NULL;
 }
 
-
+	
 static void *rpt_master(void *ignore)
 {
+int	i,n;
+pthread_attr_t attr;
+struct ast_config *cfg;
 char *this,*val;
-struct ast_variable *vp;
-int	i,j,n,longestnode;
-pthread_attr_t attr;
 
-	/* start with blank config */
-	memset(&amp;rpt_vars,0,sizeof(rpt_vars));
-
-	cfg = ast_config_load(&quot;rpt.conf&quot;);
+	/* go thru all the specified repeaters */
+	this = NULL;
+	n = 0;
+	rpt_vars[n].cfg = ast_config_load(&quot;rpt.conf&quot;);
+	cfg = rpt_vars[n].cfg;
 	if (!cfg) {
 		ast_log(LOG_NOTICE, &quot;Unable to open radio repeater configuration rpt.conf.  Radio Repeater disabled.\n&quot;);
 		pthread_exit(NULL);
 	}
-
-	/* go thru all the specified repeaters */
-	this = NULL;
-	n = 0;
 	while((this = ast_category_browse(cfg,this)) != NULL)
 	{
-	
 		for(i = 0 ; i &lt; strlen(this) ; i++){
 			if((this[i] &lt; '0') || (this[i] &gt; '9'))
 				break;
 		}
-		if(i != strlen(this))
-			continue; /* Not a node defn */
-			
-		ast_log(LOG_DEBUG,&quot;Loading config for repeater %s\n&quot;,this);
+		if(i != strlen(this)) continue; /* Not a node defn */
+		memset(&amp;rpt_vars[n],0,sizeof(rpt_vars[n]));
+		rpt_vars[n].name = strdup(this);
+		val = ast_variable_retrieve(cfg,this,&quot;rxchannel&quot;);
+		if (val) rpt_vars[n].rxchanname = strdup(val);
+		val = ast_variable_retrieve(cfg,this,&quot;txchannel&quot;);
+		if (val) rpt_vars[n].txchanname = strdup(val);
+		val = ast_variable_retrieve(cfg,this,&quot;remote&quot;);
+		if (val) rpt_vars[n].remote = strdup(val);
 		ast_mutex_init(&amp;rpt_vars[n].lock);
 		rpt_vars[n].tele.next = &amp;rpt_vars[n].tele;
 		rpt_vars[n].tele.prev = &amp;rpt_vars[n].tele;
 		rpt_vars[n].rpt_thread = AST_PTHREADT_NULL;
-		rpt_vars[n].name = this;
-		rpt_vars[n].rxchanname = ast_variable_retrieve(cfg,this,&quot;rxchannel&quot;);
-		rpt_vars[n].txchanname = ast_variable_retrieve(cfg,this,&quot;txchannel&quot;);
-		rpt_vars[n].ourcontext = ast_variable_retrieve(cfg,this,&quot;context&quot;);
-		if (!rpt_vars[n].ourcontext) rpt_vars[n].ourcontext = this;
-		rpt_vars[n].ourcallerid = ast_variable_retrieve(cfg,this,&quot;callerid&quot;);
-		rpt_vars[n].acctcode = ast_variable_retrieve(cfg,this,&quot;accountcode&quot;);
-		rpt_vars[n].ident = ast_variable_retrieve(cfg,this,&quot;idrecording&quot;);
-		val = ast_variable_retrieve(cfg,this,&quot;hangtime&quot;);
-		if (val) rpt_vars[n].hangtime = atoi(val);
-			else rpt_vars[n].hangtime = HANGTIME;
-		val = ast_variable_retrieve(cfg,this,&quot;totime&quot;);
-		if (val) rpt_vars[n].totime = atoi(val);
-			else rpt_vars[n].totime = TOTIME;
-
-		rpt_vars[n].tailmessagetime = retrieve_astcfgint(this, &quot;tailmessagetime&quot;, 0, 2400000, 0);		
-		rpt_vars[n].tailsquashedtime = retrieve_astcfgint(this, &quot;tailsquashedtime&quot;, 0, 2400000, 0);		
-		rpt_vars[n].duplex = retrieve_astcfgint(this,&quot;duplex&quot;,0,3,2);
-		rpt_vars[n].idtime = retrieve_astcfgint( this, &quot;idtime&quot;, 60000, 2400000, IDTIME);	/* Enforce a min max */
-		rpt_vars[n].politeid = retrieve_astcfgint( this, &quot;politeid&quot;, 30000, 300000, POLITEID); /* Enforce a min max */
-		rpt_vars[n].remote = ast_variable_retrieve(cfg,this,&quot;remote&quot;);
-		rpt_vars[n].tonezone = ast_variable_retrieve(cfg,this,&quot;tonezone&quot;);
-		rpt_vars[n].tailmessages[0] = 0;
-		rpt_vars[n].tailmessagemax = 0;
 		rpt_vars[n].tailmessagen = 0;
-		val = ast_variable_retrieve(cfg,this,&quot;tailmessagelist&quot;);
-		if (val) rpt_vars[n].tailmessagemax = finddelim(val,rpt_vars[n].tailmessages);
-		val = ast_variable_retrieve(cfg,this,&quot;memory&quot;);
-		if (!val) val = MEMORY;
-		rpt_vars[n].memory = val;
-		val = ast_variable_retrieve(cfg,this,&quot;macro&quot;);
-		if (!val) val = MACRO;
-		rpt_vars[n].macro = val;
-		rpt_vars[n].startupmacro = ast_variable_retrieve(cfg,this,&quot;startup_macro&quot;);
-		val = ast_variable_retrieve(cfg,this,&quot;iobase&quot;);
-		/* do not use atoi() here, we need to be able to have
-			the input specified in hex or decimal so we use
-			sscanf with a %i */
-		if ((!val) || (sscanf(val,&quot;%i&quot;,&amp;rpt_vars[n].iobase) != 1))
-			rpt_vars[n].iobase = DEFAULT_IOBASE;
-		rpt_vars[n].simple = 0;
-		rpt_vars[n].functions = ast_variable_retrieve(cfg,this,&quot;functions&quot;);
-		if (!rpt_vars[n].functions) 
-		{
-			rpt_vars[n].functions = FUNCTIONS;
-			rpt_vars[n].simple = 1;
-		}
-		rpt_vars[n].link_functions = ast_variable_retrieve(cfg,this,&quot;link_functions&quot;);
-		if (!rpt_vars[n].link_functions) 
-			rpt_vars[n].link_functions = rpt_vars[n].functions;
-		rpt_vars[n].phone_functions = ast_variable_retrieve(cfg,this,&quot;phone_functions&quot;);
-		rpt_vars[n].dphone_functions = ast_variable_retrieve(cfg,this,&quot;dphone_functions&quot;);
-		val = ast_variable_retrieve(cfg,this,&quot;funcchar&quot;);
-		if (!val) rpt_vars[n].funcchar = FUNCCHAR; else 
-			rpt_vars[n].funcchar = *val;		
-		val = ast_variable_retrieve(cfg,this,&quot;endchar&quot;);
-		if (!val) rpt_vars[n].endchar = ENDCHAR; else 
-			rpt_vars[n].endchar = *val;		
-		val = ast_variable_retrieve(cfg,this,&quot;nobusyout&quot;);
-		if (val) rpt_vars[n].nobusyout = ast_true(val);
-		rpt_vars[n].nodes = ast_variable_retrieve(cfg,this,&quot;nodes&quot;);
-		if (!rpt_vars[n].nodes) 
-			rpt_vars[n].nodes = NODES;
+#ifdef	_MDC_DECODE_H_
+		rpt_vars[n].mdc = mdc_decoder_new(8000);
+#endif
 		n++;
 	}
 	nrpts = n;
-	ast_log(LOG_DEBUG, &quot;Total of %d repeaters configured.\n&quot;,n);
+	ast_config_destroy(cfg);
+
 	/* start em all */
 	for(i = 0; i &lt; n; i++)
 	{
+		load_rpt_vars(i,1);
 
-		/*
-		* Go through the node list to determine the longest node
-		*/
-		longestnode = 0;
-
-		vp = ast_variable_browse(cfg, rpt_vars[i].nodes);
-		
-		while(vp){
-			j = strlen(vp-&gt;name);
-			if (j &gt; longestnode)
-				longestnode = j;
-			vp = vp-&gt;next;
-		}
-
-
-		rpt_vars[i].longestnode = longestnode;
-		
-		/*
-		* For this repeater, Determine the length of the longest function 
-		*/
-		rpt_vars[i].longestfunc = 0;
-		vp = ast_variable_browse(cfg, rpt_vars[i].functions);
-		while(vp){
-			j = strlen(vp-&gt;name);
-			if (j &gt; rpt_vars[i].longestfunc)
-				rpt_vars[i].longestfunc = j;
-			vp = vp-&gt;next;
-		}
-		/*
-		* For this repeater, Determine the length of the longest function 
-		*/
-		rpt_vars[i].link_longestfunc = 0;
-		vp = ast_variable_browse(cfg, rpt_vars[i].link_functions);
-		while(vp){
-			j = strlen(vp-&gt;name);
-			if (j &gt; rpt_vars[i].link_longestfunc)
-				rpt_vars[i].link_longestfunc = j;
-			vp = vp-&gt;next;
-		}
-		rpt_vars[i].phone_longestfunc = 0;
-		if (rpt_vars[i].phone_functions)
-		{
-			vp = ast_variable_browse(cfg, rpt_vars[i].phone_functions);
-			while(vp){
-				j = strlen(vp-&gt;name);
-				if (j &gt; rpt_vars[i].phone_longestfunc)
-					rpt_vars[i].phone_longestfunc = j;
-				vp = vp-&gt;next;
-			}
-		}
-		rpt_vars[i].dphone_longestfunc = 0;
-		if (rpt_vars[i].dphone_functions)
-		{
-			vp = ast_variable_browse(cfg, rpt_vars[i].dphone_functions);
-			while(vp){
-				j = strlen(vp-&gt;name);
-				if (j &gt; rpt_vars[i].dphone_longestfunc)
-					rpt_vars[i].dphone_longestfunc = j;
-				vp = vp-&gt;next;
-			}
-		}
-		rpt_vars[i].macro_longest = 1;
-		vp = ast_variable_browse(cfg, rpt_vars[i].macro);
-		while(vp){
-			j = strlen(vp-&gt;name);
-			if (j &gt; rpt_vars[i].macro_longest)
-				rpt_vars[i].macro_longest = j;
-			vp = vp-&gt;next;
-		}
-		if (!rpt_vars[i].rxchanname)
-		{
-			ast_log(LOG_WARNING,&quot;Did not specify rxchanname for node %s\n&quot;,rpt_vars[i].name);
-			ast_config_destroy(cfg);
-			pthread_exit(NULL);
-		}
 		/* if is a remote, dont start one for it */
 		if (rpt_vars[i].remote)
 		{
@@ -6268,7 +7213,7 @@
 			rpt_vars[i].powerlevel = REM_MEDPWR;
 			continue;
 		}
-		if (!rpt_vars[i].ident)
+		if (!rpt_vars[i].p.ident)
 		{
 			ast_log(LOG_WARNING,&quot;Did not specify ident for node %s\n&quot;,rpt_vars[i].name);
 			ast_config_destroy(cfg);
@@ -6392,7 +7337,7 @@
 		m = myrpt-&gt;callmode;
 		rpt_mutex_unlock(&amp;myrpt-&gt;lock);
 
-		if ((!myrpt-&gt;nobusyout) &amp;&amp; m)
+		if ((!myrpt-&gt;p.nobusyout) &amp;&amp; m)
 		{
 			if (chan-&gt;_state != AST_STATE_UP)
 			{
@@ -6457,9 +7402,13 @@
 		}
 		/* At this point we have a priority and maybe an extension and a context */
 		chan-&gt;priority = atoi(priority);
-		if (exten)
+#ifdef OLD_ASTERISK
+		if(exten &amp;&amp; strcasecmp(exten, &quot;BYEXTENSION&quot;))
+#else
+		if(exten)
+#endif
 			strncpy(chan-&gt;exten, exten, sizeof(chan-&gt;exten)-1);
-		if (context)
+		if(context)
 			strncpy(chan-&gt;context, context, sizeof(chan-&gt;context)-1);
 		} else {  /* increment the priority by default*/
 			chan-&gt;priority++;
@@ -6528,7 +7477,7 @@
 
 
 		/* look for his reported node string */
-		val = ast_variable_retrieve(cfg, myrpt-&gt;nodes, b1);
+		val = ast_variable_retrieve(myrpt-&gt;cfg, myrpt-&gt;p.nodes, b1);
 		if (!val)
 		{
 			ast_log(LOG_WARNING, &quot;Reported node %s cannot be found!!\n&quot;,b1);
@@ -6580,6 +7529,7 @@
 	{
 
 		char *b,*b1;
+		int reconnects = 0;
 
 		/* look at callerid to see what node this comes from */
 		if (!chan-&gt;cid.cid_num) /* if doesn't have caller id */
@@ -6615,6 +7565,8 @@
 			l-&gt;killme = 1;
 			l-&gt;retries = MAX_RETRIES + 1;
 			l-&gt;disced = 2;
+			reconnects = l-&gt;reconnects;
+			reconnects++;
                         rpt_mutex_unlock(&amp;myrpt-&gt;lock);
 			usleep(500000);	
 		} else 
@@ -6634,6 +7586,7 @@
 		l-&gt;chan = chan;
 		l-&gt;connected = 1;
 		l-&gt;hasconnected = 1;
+		l-&gt;reconnects = reconnects;
 		l-&gt;phonemode = phone_mode;
 		ast_set_read_format(l-&gt;chan,AST_FORMAT_SLINEAR);
 		ast_set_write_format(l-&gt;chan,AST_FORMAT_SLINEAR);
@@ -6680,13 +7633,24 @@
 		rpt_mutex_lock(&amp;myrpt-&gt;lock);
 	}
 	myrpt-&gt;remoteon = 1;
-	if (ioperm(myrpt-&gt;iobase,1,1) == -1)
+	if (ioperm(myrpt-&gt;p.iobase,1,1) == -1)
 	{
 		rpt_mutex_unlock(&amp;myrpt-&gt;lock);
-		ast_log(LOG_WARNING, &quot;Cant get io permission on IO port %x hex\n&quot;,myrpt-&gt;iobase);
+		ast_log(LOG_WARNING, &quot;Cant get io permission on IO port %x hex\n&quot;,myrpt-&gt;p.iobase);
 		return -1;
 	}
 	LOCAL_USER_ADD(u);
+	rpt_mutex_unlock(&amp;myrpt-&gt;lock);
+	/* find our index, and load the vars initially */
+	for(i = 0; i &lt; nrpts; i++)
+	{
+		if (&amp;rpt_vars[i] == myrpt)
+		{
+			load_rpt_vars(i,0);
+			break;
+		}
+	}
+	rpt_mutex_lock(&amp;myrpt-&gt;lock);
 	tele = strchr(myrpt-&gt;rxchanname,'/');
 	if (!tele)
 	{
@@ -6765,11 +7729,12 @@
 	myrpt-&gt;dtmf_time_rem = 0;
 	myrpt-&gt;hfscanmode = 0;
 	myrpt-&gt;hfscanstatus = 0;
-	if (myrpt-&gt;startupmacro)
+	if (myrpt-&gt;p.startupmacro)
 	{
 		myrpt-&gt;remchannel = chan; /* Save copy of channel */
-		snprintf(myrpt-&gt;macrobuf,MAXMACRO - 1,&quot;PPPP%s&quot;,myrpt-&gt;startupmacro);
+		snprintf(myrpt-&gt;macrobuf,MAXMACRO - 1,&quot;PPPP%s&quot;,myrpt-&gt;p.startupmacro);
 	}
+	myrpt-&gt;reload = 0;
 	rpt_mutex_unlock(&amp;myrpt-&gt;lock);
 	setrem(myrpt); 
 	ast_set_write_format(chan, AST_FORMAT_SLINEAR);
@@ -6801,6 +7766,21 @@
 	{
 		if (ast_check_hangup(chan)) break;
 		if (ast_check_hangup(myrpt-&gt;rxchannel)) break;
+		if (myrpt-&gt;reload)
+		{
+			myrpt-&gt;reload = 0;
+			rpt_mutex_unlock(&amp;myrpt-&gt;lock);
+			/* find our index, and load the vars */
+			for(i = 0; i &lt; nrpts; i++)
+			{
+				if (&amp;rpt_vars[i] == myrpt)
+				{
+					load_rpt_vars(i,0);
+					break;
+				}
+			}
+			rpt_mutex_lock(&amp;myrpt-&gt;lock);
+		}
 		ms = MSWAIT;
 		who = ast_waitfor_n(cs,n,&amp;ms);
 		if (who == NULL) ms = 0;
@@ -7028,13 +8008,17 @@
 	return res;
 }
 
-static int unload_module(void *mod)
+#ifdef	OLD_ASTERISK
+int unload_module()
+#else
+static int unload_module(void* mod)
+#endif
 {
 	int i;
 
 	STANDARD_HANGUP_LOCALUSERS;
 	for(i = 0; i &lt; nrpts; i++) {
-		if (!strcmp(rpt_vars[i].name,rpt_vars[i].nodes)) continue;
+		if (!strcmp(rpt_vars[i].name,rpt_vars[i].p.nodes)) continue;
                 ast_mutex_destroy(&amp;rpt_vars[i].lock);
 	}
 	i = ast_unregister_application(app);
@@ -7042,30 +8026,72 @@
 	/* Unregister cli extensions */
 	ast_cli_unregister(&amp;cli_debug);
 	ast_cli_unregister(&amp;cli_dump);
+	ast_cli_unregister(&amp;cli_stats);
+	ast_cli_unregister(&amp;cli_lstats);
+	ast_cli_unregister(&amp;cli_reload);
+	ast_cli_unregister(&amp;cli_restart);
 
 	return i;
 }
 
+#ifdef	OLD_ASTERISK
+int load_module()
+#else
 static int load_module(void *mod)
+#endif
 {
 	ast_pthread_create(&amp;rpt_master_thread,NULL,rpt_master,NULL);
 
 	/* Register cli extensions */
 	ast_cli_register(&amp;cli_debug);
 	ast_cli_register(&amp;cli_dump);
+	ast_cli_register(&amp;cli_stats);
+	ast_cli_register(&amp;cli_lstats);
+	ast_cli_register(&amp;cli_reload);
+	ast_cli_register(&amp;cli_restart);
 
 	return ast_register_application(app, rpt_exec, synopsis, descrip);
 }
 
+#ifdef	OLD_ASTERISK
+char *description()
+#else
 static const char *description(void)
+#endif
 {
 	return tdesc;
 }
 
+#ifdef OLD_ASTERISK
+int usecount(void)
+{
+	int res;
+	STANDARD_USECOUNT(res);
+	return res;
+}
+#endif
+
+#ifdef	OLD_ASTERISK
+char *key()
+#else
 static const char *key(void)
+#endif
 {
 	return ASTERISK_GPL_KEY;
 }
 
-STD_MOD1;
+#ifdef	OLD_ASTERISK
+int reload()
+#else
+static int reload(void *mod)
+#endif
+{
+int	n;
 
+	for(n = 0; n &lt; nrpts; n++) rpt_vars[n].reload = 1;
+	return(0);
+}
+
+#ifndef	OLD_ASTERISK
+STD_MOD(MOD_1, reload, NULL, NULL);
+#endif

Modified: trunk/apps/app_setcdruserfield.c
===================================================================
--- trunk/apps/app_setcdruserfield.c	2006-05-25 20:48:20 UTC (rev 180)
+++ trunk/apps/app_setcdruserfield.c	2006-05-26 21:12:24 UTC (rev 181)
@@ -109,6 +109,7 @@
 {
 	struct localuser *u;
 	int res = 0;
+	static int dep_warning = 0;
 	
 	LOCAL_USER_ADD(u);
 
@@ -116,6 +117,11 @@
 		ast_cdr_setuserfield(chan, (char*)data);
 	}
 
+	if (!dep_warning) {
+		dep_warning = 1;
+		ast_log(LOG_WARNING, &quot;SetCDRUserField is deprecated.  Please use CDR(userfield) instead.\n&quot;);
+	}
+
 	LOCAL_USER_REMOVE(u);
 	
 	return res;
@@ -125,6 +131,7 @@
 {
 	struct localuser *u;
 	int res = 0;
+	static int dep_warning = 0;
 	
 	LOCAL_USER_ADD(u);
 
@@ -132,6 +139,11 @@
 		ast_cdr_appenduserfield(chan, (char*)data);
 	}
 
+	if (!dep_warning) {
+		dep_warning = 1;
+		ast_log(LOG_WARNING, &quot;AppendCDRUserField is deprecated.  Please use CDR(userfield) instead.\n&quot;);
+	}
+
 	LOCAL_USER_REMOVE(u);
 	
 	return res;

Modified: trunk/apps/app_settransfercapability.c
===================================================================
--- trunk/apps/app_settransfercapability.c	2006-05-25 20:48:20 UTC (rev 180)
+++ trunk/apps/app_settransfercapability.c	2006-05-26 21:12:24 UTC (rev 181)
@@ -76,9 +76,15 @@
 	int x;
 	char *opts;
 	int transfercapability = -1;
+	static int dep_warning = 0;
 	
 	LOCAL_USER_ADD(u);
-	
+
+	if (!dep_warning) {
+		dep_warning = 1;
+		ast_log(LOG_WARNING, &quot;SetTransferCapability is deprecated.  Please use CHANNEL(transfercapability) instead.\n&quot;);
+	}
+
 	if (data)
 		tmp = ast_strdupa(data);
 	else

Modified: trunk/apps/app_sms.c
===================================================================
--- trunk/apps/app_sms.c	2006-05-25 20:48:20 UTC (rev 180)
+++ trunk/apps/app_sms.c	2006-05-26 21:12:24 UTC (rev 181)
@@ -1176,14 +1176,13 @@
 static int sms_generate (struct ast_channel *chan, void *data, int len, int samples)
 {
 	struct ast_frame f = { 0 };
-	unsigned char waste[AST_FRIENDLY_OFFSET];
 #define MAXSAMPLES (800)
 #ifdef OUTALAW
-	unsigned char buf[MAXSAMPLES];
+	unsigned char *buf;
 #else
-	signed short buf[MAXSAMPLES];
+	short *buf;
 #endif
-#define SAMPLE2LEN (sizeof (buf[0]))
+#define SAMPLE2LEN sizeof(*buf)
 	sms_t *h = data;
 	int i;
 
@@ -1192,9 +1191,9 @@
 			 MAXSAMPLES, samples);
 		samples = MAXSAMPLES;
 	}
-	len = samples * SAMPLE2LEN;
+	len = samples * SAMPLE2LEN + AST_FRIENDLY_OFFSET;
+	buf = alloca(len);
 
-	waste[0] = 0;				 /* make compiler happy */
 	f.frametype = AST_FRAME_VOICE;
 #ifdef OUTALAW
 	f.subclass = AST_FORMAT_ALAW;
@@ -1204,7 +1203,7 @@
 	f.datalen = len;
 	f.offset = AST_FRIENDLY_OFFSET;
 	f.mallocd = 0;
-	f.data = buf;
+	f.data = buf + AST_FRIENDLY_OFFSET;
 	f.samples = samples;
 	f.src = &quot;app_sms&quot;;
 	/* create a buffer containing the digital sms pattern */

Modified: trunk/apps/app_speech_utils.c
===================================================================
--- trunk/apps/app_speech_utils.c	2006-05-25 20:48:20 UTC (rev 180)
+++ trunk/apps/app_speech_utils.c	2006-05-26 21:12:24 UTC (rev 181)
@@ -66,8 +66,8 @@
 &quot;SpeechBackground(Sound File|Timeout)\n&quot;
 &quot;This application plays a sound file and waits for the person to speak. Once they start speaking playback of the file stops, and silence is heard.\n&quot;
 &quot;Once they stop talking the processing sound is played to indicate the speech recognition engine is working.\n&quot;
-&quot;Once results are available the application returns and results (score and text) are available as dialplan variables.\n&quot;
-&quot;The first text and score are ${TEXT0} AND ${SCORE0} while the second are ${TEXT1} and ${SCORE1}.\n&quot;
+&quot;Once results are available the application returns and results (score and text) are available using dialplan functions.\n&quot;
+&quot;The first text and score are ${SPEECH_TEXT(0)} AND ${SPEECH_SCORE(0)} while the second are ${SPEECH_TEXT(1)} and ${SPEECH_SCORE(1)}.\n&quot;
 &quot;This may change in the future, however, to use a dialplan function instead of dialplan variables. Note it is possible to have more then one result.\n&quot;
 	&quot;The first argument is the sound file and the second is the timeout. Note the timeout will only start once the sound file has stopped playing.\n&quot;;
 

Modified: trunk/apps/app_userevent.c
===================================================================
--- trunk/apps/app_userevent.c	2006-05-25 20:48:20 UTC (rev 180)
+++ trunk/apps/app_userevent.c	2006-05-26 21:12:24 UTC (rev 181)
@@ -38,6 +38,7 @@
 #include &quot;asterisk/pbx.h&quot;
 #include &quot;asterisk/module.h&quot;
 #include &quot;asterisk/manager.h&quot;
+#include &quot;asterisk/app.h&quot;
 
 static char *tdesc = &quot;Custom User Event Application&quot;;
 
@@ -46,24 +47,27 @@
 static char *synopsis = &quot;Send an arbitrary event to the manager interface&quot;;
 
 static char *descrip = 
-&quot;  UserEvent(eventname[|body]): Sends an arbitrary event to the\n&quot;
-&quot;manager interface, with an optional body representing additional\n&quot;
-&quot;arguments.  The format of the event will be:\n&quot;
-&quot;    Event: UserEvent&lt;specified event name&gt;\n&quot;
-&quot;    Channel: &lt;channel name&gt;\n&quot;
-&quot;    Uniqueid: &lt;call uniqueid&gt;\n&quot;
+&quot;  UserEvent(eventname[|body]): Sends an arbitrary event to the manager\n&quot;
+&quot;interface, with an optional body representing additional arguments.  The\n&quot;
+&quot;body may be specified as a | delimeted list of headers. Each additional\n&quot;
+&quot;argument will be placed on a new line in the event. The format of the\n&quot;
+&quot;event will be:\n&quot;
+&quot;    Event: UserEvent\n&quot;
+&quot;    UserEvent: &lt;specified event name&gt;\n&quot;
 &quot;    [body]\n&quot;
-&quot;If the body is not specified, only Event, Channel, and Uniqueid fields\n&quot;
-&quot;will be present.  Returns 0.&quot;;
+&quot;If no body is specified, only Event and UserEvent headers will be present.\n&quot;;
 
 LOCAL_USER_DECL;
 
 static int userevent_exec(struct ast_channel *chan, void *data)
 {
 	struct localuser *u;
-	char *info;
-	char eventname[512];
-	char *eventbody;
+	char *parse, buf[2048] = &quot;&quot;;
+	int x, buflen = 0;
+	AST_DECLARE_APP_ARGS(args,
+		AST_APP_ARG(eventname);
+		AST_APP_ARG(extra)[100];
+	);
 
 	if (ast_strlen_zero(data)) {
 		ast_log(LOG_WARNING, &quot;UserEvent requires an argument (eventname|optional event body)\n&quot;);
@@ -72,26 +76,19 @@
 
 	LOCAL_USER_ADD(u);
 
-	info = ast_strdupa(data);
+	parse = ast_strdupa(data);
 
-	snprintf(eventname, sizeof(eventname), &quot;UserEvent%s&quot;, info);
-	eventbody = strchr(eventname, '|');
-	if (eventbody) {
-		*eventbody = '\0';
-		eventbody++;
+	AST_STANDARD_APP_ARGS(args, parse);
+
+	for (x = 0; x &lt; args.argc - 1; x++) {
+		ast_copy_string(buf + buflen, args.extra[x], sizeof(buf) - buflen - 2);
+		buflen += strlen(args.extra[x]);
+		ast_copy_string(buf + buflen, &quot;\r\n&quot;, 3);
+		buflen += 2;
 	}
-	
-	if(eventbody) {
-            ast_log(LOG_DEBUG, &quot;Sending user event: %s, %s\n&quot;, eventname, eventbody);
-            manager_event(EVENT_FLAG_USER, eventname, 
-			&quot;Channel: %s\r\nUniqueid: %s\r\n%s\r\n&quot;,
-			chan-&gt;name, chan-&gt;uniqueid, eventbody);
-	} else {
-            ast_log(LOG_DEBUG, &quot;Sending user event: %s\n&quot;, eventname);
-            manager_event(EVENT_FLAG_USER, eventname, 
-			&quot;Channel: %s\r\nUniqueid: %s\r\n&quot;, chan-&gt;name, chan-&gt;uniqueid);
-	}
 
+	manager_event(EVENT_FLAG_USER, &quot;UserEvent&quot;, &quot;UserEvent: %s\r\n%s\r\n&quot;, args.eventname, buf);
+
 	LOCAL_USER_REMOVE(u);
 	return 0;
 }

Modified: trunk/asterisk.c
===================================================================
--- trunk/asterisk.c	2006-05-25 20:48:20 UTC (rev 180)
+++ trunk/asterisk.c	2006-05-26 21:12:24 UTC (rev 181)
@@ -608,21 +608,15 @@
 }
 
 AST_MUTEX_DEFINE_STATIC(safe_system_lock);
+/*! Keep track of how many threads are currently trying to wait*() on
+ *  a child process */
 static unsigned int safe_system_level = 0;
 static void *safe_system_prev_handler;
 
-int ast_safe_system(const char *s)
+void ast_replace_sigchld(void)
 {
-	pid_t pid;
-	int x;
-	int res;
-	struct rusage rusage;
-	int status;
 	unsigned int level;
 
-	/* keep track of how many ast_safe_system() functions
-	   are running at this moment
-	*/
 	ast_mutex_lock(&amp;safe_system_lock);
 	level = safe_system_level++;
 
@@ -631,7 +625,32 @@
 		safe_system_prev_handler = signal(SIGCHLD, null_sig_handler);
 
 	ast_mutex_unlock(&amp;safe_system_lock);
+}
 
+void ast_unreplace_sigchld(void)
+{
+	unsigned int level;
+
+	ast_mutex_lock(&amp;safe_system_lock);
+	level = --safe_system_level;
+
+	/* only restore the handler if we are the last one */
+	if (level == 0)
+		signal(SIGCHLD, safe_system_prev_handler);
+
+	ast_mutex_unlock(&amp;safe_system_lock);
+}
+
+int ast_safe_system(const char *s)
+{
+	pid_t pid;
+	int x;
+	int res;
+	struct rusage rusage;
+	int status;
+
+	ast_replace_sigchld();
+
 	pid = fork();
 
 	if (pid == 0) {
@@ -656,15 +675,8 @@
 		res = -1;
 	}
 
-	ast_mutex_lock(&amp;safe_system_lock);
-	level = --safe_system_level;
+	ast_unreplace_sigchld();
 
-	/* only restore the handler if we are the last one */
-	if (level == 0)
-		signal(SIGCHLD, safe_system_prev_handler);
-
-	ast_mutex_unlock(&amp;safe_system_lock);
-
 	return res;
 }
 

Modified: trunk/build_tools/cflags.xml
===================================================================
--- trunk/build_tools/cflags.xml	2006-05-25 20:48:20 UTC (rev 180)
+++ trunk/build_tools/cflags.xml	2006-05-26 21:12:24 UTC (rev 181)
@@ -1,4 +1,6 @@
 	&lt;category name=&quot;MENUSELECT_CFLAGS&quot; displayname=&quot;Compiler Flags&quot; positive_output=&quot;yes&quot; force_clean_on_change=&quot;yes&quot;&gt;
+		&lt;member name=&quot;DEBUG_CHANNEL_LOCKS&quot; displayname=&quot;Debug Channel Locking&quot;&gt;
+		&lt;/member&gt;
 		&lt;member name=&quot;DEBUG_SCHEDULER&quot; displayname=&quot;Enable Scheduler Debugging Output&quot;&gt;
 		&lt;/member&gt;
 		&lt;member name=&quot;DEBUG_THREADS&quot; displayname=&quot;Enable Thread Debugging&quot;&gt;

Modified: trunk/build_tools/menuselect-deps.in
===================================================================
--- trunk/build_tools/menuselect-deps.in	2006-05-25 20:48:20 UTC (rev 180)
+++ trunk/build_tools/menuselect-deps.in	2006-05-26 21:12:24 UTC (rev 181)
@@ -1,26 +1,28 @@
-ASOUND=@PBX_LIBasound@
+ASOUND=@PBX_LIBALSA@
 CURL=@PBX_CURL@
-FREETDS=@PBX_LIBtds@
+FREETDS=@PBX_LIBFREETDS@
 GTK=@PBX_GTK@
 H323=@PBX_H323@
 KDE=@PBX_KDE@
-LIBNEWT=@PBX_LIBnewt@
-LIBOSPTK=@PBX_LIBosptk@
-LIBPOPT=@PBX_LIBpopt@
-LIBPRI=@PBX_LIBpri@
-LIBSPEEX=@PBX_LIBspeex@
-LIBVORBIS=@PBX_LIBvorbis@
-NBS=@PBX_LIBnbs@
-OGG=@PBX_LIBogg@
-OSSAUDIO=@PBX_LIBossaudio@
+LIBNEWT=@PBX_LIBNEWT@
+LIBOSPTK=@PBX_LIBOSPTK@
+LIBPOPT=@PBX_LIBPOPT@
+LIBPRI=@PBX_LIBLIBPRI@
+LIBSPEEX=@PBX_LIBSPEEX@
+LIBVORBIS=@PBX_LIBVORBIS@
+NBS=@PBX_LIBNBS@
+OGG=@PBX_LIBOGG@
+OSSAUDIO=@PBX_LIBOSS@
 PGSQL=@PBX_LIBpq@
 QT=@PBX_QT@
-SQLITE=@PBX_LIBsqlite@
-SSL=@PBX_LIBssl@
-UNIXODBC=@PBX_LIBodbc@
+RADIUSCLIENT=@PBX_LIBRADIUSCLIENT@
+SQLITE=@PBX_LIBSQLITE@
+SSL=@PBX_LIBOPENSSL@
+UNIXODBC=@PBX_LIBUNIXODBC@
 VPBAPI=@PBX_LIBvpb@
 WIN32=@OSISWIN32@
-ZLIB=@PBX_LIBz@
-ZAPTEL=@PBX_LIBtonezone@
+ZLIB=@PBX_LIBZLIB@
+ZAPTEL=@PBX_LIBZAPTEL@
 LIBGSM=@PBX_LIBgsm@
+IKSEMEL=@PBX_LIBIKSEMEL@
 IXJUSER=@PBX_IXJUSER@

Modified: trunk/cdr/Makefile
===================================================================
--- trunk/cdr/Makefile	2006-05-25 20:48:20 UTC (rev 180)
+++ trunk/cdr/Makefile	2006-05-26 21:12:24 UTC (rev 181)
@@ -75,6 +75,13 @@
 cdr_sqlite.o: cdr_sqlite.c
 	$(CC) -c -o $@ $(CFLAGS) $(SQLITE_INCLUDE) $&lt;
 
+cdr_radius.so: cdr_radius.o
+	$(CC) $(SOLINK) -o $@ $&lt; $(RADIUSCLIENT_LIB)
+
+cdr_radius.o: cdr_radius.c
+	$(CC) -c -o $@ $(CFLAGS) $(RADIUSCLIENT_INCLUDE) $&lt;
+
+
 ifneq ($(wildcard .depend),)
   include .depend
 endif

Modified: trunk/cdr/cdr_pgsql.c
===================================================================
--- trunk/cdr/cdr_pgsql.c	2006-05-25 20:48:20 UTC (rev 180)
+++ trunk/cdr/cdr_pgsql.c	2006-05-26 21:12:24 UTC (rev 181)
@@ -63,7 +63,7 @@
 static char *desc = &quot;PostgreSQL CDR Backend&quot;;
 static char *name = &quot;pgsql&quot;;
 static char *config = &quot;cdr_pgsql.conf&quot;;
-static char *pghostname = NULL, *pgdbname = NULL, *pgdbuser = NULL, *pgpassword = NULL, *pgdbsock = NULL, *pgdbport = NULL, *table = NULL;
+static char *pghostname = NULL, *pgdbname = NULL, *pgdbuser = NULL, *pgpassword = NULL, *pgdbport = NULL, *table = NULL;
 static int connected = 0;
 
 AST_MUTEX_DEFINE_STATIC(pgsql_lock);
@@ -195,8 +195,6 @@
 		free(pgdbname);
 	if (pgdbuser)
 		free(pgdbuser);
-	if (pgdbsock)
-		free(pgdbsock);
 	if (pgpassword)
 		free(pgpassword);
 	if (pgdbport)
@@ -209,88 +207,67 @@
 
 static int process_my_load_module(struct ast_config *cfg)
 {
-	int res;
 	struct ast_variable *var;
         char *pgerror;
 	char *tmp;
 
-	var = ast_variable_browse(cfg, &quot;global&quot;);
-	if (!var) {
-		/* nothing configured */
+	if (!(var = ast_variable_browse(cfg, &quot;global&quot;)))
 		return 0;
-	}
 
-	tmp = ast_variable_retrieve(cfg,&quot;global&quot;,&quot;hostname&quot;);
-	if (tmp == NULL) {
-		ast_log(LOG_WARNING,&quot;PostgreSQL server hostname not specified.  Assuming localhost\n&quot;);
-		tmp = &quot;localhost&quot;;
+	if (!(tmp = ast_variable_retrieve(cfg,&quot;global&quot;,&quot;hostname&quot;))) {
+		ast_log(LOG_WARNING,&quot;PostgreSQL server hostname not specified.  Assuming unix socket connection\n&quot;);
+		tmp = &quot;&quot;;	/* connect via UNIX-socket by default */
 	}
-	pghostname = strdup(tmp);
-	if (pghostname == NULL) {
-		ast_log(LOG_ERROR,&quot;Out of memory error.\n&quot;);
+	
+	if (!(pghostname = ast_strdup(tmp)))
 		return -1;
-	}
 
-	tmp = ast_variable_retrieve(cfg,&quot;global&quot;,&quot;dbname&quot;);
-	if (tmp == NULL) {
+	if (!(tmp = ast_variable_retrieve(cfg, &quot;global&quot;, &quot;dbname&quot;))) {
 		ast_log(LOG_WARNING,&quot;PostgreSQL database not specified.  Assuming asterisk\n&quot;);
 		tmp = &quot;asteriskcdrdb&quot;;
 	}
-	pgdbname = strdup(tmp);
-	if (pgdbname == NULL) {
-		ast_log(LOG_ERROR,&quot;Out of memory error.\n&quot;);
+
+	if (!(pgdbname = ast_strdup(tmp)))
 		return -1;
-	}
 
-	tmp = ast_variable_retrieve(cfg,&quot;global&quot;,&quot;user&quot;);
-	if (tmp == NULL) {
-		ast_log(LOG_WARNING,&quot;PostgreSQL database user not specified.  Assuming root\n&quot;);
-		tmp = &quot;root&quot;;
+	if (!(tmp = ast_variable_retrieve(cfg, &quot;global&quot;, &quot;user&quot;))) {
+		ast_log(LOG_WARNING,&quot;PostgreSQL database user not specified.  Assuming asterisk\n&quot;);
+		tmp = &quot;asterisk&quot;;
 	}
-	pgdbuser = strdup(tmp);
-	if (pgdbuser == NULL) {
-		ast_log(LOG_ERROR,&quot;Out of memory error.\n&quot;);
+
+	if (!(pgdbuser = ast_strdup(tmp)))
 		return -1;
-	}
 
-	tmp = ast_variable_retrieve(cfg,&quot;global&quot;,&quot;password&quot;);
-	if (tmp == NULL) {
+	if (!(tmp = ast_variable_retrieve(cfg, &quot;global&quot;, &quot;password&quot;))) {
 		ast_log(LOG_WARNING,&quot;PostgreSQL database password not specified.  Assuming blank\n&quot;);
 		tmp = &quot;&quot;;
 	}
-	pgpassword = strdup(tmp);
-	if (pgpassword == NULL) {
-		ast_log(LOG_ERROR,&quot;Out of memory error.\n&quot;);
+
+	if (!(pgpassword = ast_strdup(tmp)))
 		return -1;
-	}
 
-	tmp = ast_variable_retrieve(cfg,&quot;global&quot;,&quot;port&quot;);
-	if (tmp == NULL) {
+	if (!(tmp = ast_variable_retrieve(cfg,&quot;global&quot;,&quot;port&quot;))) {
 		ast_log(LOG_WARNING,&quot;PostgreSQL database port not specified.  Using default 5432.\n&quot;);
 		tmp = &quot;5432&quot;;
 	}
-	pgdbport = strdup(tmp);
-	if (pgdbport == NULL) {
-		ast_log(LOG_ERROR,&quot;Out of memory error.\n&quot;);
+
+	if (!(pgdbport = ast_strdup(tmp)))
 		return -1;
-	}
 
-	tmp = ast_variable_retrieve(cfg,&quot;global&quot;,&quot;table&quot;);
-	if (tmp == NULL) {
+	if (!(tmp = ast_variable_retrieve(cfg, &quot;global&quot;, &quot;table&quot;))) {
 		ast_log(LOG_WARNING,&quot;CDR table not specified.  Assuming cdr\n&quot;);
 		tmp = &quot;cdr&quot;;
 	}
-	table = strdup(tmp);
-	if (table == NULL) {
-		ast_log(LOG_ERROR,&quot;Out of memory error.\n&quot;);
+
+	if (!(table = ast_strdup(tmp)))
 		return -1;
-	}
 
 	if (option_debug) {
-		ast_log(LOG_DEBUG, &quot;cdr_pgsql: got hostname of %s\n&quot;, pghostname);
+	    	if (ast_strlen_zero(pghostname))
+			ast_log(LOG_DEBUG, &quot;cdr_pgsql: using default unix socket\n&quot;);
+		else
+			ast_log(LOG_DEBUG, &quot;cdr_pgsql: got hostname of %s\n&quot;, pghostname);
 		ast_log(LOG_DEBUG, &quot;cdr_pgsql: got port of %s\n&quot;, pgdbport);
-		if (pgdbsock)
-			ast_log(LOG_DEBUG, &quot;cdr_pgsql: got sock file of %s\n&quot;, pgdbsock);
 		ast_log(LOG_DEBUG, &quot;cdr_pgsql: got user of %s\n&quot;, pgdbuser);
 		ast_log(LOG_DEBUG, &quot;cdr_pgsql: got dbname of %s\n&quot;, pgdbname);
 		ast_log(LOG_DEBUG, &quot;cdr_pgsql: got password of %s\n&quot;, pgpassword);
@@ -309,24 +286,22 @@
 		connected = 0;
 	}
 
-	res = ast_cdr_register(name, desc, pgsql_log);
-	if (res) {
-		ast_log(LOG_ERROR, &quot;Unable to register PGSQL CDR handling\n&quot;);
-	}
-	return res;
+	return ast_cdr_register(name, desc, pgsql_log);
 }
 
 static int my_load_module(void)
 {
 	struct ast_config *cfg;
 	int res;
-	cfg = ast_config_load(config);
-	if (!cfg) {
+
+	if (!(cfg = ast_config_load(config))) {
 		ast_log(LOG_WARNING, &quot;Unable to load config for PostgreSQL CDR's: %s\n&quot;, config);
 		return 0;
 	}
+
 	res = process_my_load_module(cfg);
 	ast_config_destroy(cfg);
+
 	return res;
 }
 

Modified: trunk/channels/Makefile
===================================================================
--- trunk/channels/Makefile	2006-05-25 20:48:20 UTC (rev 180)
+++ trunk/channels/Makefile	2006-05-26 21:12:24 UTC (rev 181)
@@ -131,6 +131,12 @@
 chan_vpb.so: chan_vpb.o
 	 $(CXX) $(SOLINK) -o $@ $&lt; -lvpb -lpthread -lm -ldl
 
+chan_jingle.o: chan_jingle.c
+	$(CC) -c -o $@ $(CFLAGS) $(IKSEMEL_INCLUDE) $&lt;
+
+chan_jingle.so: chan_jingle.o
+	$(CC) $(SOLINK) -o $@ $&lt; $(IKSEMEL_LIB)
+
 ifeq ($(OSARCH),Linux)
 chan_h323.so: chan_h323.o h323/libchanh323.a h323/Makefile.ast
 	$(CC) $(SOLINK) $(H323LDFLAGS) -o $@ $&lt; h323/libchanh323.a $(H323LDLIBS) -lstdc++

Modified: trunk/channels/chan_iax2.c
===================================================================
--- trunk/channels/chan_iax2.c	2006-05-25 20:48:20 UTC (rev 180)
+++ trunk/channels/chan_iax2.c	2006-05-26 21:12:24 UTC (rev 181)
@@ -5380,7 +5380,7 @@
 	struct iax2_registry *reg;
 	/* Start pessimistic */
 	char peer[256] = &quot;&quot;;
-	char msgstatus[40];
+	char msgstatus[60];
 	int refresh = 0;
 	char ourip[256] = &quot;&lt;Unspecified&gt;&quot;;
 	struct sockaddr_in oldus;
@@ -5410,7 +5410,8 @@
 		return -1;
 	}
 	memcpy(&amp;reg-&gt;us, &amp;us, sizeof(reg-&gt;us));
-	reg-&gt;messages = ies-&gt;msgcount &amp; 0xffff;		/* only low 16 bits are used in the transmission of the IE */
+	if (ies-&gt;msgcount &gt;= 0)
+		reg-&gt;messages = ies-&gt;msgcount &amp; 0xffff;		/* only low 16 bits are used in the transmission of the IE */
 	/* always refresh the registration at the interval requested by the server
 	   we are registering to
 	*/
@@ -6282,8 +6283,7 @@
 	struct ast_iax2_meta_trunk_hdr *mth;
 	struct ast_iax2_meta_trunk_entry *mte;
 	struct ast_iax2_meta_trunk_mini *mtm;
-	char dblbuf[4096];	/* Declaration of dblbuf must immediately *preceed* fr  on the stack */
-	struct iax_frame fr;
+	struct iax_frame *fr;
 	struct iax_frame *cur;
 	char iabuf[INET_ADDRSTRLEN];
 	struct ast_frame f;
@@ -6306,8 +6306,9 @@
 	struct ast_codec_pref pref;
 	char *using_prefs = &quot;mine&quot;;
 
-	dblbuf[0] = 0;	/* Keep GCC from whining */
-	fr.callno = 0;
+	/* allocate an iax_frame with 4096 bytes of data buffer */
+	fr = alloca(sizeof(*fr) + 4096);
+	fr-&gt;callno = 0;
 
 	/* Copy frequently used parameters to the stack */
 	res = thread-&gt;iores;
@@ -6320,7 +6321,7 @@
 	}
 	if ((vh-&gt;zeros == 0) &amp;&amp; (ntohs(vh-&gt;callno) &amp; 0x8000)) {
 		/* This is a video frame, get call number */
-		fr.callno = find_callno(ntohs(vh-&gt;callno) &amp; ~0x8000, dcallno, &amp;sin, new, 1, fd);
+		fr-&gt;callno = find_callno(ntohs(vh-&gt;callno) &amp; ~0x8000, dcallno, &amp;sin, new, 1, fd);
 		minivid = 1;
 	} else if (meta-&gt;zeros == 0) {
 		unsigned char metatype;
@@ -6371,16 +6372,16 @@
 				/* Stop if we don't have enough data */
 				if (len &gt; res)
 					break;
-				fr.callno = find_callno(callno &amp; ~IAX_FLAG_FULL, 0, &amp;sin, NEW_PREVENT, 1, fd);
-				if (fr.callno) {
-					ast_mutex_lock(&amp;iaxsl[fr.callno]);
+				fr-&gt;callno = find_callno(callno &amp; ~IAX_FLAG_FULL, 0, &amp;sin, NEW_PREVENT, 1, fd);
+				if (fr-&gt;callno) {
+					ast_mutex_lock(&amp;iaxsl[fr-&gt;callno]);
 					/* If it's a valid call, deliver the contents.  If not, we
 					   drop it, since we don't have a scallno to use for an INVAL */
 					/* Process as a mini frame */
 					f.frametype = AST_FRAME_VOICE;
-					if (iaxs[fr.callno]) {
-						if (iaxs[fr.callno]-&gt;voiceformat &gt; 0) {
-							f.subclass = iaxs[fr.callno]-&gt;voiceformat;
+					if (iaxs[fr-&gt;callno]) {
+						if (iaxs[fr-&gt;callno]-&gt;voiceformat &gt; 0) {
+							f.subclass = iaxs[fr-&gt;callno]-&gt;voiceformat;
 							f.datalen = len;
 							if (f.datalen &gt;= 0) {
 								if (f.datalen)
@@ -6388,11 +6389,11 @@
 								else
 									f.data = NULL;
 								if(trunked_ts) {
-									fr.ts = (iaxs[fr.callno]-&gt;last &amp; 0xFFFF0000L) | (trunked_ts &amp; 0xffff);
+									fr-&gt;ts = (iaxs[fr-&gt;callno]-&gt;last &amp; 0xFFFF0000L) | (trunked_ts &amp; 0xffff);
 								} else
-									fr.ts = fix_peerts(&amp;rxtrunktime, fr.callno, ts);
+									fr-&gt;ts = fix_peerts(&amp;rxtrunktime, fr-&gt;callno, ts);
 								/* Don't pass any packets until we're started */
-								if (ast_test_flag(&amp;iaxs[fr.callno]-&gt;state, IAX_STATE_STARTED)) {
+								if (ast_test_flag(&amp;iaxs[fr-&gt;callno]-&gt;state, IAX_STATE_STARTED)) {
 									/* Common things */
 									f.src = &quot;IAX2&quot;;
 									f.mallocd = 0;
@@ -6401,28 +6402,28 @@
 										f.samples = ast_codec_get_samples(&amp;f);
 									else
 										f.samples = 0;
-									fr.outoforder = 0;
-									iax_frame_wrap(&amp;fr, &amp;f);
+									fr-&gt;outoforder = 0;
+									iax_frame_wrap(fr, &amp;f);
 #ifdef BRIDGE_OPTIMIZATION
-									if (iaxs[fr.callno]-&gt;bridgecallno) {
+									if (iaxs[fr-&gt;callno]-&gt;bridgecallno) {
 										forward_delivery(&amp;fr);
 									} else {
 										duped_fr = iaxfrdup2(&amp;fr);
 										if (duped_fr) {
-											schedule_delivery(duped_fr, updatehistory, 1, &amp;fr.ts);
+											schedule_delivery(duped_fr, updatehistory, 1, &amp;fr-&gt;ts);
 										}
 									}
 #else
-									duped_fr = iaxfrdup2(&amp;fr);
+									duped_fr = iaxfrdup2(fr);
 									if (duped_fr) {
-										schedule_delivery(duped_fr, updatehistory, 1, &amp;fr.ts);
+										schedule_delivery(duped_fr, updatehistory, 1, &amp;fr-&gt;ts);
 									}
 #endif
-									if (iaxs[fr.callno]-&gt;last &lt; fr.ts) {
-										iaxs[fr.callno]-&gt;last = fr.ts;
+									if (iaxs[fr-&gt;callno]-&gt;last &lt; fr-&gt;ts) {
+										iaxs[fr-&gt;callno]-&gt;last = fr-&gt;ts;
 #if 1
 										if (option_debug &amp;&amp; iaxdebug)
-											ast_log(LOG_DEBUG, &quot;For call=%d, set last=%d\n&quot;, fr.callno, fr.ts);
+											ast_log(LOG_DEBUG, &quot;For call=%d, set last=%d\n&quot;, fr-&gt;callno, fr-&gt;ts);
 #endif
 									}
 								}
@@ -6431,10 +6432,10 @@
 							}
 						} else {
 							ast_log(LOG_WARNING, &quot;Received trunked frame before first full voice frame\n &quot;);
-							iax2_vnak(fr.callno);
+							iax2_vnak(fr-&gt;callno);
 						}
 					}
-					ast_mutex_unlock(&amp;iaxsl[fr.callno]);
+					ast_mutex_unlock(&amp;iaxsl[fr-&gt;callno]);
 				}
 				ptr += len;
 				res -= len;
@@ -6467,13 +6468,13 @@
 		f.subclass = 0;
 	}
 
-	if (!fr.callno)
-		fr.callno = find_callno(ntohs(mh-&gt;callno) &amp; ~IAX_FLAG_FULL, dcallno, &amp;sin, new, 1, fd);
+	if (!fr-&gt;callno)
+		fr-&gt;callno = find_callno(ntohs(mh-&gt;callno) &amp; ~IAX_FLAG_FULL, dcallno, &amp;sin, new, 1, fd);
 
-	if (fr.callno &gt; 0) 
-		ast_mutex_lock(&amp;iaxsl[fr.callno]);
+	if (fr-&gt;callno &gt; 0) 
+		ast_mutex_lock(&amp;iaxsl[fr-&gt;callno]);
 
-	if (!fr.callno || !iaxs[fr.callno]) {
+	if (!fr-&gt;callno || !iaxs[fr-&gt;callno]) {
 		/* A call arrived for a nonexistent destination.  Unless it's an &quot;inval&quot;
 		   frame, reply with an inval */
 		if (ntohs(mh-&gt;callno) &amp; IAX_FLAG_FULL) {
@@ -6486,14 +6487,14 @@
 				raw_hangup(&amp;sin, ntohs(fh-&gt;dcallno) &amp; ~IAX_FLAG_RETRANS, ntohs(mh-&gt;callno) &amp; ~IAX_FLAG_FULL,
 				fd);
 		}
-		if (fr.callno &gt; 0) 
-			ast_mutex_unlock(&amp;iaxsl[fr.callno]);
+		if (fr-&gt;callno &gt; 0) 
+			ast_mutex_unlock(&amp;iaxsl[fr-&gt;callno]);
 		return 1;
 	}
-	if (ast_test_flag(iaxs[fr.callno], IAX_ENCRYPTED)) {
-		if (decrypt_frame(fr.callno, fh, &amp;f, &amp;res)) {
+	if (ast_test_flag(iaxs[fr-&gt;callno], IAX_ENCRYPTED)) {
+		if (decrypt_frame(fr-&gt;callno, fh, &amp;f, &amp;res)) {
 			ast_log(LOG_NOTICE, &quot;Packet Decrypt Failed!\n&quot;);
-			ast_mutex_unlock(&amp;iaxsl[fr.callno]);
+			ast_mutex_unlock(&amp;iaxsl[fr-&gt;callno]);
 			return 1;
 		}
 #ifdef DEBUG_SUPPORT
@@ -6503,24 +6504,24 @@
 	}
 
 	/* count this frame */
-	iaxs[fr.callno]-&gt;frames_received++;
+	iaxs[fr-&gt;callno]-&gt;frames_received++;
 
-	if (!inaddrcmp(&amp;sin, &amp;iaxs[fr.callno]-&gt;addr) &amp;&amp; !minivid &amp;&amp;
+	if (!inaddrcmp(&amp;sin, &amp;iaxs[fr-&gt;callno]-&gt;addr) &amp;&amp; !minivid &amp;&amp;
 		f.subclass != IAX_COMMAND_TXCNT &amp;&amp;		/* for attended transfer */
 		f.subclass != IAX_COMMAND_TXACC)		/* for attended transfer */
-		iaxs[fr.callno]-&gt;peercallno = (unsigned short)(ntohs(mh-&gt;callno) &amp; ~IAX_FLAG_FULL);
+		iaxs[fr-&gt;callno]-&gt;peercallno = (unsigned short)(ntohs(mh-&gt;callno) &amp; ~IAX_FLAG_FULL);
 	if (ntohs(mh-&gt;callno) &amp; IAX_FLAG_FULL) {
 		if (option_debug  &amp;&amp; iaxdebug)
 			ast_log(LOG_DEBUG, &quot;Received packet %d, (%d, %d)\n&quot;, fh-&gt;oseqno, f.frametype, f.subclass);
 		/* Check if it's out of order (and not an ACK or INVAL) */
-		fr.oseqno = fh-&gt;oseqno;
-		fr.iseqno = fh-&gt;iseqno;
-		fr.ts = ntohl(fh-&gt;ts);
+		fr-&gt;oseqno = fh-&gt;oseqno;
+		fr-&gt;iseqno = fh-&gt;iseqno;
+		fr-&gt;ts = ntohl(fh-&gt;ts);
 #ifdef IAXTESTS
 		if (test_resync) {
 			if (option_debug)
-				ast_log(LOG_DEBUG, &quot;Simulating frame ts resync, was %u now %u\n&quot;, fr.ts, fr.ts + test_resync);
-			fr.ts += test_resync;
+				ast_log(LOG_DEBUG, &quot;Simulating frame ts resync, was %u now %u\n&quot;, fr-&gt;ts, fr-&gt;ts + test_resync);
+			fr-&gt;ts += test_resync;
 		}
 #endif /* IAXTESTS */
 #if 0
@@ -6533,8 +6534,8 @@
 #endif
 		if ((ntohs(fh-&gt;dcallno) &amp; IAX_FLAG_RETRANS) || (f.frametype != AST_FRAME_VOICE))
 			updatehistory = 0;
-		if ((iaxs[fr.callno]-&gt;iseqno != fr.oseqno) &amp;&amp;
-			(iaxs[fr.callno]-&gt;iseqno ||
+		if ((iaxs[fr-&gt;callno]-&gt;iseqno != fr-&gt;oseqno) &amp;&amp;
+			(iaxs[fr-&gt;callno]-&gt;iseqno ||
 				((f.subclass != IAX_COMMAND_TXCNT) &amp;&amp;
 				(f.subclass != IAX_COMMAND_TXREADY) &amp;&amp;		/* for attended transfer */
 				(f.subclass != IAX_COMMAND_TXREL) &amp;&amp;		/* for attended transfer */
@@ -6554,8 +6555,8 @@
 			 	/* If it's not an ACK packet, it's out of order. */
 				if (option_debug)
 					ast_log(LOG_DEBUG, &quot;Packet arrived out of order (expecting %d, got %d) (frametype = %d, subclass = %d)\n&quot;, 
-					iaxs[fr.callno]-&gt;iseqno, fr.oseqno, f.frametype, f.subclass);
-				if (iaxs[fr.callno]-&gt;iseqno &gt; fr.oseqno) {
+					iaxs[fr-&gt;callno]-&gt;iseqno, fr-&gt;oseqno, f.frametype, f.subclass);
+				if (iaxs[fr-&gt;callno]-&gt;iseqno &gt; fr-&gt;oseqno) {
 					/* If we've already seen it, ack it XXX There's a border condition here XXX */
 					if ((f.frametype != AST_FRAME_IAX) || 
 							((f.subclass != IAX_COMMAND_ACK) &amp;&amp; (f.subclass != IAX_COMMAND_INVAL))) {
@@ -6563,13 +6564,13 @@
 							ast_log(LOG_DEBUG, &quot;Acking anyway\n&quot;);
 						/* XXX Maybe we should handle its ack to us, but then again, it's probably outdated anyway, and if
 						   we have anything to send, we'll retransmit and get an ACK back anyway XXX */
-						send_command_immediate(iaxs[fr.callno], AST_FRAME_IAX, IAX_COMMAND_ACK, fr.ts, NULL, 0,fr.iseqno);
+						send_command_immediate(iaxs[fr-&gt;callno], AST_FRAME_IAX, IAX_COMMAND_ACK, fr-&gt;ts, NULL, 0,fr-&gt;iseqno);
 					}
 				} else {
 					/* Send a VNAK requesting retransmission */
-					iax2_vnak(fr.callno);
+					iax2_vnak(fr-&gt;callno);
 				}
-				ast_mutex_unlock(&amp;iaxsl[fr.callno]);
+				ast_mutex_unlock(&amp;iaxsl[fr-&gt;callno]);
 				return 1;
 			}
 		} else {
@@ -6580,67 +6581,67 @@
 			    (f.subclass != IAX_COMMAND_TXACC) &amp;&amp;
 				(f.subclass != IAX_COMMAND_VNAK)) ||
 			    (f.frametype != AST_FRAME_IAX))
-				iaxs[fr.callno]-&gt;iseqno++;
+				iaxs[fr-&gt;callno]-&gt;iseqno++;
 		}
 		/* A full frame */
 		if (res &lt; sizeof(struct ast_iax2_full_hdr)) {
 			ast_log(LOG_WARNING, &quot;midget packet received (%d of %d min)\n&quot;, res, (int)sizeof(struct ast_iax2_full_hdr));
-			ast_mutex_unlock(&amp;iaxsl[fr.callno]);
+			ast_mutex_unlock(&amp;iaxsl[fr-&gt;callno]);
 			return 1;
 		}
 		f.datalen = res - sizeof(struct ast_iax2_full_hdr);
 
 		/* Handle implicit ACKing unless this is an INVAL, and only if this is 
 		   from the real peer, not the transfer peer */
-		if (!inaddrcmp(&amp;sin, &amp;iaxs[fr.callno]-&gt;addr) &amp;&amp; 
+		if (!inaddrcmp(&amp;sin, &amp;iaxs[fr-&gt;callno]-&gt;addr) &amp;&amp; 
 		    ((f.subclass != IAX_COMMAND_INVAL) ||
 		     (f.frametype != AST_FRAME_IAX))) {
 			unsigned char x;
 			/* XXX This code is not very efficient.  Surely there is a better way which still
 			       properly handles boundary conditions? XXX */
 			/* First we have to qualify that the ACKed value is within our window */
-			for (x=iaxs[fr.callno]-&gt;rseqno; x != iaxs[fr.callno]-&gt;oseqno; x++)
-				if (fr.iseqno == x)
+			for (x=iaxs[fr-&gt;callno]-&gt;rseqno; x != iaxs[fr-&gt;callno]-&gt;oseqno; x++)
+				if (fr-&gt;iseqno == x)
 					break;
-			if ((x != iaxs[fr.callno]-&gt;oseqno) || (iaxs[fr.callno]-&gt;oseqno == fr.iseqno)) {
+			if ((x != iaxs[fr-&gt;callno]-&gt;oseqno) || (iaxs[fr-&gt;callno]-&gt;oseqno == fr-&gt;iseqno)) {
 				/* The acknowledgement is within our window.  Time to acknowledge everything
 				   that it says to */
-				for (x=iaxs[fr.callno]-&gt;rseqno; x != fr.iseqno; x++) {
+				for (x=iaxs[fr-&gt;callno]-&gt;rseqno; x != fr-&gt;iseqno; x++) {
 					/* Ack the packet with the given timestamp */
 					if (option_debug &amp;&amp; iaxdebug)
 						ast_log(LOG_DEBUG, &quot;Cancelling transmission of packet %d\n&quot;, x);
 					ast_mutex_lock(&amp;iaxq.lock);
 					for (cur = iaxq.head; cur ; cur = cur-&gt;next) {
 						/* If it's our call, and our timestamp, mark -1 retries */
-						if ((fr.callno == cur-&gt;callno) &amp;&amp; (x == cur-&gt;oseqno)) {
+						if ((fr-&gt;callno == cur-&gt;callno) &amp;&amp; (x == cur-&gt;oseqno)) {
 							cur-&gt;retries = -1;
 							/* Destroy call if this is the end */
 							if (cur-&gt;final) { 
 								if (iaxdebug &amp;&amp; option_debug)
-									ast_log(LOG_DEBUG, &quot;Really destroying %d, having been acked on final message\n&quot;, fr.callno);
-								iax2_destroy_nolock(fr.callno);
+									ast_log(LOG_DEBUG, &quot;Really destroying %d, having been acked on final message\n&quot;, fr-&gt;callno);
+								iax2_destroy_nolock(fr-&gt;callno);
 							}
 						}
 					}
 					ast_mutex_unlock(&amp;iaxq.lock);
 				}
 				/* Note how much we've received acknowledgement for */
-				if (iaxs[fr.callno])
-					iaxs[fr.callno]-&gt;rseqno = fr.iseqno;
+				if (iaxs[fr-&gt;callno])
+					iaxs[fr-&gt;callno]-&gt;rseqno = fr-&gt;iseqno;
 				else {
 					/* Stop processing now */
-					ast_mutex_unlock(&amp;iaxsl[fr.callno]);
+					ast_mutex_unlock(&amp;iaxsl[fr-&gt;callno]);
 					return 1;
 				}
 			} else
-				ast_log(LOG_DEBUG, &quot;Received iseqno %d not within window %d-&gt;%d\n&quot;, fr.iseqno, iaxs[fr.callno]-&gt;rseqno, iaxs[fr.callno]-&gt;oseqno);
+				ast_log(LOG_DEBUG, &quot;Received iseqno %d not within window %d-&gt;%d\n&quot;, fr-&gt;iseqno, iaxs[fr-&gt;callno]-&gt;rseqno, iaxs[fr-&gt;callno]-&gt;oseqno);
 		}
-		if (inaddrcmp(&amp;sin, &amp;iaxs[fr.callno]-&gt;addr) &amp;&amp; 
+		if (inaddrcmp(&amp;sin, &amp;iaxs[fr-&gt;callno]-&gt;addr) &amp;&amp; 
 			((f.frametype != AST_FRAME_IAX) || 
 			 ((f.subclass != IAX_COMMAND_TXACC) &amp;&amp;
 			  (f.subclass != IAX_COMMAND_TXCNT)))) {
 			/* Only messages we accept from a transfer host are TXACC and TXCNT */
-			ast_mutex_unlock(&amp;iaxsl[fr.callno]);
+			ast_mutex_unlock(&amp;iaxsl[fr-&gt;callno]);
 			return 1;
 		}
 
@@ -6648,7 +6649,7 @@
 			if (f.frametype == AST_FRAME_IAX) {
 				if (iax_parse_ies(&amp;ies, thread-&gt;buf + sizeof(struct ast_iax2_full_hdr), f.datalen)) {
 					ast_log(LOG_WARNING, &quot;Undecodable frame received from '%s'\n&quot;, ast_inet_ntoa(iabuf, sizeof(iabuf), sin.sin_addr));
-					ast_mutex_unlock(&amp;iaxsl[fr.callno]);
+					ast_mutex_unlock(&amp;iaxsl[fr-&gt;callno]);
 					return 1;
 				}
 				f.data = NULL;
@@ -6662,59 +6663,59 @@
 			memset(&amp;ies, 0, sizeof(ies));
 		}
 		if (f.frametype == AST_FRAME_VOICE) {
-			if (f.subclass != iaxs[fr.callno]-&gt;voiceformat) {
-					iaxs[fr.callno]-&gt;voiceformat = f.subclass;
+			if (f.subclass != iaxs[fr-&gt;callno]-&gt;voiceformat) {
+					iaxs[fr-&gt;callno]-&gt;voiceformat = f.subclass;
 					ast_log(LOG_DEBUG, &quot;Ooh, voice format changed to %d\n&quot;, f.subclass);
-					if (iaxs[fr.callno]-&gt;owner) {
+					if (iaxs[fr-&gt;callno]-&gt;owner) {
 						int orignative;
 retryowner:
-						if (ast_mutex_trylock(&amp;iaxs[fr.callno]-&gt;owner-&gt;lock)) {
-							ast_mutex_unlock(&amp;iaxsl[fr.callno]);
+						if (ast_mutex_trylock(&amp;iaxs[fr-&gt;callno]-&gt;owner-&gt;lock)) {
+							ast_mutex_unlock(&amp;iaxsl[fr-&gt;callno]);
 							usleep(1);
-							ast_mutex_lock(&amp;iaxsl[fr.callno]);
-							if (iaxs[fr.callno] &amp;&amp; iaxs[fr.callno]-&gt;owner) goto retryowner;
+							ast_mutex_lock(&amp;iaxsl[fr-&gt;callno]);
+							if (iaxs[fr-&gt;callno] &amp;&amp; iaxs[fr-&gt;callno]-&gt;owner) goto retryowner;
 						}
-						if (iaxs[fr.callno]) {
-							if (iaxs[fr.callno]-&gt;owner) {
-								orignative = iaxs[fr.callno]-&gt;owner-&gt;nativeformats;
-								iaxs[fr.callno]-&gt;owner-&gt;nativeformats = f.subclass;
-								if (iaxs[fr.callno]-&gt;owner-&gt;readformat)
-									ast_set_read_format(iaxs[fr.callno]-&gt;owner, iaxs[fr.callno]-&gt;owner-&gt;readformat);
-								iaxs[fr.callno]-&gt;owner-&gt;nativeformats = orignative;
-								ast_mutex_unlock(&amp;iaxs[fr.callno]-&gt;owner-&gt;lock);
+						if (iaxs[fr-&gt;callno]) {
+							if (iaxs[fr-&gt;callno]-&gt;owner) {
+								orignative = iaxs[fr-&gt;callno]-&gt;owner-&gt;nativeformats;
+								iaxs[fr-&gt;callno]-&gt;owner-&gt;nativeformats = f.subclass;
+								if (iaxs[fr-&gt;callno]-&gt;owner-&gt;readformat)
+									ast_set_read_format(iaxs[fr-&gt;callno]-&gt;owner, iaxs[fr-&gt;callno]-&gt;owner-&gt;readformat);
+								iaxs[fr-&gt;callno]-&gt;owner-&gt;nativeformats = orignative;
+								ast_mutex_unlock(&amp;iaxs[fr-&gt;callno]-&gt;owner-&gt;lock);
 							}
 						} else {
 							ast_log(LOG_DEBUG, &quot;Neat, somebody took away the channel at a magical time but i found it!\n&quot;);
-							ast_mutex_unlock(&amp;iaxsl[fr.callno]);
+							ast_mutex_unlock(&amp;iaxsl[fr-&gt;callno]);
 							return 1;
 						}
 					}
 			}
 		}
 		if (f.frametype == AST_FRAME_VIDEO) {
-			if (f.subclass != iaxs[fr.callno]-&gt;videoformat) {
+			if (f.subclass != iaxs[fr-&gt;callno]-&gt;videoformat) {
 				ast_log(LOG_DEBUG, &quot;Ooh, video format changed to %d\n&quot;, f.subclass &amp; ~0x1);
-				iaxs[fr.callno]-&gt;videoformat = f.subclass &amp; ~0x1;
+				iaxs[fr-&gt;callno]-&gt;videoformat = f.subclass &amp; ~0x1;
 			}
 		}
 		if (f.frametype == AST_FRAME_IAX) {
-			if (iaxs[fr.callno]-&gt;initid &gt; -1) {
+			if (iaxs[fr-&gt;callno]-&gt;initid &gt; -1) {
 				/* Don't auto congest anymore since we've gotten something usefulb ack */
-				ast_sched_del(sched, iaxs[fr.callno]-&gt;initid);
-				iaxs[fr.callno]-&gt;initid = -1;
+				ast_sched_del(sched, iaxs[fr-&gt;callno]-&gt;initid);
+				iaxs[fr-&gt;callno]-&gt;initid = -1;
 			}
 			/* Handle the IAX pseudo frame itself */
 			if (option_debug &amp;&amp; iaxdebug)
 				ast_log(LOG_DEBUG, &quot;IAX subclass %d received\n&quot;, f.subclass);
 
                         /* Update last ts unless the frame's timestamp originated with us. */
-			if (iaxs[fr.callno]-&gt;last &lt; fr.ts &amp;&amp;
+			if (iaxs[fr-&gt;callno]-&gt;last &lt; fr-&gt;ts &amp;&amp;
                             f.subclass != IAX_COMMAND_ACK &amp;&amp;
                             f.subclass != IAX_COMMAND_PONG &amp;&amp;
                             f.subclass != IAX_COMMAND_LAGRP) {
-				iaxs[fr.callno]-&gt;last = fr.ts;
+				iaxs[fr-&gt;callno]-&gt;last = fr-&gt;ts;
 				if (option_debug &amp;&amp; iaxdebug)
-					ast_log(LOG_DEBUG, &quot;For call=%d, set last=%d\n&quot;, fr.callno, fr.ts);
+					ast_log(LOG_DEBUG, &quot;For call=%d, set last=%d\n&quot;, fr-&gt;callno, fr-&gt;ts);
 			}
 
 			switch(f.subclass) {
@@ -6722,102 +6723,102 @@
 				/* Do nothing */
 				break;
 			case IAX_COMMAND_QUELCH:
-				if (ast_test_flag(&amp;iaxs[fr.callno]-&gt;state, IAX_STATE_STARTED)) {
+				if (ast_test_flag(&amp;iaxs[fr-&gt;callno]-&gt;state, IAX_STATE_STARTED)) {
 				        /* Generate Manager Hold event, if necessary*/
-					if (iaxs[fr.callno]-&gt;owner) {
+					if (iaxs[fr-&gt;callno]-&gt;owner) {
 						manager_event(EVENT_FLAG_CALL, &quot;Hold&quot;,
 							&quot;Channel: %s\r\n&quot;
 							&quot;Uniqueid: %s\r\n&quot;,
-							iaxs[fr.callno]-&gt;owner-&gt;name, 
-							iaxs[fr.callno]-&gt;owner-&gt;uniqueid);
+							iaxs[fr-&gt;callno]-&gt;owner-&gt;name, 
+							iaxs[fr-&gt;callno]-&gt;owner-&gt;uniqueid);
 					}
 
-					ast_set_flag(iaxs[fr.callno], IAX_QUELCH);
+					ast_set_flag(iaxs[fr-&gt;callno], IAX_QUELCH);
 					if (ies.musiconhold) {
-						if (iaxs[fr.callno]-&gt;owner &amp;&amp;
-							ast_bridged_channel(iaxs[fr.callno]-&gt;owner))
-								ast_moh_start(ast_bridged_channel(iaxs[fr.callno]-&gt;owner), NULL);
+						if (iaxs[fr-&gt;callno]-&gt;owner &amp;&amp;
+							ast_bridged_channel(iaxs[fr-&gt;callno]-&gt;owner))
+								ast_moh_start(ast_bridged_channel(iaxs[fr-&gt;callno]-&gt;owner), NULL);
 					}
 				}
 				break;
 			case IAX_COMMAND_UNQUELCH:
-				if (ast_test_flag(&amp;iaxs[fr.callno]-&gt;state, IAX_STATE_STARTED)) {
+				if (ast_test_flag(&amp;iaxs[fr-&gt;callno]-&gt;state, IAX_STATE_STARTED)) {
 				        /* Generate Manager Unhold event, if necessary*/
-					if (iaxs[fr.callno]-&gt;owner &amp;&amp; ast_test_flag(iaxs[fr.callno], IAX_QUELCH)) {
+					if (iaxs[fr-&gt;callno]-&gt;owner &amp;&amp; ast_test_flag(iaxs[fr-&gt;callno], IAX_QUELCH)) {
 						manager_event(EVENT_FLAG_CALL, &quot;Unhold&quot;,
 							&quot;Channel: %s\r\n&quot;
 							&quot;Uniqueid: %s\r\n&quot;,
-							iaxs[fr.callno]-&gt;owner-&gt;name, 
-							iaxs[fr.callno]-&gt;owner-&gt;uniqueid);
+							iaxs[fr-&gt;callno]-&gt;owner-&gt;name, 
+							iaxs[fr-&gt;callno]-&gt;owner-&gt;uniqueid);
 					}
 
-					ast_clear_flag(iaxs[fr.callno], IAX_QUELCH);
-					if (iaxs[fr.callno]-&gt;owner &amp;&amp;
-						ast_bridged_channel(iaxs[fr.callno]-&gt;owner))
-							ast_moh_stop(ast_bridged_channel(iaxs[fr.callno]-&gt;owner));
+					ast_clear_flag(iaxs[fr-&gt;callno], IAX_QUELCH);
+					if (iaxs[fr-&gt;callno]-&gt;owner &amp;&amp;
+						ast_bridged_channel(iaxs[fr-&gt;callno]-&gt;owner))
+							ast_moh_stop(ast_bridged_channel(iaxs[fr-&gt;callno]-&gt;owner));
 				}
 				break;
 			case IAX_COMMAND_TXACC:
-				if (iaxs[fr.callno]-&gt;transferring == TRANSFER_BEGIN) {
+				if (iaxs[fr-&gt;callno]-&gt;transferring == TRANSFER_BEGIN) {
 					/* Ack the packet with the given timestamp */
 					ast_mutex_lock(&amp;iaxq.lock);
 					for (cur = iaxq.head; cur ; cur = cur-&gt;next) {
 						/* Cancel any outstanding txcnt's */
-						if ((fr.callno == cur-&gt;callno) &amp;&amp; (cur-&gt;transfer))
+						if ((fr-&gt;callno == cur-&gt;callno) &amp;&amp; (cur-&gt;transfer))
 							cur-&gt;retries = -1;
 					}
 					ast_mutex_unlock(&amp;iaxq.lock);
 					memset(&amp;ied1, 0, sizeof(ied1));
-					iax_ie_append_short(&amp;ied1, IAX_IE_CALLNO, iaxs[fr.callno]-&gt;callno);
-					send_command(iaxs[fr.callno], AST_FRAME_IAX, IAX_COMMAND_TXREADY, 0, ied1.buf, ied1.pos, -1);
-					iaxs[fr.callno]-&gt;transferring = TRANSFER_READY;
+					iax_ie_append_short(&amp;ied1, IAX_IE_CALLNO, iaxs[fr-&gt;callno]-&gt;callno);
+					send_command(iaxs[fr-&gt;callno], AST_FRAME_IAX, IAX_COMMAND_TXREADY, 0, ied1.buf, ied1.pos, -1);
+					iaxs[fr-&gt;callno]-&gt;transferring = TRANSFER_READY;
 				}
 				break;
 			case IAX_COMMAND_NEW:
 				/* Ignore if it's already up */
-				if (ast_test_flag(&amp;iaxs[fr.callno]-&gt;state, IAX_STATE_STARTED | IAX_STATE_TBD))
+				if (ast_test_flag(&amp;iaxs[fr-&gt;callno]-&gt;state, IAX_STATE_STARTED | IAX_STATE_TBD))
 					break;
 				if (ies.provverpres &amp;&amp; ies.serviceident &amp;&amp; sin.sin_addr.s_addr)
 					check_provisioning(&amp;sin, fd, ies.serviceident, ies.provver);
 				/* If we're in trunk mode, do it now, and update the trunk number in our frame before continuing */
-				if (ast_test_flag(iaxs[fr.callno], IAX_TRUNK)) {
-					fr.callno = make_trunk(fr.callno, 1);
+				if (ast_test_flag(iaxs[fr-&gt;callno], IAX_TRUNK)) {
+					fr-&gt;callno = make_trunk(fr-&gt;callno, 1);
 				}
 				/* For security, always ack immediately */
 				if (delayreject)
-					send_command_immediate(iaxs[fr.callno], AST_FRAME_IAX, IAX_COMMAND_ACK, fr.ts, NULL, 0,fr.iseqno);
-				if (check_access(fr.callno, &amp;sin, &amp;ies)) {
+					send_command_immediate(iaxs[fr-&gt;callno], AST_FRAME_IAX, IAX_COMMAND_ACK, fr-&gt;ts, NULL, 0,fr-&gt;iseqno);
+				if (check_access(fr-&gt;callno, &amp;sin, &amp;ies)) {
 					/* They're not allowed on */
-					auth_fail(fr.callno, IAX_COMMAND_REJECT);
+					auth_fail(fr-&gt;callno, IAX_COMMAND_REJECT);
 					if (authdebug)
-						ast_log(LOG_NOTICE, &quot;Rejected connect attempt from %s, who was trying to reach '%s@%s'\n&quot;, ast_inet_ntoa(iabuf, sizeof(iabuf), sin.sin_addr), iaxs[fr.callno]-&gt;exten, iaxs[fr.callno]-&gt;context);
+						ast_log(LOG_NOTICE, &quot;Rejected connect attempt from %s, who was trying to reach '%s@%s'\n&quot;, ast_inet_ntoa(iabuf, sizeof(iabuf), sin.sin_addr), iaxs[fr-&gt;callno]-&gt;exten, iaxs[fr-&gt;callno]-&gt;context);
 					break;
 				}
 				/* This might re-enter the IAX code and need the lock */
-				if (strcasecmp(iaxs[fr.callno]-&gt;exten, &quot;TBD&quot;)) {
-					ast_mutex_unlock(&amp;iaxsl[fr.callno]);
-					exists = ast_exists_extension(NULL, iaxs[fr.callno]-&gt;context, iaxs[fr.callno]-&gt;exten, 1, iaxs[fr.callno]-&gt;cid_num);
-					ast_mutex_lock(&amp;iaxsl[fr.callno]);
+				if (strcasecmp(iaxs[fr-&gt;callno]-&gt;exten, &quot;TBD&quot;)) {
+					ast_mutex_unlock(&amp;iaxsl[fr-&gt;callno]);
+					exists = ast_exists_extension(NULL, iaxs[fr-&gt;callno]-&gt;context, iaxs[fr-&gt;callno]-&gt;exten, 1, iaxs[fr-&gt;callno]-&gt;cid_num);
+					ast_mutex_lock(&amp;iaxsl[fr-&gt;callno]);
 				} else
 					exists = 0;
-				if (ast_strlen_zero(iaxs[fr.callno]-&gt;secret) &amp;&amp; ast_strlen_zero(iaxs[fr.callno]-&gt;inkeys)) {
-					if (strcmp(iaxs[fr.callno]-&gt;exten, &quot;TBD&quot;) &amp;&amp; !exists) {
+				if (ast_strlen_zero(iaxs[fr-&gt;callno]-&gt;secret) &amp;&amp; ast_strlen_zero(iaxs[fr-&gt;callno]-&gt;inkeys)) {
+					if (strcmp(iaxs[fr-&gt;callno]-&gt;exten, &quot;TBD&quot;) &amp;&amp; !exists) {
 						memset(&amp;ied0, 0, sizeof(ied0));
 						iax_ie_append_str(&amp;ied0, IAX_IE_CAUSE, &quot;No such context/extension&quot;);
 						iax_ie_append_byte(&amp;ied0, IAX_IE_CAUSECODE, AST_CAUSE_NO_ROUTE_DESTINATION);
-						send_command_final(iaxs[fr.callno], AST_FRAME_IAX, IAX_COMMAND_REJECT, 0, ied0.buf, ied0.pos, -1);
+						send_command_final(iaxs[fr-&gt;callno], AST_FRAME_IAX, IAX_COMMAND_REJECT, 0, ied0.buf, ied0.pos, -1);
 						if (authdebug)
-							ast_log(LOG_NOTICE, &quot;Rejected connect attempt from %s, request '%s@%s' does not exist\n&quot;, ast_inet_ntoa(iabuf, sizeof(iabuf), sin.sin_addr), iaxs[fr.callno]-&gt;exten, iaxs[fr.callno]-&gt;context);
+							ast_log(LOG_NOTICE, &quot;Rejected connect attempt from %s, request '%s@%s' does not exist\n&quot;, ast_inet_ntoa(iabuf, sizeof(iabuf), sin.sin_addr), iaxs[fr-&gt;callno]-&gt;exten, iaxs[fr-&gt;callno]-&gt;context);
 					} else {
 						/* Select an appropriate format */
 
-						if(ast_test_flag(iaxs[fr.callno], IAX_CODEC_NOPREFS)) {
-							if(ast_test_flag(iaxs[fr.callno], IAX_CODEC_NOCAP)) {
+						if(ast_test_flag(iaxs[fr-&gt;callno], IAX_CODEC_NOPREFS)) {
+							if(ast_test_flag(iaxs[fr-&gt;callno], IAX_CODEC_NOCAP)) {
 								using_prefs = &quot;reqonly&quot;;
 							} else {
 								using_prefs = &quot;disabled&quot;;
 							}
-							format = iaxs[fr.callno]-&gt;peerformat &amp; iaxs[fr.callno]-&gt;capability;
+							format = iaxs[fr-&gt;callno]-&gt;peerformat &amp; iaxs[fr-&gt;callno]-&gt;capability;
 							memset(&amp;pref, 0, sizeof(pref));
 							strcpy(caller_pref_buf, &quot;disabled&quot;);
 							strcpy(host_pref_buf, &quot;disabled&quot;);
@@ -6825,62 +6826,62 @@
 							using_prefs = &quot;mine&quot;;
 							/* If the information elements are in here... use them */
 							if (ies.codec_prefs)
-								ast_codec_pref_convert(&amp;iaxs[fr.callno]-&gt;rprefs, ies.codec_prefs, 32, 0);
-							if (ast_codec_pref_index(&amp;iaxs[fr.callno]-&gt;rprefs, 0)) {
+								ast_codec_pref_convert(&amp;iaxs[fr-&gt;callno]-&gt;rprefs, ies.codec_prefs, 32, 0);
+							if (ast_codec_pref_index(&amp;iaxs[fr-&gt;callno]-&gt;rprefs, 0)) {
 								/* If we are codec_first_choice we let the caller have the 1st shot at picking the codec.*/
-								if (ast_test_flag(iaxs[fr.callno], IAX_CODEC_USER_FIRST)) {
-									pref = iaxs[fr.callno]-&gt;rprefs;
+								if (ast_test_flag(iaxs[fr-&gt;callno], IAX_CODEC_USER_FIRST)) {
+									pref = iaxs[fr-&gt;callno]-&gt;rprefs;
 									using_prefs = &quot;caller&quot;;
 								} else {
-									pref = iaxs[fr.callno]-&gt;prefs;
+									pref = iaxs[fr-&gt;callno]-&gt;prefs;
 								}
 							} else
-								pref = iaxs[fr.callno]-&gt;prefs;
+								pref = iaxs[fr-&gt;callno]-&gt;prefs;
 							
-							format = ast_codec_choose(&amp;pref, iaxs[fr.callno]-&gt;capability &amp; iaxs[fr.callno]-&gt;peercapability, 0);
-							ast_codec_pref_string(&amp;iaxs[fr.callno]-&gt;rprefs, caller_pref_buf, sizeof(caller_pref_buf) - 1);
-							ast_codec_pref_string(&amp;iaxs[fr.callno]-&gt;prefs, host_pref_buf, sizeof(host_pref_buf) - 1);
+							format = ast_codec_choose(&amp;pref, iaxs[fr-&gt;callno]-&gt;capability &amp; iaxs[fr-&gt;callno]-&gt;peercapability, 0);
+							ast_codec_pref_string(&amp;iaxs[fr-&gt;callno]-&gt;rprefs, caller_pref_buf, sizeof(caller_pref_buf) - 1);
+							ast_codec_pref_string(&amp;iaxs[fr-&gt;callno]-&gt;prefs, host_pref_buf, sizeof(host_pref_buf) - 1);
 						}
 						if (!format) {
-							if(!ast_test_flag(iaxs[fr.callno], IAX_CODEC_NOCAP))
-								format = iaxs[fr.callno]-&gt;peercapability &amp; iaxs[fr.callno]-&gt;capability;
+							if(!ast_test_flag(iaxs[fr-&gt;callno], IAX_CODEC_NOCAP))
+								format = iaxs[fr-&gt;callno]-&gt;peercapability &amp; iaxs[fr-&gt;callno]-&gt;capability;
 							if (!format) {
 								memset(&amp;ied0, 0, sizeof(ied0));
 								iax_ie_append_str(&amp;ied0, IAX_IE_CAUSE, &quot;Unable to negotiate codec&quot;);
 								iax_ie_append_byte(&amp;ied0, IAX_IE_CAUSECODE, AST_CAUSE_BEARERCAPABILITY_NOTAVAIL);
-								send_command_final(iaxs[fr.callno], AST_FRAME_IAX, IAX_COMMAND_REJECT, 0, ied0.buf, ied0.pos, -1);
+								send_command_final(iaxs[fr-&gt;callno], AST_FRAME_IAX, IAX_COMMAND_REJECT, 0, ied0.buf, ied0.pos, -1);
 								if (authdebug) {
-									if(ast_test_flag(iaxs[fr.callno], IAX_CODEC_NOCAP))
-										ast_log(LOG_NOTICE, &quot;Rejected connect attempt from %s, requested 0x%x incompatible with our capability 0x%x.\n&quot;, ast_inet_ntoa(iabuf, sizeof(iabuf), sin.sin_addr), iaxs[fr.callno]-&gt;peerformat, iaxs[fr.callno]-&gt;capability);
+									if(ast_test_flag(iaxs[fr-&gt;callno], IAX_CODEC_NOCAP))
+										ast_log(LOG_NOTICE, &quot;Rejected connect attempt from %s, requested 0x%x incompatible with our capability 0x%x.\n&quot;, ast_inet_ntoa(iabuf, sizeof(iabuf), sin.sin_addr), iaxs[fr-&gt;callno]-&gt;peerformat, iaxs[fr-&gt;callno]-&gt;capability);
 									else 
-										ast_log(LOG_NOTICE, &quot;Rejected connect attempt from %s, requested/capability 0x%x/0x%x incompatible with our capability 0x%x.\n&quot;, ast_inet_ntoa(iabuf, sizeof(iabuf), sin.sin_addr), iaxs[fr.callno]-&gt;peerformat, iaxs[fr.callno]-&gt;peercapability, iaxs[fr.callno]-&gt;capability);
+										ast_log(LOG_NOTICE, &quot;Rejected connect attempt from %s, requested/capability 0x%x/0x%x incompatible with our capability 0x%x.\n&quot;, ast_inet_ntoa(iabuf, sizeof(iabuf), sin.sin_addr), iaxs[fr-&gt;callno]-&gt;peerformat, iaxs[fr-&gt;callno]-&gt;peercapability, iaxs[fr-&gt;callno]-&gt;capability);
 								}
 							} else {
 								/* Pick one... */
-								if(ast_test_flag(iaxs[fr.callno], IAX_CODEC_NOCAP)) {
-									if(!(iaxs[fr.callno]-&gt;peerformat &amp; iaxs[fr.callno]-&gt;capability))
+								if(ast_test_flag(iaxs[fr-&gt;callno], IAX_CODEC_NOCAP)) {
+									if(!(iaxs[fr-&gt;callno]-&gt;peerformat &amp; iaxs[fr-&gt;callno]-&gt;capability))
 										format = 0;
 								} else {
-									if(ast_test_flag(iaxs[fr.callno], IAX_CODEC_NOPREFS)) {
-										using_prefs = ast_test_flag(iaxs[fr.callno], IAX_CODEC_NOCAP) ? &quot;reqonly&quot; : &quot;disabled&quot;;
+									if(ast_test_flag(iaxs[fr-&gt;callno], IAX_CODEC_NOPREFS)) {
+										using_prefs = ast_test_flag(iaxs[fr-&gt;callno], IAX_CODEC_NOCAP) ? &quot;reqonly&quot; : &quot;disabled&quot;;
 										memset(&amp;pref, 0, sizeof(pref));
-										format = ast_best_codec(iaxs[fr.callno]-&gt;peercapability &amp; iaxs[fr.callno]-&gt;capability);
+										format = ast_best_codec(iaxs[fr-&gt;callno]-&gt;peercapability &amp; iaxs[fr-&gt;callno]-&gt;capability);
 										strcpy(caller_pref_buf,&quot;disabled&quot;);
 										strcpy(host_pref_buf,&quot;disabled&quot;);
 									} else {
 										using_prefs = &quot;mine&quot;;
-										if (ast_codec_pref_index(&amp;iaxs[fr.callno]-&gt;rprefs, 0)) {
+										if (ast_codec_pref_index(&amp;iaxs[fr-&gt;callno]-&gt;rprefs, 0)) {
 											/* Do the opposite of what we tried above. */
-											if (ast_test_flag(iaxs[fr.callno], IAX_CODEC_USER_FIRST)) {
-												pref = iaxs[fr.callno]-&gt;prefs;								
+											if (ast_test_flag(iaxs[fr-&gt;callno], IAX_CODEC_USER_FIRST)) {
+												pref = iaxs[fr-&gt;callno]-&gt;prefs;								
 											} else {
-												pref = iaxs[fr.callno]-&gt;rprefs;
+												pref = iaxs[fr-&gt;callno]-&gt;rprefs;
 												using_prefs = &quot;caller&quot;;
 											}
-											format = ast_codec_choose(&amp;pref, iaxs[fr.callno]-&gt;peercapability &amp; iaxs[fr.callno]-&gt;capability, 1);
+											format = ast_codec_choose(&amp;pref, iaxs[fr-&gt;callno]-&gt;peercapability &amp; iaxs[fr-&gt;callno]-&gt;capability, 1);
 									
 										} else /* if no codec_prefs IE do it the old way */
-											format = ast_best_codec(iaxs[fr.callno]-&gt;peercapability &amp; iaxs[fr.callno]-&gt;capability);	
+											format = ast_best_codec(iaxs[fr-&gt;callno]-&gt;peercapability &amp; iaxs[fr-&gt;callno]-&gt;capability);	
 									}
 								}
 
@@ -6888,11 +6889,11 @@
 									memset(&amp;ied0, 0, sizeof(ied0));
 									iax_ie_append_str(&amp;ied0, IAX_IE_CAUSE, &quot;Unable to negotiate codec&quot;);
 									iax_ie_append_byte(&amp;ied0, IAX_IE_CAUSECODE, AST_CAUSE_BEARERCAPABILITY_NOTAVAIL);
-									ast_log(LOG_ERROR, &quot;No best format in 0x%x???\n&quot;, iaxs[fr.callno]-&gt;peercapability &amp; iaxs[fr.callno]-&gt;capability);
-									send_command_final(iaxs[fr.callno], AST_FRAME_IAX, IAX_COMMAND_REJECT, 0, ied0.buf, ied0.pos, -1);
+									ast_log(LOG_ERROR, &quot;No best format in 0x%x???\n&quot;, iaxs[fr-&gt;callno]-&gt;peercapability &amp; iaxs[fr-&gt;callno]-&gt;capability);
+									send_command_final(iaxs[fr-&gt;callno], AST_FRAME_IAX, IAX_COMMAND_REJECT, 0, ied0.buf, ied0.pos, -1);
 									if (authdebug)
-										ast_log(LOG_NOTICE, &quot;Rejected connect attempt from %s, requested/capability 0x%x/0x%x incompatible with our capability 0x%x.\n&quot;, ast_inet_ntoa(iabuf, sizeof(iabuf), sin.sin_addr), iaxs[fr.callno]-&gt;peerformat, iaxs[fr.callno]-&gt;peercapability, iaxs[fr.callno]-&gt;capability);
-									ast_set_flag(iaxs[fr.callno], IAX_ALREADYGONE);	
+										ast_log(LOG_NOTICE, &quot;Rejected connect attempt from %s, requested/capability 0x%x/0x%x incompatible with our capability 0x%x.\n&quot;, ast_inet_ntoa(iabuf, sizeof(iabuf), sin.sin_addr), iaxs[fr-&gt;callno]-&gt;peerformat, iaxs[fr-&gt;callno]-&gt;peercapability, iaxs[fr-&gt;callno]-&gt;capability);
+									ast_set_flag(iaxs[fr-&gt;callno], IAX_ALREADYGONE);	
 									break;
 								}
 							}
@@ -6901,9 +6902,9 @@
 							/* No authentication required, let them in */
 							memset(&amp;ied1, 0, sizeof(ied1));
 							iax_ie_append_int(&amp;ied1, IAX_IE_FORMAT, format);
-							send_command(iaxs[fr.callno], AST_FRAME_IAX, IAX_COMMAND_ACCEPT, 0, ied1.buf, ied1.pos, -1);
-							if (strcmp(iaxs[fr.callno]-&gt;exten, &quot;TBD&quot;)) {
-								ast_set_flag(&amp;iaxs[fr.callno]-&gt;state, IAX_STATE_STARTED);
+							send_command(iaxs[fr-&gt;callno], AST_FRAME_IAX, IAX_COMMAND_ACCEPT, 0, ied1.buf, ied1.pos, -1);
+							if (strcmp(iaxs[fr-&gt;callno]-&gt;exten, &quot;TBD&quot;)) {
+								ast_set_flag(&amp;iaxs[fr-&gt;callno]-&gt;state, IAX_STATE_STARTED);
 								if (option_verbose &gt; 2) 
 									ast_verbose(VERBOSE_PREFIX_3 &quot;Accepting UNAUTHENTICATED call from %s:\n&quot;
 												&quot;%srequested format = %s,\n&quot;
@@ -6913,7 +6914,7 @@
 												&quot;%spriority = %s\n&quot;,
 												ast_inet_ntoa(iabuf, sizeof(iabuf), sin.sin_addr), 
 												VERBOSE_PREFIX_4,
-												ast_getformatname(iaxs[fr.callno]-&gt;peerformat), 
+												ast_getformatname(iaxs[fr-&gt;callno]-&gt;peerformat), 
 												VERBOSE_PREFIX_4,
 												caller_pref_buf,
 												VERBOSE_PREFIX_4,
@@ -6923,10 +6924,10 @@
 												VERBOSE_PREFIX_4,
 												using_prefs);
 								
-								if(!(c = ast_iax2_new(fr.callno, AST_STATE_RING, format)))
-									iax2_destroy_nolock(fr.callno);
+								if(!(c = ast_iax2_new(fr-&gt;callno, AST_STATE_RING, format)))
+									iax2_destroy_nolock(fr-&gt;callno);
 							} else {
-								ast_set_flag(&amp;iaxs[fr.callno]-&gt;state, IAX_STATE_TBD);
+								ast_set_flag(&amp;iaxs[fr-&gt;callno]-&gt;state, IAX_STATE_TBD);
 								/* If this is a TBD call, we're ready but now what...  */
 								if (option_verbose &gt; 2)
 									ast_verbose(VERBOSE_PREFIX_3 &quot;Accepted unauthenticated TBD call from %s\n&quot;, ast_inet_ntoa(iabuf, sizeof(iabuf), sin.sin_addr));
@@ -6935,134 +6936,134 @@
 					}
 					break;
 				}
-				if (iaxs[fr.callno]-&gt;authmethods &amp; IAX_AUTH_MD5)
-					merge_encryption(iaxs[fr.callno],ies.encmethods);
+				if (iaxs[fr-&gt;callno]-&gt;authmethods &amp; IAX_AUTH_MD5)
+					merge_encryption(iaxs[fr-&gt;callno],ies.encmethods);
 				else
-					iaxs[fr.callno]-&gt;encmethods = 0;
-				authenticate_request(iaxs[fr.callno]);
-				ast_set_flag(&amp;iaxs[fr.callno]-&gt;state, IAX_STATE_AUTHENTICATED);
+					iaxs[fr-&gt;callno]-&gt;encmethods = 0;
+				authenticate_request(iaxs[fr-&gt;callno]);
+				ast_set_flag(&amp;iaxs[fr-&gt;callno]-&gt;state, IAX_STATE_AUTHENTICATED);
 				break;
 			case IAX_COMMAND_DPREQ:
 				/* Request status in the dialplan */
-				if (ast_test_flag(&amp;iaxs[fr.callno]-&gt;state, IAX_STATE_TBD) &amp;&amp;
-					!ast_test_flag(&amp;iaxs[fr.callno]-&gt;state, IAX_STATE_STARTED) &amp;&amp; ies.called_number) {
+				if (ast_test_flag(&amp;iaxs[fr-&gt;callno]-&gt;state, IAX_STATE_TBD) &amp;&amp;
+					!ast_test_flag(&amp;iaxs[fr-&gt;callno]-&gt;state, IAX_STATE_STARTED) &amp;&amp; ies.called_number) {
 					if (iaxcompat) {
 						/* Spawn a thread for the lookup */
-						spawn_dp_lookup(fr.callno, iaxs[fr.callno]-&gt;context, ies.called_number, iaxs[fr.callno]-&gt;cid_num);
+						spawn_dp_lookup(fr-&gt;callno, iaxs[fr-&gt;callno]-&gt;context, ies.called_number, iaxs[fr-&gt;callno]-&gt;cid_num);
 					} else {
 						/* Just look it up */
-						dp_lookup(fr.callno, iaxs[fr.callno]-&gt;context, ies.called_number, iaxs[fr.callno]-&gt;cid_num, 1);
+						dp_lookup(fr-&gt;callno, iaxs[fr-&gt;callno]-&gt;context, ies.called_number, iaxs[fr-&gt;callno]-&gt;cid_num, 1);
 					}
 				}
 				break;
 			case IAX_COMMAND_HANGUP:
-				ast_set_flag(iaxs[fr.callno], IAX_ALREADYGONE);
-				ast_log(LOG_DEBUG, &quot;Immediately destroying %d, having received hangup\n&quot;, fr.callno);
+				ast_set_flag(iaxs[fr-&gt;callno], IAX_ALREADYGONE);
+				ast_log(LOG_DEBUG, &quot;Immediately destroying %d, having received hangup\n&quot;, fr-&gt;callno);
 				/* Set hangup cause according to remote */
-				if (ies.causecode &amp;&amp; iaxs[fr.callno]-&gt;owner)
-					iaxs[fr.callno]-&gt;owner-&gt;hangupcause = ies.causecode;
+				if (ies.causecode &amp;&amp; iaxs[fr-&gt;callno]-&gt;owner)
+					iaxs[fr-&gt;callno]-&gt;owner-&gt;hangupcause = ies.causecode;
 				/* Send ack immediately, before we destroy */
-				send_command_immediate(iaxs[fr.callno], AST_FRAME_IAX, IAX_COMMAND_ACK, fr.ts, NULL, 0,fr.iseqno);
-				iax2_destroy_nolock(fr.callno);
+				send_command_immediate(iaxs[fr-&gt;callno], AST_FRAME_IAX, IAX_COMMAND_ACK, fr-&gt;ts, NULL, 0,fr-&gt;iseqno);
+				iax2_destroy_nolock(fr-&gt;callno);
 				break;
 			case IAX_COMMAND_REJECT:
 				/* Set hangup cause according to remote */
-				if (ies.causecode &amp;&amp; iaxs[fr.callno]-&gt;owner)
-					iaxs[fr.callno]-&gt;owner-&gt;hangupcause = ies.causecode;
+				if (ies.causecode &amp;&amp; iaxs[fr-&gt;callno]-&gt;owner)
+					iaxs[fr-&gt;callno]-&gt;owner-&gt;hangupcause = ies.causecode;
 
-				if (!ast_test_flag(iaxs[fr.callno], IAX_PROVISION)) {
-					if (iaxs[fr.callno]-&gt;owner &amp;&amp; authdebug)
+				if (!ast_test_flag(iaxs[fr-&gt;callno], IAX_PROVISION)) {
+					if (iaxs[fr-&gt;callno]-&gt;owner &amp;&amp; authdebug)
 						ast_log(LOG_WARNING, &quot;Call rejected by %s: %s\n&quot;,
-							ast_inet_ntoa(iabuf, sizeof(iabuf), iaxs[fr.callno]-&gt;addr.sin_addr),
+							ast_inet_ntoa(iabuf, sizeof(iabuf), iaxs[fr-&gt;callno]-&gt;addr.sin_addr),
 							ies.cause ? ies.cause : &quot;&lt;Unknown&gt;&quot;);
 					ast_log(LOG_DEBUG, &quot;Immediately destroying %d, having received reject\n&quot;,
-						fr.callno);
+						fr-&gt;callno);
 				}
 				/* Send ack immediately, before we destroy */
-				send_command_immediate(iaxs[fr.callno], AST_FRAME_IAX, IAX_COMMAND_ACK,
-						       fr.ts, NULL, 0, fr.iseqno);
-				if (!ast_test_flag(iaxs[fr.callno], IAX_PROVISION))
-					iaxs[fr.callno]-&gt;error = EPERM;
-				iax2_destroy_nolock(fr.callno);
+				send_command_immediate(iaxs[fr-&gt;callno], AST_FRAME_IAX, IAX_COMMAND_ACK,
+						       fr-&gt;ts, NULL, 0, fr-&gt;iseqno);
+				if (!ast_test_flag(iaxs[fr-&gt;callno], IAX_PROVISION))
+					iaxs[fr-&gt;callno]-&gt;error = EPERM;
+				iax2_destroy_nolock(fr-&gt;callno);
 				break;
 			case IAX_COMMAND_TRANSFER:
-				if (iaxs[fr.callno]-&gt;owner &amp;&amp; ast_bridged_channel(iaxs[fr.callno]-&gt;owner) &amp;&amp; ies.called_number) {
+				if (iaxs[fr-&gt;callno]-&gt;owner &amp;&amp; ast_bridged_channel(iaxs[fr-&gt;callno]-&gt;owner) &amp;&amp; ies.called_number) {
 					/* Set BLINDTRANSFER channel variables */
-					pbx_builtin_setvar_helper(iaxs[fr.callno]-&gt;owner, &quot;BLINDTRANSFER&quot;, ast_bridged_channel(iaxs[fr.callno]-&gt;owner)-&gt;name);
-					pbx_builtin_setvar_helper(ast_bridged_channel(iaxs[fr.callno]-&gt;owner), &quot;BLINDTRANSFER&quot;, iaxs[fr.callno]-&gt;owner-&gt;name);
+					pbx_builtin_setvar_helper(iaxs[fr-&gt;callno]-&gt;owner, &quot;BLINDTRANSFER&quot;, ast_bridged_channel(iaxs[fr-&gt;callno]-&gt;owner)-&gt;name);
+					pbx_builtin_setvar_helper(ast_bridged_channel(iaxs[fr-&gt;callno]-&gt;owner), &quot;BLINDTRANSFER&quot;, iaxs[fr-&gt;callno]-&gt;owner-&gt;name);
 					if (!strcmp(ies.called_number, ast_parking_ext())) {
-						if (iax_park(ast_bridged_channel(iaxs[fr.callno]-&gt;owner), iaxs[fr.callno]-&gt;owner)) {
-							ast_log(LOG_WARNING, &quot;Failed to park call on '%s'\n&quot;, ast_bridged_channel(iaxs[fr.callno]-&gt;owner)-&gt;name);
+						if (iax_park(ast_bridged_channel(iaxs[fr-&gt;callno]-&gt;owner), iaxs[fr-&gt;callno]-&gt;owner)) {
+							ast_log(LOG_WARNING, &quot;Failed to park call on '%s'\n&quot;, ast_bridged_channel(iaxs[fr-&gt;callno]-&gt;owner)-&gt;name);
 						} else
-							ast_log(LOG_DEBUG, &quot;Parked call on '%s'\n&quot;, ast_bridged_channel(iaxs[fr.callno]-&gt;owner)-&gt;name);
+							ast_log(LOG_DEBUG, &quot;Parked call on '%s'\n&quot;, ast_bridged_channel(iaxs[fr-&gt;callno]-&gt;owner)-&gt;name);
 					} else {
-						if (ast_async_goto(ast_bridged_channel(iaxs[fr.callno]-&gt;owner), iaxs[fr.callno]-&gt;context, ies.called_number, 1))
-							ast_log(LOG_WARNING, &quot;Async goto of '%s' to '%s@%s' failed\n&quot;, ast_bridged_channel(iaxs[fr.callno]-&gt;owner)-&gt;name, 
-								ies.called_number, iaxs[fr.callno]-&gt;context);
+						if (ast_async_goto(ast_bridged_channel(iaxs[fr-&gt;callno]-&gt;owner), iaxs[fr-&gt;callno]-&gt;context, ies.called_number, 1))
+							ast_log(LOG_WARNING, &quot;Async goto of '%s' to '%s@%s' failed\n&quot;, ast_bridged_channel(iaxs[fr-&gt;callno]-&gt;owner)-&gt;name, 
+								ies.called_number, iaxs[fr-&gt;callno]-&gt;context);
 						else
-							ast_log(LOG_DEBUG, &quot;Async goto of '%s' to '%s@%s' started\n&quot;, ast_bridged_channel(iaxs[fr.callno]-&gt;owner)-&gt;name, 
-								ies.called_number, iaxs[fr.callno]-&gt;context);
+							ast_log(LOG_DEBUG, &quot;Async goto of '%s' to '%s@%s' started\n&quot;, ast_bridged_channel(iaxs[fr-&gt;callno]-&gt;owner)-&gt;name, 
+								ies.called_number, iaxs[fr-&gt;callno]-&gt;context);
 					}
 				} else
-						ast_log(LOG_DEBUG, &quot;Async goto not applicable on call %d\n&quot;, fr.callno);
+						ast_log(LOG_DEBUG, &quot;Async goto not applicable on call %d\n&quot;, fr-&gt;callno);
 				break;
 			case IAX_COMMAND_ACCEPT:
 				/* Ignore if call is already up or needs authentication or is a TBD */
-				if (ast_test_flag(&amp;iaxs[fr.callno]-&gt;state, IAX_STATE_STARTED | IAX_STATE_TBD | IAX_STATE_AUTHENTICATED))
+				if (ast_test_flag(&amp;iaxs[fr-&gt;callno]-&gt;state, IAX_STATE_STARTED | IAX_STATE_TBD | IAX_STATE_AUTHENTICATED))
 					break;
-				if (ast_test_flag(iaxs[fr.callno], IAX_PROVISION)) {
+				if (ast_test_flag(iaxs[fr-&gt;callno], IAX_PROVISION)) {
 					/* Send ack immediately, before we destroy */
-					send_command_immediate(iaxs[fr.callno], AST_FRAME_IAX, IAX_COMMAND_ACK, fr.ts, NULL, 0,fr.iseqno);
-					iax2_destroy_nolock(fr.callno);
+					send_command_immediate(iaxs[fr-&gt;callno], AST_FRAME_IAX, IAX_COMMAND_ACK, fr-&gt;ts, NULL, 0,fr-&gt;iseqno);
+					iax2_destroy_nolock(fr-&gt;callno);
 					break;
 				}
 				if (ies.format) {
-					iaxs[fr.callno]-&gt;peerformat = ies.format;
+					iaxs[fr-&gt;callno]-&gt;peerformat = ies.format;
 				} else {
-					if (iaxs[fr.callno]-&gt;owner)
-						iaxs[fr.callno]-&gt;peerformat = iaxs[fr.callno]-&gt;owner-&gt;nativeformats;
+					if (iaxs[fr-&gt;callno]-&gt;owner)
+						iaxs[fr-&gt;callno]-&gt;peerformat = iaxs[fr-&gt;callno]-&gt;owner-&gt;nativeformats;
 					else
-						iaxs[fr.callno]-&gt;peerformat = iaxs[fr.callno]-&gt;capability;
+						iaxs[fr-&gt;callno]-&gt;peerformat = iaxs[fr-&gt;callno]-&gt;capability;
 				}
 				if (option_verbose &gt; 2)
-					ast_verbose(VERBOSE_PREFIX_3 &quot;Call accepted by %s (format %s)\n&quot;, ast_inet_ntoa(iabuf, sizeof(iabuf), iaxs[fr.callno]-&gt;addr.sin_addr), ast_getformatname(iaxs[fr.callno]-&gt;peerformat));
-				if (!(iaxs[fr.callno]-&gt;peerformat &amp; iaxs[fr.callno]-&gt;capability)) {
+					ast_verbose(VERBOSE_PREFIX_3 &quot;Call accepted by %s (format %s)\n&quot;, ast_inet_ntoa(iabuf, sizeof(iabuf), iaxs[fr-&gt;callno]-&gt;addr.sin_addr), ast_getformatname(iaxs[fr-&gt;callno]-&gt;peerformat));
+				if (!(iaxs[fr-&gt;callno]-&gt;peerformat &amp; iaxs[fr-&gt;callno]-&gt;capability)) {
 					memset(&amp;ied0, 0, sizeof(ied0));
 					iax_ie_append_str(&amp;ied0, IAX_IE_CAUSE, &quot;Unable to negotiate codec&quot;);
 					iax_ie_append_byte(&amp;ied0, IAX_IE_CAUSECODE, AST_CAUSE_BEARERCAPABILITY_NOTAVAIL);
-					send_command_final(iaxs[fr.callno], AST_FRAME_IAX, IAX_COMMAND_REJECT, 0, ied0.buf, ied0.pos, -1);
+					send_command_final(iaxs[fr-&gt;callno], AST_FRAME_IAX, IAX_COMMAND_REJECT, 0, ied0.buf, ied0.pos, -1);
 					if (authdebug)
-						ast_log(LOG_NOTICE, &quot;Rejected call to %s, format 0x%x incompatible with our capability 0x%x.\n&quot;, ast_inet_ntoa(iabuf, sizeof(iabuf), sin.sin_addr), iaxs[fr.callno]-&gt;peerformat, iaxs[fr.callno]-&gt;capability);
+						ast_log(LOG_NOTICE, &quot;Rejected call to %s, format 0x%x incompatible with our capability 0x%x.\n&quot;, ast_inet_ntoa(iabuf, sizeof(iabuf), sin.sin_addr), iaxs[fr-&gt;callno]-&gt;peerformat, iaxs[fr-&gt;callno]-&gt;capability);
 				} else {
-					ast_set_flag(&amp;iaxs[fr.callno]-&gt;state, IAX_STATE_STARTED);
-					if (iaxs[fr.callno]-&gt;owner) {
+					ast_set_flag(&amp;iaxs[fr-&gt;callno]-&gt;state, IAX_STATE_STARTED);
+					if (iaxs[fr-&gt;callno]-&gt;owner) {
 						/* Switch us to use a compatible format */
-						iaxs[fr.callno]-&gt;owner-&gt;nativeformats = iaxs[fr.callno]-&gt;peerformat;
+						iaxs[fr-&gt;callno]-&gt;owner-&gt;nativeformats = iaxs[fr-&gt;callno]-&gt;peerformat;
 						if (option_verbose &gt; 2)
-							ast_verbose(VERBOSE_PREFIX_3 &quot;Format for call is %s\n&quot;, ast_getformatname(iaxs[fr.callno]-&gt;owner-&gt;nativeformats));
+							ast_verbose(VERBOSE_PREFIX_3 &quot;Format for call is %s\n&quot;, ast_getformatname(iaxs[fr-&gt;callno]-&gt;owner-&gt;nativeformats));
 retryowner2:
-						if (ast_mutex_trylock(&amp;iaxs[fr.callno]-&gt;owner-&gt;lock)) {
-							ast_mutex_unlock(&amp;iaxsl[fr.callno]);
+						if (ast_mutex_trylock(&amp;iaxs[fr-&gt;callno]-&gt;owner-&gt;lock)) {
+							ast_mutex_unlock(&amp;iaxsl[fr-&gt;callno]);
 							usleep(1);
-							ast_mutex_lock(&amp;iaxsl[fr.callno]);
-							if (iaxs[fr.callno] &amp;&amp; iaxs[fr.callno]-&gt;owner) goto retryowner2;
+							ast_mutex_lock(&amp;iaxsl[fr-&gt;callno]);
+							if (iaxs[fr-&gt;callno] &amp;&amp; iaxs[fr-&gt;callno]-&gt;owner) goto retryowner2;
 						}
 						
-						if (iaxs[fr.callno] &amp;&amp; iaxs[fr.callno]-&gt;owner) {
+						if (iaxs[fr-&gt;callno] &amp;&amp; iaxs[fr-&gt;callno]-&gt;owner) {
 							/* Setup read/write formats properly. */
-							if (iaxs[fr.callno]-&gt;owner-&gt;writeformat)
-								ast_set_write_format(iaxs[fr.callno]-&gt;owner, iaxs[fr.callno]-&gt;owner-&gt;writeformat);	
-							if (iaxs[fr.callno]-&gt;owner-&gt;readformat)
-								ast_set_read_format(iaxs[fr.callno]-&gt;owner, iaxs[fr.callno]-&gt;owner-&gt;readformat);	
-							ast_mutex_unlock(&amp;iaxs[fr.callno]-&gt;owner-&gt;lock);
+							if (iaxs[fr-&gt;callno]-&gt;owner-&gt;writeformat)
+								ast_set_write_format(iaxs[fr-&gt;callno]-&gt;owner, iaxs[fr-&gt;callno]-&gt;owner-&gt;writeformat);	
+							if (iaxs[fr-&gt;callno]-&gt;owner-&gt;readformat)
+								ast_set_read_format(iaxs[fr-&gt;callno]-&gt;owner, iaxs[fr-&gt;callno]-&gt;owner-&gt;readformat);	
+							ast_mutex_unlock(&amp;iaxs[fr-&gt;callno]-&gt;owner-&gt;lock);
 						}
 					}
 				}
 				ast_mutex_lock(&amp;dpcache_lock);
-				dp = iaxs[fr.callno]-&gt;dpentries;
+				dp = iaxs[fr-&gt;callno]-&gt;dpentries;
 				while(dp) {
 					if (!(dp-&gt;flags &amp; CACHE_FLAG_TRANSMITTED)) {
-						iax2_dprequest(dp, fr.callno);
+						iax2_dprequest(dp, fr-&gt;callno);
 					}
 					dp = dp-&gt;peer;
 				}
@@ -7070,71 +7071,71 @@
 				break;
 			case IAX_COMMAND_POKE:
 				/* Send back a pong packet with the original timestamp */
-				send_command_final(iaxs[fr.callno], AST_FRAME_IAX, IAX_COMMAND_PONG, fr.ts, NULL, 0, -1);
+				send_command_final(iaxs[fr-&gt;callno], AST_FRAME_IAX, IAX_COMMAND_PONG, fr-&gt;ts, NULL, 0, -1);
 				break;
 			case IAX_COMMAND_PING:
 #ifdef BRIDGE_OPTIMIZATION
-				if (iaxs[fr.callno]-&gt;bridgecallno) {
+				if (iaxs[fr-&gt;callno]-&gt;bridgecallno) {
 					/* If we're in a bridged call, just forward this */
-					forward_command(iaxs[fr.callno], AST_FRAME_IAX, IAX_COMMAND_PING, fr.ts, NULL, 0, -1);
+					forward_command(iaxs[fr-&gt;callno], AST_FRAME_IAX, IAX_COMMAND_PING, fr-&gt;ts, NULL, 0, -1);
 				} else {
 					struct iax_ie_data pingied;
-					construct_rr(iaxs[fr.callno], &amp;pingied);
+					construct_rr(iaxs[fr-&gt;callno], &amp;pingied);
 					/* Send back a pong packet with the original timestamp */
-					send_command(iaxs[fr.callno], AST_FRAME_IAX, IAX_COMMAND_PONG, fr.ts, pingied.buf, pingied.pos, -1);
+					send_command(iaxs[fr-&gt;callno], AST_FRAME_IAX, IAX_COMMAND_PONG, fr-&gt;ts, pingied.buf, pingied.pos, -1);
 				}
 #else				
 				{
 					struct iax_ie_data pingied;
-					construct_rr(iaxs[fr.callno], &amp;pingied);
+					construct_rr(iaxs[fr-&gt;callno], &amp;pingied);
 				/* Send back a pong packet with the original timestamp */
-					send_command(iaxs[fr.callno], AST_FRAME_IAX, IAX_COMMAND_PONG, fr.ts, pingied.buf, pingied.pos, -1);
+					send_command(iaxs[fr-&gt;callno], AST_FRAME_IAX, IAX_COMMAND_PONG, fr-&gt;ts, pingied.buf, pingied.pos, -1);
 				}
 #endif			
 				break;
 			case IAX_COMMAND_PONG:
 #ifdef BRIDGE_OPTIMIZATION
-				if (iaxs[fr.callno]-&gt;bridgecallno) {
+				if (iaxs[fr-&gt;callno]-&gt;bridgecallno) {
 					/* Forward to the other side of the bridge */
-					forward_command(iaxs[fr.callno], AST_FRAME_IAX, IAX_COMMAND_PONG, fr.ts, NULL, 0, -1);
+					forward_command(iaxs[fr-&gt;callno], AST_FRAME_IAX, IAX_COMMAND_PONG, fr-&gt;ts, NULL, 0, -1);
 				} else {
 					/* Calculate ping time */
-					iaxs[fr.callno]-&gt;pingtime =  calc_timestamp(iaxs[fr.callno], 0, &amp;f) - fr.ts;
+					iaxs[fr-&gt;callno]-&gt;pingtime =  calc_timestamp(iaxs[fr-&gt;callno], 0, &amp;f) - fr-&gt;ts;
 				}
 #else
 				/* Calculate ping time */
-				iaxs[fr.callno]-&gt;pingtime =  calc_timestamp(iaxs[fr.callno], 0, &amp;f) - fr.ts;
+				iaxs[fr-&gt;callno]-&gt;pingtime =  calc_timestamp(iaxs[fr-&gt;callno], 0, &amp;f) - fr-&gt;ts;
 #endif
 				/* save RR info */
-				save_rr(&amp;fr, &amp;ies);
+				save_rr(fr, &amp;ies);
 
-				if (iaxs[fr.callno]-&gt;peerpoke) {
-					peer = iaxs[fr.callno]-&gt;peerpoke;
+				if (iaxs[fr-&gt;callno]-&gt;peerpoke) {
+					peer = iaxs[fr-&gt;callno]-&gt;peerpoke;
 					if ((peer-&gt;lastms &lt; 0)  || (peer-&gt;historicms &gt; peer-&gt;maxms)) {
-						if (iaxs[fr.callno]-&gt;pingtime &lt;= peer-&gt;maxms) {
-							ast_log(LOG_NOTICE, &quot;Peer '%s' is now REACHABLE! Time: %d\n&quot;, peer-&gt;name, iaxs[fr.callno]-&gt;pingtime);
-							manager_event(EVENT_FLAG_SYSTEM, &quot;PeerStatus&quot;, &quot;Peer: IAX2/%s\r\nPeerStatus: Reachable\r\nTime: %d\r\n&quot;, peer-&gt;name, iaxs[fr.callno]-&gt;pingtime); 
+						if (iaxs[fr-&gt;callno]-&gt;pingtime &lt;= peer-&gt;maxms) {
+							ast_log(LOG_NOTICE, &quot;Peer '%s' is now REACHABLE! Time: %d\n&quot;, peer-&gt;name, iaxs[fr-&gt;callno]-&gt;pingtime);
+							manager_event(EVENT_FLAG_SYSTEM, &quot;PeerStatus&quot;, &quot;Peer: IAX2/%s\r\nPeerStatus: Reachable\r\nTime: %d\r\n&quot;, peer-&gt;name, iaxs[fr-&gt;callno]-&gt;pingtime); 
 							ast_device_state_changed(&quot;IAX2/%s&quot;, peer-&gt;name); /* Activate notification */
 						}
 					} else if ((peer-&gt;historicms &gt; 0) &amp;&amp; (peer-&gt;historicms &lt;= peer-&gt;maxms)) {
-						if (iaxs[fr.callno]-&gt;pingtime &gt; peer-&gt;maxms) {
-							ast_log(LOG_NOTICE, &quot;Peer '%s' is now TOO LAGGED (%d ms)!\n&quot;, peer-&gt;name, iaxs[fr.callno]-&gt;pingtime);
-							manager_event(EVENT_FLAG_SYSTEM, &quot;PeerStatus&quot;, &quot;Peer: IAX2/%s\r\nPeerStatus: Lagged\r\nTime: %d\r\n&quot;, peer-&gt;name, iaxs[fr.callno]-&gt;pingtime); 
+						if (iaxs[fr-&gt;callno]-&gt;pingtime &gt; peer-&gt;maxms) {
+							ast_log(LOG_NOTICE, &quot;Peer '%s' is now TOO LAGGED (%d ms)!\n&quot;, peer-&gt;name, iaxs[fr-&gt;callno]-&gt;pingtime);
+							manager_event(EVENT_FLAG_SYSTEM, &quot;PeerStatus&quot;, &quot;Peer: IAX2/%s\r\nPeerStatus: Lagged\r\nTime: %d\r\n&quot;, peer-&gt;name, iaxs[fr-&gt;callno]-&gt;pingtime); 
 							ast_device_state_changed(&quot;IAX2/%s&quot;, peer-&gt;name); /* Activate notification */
 						}
 					}
-					peer-&gt;lastms = iaxs[fr.callno]-&gt;pingtime;
+					peer-&gt;lastms = iaxs[fr-&gt;callno]-&gt;pingtime;
 					if (peer-&gt;smoothing &amp;&amp; (peer-&gt;lastms &gt; -1))
-						peer-&gt;historicms = (iaxs[fr.callno]-&gt;pingtime + peer-&gt;historicms) / 2;
+						peer-&gt;historicms = (iaxs[fr-&gt;callno]-&gt;pingtime + peer-&gt;historicms) / 2;
 					else if (peer-&gt;smoothing &amp;&amp; peer-&gt;lastms &lt; 0)
 						peer-&gt;historicms = (0 + peer-&gt;historicms) / 2;
 					else					
-						peer-&gt;historicms = iaxs[fr.callno]-&gt;pingtime;
+						peer-&gt;historicms = iaxs[fr-&gt;callno]-&gt;pingtime;
 
 					if (peer-&gt;pokeexpire &gt; -1)
 						ast_sched_del(sched, peer-&gt;pokeexpire);
-					send_command_immediate(iaxs[fr.callno], AST_FRAME_IAX, IAX_COMMAND_ACK, fr.ts, NULL, 0,fr.iseqno);
-					iax2_destroy_nolock(fr.callno);
+					send_command_immediate(iaxs[fr-&gt;callno], AST_FRAME_IAX, IAX_COMMAND_ACK, fr-&gt;ts, NULL, 0,fr-&gt;iseqno);
+					iax2_destroy_nolock(fr-&gt;callno);
 					peer-&gt;callno = 0;
 					/* Try again eventually */
 						ast_log(LOG_DEBUG, &quot;Peer lastms %d, historicms %d, maxms %d\n&quot;, peer-&gt;lastms, peer-&gt;historicms, peer-&gt;maxms);
@@ -7147,158 +7148,158 @@
 			case IAX_COMMAND_LAGRQ:
 			case IAX_COMMAND_LAGRP:
 #ifdef BRIDGE_OPTIMIZATION
-				if (iaxs[fr.callno]-&gt;bridgecallno) {
-					forward_command(iaxs[fr.callno], AST_FRAME_IAX, f.subclass, fr.ts, NULL, 0, -1);
+				if (iaxs[fr-&gt;callno]-&gt;bridgecallno) {
+					forward_command(iaxs[fr-&gt;callno], AST_FRAME_IAX, f.subclass, fr-&gt;ts, NULL, 0, -1);
 				} else {
 #endif				
 					f.src = &quot;LAGRQ&quot;;
 					f.mallocd = 0;
 					f.offset = 0;
 					f.samples = 0;
-					iax_frame_wrap(&amp;fr, &amp;f);
+					iax_frame_wrap(fr, &amp;f);
 					if(f.subclass == IAX_COMMAND_LAGRQ) {
 					    /* Received a LAGRQ - echo back a LAGRP */
-					    fr.af.subclass = IAX_COMMAND_LAGRP;
-					    iax2_send(iaxs[fr.callno], &amp;fr.af, fr.ts, -1, 0, 0, 0);
+					    fr-&gt;af.subclass = IAX_COMMAND_LAGRP;
+					    iax2_send(iaxs[fr-&gt;callno], &amp;fr-&gt;af, fr-&gt;ts, -1, 0, 0, 0);
 					} else {
 					    /* Received LAGRP in response to our LAGRQ */
 					    unsigned int ts;
 					    /* This is a reply we've been given, actually measure the difference */
-					    ts = calc_timestamp(iaxs[fr.callno], 0, &amp;fr.af);
-					    iaxs[fr.callno]-&gt;lag = ts - fr.ts;
+					    ts = calc_timestamp(iaxs[fr-&gt;callno], 0, &amp;fr-&gt;af);
+					    iaxs[fr-&gt;callno]-&gt;lag = ts - fr-&gt;ts;
 					    if (option_debug &amp;&amp; iaxdebug)
 						ast_log(LOG_DEBUG, &quot;Peer %s lag measured as %dms\n&quot;,
-								ast_inet_ntoa(iabuf, sizeof(iabuf), iaxs[fr.callno]-&gt;addr.sin_addr), iaxs[fr.callno]-&gt;lag);
+								ast_inet_ntoa(iabuf, sizeof(iabuf), iaxs[fr-&gt;callno]-&gt;addr.sin_addr), iaxs[fr-&gt;callno]-&gt;lag);
 					}
 #ifdef BRIDGE_OPTIMIZATION
 				}
 #endif				
 				break;
 			case IAX_COMMAND_AUTHREQ:
-				if (ast_test_flag(&amp;iaxs[fr.callno]-&gt;state, IAX_STATE_STARTED | IAX_STATE_TBD)) {
-					ast_log(LOG_WARNING, &quot;Call on %s is already up, can't start on it\n&quot;, iaxs[fr.callno]-&gt;owner ? iaxs[fr.callno]-&gt;owner-&gt;name : &quot;&lt;Unknown&gt;&quot;);
+				if (ast_test_flag(&amp;iaxs[fr-&gt;callno]-&gt;state, IAX_STATE_STARTED | IAX_STATE_TBD)) {
+					ast_log(LOG_WARNING, &quot;Call on %s is already up, can't start on it\n&quot;, iaxs[fr-&gt;callno]-&gt;owner ? iaxs[fr-&gt;callno]-&gt;owner-&gt;name : &quot;&lt;Unknown&gt;&quot;);
 					break;
 				}
-				if (authenticate_reply(iaxs[fr.callno], &amp;iaxs[fr.callno]-&gt;addr, &amp;ies, iaxs[fr.callno]-&gt;secret, iaxs[fr.callno]-&gt;outkey)) {
+				if (authenticate_reply(iaxs[fr-&gt;callno], &amp;iaxs[fr-&gt;callno]-&gt;addr, &amp;ies, iaxs[fr-&gt;callno]-&gt;secret, iaxs[fr-&gt;callno]-&gt;outkey)) {
 					ast_log(LOG_WARNING, 
 						&quot;I don't know how to authenticate %s to %s\n&quot;, 
-						ies.username ? ies.username : &quot;&lt;unknown&gt;&quot;, ast_inet_ntoa(iabuf, sizeof(iabuf), iaxs[fr.callno]-&gt;addr.sin_addr));
+						ies.username ? ies.username : &quot;&lt;unknown&gt;&quot;, ast_inet_ntoa(iabuf, sizeof(iabuf), iaxs[fr-&gt;callno]-&gt;addr.sin_addr));
 				}
 				break;
 			case IAX_COMMAND_AUTHREP:
 				/* For security, always ack immediately */
 				if (delayreject)
-					send_command_immediate(iaxs[fr.callno], AST_FRAME_IAX, IAX_COMMAND_ACK, fr.ts, NULL, 0,fr.iseqno);
+					send_command_immediate(iaxs[fr-&gt;callno], AST_FRAME_IAX, IAX_COMMAND_ACK, fr-&gt;ts, NULL, 0,fr-&gt;iseqno);
 				/* Ignore once we've started */
-				if (ast_test_flag(&amp;iaxs[fr.callno]-&gt;state, IAX_STATE_STARTED | IAX_STATE_TBD)) {
-					ast_log(LOG_WARNING, &quot;Call on %s is already up, can't start on it\n&quot;, iaxs[fr.callno]-&gt;owner ? iaxs[fr.callno]-&gt;owner-&gt;name : &quot;&lt;Unknown&gt;&quot;);
+				if (ast_test_flag(&amp;iaxs[fr-&gt;callno]-&gt;state, IAX_STATE_STARTED | IAX_STATE_TBD)) {
+					ast_log(LOG_WARNING, &quot;Call on %s is already up, can't start on it\n&quot;, iaxs[fr-&gt;callno]-&gt;owner ? iaxs[fr-&gt;callno]-&gt;owner-&gt;name : &quot;&lt;Unknown&gt;&quot;);
 					break;
 				}
-				if (authenticate_verify(iaxs[fr.callno], &amp;ies)) {
+				if (authenticate_verify(iaxs[fr-&gt;callno], &amp;ies)) {
 					if (authdebug)
-						ast_log(LOG_NOTICE, &quot;Host %s failed to authenticate as %s\n&quot;, ast_inet_ntoa(iabuf, sizeof(iabuf), iaxs[fr.callno]-&gt;addr.sin_addr), iaxs[fr.callno]-&gt;username);
+						ast_log(LOG_NOTICE, &quot;Host %s failed to authenticate as %s\n&quot;, ast_inet_ntoa(iabuf, sizeof(iabuf), iaxs[fr-&gt;callno]-&gt;addr.sin_addr), iaxs[fr-&gt;callno]-&gt;username);
 					memset(&amp;ied0, 0, sizeof(ied0));
-					auth_fail(fr.callno, IAX_COMMAND_REJECT);
+					auth_fail(fr-&gt;callno, IAX_COMMAND_REJECT);
 					break;
 				}
-				if (strcasecmp(iaxs[fr.callno]-&gt;exten, &quot;TBD&quot;)) {
+				if (strcasecmp(iaxs[fr-&gt;callno]-&gt;exten, &quot;TBD&quot;)) {
 					/* This might re-enter the IAX code and need the lock */
-					exists = ast_exists_extension(NULL, iaxs[fr.callno]-&gt;context, iaxs[fr.callno]-&gt;exten, 1, iaxs[fr.callno]-&gt;cid_num);
+					exists = ast_exists_extension(NULL, iaxs[fr-&gt;callno]-&gt;context, iaxs[fr-&gt;callno]-&gt;exten, 1, iaxs[fr-&gt;callno]-&gt;cid_num);
 				} else
 					exists = 0;
-				if (strcmp(iaxs[fr.callno]-&gt;exten, &quot;TBD&quot;) &amp;&amp; !exists) {
+				if (strcmp(iaxs[fr-&gt;callno]-&gt;exten, &quot;TBD&quot;) &amp;&amp; !exists) {
 					if (authdebug)
-						ast_log(LOG_NOTICE, &quot;Rejected connect attempt from %s, request '%s@%s' does not exist\n&quot;, ast_inet_ntoa(iabuf, sizeof(iabuf), sin.sin_addr), iaxs[fr.callno]-&gt;exten, iaxs[fr.callno]-&gt;context);
+						ast_log(LOG_NOTICE, &quot;Rejected connect attempt from %s, request '%s@%s' does not exist\n&quot;, ast_inet_ntoa(iabuf, sizeof(iabuf), sin.sin_addr), iaxs[fr-&gt;callno]-&gt;exten, iaxs[fr-&gt;callno]-&gt;context);
 					memset(&amp;ied0, 0, sizeof(ied0));
 					iax_ie_append_str(&amp;ied0, IAX_IE_CAUSE, &quot;No such context/extension&quot;);
 					iax_ie_append_byte(&amp;ied0, IAX_IE_CAUSECODE, AST_CAUSE_NO_ROUTE_DESTINATION);
-					send_command_final(iaxs[fr.callno], AST_FRAME_IAX, IAX_COMMAND_REJECT, 0, ied0.buf, ied0.pos, -1);
+					send_command_final(iaxs[fr-&gt;callno], AST_FRAME_IAX, IAX_COMMAND_REJECT, 0, ied0.buf, ied0.pos, -1);
 				} else {
 					/* Select an appropriate format */
-					if(ast_test_flag(iaxs[fr.callno], IAX_CODEC_NOPREFS)) {
-						if(ast_test_flag(iaxs[fr.callno], IAX_CODEC_NOCAP)) {
+					if(ast_test_flag(iaxs[fr-&gt;callno], IAX_CODEC_NOPREFS)) {
+						if(ast_test_flag(iaxs[fr-&gt;callno], IAX_CODEC_NOCAP)) {
 							using_prefs = &quot;reqonly&quot;;
 						} else {
 							using_prefs = &quot;disabled&quot;;
 						}
-						format = iaxs[fr.callno]-&gt;peerformat &amp; iaxs[fr.callno]-&gt;capability;
+						format = iaxs[fr-&gt;callno]-&gt;peerformat &amp; iaxs[fr-&gt;callno]-&gt;capability;
 						memset(&amp;pref, 0, sizeof(pref));
 						strcpy(caller_pref_buf, &quot;disabled&quot;);
 						strcpy(host_pref_buf, &quot;disabled&quot;);
 					} else {
 						using_prefs = &quot;mine&quot;;
 						if (ies.codec_prefs)
-							ast_codec_pref_convert(&amp;iaxs[fr.callno]-&gt;rprefs, ies.codec_prefs, 32, 0);
-						if (ast_codec_pref_index(&amp;iaxs[fr.callno]-&gt;rprefs, 0)) {
-							if (ast_test_flag(iaxs[fr.callno], IAX_CODEC_USER_FIRST)) {
-								pref = iaxs[fr.callno]-&gt;rprefs;
+							ast_codec_pref_convert(&amp;iaxs[fr-&gt;callno]-&gt;rprefs, ies.codec_prefs, 32, 0);
+						if (ast_codec_pref_index(&amp;iaxs[fr-&gt;callno]-&gt;rprefs, 0)) {
+							if (ast_test_flag(iaxs[fr-&gt;callno], IAX_CODEC_USER_FIRST)) {
+								pref = iaxs[fr-&gt;callno]-&gt;rprefs;
 								using_prefs = &quot;caller&quot;;
 							} else {
-								pref = iaxs[fr.callno]-&gt;prefs;
+								pref = iaxs[fr-&gt;callno]-&gt;prefs;
 							}
 						} else /* if no codec_prefs IE do it the old way */
-							pref = iaxs[fr.callno]-&gt;prefs;
+							pref = iaxs[fr-&gt;callno]-&gt;prefs;
 					
-						format = ast_codec_choose(&amp;pref, iaxs[fr.callno]-&gt;capability &amp; iaxs[fr.callno]-&gt;peercapability, 0);
-						ast_codec_pref_string(&amp;iaxs[fr.callno]-&gt;rprefs, caller_pref_buf, sizeof(caller_pref_buf) - 1);
-						ast_codec_pref_string(&amp;iaxs[fr.callno]-&gt;prefs, host_pref_buf, sizeof(host_pref_buf) - 1);
+						format = ast_codec_choose(&amp;pref, iaxs[fr-&gt;callno]-&gt;capability &amp; iaxs[fr-&gt;callno]-&gt;peercapability, 0);
+						ast_codec_pref_string(&amp;iaxs[fr-&gt;callno]-&gt;rprefs, caller_pref_buf, sizeof(caller_pref_buf) - 1);
+						ast_codec_pref_string(&amp;iaxs[fr-&gt;callno]-&gt;prefs, host_pref_buf, sizeof(host_pref_buf) - 1);
 					}
 					if (!format) {
-						if(!ast_test_flag(iaxs[fr.callno], IAX_CODEC_NOCAP)) {
-							ast_log(LOG_DEBUG, &quot;We don't do requested format %s, falling back to peer capability %d\n&quot;, ast_getformatname(iaxs[fr.callno]-&gt;peerformat), iaxs[fr.callno]-&gt;peercapability);
-							format = iaxs[fr.callno]-&gt;peercapability &amp; iaxs[fr.callno]-&gt;capability;
+						if(!ast_test_flag(iaxs[fr-&gt;callno], IAX_CODEC_NOCAP)) {
+							ast_log(LOG_DEBUG, &quot;We don't do requested format %s, falling back to peer capability %d\n&quot;, ast_getformatname(iaxs[fr-&gt;callno]-&gt;peerformat), iaxs[fr-&gt;callno]-&gt;peercapability);
+							format = iaxs[fr-&gt;callno]-&gt;peercapability &amp; iaxs[fr-&gt;callno]-&gt;capability;
 						}
 						if (!format) {
 							if (authdebug) {
-								if(ast_test_flag(iaxs[fr.callno], IAX_CODEC_NOCAP)) 
-									ast_log(LOG_NOTICE, &quot;Rejected connect attempt from %s, requested 0x%x incompatible with our capability 0x%x.\n&quot;, ast_inet_ntoa(iabuf, sizeof(iabuf), sin.sin_addr), iaxs[fr.callno]-&gt;peerformat, iaxs[fr.callno]-&gt;capability);
+								if(ast_test_flag(iaxs[fr-&gt;callno], IAX_CODEC_NOCAP)) 
+									ast_log(LOG_NOTICE, &quot;Rejected connect attempt from %s, requested 0x%x incompatible with our capability 0x%x.\n&quot;, ast_inet_ntoa(iabuf, sizeof(iabuf), sin.sin_addr), iaxs[fr-&gt;callno]-&gt;peerformat, iaxs[fr-&gt;callno]-&gt;capability);
 								else
-									ast_log(LOG_NOTICE, &quot;Rejected connect attempt from %s, requested/capability 0x%x/0x%x incompatible with our capability 0x%x.\n&quot;, ast_inet_ntoa(iabuf, sizeof(iabuf), sin.sin_addr), iaxs[fr.callno]-&gt;peerformat, iaxs[fr.callno]-&gt;peercapability, iaxs[fr.callno]-&gt;capability);
+									ast_log(LOG_NOTICE, &quot;Rejected connect attempt from %s, requested/capability 0x%x/0x%x incompatible with our capability 0x%x.\n&quot;, ast_inet_ntoa(iabuf, sizeof(iabuf), sin.sin_addr), iaxs[fr-&gt;callno]-&gt;peerformat, iaxs[fr-&gt;callno]-&gt;peercapability, iaxs[fr-&gt;callno]-&gt;capability);
 							}
 							memset(&amp;ied0, 0, sizeof(ied0));
 							iax_ie_append_str(&amp;ied0, IAX_IE_CAUSE, &quot;Unable to negotiate codec&quot;);
 							iax_ie_append_byte(&amp;ied0, IAX_IE_CAUSECODE, AST_CAUSE_BEARERCAPABILITY_NOTAVAIL);
-							send_command_final(iaxs[fr.callno], AST_FRAME_IAX, IAX_COMMAND_REJECT, 0, ied0.buf, ied0.pos, -1);
+							send_command_final(iaxs[fr-&gt;callno], AST_FRAME_IAX, IAX_COMMAND_REJECT, 0, ied0.buf, ied0.pos, -1);
 						} else {
 							/* Pick one... */
-							if(ast_test_flag(iaxs[fr.callno], IAX_CODEC_NOCAP)) {
-								if(!(iaxs[fr.callno]-&gt;peerformat &amp; iaxs[fr.callno]-&gt;capability))
+							if(ast_test_flag(iaxs[fr-&gt;callno], IAX_CODEC_NOCAP)) {
+								if(!(iaxs[fr-&gt;callno]-&gt;peerformat &amp; iaxs[fr-&gt;callno]-&gt;capability))
 									format = 0;
 							} else {
-								if(ast_test_flag(iaxs[fr.callno], IAX_CODEC_NOPREFS)) {
-									using_prefs = ast_test_flag(iaxs[fr.callno], IAX_CODEC_NOCAP) ? &quot;reqonly&quot; : &quot;disabled&quot;;
+								if(ast_test_flag(iaxs[fr-&gt;callno], IAX_CODEC_NOPREFS)) {
+									using_prefs = ast_test_flag(iaxs[fr-&gt;callno], IAX_CODEC_NOCAP) ? &quot;reqonly&quot; : &quot;disabled&quot;;
 									memset(&amp;pref, 0, sizeof(pref));
-									format = ast_test_flag(iaxs[fr.callno], IAX_CODEC_NOCAP) ?
-										iaxs[fr.callno]-&gt;peerformat : ast_best_codec(iaxs[fr.callno]-&gt;peercapability &amp; iaxs[fr.callno]-&gt;capability);
+									format = ast_test_flag(iaxs[fr-&gt;callno], IAX_CODEC_NOCAP) ?
+										iaxs[fr-&gt;callno]-&gt;peerformat : ast_best_codec(iaxs[fr-&gt;callno]-&gt;peercapability &amp; iaxs[fr-&gt;callno]-&gt;capability);
 									strcpy(caller_pref_buf,&quot;disabled&quot;);
 									strcpy(host_pref_buf,&quot;disabled&quot;);
 								} else {
 									using_prefs = &quot;mine&quot;;
-									if (ast_codec_pref_index(&amp;iaxs[fr.callno]-&gt;rprefs, 0)) {
+									if (ast_codec_pref_index(&amp;iaxs[fr-&gt;callno]-&gt;rprefs, 0)) {
 										/* Do the opposite of what we tried above. */
-										if (ast_test_flag(iaxs[fr.callno], IAX_CODEC_USER_FIRST)) {
-											pref = iaxs[fr.callno]-&gt;prefs;						
+										if (ast_test_flag(iaxs[fr-&gt;callno], IAX_CODEC_USER_FIRST)) {
+											pref = iaxs[fr-&gt;callno]-&gt;prefs;						
 										} else {
-											pref = iaxs[fr.callno]-&gt;rprefs;
+											pref = iaxs[fr-&gt;callno]-&gt;rprefs;
 											using_prefs = &quot;caller&quot;;
 										}
-										format = ast_codec_choose(&amp;pref, iaxs[fr.callno]-&gt;peercapability &amp; iaxs[fr.callno]-&gt;capability, 1);
+										format = ast_codec_choose(&amp;pref, iaxs[fr-&gt;callno]-&gt;peercapability &amp; iaxs[fr-&gt;callno]-&gt;capability, 1);
 									} else /* if no codec_prefs IE do it the old way */
-										format = ast_best_codec(iaxs[fr.callno]-&gt;peercapability &amp; iaxs[fr.callno]-&gt;capability);	
+										format = ast_best_codec(iaxs[fr-&gt;callno]-&gt;peercapability &amp; iaxs[fr-&gt;callno]-&gt;capability);	
 								}
 							}
 							if (!format) {
-								ast_log(LOG_ERROR, &quot;No best format in 0x%x???\n&quot;, iaxs[fr.callno]-&gt;peercapability &amp; iaxs[fr.callno]-&gt;capability);
+								ast_log(LOG_ERROR, &quot;No best format in 0x%x???\n&quot;, iaxs[fr-&gt;callno]-&gt;peercapability &amp; iaxs[fr-&gt;callno]-&gt;capability);
 								if (authdebug) {
-									if(ast_test_flag(iaxs[fr.callno], IAX_CODEC_NOCAP))
-										ast_log(LOG_NOTICE, &quot;Rejected connect attempt from %s, requested 0x%x incompatible with our capability 0x%x.\n&quot;, ast_inet_ntoa(iabuf, sizeof(iabuf), sin.sin_addr), iaxs[fr.callno]-&gt;peerformat, iaxs[fr.callno]-&gt;capability);
+									if(ast_test_flag(iaxs[fr-&gt;callno], IAX_CODEC_NOCAP))
+										ast_log(LOG_NOTICE, &quot;Rejected connect attempt from %s, requested 0x%x incompatible with our capability 0x%x.\n&quot;, ast_inet_ntoa(iabuf, sizeof(iabuf), sin.sin_addr), iaxs[fr-&gt;callno]-&gt;peerformat, iaxs[fr-&gt;callno]-&gt;capability);
 									else
-										ast_log(LOG_NOTICE, &quot;Rejected connect attempt from %s, requested/capability 0x%x/0x%x incompatible with our capability 0x%x.\n&quot;, ast_inet_ntoa(iabuf, sizeof(iabuf), sin.sin_addr), iaxs[fr.callno]-&gt;peerformat, iaxs[fr.callno]-&gt;peercapability, iaxs[fr.callno]-&gt;capability);
+										ast_log(LOG_NOTICE, &quot;Rejected connect attempt from %s, requested/capability 0x%x/0x%x incompatible with our capability 0x%x.\n&quot;, ast_inet_ntoa(iabuf, sizeof(iabuf), sin.sin_addr), iaxs[fr-&gt;callno]-&gt;peerformat, iaxs[fr-&gt;callno]-&gt;peercapability, iaxs[fr-&gt;callno]-&gt;capability);
 								}
 								memset(&amp;ied0, 0, sizeof(ied0));
 								iax_ie_append_str(&amp;ied0, IAX_IE_CAUSE, &quot;Unable to negotiate codec&quot;);
 								iax_ie_append_byte(&amp;ied0, IAX_IE_CAUSECODE, AST_CAUSE_BEARERCAPABILITY_NOTAVAIL);
-								send_command_final(iaxs[fr.callno], AST_FRAME_IAX, IAX_COMMAND_REJECT, 0, ied0.buf, ied0.pos, -1);
+								send_command_final(iaxs[fr-&gt;callno], AST_FRAME_IAX, IAX_COMMAND_REJECT, 0, ied0.buf, ied0.pos, -1);
 							}
 						}
 					}
@@ -7306,9 +7307,9 @@
 						/* Authentication received */
 						memset(&amp;ied1, 0, sizeof(ied1));
 						iax_ie_append_int(&amp;ied1, IAX_IE_FORMAT, format);
-						send_command(iaxs[fr.callno], AST_FRAME_IAX, IAX_COMMAND_ACCEPT, 0, ied1.buf, ied1.pos, -1);
-						if (strcmp(iaxs[fr.callno]-&gt;exten, &quot;TBD&quot;)) {
-							ast_set_flag(&amp;iaxs[fr.callno]-&gt;state, IAX_STATE_STARTED);
+						send_command(iaxs[fr-&gt;callno], AST_FRAME_IAX, IAX_COMMAND_ACCEPT, 0, ied1.buf, ied1.pos, -1);
+						if (strcmp(iaxs[fr-&gt;callno]-&gt;exten, &quot;TBD&quot;)) {
+							ast_set_flag(&amp;iaxs[fr-&gt;callno]-&gt;state, IAX_STATE_STARTED);
 							if (option_verbose &gt; 2) 
 								ast_verbose(VERBOSE_PREFIX_3 &quot;Accepting AUTHENTICATED call from %s:\n&quot;
 											&quot;%srequested format = %s,\n&quot;
@@ -7318,7 +7319,7 @@
 											&quot;%spriority = %s\n&quot;, 
 											ast_inet_ntoa(iabuf, sizeof(iabuf), sin.sin_addr), 
 											VERBOSE_PREFIX_4,
-											ast_getformatname(iaxs[fr.callno]-&gt;peerformat),
+											ast_getformatname(iaxs[fr-&gt;callno]-&gt;peerformat),
 											VERBOSE_PREFIX_4,
 											caller_pref_buf,
 											VERBOSE_PREFIX_4,
@@ -7328,11 +7329,11 @@
 											VERBOSE_PREFIX_4,
 											using_prefs);
 
-							ast_set_flag(&amp;iaxs[fr.callno]-&gt;state, IAX_STATE_STARTED);
-							if(!(c = ast_iax2_new(fr.callno, AST_STATE_RING, format)))
-								iax2_destroy_nolock(fr.callno);
+							ast_set_flag(&amp;iaxs[fr-&gt;callno]-&gt;state, IAX_STATE_STARTED);
+							if(!(c = ast_iax2_new(fr-&gt;callno, AST_STATE_RING, format)))
+								iax2_destroy_nolock(fr-&gt;callno);
 						} else {
-							ast_set_flag(&amp;iaxs[fr.callno]-&gt;state, IAX_STATE_TBD);
+							ast_set_flag(&amp;iaxs[fr-&gt;callno]-&gt;state, IAX_STATE_TBD);
 							/* If this is a TBD call, we're ready but now what...  */
 							if (option_verbose &gt; 2)
 								ast_verbose(VERBOSE_PREFIX_3 &quot;Accepted AUTHENTICATED TBD call from %s\n&quot;, ast_inet_ntoa(iabuf, sizeof(iabuf), sin.sin_addr));
@@ -7341,148 +7342,148 @@
 				}
 				break;
 			case IAX_COMMAND_DIAL:
-				if (ast_test_flag(&amp;iaxs[fr.callno]-&gt;state, IAX_STATE_TBD)) {
-					ast_clear_flag(&amp;iaxs[fr.callno]-&gt;state, IAX_STATE_TBD);
-					ast_copy_string(iaxs[fr.callno]-&gt;exten, ies.called_number ? ies.called_number : &quot;s&quot;, sizeof(iaxs[fr.callno]-&gt;exten));	
-					if (!ast_exists_extension(NULL, iaxs[fr.callno]-&gt;context, iaxs[fr.callno]-&gt;exten, 1, iaxs[fr.callno]-&gt;cid_num)) {
+				if (ast_test_flag(&amp;iaxs[fr-&gt;callno]-&gt;state, IAX_STATE_TBD)) {
+					ast_clear_flag(&amp;iaxs[fr-&gt;callno]-&gt;state, IAX_STATE_TBD);
+					ast_copy_string(iaxs[fr-&gt;callno]-&gt;exten, ies.called_number ? ies.called_number : &quot;s&quot;, sizeof(iaxs[fr-&gt;callno]-&gt;exten));	
+					if (!ast_exists_extension(NULL, iaxs[fr-&gt;callno]-&gt;context, iaxs[fr-&gt;callno]-&gt;exten, 1, iaxs[fr-&gt;callno]-&gt;cid_num)) {
 						if (authdebug)
-							ast_log(LOG_NOTICE, &quot;Rejected dial attempt from %s, request '%s@%s' does not exist\n&quot;, ast_inet_ntoa(iabuf, sizeof(iabuf), sin.sin_addr), iaxs[fr.callno]-&gt;exten, iaxs[fr.callno]-&gt;context);
+							ast_log(LOG_NOTICE, &quot;Rejected dial attempt from %s, request '%s@%s' does not exist\n&quot;, ast_inet_ntoa(iabuf, sizeof(iabuf), sin.sin_addr), iaxs[fr-&gt;callno]-&gt;exten, iaxs[fr-&gt;callno]-&gt;context);
 						memset(&amp;ied0, 0, sizeof(ied0));
 						iax_ie_append_str(&amp;ied0, IAX_IE_CAUSE, &quot;No such context/extension&quot;);
 						iax_ie_append_byte(&amp;ied0, IAX_IE_CAUSECODE, AST_CAUSE_NO_ROUTE_DESTINATION);
-						send_command_final(iaxs[fr.callno], AST_FRAME_IAX, IAX_COMMAND_REJECT, 0, ied0.buf, ied0.pos, -1);
+						send_command_final(iaxs[fr-&gt;callno], AST_FRAME_IAX, IAX_COMMAND_REJECT, 0, ied0.buf, ied0.pos, -1);
 					} else {
-						ast_set_flag(&amp;iaxs[fr.callno]-&gt;state, IAX_STATE_STARTED);
+						ast_set_flag(&amp;iaxs[fr-&gt;callno]-&gt;state, IAX_STATE_STARTED);
 						if (option_verbose &gt; 2) 
-							ast_verbose(VERBOSE_PREFIX_3 &quot;Accepting DIAL from %s, formats = 0x%x\n&quot;, ast_inet_ntoa(iabuf, sizeof(iabuf), sin.sin_addr), iaxs[fr.callno]-&gt;peerformat);
-						ast_set_flag(&amp;iaxs[fr.callno]-&gt;state, IAX_STATE_STARTED);
-						send_command(iaxs[fr.callno], AST_FRAME_CONTROL, AST_CONTROL_PROGRESS, 0, NULL, 0, -1);
-						if(!(c = ast_iax2_new(fr.callno, AST_STATE_RING, iaxs[fr.callno]-&gt;peerformat)))
-							iax2_destroy_nolock(fr.callno);
+							ast_verbose(VERBOSE_PREFIX_3 &quot;Accepting DIAL from %s, formats = 0x%x\n&quot;, ast_inet_ntoa(iabuf, sizeof(iabuf), sin.sin_addr), iaxs[fr-&gt;callno]-&gt;peerformat);
+						ast_set_flag(&amp;iaxs[fr-&gt;callno]-&gt;state, IAX_STATE_STARTED);
+						send_command(iaxs[fr-&gt;callno], AST_FRAME_CONTROL, AST_CONTROL_PROGRESS, 0, NULL, 0, -1);
+						if(!(c = ast_iax2_new(fr-&gt;callno, AST_STATE_RING, iaxs[fr-&gt;callno]-&gt;peerformat)))
+							iax2_destroy_nolock(fr-&gt;callno);
 					}
 				}
 				break;
 			case IAX_COMMAND_INVAL:
-				iaxs[fr.callno]-&gt;error = ENOTCONN;
-				ast_log(LOG_DEBUG, &quot;Immediately destroying %d, having received INVAL\n&quot;, fr.callno);
-				iax2_destroy_nolock(fr.callno);
+				iaxs[fr-&gt;callno]-&gt;error = ENOTCONN;
+				ast_log(LOG_DEBUG, &quot;Immediately destroying %d, having received INVAL\n&quot;, fr-&gt;callno);
+				iax2_destroy_nolock(fr-&gt;callno);
 				if (option_debug)
-					ast_log(LOG_DEBUG, &quot;Destroying call %d\n&quot;, fr.callno);
+					ast_log(LOG_DEBUG, &quot;Destroying call %d\n&quot;, fr-&gt;callno);
 				break;
 			case IAX_COMMAND_VNAK:
 				ast_log(LOG_DEBUG, &quot;Received VNAK: resending outstanding frames\n&quot;);
 				/* Force retransmission */
-				vnak_retransmit(fr.callno, fr.iseqno);
+				vnak_retransmit(fr-&gt;callno, fr-&gt;iseqno);
 				break;
 			case IAX_COMMAND_REGREQ:
 			case IAX_COMMAND_REGREL:
 				/* For security, always ack immediately */
 				if (delayreject)
-					send_command_immediate(iaxs[fr.callno], AST_FRAME_IAX, IAX_COMMAND_ACK, fr.ts, NULL, 0,fr.iseqno);
-				if (register_verify(fr.callno, &amp;sin, &amp;ies)) {
+					send_command_immediate(iaxs[fr-&gt;callno], AST_FRAME_IAX, IAX_COMMAND_ACK, fr-&gt;ts, NULL, 0,fr-&gt;iseqno);
+				if (register_verify(fr-&gt;callno, &amp;sin, &amp;ies)) {
 					/* Send delayed failure */
-					auth_fail(fr.callno, IAX_COMMAND_REGREJ);
+					auth_fail(fr-&gt;callno, IAX_COMMAND_REGREJ);
 					break;
 				}
-				if ((ast_strlen_zero(iaxs[fr.callno]-&gt;secret) &amp;&amp; ast_strlen_zero(iaxs[fr.callno]-&gt;inkeys)) || 
-						ast_test_flag(&amp;iaxs[fr.callno]-&gt;state, IAX_STATE_AUTHENTICATED | IAX_STATE_UNCHANGED)) {
+				if ((ast_strlen_zero(iaxs[fr-&gt;callno]-&gt;secret) &amp;&amp; ast_strlen_zero(iaxs[fr-&gt;callno]-&gt;inkeys)) || 
+						ast_test_flag(&amp;iaxs[fr-&gt;callno]-&gt;state, IAX_STATE_AUTHENTICATED | IAX_STATE_UNCHANGED)) {
 					if (f.subclass == IAX_COMMAND_REGREL)
 						memset(&amp;sin, 0, sizeof(sin));
-					if (update_registry(iaxs[fr.callno]-&gt;peer, &amp;sin, fr.callno, ies.devicetype, fd, ies.refresh))
+					if (update_registry(iaxs[fr-&gt;callno]-&gt;peer, &amp;sin, fr-&gt;callno, ies.devicetype, fd, ies.refresh))
 						ast_log(LOG_WARNING, &quot;Registry error\n&quot;);
 					if (ies.provverpres &amp;&amp; ies.serviceident &amp;&amp; sin.sin_addr.s_addr)
 						check_provisioning(&amp;sin, fd, ies.serviceident, ies.provver);
 					break;
 				}
-				registry_authrequest(iaxs[fr.callno]-&gt;peer, fr.callno);
+				registry_authrequest(iaxs[fr-&gt;callno]-&gt;peer, fr-&gt;callno);
 				break;
 			case IAX_COMMAND_REGACK:
-				if (iax2_ack_registry(&amp;ies, &amp;sin, fr.callno)) 
+				if (iax2_ack_registry(&amp;ies, &amp;sin, fr-&gt;callno)) 
 					ast_log(LOG_WARNING, &quot;Registration failure\n&quot;);
 				/* Send ack immediately, before we destroy */
-				send_command_immediate(iaxs[fr.callno], AST_FRAME_IAX, IAX_COMMAND_ACK, fr.ts, NULL, 0,fr.iseqno);
-				iax2_destroy_nolock(fr.callno);
+				send_command_immediate(iaxs[fr-&gt;callno], AST_FRAME_IAX, IAX_COMMAND_ACK, fr-&gt;ts, NULL, 0,fr-&gt;iseqno);
+				iax2_destroy_nolock(fr-&gt;callno);
 				break;
 			case IAX_COMMAND_REGREJ:
-				if (iaxs[fr.callno]-&gt;reg) {
+				if (iaxs[fr-&gt;callno]-&gt;reg) {
 					if (authdebug) {
-						ast_log(LOG_NOTICE, &quot;Registration of '%s' rejected: '%s' from: '%s'\n&quot;, iaxs[fr.callno]-&gt;reg-&gt;username, ies.cause ? ies.cause : &quot;&lt;unknown&gt;&quot;, ast_inet_ntoa(iabuf, sizeof(iabuf), sin.sin_addr));
-						manager_event(EVENT_FLAG_SYSTEM, &quot;Registry&quot;, &quot;Channel: IAX2\r\nUsername: %s\r\nStatus: Rejected\r\nCause: %s\r\n&quot;, iaxs[fr.callno]-&gt;reg-&gt;username, ies.cause ? ies.cause : &quot;&lt;unknown&gt;&quot;);
+						ast_log(LOG_NOTICE, &quot;Registration of '%s' rejected: '%s' from: '%s'\n&quot;, iaxs[fr-&gt;callno]-&gt;reg-&gt;username, ies.cause ? ies.cause : &quot;&lt;unknown&gt;&quot;, ast_inet_ntoa(iabuf, sizeof(iabuf), sin.sin_addr));
+						manager_event(EVENT_FLAG_SYSTEM, &quot;Registry&quot;, &quot;Channel: IAX2\r\nUsername: %s\r\nStatus: Rejected\r\nCause: %s\r\n&quot;, iaxs[fr-&gt;callno]-&gt;reg-&gt;username, ies.cause ? ies.cause : &quot;&lt;unknown&gt;&quot;);
 					}
-					iaxs[fr.callno]-&gt;reg-&gt;regstate = REG_STATE_REJECTED;
+					iaxs[fr-&gt;callno]-&gt;reg-&gt;regstate = REG_STATE_REJECTED;
 				}
 				/* Send ack immediately, before we destroy */
-				send_command_immediate(iaxs[fr.callno], AST_FRAME_IAX, IAX_COMMAND_ACK, fr.ts, NULL, 0,fr.iseqno);
-				iax2_destroy_nolock(fr.callno);
+				send_command_immediate(iaxs[fr-&gt;callno], AST_FRAME_IAX, IAX_COMMAND_ACK, fr-&gt;ts, NULL, 0,fr-&gt;iseqno);
+				iax2_destroy_nolock(fr-&gt;callno);
 				break;
 			case IAX_COMMAND_REGAUTH:
 				/* Authentication request */
-				if (registry_rerequest(&amp;ies, fr.callno, &amp;sin)) {
+				if (registry_rerequest(&amp;ies, fr-&gt;callno, &amp;sin)) {
 					memset(&amp;ied0, 0, sizeof(ied0));
 					iax_ie_append_str(&amp;ied0, IAX_IE_CAUSE, &quot;No authority found&quot;);
 					iax_ie_append_byte(&amp;ied0, IAX_IE_CAUSECODE, AST_CAUSE_FACILITY_NOT_SUBSCRIBED);
-					send_command_final(iaxs[fr.callno], AST_FRAME_IAX, IAX_COMMAND_REJECT, 0, ied0.buf, ied0.pos, -1);
+					send_command_final(iaxs[fr-&gt;callno], AST_FRAME_IAX, IAX_COMMAND_REJECT, 0, ied0.buf, ied0.pos, -1);
 				}
 				break;
 			case IAX_COMMAND_TXREJ:
-				iaxs[fr.callno]-&gt;transferring = 0;
+				iaxs[fr-&gt;callno]-&gt;transferring = 0;
 				if (option_verbose &gt; 2) 
-					ast_verbose(VERBOSE_PREFIX_3 &quot;Channel '%s' unable to transfer\n&quot;, iaxs[fr.callno]-&gt;owner ? iaxs[fr.callno]-&gt;owner-&gt;name : &quot;&lt;Unknown&gt;&quot;);
-				memset(&amp;iaxs[fr.callno]-&gt;transfer, 0, sizeof(iaxs[fr.callno]-&gt;transfer));
-				if (iaxs[fr.callno]-&gt;bridgecallno) {
-					if (iaxs[iaxs[fr.callno]-&gt;bridgecallno]-&gt;transferring) {
-						iaxs[iaxs[fr.callno]-&gt;bridgecallno]-&gt;transferring = 0;
-						send_command(iaxs[iaxs[fr.callno]-&gt;bridgecallno], AST_FRAME_IAX, IAX_COMMAND_TXREJ, 0, NULL, 0, -1);
+					ast_verbose(VERBOSE_PREFIX_3 &quot;Channel '%s' unable to transfer\n&quot;, iaxs[fr-&gt;callno]-&gt;owner ? iaxs[fr-&gt;callno]-&gt;owner-&gt;name : &quot;&lt;Unknown&gt;&quot;);
+				memset(&amp;iaxs[fr-&gt;callno]-&gt;transfer, 0, sizeof(iaxs[fr-&gt;callno]-&gt;transfer));
+				if (iaxs[fr-&gt;callno]-&gt;bridgecallno) {
+					if (iaxs[iaxs[fr-&gt;callno]-&gt;bridgecallno]-&gt;transferring) {
+						iaxs[iaxs[fr-&gt;callno]-&gt;bridgecallno]-&gt;transferring = 0;
+						send_command(iaxs[iaxs[fr-&gt;callno]-&gt;bridgecallno], AST_FRAME_IAX, IAX_COMMAND_TXREJ, 0, NULL, 0, -1);
 					}
 				}
 				break;
 			case IAX_COMMAND_TXREADY:
-				if ((iaxs[fr.callno]-&gt;transferring == TRANSFER_BEGIN) ||
-				    (iaxs[fr.callno]-&gt;transferring == TRANSFER_MBEGIN)) {
-					if (iaxs[fr.callno]-&gt;transferring == TRANSFER_MBEGIN)
-						iaxs[fr.callno]-&gt;transferring = TRANSFER_MREADY;
+				if ((iaxs[fr-&gt;callno]-&gt;transferring == TRANSFER_BEGIN) ||
+				    (iaxs[fr-&gt;callno]-&gt;transferring == TRANSFER_MBEGIN)) {
+					if (iaxs[fr-&gt;callno]-&gt;transferring == TRANSFER_MBEGIN)
+						iaxs[fr-&gt;callno]-&gt;transferring = TRANSFER_MREADY;
 					else
-						iaxs[fr.callno]-&gt;transferring = TRANSFER_READY;
+						iaxs[fr-&gt;callno]-&gt;transferring = TRANSFER_READY;
 					if (option_verbose &gt; 2) 
-						ast_verbose(VERBOSE_PREFIX_3 &quot;Channel '%s' ready to transfer\n&quot;, iaxs[fr.callno]-&gt;owner ? iaxs[fr.callno]-&gt;owner-&gt;name : &quot;&lt;Unknown&gt;&quot;);
-					if (iaxs[fr.callno]-&gt;bridgecallno) {
-						if ((iaxs[iaxs[fr.callno]-&gt;bridgecallno]-&gt;transferring == TRANSFER_READY) ||
-						    (iaxs[iaxs[fr.callno]-&gt;bridgecallno]-&gt;transferring == TRANSFER_MREADY)) {
+						ast_verbose(VERBOSE_PREFIX_3 &quot;Channel '%s' ready to transfer\n&quot;, iaxs[fr-&gt;callno]-&gt;owner ? iaxs[fr-&gt;callno]-&gt;owner-&gt;name : &quot;&lt;Unknown&gt;&quot;);
+					if (iaxs[fr-&gt;callno]-&gt;bridgecallno) {
+						if ((iaxs[iaxs[fr-&gt;callno]-&gt;bridgecallno]-&gt;transferring == TRANSFER_READY) ||
+						    (iaxs[iaxs[fr-&gt;callno]-&gt;bridgecallno]-&gt;transferring == TRANSFER_MREADY)) {
 							/* They're both ready, now release them. */
-							if (iaxs[fr.callno]-&gt;transferring == TRANSFER_MREADY) {
+							if (iaxs[fr-&gt;callno]-&gt;transferring == TRANSFER_MREADY) {
 								if (option_verbose &gt; 2) 
-									ast_verbose(VERBOSE_PREFIX_3 &quot;Attempting media bridge of %s and %s\n&quot;, iaxs[fr.callno]-&gt;owner ? iaxs[fr.callno]-&gt;owner-&gt;name : &quot;&lt;Unknown&gt;&quot;,
-										iaxs[iaxs[fr.callno]-&gt;bridgecallno]-&gt;owner ? iaxs[iaxs[fr.callno]-&gt;bridgecallno]-&gt;owner-&gt;name : &quot;&lt;Unknown&gt;&quot;);
+									ast_verbose(VERBOSE_PREFIX_3 &quot;Attempting media bridge of %s and %s\n&quot;, iaxs[fr-&gt;callno]-&gt;owner ? iaxs[fr-&gt;callno]-&gt;owner-&gt;name : &quot;&lt;Unknown&gt;&quot;,
+										iaxs[iaxs[fr-&gt;callno]-&gt;bridgecallno]-&gt;owner ? iaxs[iaxs[fr-&gt;callno]-&gt;bridgecallno]-&gt;owner-&gt;name : &quot;&lt;Unknown&gt;&quot;);
 
-								iaxs[iaxs[fr.callno]-&gt;bridgecallno]-&gt;transferring = TRANSFER_MEDIA;
-								iaxs[fr.callno]-&gt;transferring = TRANSFER_MEDIA;
+								iaxs[iaxs[fr-&gt;callno]-&gt;bridgecallno]-&gt;transferring = TRANSFER_MEDIA;
+								iaxs[fr-&gt;callno]-&gt;transferring = TRANSFER_MEDIA;
 
 								memset(&amp;ied0, 0, sizeof(ied0));
 								memset(&amp;ied1, 0, sizeof(ied1));
-								iax_ie_append_short(&amp;ied0, IAX_IE_CALLNO, iaxs[iaxs[fr.callno]-&gt;bridgecallno]-&gt;peercallno);
-								iax_ie_append_short(&amp;ied1, IAX_IE_CALLNO, iaxs[fr.callno]-&gt;peercallno);
-								send_command(iaxs[fr.callno], AST_FRAME_IAX, IAX_COMMAND_TXMEDIA, 0, ied0.buf, ied0.pos, -1);
-								send_command(iaxs[iaxs[fr.callno]-&gt;bridgecallno], AST_FRAME_IAX, IAX_COMMAND_TXMEDIA, 0, ied1.buf, ied1.pos, -1);
+								iax_ie_append_short(&amp;ied0, IAX_IE_CALLNO, iaxs[iaxs[fr-&gt;callno]-&gt;bridgecallno]-&gt;peercallno);
+								iax_ie_append_short(&amp;ied1, IAX_IE_CALLNO, iaxs[fr-&gt;callno]-&gt;peercallno);
+								send_command(iaxs[fr-&gt;callno], AST_FRAME_IAX, IAX_COMMAND_TXMEDIA, 0, ied0.buf, ied0.pos, -1);
+								send_command(iaxs[iaxs[fr-&gt;callno]-&gt;bridgecallno], AST_FRAME_IAX, IAX_COMMAND_TXMEDIA, 0, ied1.buf, ied1.pos, -1);
 							} else {
 								if (option_verbose &gt; 2) 
-									ast_verbose(VERBOSE_PREFIX_3 &quot;Releasing %s and %s\n&quot;, iaxs[fr.callno]-&gt;owner ? iaxs[fr.callno]-&gt;owner-&gt;name : &quot;&lt;Unknown&gt;&quot;,
-										iaxs[iaxs[fr.callno]-&gt;bridgecallno]-&gt;owner ? iaxs[iaxs[fr.callno]-&gt;bridgecallno]-&gt;owner-&gt;name : &quot;&lt;Unknown&gt;&quot;);
+									ast_verbose(VERBOSE_PREFIX_3 &quot;Releasing %s and %s\n&quot;, iaxs[fr-&gt;callno]-&gt;owner ? iaxs[fr-&gt;callno]-&gt;owner-&gt;name : &quot;&lt;Unknown&gt;&quot;,
+										iaxs[iaxs[fr-&gt;callno]-&gt;bridgecallno]-&gt;owner ? iaxs[iaxs[fr-&gt;callno]-&gt;bridgecallno]-&gt;owner-&gt;name : &quot;&lt;Unknown&gt;&quot;);
 
-								iaxs[iaxs[fr.callno]-&gt;bridgecallno]-&gt;transferring = TRANSFER_RELEASED;
-								iaxs[fr.callno]-&gt;transferring = TRANSFER_RELEASED;
-								ast_set_flag(iaxs[iaxs[fr.callno]-&gt;bridgecallno], IAX_ALREADYGONE);
-								ast_set_flag(iaxs[fr.callno], IAX_ALREADYGONE);
+								iaxs[iaxs[fr-&gt;callno]-&gt;bridgecallno]-&gt;transferring = TRANSFER_RELEASED;
+								iaxs[fr-&gt;callno]-&gt;transferring = TRANSFER_RELEASED;
+								ast_set_flag(iaxs[iaxs[fr-&gt;callno]-&gt;bridgecallno], IAX_ALREADYGONE);
+								ast_set_flag(iaxs[fr-&gt;callno], IAX_ALREADYGONE);
 
 								/* Stop doing lag &amp; ping requests */
-								stop_stuff(fr.callno);
-								stop_stuff(iaxs[fr.callno]-&gt;bridgecallno);
+								stop_stuff(fr-&gt;callno);
+								stop_stuff(iaxs[fr-&gt;callno]-&gt;bridgecallno);
 
 								memset(&amp;ied0, 0, sizeof(ied0));
 								memset(&amp;ied1, 0, sizeof(ied1));
-								iax_ie_append_short(&amp;ied0, IAX_IE_CALLNO, iaxs[iaxs[fr.callno]-&gt;bridgecallno]-&gt;peercallno);
-								iax_ie_append_short(&amp;ied1, IAX_IE_CALLNO, iaxs[fr.callno]-&gt;peercallno);
-								send_command(iaxs[fr.callno], AST_FRAME_IAX, IAX_COMMAND_TXREL, 0, ied0.buf, ied0.pos, -1);
-								send_command(iaxs[iaxs[fr.callno]-&gt;bridgecallno], AST_FRAME_IAX, IAX_COMMAND_TXREL, 0, ied1.buf, ied1.pos, -1);
+								iax_ie_append_short(&amp;ied0, IAX_IE_CALLNO, iaxs[iaxs[fr-&gt;callno]-&gt;bridgecallno]-&gt;peercallno);
+								iax_ie_append_short(&amp;ied1, IAX_IE_CALLNO, iaxs[fr-&gt;callno]-&gt;peercallno);
+								send_command(iaxs[fr-&gt;callno], AST_FRAME_IAX, IAX_COMMAND_TXREL, 0, ied0.buf, ied0.pos, -1);
+								send_command(iaxs[iaxs[fr-&gt;callno]-&gt;bridgecallno], AST_FRAME_IAX, IAX_COMMAND_TXREL, 0, ied1.buf, ied1.pos, -1);
 							}
 
 						}
@@ -7490,26 +7491,26 @@
 				}
 				break;
 			case IAX_COMMAND_TXREQ:
-				try_transfer(iaxs[fr.callno], &amp;ies);
+				try_transfer(iaxs[fr-&gt;callno], &amp;ies);
 				break;
 			case IAX_COMMAND_TXCNT:
-				if (iaxs[fr.callno]-&gt;transferring)
-					send_command_transfer(iaxs[fr.callno], AST_FRAME_IAX, IAX_COMMAND_TXACC, 0, NULL, 0);
+				if (iaxs[fr-&gt;callno]-&gt;transferring)
+					send_command_transfer(iaxs[fr-&gt;callno], AST_FRAME_IAX, IAX_COMMAND_TXACC, 0, NULL, 0);
 				break;
 			case IAX_COMMAND_TXREL:
 				/* Send ack immediately, rather than waiting until we've changed addresses */
-				send_command_immediate(iaxs[fr.callno], AST_FRAME_IAX, IAX_COMMAND_ACK, fr.ts, NULL, 0,fr.iseqno);
-				complete_transfer(fr.callno, &amp;ies);
-				stop_stuff(fr.callno);	/* for attended transfer to work with libiax */
+				send_command_immediate(iaxs[fr-&gt;callno], AST_FRAME_IAX, IAX_COMMAND_ACK, fr-&gt;ts, NULL, 0,fr-&gt;iseqno);
+				complete_transfer(fr-&gt;callno, &amp;ies);
+				stop_stuff(fr-&gt;callno);	/* for attended transfer to work with libiax */
 				break;	
 			case IAX_COMMAND_TXMEDIA:
-				if (iaxs[fr.callno]-&gt;transferring == TRANSFER_READY) {
+				if (iaxs[fr-&gt;callno]-&gt;transferring == TRANSFER_READY) {
 					/* Start sending our media to the transfer address, but otherwise leave the call as-is */
-					iaxs[fr.callno]-&gt;transferring = TRANSFER_MEDIAPASS;
+					iaxs[fr-&gt;callno]-&gt;transferring = TRANSFER_MEDIAPASS;
 				}
 				break;	
 			case IAX_COMMAND_DPREP:
-				complete_dpreply(iaxs[fr.callno], &amp;ies);
+				complete_dpreply(iaxs[fr-&gt;callno], &amp;ies);
 				break;
 			case IAX_COMMAND_UNSUPPORT:
 				ast_log(LOG_NOTICE, &quot;Peer did not understand our iax command '%d'\n&quot;, ies.iax_unknown);
@@ -7519,17 +7520,17 @@
 				memset(&amp;ied0, 0, sizeof(ied0));
 				res = iax_firmware_append(&amp;ied0, (unsigned char *)ies.devicetype, ies.fwdesc);
 				if (res &lt; 0)
-					send_command_final(iaxs[fr.callno], AST_FRAME_IAX, IAX_COMMAND_REJECT, 0, ied0.buf, ied0.pos, -1);
+					send_command_final(iaxs[fr-&gt;callno], AST_FRAME_IAX, IAX_COMMAND_REJECT, 0, ied0.buf, ied0.pos, -1);
 				else if (res &gt; 0)
-					send_command_final(iaxs[fr.callno], AST_FRAME_IAX, IAX_COMMAND_FWDATA, 0, ied0.buf, ied0.pos, -1);
+					send_command_final(iaxs[fr-&gt;callno], AST_FRAME_IAX, IAX_COMMAND_FWDATA, 0, ied0.buf, ied0.pos, -1);
 				else
-					send_command(iaxs[fr.callno], AST_FRAME_IAX, IAX_COMMAND_FWDATA, 0, ied0.buf, ied0.pos, -1);
+					send_command(iaxs[fr-&gt;callno], AST_FRAME_IAX, IAX_COMMAND_FWDATA, 0, ied0.buf, ied0.pos, -1);
 				break;
 			default:
-				ast_log(LOG_DEBUG, &quot;Unknown IAX command %d on %d/%d\n&quot;, f.subclass, fr.callno, iaxs[fr.callno]-&gt;peercallno);
+				ast_log(LOG_DEBUG, &quot;Unknown IAX command %d on %d/%d\n&quot;, f.subclass, fr-&gt;callno, iaxs[fr-&gt;callno]-&gt;peercallno);
 				memset(&amp;ied0, 0, sizeof(ied0));
 				iax_ie_append_byte(&amp;ied0, IAX_IE_IAX_UNKNOWN, f.subclass);
-				send_command(iaxs[fr.callno], AST_FRAME_IAX, IAX_COMMAND_UNSUPPORT, 0, ied0.buf, ied0.pos, -1);
+				send_command(iaxs[fr-&gt;callno], AST_FRAME_IAX, IAX_COMMAND_UNSUPPORT, 0, ied0.buf, ied0.pos, -1);
 			}
 			/* Don't actually pass these frames along */
 			if ((f.subclass != IAX_COMMAND_ACK) &amp;&amp; 
@@ -7537,23 +7538,23 @@
 			  (f.subclass != IAX_COMMAND_TXACC) &amp;&amp; 
 			  (f.subclass != IAX_COMMAND_INVAL) &amp;&amp;
 			  (f.subclass != IAX_COMMAND_VNAK)) { 
-			  	if (iaxs[fr.callno] &amp;&amp; iaxs[fr.callno]-&gt;aseqno != iaxs[fr.callno]-&gt;iseqno)
-					send_command_immediate(iaxs[fr.callno], AST_FRAME_IAX, IAX_COMMAND_ACK, fr.ts, NULL, 0,fr.iseqno);
+			  	if (iaxs[fr-&gt;callno] &amp;&amp; iaxs[fr-&gt;callno]-&gt;aseqno != iaxs[fr-&gt;callno]-&gt;iseqno)
+					send_command_immediate(iaxs[fr-&gt;callno], AST_FRAME_IAX, IAX_COMMAND_ACK, fr-&gt;ts, NULL, 0,fr-&gt;iseqno);
 			}
-			ast_mutex_unlock(&amp;iaxsl[fr.callno]);
+			ast_mutex_unlock(&amp;iaxsl[fr-&gt;callno]);
 			return 1;
 		}
 		/* Unless this is an ACK or INVAL frame, ack it */
-		if (iaxs[fr.callno]-&gt;aseqno != iaxs[fr.callno]-&gt;iseqno)
-			send_command_immediate(iaxs[fr.callno], AST_FRAME_IAX, IAX_COMMAND_ACK, fr.ts, NULL, 0,fr.iseqno);
+		if (iaxs[fr-&gt;callno]-&gt;aseqno != iaxs[fr-&gt;callno]-&gt;iseqno)
+			send_command_immediate(iaxs[fr-&gt;callno], AST_FRAME_IAX, IAX_COMMAND_ACK, fr-&gt;ts, NULL, 0,fr-&gt;iseqno);
 	} else if (minivid) {
 		f.frametype = AST_FRAME_VIDEO;
-		if (iaxs[fr.callno]-&gt;videoformat &gt; 0) 
-			f.subclass = iaxs[fr.callno]-&gt;videoformat | (ntohs(vh-&gt;ts) &amp; 0x8000 ? 1 : 0);
+		if (iaxs[fr-&gt;callno]-&gt;videoformat &gt; 0) 
+			f.subclass = iaxs[fr-&gt;callno]-&gt;videoformat | (ntohs(vh-&gt;ts) &amp; 0x8000 ? 1 : 0);
 		else {
 			ast_log(LOG_WARNING, &quot;Received mini frame before first full video frame\n &quot;);
-			iax2_vnak(fr.callno);
-			ast_mutex_unlock(&amp;iaxsl[fr.callno]);
+			iax2_vnak(fr-&gt;callno);
+			ast_mutex_unlock(&amp;iaxsl[fr-&gt;callno]);
 			return 1;
 		}
 		f.datalen = res - sizeof(struct ast_iax2_video_hdr);
@@ -7563,25 +7564,25 @@
 			f.data = NULL;
 #ifdef IAXTESTS
 		if (test_resync) {
-			fr.ts = (iaxs[fr.callno]-&gt;last &amp; 0xFFFF8000L) | ((ntohs(mh-&gt;ts) + test_resync) &amp; 0x7fff);
+			fr-&gt;ts = (iaxs[fr-&gt;callno]-&gt;last &amp; 0xFFFF8000L) | ((ntohs(mh-&gt;ts) + test_resync) &amp; 0x7fff);
 		} else
 #endif /* IAXTESTS */
-		fr.ts = (iaxs[fr.callno]-&gt;last &amp; 0xFFFF8000L) | (ntohs(mh-&gt;ts) &amp; 0x7fff);
+		fr-&gt;ts = (iaxs[fr-&gt;callno]-&gt;last &amp; 0xFFFF8000L) | (ntohs(mh-&gt;ts) &amp; 0x7fff);
 	} else {
 		/* A mini frame */
 		f.frametype = AST_FRAME_VOICE;
-		if (iaxs[fr.callno]-&gt;voiceformat &gt; 0)
-			f.subclass = iaxs[fr.callno]-&gt;voiceformat;
+		if (iaxs[fr-&gt;callno]-&gt;voiceformat &gt; 0)
+			f.subclass = iaxs[fr-&gt;callno]-&gt;voiceformat;
 		else {
 			ast_log(LOG_WARNING, &quot;Received mini frame before first full voice frame\n &quot;);
-			iax2_vnak(fr.callno);
-			ast_mutex_unlock(&amp;iaxsl[fr.callno]);
+			iax2_vnak(fr-&gt;callno);
+			ast_mutex_unlock(&amp;iaxsl[fr-&gt;callno]);
 			return 1;
 		}
 		f.datalen = res - sizeof(struct ast_iax2_mini_hdr);
 		if (f.datalen &lt; 0) {
 			ast_log(LOG_WARNING, &quot;Datalen &lt; 0?\n&quot;);
-			ast_mutex_unlock(&amp;iaxsl[fr.callno]);
+			ast_mutex_unlock(&amp;iaxsl[fr-&gt;callno]);
 			return 1;
 		}
 		if (f.datalen)
@@ -7590,15 +7591,15 @@
 			f.data = NULL;
 #ifdef IAXTESTS
 		if (test_resync) {
-			fr.ts = (iaxs[fr.callno]-&gt;last &amp; 0xFFFF0000L) | ((ntohs(mh-&gt;ts) + test_resync) &amp; 0xffff);
+			fr-&gt;ts = (iaxs[fr-&gt;callno]-&gt;last &amp; 0xFFFF0000L) | ((ntohs(mh-&gt;ts) + test_resync) &amp; 0xffff);
 		} else
 #endif /* IAXTESTS */
-		fr.ts = (iaxs[fr.callno]-&gt;last &amp; 0xFFFF0000L) | ntohs(mh-&gt;ts);
+		fr-&gt;ts = (iaxs[fr-&gt;callno]-&gt;last &amp; 0xFFFF0000L) | ntohs(mh-&gt;ts);
 		/* FIXME? Surely right here would be the right place to undo timestamp wraparound? */
 	}
 	/* Don't pass any packets until we're started */
-	if (!ast_test_flag(&amp;iaxs[fr.callno]-&gt;state, IAX_STATE_STARTED)) {
-		ast_mutex_unlock(&amp;iaxsl[fr.callno]);
+	if (!ast_test_flag(&amp;iaxs[fr-&gt;callno]-&gt;state, IAX_STATE_STARTED)) {
+		ast_mutex_unlock(&amp;iaxsl[fr-&gt;callno]);
 		return 1;
 	}
 	/* Common things */
@@ -7612,43 +7613,43 @@
 			ast_frame_byteswap_be(&amp;f);
 	} else
 		f.samples = 0;
-	iax_frame_wrap(&amp;fr, &amp;f);
+	iax_frame_wrap(fr, &amp;f);
 
 	/* If this is our most recent packet, use it as our basis for timestamping */
-	if (iaxs[fr.callno]-&gt;last &lt; fr.ts) {
-		/*iaxs[fr.callno]-&gt;last = fr.ts; (do it afterwards cos schedule/forward_delivery needs the last ts too)*/
-		fr.outoforder = 0;
+	if (iaxs[fr-&gt;callno]-&gt;last &lt; fr-&gt;ts) {
+		/*iaxs[fr-&gt;callno]-&gt;last = fr-&gt;ts; (do it afterwards cos schedule/forward_delivery needs the last ts too)*/
+		fr-&gt;outoforder = 0;
 	} else {
 		if (option_debug &amp;&amp; iaxdebug)
-			ast_log(LOG_DEBUG, &quot;Received out of order packet... (type=%d, subclass %d, ts = %d, last = %d)\n&quot;, f.frametype, f.subclass, fr.ts, iaxs[fr.callno]-&gt;last);
-		fr.outoforder = -1;
+			ast_log(LOG_DEBUG, &quot;Received out of order packet... (type=%d, subclass %d, ts = %d, last = %d)\n&quot;, f.frametype, f.subclass, fr-&gt;ts, iaxs[fr-&gt;callno]-&gt;last);
+		fr-&gt;outoforder = -1;
 	}
 #ifdef BRIDGE_OPTIMIZATION
-	if (iaxs[fr.callno]-&gt;bridgecallno) {
+	if (iaxs[fr-&gt;callno]-&gt;bridgecallno) {
 		forward_delivery(&amp;fr);
 	} else {
 		duped_fr = iaxfrdup2(&amp;fr);
 		if (duped_fr) {
-			schedule_delivery(duped_fr, updatehistory, 0, &amp;fr.ts);
+			schedule_delivery(duped_fr, updatehistory, 0, &amp;fr-&gt;ts);
 		}
 	}
 #else
-	duped_fr = iaxfrdup2(&amp;fr);
+	duped_fr = iaxfrdup2(fr);
 	if (duped_fr) {
-		schedule_delivery(duped_fr, updatehistory, 0, &amp;fr.ts);
+		schedule_delivery(duped_fr, updatehistory, 0, &amp;fr-&gt;ts);
 	}
 #endif
 
-	if (iaxs[fr.callno]-&gt;last &lt; fr.ts) {
-		iaxs[fr.callno]-&gt;last = fr.ts;
+	if (iaxs[fr-&gt;callno]-&gt;last &lt; fr-&gt;ts) {
+		iaxs[fr-&gt;callno]-&gt;last = fr-&gt;ts;
 #if 1
 		if (option_debug &amp;&amp; iaxdebug)
-			ast_log(LOG_DEBUG, &quot;For call=%d, set last=%d\n&quot;, fr.callno, fr.ts);
+			ast_log(LOG_DEBUG, &quot;For call=%d, set last=%d\n&quot;, fr-&gt;callno, fr-&gt;ts);
 #endif
 	}
 
 	/* Always run again */
-	ast_mutex_unlock(&amp;iaxsl[fr.callno]);
+	ast_mutex_unlock(&amp;iaxsl[fr-&gt;callno]);
 	return 1;
 }
 
@@ -7731,7 +7732,6 @@
 	ast_mutex_destroy(&amp;thread-&gt;lock);
 	ast_cond_destroy(&amp;thread-&gt;cond);
 	free(thread);
-	thread = NULL;
 
 	return NULL;
 }
@@ -8239,6 +8239,7 @@
 		int res;
 
 		sin.sin_port = 0;
+		sin.sin_family = AF_INET;
 		res = check_srcaddr((struct sockaddr *) &amp;sin, sizeof(sin));
 		if (res == 0) {
 			/* ip address valid. */
@@ -8640,7 +8641,6 @@
 	AST_LIST_TRAVERSE(&amp;peers, peer, entry)
 		ast_set_flag(peer, IAX_DELME);
 	AST_LIST_UNLOCK(&amp;peers);
-
 }
 
 static void destroy_user(struct iax2_user *user)
@@ -9679,6 +9679,7 @@
 
 static int __unload_module(void)
 {
+	pthread_t threadid = AST_PTHREADT_NULL;
 	struct iax2_thread *thread = NULL;
 	int x;
 
@@ -9698,24 +9699,36 @@
 
 	/* Call for all threads to halt */
 	AST_LIST_LOCK(&amp;idle_list);
-	AST_LIST_TRAVERSE(&amp;idle_list, thread, list) {
+	AST_LIST_TRAVERSE_SAFE_BEGIN(&amp;idle_list, thread, list) {
+		AST_LIST_REMOVE_CURRENT(&amp;idle_list, list);
+		threadid = thread-&gt;threadid;
 		thread-&gt;halt = 1;
 		signal_condition(&amp;thread-&gt;lock, &amp;thread-&gt;cond);
+		pthread_join(threadid, NULL);
 	}
+	AST_LIST_TRAVERSE_SAFE_END
 	AST_LIST_UNLOCK(&amp;idle_list);
 
 	AST_LIST_LOCK(&amp;active_list);
-	AST_LIST_TRAVERSE(&amp;active_list, thread, list) {
+	AST_LIST_TRAVERSE_SAFE_BEGIN(&amp;active_list, thread, list) {
+		AST_LIST_REMOVE_CURRENT(&amp;active_list, list);
+		threadid = thread-&gt;threadid;
 		thread-&gt;halt = 1;
 		signal_condition(&amp;thread-&gt;lock, &amp;thread-&gt;cond);
+		pthread_join(threadid, NULL);
 	}
+	AST_LIST_TRAVERSE_SAFE_END
 	AST_LIST_UNLOCK(&amp;active_list);
 
 	AST_LIST_LOCK(&amp;dynamic_list);
-        AST_LIST_TRAVERSE(&amp;dynamic_list, thread, list) {
+        AST_LIST_TRAVERSE_SAFE_BEGIN(&amp;dynamic_list, thread, list) {
+		AST_LIST_REMOVE_CURRENT(&amp;dynamic_list, list);
+		threadid = thread-&gt;threadid;
                 thread-&gt;halt = 1;
                 signal_condition(&amp;thread-&gt;lock, &amp;thread-&gt;cond);
+		pthread_join(threadid, NULL);
         }
+	AST_LIST_TRAVERSE_SAFE_END
         AST_LIST_UNLOCK(&amp;dynamic_list);
 
 	ast_netsock_release(netsock);

Modified: trunk/channels/chan_local.c
===================================================================
--- trunk/channels/chan_local.c	2006-05-25 20:48:20 UTC (rev 180)
+++ trunk/channels/chan_local.c	2006-05-26 21:12:24 UTC (rev 181)
@@ -369,7 +369,7 @@
 	p-&gt;chan-&gt;cid.cid_name = ast_strdup(p-&gt;owner-&gt;cid.cid_name);
 	p-&gt;chan-&gt;cid.cid_rdnis = ast_strdup(p-&gt;owner-&gt;cid.cid_rdnis);
 	p-&gt;chan-&gt;cid.cid_ani = ast_strdup(p-&gt;owner-&gt;cid.cid_ani);
-
+	p-&gt;chan-&gt;cid.cid_pres = p-&gt;owner-&gt;cid.cid_pres;
 	ast_string_field_set(p-&gt;chan, language, p-&gt;owner-&gt;language);
 	ast_string_field_set(p-&gt;chan, accountcode, p-&gt;owner-&gt;accountcode);
 	p-&gt;chan-&gt;cdrflags = p-&gt;owner-&gt;cdrflags;

Modified: trunk/channels/chan_misdn.c
===================================================================
--- trunk/channels/chan_misdn.c	2006-05-25 20:48:20 UTC (rev 180)
+++ trunk/channels/chan_misdn.c	2006-05-26 21:12:24 UTC (rev 181)
@@ -132,6 +132,7 @@
 	MISDN_ALERTING, /*!&lt;  when Alerting */
 	MISDN_BUSY, /*!&lt;  when BUSY */
 	MISDN_CONNECTED, /*!&lt;  when connected */
+	MISDN_PRECONNECTED, /*!&lt;  when connected */
 	MISDN_DISCONNECTED, /*!&lt;  when connected */
 	MISDN_BRIDGED, /*!&lt;  when bridged */
 	MISDN_CLEANING, /*!&lt; when hangup from * but we were connected before */
@@ -280,6 +281,10 @@
 static int *misdn_debug_only;
 static int max_ports;
 
+static int *misdn_in_calls;
+static int *misdn_out_calls;
+
+
 struct chan_list dummy_cl;
 
 struct chan_list *cl_te=NULL;
@@ -311,6 +316,11 @@
 
 void debug_numplan(int port, int numplan, char *type);
 
+
+int add_out_calls(int port);
+int add_in_calls(int port);
+
+
 /*************** Helpers *****************/
 
 static struct chan_list * get_chan_by_ast(struct ast_channel *ast)
@@ -780,6 +790,24 @@
 
 }
 
+
+static int misdn_show_ports_stats (int fd, int argc, char *argv[])
+{
+	int port;
+
+	ast_cli(fd, &quot;Port\tin_calls\tout_calls\n&quot;);
+	
+	for (port=misdn_cfg_get_next_port(0); port &gt; 0;
+	     port=misdn_cfg_get_next_port(port)) {
+		ast_cli(fd,&quot;%d\t%d\t\t%d\n&quot;,port,misdn_in_calls[port],misdn_out_calls[port]);
+	}
+	ast_cli(fd,&quot;\n&quot;);
+	
+	return 0;
+
+}
+
+
 static int misdn_show_port (int fd, int argc, char *argv[])
 {
 	int port;
@@ -1077,6 +1105,14 @@
   &quot;Usage: misdn show stacks\n&quot;
 };
 
+static struct ast_cli_entry cli_show_ports_stats =
+{ {&quot;misdn&quot;,&quot;show&quot;,&quot;ports&quot;,&quot;stats&quot;, NULL},
+  misdn_show_ports_stats,
+  &quot;Shows chan_misdns call statistics per port&quot;, 
+  &quot;Usage: misdn show port stats\n&quot;
+};
+
+
 static struct ast_cli_entry cli_show_port =
 { {&quot;misdn&quot;,&quot;show&quot;,&quot;port&quot;, NULL},
   misdn_show_port,
@@ -1523,6 +1559,14 @@
 	port=newbc-&gt;port;
 	strncpy(newbc-&gt;dad,ext,sizeof( newbc-&gt;dad));
 	strncpy(ast-&gt;exten,ext,sizeof(ast-&gt;exten));
+
+	int exceed;
+	if ((exceed=add_out_calls(port))) {
+		char tmp[16];
+		sprintf(tmp,&quot;%d&quot;,exceed);
+		pbx_builtin_setvar_helper(ast,&quot;MAX_OVERFLOW&quot;,tmp);
+		return -1;
+	}
 	
 	chan_misdn_log(1, port, &quot;* CALL: %s\n&quot;,dest);
 	
@@ -2544,6 +2588,21 @@
 
 static unsigned long glob_channel=0;
 
+static void update_name(struct ast_channel *tmp, int port, int c) 
+{
+	if (c&lt;=0) {
+			c=glob_channel++;
+			ast_string_field_build(tmp, name, &quot;%s/%d-u%d&quot;,
+				 misdn_type, port, c);
+	} else {
+			 ast_string_field_build(tmp, name, &quot;%s/%d-%d&quot;,
+				 misdn_type, port, c);
+	}
+
+	chan_misdn_log(3,port,&quot; --&gt; updating channel name to [%s]\n&quot;,tmp-&gt;name);
+	
+}
+
 static struct ast_channel *misdn_new(struct chan_list *chlist, int state,  char *exten, char *callerid, int format, int port, int c)
 {
 	struct ast_channel *tmp;
@@ -2553,16 +2612,8 @@
 	if (tmp) {
 		chan_misdn_log(2, 0, &quot; --&gt; * NEW CHANNEL dad:%s oad:%s\n&quot;,exten,callerid);
 		
-		
-		if (c&lt;=0) {
-			c=glob_channel++;
-			ast_string_field_build(tmp, name, &quot;%s/%d-u%d&quot;,
-				 misdn_type, port, c);
-		} else {
-			ast_string_field_build(tmp, name, &quot;%s/%d-%d&quot;,
-				 misdn_type, port, c);
-		}
-		
+		update_name(tmp,port,c);
+	
 		tmp-&gt;nativeformats = prefformat;
 
 		tmp-&gt;readformat = format;
@@ -2743,6 +2794,13 @@
 			if (!bc-&gt;nojitter)
 				chan_misdn_log(5,bc-&gt;port,&quot;Jitterbuffer already destroyed.\n&quot;);
 		}
+
+
+		if (ch-&gt;orginator == ORG_AST) {
+			misdn_out_calls[bc-&gt;port]--;
+		} else {
+			misdn_in_calls[bc-&gt;port]--;
+		}
 		
 		if (ch) {
 			
@@ -2930,7 +2988,6 @@
 	}
 }
 
-
 void import_ies(struct ast_channel *chan, struct misdn_bchannel *bc)
 {
 	const char *tmp;
@@ -2946,10 +3003,9 @@
 
 	tmp=pbx_builtin_getvar_helper(chan,&quot;PRI_USER1&quot;);
 	if (tmp) bc-&gt;user1=atoi(tmp);
-	
-	tmp=pbx_builtin_getvar_helper(chan,&quot;RDNIS&quot;);
-	if (tmp) ast_copy_string(bc-&gt;rad,tmp,sizeof(bc-&gt;rad));
-	
+
+	tmp=pbx_builtin_getvar_helper(chan,&quot;PRI_PROGRESS_INDICATOR&quot;);
+	if (tmp) bc-&gt;progress_indicator=atoi(tmp);
 }
 
 void export_ies(struct ast_channel *chan, struct misdn_bchannel *bc)
@@ -2957,22 +3013,57 @@
 	char tmp[32];
 	
 	sprintf(tmp,&quot;%d&quot;,bc-&gt;mode);
-	pbx_builtin_setvar_helper(chan,&quot;PRI_MODE&quot;,tmp);
+	pbx_builtin_setvar_helper(chan,&quot;_PRI_MODE&quot;,tmp);
 
 	sprintf(tmp,&quot;%d&quot;,bc-&gt;urate);
-	pbx_builtin_setvar_helper(chan,&quot;PRI_URATE&quot;,tmp);
+	pbx_builtin_setvar_helper(chan,&quot;_PRI_URATE&quot;,tmp);
 
 	sprintf(tmp,&quot;%d&quot;,bc-&gt;rate);
-	pbx_builtin_setvar_helper(chan,&quot;PRI_RATE&quot;,tmp);
+	pbx_builtin_setvar_helper(chan,&quot;_PRI_RATE&quot;,tmp);
 	
 	sprintf(tmp,&quot;%d&quot;,bc-&gt;user1);
-	pbx_builtin_setvar_helper(chan,&quot;PRI_USER1&quot;,tmp);
+	pbx_builtin_setvar_helper(chan,&quot;_PRI_USER1&quot;,tmp);
 	
-	pbx_builtin_setvar_helper(chan,&quot;RDNIS&quot;,bc-&gt;rad);
+	sprintf(tmp,&quot;%d&quot;,bc-&gt;progress_indicator);
+	pbx_builtin_setvar_helper(chan,&quot;_PRI_PROGRESS_INDICATOR&quot;,tmp);
 }
 
 
+int add_in_calls(int port)
+{
+	int max_in_calls;
+	
+	misdn_cfg_get( port, MISDN_CFG_MAX_IN, &amp;max_in_calls, sizeof(max_in_calls));
 
+	misdn_in_calls[port]++;
+
+	if (max_in_calls &gt;=0 &amp;&amp; max_in_calls&lt;misdn_in_calls[port]) {
+		ast_log(LOG_NOTICE,&quot;Marking Incoming Call on port[%d]\n&quot;,port);
+		return misdn_in_calls[port]-max_in_calls;
+	}
+	
+	return 0;
+}
+
+int add_out_calls(int port)
+{
+	int max_out_calls;
+	
+	misdn_cfg_get( port, MISDN_CFG_MAX_OUT, &amp;max_out_calls, sizeof(max_out_calls));
+	
+
+	if (max_out_calls &gt;=0 &amp;&amp; max_out_calls&lt;=misdn_out_calls[port]) {
+		ast_log(LOG_NOTICE,&quot;Rejecting Outgoing Call on port[%d]\n&quot;,port);
+		return (misdn_out_calls[port]+1)-max_out_calls;
+	}
+
+	misdn_out_calls[port]++;
+	
+	return 0;
+}
+
+
+
 /************************************************************/
 /*  Receive Events from isdn_lib  here                     */
 /************************************************************/
@@ -3015,13 +3106,27 @@
 	
 	
 	switch (event) {
-
+		
 	case EVENT_BCHAN_ACTIVATED:
 		break;
 		
+	case EVENT_NEW_CHANNEL:
+		update_name(ch-&gt;ast,bc-&gt;port,bc-&gt;channel);
+		break;
 		
 	case EVENT_NEW_L3ID:
 		ch-&gt;l3id=bc-&gt;l3_id;
+		ch-&gt;addr=bc-&gt;addr;
+
+		if (bc-&gt;nt &amp;&amp; ch-&gt;state == MISDN_PRECONNECTED ) {
+			/* OK we've got the very new l3id so we can answer
+			   now */
+			start_bc_tones(ch);
+		
+			ch-&gt;state = MISDN_CONNECTED;
+			ast_queue_control(ch-&gt;ast, AST_CONTROL_ANSWER);
+
+		}
 		break;
 
 	case EVENT_NEW_BC:
@@ -3169,12 +3274,14 @@
 		chan_misdn_log(1, bc-&gt;port, &quot; --&gt; Ignoring Call, its not in our MSN List\n&quot;);
 		return RESPONSE_IGNORE_SETUP; /*  Ignore MSNs which are not in our List */
 	}
+
 	
 	print_bearer(bc);
     
 	{
 		struct chan_list *ch=init_chan_list(ORG_MISDN);
 		struct ast_channel *chan;
+		int exceed;
 
 		if (!ch) { chan_misdn_log(-1, bc-&gt;port, &quot;cb_events: malloc for chan_list failed!\n&quot;); return 0;}
 		
@@ -3186,6 +3293,12 @@
 		chan=misdn_new(ch, AST_STATE_RESERVED,bc-&gt;dad, bc-&gt;oad, AST_FORMAT_ALAW, bc-&gt;port, bc-&gt;channel);
 		ch-&gt;ast = chan;
 
+		if ((exceed=add_in_calls(bc-&gt;port))) {
+			char tmp[16];
+			sprintf(tmp,&quot;%d&quot;,exceed);
+			pbx_builtin_setvar_helper(chan,&quot;MAX_OVERFLOW&quot;,tmp);
+		}
+
 		read_config(ch, ORG_MISDN);
 		
 		export_ies(chan, bc);
@@ -3318,6 +3431,10 @@
 	case EVENT_SETUP_ACKNOWLEDGE:
 	{
 		ch-&gt;state = MISDN_CALLING_ACKNOWLEDGE;
+
+		if (bc-&gt;channel) 
+			update_name(ch-&gt;ast,bc-&gt;port,bc-&gt;channel);
+		
 		if (!ast_strlen_zero(bc-&gt;infos_pending)) {
 			/* TX Pending Infos */
 			
@@ -3401,15 +3518,24 @@
 		misdn_lib_echo(bc,0);
 		tone_indicate(ch, TONE_NONE);
 
-		if (bridged &amp;&amp; strcasecmp(bridged-&gt;tech-&gt;type,&quot;mISDN&quot;)) {
+		if (bridged &amp;&amp; !strcasecmp(bridged-&gt;tech-&gt;type,&quot;mISDN&quot;)) {
 			struct chan_list *bridged_ch=MISDN_ASTERISK_TECH_PVT(bridged);
 
 			chan_misdn_log(1,bc-&gt;port,&quot; --&gt; copying cpndialplan:%d and cad:%s to the A-Channel\n&quot;,bc-&gt;cpnnumplan,bc-&gt;cad);
-
-			bridged_ch-&gt;bc-&gt;cpnnumplan=bc-&gt;cpnnumplan;
-			ast_copy_string(bridged_ch-&gt;bc-&gt;cad,bc-&gt;cad,sizeof(bc-&gt;cad));
+			if (bridged_ch) {
+				bridged_ch-&gt;bc-&gt;cpnnumplan=bc-&gt;cpnnumplan;
+				ast_copy_string(bridged_ch-&gt;bc-&gt;cad,bc-&gt;cad,sizeof(bc-&gt;cad));
+			}
 		}
 	}
+	
+	/*we answer when we've got our very new L3 ID from the NT stack */
+	if (bc-&gt;nt) { 
+		ch-&gt;state=MISDN_PRECONNECTED;
+		break;
+	}
+	
+	/* notice that we don't break here!*/
 
 	case EVENT_CONNECT_ACKNOWLEDGE:
 	{
@@ -3432,7 +3558,7 @@
 		send_cause2ast(ch-&gt;ast,bc);
 
 
-		chan_misdn_log(0,bc-&gt;port,&quot; org:%d nt:%d, inbandavail:%d state:%d\n&quot;, ch-&gt;orginator, bc-&gt;nt, misdn_inband_avail(bc), ch-&gt;state);
+		chan_misdn_log(3,bc-&gt;port,&quot; --&gt; org:%d nt:%d, inbandavail:%d state:%d\n&quot;, ch-&gt;orginator, bc-&gt;nt, misdn_inband_avail(bc), ch-&gt;state);
 		if ( ch-&gt;orginator==ORG_AST &amp;&amp; !bc-&gt;nt &amp;&amp; misdn_inband_avail(bc) &amp;&amp; ch-&gt;state != MISDN_CONNECTED) {
 			/* If there's inband information available (e.g. a
 			   recorded message saying what was wrong with the
@@ -3708,6 +3834,7 @@
 	ast_cli_unregister(&amp;cli_show_cl);
 	ast_cli_unregister(&amp;cli_show_config);
 	ast_cli_unregister(&amp;cli_show_port);
+	ast_cli_unregister(&amp;cli_show_ports_stats);
 	ast_cli_unregister(&amp;cli_show_stacks);
 	ast_cli_unregister(&amp;cli_restart_port);
 	ast_cli_unregister(&amp;cli_port_up);
@@ -3764,14 +3891,26 @@
 		if (strlen(tempbuf))
 			tracing = 1;
 	}
+	
+	misdn_in_calls = (int *)malloc(sizeof(int) * (max_ports+1));
+	misdn_out_calls = (int *)malloc(sizeof(int) * (max_ports+1));
 
+	for (i=1; i &lt;= max_ports; i++) {
+		misdn_in_calls[i]=0;
+		misdn_out_calls[i]=0;
+	}
+	
 	ast_mutex_init(&amp;cl_te_lock);
 	ast_mutex_init(&amp;release_lock_mutex);
 
 
 	misdn_cfg_update_ptp();
 	misdn_cfg_get_ports_string(ports);
-		
+
+
+	int l1watcher_timeout=0;
+	misdn_cfg_get( 0, MISDN_GEN_L1_TIMEOUT, &amp;l1watcher_timeout, sizeof(int));
+	
 	if (strlen(ports))
 		chan_misdn_log(0, 0, &quot;Got: %s from get_ports\n&quot;,ports);
 	
@@ -3780,7 +3919,9 @@
 			.cb_event = cb_events,
 			.cb_log = chan_misdn_log,
 			.cb_jb_empty = chan_misdn_jb_empty,
+			.l1watcher_timeout=l1watcher_timeout,
 		};
+		
 		if (misdn_lib_init(ports, &amp;iface, NULL))
 			chan_misdn_log(0, 0, &quot;No te ports initialized\n&quot;);
 	}
@@ -3805,6 +3946,7 @@
 	ast_cli_register(&amp;cli_show_config);
 	ast_cli_register(&amp;cli_show_port);
 	ast_cli_register(&amp;cli_show_stacks);
+	ast_cli_register(&amp;cli_show_ports_stats);
 
 	ast_cli_register(&amp;cli_restart_port);
 	ast_cli_register(&amp;cli_port_up);
@@ -3814,10 +3956,20 @@
 	ast_cli_register(&amp;cli_reload);
 
   
-	ast_register_application(&quot;misdn_set_opt&quot;, misdn_set_opt_exec, &quot;misdn_set_flags&quot;,
+	ast_register_application(&quot;misdn_set_opt&quot;, misdn_set_opt_exec, &quot;misdn_set_opt&quot;,
 				 &quot;misdn_set_opt(:&lt;opt&gt;&lt;optarg&gt;:&lt;opt&gt;&lt;optarg&gt;..):\n&quot;
 				 &quot;Sets mISDN opts. and optargs\n&quot;
 				 &quot;\n&quot;
+				 &quot;The available options are:\n&quot;
+				 &quot;    d - Send display text on called phone, text is the optparam\n&quot;
+				 &quot;    n - don't detect dtmf tones on called channel\n&quot;
+				 &quot;    h - make digital outgoing call\n&quot; 
+				 &quot;    c - make crypted outgoing call, param is keyindex\n&quot;
+				 &quot;    e - perform echo cancelation on this channel,\n&quot;
+				 &quot;        takes taps as arguments (32,64,128,256)\n&quot;
+				 &quot;    s - send Non Inband DTMF as inband\n&quot;
+				 &quot;   vr - rxgain control\n&quot;
+				 &quot;   vt - txgain control\n&quot;
 		);
 
 	
@@ -3828,11 +3980,13 @@
 				 &quot;Supported Facilities are:\n&quot;
 				 &quot;\n&quot;
 				 &quot;type=calldeflect args=Nr where to deflect\n&quot;
-				 &quot;\n&quot;
 		);
 
 
 	misdn_cfg_get( 0, MISDN_GEN_TRACEFILE, global_tracefile, BUFFERSIZE);
+
+
+
 	
 	chan_misdn_log(0, 0, &quot;-- mISDN Channel Driver Registred -- (BE AWARE THIS DRIVER IS EXPERIMENTAL!)\n&quot;);
 

Modified: trunk/channels/chan_sip.c
===================================================================
--- trunk/channels/chan_sip.c	2006-05-25 20:48:20 UTC (rev 180)
+++ trunk/channels/chan_sip.c	2006-05-26 21:12:24 UTC (rev 181)
@@ -444,6 +444,7 @@
 /* Global settings only apply to the channel */
 static int global_rtautoclear;
 static int global_notifyringing;	/*!&lt; Send notifications on ringing */
+static int global_alwaysauthreject;	/*!&lt; Send 401 Unauthorized for all failing requests */
 static int srvlookup;			/*!&lt; SRV Lookup on or off. Default is off, RFC behavior is on */
 static int pedanticsipchecking;		/*!&lt; Extra checking ?  Default off */
 static int autocreatepeer;		/*!&lt; Auto creation of peers at registration? Default off. */
@@ -510,8 +511,9 @@
 
 #define DEC_CALL_LIMIT	0
 #define INC_CALL_LIMIT	1
+#define DEC_CALL_RINGING 2
+#define INC_CALL_RINGING 3
 
-
 /*! \brief sip_request: The data grabbed from the UDP socket */
 struct sip_request {
 	char *rlPart1; 		/*!&lt; SIP Method Name or &quot;SIP/2.0&quot; protocol version */
@@ -624,7 +626,7 @@
 #define SIP_REALTIME		(1 &lt;&lt; 11)	/*!&lt; Flag for realtime users */
 #define SIP_USECLIENTCODE	(1 &lt;&lt; 12)	/*!&lt; Trust X-ClientCode info message */
 #define SIP_OUTGOING		(1 &lt;&lt; 13)	/*!&lt; Is this an outgoing call? */
-#define SIP_FREEBIT		(1 &lt;&lt; 14)	/*!&lt; Free for session-related use */
+#define SIP_CAN_BYE		(1 &lt;&lt; 14)	/*!&lt; Can we send BYE on this dialog? */
 #define SIP_FREEBIT3		(1 &lt;&lt; 15)	/*!&lt; Free for session-related use */
 #define SIP_DTMF		(3 &lt;&lt; 16)	/*!&lt; DTMF Support: four settings, uses two bits */
 #define SIP_DTMF_RFC2833	(0 &lt;&lt; 16)	/*!&lt; DTMF Support: RTP DTMF - &quot;rfc2833&quot; */
@@ -675,8 +677,8 @@
 #define SIP_PAGE2_ALLOWSUBSCRIBE	(1 &lt;&lt; 10)	/*!&lt; Allow subscriptions from this peer? */
 #define SIP_PAGE2_ALLOWOVERLAP		(1 &lt;&lt; 11)	/*!&lt; Allow overlap dialing ? */
 #define SIP_PAGE2_SUBSCRIBEMWIONLY	(1 &lt;&lt; 12)	/*!&lt; Only issue MWI notification if subscribed to */
+#define SIP_PAGE2_INC_RINGING		(1 &lt;&lt; 13)	/*!&lt; Did this connection increment the counter of in-use calls? */
 
-
 #define SIP_PAGE2_FLAGS_TO_COPY \
 	(SIP_PAGE2_ALLOWSUBSCRIBE | SIP_PAGE2_ALLOWOVERLAP | SIP_PAGE2_VIDEOSUPPORT)
 
@@ -920,6 +922,7 @@
 	char cid_name[80];		/*!&lt; Caller ID name */
 	int callingpres;		/*!&lt; Calling id presentation */
 	int inUse;			/*!&lt; Number of calls in use */
+	int inRinging;			/*!&lt; Number of calls ringing */
 	int call_limit;			/*!&lt; Limit of concurrent calls */
 	enum transfermodes allowtransfer;	/*! SIP Refer restriction scheme */
 	char vmexten[AST_MAX_EXTENSION]; /*!&lt; Dialplan extension for MWI notify message*/
@@ -1029,6 +1032,16 @@
 
 static struct ast_config *notify_types;		/*!&lt; The list of manual NOTIFY types we know how to send */
 
+enum check_auth_result {
+	AUTH_SUCCESSFUL = 0,
+	AUTH_CHALLENGE_SENT = 1,
+	AUTH_SECRET_FAILED = -1,
+	AUTH_USERNAME_MISMATCH = -2,
+	AUTH_NOT_FOUND = -3,
+	AUTH_FAKE_AUTH = -4,
+	AUTH_UNKNOWN_DOMAIN = -5,
+};
+
 /*---------------------------- Forward declarations of functions in chan_sip.c */
 /*! \note Sorted up from start to build_rpid.... Will continue categorization in order to
 	split up chan_sip.c into several files  */
@@ -1050,14 +1063,14 @@
 /*--- Transmitting responses and requests */
 static int __sip_xmit(struct sip_pvt *p, char *data, int len);
 static int __sip_reliable_xmit(struct sip_pvt *p, int seqno, int resp, char *data, int len, int fatal, int sipmethod);
-static int __transmit_response(struct sip_pvt *p, const char *msg, struct sip_request *req, enum xmittype reliable);
-static int transmit_response(struct sip_pvt *p, char *msg, struct sip_request *req);
-static int transmit_response_reliable(struct sip_pvt *p, const char *msg, struct sip_request *req);
-static int transmit_response_with_date(struct sip_pvt *p, char *msg, struct sip_request *req);
-static int transmit_response_with_sdp(struct sip_pvt *p, char *msg, struct sip_request *req, enum xmittype reliable);
-static int transmit_response_with_unsupported(struct sip_pvt *p, const char *msg, struct sip_request *req, const char *unsupported);
-static int transmit_response_with_auth(struct sip_pvt *p, const char *msg, struct sip_request *req, const char *rand, enum xmittype reliable, const char *header, int stale);
-static int transmit_response_with_allow(struct sip_pvt *p, char *msg, struct sip_request *req, enum xmittype reliable);
+static int __transmit_response(struct sip_pvt *p, const char *msg, const struct sip_request *req, enum xmittype reliable);
+static int transmit_response(struct sip_pvt *p, const char *msg, const struct sip_request *req);
+static int transmit_response_reliable(struct sip_pvt *p, const char *msg, const struct sip_request *req);
+static int transmit_response_with_date(struct sip_pvt *p, const char *msg, const struct sip_request *req);
+static int transmit_response_with_sdp(struct sip_pvt *p, const char *msg, const struct sip_request *req, enum xmittype reliable);
+static int transmit_response_with_unsupported(struct sip_pvt *p, const char *msg, const struct sip_request *req, const char *unsupported);
+static int transmit_response_with_auth(struct sip_pvt *p, const char *msg, const struct sip_request *req, const char *rand, enum xmittype reliable, const char *header, int stale);
+static int transmit_response_with_allow(struct sip_pvt *p, const char *msg, const struct sip_request *req, enum xmittype reliable);
 static int transmit_request(struct sip_pvt *p, int sipmethod, int inc, enum xmittype reliable, int newbranch);
 static int transmit_request_with_auth(struct sip_pvt *p, int sipmethod, int inc, enum xmittype reliable, int newbranch);
 static int transmit_invite(struct sip_pvt *p, int sipmethod, int sendsdp, int init);
@@ -1067,11 +1080,11 @@
 static int transmit_message_with_text(struct sip_pvt *p, const char *text);
 static int transmit_refer(struct sip_pvt *p, const char *dest);
 static int transmit_state_notify(struct sip_pvt *p, int state, int full);
-static int transmit_register(struct sip_registry *r, int sipmethod, char *auth, char *authheader);
+static int transmit_register(struct sip_registry *r, int sipmethod, const char *auth, const char *authheader);
 static int retrans_pkt(void *data);
 static int send_response(struct sip_pvt *p, struct sip_request *req, enum xmittype reliable, int seqno);
 static int send_request(struct sip_pvt *p, struct sip_request *req, enum xmittype reliable, int seqno);
-static void copy_request(struct sip_request *dst, struct sip_request *src);
+static void copy_request(struct sip_request *dst, const struct sip_request *src);
 
 /*--- Dialog management */
 static struct sip_pvt *sip_alloc(ast_string_field callid, struct sockaddr_in *sin,
@@ -1112,9 +1125,9 @@
 static int clear_realm_authentication(struct sip_auth *authlist);	/* Clear realm authentication list (at reload) */
 static struct sip_auth *add_realm_authentication(struct sip_auth *authlist, char *configuration, int lineno);	/* Add realm authentication in list */
 static struct sip_auth *find_realm_authentication(struct sip_auth *authlist, const char *realm);	/* Find authentication for a specific realm */
-static int check_auth(struct sip_pvt *p, struct sip_request *req, const char *username,
-		const char *secret, const char *md5secret, int sipmethod,
-		char *uri, enum xmittype reliable, int ignore);
+static enum check_auth_result check_auth(struct sip_pvt *p, struct sip_request *req, const char *username,
+					 const char *secret, const char *md5secret, int sipmethod,
+					 char *uri, enum xmittype reliable, int ignore);
 
 /*--- Domain handling */
 static int check_sip_domain(const char *domain, char *context, size_t len); /* Check if domain is one of our local domains */
@@ -1171,14 +1184,14 @@
 static void append_date(struct sip_request *req);	/* Append date to SIP packet */
 static int determine_firstline_parts(struct sip_request *req);
 static const struct cfsubscription_types *find_subscription_type(enum subscriptiontype subtype);
-static const char *gettag(const struct sip_request *req, char *header, char *tagbuf, int tagbufsize);
+static const char *gettag(const struct sip_request *req, const char *header, char *tagbuf, int tagbufsize);
 static int find_sip_method(const char *msg);
 static unsigned int parse_sip_options(struct sip_pvt *pvt, const char *supported);
 static void parse_request(struct sip_request *req);
 static const char *get_header(const struct sip_request *req, const char *name);
 static char *referstatus2str(enum referstatus rstatus);
 static int method_match(enum sipmethod id, const char *name);
-static void parse_copy(struct sip_request *dst, struct sip_request *src);
+static void parse_copy(struct sip_request *dst, const struct sip_request *src);
 static char *get_in_brackets(char *tmp);
 static const char *find_alias(const char *name, const char *_default);
 static const char *__get_header(const struct sip_request *req, const char *name, int *start);
@@ -1191,7 +1204,7 @@
 static int init_req(struct sip_request *req, int sipmethod, const char *recip);
 static int reqprep(struct sip_request *req, struct sip_pvt *p, int sipmethod, int seqno, int newbranch);
 static int init_resp(struct sip_request *resp, const char *msg);
-static int respprep(struct sip_request *resp, struct sip_pvt *p, const char *msg, struct sip_request *req);
+static int respprep(struct sip_request *resp, struct sip_pvt *p, const char *msg, const struct sip_request *req);
 static const struct sockaddr_in *sip_real_dst(const struct sip_pvt *p);
 static void build_via(struct sip_pvt *p);
 static int create_addr_from_peer(struct sip_pvt *r, struct sip_peer *peer);
@@ -1207,9 +1220,9 @@
 static int add_digit(struct sip_request *req, char digit);
 static int add_vidupdate(struct sip_request *req);
 static void add_route(struct sip_request *req, struct sip_route *route);
-static int copy_header(struct sip_request *req, struct sip_request *orig, char *field);
-static int copy_all_header(struct sip_request *req, struct sip_request *orig, char *field);
-static int copy_via_headers(struct sip_pvt *p, struct sip_request *req, struct sip_request *orig, char *field);
+static int copy_header(struct sip_request *req, const struct sip_request *orig, const char *field);
+static int copy_all_header(struct sip_request *req, const struct sip_request *orig, const char *field);
+static int copy_via_headers(struct sip_pvt *p, struct sip_request *req, const struct sip_request *orig, const char *field);
 static void set_destination(struct sip_pvt *p, char *uri);
 static void append_date(struct sip_request *req);
 static void build_contact(struct sip_pvt *p);
@@ -1452,8 +1465,7 @@
 			struct ast_hostent ahp;
 			struct hostent *hp;
 
-			time(&amp;externexpire);
-			externexpire += externrefresh;
+			externexpire = time(NULL) + externrefresh;
 			if ((hp = ast_gethostbyname(externhost, &amp;ahp))) {
 				memcpy(&amp;externip.sin_addr, hp-&gt;h_addr, sizeof(externip.sin_addr));
 			} else
@@ -1550,11 +1562,12 @@
  				ast_log(LOG_DEBUG, &quot;** SIP timers: Rescheduling retransmission %d to %d ms (t1 %d ms (Retrans id #%d)) \n&quot;, pkt-&gt;retrans +1, siptimer_a, pkt-&gt;timer_t1, pkt-&gt;retransid);
  		} 
 
-		if (pkt-&gt;owner &amp;&amp; sip_debug_test_pvt(pkt-&gt;owner)) {
-			if (ast_test_flag(&amp;pkt-&gt;owner-&gt;flags[0], SIP_NAT_ROUTE))
-				ast_verbose(&quot;Retransmitting #%d (NAT) to %s:%d:\n%s\n---\n&quot;, pkt-&gt;retrans, ast_inet_ntoa(iabuf, sizeof(iabuf), pkt-&gt;owner-&gt;recv.sin_addr), ntohs(pkt-&gt;owner-&gt;recv.sin_port), pkt-&gt;data);
-			else
-				ast_verbose(&quot;Retransmitting #%d (no NAT) to %s:%d:\n%s\n---\n&quot;, pkt-&gt;retrans, ast_inet_ntoa(iabuf, sizeof(iabuf), pkt-&gt;owner-&gt;sa.sin_addr), ntohs(pkt-&gt;owner-&gt;sa.sin_port), pkt-&gt;data);
+		if (sip_debug_test_pvt(pkt-&gt;owner)) {
+			const struct sockaddr_in *dst = sip_real_dst(pkt-&gt;owner);
+			ast_verbose(&quot;Retransmitting #%d (%s) to %s:%d:\n%s\n---\n&quot;,
+				pkt-&gt;retrans, sip_nat_mode(pkt-&gt;owner),
+				ast_inet_ntoa(iabuf, sizeof(iabuf), dst-&gt;sin_addr),
+				ntohs(dst-&gt;sin_port), pkt-&gt;data);
 		}
 
 		append_history(pkt-&gt;owner, &quot;ReTx&quot;, &quot;%d %s&quot;, reschedule, pkt-&gt;data);
@@ -1790,7 +1803,7 @@
 
 
 /*! \brief Copy SIP request, parse it */
-static void parse_copy(struct sip_request *dst, struct sip_request *src)
+static void parse_copy(struct sip_request *dst, const struct sip_request *src)
 {
 	memset(dst, 0, sizeof(*dst));
 	memcpy(dst-&gt;data, src-&gt;data, sizeof(dst-&gt;data));
@@ -1816,10 +1829,12 @@
 	add_blank(req);
 	if (sip_debug_test_pvt(p)) {
 		char iabuf[INET_ADDRSTRLEN];
-		if (ast_test_flag(&amp;p-&gt;flags[0], SIP_NAT_ROUTE))
-			ast_verbose(&quot;%sTransmitting (NAT) to %s:%d:\n%s\n---\n&quot;, reliable ? &quot;Reliably &quot; : &quot;&quot;, ast_inet_ntoa(iabuf, sizeof(iabuf), p-&gt;recv.sin_addr), ntohs(p-&gt;recv.sin_port), req-&gt;data);
-		else
-			ast_verbose(&quot;%sTransmitting (no NAT) to %s:%d:\n%s\n---\n&quot;, reliable ? &quot;Reliably &quot; : &quot;&quot;, ast_inet_ntoa(iabuf, sizeof(iabuf), p-&gt;sa.sin_addr), ntohs(p-&gt;sa.sin_port), req-&gt;data);
+		const struct sockaddr_in *dst = sip_real_dst(p);
+
+		ast_verbose(&quot;%sTransmitting (%s) to %s:%d:\n%s\n---\n&quot;,
+			reliable ? &quot;Reliably &quot; : &quot;&quot;, sip_nat_mode(p),
+			ast_inet_ntoa(iabuf, sizeof(iabuf), dst-&gt;sin_addr),
+			ntohs(dst-&gt;sin_port), req-&gt;data);
 	}
 	if (recordhistory) {
 		struct sip_request tmp;
@@ -1927,11 +1942,9 @@
 	char port[10];
 	char ipaddr[20];
 	char regseconds[20];
-	time_t nowtime;
+	time_t nowtime = time(NULL) + expirey;
 	const char *fc = fullcontact ? &quot;fullcontact&quot; : NULL;
 	
-	time(&amp;nowtime);
-	nowtime += expirey;
 	snprintf(regseconds, sizeof(regseconds), &quot;%d&quot;, (int)nowtime);	/* Expiration time */
 	ast_inet_ntoa(ipaddr, sizeof(ipaddr), sin-&gt;sin_addr);
 	snprintf(port, sizeof(port), &quot;%d&quot;, ntohs(sin-&gt;sin_port));
@@ -1946,32 +1959,32 @@
 {
 	char multi[256];
 	char *stringp, *ext, *context;
-	if (!ast_strlen_zero(global_regcontext)) {
 
+	/* XXX note that global_regcontext is both a global 'enable' flag and
+	 * the name of the global regexten context, if not specified
+	 * individually.
+	 */
+	if (ast_strlen_zero(global_regcontext))
+		return;
+
 		ast_copy_string(multi, S_OR(peer-&gt;regexten, peer-&gt;name), sizeof(multi));
 		stringp = multi;
-		while((ext = strsep(&amp;stringp, &quot;&amp;&quot;))) {
- 			if((context = strchr(ext, '@'))) {
-				context++;
+		while ((ext = strsep(&amp;stringp, &quot;&amp;&quot;))) {
+ 			if ((context = strchr(ext, '@'))) {
+				*context++ = '\0';	/* split <A HREF="https://lists.berlios.de/mailman/listinfo/solid-pbx-svn">ext at context</A> */
 				if (!ast_context_find(context)) {
 					ast_log(LOG_WARNING, &quot;Context %s must exist in regcontext= in sip.conf!\n&quot;, context);
 					continue;
 				}
-				ext = strsep(&amp;ext, &quot;@&quot;);
-				if (onoff)
-					ast_add_extension(context, 1, ext, 1, NULL, NULL, &quot;Noop&quot;,
-						 ast_strdup(peer-&gt;name), free, &quot;SIP&quot;);
-				else
-					ast_context_remove_extension(context, ext, 1, NULL);
 			} else {
+				context = global_regcontext;
+			}
 			if (onoff)
-				ast_add_extension(global_regcontext, 1, ext, 1, NULL, NULL, &quot;Noop&quot;,
-						  ast_strdup(peer-&gt;name), free, &quot;SIP&quot;);
+				ast_add_extension(context, 1, ext, 1, NULL, NULL, &quot;Noop&quot;,
+					 ast_strdup(peer-&gt;name), free, &quot;SIP&quot;);
 			else
-				ast_context_remove_extension(global_regcontext, ext, 1, NULL);
-			}
+				ast_context_remove_extension(context, ext, 1, NULL);
 		}
-	}
 }
 
 /*! \brief Destroy peer object from memory */
@@ -2027,25 +2040,23 @@
  * \todo Consider adding check of port address when matching here to follow the same
  * 	algorithm as for static peers. Will we break anything by adding that?
 */
-static struct sip_peer *realtime_peer(const char *peername, struct sockaddr_in *sin)
+static struct sip_peer *realtime_peer(const char *newpeername, struct sockaddr_in *sin)
 {
-	struct sip_peer *peer = NULL;
-	struct ast_variable *var;
+	struct sip_peer *peer;
+	struct ast_variable *var = NULL;
 	struct ast_variable *tmp;
-	char *newpeername = (char *) peername;
 	char iabuf[80];
 
 	/* First check on peer name */
 	if (newpeername) 
-		var = ast_load_realtime(&quot;sippeers&quot;, &quot;name&quot;, peername, NULL);
+		var = ast_load_realtime(&quot;sippeers&quot;, &quot;name&quot;, newpeername, NULL);
 	else if (sin) {	/* Then check on IP address for dynamic peers */
 		ast_inet_ntoa(iabuf, sizeof(iabuf), sin-&gt;sin_addr);
 		var = ast_load_realtime(&quot;sippeers&quot;, &quot;host&quot;, iabuf, NULL);	/* First check for fixed IP hosts */
 		if (!var)
 			var = ast_load_realtime(&quot;sippeers&quot;, &quot;ipaddr&quot;, iabuf, NULL);	/* Then check for registred hosts */
 	
-	} else
-		return NULL;
+	}
 
 	if (!var)
 		return NULL;
@@ -2192,7 +2203,9 @@
 	return u;
 }
 
-/*! \brief Create address structure from peer reference */
+/*! \brief Create address structure from peer reference.
+ *  return -1 on error, 0 on success.
+ */
 static int create_addr_from_peer(struct sip_pvt *r, struct sip_peer *peer)
 {
 	int natflags;
@@ -2285,7 +2298,6 @@
 	struct hostent *hp;
 	struct ast_hostent ahp;
 	struct sip_peer *p;
-	int found=0;
 	char *port;
 	int portno;
 	char host[MAXHOSTNAMELEN], *hostn;
@@ -2300,42 +2312,34 @@
 	p = find_peer(peer, NULL, 1);
 
 	if (p) {
-		found++;
-		if (create_addr_from_peer(dialog, p))
-			ASTOBJ_UNREF(p, sip_destroy_peer);
+		int res = create_addr_from_peer(dialog, p);
+		ASTOBJ_UNREF(p, sip_destroy_peer);
+		return res;
 	}
-	if (!p) {
-		if (found)
-			return -1;
+	hostn = peer;
+	portno = port ? atoi(port) : DEFAULT_SIP_PORT;
+	if (srvlookup) {
+		char service[MAXHOSTNAMELEN];
+		int tportno;
+		int ret;
 
-		hostn = peer;
-		portno = port ? atoi(port) : DEFAULT_SIP_PORT;
-		if (srvlookup) {
-			char service[MAXHOSTNAMELEN];
-			int tportno;
-			int ret;
-			snprintf(service, sizeof(service), &quot;_sip._udp.%s&quot;, peer);
-			ret = ast_get_srv(NULL, host, sizeof(host), &amp;tportno, service);
-			if (ret &gt; 0) {
-				hostn = host;
-				portno = tportno;
-			}
+		snprintf(service, sizeof(service), &quot;_sip._udp.%s&quot;, peer);
+		ret = ast_get_srv(NULL, host, sizeof(host), &amp;tportno, service);
+		if (ret &gt; 0) {
+			hostn = host;
+			portno = tportno;
 		}
-		hp = ast_gethostbyname(hostn, &amp;ahp);
-		if (hp) {
-			ast_string_field_set(dialog, tohost, peer);
-			memcpy(&amp;dialog-&gt;sa.sin_addr, hp-&gt;h_addr, sizeof(dialog-&gt;sa.sin_addr));
-			dialog-&gt;sa.sin_port = htons(portno);
-			dialog-&gt;recv = dialog-&gt;sa;
-			return 0;
-		} else {
-			ast_log(LOG_WARNING, &quot;No such host: %s\n&quot;, peer);
-			return -1;
-		}
-	} else {
-		ASTOBJ_UNREF(p, sip_destroy_peer);
-		return 0;
 	}
+	hp = ast_gethostbyname(hostn, &amp;ahp);
+	if (!hp) {
+		ast_log(LOG_WARNING, &quot;No such host: %s\n&quot;, peer);
+		return -1;
+	}
+	ast_string_field_set(dialog, tohost, peer);
+	memcpy(&amp;dialog-&gt;sa.sin_addr, hp-&gt;h_addr, sizeof(dialog-&gt;sa.sin_addr));
+	dialog-&gt;sa.sin_port = htons(portno);
+	dialog-&gt;recv = dialog-&gt;sa;
+	return 0;
 }
 
 /*! \brief Scheduled congestion on a call */
@@ -2418,7 +2422,7 @@
 	if (option_debug)
 		ast_log(LOG_DEBUG, &quot;Outgoing Call for %s\n&quot;, p-&gt;username);
 
-	res = update_call_counter(p, INC_CALL_LIMIT);
+	res = update_call_counter(p, INC_CALL_RINGING);
 	if ( res != -1 ) {
 		p-&gt;callingpres = ast-&gt;cid.cid_pres;
 		p-&gt;jointcapability = p-&gt;capability;
@@ -2568,7 +2572,7 @@
 static int update_call_counter(struct sip_pvt *fup, int event)
 {
 	char name[256];
-	int *inuse, *call_limit;
+	int *inuse, *call_limit, *inringing = NULL;
 	int outgoing = ast_test_flag(&amp;fup-&gt;flags[0], SIP_OUTGOING);
 	struct sip_user *u = NULL;
 	struct sip_peer *p = NULL;
@@ -2597,10 +2601,11 @@
 		if (p) {
 			inuse = &amp;p-&gt;inUse;
 			call_limit = &amp;p-&gt;call_limit;
+			inringing = &amp;p-&gt;inRinging;
 			ast_copy_string(name, fup-&gt;peername, sizeof(name));
 		} else {
 			if (option_debug &gt; 1)
-				ast_log(LOG_DEBUG, &quot;%s is not a local user, no call limit\n&quot;, name);
+				ast_log(LOG_DEBUG, &quot;%s is not a local device, no call limit\n&quot;, name);
 			return 0;
 		}
 	}
@@ -2613,10 +2618,20 @@
 			} else {
 				*inuse = 0;
 			}
+			if (inringing) {
+				if (ast_test_flag(&amp;fup-&gt;flags[1], SIP_PAGE2_INC_RINGING)) {
+					if (*inringing &gt; 0)
+						(*inringing)--;
+					else
+						ast_log(LOG_WARNING, &quot;Inringing for peer '%s' &lt; 0?\n&quot;, fup-&gt;peername);
+					ast_clear_flag(&amp;fup-&gt;flags[1], SIP_PAGE2_INC_RINGING);
+				}
+			}
 			if (option_debug &gt; 1 || sipdebug) {
 				ast_log(LOG_DEBUG, &quot;Call %s %s '%s' removed from call limit %d\n&quot;, outgoing ? &quot;to&quot; : &quot;from&quot;, u ? &quot;user&quot;:&quot;peer&quot;, name, *call_limit);
 			}
 			break;
+		case INC_CALL_RINGING:
 		case INC_CALL_LIMIT:
 			if (*call_limit &gt; 0 ) {
 				if (*inuse &gt;= *call_limit) {
@@ -2628,15 +2643,35 @@
 					return -1; 
 				}
 			}
+			if (inringing &amp;&amp; (event == INC_CALL_RINGING)) {
+				if (!ast_test_flag(&amp;fup-&gt;flags[1], SIP_PAGE2_INC_RINGING)) {
+					(*inringing)++;
+					ast_set_flag(&amp;fup-&gt;flags[1], SIP_PAGE2_INC_RINGING);
+				}
+			}
+			/* Continue */
 			(*inuse)++;
 			ast_set_flag(&amp;fup-&gt;flags[0], SIP_INC_COUNT);
 			if (option_debug &gt; 1 || sipdebug) {
 				ast_log(LOG_DEBUG, &quot;Call %s %s '%s' is %d out of %d\n&quot;, outgoing ? &quot;to&quot; : &quot;from&quot;, u ? &quot;user&quot;:&quot;peer&quot;, name, *inuse, *call_limit);
 			}
 			break;
+		case DEC_CALL_RINGING:
+			if (inringing) {
+				if (ast_test_flag(&amp;fup-&gt;flags[1], SIP_PAGE2_INC_RINGING)) {
+					if (*inringing &gt; 0)
+						(*inringing)--;
+					else
+						ast_log(LOG_WARNING, &quot;Inringing for peer '%s' &lt; 0?\n&quot;, p-&gt;name);
+					ast_clear_flag(&amp;fup-&gt;flags[1], SIP_PAGE2_INC_RINGING);
+				}
+			}
+			break;
 		default:
 			ast_log(LOG_ERROR, &quot;update_call_counter(%s, %d) called with no event!\n&quot;, name, event);
 	}
+	if (p)
+		ast_device_state_changed(&quot;SIP/%s&quot;, p-&gt;name);
 	if (u)
 		ASTOBJ_UNREF(u, sip_destroy_user);
 	else
@@ -2865,13 +2900,18 @@
 				/* stop retransmitting an INVITE that has not received a response */
 				__sip_pretend_ack(p);
 
-				/* Send a new request: CANCEL */
-				transmit_request_with_auth(p, SIP_CANCEL, p-&gt;ocseq, XMIT_RELIABLE, FALSE);
-				/* Actually don't destroy us yet, wait for the 487 on our original 
-				   INVITE, but do set an autodestruct just in case we never get it. */
-				ast_clear_flag(&amp;locflags, SIP_NEEDDESTROY);
+				/* if we can't send right now, mark it pending */
+				if (!ast_test_flag(&amp;p-&gt;flags[0], SIP_CAN_BYE)) {
+					ast_set_flag(&amp;p-&gt;flags[0], SIP_PENDINGBYE);
+				} else {
+					/* Send a new request: CANCEL */
+					transmit_request_with_auth(p, SIP_CANCEL, p-&gt;ocseq, XMIT_RELIABLE, FALSE);
+					/* Actually don't destroy us yet, wait for the 487 on our original 
+					   INVITE, but do set an autodestruct just in case we never get it. */
+					ast_clear_flag(&amp;locflags, SIP_NEEDDESTROY);
 
-				sip_scheddestroy(p, SIP_TRANS_TIMEOUT);
+					sip_scheddestroy(p, SIP_TRANS_TIMEOUT);
+				}
 				if ( p-&gt;initid != -1 ) {
 					/* channel still up - reverse dec of inUse counter
 					   only if the channel is not auto-congested */
@@ -2967,8 +3007,8 @@
 					transmit_response_with_sdp(p, &quot;183 Session Progress&quot;, &amp;p-&gt;initreq, XMIT_UNRELIABLE);
 					ast_set_flag(&amp;p-&gt;flags[0], SIP_PROGRESS_SENT);	
 				}
-				time(&amp;p-&gt;lastrtptx);
-				res =  ast_rtp_write(p-&gt;rtp, frame);
+				p-&gt;lastrtptx = time(NULL);
+				res = ast_rtp_write(p-&gt;rtp, frame);
 			}
 			ast_mutex_unlock(&amp;p-&gt;lock);
 		}
@@ -2984,8 +3024,8 @@
 					transmit_response_with_sdp(p, &quot;183 Session Progress&quot;, &amp;p-&gt;initreq, XMIT_UNRELIABLE);
 					ast_set_flag(&amp;p-&gt;flags[0], SIP_PROGRESS_SENT);	
 				}
-				time(&amp;p-&gt;lastrtptx);
-				res =  ast_rtp_write(p-&gt;vrtp, frame);
+				p-&gt;lastrtptx = time(NULL);
+				res = ast_rtp_write(p-&gt;vrtp, frame);
 			}
 			ast_mutex_unlock(&amp;p-&gt;lock);
 		}
@@ -3330,20 +3370,20 @@
 		char * const fullname;
 		char * const shortname;
 	} aliases[] = {
-		{ &quot;Content-Type&quot;, &quot;c&quot; },
-		{ &quot;Content-Encoding&quot;, &quot;e&quot; },
-		{ &quot;From&quot;, &quot;f&quot; },
-		{ &quot;Call-ID&quot;, &quot;i&quot; },
-		{ &quot;Contact&quot;, &quot;m&quot; },
-		{ &quot;Content-Length&quot;, &quot;l&quot; },
-		{ &quot;Subject&quot;, &quot;s&quot; },
-		{ &quot;To&quot;, &quot;t&quot; },
-		{ &quot;Supported&quot;, &quot;k&quot; },
-		{ &quot;Refer-To&quot;, &quot;r&quot; },
-		{ &quot;Referred-By&quot;, &quot;b&quot; },
-		{ &quot;Allow-Events&quot;, &quot;u&quot; },
-		{ &quot;Event&quot;, &quot;o&quot; },
-		{ &quot;Via&quot;, &quot;v&quot; },
+		{ &quot;Content-Type&quot;,	 &quot;c&quot; },
+		{ &quot;Content-Encoding&quot;,	 &quot;e&quot; },
+		{ &quot;From&quot;,		 &quot;f&quot; },
+		{ &quot;Call-ID&quot;,		 &quot;i&quot; },
+		{ &quot;Contact&quot;,		 &quot;m&quot; },
+		{ &quot;Content-Length&quot;,	 &quot;l&quot; },
+		{ &quot;Subject&quot;,		 &quot;s&quot; },
+		{ &quot;To&quot;,			 &quot;t&quot; },
+		{ &quot;Supported&quot;,		 &quot;k&quot; },
+		{ &quot;Refer-To&quot;,		 &quot;r&quot; },
+		{ &quot;Referred-By&quot;,	 &quot;b&quot; },
+		{ &quot;Allow-Events&quot;,	 &quot;u&quot; },
+		{ &quot;Event&quot;,		 &quot;o&quot; },
+		{ &quot;Via&quot;,		 &quot;v&quot; },
 		{ &quot;Accept-Contact&quot;,      &quot;a&quot; },
 		{ &quot;Reject-Contact&quot;,      &quot;j&quot; },
 		{ &quot;Request-Disposition&quot;, &quot;d&quot; },
@@ -3460,7 +3500,7 @@
 
 	ast_mutex_lock(&amp;p-&gt;lock);
 	fr = sip_rtp_read(ast, p);
-	time(&amp;p-&gt;lastrtprx);
+	p-&gt;lastrtprx = time(NULL);
 	ast_mutex_unlock(&amp;p-&gt;lock);
 	return fr;
 }
@@ -3976,8 +4016,7 @@
 	}
 
 	/* Update our last rtprx when we receive an SDP, too */
-	time(&amp;p-&gt;lastrtprx);
-	time(&amp;p-&gt;lastrtptx);
+	p-&gt;lastrtprx = p-&gt;lastrtptx = time(NULL); /* XXX why both ? */
 
 	m = get_sdp(req, &quot;m&quot;);
 	destiterator = req-&gt;sdp_start;
@@ -4282,7 +4321,7 @@
 }
 
 /*! \brief Copy one header field from one request to another */
-static int copy_header(struct sip_request *req, struct sip_request *orig, char *field)
+static int copy_header(struct sip_request *req, const struct sip_request *orig, const char *field)
 {
 	const char *tmp = get_header(orig, field);
 
@@ -4293,7 +4332,7 @@
 }
 
 /*! \brief Copy all headers from one request to another */
-static int copy_all_header(struct sip_request *req, struct sip_request *orig, char *field)
+static int copy_all_header(struct sip_request *req, const struct sip_request *orig, const char *field)
 {
 	int start = 0;
 	int copied = 0;
@@ -4315,7 +4354,7 @@
 	add the port number (from our point of view) to that parameter.
 	We always add ;received=&lt;ip address&gt; to the topmost via header.
 	Received: RFC 3261, rport RFC 3581 */
-static int copy_via_headers(struct sip_pvt *p, struct sip_request *req, struct sip_request *orig, char *field)
+static int copy_via_headers(struct sip_pvt *p, struct sip_request *req, const struct sip_request *orig, const char *field)
 {
 	int copied = 0;
 	int start = 0;
@@ -4497,7 +4536,7 @@
 
 
 /*! \brief Prepare SIP response packet */
-static int respprep(struct sip_request *resp, struct sip_pvt *p, const char *msg, struct sip_request *req)
+static int respprep(struct sip_request *resp, struct sip_pvt *p, const char *msg, const struct sip_request *req)
 {
 	char newto[256];
 	const char *ot;
@@ -4551,7 +4590,6 @@
 	char tmp[80];
 	char newto[256];
 	const char *c;
-	char *n;
 	const char *ot, *of;
 	int is_strict = FALSE;		/*!&lt; Strict routing flag */
 
@@ -4590,13 +4628,12 @@
 	} else if (!ast_strlen_zero(p-&gt;uri)) {
 		c = p-&gt;uri;
 	} else {
+		char *n;
 		/* We have no URI, use To: or From:  header as URI (depending on direction) */
 		ast_copy_string(stripped, get_header(orig, (ast_test_flag(&amp;p-&gt;flags[0], SIP_OUTGOING)) ? &quot;To&quot; : &quot;From&quot;),
 				sizeof(stripped));
-		c = get_in_brackets(stripped);
-		n = strchr(c, ';');
-		if (n)
-			*n = '\0';
+		n = get_in_brackets(stripped);
+		c = strsep(&amp;n, &quot;;&quot;);	/* trim ; and beyond */
 	}	
 	init_req(req, sipmethod, c);
 
@@ -4646,7 +4683,7 @@
 }
 
 /*! \brief Base transmit response function */
-static int __transmit_response(struct sip_pvt *p, const char *msg, struct sip_request *req, enum xmittype reliable)
+static int __transmit_response(struct sip_pvt *p, const char *msg, const struct sip_request *req, enum xmittype reliable)
 {
 	struct sip_request resp;
 	int seqno = 0;
@@ -4670,13 +4707,13 @@
 }
 
 /*! \brief Transmit response, no retransmits */
-static int transmit_response(struct sip_pvt *p, char *msg, struct sip_request *req) 
+static int transmit_response(struct sip_pvt *p, const char *msg, const struct sip_request *req) 
 {
 	return __transmit_response(p, msg, req, XMIT_UNRELIABLE);
 }
 
 /*! \brief Transmit response, no retransmits */
-static int transmit_response_with_unsupported(struct sip_pvt *p, const char *msg, struct sip_request *req, const char *unsupported) 
+static int transmit_response_with_unsupported(struct sip_pvt *p, const char *msg, const struct sip_request *req, const char *unsupported) 
 {
 	struct sip_request resp;
 	respprep(&amp;resp, p, msg, req);
@@ -4688,7 +4725,7 @@
 /*! \brief Transmit response, Make sure you get an ACK
 	This is only used for responses to INVITEs, where we need to make sure we get an ACK
 */
-static int transmit_response_reliable(struct sip_pvt *p, const char *msg, struct sip_request *req)
+static int transmit_response_reliable(struct sip_pvt *p, const char *msg, const struct sip_request *req)
 {
 	return __transmit_response(p, msg, req, XMIT_CRITICAL);
 }
@@ -4706,7 +4743,7 @@
 }
 
 /*! \brief Append date and content length before transmitting response */
-static int transmit_response_with_date(struct sip_pvt *p, char *msg, struct sip_request *req)
+static int transmit_response_with_date(struct sip_pvt *p, const char *msg, const struct sip_request *req)
 {
 	struct sip_request resp;
 	respprep(&amp;resp, p, msg, req);
@@ -4716,7 +4753,7 @@
 }
 
 /*! \brief Append Accept header, content length before transmitting response */
-static int transmit_response_with_allow(struct sip_pvt *p, char *msg, struct sip_request *req, enum xmittype reliable)
+static int transmit_response_with_allow(struct sip_pvt *p, const char *msg, const struct sip_request *req, enum xmittype reliable)
 {
 	struct sip_request resp;
 	respprep(&amp;resp, p, msg, req);
@@ -4726,7 +4763,7 @@
 }
 
 /*! \brief Respond with authorization request */
-static int transmit_response_with_auth(struct sip_pvt *p, const char *msg, struct sip_request *req, const char *randdata, enum xmittype reliable, const char *header, int stale)
+static int transmit_response_with_auth(struct sip_pvt *p, const char *msg, const struct sip_request *req, const char *randdata, enum xmittype reliable, const char *header, int stale)
 {
 	struct sip_request resp;
 	char tmp[256];
@@ -5036,14 +5073,13 @@
 	}
 
 	/* Update lastrtprx when we send our SDP */
-	time(&amp;p-&gt;lastrtprx);
-	time(&amp;p-&gt;lastrtptx);
+	p-&gt;lastrtprx = p-&gt;lastrtptx = time(NULL); /* XXX why both ? */
 
 	return 0;
 }
 
 /*! \brief copy SIP request (mostly used to save request for responses) */
-static void copy_request(struct sip_request *dst, struct sip_request *src)
+static void copy_request(struct sip_request *dst, const struct sip_request *src)
 {
 	long offset;
 	int x;
@@ -5058,7 +5094,7 @@
 }
 
 /*! \brief Used for 200 OK and 183 early media */
-static int transmit_response_with_sdp(struct sip_pvt *p, char *msg, struct sip_request *req, enum xmittype reliable)
+static int transmit_response_with_sdp(struct sip_pvt *p, const char *msg, const struct sip_request *req, enum xmittype reliable)
 {
 	struct sip_request resp;
 	int seqno;
@@ -5147,13 +5183,11 @@
 static void extract_uri(struct sip_pvt *p, struct sip_request *req)
 {
 	char stripped[256];
-	char *c, *n;
+	char *c;
 
 	ast_copy_string(stripped, get_header(req, &quot;Contact&quot;), sizeof(stripped));
 	c = get_in_brackets(stripped);
-	n = strchr(c, ';');
-	if (n)
-		*n = '\0';
+	c = strsep(&amp;c, &quot;;&quot;);	/* trim ; and beyond */
 	if (!ast_strlen_zero(c))
 		ast_string_field_set(p, uri, c);
 }
@@ -5490,7 +5524,7 @@
 static int transmit_state_notify(struct sip_pvt *p, int state, int full)
 {
 	char tmp[4000], from[256], to[256];
-	char *t = tmp, *c, *a, *mfrom, *mto;
+	char *t = tmp, *c, *mfrom, *mto;
 	size_t maxbytes = sizeof(tmp);
 	struct sip_request req;
 	char hint[AST_MAX_EXTENSION];
@@ -5559,9 +5593,7 @@
 		ast_log(LOG_WARNING, &quot;Huh?  Not a SIP header (%s)?\n&quot;, c);
 		return -1;
 	}
-	if ((a = strchr(c, ';')))
-		*a = '\0';
-	mfrom = c;
+	mfrom = strsep(&amp;c, &quot;;&quot;);	/* trim ; and beyond */
 
 	ast_copy_string(to, get_header(&amp;p-&gt;initreq, &quot;To&quot;), sizeof(to));
 	c = get_in_brackets(to);
@@ -5569,9 +5601,7 @@
 		ast_log(LOG_WARNING, &quot;Huh?  Not a SIP header (%s)?\n&quot;, c);
 		return -1;
 	}
-	if ((a = strchr(c, ';')))
-		*a = '\0';
-	mto = c;
+	mto = strsep(&amp;c, &quot;;&quot;);	/* trim ; and beyond */
 
 	reqprep(&amp;req, p, SIP_NOTIFY, 0, 1);
 
@@ -5822,7 +5852,7 @@
 }
 
 /*! \brief Transmit register to SIP proxy or UA */
-static int transmit_register(struct sip_registry *r, int sipmethod, char *auth, char *authheader)
+static int transmit_register(struct sip_registry *r, int sipmethod, const char *auth, const char *authheader)
 {
 	struct sip_request req;
 	char from[256];
@@ -6312,9 +6342,7 @@
 
 	/* Ditch arguments */
 	/* XXX this code is replicated also shortly below */
-	host = strchr(contact, ';');
-	if (host) 
-		*host = '\0';
+	contact = strsep(&amp;contact, &quot;;&quot;);	/* trim ; and beyond */
 
 	/* Grab host */
 	host = strchr(contact, '@');
@@ -6370,9 +6398,8 @@
 	if (ast_strlen_zero(expires)) {	/* No expires header */
 		expires = strcasestr(get_header(req, &quot;Contact&quot;), &quot;;expires=&quot;);
 		if (expires) {
-			char *ptr;
-			if ((ptr = strchr(expires, ';')))
-				*ptr = '\0';
+			/* XXX bug here, we overwrite the string */
+			expires = strsep((char **)&amp;expires, &quot;;&quot;); /* trim ; and beyond */
 			if (sscanf(expires + 9, &quot;%d&quot;, &amp;expiry) != 1)
 				expiry = default_expiry;
 		} else {
@@ -6382,11 +6409,9 @@
 	}
 	/* Look for brackets */
 	ast_copy_string(contact, get_header(req, &quot;Contact&quot;), sizeof(contact));
-	if (strchr(contact, '&lt;') == NULL) {	/* No &lt;, check for ; and strip it */
-		char *ptr = strchr(contact, ';');	/* This is Header options, not URI options */
-		if (ptr)
-			*ptr = '\0';
-	}
+	c = contact;
+	if (strchr(contact, '&lt;') == NULL)	/* No &lt;, check for ; and strip it */
+		strsep(&amp;c, &quot;;&quot;);	/* This is Header options, not URI options */
 	c = get_in_brackets(contact);
 
 	/* if they did not specify Contact: or Expires:, they are querying
@@ -6427,10 +6452,7 @@
 	} else
 		c += 4;
 	/* Ditch q */
-	n = strchr(c, ';');
-	if (n) {
-		*n = '\0';
-	}
+	c = strsep(&amp;c, &quot;;&quot;);
 	/* Grab host */
 	n = strchr(c, '@');
 	if (!n) {
@@ -6629,12 +6651,11 @@
 /*! \brief  Check user authorization from peer definition 
 	Some actions, like REGISTER and INVITEs from peers require
 	authentication (if peer have secret set) 
-	\return -1 on Error, 0 on success, 1 on challenge sent
-	
+    \return 0 on success, non-zero on error
 */
-static int check_auth(struct sip_pvt *p, struct sip_request *req, const char *username,
-		      const char *secret, const char *md5secret, int sipmethod,
-		      char *uri, enum xmittype reliable, int ignore)
+static enum check_auth_result check_auth(struct sip_pvt *p, struct sip_request *req, const char *username,
+					 const char *secret, const char *md5secret, int sipmethod,
+					 char *uri, enum xmittype reliable, int ignore)
 {
 	const char *response = &quot;407 Proxy Authentication Required&quot;;
 	const char *reqheader = &quot;Proxy-Authorization&quot;;
@@ -6643,7 +6664,7 @@
 
 	/* Always OK if no secret */
 	if (ast_strlen_zero(secret) &amp;&amp; ast_strlen_zero(md5secret))
-		return 0;
+		return AUTH_SUCCESSFUL;
 	if (sipmethod == SIP_REGISTER || sipmethod == SIP_SUBSCRIBE) {
 		/* On a REGISTER, we have to use 401 and its family of headers instead of 407 and its family
 		   of headers -- GO SIP!  Whoo hoo!  Two things that do the same thing but are used in
@@ -6663,14 +6684,14 @@
 			/* Schedule auto destroy in 32 seconds (according to RFC 3261) */
 			sip_scheddestroy(p, SIP_TRANS_TIMEOUT);
 		}
-		return 1;	/* Auth sent */
+		return AUTH_CHALLENGE_SENT;
 	} else if (ast_strlen_zero(p-&gt;randdata) || ast_strlen_zero(authtoken)) {
 		/* We have no auth, so issue challenge and request authentication */
 		ast_string_field_build(p, randdata, &quot;%08lx&quot;, ast_random());	/* Create nonce for challenge */
 		transmit_response_with_auth(p, response, req, p-&gt;randdata, reliable, respheader, 0);
 		/* Schedule auto destroy in 32 seconds */
 		sip_scheddestroy(p, SIP_TRANS_TIMEOUT);
-		return 1;	/* Auth sent */
+		return AUTH_CHALLENGE_SENT;
 	} else {	/* We have auth, so check it */
 		/* Whoever came up with the authentication section of SIP can suck my %&amp;#$&amp;* for not putting
 	   	an example in the spec of just what it is you're doing a hash on. */
@@ -6723,7 +6744,7 @@
 			ast_log(LOG_WARNING, &quot;username mismatch, have &lt;%s&gt;, digest has &lt;%s&gt;\n&quot;,
 				username, keys[K_USER].s);
 			/* Oops, we're trying something here */
-			return -2;
+			return AUTH_USERNAME_MISMATCH;
 		}
 
 		/* Verify nonce from request matches our nonce.  If not, send 401 with new nonce */
@@ -6771,18 +6792,16 @@
 
 			/* Schedule auto destroy in 32 seconds */
 			sip_scheddestroy(p, SIP_TRANS_TIMEOUT);
-			return 1;	/* XXX should it be -1 ? */
+			return AUTH_CHALLENGE_SENT;
 		} 
-		if (good_response) /* Auth is OK */
-			return 0;
+		if (good_response)
+			return AUTH_SUCCESSFUL;
 
-		/* XXX is this needed ? */
 		/* Ok, we have a bad username/secret pair */
 		/* Challenge again, and again, and again */
 		transmit_response_with_auth(p, response, req, p-&gt;randdata, reliable, respheader, 0);
 		sip_scheddestroy(p, SIP_TRANS_TIMEOUT);
-		return 1;		/* Challenge sent */
-
+		return AUTH_CHALLENGE_SENT;
 	}
 }
 
@@ -6815,10 +6834,20 @@
 	return 0;
 }
 
+/*! \brief Send a fake 401 Unauthorized response when the administrator
+  wants to hide the names of local users/peers from fishers
+ */
+static void transmit_fake_auth_response(struct sip_pvt *p, struct sip_request *req, int reliable)
+{
+	ast_string_field_build(p, randdata, &quot;%08lx&quot;, ast_random());	/* Create nonce for challenge */
+	transmit_response_with_auth(p, &quot;401 Unauthorized&quot;, req, p-&gt;randdata, reliable, &quot;WWW-Authenticate&quot;, 0);
+}
+
 /*! \brief Verify registration of user */
-static int register_verify(struct sip_pvt *p, struct sockaddr_in *sin, struct sip_request *req, char *uri)
+static enum check_auth_result register_verify(struct sip_pvt *p, struct sockaddr_in *sin,
+					      struct sip_request *req, char *uri)
 {
-	int res = -3;
+	enum check_auth_result res = AUTH_NOT_FOUND;
 	struct sip_peer *peer;
 	char tmp[256];
 	char iabuf[INET_ADDRSTRLEN];
@@ -6837,10 +6866,7 @@
 		ast_uri_decode(tmp);
 
 	c = get_in_brackets(tmp);
-	/* Ditch ;user=phone */
-	name = strchr(c, ';');
-	if (name)
-		*name = '\0';
+	c = strsep(&amp;c, &quot;;&quot;);	/* Ditch ;user=phone */
 
 	if (!strncmp(c, &quot;sip:&quot;, 4)) {
 		name = c + 4;
@@ -6858,7 +6884,7 @@
 		if (!AST_LIST_EMPTY(&amp;domain_list)) {
 			if (!check_sip_domain(domain, NULL, 0)) {
 				transmit_response(p, &quot;404 Not found (unknown domain)&quot;, &amp;p-&gt;initreq);
-				return -3;
+				return AUTH_UNKNOWN_DOMAIN;
 			}
 		}
 	}
@@ -6935,28 +6961,46 @@
 	}
 	if (res &lt; 0) {
 		switch (res) {
-		case -1:
+		case AUTH_SECRET_FAILED:
 			/* Wrong password in authentication. Go away, don't try again until you fixed it */
 			transmit_response(p, &quot;403 Forbidden (Bad auth)&quot;, &amp;p-&gt;initreq);
 			break;
-		case -2:
+		case AUTH_USERNAME_MISMATCH:
 			/* Username and digest username does not match. 
 			   Asterisk uses the From: username for authentication. We need the
 			   users to use the same authentication user name until we support
 			   proper authentication by digest auth name */
 			transmit_response(p, &quot;403 Authentication user name does not match account name&quot;, &amp;p-&gt;initreq);
 			break;
-		case -3:
-			/* URI not found */
-			transmit_response(p, &quot;404 Not found&quot;, &amp;p-&gt;initreq);
-			/* Set res back to -2 because we don't want to return an invalid domain message. That check already happened up above. */
-			res = -2;
+		case AUTH_NOT_FOUND:
+			if (global_alwaysauthreject) {
+				transmit_fake_auth_response(p, &amp;p-&gt;initreq, 1);
+			} else {
+				/* URI not found */
+				transmit_response(p, &quot;404 Not found&quot;, &amp;p-&gt;initreq);
+			}
 			break;
+		default:
+			break;
 		}
 		if (option_debug &gt; 1) {
+			const char *reason = &quot;&quot;;
+
+			switch (res) {
+			case AUTH_SECRET_FAILED:
+				reason = &quot;Bad password&quot;;
+				break;
+			case AUTH_USERNAME_MISMATCH:
+				reason = &quot;Bad digest user&quot;;
+				break;
+			case AUTH_NOT_FOUND:
+				reason = &quot;Peer not found&quot;;
+				break;
+			default:
+				break;
+			}
 			ast_log(LOG_DEBUG, &quot;SIP REGISTER attempt failed for %s : %s\n&quot;,
-				peer-&gt;name,
-				(res == -1) ? &quot;Bad password&quot; : ((res == -2 ) ? &quot;Bad digest user&quot; : &quot;Peer not found&quot;));
+				peer-&gt;name, reason);
 		}
 	}
 	if (peer)
@@ -7036,8 +7080,7 @@
 			return -1;
 		}
 		from += 4;
-		if ((a = strchr(from, ';')))
-			*a = '\0';
+		from = strsep(&amp;from, &quot;;&quot;);
 		if ((a = strchr(from, '@'))) {
 			*a = '\0';
 			ast_string_field_set(p, fromdomain, a + 1);
@@ -7046,8 +7089,7 @@
 	}
 
 	/* Skip any options and find the domain */
-	if ((a = strchr(uri, ';')))
-		*a = '\0';
+	uri = strsep(&amp;uri, &quot;;&quot;);
 
 	/* Get the target domain */
 	if ((a = strchr(uri, '@'))) {
@@ -7108,10 +7150,10 @@
 	- This means that in some transactions, totag needs to be their tag :-)
 	  depending upon the direction
 */
-static struct sip_pvt *get_sip_pvt_byid_locked(char *callid, char *totag, char *fromtag) 
+static struct sip_pvt *get_sip_pvt_byid_locked(const char *callid, const char *totag, const char *fromtag) 
 {
-	struct sip_pvt *sip_pvt_ptr = NULL;
-	
+	struct sip_pvt *sip_pvt_ptr;
+
 	/* Search interfaces and find the match */
 	ast_mutex_lock(&amp;iflock);
 
@@ -7139,16 +7181,15 @@
 			}
 
 			if (option_debug &gt; 3 &amp;&amp; totag)				 
-				ast_log(LOG_DEBUG, &quot;Matched %s call - their tag is %s Our tag is %s\n&quot;, ast_test_flag(&amp;sip_pvt_ptr-&gt;flags[0], SIP_OUTGOING) ? &quot;OUTGOING&quot;: &quot;INCOMING&quot;, sip_pvt_ptr-&gt;theirtag, sip_pvt_ptr-&gt;tag);
+				ast_log(LOG_DEBUG, &quot;Matched %s call - their tag is %s Our tag is %s\n&quot;,
+					ast_test_flag(&amp;sip_pvt_ptr-&gt;flags[0], SIP_OUTGOING) ? &quot;OUTGOING&quot;: &quot;INCOMING&quot;,
+					sip_pvt_ptr-&gt;theirtag, sip_pvt_ptr-&gt;tag);
 
-			if (sip_pvt_ptr-&gt;owner) {
-				while(ast_channel_trylock(sip_pvt_ptr-&gt;owner)) {
-					ast_mutex_unlock(&amp;sip_pvt_ptr-&gt;lock);
-					usleep(1);
-					ast_mutex_lock(&amp;sip_pvt_ptr-&gt;lock);
-					if (!sip_pvt_ptr-&gt;owner)
-						break;
-				}
+			/* deadlock avoidance... */
+			while (sip_pvt_ptr-&gt;owner &amp;&amp; ast_mutex_trylock(&amp;sip_pvt_ptr-&gt;owner-&gt;lock)) {
+				ast_mutex_unlock(&amp;sip_pvt_ptr-&gt;lock);
+				usleep(1);
+				ast_mutex_lock(&amp;sip_pvt_ptr-&gt;lock);
 			}
 			break;
 		}
@@ -7455,10 +7496,11 @@
 /*! \brief  Check if matching user or peer is defined 
  	Match user on From: user name and peer on IP/port
 	This is used on first invite (not re-invites) and subscribe requests 
-	\return 0 on success, -1 on failure, and 1 on challenge sent
-	-2 on authentication error from chedck_auth()
+    \return 0 on success, non-zero on failure
 */
-static int check_user_full(struct sip_pvt *p, struct sip_request *req, int sipmethod, char *uri, enum xmittype reliable, struct sockaddr_in *sin, struct sip_peer **authpeer)
+static enum check_auth_result check_user_full(struct sip_pvt *p, struct sip_request *req,
+					      int sipmethod, char *uri, enum xmittype reliable,
+					      struct sockaddr_in *sin, struct sip_peer **authpeer)
 {
 	struct sip_user *user = NULL;
 	struct sip_peer *peer;
@@ -7467,7 +7509,7 @@
 	char rpid_num[50];
 	const char *rpid;
 	char iabuf[INET_ADDRSTRLEN];
-	int res = 0;
+	enum check_auth_result res = AUTH_SUCCESSFUL;
 	char *t;
 	char calleridname[50];
 	int debug=sip_debug_test_addr(sin);
@@ -7523,7 +7565,7 @@
 		ast_string_field_set(p, cid_num, tmp);
 	}
 	if (ast_strlen_zero(of))
-		return 0;
+		return AUTH_SUCCESSFUL;
 
 	if (!authpeer)	/* If we are looking for a peer, don't check the user objects (or realtime) */
 		user = find_user(of, 1);
@@ -7550,7 +7592,6 @@
 				ast_shrink_phone_number(tmp);
 			ast_string_field_set(p, cid_num, tmp);
 		}
-
 		
 		usenatroute = ast_test_flag(&amp;p-&gt;flags[0], SIP_NAT_ROUTE);
 
@@ -7586,6 +7627,7 @@
 			if (!ast_strlen_zero(user-&gt;cid_name) &amp;&amp; !ast_strlen_zero(p-&gt;cid_num))
 				ast_string_field_set(p, cid_name, user-&gt;cid_name);
 			ast_string_field_set(p, username, user-&gt;name);
+			ast_string_field_set(p, peername, user-&gt;name);
 			ast_string_field_set(p, peersecret, user-&gt;secret);
 			ast_string_field_set(p, peermd5secret, user-&gt;md5secret);
 			ast_string_field_set(p, subscribecontext, user-&gt;subscribecontext);
@@ -7742,8 +7784,12 @@
 				ast_verbose(&quot;Found no matching peer or user for '%s:%d'\n&quot;, ast_inet_ntoa(iabuf, sizeof(iabuf), p-&gt;recv.sin_addr), ntohs(p-&gt;recv.sin_port));
 
 			/* do we allow guests? */
-			if (!global_allowguest)
-				res = -1;  /* we don't want any guests, authentication will fail */
+			if (!global_allowguest) {
+				if (global_alwaysauthreject)
+					res = AUTH_FAKE_AUTH; /* reject with fake authorization request */
+				else
+					res = AUTH_SECRET_FAILED; /* we don't want any guests, authentication will fail */
+			}
 		}
 
 	}
@@ -7859,7 +7905,7 @@
 			snprintf(ilimits, sizeof(ilimits), &quot;%d&quot;, iterator-&gt;call_limit);
 		else 
 			ast_copy_string(ilimits, &quot;N/A&quot;, sizeof(ilimits));
-		snprintf(iused, sizeof(iused), &quot;%d&quot;, iterator-&gt;inUse);
+		snprintf(iused, sizeof(iused), &quot;%d/%d&quot;, iterator-&gt;inUse, iterator-&gt;inRinging);
 		if (showall || iterator-&gt;call_limit)
 			ast_cli(fd, FORMAT2, iterator-&gt;name, iused, ilimits);
 		ASTOBJ_UNLOCK(iterator);
@@ -8789,6 +8835,7 @@
 	ast_cli(fd, &quot;  URI user is phone no:   %s\n&quot;, ast_test_flag(&amp;global_flags[0], SIP_USEREQPHONE) ? &quot;Yes&quot; : &quot;No&quot;);
 	ast_cli(fd, &quot;  Our auth realm          %s\n&quot;, global_realm);
 	ast_cli(fd, &quot;  Realm. auth:            %s\n&quot;, authl ? &quot;Yes&quot;: &quot;No&quot;);
+ 	ast_cli(fd, &quot;  Always auth rejects:    %s\n&quot;, global_alwaysauthreject ? &quot;Yes&quot; : &quot;No&quot;);
 	ast_cli(fd, &quot;  User Agent:             %s\n&quot;, global_useragent);
 	ast_cli(fd, &quot;  MWI checking interval:  %d secs\n&quot;, global_mwitime);
 	ast_cli(fd, &quot;  Reg. context:           %s\n&quot;, S_OR(global_regcontext, &quot;(not set)&quot;));
@@ -9362,19 +9409,16 @@
 	if (argc != 2) {
 		if (argc != 4) 
 			return RESULT_SHOWUSAGE;
-		else if (strncmp(argv[2], &quot;ip&quot;, 3) == 0)
+		else if (strcmp(argv[2], &quot;ip&quot;) == 0)
 			return sip_do_debug_ip(fd, argc, argv);
-		else if (strncmp(argv[2], &quot;peer&quot;, 5) == 0)
+		else if (strcmp(argv[2], &quot;peer&quot;) == 0)
 			return sip_do_debug_peer(fd, argc, argv);
 		else
 			return RESULT_SHOWUSAGE;
 	}
 	ast_set_flag(&amp;global_flags[1], SIP_PAGE2_DEBUG_CONSOLE);
 	memset(&amp;debugaddr, 0, sizeof(debugaddr));
-	if (oldsipdebug)
-		ast_cli(fd, &quot;SIP Debugging re-enabled\n&quot;);
-	else
-		ast_cli(fd, &quot;SIP Debugging enabled\n&quot;);
+	ast_cli(fd, &quot;SIP Debugging %senabled\n&quot;, oldsipdebug ? &quot;re-&quot; : &quot;&quot;);
 	return RESULT_SUCCESS;
 }
 
@@ -9989,9 +10033,7 @@
 
 	ast_copy_string(tmp, get_header(req, &quot;Contact&quot;), sizeof(tmp));
 	s = get_in_brackets(tmp);
-	e = strchr(s, ';');
-	if (e)
-		*e = '\0';
+	s = strsep(&amp;s, &quot;;&quot;);	/* strip ; and beyond */
 	if (ast_test_flag(&amp;p-&gt;flags[0], SIP_PROMISCREDIR)) {
 		if (!strncasecmp(s, &quot;sip:&quot;, 4))
 			s += 4;
@@ -10028,13 +10070,18 @@
 /*! \brief Check pending actions on SIP call */
 static void check_pendings(struct sip_pvt *p)
 {
-	/* Go ahead and send bye at this point */
 	if (ast_test_flag(&amp;p-&gt;flags[0], SIP_PENDINGBYE)) {
-		if (option_debug)
-			ast_log(LOG_DEBUG, &quot;Sending pending bye on '%s'\n&quot;, p-&gt;callid);
-		transmit_request_with_auth(p, SIP_BYE, 0, XMIT_RELIABLE, TRUE);
-		ast_set_flag(&amp;p-&gt;flags[0], SIP_NEEDDESTROY);	
-		ast_clear_flag(&amp;p-&gt;flags[0], SIP_NEEDREINVITE);	
+		/* if we can't BYE, then this is really a pending CANCEL */
+		if (!ast_test_flag(&amp;p-&gt;flags[0], SIP_CAN_BYE)) {
+			transmit_request_with_auth(p, SIP_CANCEL, p-&gt;ocseq, 1, 0);
+			/* Actually don't destroy us yet, wait for the 487 on our original 
+			   INVITE, but do set an autodestruct just in case we never get it. */
+			sip_scheddestroy(p, SIP_TRANS_TIMEOUT);
+		} else {
+			transmit_request_with_auth(p, SIP_BYE, 0, 1, 1);
+			ast_set_flag(&amp;p-&gt;flags[0], SIP_NEEDDESTROY);	
+			ast_clear_flag(&amp;p-&gt;flags[0], SIP_NEEDREINVITE);	
+		}
 	} else if (ast_test_flag(&amp;p-&gt;flags[0], SIP_NEEDREINVITE)) {
 		if (option_debug)
 			ast_log(LOG_DEBUG, &quot;Sending pending reinvite on '%s'\n&quot;, p-&gt;callid);
@@ -10073,14 +10120,19 @@
 	case 100:	/* Trying */
 		if (!ast_test_flag(req, SIP_PKT_IGNORE))
 			sip_cancel_destroy(p);
+		/* must call check_pendings before setting CAN_BYE, so that
+		   if PENDINGBYE is set it will know to send CANCEL instead */
+		check_pendings(p);
+		ast_set_flag(&amp;p-&gt;flags[0], SIP_CAN_BYE);
 		break;
 	case 180:	/* 180 Ringing */
 		if (!ast_test_flag(req, SIP_PKT_IGNORE))
 			sip_cancel_destroy(p);
 		if (!ast_test_flag(req, SIP_PKT_IGNORE) &amp;&amp; p-&gt;owner) {
 			ast_queue_control(p-&gt;owner, AST_CONTROL_RINGING);
-			if (p-&gt;owner-&gt;_state != AST_STATE_UP)
+			if (p-&gt;owner-&gt;_state != AST_STATE_UP) {
 				ast_setstate(p-&gt;owner, AST_STATE_RINGING);
+			}
 		}
 		if (find_sdp(req)) {
 			process_sdp(p, req);
@@ -10089,6 +10141,10 @@
 				ast_queue_control(p-&gt;owner, AST_CONTROL_PROGRESS);
 			}
 		}
+		/* must call check_pendings before setting CAN_BYE, so that
+		   if PENDINGBYE is set it will know to send CANCEL instead */
+		check_pendings(p);
+		ast_set_flag(&amp;p-&gt;flags[0], SIP_CAN_BYE);
 		break;
 	case 183:	/* Session progress */
 		if (!ast_test_flag(req, SIP_PKT_IGNORE))
@@ -10101,6 +10157,10 @@
 				ast_queue_control(p-&gt;owner, AST_CONTROL_PROGRESS);
 			}
 		}
+		/* must call check_pendings before setting CAN_BYE, so that
+		   if PENDINGBYE is set it will know to send CANCEL instead */
+		check_pendings(p);
+		ast_set_flag(&amp;p-&gt;flags[0], SIP_CAN_BYE);
 		break;
 	case 200:	/* 200 OK on invite - someone's answering our call */
 		if (!ast_test_flag(req, SIP_PKT_IGNORE))
@@ -10113,6 +10173,7 @@
 		/* When we get 200 OK, we know which device (and IP) to contact for this call */
 		/* This is important when we have a SIP proxy between us and the phone */
 		if (outgoing) {
+			update_call_counter(p, DEC_CALL_RINGING);
 			parse_ok_contact(p, req);
 			if(set_address_from_contact(p)) {
 				/* Bad contact - we don't know how to reach this device */
@@ -10303,7 +10364,7 @@
 		}
 
 		r-&gt;regstate = REG_STATE_REGISTERED;
-		r-&gt;regtime=time(NULL);			/* Reset time of last succesful registration */
+		r-&gt;regtime = time(NULL);		/* Reset time of last succesful registration */
 		manager_event(EVENT_FLAG_SYSTEM, &quot;Registry&quot;, &quot;Channel: SIP\r\nDomain: %s\r\nStatus: %s\r\n&quot;, r-&gt;hostname, regstate2str(r-&gt;regstate));
 		r-&gt;regattempts = 0;
 		ast_log(LOG_DEBUG, &quot;Registration successful\n&quot;);
@@ -10986,7 +11047,7 @@
  * \return Returns the pointer to the provided tag buffer,
  *         or NULL if the tag was not found.
  */
-static const char *gettag(const struct sip_request *req, char *header, char *tagbuf, int tagbufsize) 
+static const char *gettag(const struct sip_request *req, const char *header, char *tagbuf, int tagbufsize) 
 {
 	const char *thetag;
 
@@ -10996,13 +11057,9 @@
 	thetag = get_header(req, header);
 	thetag = strcasestr(thetag, &quot;;tag=&quot;);
 	if (thetag) {
-		char *sep;
 		thetag += 5;
 		ast_copy_string(tagbuf, thetag, tagbufsize);
-		sep = strchr(tagbuf, ';');
-		if (sep)
-			*sep = '\0';
-		return tagbuf;
+		return strsep(&amp;tagbuf, &quot;;&quot;);
 	}
 	return NULL;
 }
@@ -11247,7 +11304,7 @@
 				ast_log(LOG_DEBUG, &quot;Hm....  No sdp for the moment\n&quot;);
 			}
 			if (recordhistory) /* This is a response, note what it was for */
-				append_history(p, &quot;%s&quot;, &quot;Re-invite received&quot;);
+				append_history(p, &quot;ReInv&quot;, &quot;Re-invite received&quot;);
 		}
 	} else if (debug)
 		ast_verbose(&quot;Ignoring this INVITE request\n&quot;);
@@ -11255,11 +11312,16 @@
 
 		/* Handle authentication if this is our first invite */
 		res = check_user(p, req, SIP_INVITE, e, XMIT_RELIABLE, sin);
-		if (res &gt; 0)	/* We have challenged the user for auth */
+		if (res == AUTH_CHALLENGE_SENT)
 			return 0; 
 		if (res &lt; 0) { /* Something failed in authentication */
-			ast_log(LOG_NOTICE, &quot;Failed to authenticate user %s\n&quot;, get_header(req, &quot;From&quot;));
-			transmit_response_reliable(p, &quot;403 Forbidden&quot;, req);
+			if (res == AUTH_FAKE_AUTH) {
+				ast_log(LOG_NOTICE, &quot;Sending fake auth rejection for user %s\n&quot;, get_header(req, &quot;From&quot;));
+				transmit_fake_auth_response(p, req, 1);
+			} else {
+  				ast_log(LOG_NOTICE, &quot;Failed to authenticate user %s\n&quot;, get_header(req, &quot;From&quot;));
+				transmit_response_reliable(p, &quot;403 Forbidden&quot;, req);
+  			}
 			ast_set_flag(&amp;p-&gt;flags[0], SIP_NEEDDESTROY);
 			ast_string_field_free(p, theirtag);
 			return 0;
@@ -11640,7 +11702,6 @@
 	struct sip_peer *authpeer = NULL;
 	const char *event = get_header(req, &quot;Event&quot;);	/* Get Event package name */
 	const char *accept = get_header(req, &quot;Accept&quot;);
-	char *eventparam;
 	int resubscribe = (p-&gt;subscribed != NONE);
 
 	if (p-&gt;initreq.headers) {	
@@ -11682,16 +11743,22 @@
 		ast_verbose(&quot;Ignoring this SUBSCRIBE request\n&quot;);
 
 	/* Find parameters to Event: header value and remove them for now */
-	if ((eventparam = strchr(event, ';')))
-		*eventparam++ = '\0';
+	event = strsep((char **)&amp;event, &quot;;&quot;);	/* XXX bug here, overwrite string */
 
 	/* Handle authentication if this is our first subscribe */
 	res = check_user_full(p, req, SIP_SUBSCRIBE, e, 0, sin, &amp;authpeer);
-	if (res) {
-		if (res &lt; 0) {
+	/* if an authentication response was sent, we are done here */
+	if (res == AUTH_CHALLENGE_SENT)
+		return 0;
+	if (res &lt; 0) {
+		if (res == AUTH_FAKE_AUTH) {
+			ast_log(LOG_NOTICE, &quot;Sending fake auth rejection for user %s\n&quot;, get_header(req, &quot;From&quot;));
+			transmit_fake_auth_response(p, req, 1);
+		} else {
 			ast_log(LOG_NOTICE, &quot;Failed to authenticate user %s for SUBSCRIBE\n&quot;, get_header(req, &quot;From&quot;));
-			ast_set_flag(&amp;p-&gt;flags[0], SIP_NEEDDESTROY);	
+			transmit_response_reliable(p, &quot;403 Forbidden&quot;, req);
 		}
+		ast_set_flag(&amp;p-&gt;flags[0], SIP_NEEDDESTROY);	
 		return 0;
 	}
 
@@ -11865,7 +11932,7 @@
 /*! \brief Handle incoming REGISTER request */
 static int handle_request_register(struct sip_pvt *p, struct sip_request *req, struct sockaddr_in *sin, char *e)
 {
-	int res = 0;
+	enum check_auth_result res;
 	char iabuf[INET_ADDRSTRLEN];
 
 	/* Use this as the basis */
@@ -11873,12 +11940,33 @@
 		ast_verbose(&quot;Using latest REGISTER request as basis request\n&quot;);
 	copy_request(&amp;p-&gt;initreq, req);
 	check_via(p, req);
-	if ((res = register_verify(p, sin, req, e)) &lt; 0) 
-		ast_log(LOG_NOTICE, &quot;Registration from '%s' failed for '%s' - %s\n&quot;, get_header(req, &quot;To&quot;), ast_inet_ntoa(iabuf, sizeof(iabuf), sin-&gt;sin_addr), (res == -1) ? &quot;Wrong password&quot; : (res == -2 ? &quot;Username/auth name mismatch&quot; : &quot;Not a local SIP domain&quot;));
+	if ((res = register_verify(p, sin, req, e)) &lt; 0) {
+		const char *reason = &quot;&quot;;
+
+		switch (res) {
+		case AUTH_SECRET_FAILED:
+			reason = &quot;Wrong password&quot;;
+			break;
+		case AUTH_USERNAME_MISMATCH:
+			reason = &quot;Username/auth name mismatch&quot;;
+			break;
+		case AUTH_NOT_FOUND:
+			reason = &quot;No matching peer found&quot;;
+			break;
+		case AUTH_UNKNOWN_DOMAIN:
+			reason = &quot;Not a local domain&quot;;
+			break;
+		default:
+			break;
+		}
+		ast_log(LOG_NOTICE, &quot;Registration from '%s' failed for '%s' - %s\n&quot;,
+			get_header(req, &quot;To&quot;), ast_inet_ntoa(iabuf, sizeof(iabuf), sin-&gt;sin_addr),
+			reason);
+	}
 	if (res &lt; 1) {
 		/* Destroy the session, but keep us around for just a bit in case they don't
 		   get our 200 OK */
-		sip_scheddestroy(p, 15*1000);
+		sip_scheddestroy(p, 15000);
 	}
 	return res;
 }
@@ -12107,6 +12195,7 @@
 	int nounlock;
 	int recount = 0;
 	char iabuf[INET_ADDRSTRLEN];
+	unsigned int lockretry = 100;
 
 	len = sizeof(sin);
 	memset(&amp;req, 0, sizeof(req));
@@ -12121,10 +12210,11 @@
 			ast_log(LOG_WARNING, &quot;Recv error: %s\n&quot;, strerror(errno));
 		return 1;
 	}
-	if (option_debug &amp;&amp; res == sizeof(req.data))
+	if (option_debug &amp;&amp; res == sizeof(req.data)) {
 		ast_log(LOG_DEBUG, &quot;Received packet exceeds buffer. Data is possibly lost\n&quot;);
-
-	req.data[res] = '\0';
+		req.data[sizeof(req.data) - 1] = '\0';
+	} else
+		req.data[res] = '\0';
 	req.len = res;
 	if(sip_debug_test_addr(&amp;sin))	/* Set the debug flag early on packet level */
 		ast_set_flag(&amp;req, SIP_PKT_DEBUG);
@@ -12162,10 +12252,17 @@
 				ast_log(LOG_DEBUG, &quot;Failed to grab lock, trying again...\n&quot;);
 			ast_mutex_unlock(&amp;p-&gt;lock);
 			ast_mutex_unlock(&amp;netlock);
-			/* Sleep infintismly short amount of time */
+			/* Sleep for a very short amount of time */
 			usleep(1);
-			goto retrylock;
+			if (--lockretry)
+				goto retrylock;
 		}
+		if (!lockretry) {
+			ast_log(LOG_ERROR, &quot;We could NOT get the channel lock for %s! \n&quot;, p-&gt;owner-&gt;name);
+			ast_log(LOG_ERROR, &quot;SIP MESSAGE JUST IGNORED: %s \n&quot;, req.data);
+			ast_log(LOG_ERROR, &quot;BAD! BAD! BAD!\n&quot;);
+			return 1;
+		}
 		p-&gt;recv = sin;
 		if (recordhistory) /* This is a request or response, note what it was for */
 			append_history(p, &quot;Rx&quot;, &quot;%s / %s / %s&quot;, req.data, get_header(&amp;req, &quot;CSeq&quot;), req.rlPart2);
@@ -12200,7 +12297,7 @@
 	/* Check for messages */
 	ast_app_inboxcount(peer-&gt;mailbox, &amp;newmsgs, &amp;oldmsgs);
 	
-	time(&amp;peer-&gt;lastmsgcheck);
+	peer-&gt;lastmsgcheck = time(NULL);
 	
 	/* Return now if it's the same thing we told them last time */
 	if (((newmsgs &lt;&lt; 8) | (oldmsgs)) == peer-&gt;lastmsgssent) {
@@ -12239,17 +12336,15 @@
 /*! \brief Check whether peer needs a new MWI notification check */
 static int does_peer_need_mwi(struct sip_peer *peer)
 {
-	time_t t;
+	time_t t = time(NULL);
 
 	if (ast_test_flag(&amp;peer-&gt;flags[1], SIP_PAGE2_SUBSCRIBEMWIONLY) &amp;&amp;
 	    !peer-&gt;mwipvt) {	/* We don't have a subscription */
-		time(&amp;peer-&gt;lastmsgcheck);	/* Reset timer */
+		peer-&gt;lastmsgcheck = t;	/* Reset timer */
 		return FALSE;
 	}
 
-	time(&amp;t);
-			
-	if (!ast_strlen_zero(peer-&gt;mailbox) &amp;&amp; ((t - peer-&gt;lastmsgcheck) &gt; global_mwitime)) 
+	if (!ast_strlen_zero(peer-&gt;mailbox) &amp;&amp; (t - peer-&gt;lastmsgcheck) &gt; global_mwitime)
 		return TRUE;
 
 	return FALSE;
@@ -12290,14 +12385,14 @@
 		/* Check for interfaces needing to be killed */
 		ast_mutex_lock(&amp;iflock);
 restartsearch:		
-		time(&amp;t);
+		t = time(NULL);
 		for (sip = iflist; sip; sip = sip-&gt;next) {
 			ast_mutex_lock(&amp;sip-&gt;lock);
 			/* Check RTP timeouts and kill calls if we have a timeout set and do not get RTP */
 			if (sip-&gt;rtp &amp;&amp; sip-&gt;owner &amp;&amp; (sip-&gt;owner-&gt;_state == AST_STATE_UP) &amp;&amp; !sip-&gt;redirip.sin_addr.s_addr) {
 				if (sip-&gt;lastrtptx &amp;&amp; sip-&gt;rtpkeepalive &amp;&amp; t &gt; sip-&gt;lastrtptx + sip-&gt;rtpkeepalive) {
 					/* Need to send an empty RTP packet */
-					time(&amp;sip-&gt;lastrtptx);
+					sip-&gt;lastrtptx = time(NULL);
 					ast_rtp_sendcng(sip-&gt;rtp, 0);
 				}
 				if (sip-&gt;lastrtprx &amp;&amp; (sip-&gt;rtptimeout || sip-&gt;rtpholdtimeout) &amp;&amp; t &gt; sip-&gt;lastrtprx + sip-&gt;rtptimeout) {
@@ -12353,7 +12448,7 @@
 		}
 
 		/* Send MWI notifications to peers - static and cached realtime peers */
-		time(&amp;t);
+		t = time(NULL);
 		fastrestart = FALSE;
 		curpeernum = 0;
 		peer = NULL;
@@ -12547,6 +12642,12 @@
 					res = AST_DEVICE_INUSE;
 				else
 					res = AST_DEVICE_NOT_INUSE;
+				if (p-&gt;inRinging) {
+					if (p-&gt;inRinging == p-&gt;inUse)
+						res = AST_DEVICE_RINGING;
+					else
+						res = AST_DEVICE_RINGINUSE;
+				}
 			}
 		} else {
 			/* there is no address, it's unavailable */
@@ -13302,9 +13403,8 @@
 		}
 	}
 	if (!ast_test_flag(&amp;global_flags[1], SIP_PAGE2_IGNOREREGEXPIRE) &amp;&amp; ast_test_flag(&amp;peer-&gt;flags[1], SIP_PAGE2_DYNAMIC) &amp;&amp; realtime) {
-		time_t nowtime;
+		time_t nowtime = time(NULL);
 
-		time(&amp;nowtime);
 		if ((nowtime - regseconds) &gt; 0) {
 			destroy_association(peer);
 			memset(&amp;peer-&gt;addr, 0, sizeof(peer-&gt;addr));
@@ -13389,6 +13489,7 @@
 	global_regcontext[0] = '\0';
 	expiry = DEFAULT_EXPIRY;
 	global_notifyringing = DEFAULT_NOTIFYRINGING;
+	global_alwaysauthreject = 0;
 	global_allowsubscribe = FALSE;
 	ast_copy_string(global_useragent, DEFAULT_USERAGENT, sizeof(global_useragent));
 	ast_copy_string(default_notifymime, DEFAULT_NOTIFYMIME, sizeof(default_notifymime));
@@ -13500,6 +13601,8 @@
 			ast_copy_string(default_notifymime, v-&gt;value, sizeof(default_notifymime));
 		} else if (!strcasecmp(v-&gt;name, &quot;notifyringing&quot;)) {
 			global_notifyringing = ast_true(v-&gt;value);
+		} else if (!strcasecmp(v-&gt;name, &quot;alwaysauthreject&quot;)) {
+			global_alwaysauthreject = ast_true(v-&gt;value);
 		} else if (!strcasecmp(v-&gt;name, &quot;musicclass&quot;) || !strcasecmp(v-&gt;name, &quot;musiconhold&quot;)) {
 			ast_copy_string(default_musicclass, v-&gt;value, sizeof(default_musicclass));
 		} else if (!strcasecmp(v-&gt;name, &quot;language&quot;)) {
@@ -13583,7 +13686,7 @@
 				ast_log(LOG_WARNING, &quot;Invalid address for externhost keyword: %s\n&quot;, externhost);
 			else
 				memcpy(&amp;externip.sin_addr, hp-&gt;h_addr, sizeof(externip.sin_addr));
-			time(&amp;externexpire);
+			externexpire = time(NULL);
 		} else if (!strcasecmp(v-&gt;name, &quot;externrefresh&quot;)) {
 			if (sscanf(v-&gt;value, &quot;%d&quot;, &amp;externrefresh) != 1) {
 				ast_log(LOG_WARNING, &quot;Invalid externrefresh value '%s', must be an integer &gt;0 at line %d\n&quot;, v-&gt;value, v-&gt;lineno);

Modified: trunk/channels/chan_zap.c
===================================================================
--- trunk/channels/chan_zap.c	2006-05-25 20:48:20 UTC (rev 180)
+++ trunk/channels/chan_zap.c	2006-05-26 21:12:24 UTC (rev 181)
@@ -2097,9 +2097,8 @@
 				prilocaldialplan = PRI_LOCAL_ISDN;
 			}
 		}
-		pri_sr_set_caller(sr, l ? (l + ldp_strip) : NULL, n, prilocaldialplan, 
-					l ? (p-&gt;use_callingpres ? ast-&gt;cid.cid_pres : PRES_ALLOWED_USER_NUMBER_PASSED_SCREEN) : 
-						 PRES_NUMBER_NOT_AVAILABLE);
+		pri_sr_set_caller(sr, l ? (l + ldp_strip) : NULL, n, prilocaldialplan,
+				  p-&gt;use_callingpres ? ast-&gt;cid.cid_pres : (l ? PRES_ALLOWED_USER_NUMBER_PASSED_SCREEN : PRES_NUMBER_NOT_AVAILABLE));
 		pri_sr_set_redirecting(sr, ast-&gt;cid.cid_rdnis, p-&gt;pri-&gt;localdialplan - 1, PRES_ALLOWED_USER_NUMBER_PASSED_SCREEN, PRI_REDIR_UNCONDITIONAL);
 
 #ifdef SUPPORT_USERUSER
@@ -10487,7 +10486,7 @@
 				y = atoi(v-&gt;value);
 			} else
 				y = 0;
-			if ((y == 32) || (y == 64) || (y == 128) || (y == 256))
+			if ((y == 32) || (y == 64) || (y == 128) || (y == 256) || (y == 512) || (y == 1024))
 				echocancel = y;
 			else {
 				echocancel = ast_true(v-&gt;value);

Modified: trunk/channels/misdn/chan_misdn_config.h
===================================================================
--- trunk/channels/misdn/chan_misdn_config.h	2006-05-25 20:48:20 UTC (rev 180)
+++ trunk/channels/misdn/chan_misdn_config.h	2006-05-26 21:12:24 UTC (rev 181)
@@ -55,6 +55,8 @@
 	MISDN_CFG_JITTERBUFFER_UPPER_THRESHOLD,              /* int */
 	MISDN_CFG_CALLGROUP,           /* ast_group_t */
 	MISDN_CFG_PICKUPGROUP,         /* ast_group_t */
+	MISDN_CFG_MAX_IN,              /* int */
+	MISDN_CFG_MAX_OUT,              /* int */
 	MISDN_CFG_MSNS,                /* char[] */
 	MISDN_CFG_PTP,                 /* int (bool) */
 	MISDN_CFG_LAST,
@@ -70,6 +72,7 @@
 	MISDN_GEN_DYNAMIC_CRYPT,       /* int (bool) */
 	MISDN_GEN_CRYPT_PREFIX,        /* char[] */
 	MISDN_GEN_CRYPT_KEYS,          /* char[] */
+	MISDN_GEN_L1_TIMEOUT,          /* int */
 	MISDN_GEN_LAST
 };
 
@@ -104,4 +107,9 @@
 int misdn_cfg_is_port_valid(int port);
 int misdn_cfg_is_group_method(char *group, enum misdn_cfg_method meth);
 
+#if 0
+char *misdn_cfg_get_next_group(char *group);
+int misdn_cfg_get_next_port_in_group(int port, char *group);
 #endif
+
+#endif

Modified: trunk/channels/misdn/isdn_lib.c
===================================================================
--- trunk/channels/misdn/isdn_lib.c	2006-05-25 20:48:20 UTC (rev 180)
+++ trunk/channels/misdn/isdn_lib.c	2006-05-26 21:12:24 UTC (rev 181)
@@ -18,7 +18,9 @@
 void misdn_join_conf(struct misdn_bchannel *bc, int conf_id);
 void misdn_split_conf(struct misdn_bchannel *bc, int conf_id);
 
+int queue_cleanup_bc(struct misdn_bchannel *bc) ;
 
+
 struct misdn_stack* get_misdn_stack( void );
 
 
@@ -91,9 +93,12 @@
 	int midev;
 	int midev_nt;
 
+	pthread_t l1watcher_thread;
 	pthread_t event_thread;
 	pthread_t event_handler_thread;
-  
+
+	int l1watcher_timeout;
+	
 	void *user_data;
 
 	msg_queue_t upqueue;
@@ -143,6 +148,7 @@
 unsigned char tone_425_flip[TONE_425_SIZE];
 unsigned char tone_silence_flip[TONE_SILENCE_SIZE];
 
+static void misdn_lib_isdn_l1watcher(void *arg);
 static void misdn_lib_isdn_event_catcher(void *arg);
 static int handle_event_nt(void *dat, void *arg);
 
@@ -364,7 +370,7 @@
 
 
 
-static int find_free_chan_in_stack(struct misdn_stack *stack, int channel)
+static int find_free_chan_in_stack(struct misdn_stack *stack, struct misdn_bchannel *bc, int channel)
 {
 	int i;
 
@@ -380,6 +386,8 @@
 			if (!stack-&gt;channels[i]) {
 				cb_log (4, stack-&gt;port, &quot; --&gt; found chan%s: %d\n&quot;, channel&gt;=0?&quot; (preselected)&quot;:&quot;&quot;, i+1);
 				stack-&gt;channels[i] = 1;
+				bc-&gt;channel=i+1;
+				cb_event(EVENT_NEW_CHANNEL, bc, NULL);
 				return i+1;
 			}
 		}
@@ -579,11 +587,15 @@
 		manager_ec_disable(bc);
 	}
 
+	mISDN_write_frame(stack-&gt;midev, buff, bc-&gt;layer_id|FLG_MSG_DOWN, MGR_DELLAYER | REQUEST, 0, 0, NULL, TIMEOUT_1SEC); 
+
 	cb_log(2, stack-&gt;port, &quot;$$$ CLEARING STACK\n&quot;);
-	/*mISDN_clear_stack(stack-&gt;midev,bc-&gt;b_stid);*/
+	ret=mISDN_clear_stack(stack-&gt;midev,bc-&gt;b_stid);
+	if (ret&lt;0) {
+		cb_log(-1,stack-&gt;port,&quot;clear stack failed [%s]\n&quot;,strerror(errno));
+	}
+
 	
-	mISDN_write_frame(stack-&gt;midev, buff, bc-&gt;addr|FLG_MSG_DOWN, MGR_DELLAYER | REQUEST, 0, 0, NULL, TIMEOUT_1SEC);
-	
 	bc-&gt;b_stid = 0;
 	bc_state_change(bc, BCHAN_CLEANED);
 	
@@ -600,7 +612,7 @@
 			cb_event(EVENT_CLEANUP, &amp;stack-&gt;bc[i], glob_mgr-&gt;user_data);
 			empty_chan_in_stack(stack,i+1);
 			empty_bc(&amp;stack-&gt;bc[i]);
-			clean_up_bc(&amp;stack-&gt;bc[i]);
+			queue_cleanup_bc(&amp;stack-&gt;bc[i]);
 			
 		}
 		
@@ -762,11 +774,11 @@
 	int free_chan;
   
 	if (stack-&gt;nt) {
-		free_chan = find_free_chan_in_stack(stack, bc-&gt;channel_preselected?bc-&gt;channel:0);
+		free_chan = find_free_chan_in_stack(stack, bc, bc-&gt;channel_preselected?bc-&gt;channel:0);
 		if (!free_chan) return -1;
-		bc-&gt;channel=free_chan;
+		/*bc-&gt;channel=free_chan;*/
 		
-		cb_log(0,stack-&gt;port, &quot; --&gt;  found channel: %d\n&quot;,free_chan);
+		cb_log(4,stack-&gt;port, &quot; --&gt;  found channel: %d\n&quot;,free_chan);
     
 		for (i=0; i &lt;= MAXPROCS; i++)
 			if (stack-&gt;procids[i]==0) break;
@@ -795,9 +807,9 @@
 	} else { 
 		if (stack-&gt;ptp || bc-&gt;te_choose_channel) {
 			/* we know exactly which channels are in use */
-			free_chan = find_free_chan_in_stack(stack, bc-&gt;channel_preselected?bc-&gt;channel:0);
+			free_chan = find_free_chan_in_stack(stack, bc, bc-&gt;channel_preselected?bc-&gt;channel:0);
 			if (!free_chan) return -1;
-			bc-&gt;channel=free_chan;
+			/*bc-&gt;channel=free_chan;*/
 			cb_log(0,stack-&gt;port, &quot; --&gt;  found channel: %d\n&quot;,free_chan);
 		} else {
 			/* other phones could have made a call also on this port (ptmp) */
@@ -975,9 +987,6 @@
 	bc_state_change(bc,BCHAN_SETUP);
 
 	
-	/*manager_bchannel_deactivate(bc);*/
-	
-	
 	return 0;
 }
 
@@ -1390,7 +1399,7 @@
 			
 		{
 			if (bc-&gt;channel == 0xff) {
-				bc-&gt;channel=find_free_chan_in_stack(stack, 0);
+				bc-&gt;channel=find_free_chan_in_stack(stack, bc,  0);
 				if (!bc-&gt;channel) {
 					cb_log(-1, stack-&gt;port, &quot;Any Channel Requested, but we have no more!!\n&quot;);
 					break;
@@ -1470,7 +1479,7 @@
 				cb_log(4, stack-&gt;port, &quot; --&gt; lib: CLEANING UP l3id: %x\n&quot;,frm-&gt;dinfo);
 				empty_chan_in_stack(stack,bc-&gt;channel);
 				empty_bc(bc);
-				clean_up_bc(bc);
+				queue_cleanup_bc(bc);
 				dump_chan_list(stack);
 				bc-&gt;pid = 0;
 				cb_event(EVENT_CLEANUP, bc, glob_mgr-&gt;user_data);
@@ -1508,7 +1517,7 @@
 		empty_chan_in_stack(stack,bc-&gt;channel);
 		empty_bc(bc);
 	}
-	clean_up_bc(bc);
+	queue_cleanup_bc(bc);
 }
 
 
@@ -2055,6 +2064,9 @@
 			/* we kill the channel later, when we received some
 			   data. */
 			bc-&gt;addr= frm-&gt;addr;
+		} else if ( bc-&gt;addr &lt; 0) {
+			cb_log(-1, stack-&gt;port,&quot;$$$ bc-&gt;addr &lt;0 Error:%s\n&quot;,strerror(errno));
+			bc-&gt;addr=0;
 		}
 		
 		cb_log(4, stack-&gt;port,&quot; --&gt; Got Adr %x\n&quot;, bc-&gt;addr);
@@ -2502,20 +2514,12 @@
 			break;
 		case SSTATUS_L1_DEACTIVATED:
 			cb_log(1, 0, &quot;MGMT: SSTATUS: L1_DEACTIVATED \n&quot;);
-
-			/*reopen L1 if down*/
-			if (stack-&gt;l1link==2)
-				stack-&gt;l1link--;
-			else			
-				stack-&gt;l1link=0;
-			
+			stack-&gt;l1link=0;
 			break;
 
 		case SSTATUS_L2_ESTABLISHED:
 			cb_log(1, stack-&gt;port, &quot;MGMT: SSTATUS: L2_ESTABLISH \n&quot;);
 			stack-&gt;l2link=1;
-			if ( !stack-&gt;ptp &amp;&amp; !stack-&gt;nt )
-				stack-&gt;l1link=2;
 			break;
 			
 		case SSTATUS_L2_RELEASED:
@@ -2597,7 +2601,34 @@
 	return NULL;
 }
 
+static void misdn_lib_isdn_l1watcher(void *arg)
+{
+	struct misdn_lib *mgr = arg;
+	struct misdn_stack *stack;
 
+	while (1) {
+		sleep(mgr-&gt;l1watcher_timeout);
+		
+		/* look out for l1 which are down
+		   and try to pull the up.
+
+		   We might even try to pull the l2 up in the
+		   ptp case.
+		*/
+		for (stack = mgr-&gt;stack_list;
+		     stack;
+		     stack = stack-&gt;next) {
+			cb_log(4,stack-&gt;port,&quot;Checking L1 State\n&quot;);	
+			if (!stack-&gt;l1link) {
+				cb_log(4,stack-&gt;port,&quot;L1 State Down, trying to get it up again\n&quot;);	
+				misdn_lib_get_short_status(stack);
+				misdn_lib_get_l1_up(stack); 
+				misdn_lib_get_l2_up(stack); 
+			}
+		}
+	}
+}
+
 static void misdn_lib_isdn_event_catcher(void *arg)
 {
 	struct misdn_lib *mgr = arg;
@@ -2848,7 +2879,7 @@
 	case EVENT_RETRIEVE_ACKNOWLEDGE:
 		if (stack-&gt;nt) {
 			if (bc-&gt;channel &lt;=0 ) { /*  else we have the channel already */
-				bc-&gt;channel = find_free_chan_in_stack(stack, 0);
+				bc-&gt;channel = find_free_chan_in_stack(stack, bc, 0);
 				if (!bc-&gt;channel) {
 					cb_log(-1, stack-&gt;port, &quot; No free channel at the moment\n&quot;);
 					
@@ -2912,7 +2943,7 @@
 
 			empty_chan_in_stack(stack,bc-&gt;channel);
 			empty_bc(bc);
-			clean_up_bc(bc);
+			queue_cleanup_bc(bc);
 		}
 		
 		/** we set it up later at RETRIEVE_ACK again.**/
@@ -2984,6 +3015,9 @@
 	}
 	
 	switch (frm-&gt;prim) {
+		case MGR_SETSTACK|INDICATION:
+			return handle_bchan(msg);
+		break;
 		case DL_DATA|INDICATION:
 		{
 			int port=(frm-&gt;addr&amp;MASTER_ID_MASK) &gt;&gt; 8;
@@ -3113,6 +3147,32 @@
 	return 0; 
 }
 
+
+int queue_cleanup_bc(struct misdn_bchannel *bc) 
+{
+	msg_t *msg=alloc_msg(MAX_MSG_SIZE);
+	iframe_t *frm;
+	if (!msg) {
+		cb_log(-1, bc-&gt;port, &quot;misgn_lib_get_port: alloc_msg failed!\n&quot;);
+		return -1;
+	}
+	frm=(iframe_t*)msg-&gt;data;
+
+	/* activate bchannel */
+	frm-&gt;prim = MGR_CLEARSTACK| REQUEST;
+
+	frm-&gt;addr = bc-&gt;l3_id;
+
+	frm-&gt;dinfo = bc-&gt;port;
+	frm-&gt;len = 0;
+  
+	msg_queue_tail(&amp;glob_mgr-&gt;activatequeue, msg);
+	sem_post(&amp;glob_mgr-&gt;new_msg);
+
+	return 0; 
+
+}
+
 int misdn_lib_port_restart(int port)
 {
 	struct misdn_stack *stack=find_stack_by_port(port);
@@ -3212,6 +3272,27 @@
 			iframe_t *frm =  (iframe_t*) msg-&gt;data ;
 
 			switch ( frm-&gt;prim) {
+
+			case MGR_CLEARSTACK | REQUEST:
+				/*a queued bchannel cleanup*/
+				{
+					struct misdn_stack *stack=find_stack_by_port(frm-&gt;dinfo);
+					if (!stack) {
+						cb_log(-1,0,&quot;no stack found with port [%d]!! so we cannot cleanup the bc\n&quot;,frm-&gt;dinfo);
+						free_msg(msg);
+						break;
+					}
+					
+					struct misdn_bchannel *bc=find_bc_by_l3id(stack,frm-&gt;addr);
+					if (bc) {
+						cb_log(1,bc-&gt;port,&quot;CLEARSTACK queued, cleaning up\n&quot;);
+						clean_up_bc(bc);
+					} else {
+						cb_log(-1,stack-&gt;port,&quot;bc could not be cleaned correctly !! addr [%x]\n&quot;,frm-&gt;addr);
+					}
+				}
+				free_msg(msg);	
+				break;
 			case MGR_SETSTACK | REQUEST :
 				break;
 			default:
@@ -3391,7 +3472,13 @@
 	pthread_create( &amp;mgr-&gt;event_thread, NULL, (void*)misdn_lib_isdn_event_catcher, mgr);
   
 	cb_log(4, 0, &quot;Event Catcher started\n&quot;);
-  
+
+	if (iface-&gt;l1watcher_timeout &gt; 0) {
+		mgr-&gt;l1watcher_timeout=iface-&gt;l1watcher_timeout;
+		cb_log(4, 0, &quot;Starting L1 watcher\n&quot;);
+		pthread_create( &amp;mgr-&gt;l1watcher_thread, NULL, (void*)misdn_lib_isdn_l1watcher, mgr);
+	}
+	
 	global_state= MISDN_INITIALIZED; 
   
 	return (mgr == NULL);
@@ -3517,8 +3604,11 @@
 	dact.addr = bc-&gt;addr | FLG_MSG_DOWN;
 	dact.dinfo = 0;
 	dact.len = 0;
-	
-	mISDN_write(stack-&gt;midev, &amp;dact, mISDN_HEADER_LEN+dact.len, TIMEOUT_1SEC);
+	char buf[128];	
+	mISDN_write_frame(stack-&gt;midev, buf, bc-&gt;addr| FLG_MSG_DOWN, DL_RELEASE|REQUEST,0,0,NULL, TIMEOUT_1SEC);
+
+	mISDN_read(stack-&gt;midev, buf, 128, TIMEOUT_1SEC);
+
 	clear_ibuffer(bc-&gt;astbuf);
 	
 	bc_state_change(bc,BCHAN_RELEASE);

Modified: trunk/channels/misdn/isdn_lib.h
===================================================================
--- trunk/channels/misdn/isdn_lib.h	2006-05-25 20:48:20 UTC (rev 180)
+++ trunk/channels/misdn/isdn_lib.h	2006-05-26 21:12:24 UTC (rev 181)
@@ -100,6 +100,7 @@
 	EVENT_DTMF_TONE,
 	EVENT_NEW_L3ID,
 	EVENT_NEW_BC,
+	EVENT_NEW_CHANNEL,
 	EVENT_UNKNOWN
 }; 
 
@@ -321,6 +322,8 @@
 	enum event_response_e (*cb_event)(enum event_e event, struct misdn_bchannel *bc, void *user_data);
 	void (*cb_log)(int level, int port, char *tmpl, ...);
 	int (*cb_jb_empty)(struct misdn_bchannel *bc, char *buffer, int len);
+	
+	int l1watcher_timeout;
 };
 
 /***** USER IFACE **********/

Modified: trunk/channels/misdn/isdn_msg_parser.c
===================================================================
--- trunk/channels/misdn/isdn_msg_parser.c	2006-05-25 20:48:20 UTC (rev 180)
+++ trunk/channels/misdn/isdn_msg_parser.c	2006-05-26 21:12:24 UTC (rev 181)
@@ -39,11 +39,14 @@
 			cb_log(0,bc-&gt;port,&quot;We already have a channel (%d)\n&quot;, bc-&gt;channel);
 		} else {
 			bc-&gt;channel = channel;
+			cb_event(EVENT_NEW_CHANNEL,bc,NULL);
 		}
 	}
 	
-	if (channel &gt; 0 &amp;&amp; !bc-&gt;nt ) 
+	if (channel &gt; 0 &amp;&amp; !bc-&gt;nt ) {
 		bc-&gt;channel = channel;
+		cb_event(EVENT_NEW_CHANNEL,bc,NULL);
+	}
 }
 
 void parse_proceeding (struct isdn_msg msgs[], msg_t *msg, struct misdn_bchannel *bc, int nt) 
@@ -1206,6 +1209,7 @@
 char EVENT_DTMF_TONE_INFO[] = &quot;DTMF_TONE&quot;;
 char EVENT_NEW_L3ID_INFO[] = &quot;NEW_L3ID&quot;;
 char EVENT_NEW_BC_INFO[] = &quot;NEW_BC&quot;;
+char EVENT_NEW_CHANNEL_INFO[] = &quot;NEW_CHANNEL&quot;;
 char EVENT_BCHAN_DATA_INFO[] = &quot;BCHAN_DATA&quot;;
 char EVENT_BCHAN_ACTIVATED_INFO[] = &quot;BCHAN_ACTIVATED&quot;;
 char EVENT_TONE_GENERATE_INFO[] = &quot;TONE_GENERATE&quot;;
@@ -1220,6 +1224,7 @@
 	if (event == EVENT_DTMF_TONE) return EVENT_DTMF_TONE_INFO;
 	if (event == EVENT_NEW_L3ID) return EVENT_NEW_L3ID_INFO;
 	if (event == EVENT_NEW_BC) return EVENT_NEW_BC_INFO;
+	if (event == EVENT_NEW_CHANNEL) return EVENT_NEW_CHANNEL_INFO;
 	if (event == EVENT_BCHAN_DATA) return EVENT_BCHAN_DATA_INFO;
 	if (event == EVENT_BCHAN_ACTIVATED) return EVENT_BCHAN_ACTIVATED_INFO;
 	if (event == EVENT_TONE_GENERATE) return EVENT_TONE_GENERATE_INFO;

Modified: trunk/channels/misdn_config.c
===================================================================
--- trunk/channels/misdn_config.c	2006-05-25 20:48:20 UTC (rev 180)
+++ trunk/channels/misdn_config.c	2006-05-26 21:12:24 UTC (rev 181)
@@ -116,6 +116,8 @@
 	{ &quot;jitterbuffer_upper_threshold&quot;, MISDN_CFG_JITTERBUFFER_UPPER_THRESHOLD, MISDN_CTYPE_INT, &quot;0&quot;, NONE },
 	{ &quot;callgroup&quot;, MISDN_CFG_CALLGROUP, MISDN_CTYPE_ASTGROUP, NO_DEFAULT, NONE },
 	{ &quot;pickupgroup&quot;, MISDN_CFG_PICKUPGROUP, MISDN_CTYPE_ASTGROUP, NO_DEFAULT, NONE },
+	{ &quot;max_incoming&quot;, MISDN_CFG_MAX_IN, MISDN_CTYPE_INT, &quot;-1&quot;, NONE },
+	{ &quot;max_outgoing&quot;, MISDN_CFG_MAX_OUT, MISDN_CTYPE_INT, &quot;-1&quot;, NONE },
 	{ &quot;msns&quot;, MISDN_CFG_MSNS, MISDN_CTYPE_MSNLIST, NO_DEFAULT, NONE }
 };
 
@@ -128,7 +130,9 @@
 	{ &quot;append_digits2exten&quot;, MISDN_GEN_APPEND_DIGITS2EXTEN, MISDN_CTYPE_BOOL, &quot;yes&quot;, NONE },
 	{ &quot;dynamic_crypt&quot;, MISDN_GEN_DYNAMIC_CRYPT, MISDN_CTYPE_BOOL, &quot;no&quot;, NONE },
 	{ &quot;crypt_prefix&quot;, MISDN_GEN_CRYPT_PREFIX, MISDN_CTYPE_STR, NO_DEFAULT, NONE },
-	{ &quot;crypt_keys&quot;, MISDN_GEN_CRYPT_KEYS, MISDN_CTYPE_STR, NO_DEFAULT, NONE }
+	{ &quot;crypt_keys&quot;, MISDN_GEN_CRYPT_KEYS, MISDN_CTYPE_STR, NO_DEFAULT, NONE },
+	{ &quot;l1watcher_timeout&quot;, MISDN_GEN_L1_TIMEOUT, MISDN_CTYPE_INT, &quot;0&quot;, NONE }
+	
 };
 
 /* array of port configs, default is at position 0. */
@@ -772,3 +776,5 @@
 	misdn_cfg_unlock();
 	AST_DESTROY_CFG(cfg);
 }
+
+

Modified: trunk/codecs/codec_a_mu.c
===================================================================
--- trunk/codecs/codec_a_mu.c	2006-05-25 20:48:20 UTC (rev 180)
+++ trunk/codecs/codec_a_mu.c	2006-05-26 21:12:24 UTC (rev 181)
@@ -55,30 +55,32 @@
 /*! \brief convert frame data and store into the buffer */
 static int alawtoulaw_framein(struct ast_trans_pvt *pvt, struct ast_frame *f)
 {
-	int i;
-	int in_samples = f-&gt;samples;
+	int x = f-&gt;samples;
 	unsigned char *src = f-&gt;data;
 	unsigned char *dst = (unsigned char *)pvt-&gt;outbuf + pvt-&gt;samples;
 
-	for (i = 0; i &lt; in_samples; i++)
+	pvt-&gt;samples += x;
+	pvt-&gt;datalen += x;
+
+	while (x--)
 		*dst++ = a2mu[*src++];
-	pvt-&gt;samples += in_samples;
-	pvt-&gt;datalen += in_samples;
+
 	return 0;
 }
 
 /*! \brief convert frame data and store into the buffer */
 static int ulawtoalaw_framein(struct ast_trans_pvt *pvt, struct ast_frame *f)
 {
-	int i;
-	int in_samples = f-&gt;samples;
+	int x = f-&gt;samples;
 	unsigned char *src = f-&gt;data;
 	unsigned char *dst = (unsigned char *)pvt-&gt;outbuf + pvt-&gt;samples;
 
-	for (i = 0; i &lt; in_samples; i++)
+	pvt-&gt;samples += x;
+	pvt-&gt;datalen += x;
+
+	while (x--)
 		*dst++ = mu2a[*src++];
-	pvt-&gt;samples += in_samples;
-	pvt-&gt;datalen += in_samples;
+
 	return 0;
 }
 

Modified: trunk/codecs/codec_adpcm.c
===================================================================
--- trunk/codecs/codec_adpcm.c	2006-05-25 20:48:20 UTC (rev 180)
+++ trunk/codecs/codec_adpcm.c	2006-05-26 21:12:24 UTC (rev 181)
@@ -239,13 +239,13 @@
 static int adpcmtolin_framein(struct ast_trans_pvt *pvt, struct ast_frame *f)
 {
 	struct adpcm_decoder_pvt *tmp = pvt-&gt;pvt;
-	int x;
+	int x = f-&gt;datalen;
 	unsigned char *src = f-&gt;data;
 	int16_t *dst = (int16_t *)pvt-&gt;outbuf + pvt-&gt;samples;
 
-	for (x=0; x &lt; f-&gt;datalen; x++) {
-		*dst++ = decode((src[x] &gt;&gt; 4) &amp; 0xf, &amp;tmp-&gt;state);
-		*dst++ = decode(src[x] &amp; 0x0f, &amp;tmp-&gt;state);
+	while (x--) {
+		*dst++ = decode((*src &gt;&gt; 4) &amp; 0xf, &amp;tmp-&gt;state);
+		*dst++ = decode(*src++ &amp; 0x0f, &amp;tmp-&gt;state);
 	}
 	pvt-&gt;samples += f-&gt;samples;
 	pvt-&gt;datalen += 2*f-&gt;samples;

Modified: trunk/codecs/codec_alaw.c
===================================================================
--- trunk/codecs/codec_alaw.c	2006-05-25 20:48:20 UTC (rev 180)
+++ trunk/codecs/codec_alaw.c	2006-05-26 21:12:24 UTC (rev 181)
@@ -54,32 +54,32 @@
 /*! \brief decode frame into lin and fill output buffer. */
 static int alawtolin_framein(struct ast_trans_pvt *pvt, struct ast_frame *f)
 {
-	int i;
+	int i = f-&gt;samples;
 	unsigned char *src = f-&gt;data;
-	int16_t *dst = (int16_t *)pvt-&gt;outbuf;
-	int in_samples = f-&gt;samples;
-	int out_samples = pvt-&gt;samples;
+	int16_t *dst = (int16_t *)pvt-&gt;outbuf + pvt-&gt;samples;
+
+	pvt-&gt;samples += i;
+	pvt-&gt;datalen += i * 2;	/* 2 bytes/sample */
 	
-	for (i = 0; i &lt; in_samples; i++)
-		dst[out_samples++] = AST_ALAW(src[i]);
+	while (i--)
+		*dst++ = AST_ALAW(*src++);
 
-	pvt-&gt;samples = out_samples;
-	pvt-&gt;datalen += in_samples * 2;	/* 2 bytes/sample */
 	return 0;
 }
 
 /*! \brief convert and store input samples in output buffer */
 static int lintoalaw_framein(struct ast_trans_pvt *pvt, struct ast_frame *f)
 {
-	int i;
+	int i = f-&gt;samples;
 	char *dst = pvt-&gt;outbuf + pvt-&gt;samples;
 	int16_t *src = f-&gt;data;
-	int in_samples = f-&gt;samples;
 
-	for (i = 0; i &lt; in_samples; i++) 
-		*dst++ = AST_LIN2A(src[i]);
-	pvt-&gt;samples += in_samples;
-	pvt-&gt;datalen += in_samples;	/* 1 byte/sample */
+	pvt-&gt;samples += i;
+	pvt-&gt;datalen += i;	/* 1 byte/sample */
+
+	while (i--) 
+		*dst++ = AST_LIN2A(*src++);
+
 	return 0;
 }
 

Modified: trunk/codecs/codec_ulaw.c
===================================================================
--- trunk/codecs/codec_ulaw.c	2006-05-25 20:48:20 UTC (rev 180)
+++ trunk/codecs/codec_ulaw.c	2006-05-26 21:12:24 UTC (rev 181)
@@ -54,33 +54,33 @@
 /*! \brief convert and store samples in outbuf */
 static int ulawtolin_framein(struct ast_trans_pvt *pvt, struct ast_frame *f)
 {
-	int i;
+	int i = f-&gt;samples;
 	unsigned char *src = f-&gt;data;
-	int16_t *dst = (int16_t *)pvt-&gt;outbuf;
-	int in_samples = f-&gt;samples;
-	int out_samples = pvt-&gt;samples;
+	int16_t *dst = (int16_t *)pvt-&gt;outbuf + pvt-&gt;samples;
 
+	pvt-&gt;samples += i;
+	pvt-&gt;datalen += i * 2;	/* 2 bytes/sample */
+
 	/* convert and copy in outbuf */
-	for (i = 0; i &lt; in_samples; i++)
-		dst[out_samples++] = AST_MULAW(src[i]);
+	while (i--)
+		*dst++ = AST_MULAW(*src++);
 
-	pvt-&gt;samples = out_samples;
-	pvt-&gt;datalen += in_samples * 2;	/* 2 bytes/sample */
 	return 0;
 }
 
 /*! \brief convert and store samples in outbuf */
 static int lintoulaw_framein(struct ast_trans_pvt *pvt, struct ast_frame *f)
 {
-	int i;
+	int i = f-&gt;samples;
 	char *dst = pvt-&gt;outbuf + pvt-&gt;samples;
 	int16_t *src = f-&gt;data;
-	int in_samples = f-&gt;samples;
 
-	for (i = 0; i &lt; in_samples; i++) 
-		*dst++ = AST_LIN2MU(src[i]);
-	pvt-&gt;samples += in_samples;
-	pvt-&gt;datalen += in_samples;	/* 1 byte/sample */
+	pvt-&gt;samples += i;
+	pvt-&gt;datalen += i;	/* 1 byte/sample */
+
+	while (i--)
+		*dst++ = AST_LIN2MU(*src++);
+
 	return 0;
 }
 

Modified: trunk/codecs/gsm/Makefile
===================================================================
--- trunk/codecs/gsm/Makefile	2006-05-25 20:48:20 UTC (rev 180)
+++ trunk/codecs/gsm/Makefile	2006-05-26 21:12:24 UTC (rev 181)
@@ -38,7 +38,7 @@
 ######### probably require gcc. 
 
 ifeq (, $(findstring $(OSARCH) , Darwin SunOS ))
-ifeq (, $(findstring $(PROC) , x86_64 amd64 ultrasparc sparc64 arm ppc ppc64 ia64 ))
+ifeq (, $(findstring $(PROC) , x86_64 amd64 ultrasparc sparc64 arm ppc ppc64 ia64 s390))
 ifeq (, $(findstring $(shell uname -m) , ppc ppc64 alpha armv4l ))
 OPTIMIZE+=-march=$(PROC)
 endif

Modified: trunk/configs/cdr.conf.sample
===================================================================
--- trunk/configs/cdr.conf.sample	2006-05-25 20:48:20 UTC (rev 180)
+++ trunk/configs/cdr.conf.sample	2006-05-26 21:12:24 UTC (rev 181)
@@ -61,3 +61,11 @@
 ;loguniqueid=yes ;log uniqueid
 ;loguserfield=yes ;log user field
 
+;[radius]
+;usegmtime=yes ;log date/time in GMT
+;loguniqueid=yes ;log uniqueid
+;loguserfield=yes ;log user field
+; Set this to the location of the radiusclient-ng configuration file
+; The default is /etc/radiusclient-ng/radiusclient.conf
+;radiuscfg =&gt; /usr/local/etc/radiusclient-ng/radiusclient.conf
+

Modified: trunk/configs/extensions.conf.sample
===================================================================
--- trunk/configs/extensions.conf.sample	2006-05-25 20:48:20 UTC (rev 180)
+++ trunk/configs/extensions.conf.sample	2006-05-26 21:12:24 UTC (rev 181)
@@ -484,12 +484,10 @@
 include =&gt; demo
 
 ;
-; Extensions like the two below can be used for FWD, Nikotel, sipgate etc.
-; Note that you must have a [sipprovider] section in sip.conf whereas
-; the otherprovider.net example does not require such a peer definition
+; An extension like the one below can be used for FWD, Nikotel, sipgate etc.
+; Note that you must have a [sipprovider] section in sip.conf
 ;
 ;exten =&gt; _41X.,1,Dial(SIP/${EXTEN:2}@sipprovider,,r)
-;exten =&gt; _42X.,1,Dial(SIP/user:passwd@${EXTEN:2}@otherprovider.net,30,rT)
 
 ; Real extensions would go here. Generally you want real extensions to be
 ; 4 or 5 digits long (although there is no such requirement) and start with a
@@ -505,6 +503,8 @@
 ;exten =&gt; 6245,dial+101,Voicemail(6245,b)	; Voicemail (busy)
 ;exten =&gt; 6361,1,Dial(IAX2/JaneDoe,,rm)		; ring without time limit
 ;exten =&gt; 6389,1,Dial(MGCP/aaln/<A HREF="https://lists.berlios.de/mailman/listinfo/solid-pbx-svn">1 at 192.168.0.14</A>)
+;exten =&gt; 6390,1,Dial(JINGLE/caller/callee) ; Dial via jingle using labels
+;exten =&gt; 6391,1,Dial(JINGLE/<A HREF="https://lists.berlios.de/mailman/listinfo/solid-pbx-svn">asterisk at digium.com</A>/<A HREF="https://lists.berlios.de/mailman/listinfo/solid-pbx-svn">mogorman at astjab.org</A>) ;Dial via jingle using asterisk as the transport and calling mogorman.
 ;exten =&gt; 6394,1,Dial(Local/6275/n)		; this will dial ${MARK}
 
 ;exten =&gt; 6275,1,Macro(stdexten,6275,${MARK})	; assuming ${MARK} is something like Zap/2

Modified: trunk/configs/features.conf.sample
===================================================================
--- trunk/configs/features.conf.sample	2006-05-25 20:48:20 UTC (rev 180)
+++ trunk/configs/features.conf.sample	2006-05-26 21:12:24 UTC (rev 181)
@@ -26,12 +26,14 @@
 ;pickupexten = *8		; Configure the pickup extension. (default is *8)
 ;featuredigittimeout = 500	; Max time (ms) between digits for 
 				; feature activation  (default is 500 ms)
+;atxfernoanswertimeout = 15	; Timeout for answer on attended transfer default is 15 seconds.
 
 [featuremap]
 ;blindxfer =&gt; #1		; Blind transfer  (default is #)
 ;disconnect =&gt; *0		; Disconnect  (default is *)
 ;automon =&gt; *1			; One Touch Record a.k.a. Touch Monitor
 ;atxfer =&gt; *2			; Attended transfer
+;parkcall =&gt; #72                ; Park call (one step parking)
 
 [applicationmap]
 ; Note that the DYNAMIC_FEATURES channel variable must be set to use the features

Modified: trunk/configs/func_odbc.conf.sample
===================================================================
--- trunk/configs/func_odbc.conf.sample	2006-05-25 20:48:20 UTC (rev 180)
+++ trunk/configs/func_odbc.conf.sample	2006-05-26 21:12:24 UTC (rev 181)
@@ -35,4 +35,7 @@
 read=SELECT location FROM presence WHERE id='${SQL_ESC(${ARG1})}'
 write=UPDATE presence SET location='${SQL_ESC(${VAL1})}' WHERE id='${SQL_ESC(${ARG1})}'
 ;prefix=OFFICE		; Changes this function from ODBC_PRESENCE to OFFICE_PRESENCE
+;escapecommas=no	; Normally, commas within a field are escaped such that each
+			; field may be separated into individual variables with ARRAY.
+			; This option turns that behavior off [default=yes].
 

Modified: trunk/configs/misdn.conf.sample
===================================================================
--- trunk/configs/misdn.conf.sample	2006-05-25 20:48:20 UTC (rev 180)
+++ trunk/configs/misdn.conf.sample	2006-05-26 21:12:24 UTC (rev 181)
@@ -38,6 +38,20 @@
 ;
 bridging=no
 
+
+;
+; watches the L1s of every port. If one l1 is down it tries to 
+; get it up. The timeout is given in seconds. with 0 as value it
+; does not watch the l1 at all
+; 
+; default value: 0
+;
+; this option is only read at loading time of chan_misdn, 
+; which means you need to unload and load chan_misdn to change the 
+; value, an asterisk restart should do the trick
+; 
+l1watcher_timeout=0
+
 ; stops dialtone after getting first digit on nt Port
 ;
 ; default value: yes
@@ -300,6 +314,21 @@
 ;
 hdlc=no
 
+
+;
+; defines the maximum amount of incoming calls per port for
+; this group. Calls which exceed the maximum will be marked with 
+; the channel varible MAX_OVERFLOW. It will contain the amount of 
+; overflowed calls
+;
+max_incoming=-1
+
+;
+; defines the maximum amount of outgoing calls per port for this group
+; exceeding calls will be rejected
+;
+max_outgoing=-1
+
 [intern]
 ; define your ports, e.g. 1,2 (depends on mISDN-driver loading order) 
 ports=1,2

Modified: trunk/configs/sip.conf.sample
===================================================================
--- trunk/configs/sip.conf.sample	2006-05-25 20:48:20 UTC (rev 180)
+++ trunk/configs/sip.conf.sample	2006-05-26 21:12:24 UTC (rev 181)
@@ -136,6 +136,10 @@
 				; Useful to limit subscriptions to local extensions
 				; Settable per peer/user also
 ;notifyringing = yes		; Notify subscriptions on RINGING state
+;alwaysauthreject = yes		; When an incoming INVITE or REGISTER is to be rejected,
+ 		    		; for any reason, always reject with '401 Unauthorized'
+ 				; instead of letting the requester know whether there was
+ 				; a matching user or peer for their request
 ;
 ; If regcontext is specified, Asterisk will dynamically create and destroy a
 ; NoOp priority 1 extension for a given peer who registers or unregisters with

Modified: trunk/configure
===================================================================
--- trunk/configure	2006-05-25 20:48:20 UTC (rev 180)
+++ trunk/configure	2006-05-26 21:12:24 UTC (rev 181)
@@ -19,11 +19,35 @@
   # Zsh 3.x and 4.x performs word splitting on ${1+&quot;$@&quot;}, which
   # is contrary to our usage.  Disable this feature.
   alias -g '${1+&quot;$@&quot;}'='&quot;$@&quot;'
-elif test -n &quot;${BASH_VERSION+set}&quot; &amp;&amp; (set -o posix) &gt;/dev/null 2&gt;&amp;1; then
-  set -o posix
+  setopt NO_GLOB_SUBST
+else
+  case `(set -o) 2&gt;/dev/null` in *posix*) set -o posix;; esac
 fi
+BIN_SH=xpg4; export BIN_SH # for Tru64
 DUALCASE=1; export DUALCASE # for MKS sh
 
+
+# PATH needs CR
+# Avoid depending upon Character Ranges.
+as_cr_letters='abcdefghijklmnopqrstuvwxyz'
+as_cr_LETTERS='ABCDEFGHIJKLMNOPQRSTUVWXYZ'
+as_cr_Letters=$as_cr_letters$as_cr_LETTERS
+as_cr_digits='0123456789'
+as_cr_alnum=$as_cr_Letters$as_cr_digits
+
+# The user is always right.
+if test &quot;${PATH_SEPARATOR+set}&quot; != set; then
+  echo &quot;#! /bin/sh&quot; &gt;conf$$.sh
+  echo  &quot;exit 0&quot;   &gt;&gt;conf$$.sh
+  chmod +x conf$$.sh
+  if (PATH=&quot;/nonexistent;.&quot;; conf$$.sh) &gt;/dev/null 2&gt;&amp;1; then
+    PATH_SEPARATOR=';'
+  else
+    PATH_SEPARATOR=:
+  fi
+  rm -f conf$$.sh
+fi
+
 # Support unset when possible.
 if ( (MAIL=60; unset MAIL) || exit) &gt;/dev/null 2&gt;&amp;1; then
   as_unset=unset
@@ -32,8 +56,43 @@
 fi
 
 
+# IFS
+# We need space, tab and new line, in precisely that order.  Quoting is
+# there to prevent editors from complaining about space-tab.
+# (If _AS_PATH_WALK were called with IFS unset, it would disable word
+# splitting by setting IFS to empty value.)
+as_nl='
+'
+IFS=&quot; &quot;&quot;	$as_nl&quot;
+
+# Find who we are.  Look in the path if we contain no directory separator.
+case $0 in
+  *[\\/]* ) as_myself=$0 ;;
+  *) as_save_IFS=$IFS; IFS=$PATH_SEPARATOR
+for as_dir in $PATH
+do
+  IFS=$as_save_IFS
+  test -z &quot;$as_dir&quot; &amp;&amp; as_dir=.
+  test -r &quot;$as_dir/$0&quot; &amp;&amp; as_myself=$as_dir/$0 &amp;&amp; break
+done
+IFS=$as_save_IFS
+
+     ;;
+esac
+# We did not find ourselves, most probably we were run as `sh COMMAND'
+# in which case we are not to be found in the path.
+if test &quot;x$as_myself&quot; = x; then
+  as_myself=$0
+fi
+if test ! -f &quot;$as_myself&quot;; then
+  echo &quot;$as_myself: error: cannot find myself; rerun with an absolute file name&quot; &gt;&amp;2
+  { (exit 1); exit 1; }
+fi
+
 # Work around bugs in pre-3.0 UWIN ksh.
-$as_unset ENV MAIL MAILPATH
+for as_var in ENV MAIL MAILPATH
+do ($as_unset $as_var) &gt;/dev/null 2&gt;&amp;1 &amp;&amp; $as_unset $as_var
+done
 PS1='$ '
 PS2='&gt; '
 PS4='+ '
@@ -47,18 +106,19 @@
   if (set +x; test -z &quot;`(eval $as_var=C; export $as_var) 2&gt;&amp;1`&quot;); then
     eval $as_var=C; export $as_var
   else
-    $as_unset $as_var
+    ($as_unset $as_var) &gt;/dev/null 2&gt;&amp;1 &amp;&amp; $as_unset $as_var
   fi
 done
 
 # Required to use basename.
-if expr a : '\(a\)' &gt;/dev/null 2&gt;&amp;1; then
+if expr a : '\(a\)' &gt;/dev/null 2&gt;&amp;1 &amp;&amp;
+   test &quot;X`expr 00001 : '.*\(...\)'`&quot; = X001; then
   as_expr=expr
 else
   as_expr=false
 fi
 
-if (basename /) &gt;/dev/null 2&gt;&amp;1 &amp;&amp; test &quot;X`basename / 2&gt;&amp;1`&quot; = &quot;X/&quot;; then
+if (basename -- /) &gt;/dev/null 2&gt;&amp;1 &amp;&amp; test &quot;X`basename -- / 2&gt;&amp;1`&quot; = &quot;X/&quot;; then
   as_basename=basename
 else
   as_basename=false
@@ -66,157 +126,386 @@
 
 
 # Name of the executable.
-as_me=`$as_basename &quot;$0&quot; ||
+as_me=`$as_basename -- &quot;$0&quot; ||
 $as_expr X/&quot;$0&quot; : '.*/\([^/][^/]*\)/*$' \| \
 	 X&quot;$0&quot; : 'X\(//\)$' \| \
-	 X&quot;$0&quot; : 'X\(/\)$' \| \
-	 .     : '\(.\)' 2&gt;/dev/null ||
+	 X&quot;$0&quot; : 'X\(/\)' \| . 2&gt;/dev/null ||
 echo X/&quot;$0&quot; |
-    sed '/^.*\/\([^/][^/]*\)\/*$/{ s//\1/; q; }
-  	  /^X\/\(\/\/\)$/{ s//\1/; q; }
-  	  /^X\/\(\/\).*/{ s//\1/; q; }
-  	  s/.*/./; q'`
+    sed '/^.*\/\([^/][^/]*\)\/*$/{
+	    s//\1/
+	    q
+	  }
+	  /^X\/\(\/\/\)$/{
+	    s//\1/
+	    q
+	  }
+	  /^X\/\(\/\).*/{
+	    s//\1/
+	    q
+	  }
+	  s/.*/./; q'`
 
+# CDPATH.
+$as_unset CDPATH
 
-# PATH needs CR, and LINENO needs CR and PATH.
-# Avoid depending upon Character Ranges.
-as_cr_letters='abcdefghijklmnopqrstuvwxyz'
-as_cr_LETTERS='ABCDEFGHIJKLMNOPQRSTUVWXYZ'
-as_cr_Letters=$as_cr_letters$as_cr_LETTERS
-as_cr_digits='0123456789'
-as_cr_alnum=$as_cr_Letters$as_cr_digits
 
-# The user is always right.
-if test &quot;${PATH_SEPARATOR+set}&quot; != set; then
-  echo &quot;#! /bin/sh&quot; &gt;conf$$.sh
-  echo  &quot;exit 0&quot;   &gt;&gt;conf$$.sh
-  chmod +x conf$$.sh
-  if (PATH=&quot;/nonexistent;.&quot;; conf$$.sh) &gt;/dev/null 2&gt;&amp;1; then
-    PATH_SEPARATOR=';'
-  else
-    PATH_SEPARATOR=:
-  fi
-  rm -f conf$$.sh
+if test &quot;x$CONFIG_SHELL&quot; = x; then
+  if (eval &quot;:&quot;) 2&gt;/dev/null; then
+  as_have_required=yes
+else
+  as_have_required=no
 fi
 
+  if test $as_have_required = yes &amp;&amp; 	 (eval &quot;:
+(as_func_return () {
+  (exit \$1)
+}
+as_func_success () {
+  as_func_return 0
+}
+as_func_failure () {
+  as_func_return 1
+}
+as_func_ret_success () {
+  return 0
+}
+as_func_ret_failure () {
+  return 1
+}
 
-  as_lineno_1=$LINENO
-  as_lineno_2=$LINENO
-  as_lineno_3=`(expr $as_lineno_1 + 1) 2&gt;/dev/null`
-  test &quot;x$as_lineno_1&quot; != &quot;x$as_lineno_2&quot; &amp;&amp;
-  test &quot;x$as_lineno_3&quot;  = &quot;x$as_lineno_2&quot;  || {
-  # Find who we are.  Look in the path if we contain no path at all
-  # relative or not.
-  case $0 in
-    *[\\/]* ) as_myself=$0 ;;
-    *) as_save_IFS=$IFS; IFS=$PATH_SEPARATOR
-for as_dir in $PATH
-do
-  IFS=$as_save_IFS
-  test -z &quot;$as_dir&quot; &amp;&amp; as_dir=.
-  test -r &quot;$as_dir/$0&quot; &amp;&amp; as_myself=$as_dir/$0 &amp;&amp; break
-done
+exitcode=0
+if as_func_success; then
+  :
+else
+  exitcode=1
+  echo as_func_success failed.
+fi
 
-       ;;
-  esac
-  # We did not find ourselves, most probably we were run as `sh COMMAND'
-  # in which case we are not to be found in the path.
-  if test &quot;x$as_myself&quot; = x; then
-    as_myself=$0
-  fi
-  if test ! -f &quot;$as_myself&quot;; then
-    { echo &quot;$as_me: error: cannot find myself; rerun with an absolute path&quot; &gt;&amp;2
-   { (exit 1); exit 1; }; }
-  fi
-  case $CONFIG_SHELL in
-  '')
+if as_func_failure; then
+  exitcode=1
+  echo as_func_failure succeeded.
+fi
+
+if as_func_ret_success; then
+  :
+else
+  exitcode=1
+  echo as_func_ret_success failed.
+fi
+
+if as_func_ret_failure; then
+  exitcode=1
+  echo as_func_ret_failure succeeded.
+fi
+
+if ( set x; as_func_ret_success y &amp;&amp; test x = \&quot;\$1\&quot; ); then
+  :
+else
+  exitcode=1
+  echo positional parameters were not saved.
+fi
+
+test \$exitcode = 0) || { (exit 1); exit 1; }
+
+(
+  as_lineno_1=\$LINENO
+  as_lineno_2=\$LINENO
+  test \&quot;x\$as_lineno_1\&quot; != \&quot;x\$as_lineno_2\&quot; &amp;&amp;
+  test \&quot;x\`expr \$as_lineno_1 + 1\`\&quot; = \&quot;x\$as_lineno_2\&quot;) || { (exit 1); exit 1; }
+&quot;) 2&gt; /dev/null; then
+  :
+else
+  as_candidate_shells=
     as_save_IFS=$IFS; IFS=$PATH_SEPARATOR
-for as_dir in /bin$PATH_SEPARATOR/usr/bin$PATH_SEPARATOR$PATH
+for as_dir in /usr/bin/posix$PATH_SEPARATOR/bin$PATH_SEPARATOR/usr/bin$PATH_SEPARATOR$PATH
 do
   IFS=$as_save_IFS
   test -z &quot;$as_dir&quot; &amp;&amp; as_dir=.
-  for as_base in sh bash ksh sh5; do
-	 case $as_dir in
+  case $as_dir in
 	 /*)
-	   if (&quot;$as_dir/$as_base&quot; -c '
+	   for as_base in sh bash ksh sh5; do
+	     as_candidate_shells=&quot;$as_candidate_shells $as_dir/$as_base&quot;
+	   done;;
+       esac
+done
+IFS=$as_save_IFS
+
+
+      for as_shell in $as_candidate_shells $SHELL; do
+	 # Try only shells which exist, to save several forks.
+	 if test -f $as_shell &amp;&amp;
+		{ ($as_shell) 2&gt; /dev/null &lt;&lt;\_ASEOF
+# Be Bourne compatible
+if test -n &quot;${ZSH_VERSION+set}&quot; &amp;&amp; (emulate sh) &gt;/dev/null 2&gt;&amp;1; then
+  emulate sh
+  NULLCMD=:
+  # Zsh 3.x and 4.x performs word splitting on ${1+&quot;$@&quot;}, which
+  # is contrary to our usage.  Disable this feature.
+  alias -g '${1+&quot;$@&quot;}'='&quot;$@&quot;'
+  setopt NO_GLOB_SUBST
+else
+  case `(set -o) 2&gt;/dev/null` in *posix*) set -o posix;; esac
+fi
+BIN_SH=xpg4; export BIN_SH # for Tru64
+DUALCASE=1; export DUALCASE # for MKS sh
+
+:
+_ASEOF
+}; then
+  CONFIG_SHELL=$as_shell
+	       as_have_required=yes
+	       if { $as_shell 2&gt; /dev/null &lt;&lt;\_ASEOF
+# Be Bourne compatible
+if test -n &quot;${ZSH_VERSION+set}&quot; &amp;&amp; (emulate sh) &gt;/dev/null 2&gt;&amp;1; then
+  emulate sh
+  NULLCMD=:
+  # Zsh 3.x and 4.x performs word splitting on ${1+&quot;$@&quot;}, which
+  # is contrary to our usage.  Disable this feature.
+  alias -g '${1+&quot;$@&quot;}'='&quot;$@&quot;'
+  setopt NO_GLOB_SUBST
+else
+  case `(set -o) 2&gt;/dev/null` in *posix*) set -o posix;; esac
+fi
+BIN_SH=xpg4; export BIN_SH # for Tru64
+DUALCASE=1; export DUALCASE # for MKS sh
+
+:
+(as_func_return () {
+  (exit $1)
+}
+as_func_success () {
+  as_func_return 0
+}
+as_func_failure () {
+  as_func_return 1
+}
+as_func_ret_success () {
+  return 0
+}
+as_func_ret_failure () {
+  return 1
+}
+
+exitcode=0
+if as_func_success; then
+  :
+else
+  exitcode=1
+  echo as_func_success failed.
+fi
+
+if as_func_failure; then
+  exitcode=1
+  echo as_func_failure succeeded.
+fi
+
+if as_func_ret_success; then
+  :
+else
+  exitcode=1
+  echo as_func_ret_success failed.
+fi
+
+if as_func_ret_failure; then
+  exitcode=1
+  echo as_func_ret_failure succeeded.
+fi
+
+if ( set x; as_func_ret_success y &amp;&amp; test x = &quot;$1&quot; ); then
+  :
+else
+  exitcode=1
+  echo positional parameters were not saved.
+fi
+
+test $exitcode = 0) || { (exit 1); exit 1; }
+
+(
   as_lineno_1=$LINENO
   as_lineno_2=$LINENO
-  as_lineno_3=`(expr $as_lineno_1 + 1) 2&gt;/dev/null`
   test &quot;x$as_lineno_1&quot; != &quot;x$as_lineno_2&quot; &amp;&amp;
-  test &quot;x$as_lineno_3&quot;  = &quot;x$as_lineno_2&quot; ') 2&gt;/dev/null; then
-	     $as_unset BASH_ENV || test &quot;${BASH_ENV+set}&quot; != set || { BASH_ENV=; export BASH_ENV; }
-	     $as_unset ENV || test &quot;${ENV+set}&quot; != set || { ENV=; export ENV; }
-	     CONFIG_SHELL=$as_dir/$as_base
-	     export CONFIG_SHELL
-	     exec &quot;$CONFIG_SHELL&quot; &quot;$0&quot; ${1+&quot;$@&quot;}
-	   fi;;
-	 esac
-       done
-done
-;;
-  esac
+  test &quot;x`expr $as_lineno_1 + 1`&quot; = &quot;x$as_lineno_2&quot;) || { (exit 1); exit 1; }
 
+_ASEOF
+}; then
+  break
+fi
+
+fi
+
+      done
+
+      if test &quot;x$CONFIG_SHELL&quot; != x; then
+  for as_var in BASH_ENV ENV
+        do ($as_unset $as_var) &gt;/dev/null 2&gt;&amp;1 &amp;&amp; $as_unset $as_var
+        done
+        export CONFIG_SHELL
+        exec &quot;$CONFIG_SHELL&quot; &quot;$as_myself&quot; ${1+&quot;$@&quot;}
+fi
+
+
+    if test $as_have_required = no; then
+  echo This script requires a shell more modern than all the
+      echo shells that I found on your system.  Please install a
+      echo modern shell, or manually run the script under such a
+      echo shell if you do have one.
+      { (exit 1); exit 1; }
+fi
+
+
+fi
+
+fi
+
+
+
+(eval &quot;as_func_return () {
+  (exit \$1)
+}
+as_func_success () {
+  as_func_return 0
+}
+as_func_failure () {
+  as_func_return 1
+}
+as_func_ret_success () {
+  return 0
+}
+as_func_ret_failure () {
+  return 1
+}
+
+exitcode=0
+if as_func_success; then
+  :
+else
+  exitcode=1
+  echo as_func_success failed.
+fi
+
+if as_func_failure; then
+  exitcode=1
+  echo as_func_failure succeeded.
+fi
+
+if as_func_ret_success; then
+  :
+else
+  exitcode=1
+  echo as_func_ret_success failed.
+fi
+
+if as_func_ret_failure; then
+  exitcode=1
+  echo as_func_ret_failure succeeded.
+fi
+
+if ( set x; as_func_ret_success y &amp;&amp; test x = \&quot;\$1\&quot; ); then
+  :
+else
+  exitcode=1
+  echo positional parameters were not saved.
+fi
+
+test \$exitcode = 0&quot;) || {
+  echo No shell found that supports shell functions.
+  echo Please tell <A HREF="https://lists.berlios.de/mailman/listinfo/solid-pbx-svn">autoconf at gnu.org</A> about your system,
+  echo including any error possibly output before this
+  echo message
+}
+
+
+
+  as_lineno_1=$LINENO
+  as_lineno_2=$LINENO
+  test &quot;x$as_lineno_1&quot; != &quot;x$as_lineno_2&quot; &amp;&amp;
+  test &quot;x`expr $as_lineno_1 + 1`&quot; = &quot;x$as_lineno_2&quot; || {
+
   # Create $as_me.lineno as a copy of $as_myself, but with $LINENO
   # uniformly replaced by the line number.  The first 'sed' inserts a
-  # line-number line before each line; the second 'sed' does the real
-  # work.  The second script uses 'N' to pair each line-number line
-  # with the numbered line, and appends trailing '-' during
-  # substitution so that $LINENO is not a special case at line end.
+  # line-number line after each line using $LINENO; the second 'sed'
+  # does the real work.  The second script uses 'N' to pair each
+  # line-number line with the line containing $LINENO, and appends
+  # trailing '-' during substitution so that $LINENO is not a special
+  # case at line end.
   # (Raja R Harinath suggested sed '=', and Paul Eggert wrote the
-  # second 'sed' script.  Blame Lee E. McMahon for sed's syntax.  :-)
-  sed '=' &lt;$as_myself |
+  # scripts with optimization help from Paolo Bonzini.  Blame Lee
+  # E. McMahon (1931-1989) for sed's syntax.  :-)
+  sed -n '
+    p
+    /[$]LINENO/=
+  ' &lt;$as_myself |
     sed '
+      s/[$]LINENO.*/&amp;-/
+      t lineno
+      b
+      :lineno
       N
-      s,$,-,
-      : loop
-      s,^\(['$as_cr_digits']*\)\(.*\)[$]LINENO\([^'$as_cr_alnum'_]\),\1\2\1\3,
+      :loop
+      s/[$]LINENO\([^'$as_cr_alnum'_].*\n\)\(.*\)/\2\1\2/
       t loop
-      s,-$,,
-      s,^['$as_cr_digits']*\n,,
+      s/-\n.*//
     ' &gt;$as_me.lineno &amp;&amp;
-  chmod +x $as_me.lineno ||
+  chmod +x &quot;$as_me.lineno&quot; ||
     { echo &quot;$as_me: error: cannot create $as_me.lineno; rerun with a POSIX shell&quot; &gt;&amp;2
    { (exit 1); exit 1; }; }
 
   # Don't try to exec as it changes $[0], causing all sort of problems
   # (the dirname of $[0] is not the place where we might find the
-  # original and so on.  Autoconf is especially sensible to this).
-  . ./$as_me.lineno
+  # original and so on.  Autoconf is especially sensitive to this).
+  . &quot;./$as_me.lineno&quot;
   # Exit status is that of the last command.
   exit
 }
 
 
-case `echo &quot;testing\c&quot;; echo 1,2,3`,`echo -n testing; echo 1,2,3` in
-  *c*,-n*) ECHO_N= ECHO_C='
-' ECHO_T='	' ;;
-  *c*,*  ) ECHO_N=-n ECHO_C= ECHO_T= ;;
-  *)       ECHO_N= ECHO_C='\c' ECHO_T= ;;
+if (dirname -- /) &gt;/dev/null 2&gt;&amp;1; then
+  as_dirname=dirname
+else
+  as_dirname=false
+fi
+
+ECHO_C= ECHO_N= ECHO_T=
+case `echo -n x` in
+-n*)
+  case `echo 'x\c'` in
+  *c*) ECHO_T='	';;	# ECHO_T is single tab character.
+  *)   ECHO_C='\c';;
+  esac;;
+*)
+  ECHO_N='-n';;
 esac
 
-if expr a : '\(a\)' &gt;/dev/null 2&gt;&amp;1; then
+if expr a : '\(a\)' &gt;/dev/null 2&gt;&amp;1 &amp;&amp;
+   test &quot;X`expr 00001 : '.*\(...\)'`&quot; = X001; then
   as_expr=expr
 else
   as_expr=false
 fi
 
 rm -f conf$$ conf$$.exe conf$$.file
+if test -d conf$$.dir; then
+  rm -f conf$$.dir/conf$$.file
+else
+  rm -f conf$$.dir
+  mkdir conf$$.dir
+fi
 echo &gt;conf$$.file
 if ln -s conf$$.file conf$$ 2&gt;/dev/null; then
-  # We could just check for DJGPP; but this test a) works b) is more generic
-  # and c) will remain valid once DJGPP supports symlinks (DJGPP 2.04).
-  if test -f conf$$.exe; then
-    # Don't use ln at all; we don't have any links
+  as_ln_s='ln -s'
+  # ... but there are two gotchas:
+  # 1) On MSYS, both `ln -s file dir' and `ln file dir' fail.
+  # 2) DJGPP &lt; 2.04 has no symlinks; `ln -s' creates a wrapper executable.
+  # In both cases, we have to default to `cp -p'.
+  ln -s conf$$.file conf$$.dir 2&gt;/dev/null &amp;&amp; test ! -f conf$$.exe ||
     as_ln_s='cp -p'
-  else
-    as_ln_s='ln -s'
-  fi
 elif ln conf$$.file conf$$ 2&gt;/dev/null; then
   as_ln_s=ln
 else
   as_ln_s='cp -p'
 fi
-rm -f conf$$ conf$$.exe conf$$.file
+rm -f conf$$ conf$$.exe conf$$.dir/conf$$.file conf$$.file
+rmdir conf$$.dir 2&gt;/dev/null
 
 if mkdir -p . 2&gt;/dev/null; then
   as_mkdir_p=:
@@ -225,7 +514,19 @@
   as_mkdir_p=false
 fi
 
-as_executable_p=&quot;test -f&quot;
+# Find out whether ``test -x'' works.  Don't use a zero-byte file, as
+# systems may use methods other than mode bits to determine executability.
+cat &gt;conf$$.file &lt;&lt;_ASEOF
+#! /bin/sh
+exit 0
+_ASEOF
+chmod +x conf$$.file
+if test -x conf$$.file &gt;/dev/null 2&gt;&amp;1; then
+  as_executable_p=&quot;test -x&quot;
+else
+  as_executable_p=:
+fi
+rm -f conf$$.file
 
 # Sed expression to map a string onto a valid CPP name.
 as_tr_cpp=&quot;eval sed 'y%*$as_cr_letters%P$as_cr_LETTERS%;s%[^_$as_cr_alnum]%_%g'&quot;
@@ -234,39 +535,27 @@
 as_tr_sh=&quot;eval sed 'y%*+%pp%;s%[^_$as_cr_alnum]%_%g'&quot;
 
 
-# IFS
-# We need space, tab and new line, in precisely that order.
-as_nl='
-'
-IFS=&quot; 	$as_nl&quot;
 
-# CDPATH.
-$as_unset CDPATH
+exec 7&lt;&amp;0 &lt;/dev/null 6&gt;&amp;1
 
-
 # Name of the host.
 # hostname on some systems (SVR3.2, Linux) returns a bogus exit status,
 # so uname gets run too.
 ac_hostname=`(hostname || uname -n) 2&gt;/dev/null | sed 1q`
 
-exec 6&gt;&amp;1
-
 #
 # Initializations.
 #
 ac_default_prefix=/usr/local
+ac_clean_files=
 ac_config_libobj_dir=.
+LIBOBJS=
 cross_compiling=no
 subdirs=
 MFLAGS=
 MAKEFLAGS=
 SHELL=${CONFIG_SHELL-/bin/sh}
 
-# Maximum number of lines to put in a shell here document.
-# This variable seems obsolete.  It should probably be removed, and
-# only ac_max_sed_lines should be used.
-: ${ac_max_here_lines=38}
-
 # Identity of this package.
 PACKAGE_NAME=
 PACKAGE_TARNAME=
@@ -341,34 +630,48 @@
 # and all the variables that are supposed to be based on exec_prefix
 # by default will actually change.
 # Use braces instead of parens because sh, perl, etc. also accept them.
+# (The list follows the same order as the GNU Coding Standards.)
 bindir='${exec_prefix}/bin'
 sbindir='${exec_prefix}/sbin'
 libexecdir='${exec_prefix}/libexec'
-datadir='${prefix}/share'
+datarootdir='${prefix}/share'
+datadir='${datarootdir}'
 sysconfdir='${prefix}/etc'
 sharedstatedir='${prefix}/com'
 localstatedir='${prefix}/var'
-libdir='${exec_prefix}/lib'
 includedir='${prefix}/include'
 oldincludedir='/usr/include'
-infodir='${prefix}/info'
-mandir='${prefix}/man'
+docdir='${datarootdir}/doc/${PACKAGE}'
+infodir='${datarootdir}/info'
+htmldir='${docdir}'
+dvidir='${docdir}'
+pdfdir='${docdir}'
+psdir='${docdir}'
+libdir='${exec_prefix}/lib'
+localedir='${datarootdir}/locale'
+mandir='${datarootdir}/man'
 
 ac_prev=
+ac_dashdash=
 for ac_option
 do
   # If the previous option needs an argument, assign it.
   if test -n &quot;$ac_prev&quot;; then
-    eval &quot;$ac_prev=\$ac_option&quot;
+    eval $ac_prev=\$ac_option
     ac_prev=
     continue
   fi
 
-  ac_optarg=`expr &quot;x$ac_option&quot; : 'x[^=]*=\(.*\)'`
+  case $ac_option in
+  *=*)	ac_optarg=`expr &quot;X$ac_option&quot; : '[^=]*=\(.*\)'` ;;
+  *)	ac_optarg=yes ;;
+  esac
 
   # Accept the important Cygnus configure options, so we can diagnose typos.
 
-  case $ac_option in
+  case $ac_dashdash$ac_option in
+  --)
+    ac_dashdash=yes ;;
 
   -bindir | --bindir | --bindi | --bind | --bin | --bi)
     ac_prev=bindir ;;
@@ -390,12 +693,18 @@
   --config-cache | -C)
     cache_file=config.cache ;;
 
-  -datadir | --datadir | --datadi | --datad | --data | --dat | --da)
+  -datadir | --datadir | --datadi | --datad)
     ac_prev=datadir ;;
-  -datadir=* | --datadir=* | --datadi=* | --datad=* | --data=* | --dat=* \
-  | --da=*)
+  -datadir=* | --datadir=* | --datadi=* | --datad=*)
     datadir=$ac_optarg ;;
 
+  -datarootdir | --datarootdir | --datarootdi | --datarootd | --dataroot \
+  | --dataroo | --dataro | --datar)
+    ac_prev=datarootdir ;;
+  -datarootdir=* | --datarootdir=* | --datarootdi=* | --datarootd=* \
+  | --dataroot=* | --dataroo=* | --dataro=* | --datar=*)
+    datarootdir=$ac_optarg ;;
+
   -disable-* | --disable-*)
     ac_feature=`expr &quot;x$ac_option&quot; : 'x-*disable-\(.*\)'`
     # Reject names that are not valid shell variable names.
@@ -403,8 +712,18 @@
       { echo &quot;$as_me: error: invalid feature name: $ac_feature&quot; &gt;&amp;2
    { (exit 1); exit 1; }; }
     ac_feature=`echo $ac_feature | sed 's/-/_/g'`
-    eval &quot;enable_$ac_feature=no&quot; ;;
+    eval enable_$ac_feature=no ;;
 
+  -docdir | --docdir | --docdi | --doc | --do)
+    ac_prev=docdir ;;
+  -docdir=* | --docdir=* | --docdi=* | --doc=* | --do=*)
+    docdir=$ac_optarg ;;
+
+  -dvidir | --dvidir | --dvidi | --dvid | --dvi | --dv)
+    ac_prev=dvidir ;;
+  -dvidir=* | --dvidir=* | --dvidi=* | --dvid=* | --dvi=* | --dv=*)
+    dvidir=$ac_optarg ;;
+
   -enable-* | --enable-*)
     ac_feature=`expr &quot;x$ac_option&quot; : 'x-*enable-\([^=]*\)'`
     # Reject names that are not valid shell variable names.
@@ -412,11 +731,7 @@
       { echo &quot;$as_me: error: invalid feature name: $ac_feature&quot; &gt;&amp;2
    { (exit 1); exit 1; }; }
     ac_feature=`echo $ac_feature | sed 's/-/_/g'`
-    case $ac_option in
-      *=*) ac_optarg=`echo &quot;$ac_optarg&quot; | sed &quot;s/'/'\\\\\\\\''/g&quot;`;;
-      *) ac_optarg=yes ;;
-    esac
-    eval &quot;enable_$ac_feature='$ac_optarg'&quot; ;;
+    eval enable_$ac_feature=\$ac_optarg ;;
 
   -exec-prefix | --exec_prefix | --exec-prefix | --exec-prefi \
   | --exec-pref | --exec-pre | --exec-pr | --exec-p | --exec- \
@@ -443,6 +758,12 @@
   -host=* | --host=* | --hos=* | --ho=*)
     host_alias=$ac_optarg ;;
 
+  -htmldir | --htmldir | --htmldi | --htmld | --html | --htm | --ht)
+    ac_prev=htmldir ;;
+  -htmldir=* | --htmldir=* | --htmldi=* | --htmld=* | --html=* | --htm=* \
+  | --ht=*)
+    htmldir=$ac_optarg ;;
+
   -includedir | --includedir | --includedi | --included | --include \
   | --includ | --inclu | --incl | --inc)
     ac_prev=includedir ;;
@@ -467,13 +788,16 @@
   | --libexe=* | --libex=* | --libe=*)
     libexecdir=$ac_optarg ;;
 
+  -localedir | --localedir | --localedi | --localed | --locale)
+    ac_prev=localedir ;;
+  -localedir=* | --localedir=* | --localedi=* | --localed=* | --locale=*)
+    localedir=$ac_optarg ;;
+
   -localstatedir | --localstatedir | --localstatedi | --localstated \
-  | --localstate | --localstat | --localsta | --localst \
-  | --locals | --local | --loca | --loc | --lo)
+  | --localstate | --localstat | --localsta | --localst | --locals)
     ac_prev=localstatedir ;;
   -localstatedir=* | --localstatedir=* | --localstatedi=* | --localstated=* \
-  | --localstate=* | --localstat=* | --localsta=* | --localst=* \
-  | --locals=* | --local=* | --loca=* | --loc=* | --lo=*)
+  | --localstate=* | --localstat=* | --localsta=* | --localst=* | --locals=*)
     localstatedir=$ac_optarg ;;
 
   -mandir | --mandir | --mandi | --mand | --man | --ma | --m)
@@ -538,6 +862,16 @@
   | --progr-tra=* | --program-tr=* | --program-t=*)
     program_transform_name=$ac_optarg ;;
 
+  -pdfdir | --pdfdir | --pdfdi | --pdfd | --pdf | --pd)
+    ac_prev=pdfdir ;;
+  -pdfdir=* | --pdfdir=* | --pdfdi=* | --pdfd=* | --pdf=* | --pd=*)
+    pdfdir=$ac_optarg ;;
+
+  -psdir | --psdir | --psdi | --psd | --ps)
+    ac_prev=psdir ;;
+  -psdir=* | --psdir=* | --psdi=* | --psd=* | --ps=*)
+    psdir=$ac_optarg ;;
+
   -q | -quiet | --quiet | --quie | --qui | --qu | --q \
   | -silent | --silent | --silen | --sile | --sil)
     silent=yes ;;
@@ -594,11 +928,7 @@
       { echo &quot;$as_me: error: invalid package name: $ac_package&quot; &gt;&amp;2
    { (exit 1); exit 1; }; }
     ac_package=`echo $ac_package| sed 's/-/_/g'`
-    case $ac_option in
-      *=*) ac_optarg=`echo &quot;$ac_optarg&quot; | sed &quot;s/'/'\\\\\\\\''/g&quot;`;;
-      *) ac_optarg=yes ;;
-    esac
-    eval &quot;with_$ac_package='$ac_optarg'&quot; ;;
+    eval with_$ac_package=\$ac_optarg ;;
 
   -without-* | --without-*)
     ac_package=`expr &quot;x$ac_option&quot; : 'x-*without-\(.*\)'`
@@ -607,7 +937,7 @@
       { echo &quot;$as_me: error: invalid package name: $ac_package&quot; &gt;&amp;2
    { (exit 1); exit 1; }; }
     ac_package=`echo $ac_package | sed 's/-/_/g'`
-    eval &quot;with_$ac_package=no&quot; ;;
+    eval with_$ac_package=no ;;
 
   --x)
     # Obsolete; use --with-x.
@@ -638,8 +968,7 @@
     expr &quot;x$ac_envvar&quot; : &quot;.*[^_$as_cr_alnum]&quot; &gt;/dev/null &amp;&amp;
       { echo &quot;$as_me: error: invalid variable name: $ac_envvar&quot; &gt;&amp;2
    { (exit 1); exit 1; }; }
-    ac_optarg=`echo &quot;$ac_optarg&quot; | sed &quot;s/'/'\\\\\\\\''/g&quot;`
-    eval &quot;$ac_envvar='$ac_optarg'&quot;
+    eval $ac_envvar=\$ac_optarg
     export $ac_envvar ;;
 
   *)
@@ -659,29 +988,21 @@
    { (exit 1); exit 1; }; }
 fi
 
-# Be sure to have absolute paths.
-for ac_var in exec_prefix prefix
+# Be sure to have absolute directory names.
+for ac_var in	exec_prefix prefix bindir sbindir libexecdir datarootdir \
+		datadir sysconfdir sharedstatedir localstatedir includedir \
+		oldincludedir docdir infodir htmldir dvidir pdfdir psdir \
+		libdir localedir mandir
 do
-  eval ac_val=$`echo $ac_var`
+  eval ac_val=\$$ac_var
   case $ac_val in
-    [\\/$]* | ?:[\\/]* | NONE | '' ) ;;
-    *)  { echo &quot;$as_me: error: expected an absolute directory name for --$ac_var: $ac_val&quot; &gt;&amp;2
-   { (exit 1); exit 1; }; };;
+    [\\/$]* | ?:[\\/]* )  continue;;
+    NONE | '' ) case $ac_var in *prefix ) continue;; esac;;
   esac
+  { echo &quot;$as_me: error: expected an absolute directory name for --$ac_var: $ac_val&quot; &gt;&amp;2
+   { (exit 1); exit 1; }; }
 done
 
-# Be sure to have absolute paths.
-for ac_var in bindir sbindir libexecdir datadir sysconfdir sharedstatedir \
-	      localstatedir libdir includedir oldincludedir infodir mandir
-do
-  eval ac_val=$`echo $ac_var`
-  case $ac_val in
-    [\\/$]* | ?:[\\/]* ) ;;
-    *)  { echo &quot;$as_me: error: expected an absolute directory name for --$ac_var: $ac_val&quot; &gt;&amp;2
-   { (exit 1); exit 1; }; };;
-  esac
-done
-
 # There might be people who depend on the old broken behavior: `$host'
 # used to hold the argument of --host etc.
 # FIXME: To remove some day.
@@ -706,86 +1027,76 @@
 test &quot;$silent&quot; = yes &amp;&amp; exec 6&gt;/dev/null
 
 
+ac_pwd=`pwd` &amp;&amp; test -n &quot;$ac_pwd&quot; &amp;&amp;
+ac_ls_di=`ls -di .` &amp;&amp;
+ac_pwd_ls_di=`cd &quot;$ac_pwd&quot; &amp;&amp; ls -di .` ||
+  { echo &quot;$as_me: error: Working directory cannot be determined&quot; &gt;&amp;2
+   { (exit 1); exit 1; }; }
+test &quot;X$ac_ls_di&quot; = &quot;X$ac_pwd_ls_di&quot; ||
+  { echo &quot;$as_me: error: pwd does not report name of working directory&quot; &gt;&amp;2
+   { (exit 1); exit 1; }; }
+
+
 # Find the source files, if location was not specified.
 if test -z &quot;$srcdir&quot;; then
   ac_srcdir_defaulted=yes
-  # Try the directory containing this script, then its parent.
-  ac_confdir=`(dirname &quot;$0&quot;) 2&gt;/dev/null ||
+  # Try the directory containing this script, then the parent directory.
+  ac_confdir=`$as_dirname -- &quot;$0&quot; ||
 $as_expr X&quot;$0&quot; : 'X\(.*[^/]\)//*[^/][^/]*/*$' \| \
 	 X&quot;$0&quot; : 'X\(//\)[^/]' \| \
 	 X&quot;$0&quot; : 'X\(//\)$' \| \
-	 X&quot;$0&quot; : 'X\(/\)' \| \
-	 .     : '\(.\)' 2&gt;/dev/null ||
+	 X&quot;$0&quot; : 'X\(/\)' \| . 2&gt;/dev/null ||
 echo X&quot;$0&quot; |
-    sed '/^X\(.*[^/]\)\/\/*[^/][^/]*\/*$/{ s//\1/; q; }
-  	  /^X\(\/\/\)[^/].*/{ s//\1/; q; }
-  	  /^X\(\/\/\)$/{ s//\1/; q; }
-  	  /^X\(\/\).*/{ s//\1/; q; }
-  	  s/.*/./; q'`
+    sed '/^X\(.*[^/]\)\/\/*[^/][^/]*\/*$/{
+	    s//\1/
+	    q
+	  }
+	  /^X\(\/\/\)[^/].*/{
+	    s//\1/
+	    q
+	  }
+	  /^X\(\/\/\)$/{
+	    s//\1/
+	    q
+	  }
+	  /^X\(\/\).*/{
+	    s//\1/
+	    q
+	  }
+	  s/.*/./; q'`
   srcdir=$ac_confdir
-  if test ! -r $srcdir/$ac_unique_file; then
+  if test ! -r &quot;$srcdir/$ac_unique_file&quot;; then
     srcdir=..
   fi
 else
   ac_srcdir_defaulted=no
 fi
-if test ! -r $srcdir/$ac_unique_file; then
-  if test &quot;$ac_srcdir_defaulted&quot; = yes; then
-    { echo &quot;$as_me: error: cannot find sources ($ac_unique_file) in $ac_confdir or ..&quot; &gt;&amp;2
+if test ! -r &quot;$srcdir/$ac_unique_file&quot;; then
+  test &quot;$ac_srcdir_defaulted&quot; = yes &amp;&amp; srcdir=&quot;$ac_confdir or ..&quot;
+  { echo &quot;$as_me: error: cannot find sources ($ac_unique_file) in $srcdir&quot; &gt;&amp;2
    { (exit 1); exit 1; }; }
-  else
-    { echo &quot;$as_me: error: cannot find sources ($ac_unique_file) in $srcdir&quot; &gt;&amp;2
+fi
+ac_msg=&quot;sources are in $srcdir, but \`cd $srcdir' does not work&quot;
+ac_abs_confdir=`(
+	cd &quot;$srcdir&quot; &amp;&amp; test -r &quot;./$ac_unique_file&quot; || { echo &quot;$as_me: error: $ac_msg&quot; &gt;&amp;2
    { (exit 1); exit 1; }; }
-  fi
+	pwd)`
+# When building in place, set srcdir=.
+if test &quot;$ac_abs_confdir&quot; = &quot;$ac_pwd&quot;; then
+  srcdir=.
 fi
-(cd $srcdir &amp;&amp; test -r ./$ac_unique_file) 2&gt;/dev/null ||
-  { echo &quot;$as_me: error: sources are in $srcdir, but \`cd $srcdir' does not work&quot; &gt;&amp;2
-   { (exit 1); exit 1; }; }
-srcdir=`echo &quot;$srcdir&quot; | sed 's%\([^\\/]\)[\\/]*$%\1%'`
-ac_env_build_alias_set=${build_alias+set}
-ac_env_build_alias_value=$build_alias
-ac_cv_env_build_alias_set=${build_alias+set}
-ac_cv_env_build_alias_value=$build_alias
-ac_env_host_alias_set=${host_alias+set}
-ac_env_host_alias_value=$host_alias
-ac_cv_env_host_alias_set=${host_alias+set}
-ac_cv_env_host_alias_value=$host_alias
-ac_env_target_alias_set=${target_alias+set}
-ac_env_target_alias_value=$target_alias
-ac_cv_env_target_alias_set=${target_alias+set}
-ac_cv_env_target_alias_value=$target_alias
-ac_env_CC_set=${CC+set}
-ac_env_CC_value=$CC
-ac_cv_env_CC_set=${CC+set}
-ac_cv_env_CC_value=$CC
-ac_env_CFLAGS_set=${CFLAGS+set}
-ac_env_CFLAGS_value=$CFLAGS
-ac_cv_env_CFLAGS_set=${CFLAGS+set}
-ac_cv_env_CFLAGS_value=$CFLAGS
-ac_env_LDFLAGS_set=${LDFLAGS+set}
-ac_env_LDFLAGS_value=$LDFLAGS
-ac_cv_env_LDFLAGS_set=${LDFLAGS+set}
-ac_cv_env_LDFLAGS_value=$LDFLAGS
-ac_env_CPPFLAGS_set=${CPPFLAGS+set}
-ac_env_CPPFLAGS_value=$CPPFLAGS
-ac_cv_env_CPPFLAGS_set=${CPPFLAGS+set}
-ac_cv_env_CPPFLAGS_value=$CPPFLAGS
-ac_env_CXX_set=${CXX+set}
-ac_env_CXX_value=$CXX
-ac_cv_env_CXX_set=${CXX+set}
-ac_cv_env_CXX_value=$CXX
-ac_env_CXXFLAGS_set=${CXXFLAGS+set}
-ac_env_CXXFLAGS_value=$CXXFLAGS
-ac_cv_env_CXXFLAGS_set=${CXXFLAGS+set}
-ac_cv_env_CXXFLAGS_value=$CXXFLAGS
-ac_env_CPP_set=${CPP+set}
-ac_env_CPP_value=$CPP
-ac_cv_env_CPP_set=${CPP+set}
-ac_cv_env_CPP_value=$CPP
-ac_env_CXXCPP_set=${CXXCPP+set}
-ac_env_CXXCPP_value=$CXXCPP
-ac_cv_env_CXXCPP_set=${CXXCPP+set}
-ac_cv_env_CXXCPP_value=$CXXCPP
+# Remove unnecessary trailing slashes from srcdir.
+# Double slashes in file names in object file debugging info
+# mess up M-x gdb in Emacs.
+case $srcdir in
+*/) srcdir=`expr &quot;X$srcdir&quot; : 'X\(.*[^/]\)' \| &quot;X$srcdir&quot; : 'X\(.*\)'`;;
+esac
+for ac_var in $ac_precious_vars; do
+  eval ac_env_${ac_var}_set=\${${ac_var}+set}
+  eval ac_env_${ac_var}_value=\$${ac_var}
+  eval ac_cv_env_${ac_var}_set=\${${ac_var}+set}
+  eval ac_cv_env_${ac_var}_value=\$${ac_var}
+done
 
 #
 # Report the --help message.
@@ -814,9 +1125,6 @@
   -n, --no-create         do not create output files
       --srcdir=DIR        find the sources in DIR [configure dir or \`..']
 
-_ACEOF
-
-  cat &lt;&lt;_ACEOF
 Installation directories:
   --prefix=PREFIX         install architecture-independent files in PREFIX
 			  [$ac_default_prefix]
@@ -834,15 +1142,22 @@
   --bindir=DIR           user executables [EPREFIX/bin]
   --sbindir=DIR          system admin executables [EPREFIX/sbin]
   --libexecdir=DIR       program executables [EPREFIX/libexec]
-  --datadir=DIR          read-only architecture-independent data [PREFIX/share]
   --sysconfdir=DIR       read-only single-machine data [PREFIX/etc]
   --sharedstatedir=DIR   modifiable architecture-independent data [PREFIX/com]
   --localstatedir=DIR    modifiable single-machine data [PREFIX/var]
   --libdir=DIR           object code libraries [EPREFIX/lib]
   --includedir=DIR       C header files [PREFIX/include]
   --oldincludedir=DIR    C header files for non-gcc [/usr/include]
-  --infodir=DIR          info documentation [PREFIX/info]
-  --mandir=DIR           man documentation [PREFIX/man]
+  --datarootdir=DIR      read-only arch.-independent data root [PREFIX/share]
+  --datadir=DIR          read-only architecture-independent data [DATAROOTDIR]
+  --infodir=DIR          info documentation [DATAROOTDIR/info]
+  --localedir=DIR        locale-dependent data [DATAROOTDIR/locale]
+  --mandir=DIR           man documentation [DATAROOTDIR/man]
+  --docdir=DIR           documentation root [DATAROOTDIR/doc/PACKAGE]
+  --htmldir=DIR          html documentation [DOCDIR]
+  --dvidir=DIR           dvi documentation [DOCDIR]
+  --pdfdir=DIR           pdf documentation [DOCDIR]
+  --psdir=DIR            ps documentation [DOCDIR]
 _ACEOF
 
   cat &lt;&lt;\_ACEOF
@@ -869,6 +1184,7 @@
   --without-PACKAGE       do not use PACKAGE (same as --with-PACKAGE=no)
   --with-asound=PATH      use Advanced Linux Sound Architecture files in PATH
   --with-curses=PATH      use curses files in PATH
+  --with-iksemel=PATH     use Iksemel Jabber Library files in PATH
   --with-nbs=PATH         use Network Broadcast Sound files in PATH
   --with-ncurses=PATH     use ncurses files in PATH
   --with-newt=PATH        use newt files in PATH
@@ -877,6 +1193,8 @@
   --with-osptk=PATH       use OSP Toolkit files in PATH
   --with-popt=PATH        use popt files in PATH
   --with-pri=PATH         use ISDN PRI files in PATH
+  --with-radiusclient-ng=PATH
+                          use Radius Client files in PATH
   --with-speex=PATH       use Speex files in PATH
   --with-sqlite=PATH      use SQLite files in PATH
   --with-ssl=PATH         use OpenSSL files in PATH
@@ -898,8 +1216,8 @@
   CFLAGS      C compiler flags
   LDFLAGS     linker flags, e.g. -L&lt;lib dir&gt; if you have libraries in a
               nonstandard directory &lt;lib dir&gt;
-  CPPFLAGS    C/C++ preprocessor flags, e.g. -I&lt;include dir&gt; if you have
-              headers in a nonstandard directory &lt;include dir&gt;
+  CPPFLAGS    C/C++/Objective C preprocessor flags, e.g. -I&lt;include dir&gt; if
+              you have headers in a nonstandard directory &lt;include dir&gt;
   CXX         C++ compiler command
   CXXFLAGS    C++ compiler flags
   CPP         C preprocessor
@@ -1041,7 +1359,7 @@
 /bin/arch              = `(/bin/arch) 2&gt;/dev/null              || echo unknown`
 /usr/bin/arch -k       = `(/usr/bin/arch -k) 2&gt;/dev/null       || echo unknown`
 /usr/convex/getsysinfo = `(/usr/convex/getsysinfo) 2&gt;/dev/null || echo unknown`
-hostinfo               = `(hostinfo) 2&gt;/dev/null               || echo unknown`
+/usr/bin/hostinfo      = `(/usr/bin/hostinfo) 2&gt;/dev/null      || echo unknown`
 /bin/machine           = `(/bin/machine) 2&gt;/dev/null           || echo unknown`
 /usr/bin/oslevel       = `(/usr/bin/oslevel) 2&gt;/dev/null       || echo unknown`
 /bin/universe          = `(/bin/universe) 2&gt;/dev/null          || echo unknown`
@@ -1055,6 +1373,7 @@
   test -z &quot;$as_dir&quot; &amp;&amp; as_dir=.
   echo &quot;PATH: $as_dir&quot;
 done
+IFS=$as_save_IFS
 
 } &gt;&amp;5
 
@@ -1087,7 +1406,7 @@
     -q | -quiet | --quiet | --quie | --qui | --qu | --q \
     | -silent | --silent | --silen | --sile | --sil)
       continue ;;
-    *&quot; &quot;*|*&quot;	&quot;*|*[\[\]\~\#\$\^\&amp;\*\(\)\{\}\\\|\;\&lt;\&gt;\?\&quot;\']*)
+    *\'*)
       ac_arg=`echo &quot;$ac_arg&quot; | sed &quot;s/'/'\\\\\\\\''/g&quot;` ;;
     esac
     case $ac_pass in
@@ -1122,8 +1441,8 @@
 # When interrupted or exit'd, cleanup temporary files, and complete
 # config.log.  We remove comments because anyway the quotes in there
 # would cause problems or look ugly.
-# WARNING: Be sure not to use single quotes in there, as some shells,
-# such as our DU 5.0 friend, will then `close' the trap.
+# WARNING: Use '\'' to represent an apostrophe within the trap.
+# WARNING: Do not start the trap code with a newline, due to a FreeBSD 4.0 bug.
 trap 'exit_status=$?
   # Save into config.log some information that might help in debugging.
   {
@@ -1136,20 +1455,34 @@
 _ASBOX
     echo
     # The following way of writing the cache mishandles newlines in values,
-{
+(
+  for ac_var in `(set) 2&gt;&amp;1 | sed -n '\''s/^\([a-zA-Z_][a-zA-Z0-9_]*\)=.*/\1/p'\''`; do
+    eval ac_val=\$$ac_var
+    case $ac_val in #(
+    *${as_nl}*)
+      case $ac_var in #(
+      *_cv_*) { echo &quot;$as_me:$LINENO: WARNING: Cache variable $ac_var contains a newline.&quot; &gt;&amp;5
+echo &quot;$as_me: WARNING: Cache variable $ac_var contains a newline.&quot; &gt;&amp;2;} ;;
+      esac
+      case $ac_var in #(
+      _ | IFS | as_nl) ;; #(
+      *) $as_unset $ac_var ;;
+      esac ;;
+    esac
+  done
   (set) 2&gt;&amp;1 |
-    case `(ac_space='&quot;'&quot;' '&quot;'&quot;'; set | grep ac_space) 2&gt;&amp;1` in
-    *ac_space=\ *)
+    case $as_nl`(ac_space='\'' '\''; set) 2&gt;&amp;1` in #(
+    *${as_nl}ac_space=\ *)
       sed -n \
-	&quot;s/'&quot;'&quot;'/'&quot;'&quot;'\\\\'&quot;'&quot;''&quot;'&quot;'/g;
-	  s/^\\([_$as_cr_alnum]*_cv_[_$as_cr_alnum]*\\)=\\(.*\\)/\\1='&quot;'&quot;'\\2'&quot;'&quot;'/p&quot;
-      ;;
+	&quot;s/'\''/'\''\\\\'\'''\''/g;
+	  s/^\\([_$as_cr_alnum]*_cv_[_$as_cr_alnum]*\\)=\\(.*\\)/\\1='\''\\2'\''/p&quot;
+      ;; #(
     *)
-      sed -n \
-	&quot;s/^\\([_$as_cr_alnum]*_cv_[_$as_cr_alnum]*\\)=\\(.*\\)/\\1=\\2/p&quot;
+      sed -n &quot;/^[_$as_cr_alnum]*_cv_[_$as_cr_alnum]*=/p&quot;
       ;;
-    esac;
-}
+    esac |
+    sort
+)
     echo
 
     cat &lt;&lt;\_ASBOX
@@ -1160,22 +1493,22 @@
     echo
     for ac_var in $ac_subst_vars
     do
-      eval ac_val=$`echo $ac_var`
-      echo &quot;$ac_var='&quot;'&quot;'$ac_val'&quot;'&quot;'&quot;
+      eval ac_val=\$$ac_var
+      echo &quot;$ac_var='\''$ac_val'\''&quot;
     done | sort
     echo
 
     if test -n &quot;$ac_subst_files&quot;; then
       cat &lt;&lt;\_ASBOX
-## ------------- ##
-## Output files. ##
-## ------------- ##
+## ------------------- ##
+## File substitutions. ##
+## ------------------- ##
 _ASBOX
       echo
       for ac_var in $ac_subst_files
       do
-	eval ac_val=$`echo $ac_var`
-	echo &quot;$ac_var='&quot;'&quot;'$ac_val'&quot;'&quot;'&quot;
+	eval ac_val=\$$ac_var
+	echo &quot;$ac_var='\''$ac_val'\''&quot;
       done | sort
       echo
     fi
@@ -1187,26 +1520,24 @@
 ## ----------- ##
 _ASBOX
       echo
-      sed &quot;/^$/d&quot; confdefs.h | sort
+      cat confdefs.h
       echo
     fi
     test &quot;$ac_signal&quot; != 0 &amp;&amp;
       echo &quot;$as_me: caught signal $ac_signal&quot;
     echo &quot;$as_me: exit $exit_status&quot;
   } &gt;&amp;5
-  rm -f core *.core &amp;&amp;
-  rm -rf conftest* confdefs* conf$$* $ac_clean_files &amp;&amp;
+  rm -f core *.core core.conftest.* &amp;&amp;
+    rm -f -r conftest* confdefs* conf$$* $ac_clean_files &amp;&amp;
     exit $exit_status
-     ' 0
+' 0
 for ac_signal in 1 2 13 15; do
   trap 'ac_signal='$ac_signal'; { (exit 1); exit 1; }' $ac_signal
 done
 ac_signal=0
 
 # confdefs.h avoids OS command line length limits that DEFS can exceed.
-rm -rf conftest* confdefs.h
-# AIX cpp loses on an empty file, so make sure it contains at least a newline.
-echo &gt;confdefs.h
+rm -f -r conftest* confdefs.h
 
 # Predefined preprocessor variables.
 
@@ -1237,14 +1568,17 @@
 
 # Let the site file select an alternate cache file if it wants to.
 # Prefer explicitly selected file to automatically selected ones.
-if test -z &quot;$CONFIG_SITE&quot;; then
-  if test &quot;x$prefix&quot; != xNONE; then
-    CONFIG_SITE=&quot;$prefix/share/config.site $prefix/etc/config.site&quot;
-  else
-    CONFIG_SITE=&quot;$ac_default_prefix/share/config.site $ac_default_prefix/etc/config.site&quot;
-  fi
+if test -n &quot;$CONFIG_SITE&quot;; then
+  set x &quot;$CONFIG_SITE&quot;
+elif test &quot;x$prefix&quot; != xNONE; then
+  set x &quot;$prefix/share/config.site&quot; &quot;$prefix/etc/config.site&quot;
+else
+  set x &quot;$ac_default_prefix/share/config.site&quot; \
+	&quot;$ac_default_prefix/etc/config.site&quot;
 fi
-for ac_site_file in $CONFIG_SITE; do
+shift
+for ac_site_file
+do
   if test -r &quot;$ac_site_file&quot;; then
     { echo &quot;$as_me:$LINENO: loading site script $ac_site_file&quot; &gt;&amp;5
 echo &quot;$as_me: loading site script $ac_site_file&quot; &gt;&amp;6;}
@@ -1273,12 +1607,11 @@
 # Check that the precious variables saved in the cache have kept the same
 # value.
 ac_cache_corrupted=false
-for ac_var in `(set) 2&gt;&amp;1 |
-	       sed -n 's/^ac_env_\([a-zA-Z_0-9]*\)_set=.*/\1/p'`; do
+for ac_var in $ac_precious_vars; do
   eval ac_old_set=\$ac_cv_env_${ac_var}_set
   eval ac_new_set=\$ac_env_${ac_var}_set
-  eval ac_old_val=&quot;\$ac_cv_env_${ac_var}_value&quot;
-  eval ac_new_val=&quot;\$ac_env_${ac_var}_value&quot;
+  eval ac_old_val=\$ac_cv_env_${ac_var}_value
+  eval ac_new_val=\$ac_env_${ac_var}_value
   case $ac_old_set,$ac_new_set in
     set,)
       { echo &quot;$as_me:$LINENO: error: \`$ac_var' was set to \`$ac_old_val' in the previous run&quot; &gt;&amp;5
@@ -1303,8 +1636,7 @@
   # Pass precious variables to config.status.
   if test &quot;$ac_new_set&quot; = set; then
     case $ac_new_val in
-    *&quot; &quot;*|*&quot;	&quot;*|*[\[\]\~\#\$\^\&amp;\*\(\)\{\}\\\|\;\&lt;\&gt;\?\&quot;\']*)
-      ac_arg=$ac_var=`echo &quot;$ac_new_val&quot; | sed &quot;s/'/'\\\\\\\\''/g&quot;` ;;
+    *\'*) ac_arg=$ac_var=`echo &quot;$ac_new_val&quot; | sed &quot;s/'/'\\\\\\\\''/g&quot;` ;;
     *) ac_arg=$ac_var=$ac_new_val ;;
     esac
     case &quot; $ac_configure_args &quot; in
@@ -1321,11 +1653,6 @@
    { (exit 1); exit 1; }; }
 fi
 
-ac_ext=c
-ac_cpp='$CPP $CPPFLAGS'
-ac_compile='$CC -c $CFLAGS $CPPFLAGS conftest.$ac_ext &gt;&amp;5'
-ac_link='$CC -o conftest$ac_exeext $CFLAGS $CPPFLAGS $LDFLAGS conftest.$ac_ext $LIBS &gt;&amp;5'
-ac_compiler_gnu=$ac_cv_c_compiler_gnu
 
 
 
@@ -1342,10 +1669,14 @@
 
 
 
+ac_ext=c
+ac_cpp='$CPP $CPPFLAGS'
+ac_compile='$CC -c $CFLAGS $CPPFLAGS conftest.$ac_ext &gt;&amp;5'
+ac_link='$CC -o conftest$ac_exeext $CFLAGS $CPPFLAGS $LDFLAGS conftest.$ac_ext $LIBS &gt;&amp;5'
+ac_compiler_gnu=$ac_cv_c_compiler_gnu
 
 
 
-
 # cross-compile macros
 ac_aux_dir=
 for ac_dir in $srcdir $srcdir/.. $srcdir/../..; do
@@ -1378,74 +1709,118 @@
 echo &quot;$as_me: error: cannot run $ac_config_sub&quot; &gt;&amp;2;}
    { (exit 1); exit 1; }; }
 
-echo &quot;$as_me:$LINENO: checking build system type&quot; &gt;&amp;5
-echo $ECHO_N &quot;checking build system type... $ECHO_C&quot; &gt;&amp;6
+{ echo &quot;$as_me:$LINENO: checking build system type&quot; &gt;&amp;5
+echo $ECHO_N &quot;checking build system type... $ECHO_C&quot; &gt;&amp;6; }
 if test &quot;${ac_cv_build+set}&quot; = set; then
   echo $ECHO_N &quot;(cached) $ECHO_C&quot; &gt;&amp;6
 else
-  ac_cv_build_alias=$build_alias
-test -z &quot;$ac_cv_build_alias&quot; &amp;&amp;
-  ac_cv_build_alias=`$ac_config_guess`
-test -z &quot;$ac_cv_build_alias&quot; &amp;&amp;
+  ac_build_alias=$build_alias
+test &quot;x$ac_build_alias&quot; = x &amp;&amp;
+  ac_build_alias=`$ac_config_guess`
+test &quot;x$ac_build_alias&quot; = x &amp;&amp;
   { { echo &quot;$as_me:$LINENO: error: cannot guess build type; you must specify one&quot; &gt;&amp;5
 echo &quot;$as_me: error: cannot guess build type; you must specify one&quot; &gt;&amp;2;}
    { (exit 1); exit 1; }; }
-ac_cv_build=`$ac_config_sub $ac_cv_build_alias` ||
-  { { echo &quot;$as_me:$LINENO: error: $ac_config_sub $ac_cv_build_alias failed&quot; &gt;&amp;5
-echo &quot;$as_me: error: $ac_config_sub $ac_cv_build_alias failed&quot; &gt;&amp;2;}
+ac_cv_build=`$ac_config_sub $ac_build_alias` ||
+  { { echo &quot;$as_me:$LINENO: error: $ac_config_sub $ac_build_alias failed&quot; &gt;&amp;5
+echo &quot;$as_me: error: $ac_config_sub $ac_build_alias failed&quot; &gt;&amp;2;}
    { (exit 1); exit 1; }; }
 
 fi
-echo &quot;$as_me:$LINENO: result: $ac_cv_build&quot; &gt;&amp;5
-echo &quot;${ECHO_T}$ac_cv_build&quot; &gt;&amp;6
+{ echo &quot;$as_me:$LINENO: result: $ac_cv_build&quot; &gt;&amp;5
+echo &quot;${ECHO_T}$ac_cv_build&quot; &gt;&amp;6; }
+case $ac_cv_build in
+*-*-*) ;;
+*) { { echo &quot;$as_me:$LINENO: error: invalid value of canonical build&quot; &gt;&amp;5
+echo &quot;$as_me: error: invalid value of canonical build&quot; &gt;&amp;2;}
+   { (exit 1); exit 1; }; };;
+esac
 build=$ac_cv_build
-build_cpu=`echo $ac_cv_build | sed 's/^\([^-]*\)-\([^-]*\)-\(.*\)$/\1/'`
-build_vendor=`echo $ac_cv_build | sed 's/^\([^-]*\)-\([^-]*\)-\(.*\)$/\2/'`
-build_os=`echo $ac_cv_build | sed 's/^\([^-]*\)-\([^-]*\)-\(.*\)$/\3/'`
+ac_save_IFS=$IFS; IFS='-'
+set x $ac_cv_build
+shift
+build_cpu=$1
+build_vendor=$2
+shift; shift
+# Remember, the first character of IFS is used to create $*,
+# except with old shells:
+build_os=$*
+IFS=$ac_save_IFS
+case $build_os in *\ *) build_os=`echo &quot;$build_os&quot; | sed 's/ /-/g'`;; esac
 
 
-echo &quot;$as_me:$LINENO: checking host system type&quot; &gt;&amp;5
-echo $ECHO_N &quot;checking host system type... $ECHO_C&quot; &gt;&amp;6
+{ echo &quot;$as_me:$LINENO: checking host system type&quot; &gt;&amp;5
+echo $ECHO_N &quot;checking host system type... $ECHO_C&quot; &gt;&amp;6; }
 if test &quot;${ac_cv_host+set}&quot; = set; then
   echo $ECHO_N &quot;(cached) $ECHO_C&quot; &gt;&amp;6
 else
-  ac_cv_host_alias=$host_alias
-test -z &quot;$ac_cv_host_alias&quot; &amp;&amp;
-  ac_cv_host_alias=$ac_cv_build_alias
-ac_cv_host=`$ac_config_sub $ac_cv_host_alias` ||
-  { { echo &quot;$as_me:$LINENO: error: $ac_config_sub $ac_cv_host_alias failed&quot; &gt;&amp;5
-echo &quot;$as_me: error: $ac_config_sub $ac_cv_host_alias failed&quot; &gt;&amp;2;}
+  if test &quot;x$host_alias&quot; = x; then
+  ac_cv_host=$ac_cv_build
+else
+  ac_cv_host=`$ac_config_sub $host_alias` ||
+    { { echo &quot;$as_me:$LINENO: error: $ac_config_sub $host_alias failed&quot; &gt;&amp;5
+echo &quot;$as_me: error: $ac_config_sub $host_alias failed&quot; &gt;&amp;2;}
    { (exit 1); exit 1; }; }
+fi
 
 fi
-echo &quot;$as_me:$LINENO: result: $ac_cv_host&quot; &gt;&amp;5
-echo &quot;${ECHO_T}$ac_cv_host&quot; &gt;&amp;6
+{ echo &quot;$as_me:$LINENO: result: $ac_cv_host&quot; &gt;&amp;5
+echo &quot;${ECHO_T}$ac_cv_host&quot; &gt;&amp;6; }
+case $ac_cv_host in
+*-*-*) ;;
+*) { { echo &quot;$as_me:$LINENO: error: invalid value of canonical host&quot; &gt;&amp;5
+echo &quot;$as_me: error: invalid value of canonical host&quot; &gt;&amp;2;}
+   { (exit 1); exit 1; }; };;
+esac
 host=$ac_cv_host
-host_cpu=`echo $ac_cv_host | sed 's/^\([^-]*\)-\([^-]*\)-\(.*\)$/\1/'`
-host_vendor=`echo $ac_cv_host | sed 's/^\([^-]*\)-\([^-]*\)-\(.*\)$/\2/'`
-host_os=`echo $ac_cv_host | sed 's/^\([^-]*\)-\([^-]*\)-\(.*\)$/\3/'`
+ac_save_IFS=$IFS; IFS='-'
+set x $ac_cv_host
+shift
+host_cpu=$1
+host_vendor=$2
+shift; shift
+# Remember, the first character of IFS is used to create $*,
+# except with old shells:
+host_os=$*
+IFS=$ac_save_IFS
+case $host_os in *\ *) host_os=`echo &quot;$host_os&quot; | sed 's/ /-/g'`;; esac
 
 
-echo &quot;$as_me:$LINENO: checking target system type&quot; &gt;&amp;5
-echo $ECHO_N &quot;checking target system type... $ECHO_C&quot; &gt;&amp;6
+{ echo &quot;$as_me:$LINENO: checking target system type&quot; &gt;&amp;5
+echo $ECHO_N &quot;checking target system type... $ECHO_C&quot; &gt;&amp;6; }
 if test &quot;${ac_cv_target+set}&quot; = set; then
   echo $ECHO_N &quot;(cached) $ECHO_C&quot; &gt;&amp;6
 else
-  ac_cv_target_alias=$target_alias
-test &quot;x$ac_cv_target_alias&quot; = &quot;x&quot; &amp;&amp;
-  ac_cv_target_alias=$ac_cv_host_alias
-ac_cv_target=`$ac_config_sub $ac_cv_target_alias` ||
-  { { echo &quot;$as_me:$LINENO: error: $ac_config_sub $ac_cv_target_alias failed&quot; &gt;&amp;5
-echo &quot;$as_me: error: $ac_config_sub $ac_cv_target_alias failed&quot; &gt;&amp;2;}
+  if test &quot;x$target_alias&quot; = x; then
+  ac_cv_target=$ac_cv_host
+else
+  ac_cv_target=`$ac_config_sub $target_alias` ||
+    { { echo &quot;$as_me:$LINENO: error: $ac_config_sub $target_alias failed&quot; &gt;&amp;5
+echo &quot;$as_me: error: $ac_config_sub $target_alias failed&quot; &gt;&amp;2;}
    { (exit 1); exit 1; }; }
+fi
 
 fi
-echo &quot;$as_me:$LINENO: result: $ac_cv_target&quot; &gt;&amp;5
-echo &quot;${ECHO_T}$ac_cv_target&quot; &gt;&amp;6
+{ echo &quot;$as_me:$LINENO: result: $ac_cv_target&quot; &gt;&amp;5
+echo &quot;${ECHO_T}$ac_cv_target&quot; &gt;&amp;6; }
+case $ac_cv_target in
+*-*-*) ;;
+*) { { echo &quot;$as_me:$LINENO: error: invalid value of canonical target&quot; &gt;&amp;5
+echo &quot;$as_me: error: invalid value of canonical target&quot; &gt;&amp;2;}
+   { (exit 1); exit 1; }; };;
+esac
 target=$ac_cv_target
-target_cpu=`echo $ac_cv_target | sed 's/^\([^-]*\)-\([^-]*\)-\(.*\)$/\1/'`
-target_vendor=`echo $ac_cv_target | sed 's/^\([^-]*\)-\([^-]*\)-\(.*\)$/\2/'`
-target_os=`echo $ac_cv_target | sed 's/^\([^-]*\)-\([^-]*\)-\(.*\)$/\3/'`
+ac_save_IFS=$IFS; IFS='-'
+set x $ac_cv_target
+shift
+target_cpu=$1
+target_vendor=$2
+shift; shift
+# Remember, the first character of IFS is used to create $*,
+# except with old shells:
+target_os=$*
+IFS=$ac_save_IFS
+case $target_os in *\ *) target_os=`echo &quot;$target_os&quot; | sed 's/ /-/g'`;; esac
 
 
 # The aliases save the names the user supplied, while $host etc.
@@ -1459,7 +1834,7 @@
 
 
 # specify output header file
-          ac_config_headers=&quot;$ac_config_headers include/autoconfig.h&quot;
+ac_config_headers=&quot;$ac_config_headers include/autoconfig.h&quot;
 
 
 
@@ -1522,8 +1897,8 @@
 if test -n &quot;$ac_tool_prefix&quot;; then
   # Extract the first word of &quot;${ac_tool_prefix}uname&quot;, so it can be a program name with args.
 set dummy ${ac_tool_prefix}uname; ac_word=$2
-echo &quot;$as_me:$LINENO: checking for $ac_word&quot; &gt;&amp;5
-echo $ECHO_N &quot;checking for $ac_word... $ECHO_C&quot; &gt;&amp;6
+{ echo &quot;$as_me:$LINENO: checking for $ac_word&quot; &gt;&amp;5
+echo $ECHO_N &quot;checking for $ac_word... $ECHO_C&quot; &gt;&amp;6; }
 if test &quot;${ac_cv_path_UNAME+set}&quot; = set; then
   echo $ECHO_N &quot;(cached) $ECHO_C&quot; &gt;&amp;6
 else
@@ -1538,34 +1913,35 @@
   IFS=$as_save_IFS
   test -z &quot;$as_dir&quot; &amp;&amp; as_dir=.
   for ac_exec_ext in '' $ac_executable_extensions; do
-  if $as_executable_p &quot;$as_dir/$ac_word$ac_exec_ext&quot;; then
+  if { test -f &quot;$as_dir/$ac_word$ac_exec_ext&quot; &amp;&amp; $as_executable_p &quot;$as_dir/$ac_word$ac_exec_ext&quot;; }; then
     ac_cv_path_UNAME=&quot;$as_dir/$ac_word$ac_exec_ext&quot;
     echo &quot;$as_me:$LINENO: found $as_dir/$ac_word$ac_exec_ext&quot; &gt;&amp;5
     break 2
   fi
 done
 done
+IFS=$as_save_IFS
 
   ;;
 esac
 fi
 UNAME=$ac_cv_path_UNAME
-
 if test -n &quot;$UNAME&quot;; then
-  echo &quot;$as_me:$LINENO: result: $UNAME&quot; &gt;&amp;5
-echo &quot;${ECHO_T}$UNAME&quot; &gt;&amp;6
+  { echo &quot;$as_me:$LINENO: result: $UNAME&quot; &gt;&amp;5
+echo &quot;${ECHO_T}$UNAME&quot; &gt;&amp;6; }
 else
-  echo &quot;$as_me:$LINENO: result: no&quot; &gt;&amp;5
-echo &quot;${ECHO_T}no&quot; &gt;&amp;6
+  { echo &quot;$as_me:$LINENO: result: no&quot; &gt;&amp;5
+echo &quot;${ECHO_T}no&quot; &gt;&amp;6; }
 fi
 
+
 fi
 if test -z &quot;$ac_cv_path_UNAME&quot;; then
   ac_pt_UNAME=$UNAME
   # Extract the first word of &quot;uname&quot;, so it can be a program name with args.
 set dummy uname; ac_word=$2
-echo &quot;$as_me:$LINENO: checking for $ac_word&quot; &gt;&amp;5
-echo $ECHO_N &quot;checking for $ac_word... $ECHO_C&quot; &gt;&amp;6
+{ echo &quot;$as_me:$LINENO: checking for $ac_word&quot; &gt;&amp;5
+echo $ECHO_N &quot;checking for $ac_word... $ECHO_C&quot; &gt;&amp;6; }
 if test &quot;${ac_cv_path_ac_pt_UNAME+set}&quot; = set; then
   echo $ECHO_N &quot;(cached) $ECHO_C&quot; &gt;&amp;6
 else
@@ -1580,29 +1956,42 @@
   IFS=$as_save_IFS
   test -z &quot;$as_dir&quot; &amp;&amp; as_dir=.
   for ac_exec_ext in '' $ac_executable_extensions; do
-  if $as_executable_p &quot;$as_dir/$ac_word$ac_exec_ext&quot;; then
+  if { test -f &quot;$as_dir/$ac_word$ac_exec_ext&quot; &amp;&amp; $as_executable_p &quot;$as_dir/$ac_word$ac_exec_ext&quot;; }; then
     ac_cv_path_ac_pt_UNAME=&quot;$as_dir/$ac_word$ac_exec_ext&quot;
     echo &quot;$as_me:$LINENO: found $as_dir/$ac_word$ac_exec_ext&quot; &gt;&amp;5
     break 2
   fi
 done
 done
+IFS=$as_save_IFS
 
-  test -z &quot;$ac_cv_path_ac_pt_UNAME&quot; &amp;&amp; ac_cv_path_ac_pt_UNAME=&quot;No&quot;
   ;;
 esac
 fi
 ac_pt_UNAME=$ac_cv_path_ac_pt_UNAME
-
 if test -n &quot;$ac_pt_UNAME&quot;; then
-  echo &quot;$as_me:$LINENO: result: $ac_pt_UNAME&quot; &gt;&amp;5
-echo &quot;${ECHO_T}$ac_pt_UNAME&quot; &gt;&amp;6
+  { echo &quot;$as_me:$LINENO: result: $ac_pt_UNAME&quot; &gt;&amp;5
+echo &quot;${ECHO_T}$ac_pt_UNAME&quot; &gt;&amp;6; }
 else
-  echo &quot;$as_me:$LINENO: result: no&quot; &gt;&amp;5
-echo &quot;${ECHO_T}no&quot; &gt;&amp;6
+  { echo &quot;$as_me:$LINENO: result: no&quot; &gt;&amp;5
+echo &quot;${ECHO_T}no&quot; &gt;&amp;6; }
 fi
 
-  UNAME=$ac_pt_UNAME
+  if test &quot;x$ac_pt_UNAME&quot; = x; then
+    UNAME=&quot;No&quot;
+  else
+    case $cross_compiling:$ac_tool_warned in
+yes:)
+{ echo &quot;$as_me:$LINENO: WARNING: In the future, Autoconf will not detect cross-tools
+whose name does not start with the host triplet.  If you think this
+configuration is useful to you, please write to <A HREF="https://lists.berlios.de/mailman/listinfo/solid-pbx-svn">autoconf at gnu.org.</A>&quot; &gt;&amp;5
+echo &quot;$as_me: WARNING: In the future, Autoconf will not detect cross-tools
+whose name does not start with the host triplet.  If you think this
+configuration is useful to you, please write to <A HREF="https://lists.berlios.de/mailman/listinfo/solid-pbx-svn">autoconf at gnu.org.</A>&quot; &gt;&amp;2;}
+ac_tool_warned=yes ;;
+esac
+    UNAME=$ac_pt_UNAME
+  fi
 else
   UNAME=&quot;$ac_cv_path_UNAME&quot;
 fi
@@ -1709,8 +2098,8 @@
    if test -n &quot;$ac_tool_prefix&quot;; then
   # Extract the first word of &quot;${ac_tool_prefix}gcc&quot;, so it can be a program name with args.
 set dummy ${ac_tool_prefix}gcc; ac_word=$2
-echo &quot;$as_me:$LINENO: checking for $ac_word&quot; &gt;&amp;5
-echo $ECHO_N &quot;checking for $ac_word... $ECHO_C&quot; &gt;&amp;6
+{ echo &quot;$as_me:$LINENO: checking for $ac_word&quot; &gt;&amp;5
+echo $ECHO_N &quot;checking for $ac_word... $ECHO_C&quot; &gt;&amp;6; }
 if test &quot;${ac_cv_prog_CC+set}&quot; = set; then
   echo $ECHO_N &quot;(cached) $ECHO_C&quot; &gt;&amp;6
 else
@@ -1723,32 +2112,34 @@
   IFS=$as_save_IFS
   test -z &quot;$as_dir&quot; &amp;&amp; as_dir=.
   for ac_exec_ext in '' $ac_executable_extensions; do
-  if $as_executable_p &quot;$as_dir/$ac_word$ac_exec_ext&quot;; then
+  if { test -f &quot;$as_dir/$ac_word$ac_exec_ext&quot; &amp;&amp; $as_executable_p &quot;$as_dir/$ac_word$ac_exec_ext&quot;; }; then
     ac_cv_prog_CC=&quot;${ac_tool_prefix}gcc&quot;
     echo &quot;$as_me:$LINENO: found $as_dir/$ac_word$ac_exec_ext&quot; &gt;&amp;5
     break 2
   fi
 done
 done
+IFS=$as_save_IFS
 
 fi
 fi
 CC=$ac_cv_prog_CC
 if test -n &quot;$CC&quot;; then
-  echo &quot;$as_me:$LINENO: result: $CC&quot; &gt;&amp;5
-echo &quot;${ECHO_T}$CC&quot; &gt;&amp;6
+  { echo &quot;$as_me:$LINENO: result: $CC&quot; &gt;&amp;5
+echo &quot;${ECHO_T}$CC&quot; &gt;&amp;6; }
 else
-  echo &quot;$as_me:$LINENO: result: no&quot; &gt;&amp;5
-echo &quot;${ECHO_T}no&quot; &gt;&amp;6
+  { echo &quot;$as_me:$LINENO: result: no&quot; &gt;&amp;5
+echo &quot;${ECHO_T}no&quot; &gt;&amp;6; }
 fi
 
+
 fi
 if test -z &quot;$ac_cv_prog_CC&quot;; then
   ac_ct_CC=$CC
   # Extract the first word of &quot;gcc&quot;, so it can be a program name with args.
 set dummy gcc; ac_word=$2
-echo &quot;$as_me:$LINENO: checking for $ac_word&quot; &gt;&amp;5
-echo $ECHO_N &quot;checking for $ac_word... $ECHO_C&quot; &gt;&amp;6
+{ echo &quot;$as_me:$LINENO: checking for $ac_word&quot; &gt;&amp;5
+echo $ECHO_N &quot;checking for $ac_word... $ECHO_C&quot; &gt;&amp;6; }
 if test &quot;${ac_cv_prog_ac_ct_CC+set}&quot; = set; then
   echo $ECHO_N &quot;(cached) $ECHO_C&quot; &gt;&amp;6
 else
@@ -1761,27 +2152,41 @@
   IFS=$as_save_IFS
   test -z &quot;$as_dir&quot; &amp;&amp; as_dir=.
   for ac_exec_ext in '' $ac_executable_extensions; do
-  if $as_executable_p &quot;$as_dir/$ac_word$ac_exec_ext&quot;; then
+  if { test -f &quot;$as_dir/$ac_word$ac_exec_ext&quot; &amp;&amp; $as_executable_p &quot;$as_dir/$ac_word$ac_exec_ext&quot;; }; then
     ac_cv_prog_ac_ct_CC=&quot;gcc&quot;
     echo &quot;$as_me:$LINENO: found $as_dir/$ac_word$ac_exec_ext&quot; &gt;&amp;5
     break 2
   fi
 done
 done
+IFS=$as_save_IFS
 
-  test -z &quot;$ac_cv_prog_ac_ct_CC&quot; &amp;&amp; ac_cv_prog_ac_ct_CC=&quot;:&quot;
 fi
 fi
 ac_ct_CC=$ac_cv_prog_ac_ct_CC
 if test -n &quot;$ac_ct_CC&quot;; then
-  echo &quot;$as_me:$LINENO: result: $ac_ct_CC&quot; &gt;&amp;5
-echo &quot;${ECHO_T}$ac_ct_CC&quot; &gt;&amp;6
+  { echo &quot;$as_me:$LINENO: result: $ac_ct_CC&quot; &gt;&amp;5
+echo &quot;${ECHO_T}$ac_ct_CC&quot; &gt;&amp;6; }
 else
-  echo &quot;$as_me:$LINENO: result: no&quot; &gt;&amp;5
-echo &quot;${ECHO_T}no&quot; &gt;&amp;6
+  { echo &quot;$as_me:$LINENO: result: no&quot; &gt;&amp;5
+echo &quot;${ECHO_T}no&quot; &gt;&amp;6; }
 fi
 
-  CC=$ac_ct_CC
+  if test &quot;x$ac_ct_CC&quot; = x; then
+    CC=&quot;:&quot;
+  else
+    case $cross_compiling:$ac_tool_warned in
+yes:)
+{ echo &quot;$as_me:$LINENO: WARNING: In the future, Autoconf will not detect cross-tools
+whose name does not start with the host triplet.  If you think this
+configuration is useful to you, please write to <A HREF="https://lists.berlios.de/mailman/listinfo/solid-pbx-svn">autoconf at gnu.org.</A>&quot; &gt;&amp;5
+echo &quot;$as_me: WARNING: In the future, Autoconf will not detect cross-tools
+whose name does not start with the host triplet.  If you think this
+configuration is useful to you, please write to <A HREF="https://lists.berlios.de/mailman/listinfo/solid-pbx-svn">autoconf at gnu.org.</A>&quot; &gt;&amp;2;}
+ac_tool_warned=yes ;;
+esac
+    CC=$ac_ct_CC
+  fi
 else
   CC=&quot;$ac_cv_prog_CC&quot;
 fi
@@ -1789,8 +2194,8 @@
    if test -n &quot;$ac_tool_prefix&quot;; then
   # Extract the first word of &quot;${ac_tool_prefix}g++&quot;, so it can be a program name with args.
 set dummy ${ac_tool_prefix}g++; ac_word=$2
-echo &quot;$as_me:$LINENO: checking for $ac_word&quot; &gt;&amp;5
-echo $ECHO_N &quot;checking for $ac_word... $ECHO_C&quot; &gt;&amp;6
+{ echo &quot;$as_me:$LINENO: checking for $ac_word&quot; &gt;&amp;5
+echo $ECHO_N &quot;checking for $ac_word... $ECHO_C&quot; &gt;&amp;6; }
 if test &quot;${ac_cv_prog_CXX+set}&quot; = set; then
   echo $ECHO_N &quot;(cached) $ECHO_C&quot; &gt;&amp;6
 else
@@ -1803,32 +2208,34 @@
   IFS=$as_save_IFS
   test -z &quot;$as_dir&quot; &amp;&amp; as_dir=.
   for ac_exec_ext in '' $ac_executable_extensions; do
-  if $as_executable_p &quot;$as_dir/$ac_word$ac_exec_ext&quot;; then
+  if { test -f &quot;$as_dir/$ac_word$ac_exec_ext&quot; &amp;&amp; $as_executable_p &quot;$as_dir/$ac_word$ac_exec_ext&quot;; }; then
     ac_cv_prog_CXX=&quot;${ac_tool_prefix}g++&quot;
     echo &quot;$as_me:$LINENO: found $as_dir/$ac_word$ac_exec_ext&quot; &gt;&amp;5
     break 2
   fi
 done
 done
+IFS=$as_save_IFS
 
 fi
 fi
 CXX=$ac_cv_prog_CXX
 if test -n &quot;$CXX&quot;; then
-  echo &quot;$as_me:$LINENO: result: $CXX&quot; &gt;&amp;5
-echo &quot;${ECHO_T}$CXX&quot; &gt;&amp;6
+  { echo &quot;$as_me:$LINENO: result: $CXX&quot; &gt;&amp;5
+echo &quot;${ECHO_T}$CXX&quot; &gt;&amp;6; }
 else
-  echo &quot;$as_me:$LINENO: result: no&quot; &gt;&amp;5
-echo &quot;${ECHO_T}no&quot; &gt;&amp;6
+  { echo &quot;$as_me:$LINENO: result: no&quot; &gt;&amp;5
+echo &quot;${ECHO_T}no&quot; &gt;&amp;6; }
 fi
 
+
 fi
 if test -z &quot;$ac_cv_prog_CXX&quot;; then
   ac_ct_CXX=$CXX
   # Extract the first word of &quot;g++&quot;, so it can be a program name with args.
 set dummy g++; ac_word=$2
-echo &quot;$as_me:$LINENO: checking for $ac_word&quot; &gt;&amp;5
-echo $ECHO_N &quot;checking for $ac_word... $ECHO_C&quot; &gt;&amp;6
+{ echo &quot;$as_me:$LINENO: checking for $ac_word&quot; &gt;&amp;5
+echo $ECHO_N &quot;checking for $ac_word... $ECHO_C&quot; &gt;&amp;6; }
 if test &quot;${ac_cv_prog_ac_ct_CXX+set}&quot; = set; then
   echo $ECHO_N &quot;(cached) $ECHO_C&quot; &gt;&amp;6
 else
@@ -1841,27 +2248,41 @@
   IFS=$as_save_IFS
   test -z &quot;$as_dir&quot; &amp;&amp; as_dir=.
   for ac_exec_ext in '' $ac_executable_extensions; do
-  if $as_executable_p &quot;$as_dir/$ac_word$ac_exec_ext&quot;; then
+  if { test -f &quot;$as_dir/$ac_word$ac_exec_ext&quot; &amp;&amp; $as_executable_p &quot;$as_dir/$ac_word$ac_exec_ext&quot;; }; then
     ac_cv_prog_ac_ct_CXX=&quot;g++&quot;
     echo &quot;$as_me:$LINENO: found $as_dir/$ac_word$ac_exec_ext&quot; &gt;&amp;5
     break 2
   fi
 done
 done
+IFS=$as_save_IFS
 
-  test -z &quot;$ac_cv_prog_ac_ct_CXX&quot; &amp;&amp; ac_cv_prog_ac_ct_CXX=&quot;:&quot;
 fi
 fi
 ac_ct_CXX=$ac_cv_prog_ac_ct_CXX
 if test -n &quot;$ac_ct_CXX&quot;; then
-  echo &quot;$as_me:$LINENO: result: $ac_ct_CXX&quot; &gt;&amp;5
-echo &quot;${ECHO_T}$ac_ct_CXX&quot; &gt;&amp;6
+  { echo &quot;$as_me:$LINENO: result: $ac_ct_CXX&quot; &gt;&amp;5
+echo &quot;${ECHO_T}$ac_ct_CXX&quot; &gt;&amp;6; }
 else
-  echo &quot;$as_me:$LINENO: result: no&quot; &gt;&amp;5
-echo &quot;${ECHO_T}no&quot; &gt;&amp;6
+  { echo &quot;$as_me:$LINENO: result: no&quot; &gt;&amp;5
+echo &quot;${ECHO_T}no&quot; &gt;&amp;6; }
 fi
 
-  CXX=$ac_ct_CXX
+  if test &quot;x$ac_ct_CXX&quot; = x; then
+    CXX=&quot;:&quot;
+  else
+    case $cross_compiling:$ac_tool_warned in
+yes:)
+{ echo &quot;$as_me:$LINENO: WARNING: In the future, Autoconf will not detect cross-tools
+whose name does not start with the host triplet.  If you think this
+configuration is useful to you, please write to <A HREF="https://lists.berlios.de/mailman/listinfo/solid-pbx-svn">autoconf at gnu.org.</A>&quot; &gt;&amp;5
+echo &quot;$as_me: WARNING: In the future, Autoconf will not detect cross-tools
+whose name does not start with the host triplet.  If you think this
+configuration is useful to you, please write to <A HREF="https://lists.berlios.de/mailman/listinfo/solid-pbx-svn">autoconf at gnu.org.</A>&quot; &gt;&amp;2;}
+ac_tool_warned=yes ;;
+esac
+    CXX=$ac_ct_CXX
+  fi
 else
   CXX=&quot;$ac_cv_prog_CXX&quot;
 fi
@@ -1869,8 +2290,8 @@
    if test -n &quot;$ac_tool_prefix&quot;; then
   # Extract the first word of &quot;${ac_tool_prefix}ranlib&quot;, so it can be a program name with args.
 set dummy ${ac_tool_prefix}ranlib; ac_word=$2
-echo &quot;$as_me:$LINENO: checking for $ac_word&quot; &gt;&amp;5
-echo $ECHO_N &quot;checking for $ac_word... $ECHO_C&quot; &gt;&amp;6
+{ echo &quot;$as_me:$LINENO: checking for $ac_word&quot; &gt;&amp;5
+echo $ECHO_N &quot;checking for $ac_word... $ECHO_C&quot; &gt;&amp;6; }
 if test &quot;${ac_cv_prog_RANLIB+set}&quot; = set; then
   echo $ECHO_N &quot;(cached) $ECHO_C&quot; &gt;&amp;6
 else
@@ -1883,32 +2304,34 @@
   IFS=$as_save_IFS
   test -z &quot;$as_dir&quot; &amp;&amp; as_dir=.
   for ac_exec_ext in '' $ac_executable_extensions; do
-  if $as_executable_p &quot;$as_dir/$ac_word$ac_exec_ext&quot;; then
+  if { test -f &quot;$as_dir/$ac_word$ac_exec_ext&quot; &amp;&amp; $as_executable_p &quot;$as_dir/$ac_word$ac_exec_ext&quot;; }; then
     ac_cv_prog_RANLIB=&quot;${ac_tool_prefix}ranlib&quot;
     echo &quot;$as_me:$LINENO: found $as_dir/$ac_word$ac_exec_ext&quot; &gt;&amp;5
     break 2
   fi
 done
 done
+IFS=$as_save_IFS
 
 fi
 fi
 RANLIB=$ac_cv_prog_RANLIB
 if test -n &quot;$RANLIB&quot;; then
-  echo &quot;$as_me:$LINENO: result: $RANLIB&quot; &gt;&amp;5
-echo &quot;${ECHO_T}$RANLIB&quot; &gt;&amp;6
+  { echo &quot;$as_me:$LINENO: result: $RANLIB&quot; &gt;&amp;5
+echo &quot;${ECHO_T}$RANLIB&quot; &gt;&amp;6; }
 else
-  echo &quot;$as_me:$LINENO: result: no&quot; &gt;&amp;5
-echo &quot;${ECHO_T}no&quot; &gt;&amp;6
+  { echo &quot;$as_me:$LINENO: result: no&quot; &gt;&amp;5
+echo &quot;${ECHO_T}no&quot; &gt;&amp;6; }
 fi
 
+
 fi
 if test -z &quot;$ac_cv_prog_RANLIB&quot;; then
   ac_ct_RANLIB=$RANLIB
   # Extract the first word of &quot;ranlib&quot;, so it can be a program name with args.
 set dummy ranlib; ac_word=$2
-echo &quot;$as_me:$LINENO: checking for $ac_word&quot; &gt;&amp;5
-echo $ECHO_N &quot;checking for $ac_word... $ECHO_C&quot; &gt;&amp;6
+{ echo &quot;$as_me:$LINENO: checking for $ac_word&quot; &gt;&amp;5
+echo $ECHO_N &quot;checking for $ac_word... $ECHO_C&quot; &gt;&amp;6; }
 if test &quot;${ac_cv_prog_ac_ct_RANLIB+set}&quot; = set; then
   echo $ECHO_N &quot;(cached) $ECHO_C&quot; &gt;&amp;6
 else
@@ -1921,27 +2344,41 @@
   IFS=$as_save_IFS
   test -z &quot;$as_dir&quot; &amp;&amp; as_dir=.
   for ac_exec_ext in '' $ac_executable_extensions; do
-  if $as_executable_p &quot;$as_dir/$ac_word$ac_exec_ext&quot;; then
+  if { test -f &quot;$as_dir/$ac_word$ac_exec_ext&quot; &amp;&amp; $as_executable_p &quot;$as_dir/$ac_word$ac_exec_ext&quot;; }; then
     ac_cv_prog_ac_ct_RANLIB=&quot;ranlib&quot;
     echo &quot;$as_me:$LINENO: found $as_dir/$ac_word$ac_exec_ext&quot; &gt;&amp;5
     break 2
   fi
 done
 done
+IFS=$as_save_IFS
 
-  test -z &quot;$ac_cv_prog_ac_ct_RANLIB&quot; &amp;&amp; ac_cv_prog_ac_ct_RANLIB=&quot;:&quot;
 fi
 fi
 ac_ct_RANLIB=$ac_cv_prog_ac_ct_RANLIB
 if test -n &quot;$ac_ct_RANLIB&quot;; then
-  echo &quot;$as_me:$LINENO: result: $ac_ct_RANLIB&quot; &gt;&amp;5
-echo &quot;${ECHO_T}$ac_ct_RANLIB&quot; &gt;&amp;6
+  { echo &quot;$as_me:$LINENO: result: $ac_ct_RANLIB&quot; &gt;&amp;5
+echo &quot;${ECHO_T}$ac_ct_RANLIB&quot; &gt;&amp;6; }
 else
-  echo &quot;$as_me:$LINENO: result: no&quot; &gt;&amp;5
-echo &quot;${ECHO_T}no&quot; &gt;&amp;6
+  { echo &quot;$as_me:$LINENO: result: no&quot; &gt;&amp;5
+echo &quot;${ECHO_T}no&quot; &gt;&amp;6; }
 fi
 
-  RANLIB=$ac_ct_RANLIB
+  if test &quot;x$ac_ct_RANLIB&quot; = x; then
+    RANLIB=&quot;:&quot;
+  else
+    case $cross_compiling:$ac_tool_warned in
+yes:)
+{ echo &quot;$as_me:$LINENO: WARNING: In the future, Autoconf will not detect cross-tools
+whose name does not start with the host triplet.  If you think this
+configuration is useful to you, please write to <A HREF="https://lists.berlios.de/mailman/listinfo/solid-pbx-svn">autoconf at gnu.org.</A>&quot; &gt;&amp;5
+echo &quot;$as_me: WARNING: In the future, Autoconf will not detect cross-tools
+whose name does not start with the host triplet.  If you think this
+configuration is useful to you, please write to <A HREF="https://lists.berlios.de/mailman/listinfo/solid-pbx-svn">autoconf at gnu.org.</A>&quot; &gt;&amp;2;}
+ac_tool_warned=yes ;;
+esac
+    RANLIB=$ac_ct_RANLIB
+  fi
 else
   RANLIB=&quot;$ac_cv_prog_RANLIB&quot;
 fi
@@ -1949,8 +2386,8 @@
    if test -n &quot;$ac_tool_prefix&quot;; then
   # Extract the first word of &quot;${ac_tool_prefix}ar&quot;, so it can be a program name with args.
 set dummy ${ac_tool_prefix}ar; ac_word=$2
-echo &quot;$as_me:$LINENO: checking for $ac_word&quot; &gt;&amp;5
-echo $ECHO_N &quot;checking for $ac_word... $ECHO_C&quot; &gt;&amp;6
+{ echo &quot;$as_me:$LINENO: checking for $ac_word&quot; &gt;&amp;5
+echo $ECHO_N &quot;checking for $ac_word... $ECHO_C&quot; &gt;&amp;6; }
 if test &quot;${ac_cv_prog_AR+set}&quot; = set; then
   echo $ECHO_N &quot;(cached) $ECHO_C&quot; &gt;&amp;6
 else
@@ -1963,32 +2400,34 @@
   IFS=$as_save_IFS
   test -z &quot;$as_dir&quot; &amp;&amp; as_dir=.
   for ac_exec_ext in '' $ac_executable_extensions; do
-  if $as_executable_p &quot;$as_dir/$ac_word$ac_exec_ext&quot;; then
+  if { test -f &quot;$as_dir/$ac_word$ac_exec_ext&quot; &amp;&amp; $as_executable_p &quot;$as_dir/$ac_word$ac_exec_ext&quot;; }; then
     ac_cv_prog_AR=&quot;${ac_tool_prefix}ar&quot;
     echo &quot;$as_me:$LINENO: found $as_dir/$ac_word$ac_exec_ext&quot; &gt;&amp;5
     break 2
   fi
 done
 done
+IFS=$as_save_IFS
 
 fi
 fi
 AR=$ac_cv_prog_AR
 if test -n &quot;$AR&quot;; then
-  echo &quot;$as_me:$LINENO: result: $AR&quot; &gt;&amp;5
-echo &quot;${ECHO_T}$AR&quot; &gt;&amp;6
+  { echo &quot;$as_me:$LINENO: result: $AR&quot; &gt;&amp;5
+echo &quot;${ECHO_T}$AR&quot; &gt;&amp;6; }
 else
-  echo &quot;$as_me:$LINENO: result: no&quot; &gt;&amp;5
-echo &quot;${ECHO_T}no&quot; &gt;&amp;6
+  { echo &quot;$as_me:$LINENO: result: no&quot; &gt;&amp;5
+echo &quot;${ECHO_T}no&quot; &gt;&amp;6; }
 fi
 
+
 fi
 if test -z &quot;$ac_cv_prog_AR&quot;; then
   ac_ct_AR=$AR
   # Extract the first word of &quot;ar&quot;, so it can be a program name with args.
 set dummy ar; ac_word=$2
-echo &quot;$as_me:$LINENO: checking for $ac_word&quot; &gt;&amp;5
-echo $ECHO_N &quot;checking for $ac_word... $ECHO_C&quot; &gt;&amp;6
+{ echo &quot;$as_me:$LINENO: checking for $ac_word&quot; &gt;&amp;5
+echo $ECHO_N &quot;checking for $ac_word... $ECHO_C&quot; &gt;&amp;6; }
 if test &quot;${ac_cv_prog_ac_ct_AR+set}&quot; = set; then
   echo $ECHO_N &quot;(cached) $ECHO_C&quot; &gt;&amp;6
 else
@@ -2001,27 +2440,41 @@
   IFS=$as_save_IFS
   test -z &quot;$as_dir&quot; &amp;&amp; as_dir=.
   for ac_exec_ext in '' $ac_executable_extensions; do
-  if $as_executable_p &quot;$as_dir/$ac_word$ac_exec_ext&quot;; then
+  if { test -f &quot;$as_dir/$ac_word$ac_exec_ext&quot; &amp;&amp; $as_executable_p &quot;$as_dir/$ac_word$ac_exec_ext&quot;; }; then
     ac_cv_prog_ac_ct_AR=&quot;ar&quot;
     echo &quot;$as_me:$LINENO: found $as_dir/$ac_word$ac_exec_ext&quot; &gt;&amp;5
     break 2
   fi
 done
 done
+IFS=$as_save_IFS
 
-  test -z &quot;$ac_cv_prog_ac_ct_AR&quot; &amp;&amp; ac_cv_prog_ac_ct_AR=&quot;:&quot;
 fi
 fi
 ac_ct_AR=$ac_cv_prog_ac_ct_AR
 if test -n &quot;$ac_ct_AR&quot;; then
-  echo &quot;$as_me:$LINENO: result: $ac_ct_AR&quot; &gt;&amp;5
-echo &quot;${ECHO_T}$ac_ct_AR&quot; &gt;&amp;6
+  { echo &quot;$as_me:$LINENO: result: $ac_ct_AR&quot; &gt;&amp;5
+echo &quot;${ECHO_T}$ac_ct_AR&quot; &gt;&amp;6; }
 else
-  echo &quot;$as_me:$LINENO: result: no&quot; &gt;&amp;5
-echo &quot;${ECHO_T}no&quot; &gt;&amp;6
+  { echo &quot;$as_me:$LINENO: result: no&quot; &gt;&amp;5
+echo &quot;${ECHO_T}no&quot; &gt;&amp;6; }
 fi
 
-  AR=$ac_ct_AR
+  if test &quot;x$ac_ct_AR&quot; = x; then
+    AR=&quot;:&quot;
+  else
+    case $cross_compiling:$ac_tool_warned in
+yes:)
+{ echo &quot;$as_me:$LINENO: WARNING: In the future, Autoconf will not detect cross-tools
+whose name does not start with the host triplet.  If you think this
+configuration is useful to you, please write to <A HREF="https://lists.berlios.de/mailman/listinfo/solid-pbx-svn">autoconf at gnu.org.</A>&quot; &gt;&amp;5
+echo &quot;$as_me: WARNING: In the future, Autoconf will not detect cross-tools
+whose name does not start with the host triplet.  If you think this
+configuration is useful to you, please write to <A HREF="https://lists.berlios.de/mailman/listinfo/solid-pbx-svn">autoconf at gnu.org.</A>&quot; &gt;&amp;2;}
+ac_tool_warned=yes ;;
+esac
+    AR=$ac_ct_AR
+  fi
 else
   AR=&quot;$ac_cv_prog_AR&quot;
 fi
@@ -2032,8 +2485,8 @@
       if test -n &quot;$ac_tool_prefix&quot;; then
   # Extract the first word of &quot;${ac_tool_prefix}nm&quot;, so it can be a program name with args.
 set dummy ${ac_tool_prefix}nm; ac_word=$2
-echo &quot;$as_me:$LINENO: checking for $ac_word&quot; &gt;&amp;5
-echo $ECHO_N &quot;checking for $ac_word... $ECHO_C&quot; &gt;&amp;6
+{ echo &quot;$as_me:$LINENO: checking for $ac_word&quot; &gt;&amp;5
+echo $ECHO_N &quot;checking for $ac_word... $ECHO_C&quot; &gt;&amp;6; }
 if test &quot;${ac_cv_prog_NM+set}&quot; = set; then
   echo $ECHO_N &quot;(cached) $ECHO_C&quot; &gt;&amp;6
 else
@@ -2046,32 +2499,34 @@
   IFS=$as_save_IFS
   test -z &quot;$as_dir&quot; &amp;&amp; as_dir=.
   for ac_exec_ext in '' $ac_executable_extensions; do
-  if $as_executable_p &quot;$as_dir/$ac_word$ac_exec_ext&quot;; then
+  if { test -f &quot;$as_dir/$ac_word$ac_exec_ext&quot; &amp;&amp; $as_executable_p &quot;$as_dir/$ac_word$ac_exec_ext&quot;; }; then
     ac_cv_prog_NM=&quot;${ac_tool_prefix}nm&quot;
     echo &quot;$as_me:$LINENO: found $as_dir/$ac_word$ac_exec_ext&quot; &gt;&amp;5
     break 2
   fi
 done
 done
+IFS=$as_save_IFS
 
 fi
 fi
 NM=$ac_cv_prog_NM
 if test -n &quot;$NM&quot;; then
-  echo &quot;$as_me:$LINENO: result: $NM&quot; &gt;&amp;5
-echo &quot;${ECHO_T}$NM&quot; &gt;&amp;6
+  { echo &quot;$as_me:$LINENO: result: $NM&quot; &gt;&amp;5
+echo &quot;${ECHO_T}$NM&quot; &gt;&amp;6; }
 else
-  echo &quot;$as_me:$LINENO: result: no&quot; &gt;&amp;5
-echo &quot;${ECHO_T}no&quot; &gt;&amp;6
+  { echo &quot;$as_me:$LINENO: result: no&quot; &gt;&amp;5
+echo &quot;${ECHO_T}no&quot; &gt;&amp;6; }
 fi
 
+
 fi
 if test -z &quot;$ac_cv_prog_NM&quot;; then
   ac_ct_NM=$NM
   # Extract the first word of &quot;nm&quot;, so it can be a program name with args.
 set dummy nm; ac_word=$2
-echo &quot;$as_me:$LINENO: checking for $ac_word&quot; &gt;&amp;5
-echo $ECHO_N &quot;checking for $ac_word... $ECHO_C&quot; &gt;&amp;6
+{ echo &quot;$as_me:$LINENO: checking for $ac_word&quot; &gt;&amp;5
+echo $ECHO_N &quot;checking for $ac_word... $ECHO_C&quot; &gt;&amp;6; }
 if test &quot;${ac_cv_prog_ac_ct_NM+set}&quot; = set; then
   echo $ECHO_N &quot;(cached) $ECHO_C&quot; &gt;&amp;6
 else
@@ -2084,27 +2539,41 @@
   IFS=$as_save_IFS
   test -z &quot;$as_dir&quot; &amp;&amp; as_dir=.
   for ac_exec_ext in '' $ac_executable_extensions; do
-  if $as_executable_p &quot;$as_dir/$ac_word$ac_exec_ext&quot;; then
+  if { test -f &quot;$as_dir/$ac_word$ac_exec_ext&quot; &amp;&amp; $as_executable_p &quot;$as_dir/$ac_word$ac_exec_ext&quot;; }; then
     ac_cv_prog_ac_ct_NM=&quot;nm&quot;
     echo &quot;$as_me:$LINENO: found $as_dir/$ac_word$ac_exec_ext&quot; &gt;&amp;5
     break 2
   fi
 done
 done
+IFS=$as_save_IFS
 
-  test -z &quot;$ac_cv_prog_ac_ct_NM&quot; &amp;&amp; ac_cv_prog_ac_ct_NM=&quot;:&quot;
 fi
 fi
 ac_ct_NM=$ac_cv_prog_ac_ct_NM
 if test -n &quot;$ac_ct_NM&quot;; then
-  echo &quot;$as_me:$LINENO: result: $ac_ct_NM&quot; &gt;&amp;5
-echo &quot;${ECHO_T}$ac_ct_NM&quot; &gt;&amp;6
+  { echo &quot;$as_me:$LINENO: result: $ac_ct_NM&quot; &gt;&amp;5
+echo &quot;${ECHO_T}$ac_ct_NM&quot; &gt;&amp;6; }
 else
-  echo &quot;$as_me:$LINENO: result: no&quot; &gt;&amp;5
-echo &quot;${ECHO_T}no&quot; &gt;&amp;6
+  { echo &quot;$as_me:$LINENO: result: no&quot; &gt;&amp;5
+echo &quot;${ECHO_T}no&quot; &gt;&amp;6; }
 fi
 
-  NM=$ac_ct_NM
+  if test &quot;x$ac_ct_NM&quot; = x; then
+    NM=&quot;:&quot;
+  else
+    case $cross_compiling:$ac_tool_warned in
+yes:)
+{ echo &quot;$as_me:$LINENO: WARNING: In the future, Autoconf will not detect cross-tools
+whose name does not start with the host triplet.  If you think this
+configuration is useful to you, please write to <A HREF="https://lists.berlios.de/mailman/listinfo/solid-pbx-svn">autoconf at gnu.org.</A>&quot; &gt;&amp;5
+echo &quot;$as_me: WARNING: In the future, Autoconf will not detect cross-tools
+whose name does not start with the host triplet.  If you think this
+configuration is useful to you, please write to <A HREF="https://lists.berlios.de/mailman/listinfo/solid-pbx-svn">autoconf at gnu.org.</A>&quot; &gt;&amp;2;}
+ac_tool_warned=yes ;;
+esac
+    NM=$ac_ct_NM
+  fi
 else
   NM=&quot;$ac_cv_prog_NM&quot;
 fi
@@ -2112,8 +2581,8 @@
       if test -n &quot;$ac_tool_prefix&quot;; then
   # Extract the first word of &quot;${ac_tool_prefix}windres&quot;, so it can be a program name with args.
 set dummy ${ac_tool_prefix}windres; ac_word=$2
-echo &quot;$as_me:$LINENO: checking for $ac_word&quot; &gt;&amp;5
-echo $ECHO_N &quot;checking for $ac_word... $ECHO_C&quot; &gt;&amp;6
+{ echo &quot;$as_me:$LINENO: checking for $ac_word&quot; &gt;&amp;5
+echo $ECHO_N &quot;checking for $ac_word... $ECHO_C&quot; &gt;&amp;6; }
 if test &quot;${ac_cv_prog_WINDRES+set}&quot; = set; then
   echo $ECHO_N &quot;(cached) $ECHO_C&quot; &gt;&amp;6
 else
@@ -2126,32 +2595,34 @@
   IFS=$as_save_IFS
   test -z &quot;$as_dir&quot; &amp;&amp; as_dir=.
   for ac_exec_ext in '' $ac_executable_extensions; do
-  if $as_executable_p &quot;$as_dir/$ac_word$ac_exec_ext&quot;; then
+  if { test -f &quot;$as_dir/$ac_word$ac_exec_ext&quot; &amp;&amp; $as_executable_p &quot;$as_dir/$ac_word$ac_exec_ext&quot;; }; then
     ac_cv_prog_WINDRES=&quot;${ac_tool_prefix}windres&quot;
     echo &quot;$as_me:$LINENO: found $as_dir/$ac_word$ac_exec_ext&quot; &gt;&amp;5
     break 2
   fi
 done
 done
+IFS=$as_save_IFS
 
 fi
 fi
 WINDRES=$ac_cv_prog_WINDRES
 if test -n &quot;$WINDRES&quot;; then
-  echo &quot;$as_me:$LINENO: result: $WINDRES&quot; &gt;&amp;5
-echo &quot;${ECHO_T}$WINDRES&quot; &gt;&amp;6
+  { echo &quot;$as_me:$LINENO: result: $WINDRES&quot; &gt;&amp;5
+echo &quot;${ECHO_T}$WINDRES&quot; &gt;&amp;6; }
 else
-  echo &quot;$as_me:$LINENO: result: no&quot; &gt;&amp;5
-echo &quot;${ECHO_T}no&quot; &gt;&amp;6
+  { echo &quot;$as_me:$LINENO: result: no&quot; &gt;&amp;5
+echo &quot;${ECHO_T}no&quot; &gt;&amp;6; }
 fi
 
+
 fi
 if test -z &quot;$ac_cv_prog_WINDRES&quot;; then
   ac_ct_WINDRES=$WINDRES
   # Extract the first word of &quot;windres&quot;, so it can be a program name with args.
 set dummy windres; ac_word=$2
-echo &quot;$as_me:$LINENO: checking for $ac_word&quot; &gt;&amp;5
-echo $ECHO_N &quot;checking for $ac_word... $ECHO_C&quot; &gt;&amp;6
+{ echo &quot;$as_me:$LINENO: checking for $ac_word&quot; &gt;&amp;5
+echo $ECHO_N &quot;checking for $ac_word... $ECHO_C&quot; &gt;&amp;6; }
 if test &quot;${ac_cv_prog_ac_ct_WINDRES+set}&quot; = set; then
   echo $ECHO_N &quot;(cached) $ECHO_C&quot; &gt;&amp;6
 else
@@ -2164,27 +2635,41 @@
   IFS=$as_save_IFS
   test -z &quot;$as_dir&quot; &amp;&amp; as_dir=.
   for ac_exec_ext in '' $ac_executable_extensions; do
-  if $as_executable_p &quot;$as_dir/$ac_word$ac_exec_ext&quot;; then
+  if { test -f &quot;$as_dir/$ac_word$ac_exec_ext&quot; &amp;&amp; $as_executable_p &quot;$as_dir/$ac_word$ac_exec_ext&quot;; }; then
     ac_cv_prog_ac_ct_WINDRES=&quot;windres&quot;
     echo &quot;$as_me:$LINENO: found $as_dir/$ac_word$ac_exec_ext&quot; &gt;&amp;5
     break 2
   fi
 done
 done
+IFS=$as_save_IFS
 
-  test -z &quot;$ac_cv_prog_ac_ct_WINDRES&quot; &amp;&amp; ac_cv_prog_ac_ct_WINDRES=&quot;:&quot;
 fi
 fi
 ac_ct_WINDRES=$ac_cv_prog_ac_ct_WINDRES
 if test -n &quot;$ac_ct_WINDRES&quot;; then
-  echo &quot;$as_me:$LINENO: result: $ac_ct_WINDRES&quot; &gt;&amp;5
-echo &quot;${ECHO_T}$ac_ct_WINDRES&quot; &gt;&amp;6
+  { echo &quot;$as_me:$LINENO: result: $ac_ct_WINDRES&quot; &gt;&amp;5
+echo &quot;${ECHO_T}$ac_ct_WINDRES&quot; &gt;&amp;6; }
 else
-  echo &quot;$as_me:$LINENO: result: no&quot; &gt;&amp;5
-echo &quot;${ECHO_T}no&quot; &gt;&amp;6
+  { echo &quot;$as_me:$LINENO: result: no&quot; &gt;&amp;5
+echo &quot;${ECHO_T}no&quot; &gt;&amp;6; }
 fi
 
-  WINDRES=$ac_ct_WINDRES
+  if test &quot;x$ac_ct_WINDRES&quot; = x; then
+    WINDRES=&quot;:&quot;
+  else
+    case $cross_compiling:$ac_tool_warned in
+yes:)
+{ echo &quot;$as_me:$LINENO: WARNING: In the future, Autoconf will not detect cross-tools
+whose name does not start with the host triplet.  If you think this
+configuration is useful to you, please write to <A HREF="https://lists.berlios.de/mailman/listinfo/solid-pbx-svn">autoconf at gnu.org.</A>&quot; &gt;&amp;5
+echo &quot;$as_me: WARNING: In the future, Autoconf will not detect cross-tools
+whose name does not start with the host triplet.  If you think this
+configuration is useful to you, please write to <A HREF="https://lists.berlios.de/mailman/listinfo/solid-pbx-svn">autoconf at gnu.org.</A>&quot; &gt;&amp;2;}
+ac_tool_warned=yes ;;
+esac
+    WINDRES=$ac_ct_WINDRES
+  fi
 else
   WINDRES=&quot;$ac_cv_prog_WINDRES&quot;
 fi
@@ -2192,8 +2677,8 @@
       if test -n &quot;$ac_tool_prefix&quot;; then
   # Extract the first word of &quot;${ac_tool_prefix}dllwrap&quot;, so it can be a program name with args.
 set dummy ${ac_tool_prefix}dllwrap; ac_word=$2
-echo &quot;$as_me:$LINENO: checking for $ac_word&quot; &gt;&amp;5
-echo $ECHO_N &quot;checking for $ac_word... $ECHO_C&quot; &gt;&amp;6
+{ echo &quot;$as_me:$LINENO: checking for $ac_word&quot; &gt;&amp;5
+echo $ECHO_N &quot;checking for $ac_word... $ECHO_C&quot; &gt;&amp;6; }
 if test &quot;${ac_cv_prog_DLLWRAP+set}&quot; = set; then
   echo $ECHO_N &quot;(cached) $ECHO_C&quot; &gt;&amp;6
 else
@@ -2206,32 +2691,34 @@
   IFS=$as_save_IFS
   test -z &quot;$as_dir&quot; &amp;&amp; as_dir=.
   for ac_exec_ext in '' $ac_executable_extensions; do
-  if $as_executable_p &quot;$as_dir/$ac_word$ac_exec_ext&quot;; then
+  if { test -f &quot;$as_dir/$ac_word$ac_exec_ext&quot; &amp;&amp; $as_executable_p &quot;$as_dir/$ac_word$ac_exec_ext&quot;; }; then
     ac_cv_prog_DLLWRAP=&quot;${ac_tool_prefix}dllwrap&quot;
     echo &quot;$as_me:$LINENO: found $as_dir/$ac_word$ac_exec_ext&quot; &gt;&amp;5
     break 2
   fi
 done
 done
+IFS=$as_save_IFS
 
 fi
 fi
 DLLWRAP=$ac_cv_prog_DLLWRAP
 if test -n &quot;$DLLWRAP&quot;; then
-  echo &quot;$as_me:$LINENO: result: $DLLWRAP&quot; &gt;&amp;5
-echo &quot;${ECHO_T}$DLLWRAP&quot; &gt;&amp;6
+  { echo &quot;$as_me:$LINENO: result: $DLLWRAP&quot; &gt;&amp;5
+echo &quot;${ECHO_T}$DLLWRAP&quot; &gt;&amp;6; }
 else
-  echo &quot;$as_me:$LINENO: result: no&quot; &gt;&amp;5
-echo &quot;${ECHO_T}no&quot; &gt;&amp;6
+  { echo &quot;$as_me:$LINENO: result: no&quot; &gt;&amp;5
+echo &quot;${ECHO_T}no&quot; &gt;&amp;6; }
 fi
 
+
 fi
 if test -z &quot;$ac_cv_prog_DLLWRAP&quot;; then
   ac_ct_DLLWRAP=$DLLWRAP
   # Extract the first word of &quot;dllwrap&quot;, so it can be a program name with args.
 set dummy dllwrap; ac_word=$2
-echo &quot;$as_me:$LINENO: checking for $ac_word&quot; &gt;&amp;5
-echo $ECHO_N &quot;checking for $ac_word... $ECHO_C&quot; &gt;&amp;6
+{ echo &quot;$as_me:$LINENO: checking for $ac_word&quot; &gt;&amp;5
+echo $ECHO_N &quot;checking for $ac_word... $ECHO_C&quot; &gt;&amp;6; }
 if test &quot;${ac_cv_prog_ac_ct_DLLWRAP+set}&quot; = set; then
   echo $ECHO_N &quot;(cached) $ECHO_C&quot; &gt;&amp;6
 else
@@ -2244,27 +2731,41 @@
   IFS=$as_save_IFS
   test -z &quot;$as_dir&quot; &amp;&amp; as_dir=.
   for ac_exec_ext in '' $ac_executable_extensions; do
-  if $as_executable_p &quot;$as_dir/$ac_word$ac_exec_ext&quot;; then
+  if { test -f &quot;$as_dir/$ac_word$ac_exec_ext&quot; &amp;&amp; $as_executable_p &quot;$as_dir/$ac_word$ac_exec_ext&quot;; }; then
     ac_cv_prog_ac_ct_DLLWRAP=&quot;dllwrap&quot;
     echo &quot;$as_me:$LINENO: found $as_dir/$ac_word$ac_exec_ext&quot; &gt;&amp;5
     break 2
   fi
 done
 done
+IFS=$as_save_IFS
 
-  test -z &quot;$ac_cv_prog_ac_ct_DLLWRAP&quot; &amp;&amp; ac_cv_prog_ac_ct_DLLWRAP=&quot;:&quot;
 fi
 fi
 ac_ct_DLLWRAP=$ac_cv_prog_ac_ct_DLLWRAP
 if test -n &quot;$ac_ct_DLLWRAP&quot;; then
-  echo &quot;$as_me:$LINENO: result: $ac_ct_DLLWRAP&quot; &gt;&amp;5
-echo &quot;${ECHO_T}$ac_ct_DLLWRAP&quot; &gt;&amp;6
+  { echo &quot;$as_me:$LINENO: result: $ac_ct_DLLWRAP&quot; &gt;&amp;5
+echo &quot;${ECHO_T}$ac_ct_DLLWRAP&quot; &gt;&amp;6; }
 else
-  echo &quot;$as_me:$LINENO: result: no&quot; &gt;&amp;5
-echo &quot;${ECHO_T}no&quot; &gt;&amp;6
+  { echo &quot;$as_me:$LINENO: result: no&quot; &gt;&amp;5
+echo &quot;${ECHO_T}no&quot; &gt;&amp;6; }
 fi
 
-  DLLWRAP=$ac_ct_DLLWRAP
+  if test &quot;x$ac_ct_DLLWRAP&quot; = x; then
+    DLLWRAP=&quot;:&quot;
+  else
+    case $cross_compiling:$ac_tool_warned in
+yes:)
+{ echo &quot;$as_me:$LINENO: WARNING: In the future, Autoconf will not detect cross-tools
+whose name does not start with the host triplet.  If you think this
+configuration is useful to you, please write to <A HREF="https://lists.berlios.de/mailman/listinfo/solid-pbx-svn">autoconf at gnu.org.</A>&quot; &gt;&amp;5
+echo &quot;$as_me: WARNING: In the future, Autoconf will not detect cross-tools
+whose name does not start with the host triplet.  If you think this
+configuration is useful to you, please write to <A HREF="https://lists.berlios.de/mailman/listinfo/solid-pbx-svn">autoconf at gnu.org.</A>&quot; &gt;&amp;2;}
+ac_tool_warned=yes ;;
+esac
+    DLLWRAP=$ac_ct_DLLWRAP
+  fi
 else
   DLLWRAP=&quot;$ac_cv_prog_DLLWRAP&quot;
 fi
@@ -2282,8 +2783,8 @@
 if test -n &quot;$ac_tool_prefix&quot;; then
   # Extract the first word of &quot;${ac_tool_prefix}gcc&quot;, so it can be a program name with args.
 set dummy ${ac_tool_prefix}gcc; ac_word=$2
-echo &quot;$as_me:$LINENO: checking for $ac_word&quot; &gt;&amp;5
-echo $ECHO_N &quot;checking for $ac_word... $ECHO_C&quot; &gt;&amp;6
+{ echo &quot;$as_me:$LINENO: checking for $ac_word&quot; &gt;&amp;5
+echo $ECHO_N &quot;checking for $ac_word... $ECHO_C&quot; &gt;&amp;6; }
 if test &quot;${ac_cv_prog_CC+set}&quot; = set; then
   echo $ECHO_N &quot;(cached) $ECHO_C&quot; &gt;&amp;6
 else
@@ -2296,32 +2797,34 @@
   IFS=$as_save_IFS
   test -z &quot;$as_dir&quot; &amp;&amp; as_dir=.
   for ac_exec_ext in '' $ac_executable_extensions; do
-  if $as_executable_p &quot;$as_dir/$ac_word$ac_exec_ext&quot;; then
+  if { test -f &quot;$as_dir/$ac_word$ac_exec_ext&quot; &amp;&amp; $as_executable_p &quot;$as_dir/$ac_word$ac_exec_ext&quot;; }; then
     ac_cv_prog_CC=&quot;${ac_tool_prefix}gcc&quot;
     echo &quot;$as_me:$LINENO: found $as_dir/$ac_word$ac_exec_ext&quot; &gt;&amp;5
     break 2
   fi
 done
 done
+IFS=$as_save_IFS
 
 fi
 fi
 CC=$ac_cv_prog_CC
 if test -n &quot;$CC&quot;; then
-  echo &quot;$as_me:$LINENO: result: $CC&quot; &gt;&amp;5
-echo &quot;${ECHO_T}$CC&quot; &gt;&amp;6
+  { echo &quot;$as_me:$LINENO: result: $CC&quot; &gt;&amp;5
+echo &quot;${ECHO_T}$CC&quot; &gt;&amp;6; }
 else
-  echo &quot;$as_me:$LINENO: result: no&quot; &gt;&amp;5
-echo &quot;${ECHO_T}no&quot; &gt;&amp;6
+  { echo &quot;$as_me:$LINENO: result: no&quot; &gt;&amp;5
+echo &quot;${ECHO_T}no&quot; &gt;&amp;6; }
 fi
 
+
 fi
 if test -z &quot;$ac_cv_prog_CC&quot;; then
   ac_ct_CC=$CC
   # Extract the first word of &quot;gcc&quot;, so it can be a program name with args.
 set dummy gcc; ac_word=$2
-echo &quot;$as_me:$LINENO: checking for $ac_word&quot; &gt;&amp;5
-echo $ECHO_N &quot;checking for $ac_word... $ECHO_C&quot; &gt;&amp;6
+{ echo &quot;$as_me:$LINENO: checking for $ac_word&quot; &gt;&amp;5
+echo $ECHO_N &quot;checking for $ac_word... $ECHO_C&quot; &gt;&amp;6; }
 if test &quot;${ac_cv_prog_ac_ct_CC+set}&quot; = set; then
   echo $ECHO_N &quot;(cached) $ECHO_C&quot; &gt;&amp;6
 else
@@ -2334,36 +2837,51 @@
   IFS=$as_save_IFS
   test -z &quot;$as_dir&quot; &amp;&amp; as_dir=.
   for ac_exec_ext in '' $ac_executable_extensions; do
-  if $as_executable_p &quot;$as_dir/$ac_word$ac_exec_ext&quot;; then
+  if { test -f &quot;$as_dir/$ac_word$ac_exec_ext&quot; &amp;&amp; $as_executable_p &quot;$as_dir/$ac_word$ac_exec_ext&quot;; }; then
     ac_cv_prog_ac_ct_CC=&quot;gcc&quot;
     echo &quot;$as_me:$LINENO: found $as_dir/$ac_word$ac_exec_ext&quot; &gt;&amp;5
     break 2
   fi
 done
 done
+IFS=$as_save_IFS
 
 fi
 fi
 ac_ct_CC=$ac_cv_prog_ac_ct_CC
 if test -n &quot;$ac_ct_CC&quot;; then
-  echo &quot;$as_me:$LINENO: result: $ac_ct_CC&quot; &gt;&amp;5
-echo &quot;${ECHO_T}$ac_ct_CC&quot; &gt;&amp;6
+  { echo &quot;$as_me:$LINENO: result: $ac_ct_CC&quot; &gt;&amp;5
+echo &quot;${ECHO_T}$ac_ct_CC&quot; &gt;&amp;6; }
 else
-  echo &quot;$as_me:$LINENO: result: no&quot; &gt;&amp;5
-echo &quot;${ECHO_T}no&quot; &gt;&amp;6
+  { echo &quot;$as_me:$LINENO: result: no&quot; &gt;&amp;5
+echo &quot;${ECHO_T}no&quot; &gt;&amp;6; }
 fi
 
-  CC=$ac_ct_CC
+  if test &quot;x$ac_ct_CC&quot; = x; then
+    CC=&quot;&quot;
+  else
+    case $cross_compiling:$ac_tool_warned in
+yes:)
+{ echo &quot;$as_me:$LINENO: WARNING: In the future, Autoconf will not detect cross-tools
+whose name does not start with the host triplet.  If you think this
+configuration is useful to you, please write to <A HREF="https://lists.berlios.de/mailman/listinfo/solid-pbx-svn">autoconf at gnu.org.</A>&quot; &gt;&amp;5
+echo &quot;$as_me: WARNING: In the future, Autoconf will not detect cross-tools
+whose name does not start with the host triplet.  If you think this
+configuration is useful to you, please write to <A HREF="https://lists.berlios.de/mailman/listinfo/solid-pbx-svn">autoconf at gnu.org.</A>&quot; &gt;&amp;2;}
+ac_tool_warned=yes ;;
+esac
+    CC=$ac_ct_CC
+  fi
 else
   CC=&quot;$ac_cv_prog_CC&quot;
 fi
 
 if test -z &quot;$CC&quot;; then
-  if test -n &quot;$ac_tool_prefix&quot;; then
-  # Extract the first word of &quot;${ac_tool_prefix}cc&quot;, so it can be a program name with args.
+          if test -n &quot;$ac_tool_prefix&quot;; then
+    # Extract the first word of &quot;${ac_tool_prefix}cc&quot;, so it can be a program name with args.
 set dummy ${ac_tool_prefix}cc; ac_word=$2
-echo &quot;$as_me:$LINENO: checking for $ac_word&quot; &gt;&amp;5
-echo $ECHO_N &quot;checking for $ac_word... $ECHO_C&quot; &gt;&amp;6
+{ echo &quot;$as_me:$LINENO: checking for $ac_word&quot; &gt;&amp;5
+echo $ECHO_N &quot;checking for $ac_word... $ECHO_C&quot; &gt;&amp;6; }
 if test &quot;${ac_cv_prog_CC+set}&quot; = set; then
   echo $ECHO_N &quot;(cached) $ECHO_C&quot; &gt;&amp;6
 else
@@ -2376,74 +2894,34 @@
   IFS=$as_save_IFS
   test -z &quot;$as_dir&quot; &amp;&amp; as_dir=.
   for ac_exec_ext in '' $ac_executable_extensions; do
-  if $as_executable_p &quot;$as_dir/$ac_word$ac_exec_ext&quot;; then
+  if { test -f &quot;$as_dir/$ac_word$ac_exec_ext&quot; &amp;&amp; $as_executable_p &quot;$as_dir/$ac_word$ac_exec_ext&quot;; }; then
     ac_cv_prog_CC=&quot;${ac_tool_prefix}cc&quot;
     echo &quot;$as_me:$LINENO: found $as_dir/$ac_word$ac_exec_ext&quot; &gt;&amp;5
     break 2
   fi
 done
 done
+IFS=$as_save_IFS
 
 fi
 fi
 CC=$ac_cv_prog_CC
 if test -n &quot;$CC&quot;; then
-  echo &quot;$as_me:$LINENO: result: $CC&quot; &gt;&amp;5
-echo &quot;${ECHO_T}$CC&quot; &gt;&amp;6
+  { echo &quot;$as_me:$LINENO: result: $CC&quot; &gt;&amp;5
+echo &quot;${ECHO_T}$CC&quot; &gt;&amp;6; }
 else
-  echo &quot;$as_me:$LINENO: result: no&quot; &gt;&amp;5
-echo &quot;${ECHO_T}no&quot; &gt;&amp;6
+  { echo &quot;$as_me:$LINENO: result: no&quot; &gt;&amp;5
+echo &quot;${ECHO_T}no&quot; &gt;&amp;6; }
 fi
 
-fi
-if test -z &quot;$ac_cv_prog_CC&quot;; then
-  ac_ct_CC=$CC
-  # Extract the first word of &quot;cc&quot;, so it can be a program name with args.
-set dummy cc; ac_word=$2
-echo &quot;$as_me:$LINENO: checking for $ac_word&quot; &gt;&amp;5
-echo $ECHO_N &quot;checking for $ac_word... $ECHO_C&quot; &gt;&amp;6
-if test &quot;${ac_cv_prog_ac_ct_CC+set}&quot; = set; then
-  echo $ECHO_N &quot;(cached) $ECHO_C&quot; &gt;&amp;6
-else
-  if test -n &quot;$ac_ct_CC&quot;; then
-  ac_cv_prog_ac_ct_CC=&quot;$ac_ct_CC&quot; # Let the user override the test.
-else
-as_save_IFS=$IFS; IFS=$PATH_SEPARATOR
-for as_dir in $PATH
-do
-  IFS=$as_save_IFS
-  test -z &quot;$as_dir&quot; &amp;&amp; as_dir=.
-  for ac_exec_ext in '' $ac_executable_extensions; do
-  if $as_executable_p &quot;$as_dir/$ac_word$ac_exec_ext&quot;; then
-    ac_cv_prog_ac_ct_CC=&quot;cc&quot;
-    echo &quot;$as_me:$LINENO: found $as_dir/$ac_word$ac_exec_ext&quot; &gt;&amp;5
-    break 2
+
   fi
-done
-done
-
 fi
-fi
-ac_ct_CC=$ac_cv_prog_ac_ct_CC
-if test -n &quot;$ac_ct_CC&quot;; then
-  echo &quot;$as_me:$LINENO: result: $ac_ct_CC&quot; &gt;&amp;5
-echo &quot;${ECHO_T}$ac_ct_CC&quot; &gt;&amp;6
-else
-  echo &quot;$as_me:$LINENO: result: no&quot; &gt;&amp;5
-echo &quot;${ECHO_T}no&quot; &gt;&amp;6
-fi
-
-  CC=$ac_ct_CC
-else
-  CC=&quot;$ac_cv_prog_CC&quot;
-fi
-
-fi
 if test -z &quot;$CC&quot;; then
   # Extract the first word of &quot;cc&quot;, so it can be a program name with args.
 set dummy cc; ac_word=$2
-echo &quot;$as_me:$LINENO: checking for $ac_word&quot; &gt;&amp;5
-echo $ECHO_N &quot;checking for $ac_word... $ECHO_C&quot; &gt;&amp;6
+{ echo &quot;$as_me:$LINENO: checking for $ac_word&quot; &gt;&amp;5
+echo $ECHO_N &quot;checking for $ac_word... $ECHO_C&quot; &gt;&amp;6; }
 if test &quot;${ac_cv_prog_CC+set}&quot; = set; then
   echo $ECHO_N &quot;(cached) $ECHO_C&quot; &gt;&amp;6
 else
@@ -2457,7 +2935,7 @@
   IFS=$as_save_IFS
   test -z &quot;$as_dir&quot; &amp;&amp; as_dir=.
   for ac_exec_ext in '' $ac_executable_extensions; do
-  if $as_executable_p &quot;$as_dir/$ac_word$ac_exec_ext&quot;; then
+  if { test -f &quot;$as_dir/$ac_word$ac_exec_ext&quot; &amp;&amp; $as_executable_p &quot;$as_dir/$ac_word$ac_exec_ext&quot;; }; then
     if test &quot;$as_dir/$ac_word$ac_exec_ext&quot; = &quot;/usr/ucb/cc&quot;; then
        ac_prog_rejected=yes
        continue
@@ -2468,6 +2946,7 @@
   fi
 done
 done
+IFS=$as_save_IFS
 
 if test $ac_prog_rejected = yes; then
   # We found a bogon in the path, so make sure we never use it.
@@ -2485,22 +2964,23 @@
 fi
 CC=$ac_cv_prog_CC
 if test -n &quot;$CC&quot;; then
-  echo &quot;$as_me:$LINENO: result: $CC&quot; &gt;&amp;5
-echo &quot;${ECHO_T}$CC&quot; &gt;&amp;6
+  { echo &quot;$as_me:$LINENO: result: $CC&quot; &gt;&amp;5
+echo &quot;${ECHO_T}$CC&quot; &gt;&amp;6; }
 else
-  echo &quot;$as_me:$LINENO: result: no&quot; &gt;&amp;5
-echo &quot;${ECHO_T}no&quot; &gt;&amp;6
+  { echo &quot;$as_me:$LINENO: result: no&quot; &gt;&amp;5
+echo &quot;${ECHO_T}no&quot; &gt;&amp;6; }
 fi
 
+
 fi
 if test -z &quot;$CC&quot;; then
   if test -n &quot;$ac_tool_prefix&quot;; then
-  for ac_prog in cl
+  for ac_prog in cl.exe
   do
     # Extract the first word of &quot;$ac_tool_prefix$ac_prog&quot;, so it can be a program name with args.
 set dummy $ac_tool_prefix$ac_prog; ac_word=$2
-echo &quot;$as_me:$LINENO: checking for $ac_word&quot; &gt;&amp;5
-echo $ECHO_N &quot;checking for $ac_word... $ECHO_C&quot; &gt;&amp;6
+{ echo &quot;$as_me:$LINENO: checking for $ac_word&quot; &gt;&amp;5
+echo $ECHO_N &quot;checking for $ac_word... $ECHO_C&quot; &gt;&amp;6; }
 if test &quot;${ac_cv_prog_CC+set}&quot; = set; then
   echo $ECHO_N &quot;(cached) $ECHO_C&quot; &gt;&amp;6
 else
@@ -2513,36 +2993,38 @@
   IFS=$as_save_IFS
   test -z &quot;$as_dir&quot; &amp;&amp; as_dir=.
   for ac_exec_ext in '' $ac_executable_extensions; do
-  if $as_executable_p &quot;$as_dir/$ac_word$ac_exec_ext&quot;; then
+  if { test -f &quot;$as_dir/$ac_word$ac_exec_ext&quot; &amp;&amp; $as_executable_p &quot;$as_dir/$ac_word$ac_exec_ext&quot;; }; then
     ac_cv_prog_CC=&quot;$ac_tool_prefix$ac_prog&quot;
     echo &quot;$as_me:$LINENO: found $as_dir/$ac_word$ac_exec_ext&quot; &gt;&amp;5
     break 2
   fi
 done
 done
+IFS=$as_save_IFS
 
 fi
 fi
 CC=$ac_cv_prog_CC
 if test -n &quot;$CC&quot;; then
-  echo &quot;$as_me:$LINENO: result: $CC&quot; &gt;&amp;5
-echo &quot;${ECHO_T}$CC&quot; &gt;&amp;6
+  { echo &quot;$as_me:$LINENO: result: $CC&quot; &gt;&amp;5
+echo &quot;${ECHO_T}$CC&quot; &gt;&amp;6; }
 else
-  echo &quot;$as_me:$LINENO: result: no&quot; &gt;&amp;5
-echo &quot;${ECHO_T}no&quot; &gt;&amp;6
+  { echo &quot;$as_me:$LINENO: result: no&quot; &gt;&amp;5
+echo &quot;${ECHO_T}no&quot; &gt;&amp;6; }
 fi
 
+
     test -n &quot;$CC&quot; &amp;&amp; break
   done
 fi
 if test -z &quot;$CC&quot;; then
   ac_ct_CC=$CC
-  for ac_prog in cl
+  for ac_prog in cl.exe
 do
   # Extract the first word of &quot;$ac_prog&quot;, so it can be a program name with args.
 set dummy $ac_prog; ac_word=$2
-echo &quot;$as_me:$LINENO: checking for $ac_word&quot; &gt;&amp;5
-echo $ECHO_N &quot;checking for $ac_word... $ECHO_C&quot; &gt;&amp;6
+{ echo &quot;$as_me:$LINENO: checking for $ac_word&quot; &gt;&amp;5
+echo $ECHO_N &quot;checking for $ac_word... $ECHO_C&quot; &gt;&amp;6; }
 if test &quot;${ac_cv_prog_ac_ct_CC+set}&quot; = set; then
   echo $ECHO_N &quot;(cached) $ECHO_C&quot; &gt;&amp;6
 else
@@ -2555,29 +3037,45 @@
   IFS=$as_save_IFS
   test -z &quot;$as_dir&quot; &amp;&amp; as_dir=.
   for ac_exec_ext in '' $ac_executable_extensions; do
-  if $as_executable_p &quot;$as_dir/$ac_word$ac_exec_ext&quot;; then
+  if { test -f &quot;$as_dir/$ac_word$ac_exec_ext&quot; &amp;&amp; $as_executable_p &quot;$as_dir/$ac_word$ac_exec_ext&quot;; }; then
     ac_cv_prog_ac_ct_CC=&quot;$ac_prog&quot;
     echo &quot;$as_me:$LINENO: found $as_dir/$ac_word$ac_exec_ext&quot; &gt;&amp;5
     break 2
   fi
 done
 done
+IFS=$as_save_IFS
 
 fi
 fi
 ac_ct_CC=$ac_cv_prog_ac_ct_CC
 if test -n &quot;$ac_ct_CC&quot;; then
-  echo &quot;$as_me:$LINENO: result: $ac_ct_CC&quot; &gt;&amp;5
-echo &quot;${ECHO_T}$ac_ct_CC&quot; &gt;&amp;6
+  { echo &quot;$as_me:$LINENO: result: $ac_ct_CC&quot; &gt;&amp;5
+echo &quot;${ECHO_T}$ac_ct_CC&quot; &gt;&amp;6; }
 else
-  echo &quot;$as_me:$LINENO: result: no&quot; &gt;&amp;5
-echo &quot;${ECHO_T}no&quot; &gt;&amp;6
+  { echo &quot;$as_me:$LINENO: result: no&quot; &gt;&amp;5
+echo &quot;${ECHO_T}no&quot; &gt;&amp;6; }
 fi
 
+
   test -n &quot;$ac_ct_CC&quot; &amp;&amp; break
 done
 
-  CC=$ac_ct_CC
+  if test &quot;x$ac_ct_CC&quot; = x; then
+    CC=&quot;&quot;
+  else
+    case $cross_compiling:$ac_tool_warned in
+yes:)
+{ echo &quot;$as_me:$LINENO: WARNING: In the future, Autoconf will not detect cross-tools
+whose name does not start with the host triplet.  If you think this
+configuration is useful to you, please write to <A HREF="https://lists.berlios.de/mailman/listinfo/solid-pbx-svn">autoconf at gnu.org.</A>&quot; &gt;&amp;5
+echo &quot;$as_me: WARNING: In the future, Autoconf will not detect cross-tools
+whose name does not start with the host triplet.  If you think this
+configuration is useful to you, please write to <A HREF="https://lists.berlios.de/mailman/listinfo/solid-pbx-svn">autoconf at gnu.org.</A>&quot; &gt;&amp;2;}
+ac_tool_warned=yes ;;
+esac
+    CC=$ac_ct_CC
+  fi
 fi
 
 fi
@@ -2590,25 +3088,38 @@
    { (exit 1); exit 1; }; }
 
 # Provide some information about the compiler.
-echo &quot;$as_me:$LINENO:&quot; \
-     &quot;checking for C compiler version&quot; &gt;&amp;5
+echo &quot;$as_me:$LINENO: checking for C compiler version&quot; &gt;&amp;5
 ac_compiler=`set X $ac_compile; echo $2`
-{ (eval echo &quot;$as_me:$LINENO: \&quot;$ac_compiler --version &lt;/dev/null &gt;&amp;5\&quot;&quot;) &gt;&amp;5
-  (eval $ac_compiler --version &lt;/dev/null &gt;&amp;5) 2&gt;&amp;5
+{ (eval echo &quot;$as_me:$LINENO: \&quot;$ac_compiler --version &gt;&amp;5\&quot;&quot;) &gt;&amp;5
+  (eval $ac_compiler --version &gt;&amp;5) 2&gt;&amp;5
   ac_status=$?
   echo &quot;$as_me:$LINENO: \$? = $ac_status&quot; &gt;&amp;5
   (exit $ac_status); }
-{ (eval echo &quot;$as_me:$LINENO: \&quot;$ac_compiler -v &lt;/dev/null &gt;&amp;5\&quot;&quot;) &gt;&amp;5
-  (eval $ac_compiler -v &lt;/dev/null &gt;&amp;5) 2&gt;&amp;5
+{ (eval echo &quot;$as_me:$LINENO: \&quot;$ac_compiler -v &gt;&amp;5\&quot;&quot;) &gt;&amp;5
+  (eval $ac_compiler -v &gt;&amp;5) 2&gt;&amp;5
   ac_status=$?
   echo &quot;$as_me:$LINENO: \$? = $ac_status&quot; &gt;&amp;5
   (exit $ac_status); }
-{ (eval echo &quot;$as_me:$LINENO: \&quot;$ac_compiler -V &lt;/dev/null &gt;&amp;5\&quot;&quot;) &gt;&amp;5
-  (eval $ac_compiler -V &lt;/dev/null &gt;&amp;5) 2&gt;&amp;5
+{ (eval echo &quot;$as_me:$LINENO: \&quot;$ac_compiler -V &gt;&amp;5\&quot;&quot;) &gt;&amp;5
+  (eval $ac_compiler -V &gt;&amp;5) 2&gt;&amp;5
   ac_status=$?
   echo &quot;$as_me:$LINENO: \$? = $ac_status&quot; &gt;&amp;5
   (exit $ac_status); }
 
+
+# List of possible output files.  We want to start from the most likely,
+# but we have to check foo.exe before foo, because Cygwin `test -f' looks
+# also for foo.exe.  b.out is created by i960 compilers.
+# As a last resort, we also try wildcards: `conftest.*' and `a.*'.
+# But we are not allowed to rm a.*, and we do not want always remove
+# conftest.*, so we will list them literally, when appropriate.
+ac_outfiles=&quot;a_out.exe a.out conftest.exe conftest a.exe b.out&quot;
+
+# The IRIX 6 linker writes into existing files which may not be
+# executable, retaining their permissions.  Remove them first so a
+# subsequent execution test works.
+rm -f $ac_outfiles conftest.*
+
 cat &gt;conftest.$ac_ext &lt;&lt;_ACEOF
 /* confdefs.h.  */
 _ACEOF
@@ -2624,51 +3135,40 @@
   return 0;
 }
 _ACEOF
+
 ac_clean_files_save=$ac_clean_files
-ac_clean_files=&quot;$ac_clean_files a.out a.exe b.out&quot;
+ac_clean_files=&quot;$ac_clean_files $ac_outfiles&quot;
+
+# The following tests should remove their output except files matching conftest.*.
 # Try to create an executable without -o first, disregard a.out.
 # It will help us diagnose broken compilers, and finding out an intuition
 # of exeext.
-echo &quot;$as_me:$LINENO: checking for C compiler default output file name&quot; &gt;&amp;5
-echo $ECHO_N &quot;checking for C compiler default output file name... $ECHO_C&quot; &gt;&amp;6
+{ echo &quot;$as_me:$LINENO: checking for C compiler default output file name&quot; &gt;&amp;5
+echo $ECHO_N &quot;checking for C compiler default output file name... $ECHO_C&quot; &gt;&amp;6; }
 ac_link_default=`echo &quot;$ac_link&quot; | sed 's/ -o *conftest[^ ]*//'`
+
 if { (eval echo &quot;$as_me:$LINENO: \&quot;$ac_link_default\&quot;&quot;) &gt;&amp;5
   (eval $ac_link_default) 2&gt;&amp;5
   ac_status=$?
   echo &quot;$as_me:$LINENO: \$? = $ac_status&quot; &gt;&amp;5
   (exit $ac_status); }; then
-  # Find the output, starting from the most likely.  This scheme is
-# not robust to junk in `.', hence go to wildcards (a.*) only as a last
-# resort.
-
-# Be careful to initialize this variable, since it used to be cached.
-# Otherwise an old cache value of `no' led to `EXEEXT = no' in a Makefile.
-ac_cv_exeext=
-# b.out is created by i960 compilers.
-for ac_file in a_out.exe a.exe conftest.exe a.out conftest a.* conftest.* b.out
+  for ac_file in $ac_outfiles a.* conftest.* NO
 do
   test -f &quot;$ac_file&quot; || continue
   case $ac_file in
-    *.$ac_ext | *.xcoff | *.tds | *.d | *.pdb | *.xSYM | *.bb | *.bbg | *.o | *.obj )
-	;;
-    conftest.$ac_ext )
-	# This is the source file.
-	;;
-    [ab].out )
-	# We found the default executable, but exeext='' is most
-	# certainly right.
-	break;;
-    *.* )
-	ac_cv_exeext=`expr &quot;$ac_file&quot; : '[^.]*\(\..*\)'`
-	# FIXME: I believe we export ac_cv_exeext for Libtool,
-	# but it would be cool to find out if it's true.  Does anybody
-	# maintain Libtool? --akim.
-	export ac_cv_exeext
-	break;;
-    * )
-	break;;
+    *.$ac_ext | *.xcoff | *.tds | *.d | *.pdb | *.xSYM | *.bb | *.bbg | *.map | *.inf | *.o | *.obj ) ;;
+    * ) break;;
   esac
 done
+if test &quot;$ac_file&quot; = NO; then
+  { { echo &quot;$as_me:$LINENO: error: no output file found
+See \`config.log' for more details.&quot; &gt;&amp;5
+echo &quot;$as_me: error: no output file found
+See \`config.log' for more details.&quot; &gt;&amp;2;}
+   { (exit 1); exit 1; }; }
+fi
+
+
 else
   echo &quot;$as_me: failed program was:&quot; &gt;&amp;5
 sed 's/^/| /' conftest.$ac_ext &gt;&amp;5
@@ -2680,14 +3180,12 @@
    { (exit 77); exit 77; }; }
 fi
 
-ac_exeext=$ac_cv_exeext
-echo &quot;$as_me:$LINENO: result: $ac_file&quot; &gt;&amp;5
-echo &quot;${ECHO_T}$ac_file&quot; &gt;&amp;6
-
-# Check the compiler produces executables we can run.  If not, either
+{ echo &quot;$as_me:$LINENO: result: $ac_file&quot; &gt;&amp;5
+echo &quot;${ECHO_T}$ac_file&quot; &gt;&amp;6; }
+# Check that the compiler produces executables we can run.  If not, either
 # the compiler is broken, or we cross compile.
-echo &quot;$as_me:$LINENO: checking whether the C compiler works&quot; &gt;&amp;5
-echo $ECHO_N &quot;checking whether the C compiler works... $ECHO_C&quot; &gt;&amp;6
+{ echo &quot;$as_me:$LINENO: checking whether the C compiler works&quot; &gt;&amp;5
+echo $ECHO_N &quot;checking whether the C compiler works... $ECHO_C&quot; &gt;&amp;6; }
 # FIXME: These cross compiler hacks should be removed for Autoconf 3.0
 # If not cross compiling, check that we can run a simple program.
 if test &quot;$cross_compiling&quot; != yes; then
@@ -2712,83 +3210,84 @@
     fi
   fi
 fi
-echo &quot;$as_me:$LINENO: result: yes&quot; &gt;&amp;5
-echo &quot;${ECHO_T}yes&quot; &gt;&amp;6
+{ echo &quot;$as_me:$LINENO: result: yes&quot; &gt;&amp;5
+echo &quot;${ECHO_T}yes&quot; &gt;&amp;6; }
 
-rm -f a.out a.exe conftest$ac_cv_exeext b.out
-ac_clean_files=$ac_clean_files_save
-# Check the compiler produces executables we can run.  If not, either
-# the compiler is broken, or we cross compile.
-echo &quot;$as_me:$LINENO: checking whether we are cross compiling&quot; &gt;&amp;5
-echo $ECHO_N &quot;checking whether we are cross compiling... $ECHO_C&quot; &gt;&amp;6
-echo &quot;$as_me:$LINENO: result: $cross_compiling&quot; &gt;&amp;5
-echo &quot;${ECHO_T}$cross_compiling&quot; &gt;&amp;6
+# Clean up; list also $ac_file, in case it matched a wildcard entry.
+rm -f $ac_outfiles $ac_file
 
-echo &quot;$as_me:$LINENO: checking for suffix of executables&quot; &gt;&amp;5
-echo $ECHO_N &quot;checking for suffix of executables... $ECHO_C&quot; &gt;&amp;6
-if { (eval echo &quot;$as_me:$LINENO: \&quot;$ac_link\&quot;&quot;) &gt;&amp;5
+{ echo &quot;$as_me:$LINENO: checking whether we are cross compiling&quot; &gt;&amp;5
+echo $ECHO_N &quot;checking whether we are cross compiling... $ECHO_C&quot; &gt;&amp;6; }
+{ echo &quot;$as_me:$LINENO: result: $cross_compiling&quot; &gt;&amp;5
+echo &quot;${ECHO_T}$cross_compiling&quot; &gt;&amp;6; }
+
+{ echo &quot;$as_me:$LINENO: checking for suffix of executables&quot; &gt;&amp;5
+echo $ECHO_N &quot;checking for suffix of executables... $ECHO_C&quot; &gt;&amp;6; }
+if test &quot;${ac_cv_exeext+set}&quot; = set; then
+  echo $ECHO_N &quot;(cached) $ECHO_C&quot; &gt;&amp;6
+else
+  if { (eval echo &quot;$as_me:$LINENO: \&quot;$ac_link\&quot;&quot;) &gt;&amp;5
   (eval $ac_link) 2&gt;&amp;5
   ac_status=$?
   echo &quot;$as_me:$LINENO: \$? = $ac_status&quot; &gt;&amp;5
   (exit $ac_status); }; then
-  # If both `conftest.exe' and `conftest' are `present' (well, observable)
-# catch `conftest.exe'.  For instance with Cygwin, `ls conftest' will
-# work properly (i.e., refer to `conftest.exe'), while it won't with
-# `rm'.
-for ac_file in conftest.exe conftest conftest.*; do
-  test -f &quot;$ac_file&quot; || continue
-  case $ac_file in
-    *.$ac_ext | *.xcoff | *.tds | *.d | *.pdb | *.xSYM | *.bb | *.bbg | *.o | *.obj ) ;;
-    *.* ) ac_cv_exeext=`expr &quot;$ac_file&quot; : '[^.]*\(\..*\)'`
-	  export ac_cv_exeext
-	  break;;
-    * ) break;;
-  esac
-done
+  # If both `conftest.exe' and `conftest' are `present' (well, observable),
+    # catch `conftest.exe'.  For instance with Cygwin, `ls conftest' will
+    # work properly (i.e., refer to `conftest.exe'), while it won't with `rm'.
+    for ac_file in conftest.exe conftest conftest.* NO; do
+      test -f &quot;$ac_file&quot; || continue
+      case $ac_file in
+	*.$ac_ext | *.xcoff | *.tds | *.d | *.pdb | *.xSYM | *.bb | *.bbg | *.map | *.inf | *.o | *.obj ) ;;
+	*.* ) ac_cv_exeext=`expr &quot;$ac_file&quot; : '[^.]*\(\..*\)'`
+	      break;;
+	* ) break;;
+      esac
+    done
+    if test &quot;$ac_file&quot; = NO; then
+  { { echo &quot;$as_me:$LINENO: error: cannot compute suffix of executables: no output file found
+See \`config.log' for more details.&quot; &gt;&amp;5
+echo &quot;$as_me: error: cannot compute suffix of executables: no output file found
+See \`config.log' for more details.&quot; &gt;&amp;2;}
+   { (exit 1); exit 1; }; }
+fi
+
+    # Clean up; list also $ac_file, in case it matched conftest.*.
+    rm -f $ac_outfiles $ac_file
+
 else
   { { echo &quot;$as_me:$LINENO: error: cannot compute suffix of executables: cannot compile and link
 See \`config.log' for more details.&quot; &gt;&amp;5
 echo &quot;$as_me: error: cannot compute suffix of executables: cannot compile and link
 See \`config.log' for more details.&quot; &gt;&amp;2;}
    { (exit 1); exit 1; }; }
+
 fi
 
-rm -f conftest$ac_cv_exeext
-echo &quot;$as_me:$LINENO: result: $ac_cv_exeext&quot; &gt;&amp;5
-echo &quot;${ECHO_T}$ac_cv_exeext&quot; &gt;&amp;6
 
-rm -f conftest.$ac_ext
+fi
+{ echo &quot;$as_me:$LINENO: result: $ac_cv_exeext&quot; &gt;&amp;5
+echo &quot;${ECHO_T}$ac_cv_exeext&quot; &gt;&amp;6; }
 EXEEXT=$ac_cv_exeext
 ac_exeext=$EXEEXT
-echo &quot;$as_me:$LINENO: checking for suffix of object files&quot; &gt;&amp;5
-echo $ECHO_N &quot;checking for suffix of object files... $ECHO_C&quot; &gt;&amp;6
+
+
+ac_clean_files=$ac_clean_files_save
+
+{ echo &quot;$as_me:$LINENO: checking for suffix of object files&quot; &gt;&amp;5
+echo $ECHO_N &quot;checking for suffix of object files... $ECHO_C&quot; &gt;&amp;6; }
 if test &quot;${ac_cv_objext+set}&quot; = set; then
   echo $ECHO_N &quot;(cached) $ECHO_C&quot; &gt;&amp;6
 else
-  cat &gt;conftest.$ac_ext &lt;&lt;_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h &gt;&gt;conftest.$ac_ext
-cat &gt;&gt;conftest.$ac_ext &lt;&lt;_ACEOF
-/* end confdefs.h.  */
-
-int
-main ()
-{
-
-  ;
-  return 0;
-}
-_ACEOF
-rm -f conftest.o conftest.obj
+  rm -f conftest.o conftest.obj
 if { (eval echo &quot;$as_me:$LINENO: \&quot;$ac_compile\&quot;&quot;) &gt;&amp;5
   (eval $ac_compile) 2&gt;&amp;5
   ac_status=$?
   echo &quot;$as_me:$LINENO: \$? = $ac_status&quot; &gt;&amp;5
   (exit $ac_status); }; then
-  for ac_file in `(ls conftest.o conftest.obj; ls conftest.*) 2&gt;/dev/null`; do
+  for ac_file in conftest.o conftest.obj conftest.*; do
+  test -f &quot;$ac_file&quot; || continue;
   case $ac_file in
-    *.$ac_ext | *.xcoff | *.tds | *.d | *.pdb | *.xSYM | *.bb | *.bbg ) ;;
+    *.$ac_ext | *.xcoff | *.tds | *.d | *.pdb | *.xSYM | *.bb | *.bbg | *.map | *.inf ) ;;
     *) ac_cv_objext=`expr &quot;$ac_file&quot; : '.*\.\(.*\)'`
        break;;
   esac
@@ -2804,14 +3303,16 @@
    { (exit 1); exit 1; }; }
 fi
 
-rm -f conftest.$ac_cv_objext conftest.$ac_ext
 fi
-echo &quot;$as_me:$LINENO: result: $ac_cv_objext&quot; &gt;&amp;5
-echo &quot;${ECHO_T}$ac_cv_objext&quot; &gt;&amp;6
+{ echo &quot;$as_me:$LINENO: result: $ac_cv_objext&quot; &gt;&amp;5
+echo &quot;${ECHO_T}$ac_cv_objext&quot; &gt;&amp;6; }
 OBJEXT=$ac_cv_objext
 ac_objext=$OBJEXT
-echo &quot;$as_me:$LINENO: checking whether we are using the GNU C compiler&quot; &gt;&amp;5
-echo $ECHO_N &quot;checking whether we are using the GNU C compiler... $ECHO_C&quot; &gt;&amp;6
+
+
+rm -f conftest.*
+{ echo &quot;$as_me:$LINENO: checking whether we are using the GNU C compiler&quot; &gt;&amp;5
+echo $ECHO_N &quot;checking whether we are using the GNU C compiler... $ECHO_C&quot; &gt;&amp;6; }
 if test &quot;${ac_cv_c_compiler_gnu+set}&quot; = set; then
   echo $ECHO_N &quot;(cached) $ECHO_C&quot; &gt;&amp;6
 else
@@ -2860,24 +3361,28 @@
   echo &quot;$as_me: failed program was:&quot; &gt;&amp;5
 sed 's/^/| /' conftest.$ac_ext &gt;&amp;5
 
-ac_compiler_gnu=no
+	ac_compiler_gnu=no
 fi
+
 rm -f conftest.err conftest.$ac_objext conftest.$ac_ext
 ac_cv_c_compiler_gnu=$ac_compiler_gnu
 
 fi
-echo &quot;$as_me:$LINENO: result: $ac_cv_c_compiler_gnu&quot; &gt;&amp;5
-echo &quot;${ECHO_T}$ac_cv_c_compiler_gnu&quot; &gt;&amp;6
+{ echo &quot;$as_me:$LINENO: result: $ac_cv_c_compiler_gnu&quot; &gt;&amp;5
+echo &quot;${ECHO_T}$ac_cv_c_compiler_gnu&quot; &gt;&amp;6; }
 GCC=`test $ac_compiler_gnu = yes &amp;&amp; echo yes`
 ac_test_CFLAGS=${CFLAGS+set}
 ac_save_CFLAGS=$CFLAGS
-CFLAGS=&quot;-g&quot;
-echo &quot;$as_me:$LINENO: checking whether $CC accepts -g&quot; &gt;&amp;5
-echo $ECHO_N &quot;checking whether $CC accepts -g... $ECHO_C&quot; &gt;&amp;6
+{ echo &quot;$as_me:$LINENO: checking whether $CC accepts -g&quot; &gt;&amp;5
+echo $ECHO_N &quot;checking whether $CC accepts -g... $ECHO_C&quot; &gt;&amp;6; }
 if test &quot;${ac_cv_prog_cc_g+set}&quot; = set; then
   echo $ECHO_N &quot;(cached) $ECHO_C&quot; &gt;&amp;6
 else
-  cat &gt;conftest.$ac_ext &lt;&lt;_ACEOF
+  ac_save_c_werror_flag=$ac_c_werror_flag
+   ac_c_werror_flag=yes
+   ac_cv_prog_cc_g=no
+   CFLAGS=&quot;-g&quot;
+   cat &gt;conftest.$ac_ext &lt;&lt;_ACEOF
 /* confdefs.h.  */
 _ACEOF
 cat confdefs.h &gt;&gt;conftest.$ac_ext
@@ -2919,97 +3424,23 @@
   echo &quot;$as_me: failed program was:&quot; &gt;&amp;5
 sed 's/^/| /' conftest.$ac_ext &gt;&amp;5
 
-ac_cv_prog_cc_g=no
-fi
-rm -f conftest.err conftest.$ac_objext conftest.$ac_ext
-fi
-echo &quot;$as_me:$LINENO: result: $ac_cv_prog_cc_g&quot; &gt;&amp;5
-echo &quot;${ECHO_T}$ac_cv_prog_cc_g&quot; &gt;&amp;6
-if test &quot;$ac_test_CFLAGS&quot; = set; then
-  CFLAGS=$ac_save_CFLAGS
-elif test $ac_cv_prog_cc_g = yes; then
-  if test &quot;$GCC&quot; = yes; then
-    CFLAGS=&quot;-g -O2&quot;
-  else
-    CFLAGS=&quot;-g&quot;
-  fi
-else
-  if test &quot;$GCC&quot; = yes; then
-    CFLAGS=&quot;-O2&quot;
-  else
-    CFLAGS=
-  fi
-fi
-echo &quot;$as_me:$LINENO: checking for $CC option to accept ANSI C&quot; &gt;&amp;5
-echo $ECHO_N &quot;checking for $CC option to accept ANSI C... $ECHO_C&quot; &gt;&amp;6
-if test &quot;${ac_cv_prog_cc_stdc+set}&quot; = set; then
-  echo $ECHO_N &quot;(cached) $ECHO_C&quot; &gt;&amp;6
-else
-  ac_cv_prog_cc_stdc=no
-ac_save_CC=$CC
-cat &gt;conftest.$ac_ext &lt;&lt;_ACEOF
+	CFLAGS=&quot;&quot;
+      cat &gt;conftest.$ac_ext &lt;&lt;_ACEOF
 /* confdefs.h.  */
 _ACEOF
 cat confdefs.h &gt;&gt;conftest.$ac_ext
 cat &gt;&gt;conftest.$ac_ext &lt;&lt;_ACEOF
 /* end confdefs.h.  */
-#include &lt;stdarg.h&gt;
-#include &lt;stdio.h&gt;
-#include &lt;sys/types.h&gt;
-#include &lt;sys/stat.h&gt;
-/* Most of the following tests are stolen from RCS 5.7's src/conf.sh.  */
-struct buf { int x; };
-FILE * (*rcsopen) (struct buf *, struct stat *, int);
-static char *e (p, i)
-     char **p;
-     int i;
-{
-  return p[i];
-}
-static char *f (char * (*g) (char **, int), char **p, ...)
-{
-  char *s;
-  va_list v;
-  va_start (v,p);
-  s = g (p, va_arg (v,int));
-  va_end (v);
-  return s;
-}
 
-/* OSF 4.0 Compaq cc is some sort of almost-ANSI by default.  It has
-   function prototypes and stuff, but not '\xHH' hex character constants.
-   These don't provoke an error unfortunately, instead are silently treated
-   as 'x'.  The following induces an error, until -std1 is added to get
-   proper ANSI mode.  Curiously '\x00'!='x' always comes out true, for an
-   array size at least.  It's necessary to write '\x00'==0 to get something
-   that's true only with -std1.  */
-int osf4_cc_array ['\x00' == 0 ? 1 : -1];
-
-int test (int i, double x);
-struct s1 {int (*f) (int a);};
-struct s2 {int (*f) (double a);};
-int pairnames (int, char **, FILE *(*)(struct buf *, struct stat *, int), int, int);
-int argc;
-char **argv;
 int
 main ()
 {
-return f (e, argv, 0) != argv[0]  ||  f (e, argv, 1) != argv[1];
+
   ;
   return 0;
 }
 _ACEOF
-# Don't try gcc -ansi; that turns off useful extensions and
-# breaks some systems' header files.
-# AIX			-qlanglvl=ansi
-# Ultrix and OSF/1	-std1
-# HP-UX 10.20 and later	-Ae
-# HP-UX older versions	-Aa -D_HPUX_SOURCE
-# SVR4			-Xc -D__EXTENSIONS__
-for ac_arg in &quot;&quot; -qlanglvl=ansi -std1 -Ae &quot;-Aa -D_HPUX_SOURCE&quot; &quot;-Xc -D__EXTENSIONS__&quot;
-do
-  CC=&quot;$ac_save_CC $ac_arg&quot;
-  rm -f conftest.$ac_objext
+rm -f conftest.$ac_objext
 if { (eval echo &quot;$as_me:$LINENO: \&quot;$ac_compile\&quot;&quot;) &gt;&amp;5
   (eval $ac_compile) 2&gt;conftest.er1
   ac_status=$?
@@ -3132,30 +3563,104 @@
   ac_status=$?
   echo &quot;$as_me:$LINENO: \$? = $ac_status&quot; &gt;&amp;5
   (exit $ac_status); }; }; then
-  :
+  ac_cv_prog_cc_g=yes
 else
   echo &quot;$as_me: failed program was:&quot; &gt;&amp;5
 sed 's/^/| /' conftest.$ac_ext &gt;&amp;5
 
-continue
+
 fi
+
 rm -f conftest.err conftest.$ac_objext conftest.$ac_ext
-  cat &gt;conftest.$ac_ext &lt;&lt;_ACEOF
+fi
+
+rm -f conftest.err conftest.$ac_objext conftest.$ac_ext
+fi
+
+rm -f conftest.err conftest.$ac_objext conftest.$ac_ext
+   ac_c_werror_flag=$ac_save_c_werror_flag
+fi
+{ echo &quot;$as_me:$LINENO: result: $ac_cv_prog_cc_g&quot; &gt;&amp;5
+echo &quot;${ECHO_T}$ac_cv_prog_cc_g&quot; &gt;&amp;6; }
+if test &quot;$ac_test_CFLAGS&quot; = set; then
+  CFLAGS=$ac_save_CFLAGS
+elif test $ac_cv_prog_cc_g = yes; then
+  if test &quot;$GCC&quot; = yes; then
+    CFLAGS=&quot;-g -O2&quot;
+  else
+    CFLAGS=&quot;-g&quot;
+  fi
+else
+  if test &quot;$GCC&quot; = yes; then
+    CFLAGS=&quot;-O2&quot;
+  else
+    CFLAGS=
+  fi
+fi
+{ echo &quot;$as_me:$LINENO: checking for $CC option to accept ISO C89&quot; &gt;&amp;5
+echo $ECHO_N &quot;checking for $CC option to accept ISO C89... $ECHO_C&quot; &gt;&amp;6; }
+if test &quot;${ac_cv_prog_cc_c89+set}&quot; = set; then
+  echo $ECHO_N &quot;(cached) $ECHO_C&quot; &gt;&amp;6
+else
+  ac_cv_prog_cc_c89=no
+ac_save_CC=$CC
+cat &gt;conftest.$ac_ext &lt;&lt;_ACEOF
 /* confdefs.h.  */
 _ACEOF
 cat confdefs.h &gt;&gt;conftest.$ac_ext
 cat &gt;&gt;conftest.$ac_ext &lt;&lt;_ACEOF
 /* end confdefs.h.  */
-$ac_declaration
+#include &lt;stdarg.h&gt;
+#include &lt;stdio.h&gt;
+#include &lt;sys/types.h&gt;
+#include &lt;sys/stat.h&gt;
+/* Most of the following tests are stolen from RCS 5.7's src/conf.sh.  */
+struct buf { int x; };
+FILE * (*rcsopen) (struct buf *, struct stat *, int);
+static char *e (p, i)
+     char **p;
+     int i;
+{
+  return p[i];
+}
+static char *f (char * (*g) (char **, int), char **p, ...)
+{
+  char *s;
+  va_list v;
+  va_start (v,p);
+  s = g (p, va_arg (v,int));
+  va_end (v);
+  return s;
+}
+
+/* OSF 4.0 Compaq cc is some sort of almost-ANSI by default.  It has
+   function prototypes and stuff, but not '\xHH' hex character constants.
+   These don't provoke an error unfortunately, instead are silently treated
+   as 'x'.  The following induces an error, until -std is added to get
+   proper ANSI mode.  Curiously '\x00'!='x' always comes out true, for an
+   array size at least.  It's necessary to write '\x00'==0 to get something
+   that's true only with -std.  */
+int osf4_cc_array ['\x00' == 0 ? 1 : -1];
+
+int test (int i, double x);
+struct s1 {int (*f) (int a);};
+struct s2 {int (*f) (double a);};
+int pairnames (int, char **, FILE *(*)(struct buf *, struct stat *, int), int, int);
+int argc;
+char **argv;
 int
 main ()
 {
-exit (42);
+return f (e, argv, 0) != argv[0]  ||  f (e, argv, 1) != argv[1];
   ;
   return 0;
 }
 _ACEOF
-rm -f conftest.$ac_objext
+for ac_arg in '' -qlanglvl=extc89 -qlanglvl=ansi -std \
+	-Ae &quot;-Aa -D_HPUX_SOURCE&quot; &quot;-Xc -D__EXTENSIONS__&quot;
+do
+  CC=&quot;$ac_save_CC $ac_arg&quot;
+  rm -f conftest.$ac_objext
 if { (eval echo &quot;$as_me:$LINENO: \&quot;$ac_compile\&quot;&quot;) &gt;&amp;5
   (eval $ac_compile) 2&gt;conftest.er1
   ac_status=$?
@@ -3177,45 +3682,58 @@
   ac_status=$?
   echo &quot;$as_me:$LINENO: \$? = $ac_status&quot; &gt;&amp;5
   (exit $ac_status); }; }; then
-  break
+  ac_cv_prog_cc_c89=$ac_arg
 else
   echo &quot;$as_me: failed program was:&quot; &gt;&amp;5
 sed 's/^/| /' conftest.$ac_ext &gt;&amp;5
 
+
 fi
-rm -f conftest.err conftest.$ac_objext conftest.$ac_ext
+
+rm -f conftest.err conftest.$ac_objext
+  test &quot;x$ac_cv_prog_cc_c89&quot; != &quot;xno&quot; &amp;&amp; break
 done
-rm -f conftest*
-if test -n &quot;$ac_declaration&quot;; then
-  echo '#ifdef __cplusplus' &gt;&gt;confdefs.h
-  echo $ac_declaration      &gt;&gt;confdefs.h
-  echo '#endif'             &gt;&gt;confdefs.h
+rm -f conftest.$ac_ext
+CC=$ac_save_CC
+
 fi
+# AC_CACHE_VAL
+case &quot;x$ac_cv_prog_cc_c89&quot; in
+  x)
+    { echo &quot;$as_me:$LINENO: result: none needed&quot; &gt;&amp;5
+echo &quot;${ECHO_T}none needed&quot; &gt;&amp;6; } ;;
+  xno)
+    { echo &quot;$as_me:$LINENO: result: unsupported&quot; &gt;&amp;5
+echo &quot;${ECHO_T}unsupported&quot; &gt;&amp;6; } ;;
+  *)
+    CC=&quot;$CC $ac_cv_prog_cc_c89&quot;
+    { echo &quot;$as_me:$LINENO: result: $ac_cv_prog_cc_c89&quot; &gt;&amp;5
+echo &quot;${ECHO_T}$ac_cv_prog_cc_c89&quot; &gt;&amp;6; } ;;
+esac
 
-else
-  echo &quot;$as_me: failed program was:&quot; &gt;&amp;5
-sed 's/^/| /' conftest.$ac_ext &gt;&amp;5
 
-fi
-rm -f conftest.err conftest.$ac_objext conftest.$ac_ext
 ac_ext=c
 ac_cpp='$CPP $CPPFLAGS'
 ac_compile='$CC -c $CFLAGS $CPPFLAGS conftest.$ac_ext &gt;&amp;5'
 ac_link='$CC -o conftest$ac_exeext $CFLAGS $CPPFLAGS $LDFLAGS conftest.$ac_ext $LIBS &gt;&amp;5'
 ac_compiler_gnu=$ac_cv_c_compiler_gnu
 
-ac_ext=cc
+ac_ext=cpp
 ac_cpp='$CXXCPP $CPPFLAGS'
 ac_compile='$CXX -c $CXXFLAGS $CPPFLAGS conftest.$ac_ext &gt;&amp;5'
 ac_link='$CXX -o conftest$ac_exeext $CXXFLAGS $CPPFLAGS $LDFLAGS conftest.$ac_ext $LIBS &gt;&amp;5'
 ac_compiler_gnu=$ac_cv_cxx_compiler_gnu
-if test -n &quot;$ac_tool_prefix&quot;; then
-  for ac_prog in $CCC g++ c++ gpp aCC CC cxx cc++ cl FCC KCC RCC xlC_r xlC
+if test -z &quot;$CXX&quot;; then
+  if test -n &quot;$CCC&quot;; then
+    CXX=$CCC
+  else
+    if test -n &quot;$ac_tool_prefix&quot;; then
+  for ac_prog in g++ c++ gpp aCC CC cxx cc++ cl.exe FCC KCC RCC xlC_r xlC
   do
     # Extract the first word of &quot;$ac_tool_prefix$ac_prog&quot;, so it can be a program name with args.
 set dummy $ac_tool_prefix$ac_prog; ac_word=$2
-echo &quot;$as_me:$LINENO: checking for $ac_word&quot; &gt;&amp;5
-echo $ECHO_N &quot;checking for $ac_word... $ECHO_C&quot; &gt;&amp;6
+{ echo &quot;$as_me:$LINENO: checking for $ac_word&quot; &gt;&amp;5
+echo $ECHO_N &quot;checking for $ac_word... $ECHO_C&quot; &gt;&amp;6; }
 if test &quot;${ac_cv_prog_CXX+set}&quot; = set; then
   echo $ECHO_N &quot;(cached) $ECHO_C&quot; &gt;&amp;6
 else
@@ -3228,36 +3746,38 @@
   IFS=$as_save_IFS
   test -z &quot;$as_dir&quot; &amp;&amp; as_dir=.
   for ac_exec_ext in '' $ac_executable_extensions; do
-  if $as_executable_p &quot;$as_dir/$ac_word$ac_exec_ext&quot;; then
+  if { test -f &quot;$as_dir/$ac_word$ac_exec_ext&quot; &amp;&amp; $as_executable_p &quot;$as_dir/$ac_word$ac_exec_ext&quot;; }; then
     ac_cv_prog_CXX=&quot;$ac_tool_prefix$ac_prog&quot;
     echo &quot;$as_me:$LINENO: found $as_dir/$ac_word$ac_exec_ext&quot; &gt;&amp;5
     break 2
   fi
 done
 done
+IFS=$as_save_IFS
 
 fi
 fi
 CXX=$ac_cv_prog_CXX
 if test -n &quot;$CXX&quot;; then
-  echo &quot;$as_me:$LINENO: result: $CXX&quot; &gt;&amp;5
-echo &quot;${ECHO_T}$CXX&quot; &gt;&amp;6
+  { echo &quot;$as_me:$LINENO: result: $CXX&quot; &gt;&amp;5
+echo &quot;${ECHO_T}$CXX&quot; &gt;&amp;6; }
 else
-  echo &quot;$as_me:$LINENO: result: no&quot; &gt;&amp;5
-echo &quot;${ECHO_T}no&quot; &gt;&amp;6
+  { echo &quot;$as_me:$LINENO: result: no&quot; &gt;&amp;5
+echo &quot;${ECHO_T}no&quot; &gt;&amp;6; }
 fi
 
+
     test -n &quot;$CXX&quot; &amp;&amp; break
   done
 fi
 if test -z &quot;$CXX&quot;; then
   ac_ct_CXX=$CXX
-  for ac_prog in $CCC g++ c++ gpp aCC CC cxx cc++ cl FCC KCC RCC xlC_r xlC
+  for ac_prog in g++ c++ gpp aCC CC cxx cc++ cl.exe FCC KCC RCC xlC_r xlC
 do
   # Extract the first word of &quot;$ac_prog&quot;, so it can be a program name with args.
 set dummy $ac_prog; ac_word=$2
-echo &quot;$as_me:$LINENO: checking for $ac_word&quot; &gt;&amp;5
-echo $ECHO_N &quot;checking for $ac_word... $ECHO_C&quot; &gt;&amp;6
+{ echo &quot;$as_me:$LINENO: checking for $ac_word&quot; &gt;&amp;5
+echo $ECHO_N &quot;checking for $ac_word... $ECHO_C&quot; &gt;&amp;6; }
 if test &quot;${ac_cv_prog_ac_ct_CXX+set}&quot; = set; then
   echo $ECHO_N &quot;(cached) $ECHO_C&quot; &gt;&amp;6
 else
@@ -3270,55 +3790,70 @@
   IFS=$as_save_IFS
   test -z &quot;$as_dir&quot; &amp;&amp; as_dir=.
   for ac_exec_ext in '' $ac_executable_extensions; do
-  if $as_executable_p &quot;$as_dir/$ac_word$ac_exec_ext&quot;; then
+  if { test -f &quot;$as_dir/$ac_word$ac_exec_ext&quot; &amp;&amp; $as_executable_p &quot;$as_dir/$ac_word$ac_exec_ext&quot;; }; then
     ac_cv_prog_ac_ct_CXX=&quot;$ac_prog&quot;
     echo &quot;$as_me:$LINENO: found $as_dir/$ac_word$ac_exec_ext&quot; &gt;&amp;5
     break 2
   fi
 done
 done
+IFS=$as_save_IFS
 
 fi
 fi
 ac_ct_CXX=$ac_cv_prog_ac_ct_CXX
 if test -n &quot;$ac_ct_CXX&quot;; then
-  echo &quot;$as_me:$LINENO: result: $ac_ct_CXX&quot; &gt;&amp;5
-echo &quot;${ECHO_T}$ac_ct_CXX&quot; &gt;&amp;6
+  { echo &quot;$as_me:$LINENO: result: $ac_ct_CXX&quot; &gt;&amp;5
+echo &quot;${ECHO_T}$ac_ct_CXX&quot; &gt;&amp;6; }
 else
-  echo &quot;$as_me:$LINENO: result: no&quot; &gt;&amp;5
-echo &quot;${ECHO_T}no&quot; &gt;&amp;6
+  { echo &quot;$as_me:$LINENO: result: no&quot; &gt;&amp;5
+echo &quot;${ECHO_T}no&quot; &gt;&amp;6; }
 fi
 
+
   test -n &quot;$ac_ct_CXX&quot; &amp;&amp; break
 done
-test -n &quot;$ac_ct_CXX&quot; || ac_ct_CXX=&quot;g++&quot;
 
-  CXX=$ac_ct_CXX
+  if test &quot;x$ac_ct_CXX&quot; = x; then
+    CXX=&quot;g++&quot;
+  else
+    case $cross_compiling:$ac_tool_warned in
+yes:)
+{ echo &quot;$as_me:$LINENO: WARNING: In the future, Autoconf will not detect cross-tools
+whose name does not start with the host triplet.  If you think this
+configuration is useful to you, please write to <A HREF="https://lists.berlios.de/mailman/listinfo/solid-pbx-svn">autoconf at gnu.org.</A>&quot; &gt;&amp;5
+echo &quot;$as_me: WARNING: In the future, Autoconf will not detect cross-tools
+whose name does not start with the host triplet.  If you think this
+configuration is useful to you, please write to <A HREF="https://lists.berlios.de/mailman/listinfo/solid-pbx-svn">autoconf at gnu.org.</A>&quot; &gt;&amp;2;}
+ac_tool_warned=yes ;;
+esac
+    CXX=$ac_ct_CXX
+  fi
 fi
 
-
+  fi
+fi
 # Provide some information about the compiler.
-echo &quot;$as_me:$LINENO:&quot; \
-     &quot;checking for C++ compiler version&quot; &gt;&amp;5
+echo &quot;$as_me:$LINENO: checking for C++ compiler version&quot; &gt;&amp;5
 ac_compiler=`set X $ac_compile; echo $2`
-{ (eval echo &quot;$as_me:$LINENO: \&quot;$ac_compiler --version &lt;/dev/null &gt;&amp;5\&quot;&quot;) &gt;&amp;5
-  (eval $ac_compiler --version &lt;/dev/null &gt;&amp;5) 2&gt;&amp;5
+{ (eval echo &quot;$as_me:$LINENO: \&quot;$ac_compiler --version &gt;&amp;5\&quot;&quot;) &gt;&amp;5
+  (eval $ac_compiler --version &gt;&amp;5) 2&gt;&amp;5
   ac_status=$?
   echo &quot;$as_me:$LINENO: \$? = $ac_status&quot; &gt;&amp;5
   (exit $ac_status); }
-{ (eval echo &quot;$as_me:$LINENO: \&quot;$ac_compiler -v &lt;/dev/null &gt;&amp;5\&quot;&quot;) &gt;&amp;5
-  (eval $ac_compiler -v &lt;/dev/null &gt;&amp;5) 2&gt;&amp;5
+{ (eval echo &quot;$as_me:$LINENO: \&quot;$ac_compiler -v &gt;&amp;5\&quot;&quot;) &gt;&amp;5
+  (eval $ac_compiler -v &gt;&amp;5) 2&gt;&amp;5
   ac_status=$?
   echo &quot;$as_me:$LINENO: \$? = $ac_status&quot; &gt;&amp;5
   (exit $ac_status); }
-{ (eval echo &quot;$as_me:$LINENO: \&quot;$ac_compiler -V &lt;/dev/null &gt;&amp;5\&quot;&quot;) &gt;&amp;5
-  (eval $ac_compiler -V &lt;/dev/null &gt;&amp;5) 2&gt;&amp;5
+{ (eval echo &quot;$as_me:$LINENO: \&quot;$ac_compiler -V &gt;&amp;5\&quot;&quot;) &gt;&amp;5
+  (eval $ac_compiler -V &gt;&amp;5) 2&gt;&amp;5
   ac_status=$?
   echo &quot;$as_me:$LINENO: \$? = $ac_status&quot; &gt;&amp;5
   (exit $ac_status); }
 
-echo &quot;$as_me:$LINENO: checking whether we are using the GNU C++ compiler&quot; &gt;&amp;5
-echo $ECHO_N &quot;checking whether we are using the GNU C++ compiler... $ECHO_C&quot; &gt;&amp;6
+{ echo &quot;$as_me:$LINENO: checking whether we are using the GNU C++ compiler&quot; &gt;&amp;5
+echo $ECHO_N &quot;checking whether we are using the GNU C++ compiler... $ECHO_C&quot; &gt;&amp;6; }
 if test &quot;${ac_cv_cxx_compiler_gnu+set}&quot; = set; then
   echo $ECHO_N &quot;(cached) $ECHO_C&quot; &gt;&amp;6
 else
@@ -3367,24 +3902,28 @@
   echo &quot;$as_me: failed program was:&quot; &gt;&amp;5
 sed 's/^/| /' conftest.$ac_ext &gt;&amp;5
 
-ac_compiler_gnu=no
+	ac_compiler_gnu=no
 fi
+
 rm -f conftest.err conftest.$ac_objext conftest.$ac_ext
 ac_cv_cxx_compiler_gnu=$ac_compiler_gnu
 
 fi
-echo &quot;$as_me:$LINENO: result: $ac_cv_cxx_compiler_gnu&quot; &gt;&amp;5
-echo &quot;${ECHO_T}$ac_cv_cxx_compiler_gnu&quot; &gt;&amp;6
+{ echo &quot;$as_me:$LINENO: result: $ac_cv_cxx_compiler_gnu&quot; &gt;&amp;5
+echo &quot;${ECHO_T}$ac_cv_cxx_compiler_gnu&quot; &gt;&amp;6; }
 GXX=`test $ac_compiler_gnu = yes &amp;&amp; echo yes`
 ac_test_CXXFLAGS=${CXXFLAGS+set}
 ac_save_CXXFLAGS=$CXXFLAGS
-CXXFLAGS=&quot;-g&quot;
-echo &quot;$as_me:$LINENO: checking whether $CXX accepts -g&quot; &gt;&amp;5
-echo $ECHO_N &quot;checking whether $CXX accepts -g... $ECHO_C&quot; &gt;&amp;6
+{ echo &quot;$as_me:$LINENO: checking whether $CXX accepts -g&quot; &gt;&amp;5
+echo $ECHO_N &quot;checking whether $CXX accepts -g... $ECHO_C&quot; &gt;&amp;6; }
 if test &quot;${ac_cv_prog_cxx_g+set}&quot; = set; then
   echo $ECHO_N &quot;(cached) $ECHO_C&quot; &gt;&amp;6
 else
-  cat &gt;conftest.$ac_ext &lt;&lt;_ACEOF
+  ac_save_cxx_werror_flag=$ac_cxx_werror_flag
+   ac_cxx_werror_flag=yes
+   ac_cv_prog_cxx_g=no
+   CXXFLAGS=&quot;-g&quot;
+   cat &gt;conftest.$ac_ext &lt;&lt;_ACEOF
 /* confdefs.h.  */
 _ACEOF
 cat confdefs.h &gt;&gt;conftest.$ac_ext
@@ -3426,47 +3965,18 @@
   echo &quot;$as_me: failed program was:&quot; &gt;&amp;5
 sed 's/^/| /' conftest.$ac_ext &gt;&amp;5
 
-ac_cv_prog_cxx_g=no
-fi
-rm -f conftest.err conftest.$ac_objext conftest.$ac_ext
-fi
-echo &quot;$as_me:$LINENO: result: $ac_cv_prog_cxx_g&quot; &gt;&amp;5
-echo &quot;${ECHO_T}$ac_cv_prog_cxx_g&quot; &gt;&amp;6
-if test &quot;$ac_test_CXXFLAGS&quot; = set; then
-  CXXFLAGS=$ac_save_CXXFLAGS
-elif test $ac_cv_prog_cxx_g = yes; then
-  if test &quot;$GXX&quot; = yes; then
-    CXXFLAGS=&quot;-g -O2&quot;
-  else
-    CXXFLAGS=&quot;-g&quot;
-  fi
-else
-  if test &quot;$GXX&quot; = yes; then
-    CXXFLAGS=&quot;-O2&quot;
-  else
-    CXXFLAGS=
-  fi
-fi
-for ac_declaration in \
-   '' \
-   'extern &quot;C&quot; void std::exit (int) throw (); using std::exit;' \
-   'extern &quot;C&quot; void std::exit (int); using std::exit;' \
-   'extern &quot;C&quot; void exit (int) throw ();' \
-   'extern &quot;C&quot; void exit (int);' \
-   'void exit (int);'
-do
-  cat &gt;conftest.$ac_ext &lt;&lt;_ACEOF
+	CXXFLAGS=&quot;&quot;
+      cat &gt;conftest.$ac_ext &lt;&lt;_ACEOF
 /* confdefs.h.  */
 _ACEOF
 cat confdefs.h &gt;&gt;conftest.$ac_ext
 cat &gt;&gt;conftest.$ac_ext &lt;&lt;_ACEOF
 /* end confdefs.h.  */
-$ac_declaration
-#include &lt;stdlib.h&gt;
+
 int
 main ()
 {
-exit (42);
+
   ;
   return 0;
 }
@@ -3498,20 +4008,19 @@
   echo &quot;$as_me: failed program was:&quot; &gt;&amp;5
 sed 's/^/| /' conftest.$ac_ext &gt;&amp;5
 
-continue
-fi
-rm -f conftest.err conftest.$ac_objext conftest.$ac_ext
-  cat &gt;conftest.$ac_ext &lt;&lt;_ACEOF
+	ac_cxx_werror_flag=$ac_save_cxx_werror_flag
+	 CXXFLAGS=&quot;-g&quot;
+	 cat &gt;conftest.$ac_ext &lt;&lt;_ACEOF
 /* confdefs.h.  */
 _ACEOF
 cat confdefs.h &gt;&gt;conftest.$ac_ext
 cat &gt;&gt;conftest.$ac_ext &lt;&lt;_ACEOF
 /* end confdefs.h.  */
-$ac_declaration
+
 int
 main ()
 {
-exit (42);
+
   ;
   return 0;
 }
@@ -3538,21 +4047,40 @@
   ac_status=$?
   echo &quot;$as_me:$LINENO: \$? = $ac_status&quot; &gt;&amp;5
   (exit $ac_status); }; }; then
-  break
+  ac_cv_prog_cxx_g=yes
 else
   echo &quot;$as_me: failed program was:&quot; &gt;&amp;5
 sed 's/^/| /' conftest.$ac_ext &gt;&amp;5
 
+
 fi
+
 rm -f conftest.err conftest.$ac_objext conftest.$ac_ext
-done
-rm -f conftest*
-if test -n &quot;$ac_declaration&quot;; then
-  echo '#ifdef __cplusplus' &gt;&gt;confdefs.h
-  echo $ac_declaration      &gt;&gt;confdefs.h
-  echo '#endif'             &gt;&gt;confdefs.h
 fi
 
+rm -f conftest.err conftest.$ac_objext conftest.$ac_ext
+fi
+
+rm -f conftest.err conftest.$ac_objext conftest.$ac_ext
+   ac_cxx_werror_flag=$ac_save_cxx_werror_flag
+fi
+{ echo &quot;$as_me:$LINENO: result: $ac_cv_prog_cxx_g&quot; &gt;&amp;5
+echo &quot;${ECHO_T}$ac_cv_prog_cxx_g&quot; &gt;&amp;6; }
+if test &quot;$ac_test_CXXFLAGS&quot; = set; then
+  CXXFLAGS=$ac_save_CXXFLAGS
+elif test $ac_cv_prog_cxx_g = yes; then
+  if test &quot;$GXX&quot; = yes; then
+    CXXFLAGS=&quot;-g -O2&quot;
+  else
+    CXXFLAGS=&quot;-g&quot;
+  fi
+else
+  if test &quot;$GXX&quot; = yes; then
+    CXXFLAGS=&quot;-O2&quot;
+  else
+    CXXFLAGS=
+  fi
+fi
 ac_ext=c
 ac_cpp='$CPP $CPPFLAGS'
 ac_compile='$CC -c $CFLAGS $CPPFLAGS conftest.$ac_ext &gt;&amp;5'
@@ -3564,8 +4092,8 @@
 ac_compile='$CC -c $CFLAGS $CPPFLAGS conftest.$ac_ext &gt;&amp;5'
 ac_link='$CC -o conftest$ac_exeext $CFLAGS $CPPFLAGS $LDFLAGS conftest.$ac_ext $LIBS &gt;&amp;5'
 ac_compiler_gnu=$ac_cv_c_compiler_gnu
-echo &quot;$as_me:$LINENO: checking how to run the C preprocessor&quot; &gt;&amp;5
-echo $ECHO_N &quot;checking how to run the C preprocessor... $ECHO_C&quot; &gt;&amp;6
+{ echo &quot;$as_me:$LINENO: checking how to run the C preprocessor&quot; &gt;&amp;5
+echo $ECHO_N &quot;checking how to run the C preprocessor... $ECHO_C&quot; &gt;&amp;6; }
 # On Suns, sometimes $CPP names a directory.
 if test -n &quot;$CPP&quot; &amp;&amp; test -d &quot;$CPP&quot;; then
   CPP=
@@ -3625,9 +4153,10 @@
   # Broken: fails on valid input.
 continue
 fi
+
 rm -f conftest.err conftest.$ac_ext
 
-  # OK, works on sane cases.  Now check whether non-existent headers
+  # OK, works on sane cases.  Now check whether nonexistent headers
   # can be detected and how.
   cat &gt;conftest.$ac_ext &lt;&lt;_ACEOF
 /* confdefs.h.  */
@@ -3665,6 +4194,7 @@
 ac_preproc_ok=:
 break
 fi
+
 rm -f conftest.err conftest.$ac_ext
 
 done
@@ -3682,8 +4212,8 @@
 else
   ac_cv_prog_CPP=$CPP
 fi
-echo &quot;$as_me:$LINENO: result: $CPP&quot; &gt;&amp;5
-echo &quot;${ECHO_T}$CPP&quot; &gt;&amp;6
+{ echo &quot;$as_me:$LINENO: result: $CPP&quot; &gt;&amp;5
+echo &quot;${ECHO_T}$CPP&quot; &gt;&amp;6; }
 ac_preproc_ok=false
 for ac_c_preproc_warn_flag in '' yes
 do
@@ -3732,9 +4262,10 @@
   # Broken: fails on valid input.
 continue
 fi
+
 rm -f conftest.err conftest.$ac_ext
 
-  # OK, works on sane cases.  Now check whether non-existent headers
+  # OK, works on sane cases.  Now check whether nonexistent headers
   # can be detected and how.
   cat &gt;conftest.$ac_ext &lt;&lt;_ACEOF
 /* confdefs.h.  */
@@ -3772,6 +4303,7 @@
 ac_preproc_ok=:
 break
 fi
+
 rm -f conftest.err conftest.$ac_ext
 
 done
@@ -3856,9 +4388,10 @@
   # Broken: fails on valid input.
 continue
 fi
+
 rm -f conftest.err conftest.$ac_ext
 
-  # OK, works on sane cases.  Now check whether non-existent headers
+  # OK, works on sane cases.  Now check whether nonexistent headers
   # can be detected and how.
   cat &gt;conftest.$ac_ext &lt;&lt;_ACEOF
 /* confdefs.h.  */
@@ -3896,6 +4429,7 @@
 ac_preproc_ok=:
 break
 fi
+
 rm -f conftest.err conftest.$ac_ext
 
 done
@@ -3969,9 +4503,10 @@
   # Broken: fails on valid input.
 continue
 fi
+
 rm -f conftest.err conftest.$ac_ext
 
-  # OK, works on sane cases.  Now check whether non-existent headers
+  # OK, works on sane cases.  Now check whether nonexistent headers
   # can be detected and how.
   cat &gt;conftest.$ac_ext &lt;&lt;_ACEOF
 /* confdefs.h.  */
@@ -4009,6 +4544,7 @@
 ac_preproc_ok=:
 break
 fi
+
 rm -f conftest.err conftest.$ac_ext
 
 done
@@ -4038,8 +4574,8 @@
 do
   # Extract the first word of &quot;$ac_prog&quot;, so it can be a program name with args.
 set dummy $ac_prog; ac_word=$2
-echo &quot;$as_me:$LINENO: checking for $ac_word&quot; &gt;&amp;5
-echo $ECHO_N &quot;checking for $ac_word... $ECHO_C&quot; &gt;&amp;6
+{ echo &quot;$as_me:$LINENO: checking for $ac_word&quot; &gt;&amp;5
+echo $ECHO_N &quot;checking for $ac_word... $ECHO_C&quot; &gt;&amp;6; }
 if test &quot;${ac_cv_prog_AWK+set}&quot; = set; then
   echo $ECHO_N &quot;(cached) $ECHO_C&quot; &gt;&amp;6
 else
@@ -4052,25 +4588,27 @@
   IFS=$as_save_IFS
   test -z &quot;$as_dir&quot; &amp;&amp; as_dir=.
   for ac_exec_ext in '' $ac_executable_extensions; do
-  if $as_executable_p &quot;$as_dir/$ac_word$ac_exec_ext&quot;; then
+  if { test -f &quot;$as_dir/$ac_word$ac_exec_ext&quot; &amp;&amp; $as_executable_p &quot;$as_dir/$ac_word$ac_exec_ext&quot;; }; then
     ac_cv_prog_AWK=&quot;$ac_prog&quot;
     echo &quot;$as_me:$LINENO: found $as_dir/$ac_word$ac_exec_ext&quot; &gt;&amp;5
     break 2
   fi
 done
 done
+IFS=$as_save_IFS
 
 fi
 fi
 AWK=$ac_cv_prog_AWK
 if test -n &quot;$AWK&quot;; then
-  echo &quot;$as_me:$LINENO: result: $AWK&quot; &gt;&amp;5
-echo &quot;${ECHO_T}$AWK&quot; &gt;&amp;6
+  { echo &quot;$as_me:$LINENO: result: $AWK&quot; &gt;&amp;5
+echo &quot;${ECHO_T}$AWK&quot; &gt;&amp;6; }
 else
-  echo &quot;$as_me:$LINENO: result: no&quot; &gt;&amp;5
-echo &quot;${ECHO_T}no&quot; &gt;&amp;6
+  { echo &quot;$as_me:$LINENO: result: no&quot; &gt;&amp;5
+echo &quot;${ECHO_T}no&quot; &gt;&amp;6; }
 fi
 
+
   test -n &quot;$AWK&quot; &amp;&amp; break
 done
 
@@ -4087,8 +4625,8 @@
 # SVR4 /usr/ucb/install, which tries to use the nonexistent group &quot;staff&quot;
 # OS/2's system install, which has a completely different semantic
 # ./install, which can be erroneously created by make from ./install.sh.
-echo &quot;$as_me:$LINENO: checking for a BSD-compatible install&quot; &gt;&amp;5
-echo $ECHO_N &quot;checking for a BSD-compatible install... $ECHO_C&quot; &gt;&amp;6
+{ echo &quot;$as_me:$LINENO: checking for a BSD-compatible install&quot; &gt;&amp;5
+echo $ECHO_N &quot;checking for a BSD-compatible install... $ECHO_C&quot; &gt;&amp;6; }
 if test -z &quot;$INSTALL&quot;; then
 if test &quot;${ac_cv_path_install+set}&quot; = set; then
   echo $ECHO_N &quot;(cached) $ECHO_C&quot; &gt;&amp;6
@@ -4110,7 +4648,7 @@
     # by default.
     for ac_prog in ginstall scoinst install; do
       for ac_exec_ext in '' $ac_executable_extensions; do
-	if $as_executable_p &quot;$as_dir/$ac_prog$ac_exec_ext&quot;; then
+	if { test -f &quot;$as_dir/$ac_prog$ac_exec_ext&quot; &amp;&amp; $as_executable_p &quot;$as_dir/$ac_prog$ac_exec_ext&quot;; }; then
 	  if test $ac_prog = install &amp;&amp;
 	    grep dspmsg &quot;$as_dir/$ac_prog$ac_exec_ext&quot; &gt;/dev/null 2&gt;&amp;1; then
 	    # AIX install.  It has an incompatible calling convention.
@@ -4129,21 +4667,22 @@
     ;;
 esac
 done
+IFS=$as_save_IFS
 
 
 fi
   if test &quot;${ac_cv_path_install+set}&quot; = set; then
     INSTALL=$ac_cv_path_install
   else
-    # As a last resort, use the slow shell script.  We don't cache a
-    # path for INSTALL within a source directory, because that will
+    # As a last resort, use the slow shell script.  Don't cache a
+    # value for INSTALL within a source directory, because that will
     # break other packages using the cache if that directory is
-    # removed, or if the path is relative.
+    # removed, or if the value is a relative name.
     INSTALL=$ac_install_sh
   fi
 fi
-echo &quot;$as_me:$LINENO: result: $INSTALL&quot; &gt;&amp;5
-echo &quot;${ECHO_T}$INSTALL&quot; &gt;&amp;6
+{ echo &quot;$as_me:$LINENO: result: $INSTALL&quot; &gt;&amp;5
+echo &quot;${ECHO_T}$INSTALL&quot; &gt;&amp;6; }
 
 # Use test -z because SunOS4 sh mishandles braces in ${var-val}.
 # It thinks the first close brace ends the variable substitution.
@@ -4153,22 +4692,22 @@
 
 test -z &quot;$INSTALL_DATA&quot; &amp;&amp; INSTALL_DATA='${INSTALL} -m 644'
 
-echo &quot;$as_me:$LINENO: checking whether ln -s works&quot; &gt;&amp;5
-echo $ECHO_N &quot;checking whether ln -s works... $ECHO_C&quot; &gt;&amp;6
+{ echo &quot;$as_me:$LINENO: checking whether ln -s works&quot; &gt;&amp;5
+echo $ECHO_N &quot;checking whether ln -s works... $ECHO_C&quot; &gt;&amp;6; }
 LN_S=$as_ln_s
 if test &quot;$LN_S&quot; = &quot;ln -s&quot;; then
-  echo &quot;$as_me:$LINENO: result: yes&quot; &gt;&amp;5
-echo &quot;${ECHO_T}yes&quot; &gt;&amp;6
+  { echo &quot;$as_me:$LINENO: result: yes&quot; &gt;&amp;5
+echo &quot;${ECHO_T}yes&quot; &gt;&amp;6; }
 else
-  echo &quot;$as_me:$LINENO: result: no, using $LN_S&quot; &gt;&amp;5
-echo &quot;${ECHO_T}no, using $LN_S&quot; &gt;&amp;6
+  { echo &quot;$as_me:$LINENO: result: no, using $LN_S&quot; &gt;&amp;5
+echo &quot;${ECHO_T}no, using $LN_S&quot; &gt;&amp;6; }
 fi
 
 if test -n &quot;$ac_tool_prefix&quot;; then
   # Extract the first word of &quot;${ac_tool_prefix}ranlib&quot;, so it can be a program name with args.
 set dummy ${ac_tool_prefix}ranlib; ac_word=$2
-echo &quot;$as_me:$LINENO: checking for $ac_word&quot; &gt;&amp;5
-echo $ECHO_N &quot;checking for $ac_word... $ECHO_C&quot; &gt;&amp;6
+{ echo &quot;$as_me:$LINENO: checking for $ac_word&quot; &gt;&amp;5
+echo $ECHO_N &quot;checking for $ac_word... $ECHO_C&quot; &gt;&amp;6; }
 if test &quot;${ac_cv_prog_RANLIB+set}&quot; = set; then
   echo $ECHO_N &quot;(cached) $ECHO_C&quot; &gt;&amp;6
 else
@@ -4181,32 +4720,34 @@
   IFS=$as_save_IFS
   test -z &quot;$as_dir&quot; &amp;&amp; as_dir=.
   for ac_exec_ext in '' $ac_executable_extensions; do
-  if $as_executable_p &quot;$as_dir/$ac_word$ac_exec_ext&quot;; then
+  if { test -f &quot;$as_dir/$ac_word$ac_exec_ext&quot; &amp;&amp; $as_executable_p &quot;$as_dir/$ac_word$ac_exec_ext&quot;; }; then
     ac_cv_prog_RANLIB=&quot;${ac_tool_prefix}ranlib&quot;
     echo &quot;$as_me:$LINENO: found $as_dir/$ac_word$ac_exec_ext&quot; &gt;&amp;5
     break 2
   fi
 done
 done
+IFS=$as_save_IFS
 
 fi
 fi
 RANLIB=$ac_cv_prog_RANLIB
 if test -n &quot;$RANLIB&quot;; then
-  echo &quot;$as_me:$LINENO: result: $RANLIB&quot; &gt;&amp;5
-echo &quot;${ECHO_T}$RANLIB&quot; &gt;&amp;6
+  { echo &quot;$as_me:$LINENO: result: $RANLIB&quot; &gt;&amp;5
+echo &quot;${ECHO_T}$RANLIB&quot; &gt;&amp;6; }
 else
-  echo &quot;$as_me:$LINENO: result: no&quot; &gt;&amp;5
-echo &quot;${ECHO_T}no&quot; &gt;&amp;6
+  { echo &quot;$as_me:$LINENO: result: no&quot; &gt;&amp;5
+echo &quot;${ECHO_T}no&quot; &gt;&amp;6; }
 fi
 
+
 fi
 if test -z &quot;$ac_cv_prog_RANLIB&quot;; then
   ac_ct_RANLIB=$RANLIB
   # Extract the first word of &quot;ranlib&quot;, so it can be a program name with args.
 set dummy ranlib; ac_word=$2
-echo &quot;$as_me:$LINENO: checking for $ac_word&quot; &gt;&amp;5
-echo $ECHO_N &quot;checking for $ac_word... $ECHO_C&quot; &gt;&amp;6
+{ echo &quot;$as_me:$LINENO: checking for $ac_word&quot; &gt;&amp;5
+echo $ECHO_N &quot;checking for $ac_word... $ECHO_C&quot; &gt;&amp;6; }
 if test &quot;${ac_cv_prog_ac_ct_RANLIB+set}&quot; = set; then
   echo $ECHO_N &quot;(cached) $ECHO_C&quot; &gt;&amp;6
 else
@@ -4219,33 +4760,47 @@
   IFS=$as_save_IFS
   test -z &quot;$as_dir&quot; &amp;&amp; as_dir=.
   for ac_exec_ext in '' $ac_executable_extensions; do
-  if $as_executable_p &quot;$as_dir/$ac_word$ac_exec_ext&quot;; then
+  if { test -f &quot;$as_dir/$ac_word$ac_exec_ext&quot; &amp;&amp; $as_executable_p &quot;$as_dir/$ac_word$ac_exec_ext&quot;; }; then
     ac_cv_prog_ac_ct_RANLIB=&quot;ranlib&quot;
     echo &quot;$as_me:$LINENO: found $as_dir/$ac_word$ac_exec_ext&quot; &gt;&amp;5
     break 2
   fi
 done
 done
+IFS=$as_save_IFS
 
-  test -z &quot;$ac_cv_prog_ac_ct_RANLIB&quot; &amp;&amp; ac_cv_prog_ac_ct_RANLIB=&quot;:&quot;
 fi
 fi
 ac_ct_RANLIB=$ac_cv_prog_ac_ct_RANLIB
 if test -n &quot;$ac_ct_RANLIB&quot;; then
-  echo &quot;$as_me:$LINENO: result: $ac_ct_RANLIB&quot; &gt;&amp;5
-echo &quot;${ECHO_T}$ac_ct_RANLIB&quot; &gt;&amp;6
+  { echo &quot;$as_me:$LINENO: result: $ac_ct_RANLIB&quot; &gt;&amp;5
+echo &quot;${ECHO_T}$ac_ct_RANLIB&quot; &gt;&amp;6; }
 else
-  echo &quot;$as_me:$LINENO: result: no&quot; &gt;&amp;5
-echo &quot;${ECHO_T}no&quot; &gt;&amp;6
+  { echo &quot;$as_me:$LINENO: result: no&quot; &gt;&amp;5
+echo &quot;${ECHO_T}no&quot; &gt;&amp;6; }
 fi
 
-  RANLIB=$ac_ct_RANLIB
+  if test &quot;x$ac_ct_RANLIB&quot; = x; then
+    RANLIB=&quot;:&quot;
+  else
+    case $cross_compiling:$ac_tool_warned in
+yes:)
+{ echo &quot;$as_me:$LINENO: WARNING: In the future, Autoconf will not detect cross-tools
+whose name does not start with the host triplet.  If you think this
+configuration is useful to you, please write to <A HREF="https://lists.berlios.de/mailman/listinfo/solid-pbx-svn">autoconf at gnu.org.</A>&quot; &gt;&amp;5
+echo &quot;$as_me: WARNING: In the future, Autoconf will not detect cross-tools
+whose name does not start with the host triplet.  If you think this
+configuration is useful to you, please write to <A HREF="https://lists.berlios.de/mailman/listinfo/solid-pbx-svn">autoconf at gnu.org.</A>&quot; &gt;&amp;2;}
+ac_tool_warned=yes ;;
+esac
+    RANLIB=$ac_ct_RANLIB
+  fi
 else
   RANLIB=&quot;$ac_cv_prog_RANLIB&quot;
 fi
 
-echo &quot;$as_me:$LINENO: checking for GNU make&quot; &gt;&amp;5
-echo $ECHO_N &quot;checking for GNU make... $ECHO_C&quot; &gt;&amp;6
+{ echo &quot;$as_me:$LINENO: checking for GNU make&quot; &gt;&amp;5
+echo $ECHO_N &quot;checking for GNU make... $ECHO_C&quot; &gt;&amp;6; }
 if test &quot;${GNU_MAKE+set}&quot; = set; then
   echo $ECHO_N &quot;(cached) $ECHO_C&quot; &gt;&amp;6
 else
@@ -4259,8 +4814,8 @@
    done ;
 
 fi
-echo &quot;$as_me:$LINENO: result: $GNU_MAKE&quot; &gt;&amp;5
-echo &quot;${ECHO_T}$GNU_MAKE&quot; &gt;&amp;6 ;
+{ echo &quot;$as_me:$LINENO: result: $GNU_MAKE&quot; &gt;&amp;5
+echo &quot;${ECHO_T}$GNU_MAKE&quot; &gt;&amp;6; } ;
 if test  &quot;x$GNU_MAKE&quot; = &quot;xNot Found&quot;  ; then
    echo &quot; *** Please install GNU make.  It is required to build Asterisk!&quot;
    exit 1
@@ -4270,8 +4825,8 @@
 
 # Extract the first word of &quot;grep&quot;, so it can be a program name with args.
 set dummy grep; ac_word=$2
-echo &quot;$as_me:$LINENO: checking for $ac_word&quot; &gt;&amp;5
-echo $ECHO_N &quot;checking for $ac_word... $ECHO_C&quot; &gt;&amp;6
+{ echo &quot;$as_me:$LINENO: checking for $ac_word&quot; &gt;&amp;5
+echo $ECHO_N &quot;checking for $ac_word... $ECHO_C&quot; &gt;&amp;6; }
 if test &quot;${ac_cv_path_GREP+set}&quot; = set; then
   echo $ECHO_N &quot;(cached) $ECHO_C&quot; &gt;&amp;6
 else
@@ -4286,32 +4841,33 @@
   IFS=$as_save_IFS
   test -z &quot;$as_dir&quot; &amp;&amp; as_dir=.
   for ac_exec_ext in '' $ac_executable_extensions; do
-  if $as_executable_p &quot;$as_dir/$ac_word$ac_exec_ext&quot;; then
+  if { test -f &quot;$as_dir/$ac_word$ac_exec_ext&quot; &amp;&amp; $as_executable_p &quot;$as_dir/$ac_word$ac_exec_ext&quot;; }; then
     ac_cv_path_GREP=&quot;$as_dir/$ac_word$ac_exec_ext&quot;
     echo &quot;$as_me:$LINENO: found $as_dir/$ac_word$ac_exec_ext&quot; &gt;&amp;5
     break 2
   fi
 done
 done
+IFS=$as_save_IFS
 
   test -z &quot;$ac_cv_path_GREP&quot; &amp;&amp; ac_cv_path_GREP=&quot;:&quot;
   ;;
 esac
 fi
 GREP=$ac_cv_path_GREP
-
 if test -n &quot;$GREP&quot;; then
-  echo &quot;$as_me:$LINENO: result: $GREP&quot; &gt;&amp;5
-echo &quot;${ECHO_T}$GREP&quot; &gt;&amp;6
+  { echo &quot;$as_me:$LINENO: result: $GREP&quot; &gt;&amp;5
+echo &quot;${ECHO_T}$GREP&quot; &gt;&amp;6; }
 else
-  echo &quot;$as_me:$LINENO: result: no&quot; &gt;&amp;5
-echo &quot;${ECHO_T}no&quot; &gt;&amp;6
+  { echo &quot;$as_me:$LINENO: result: no&quot; &gt;&amp;5
+echo &quot;${ECHO_T}no&quot; &gt;&amp;6; }
 fi
 
+
 # Extract the first word of &quot;ar&quot;, so it can be a program name with args.
 set dummy ar; ac_word=$2
-echo &quot;$as_me:$LINENO: checking for $ac_word&quot; &gt;&amp;5
-echo $ECHO_N &quot;checking for $ac_word... $ECHO_C&quot; &gt;&amp;6
+{ echo &quot;$as_me:$LINENO: checking for $ac_word&quot; &gt;&amp;5
+echo $ECHO_N &quot;checking for $ac_word... $ECHO_C&quot; &gt;&amp;6; }
 if test &quot;${ac_cv_path_AR+set}&quot; = set; then
   echo $ECHO_N &quot;(cached) $ECHO_C&quot; &gt;&amp;6
 else
@@ -4326,32 +4882,33 @@
   IFS=$as_save_IFS
   test -z &quot;$as_dir&quot; &amp;&amp; as_dir=.
   for ac_exec_ext in '' $ac_executable_extensions; do
-  if $as_executable_p &quot;$as_dir/$ac_word$ac_exec_ext&quot;; then
+  if { test -f &quot;$as_dir/$ac_word$ac_exec_ext&quot; &amp;&amp; $as_executable_p &quot;$as_dir/$ac_word$ac_exec_ext&quot;; }; then
     ac_cv_path_AR=&quot;$as_dir/$ac_word$ac_exec_ext&quot;
     echo &quot;$as_me:$LINENO: found $as_dir/$ac_word$ac_exec_ext&quot; &gt;&amp;5
     break 2
   fi
 done
 done
+IFS=$as_save_IFS
 
   test -z &quot;$ac_cv_path_AR&quot; &amp;&amp; ac_cv_path_AR=&quot;:&quot;
   ;;
 esac
 fi
 AR=$ac_cv_path_AR
-
 if test -n &quot;$AR&quot;; then
-  echo &quot;$as_me:$LINENO: result: $AR&quot; &gt;&amp;5
-echo &quot;${ECHO_T}$AR&quot; &gt;&amp;6
+  { echo &quot;$as_me:$LINENO: result: $AR&quot; &gt;&amp;5
+echo &quot;${ECHO_T}$AR&quot; &gt;&amp;6; }
 else
-  echo &quot;$as_me:$LINENO: result: no&quot; &gt;&amp;5
-echo &quot;${ECHO_T}no&quot; &gt;&amp;6
+  { echo &quot;$as_me:$LINENO: result: no&quot; &gt;&amp;5
+echo &quot;${ECHO_T}no&quot; &gt;&amp;6; }
 fi
 
+
 # Extract the first word of &quot;find&quot;, so it can be a program name with args.
 set dummy find; ac_word=$2
-echo &quot;$as_me:$LINENO: checking for $ac_word&quot; &gt;&amp;5
-echo $ECHO_N &quot;checking for $ac_word... $ECHO_C&quot; &gt;&amp;6
+{ echo &quot;$as_me:$LINENO: checking for $ac_word&quot; &gt;&amp;5
+echo $ECHO_N &quot;checking for $ac_word... $ECHO_C&quot; &gt;&amp;6; }
 if test &quot;${ac_cv_path_FIND+set}&quot; = set; then
   echo $ECHO_N &quot;(cached) $ECHO_C&quot; &gt;&amp;6
 else
@@ -4366,32 +4923,33 @@
   IFS=$as_save_IFS
   test -z &quot;$as_dir&quot; &amp;&amp; as_dir=.
   for ac_exec_ext in '' $ac_executable_extensions; do
-  if $as_executable_p &quot;$as_dir/$ac_word$ac_exec_ext&quot;; then
+  if { test -f &quot;$as_dir/$ac_word$ac_exec_ext&quot; &amp;&amp; $as_executable_p &quot;$as_dir/$ac_word$ac_exec_ext&quot;; }; then
     ac_cv_path_FIND=&quot;$as_dir/$ac_word$ac_exec_ext&quot;
     echo &quot;$as_me:$LINENO: found $as_dir/$ac_word$ac_exec_ext&quot; &gt;&amp;5
     break 2
   fi
 done
 done
+IFS=$as_save_IFS
 
   test -z &quot;$ac_cv_path_FIND&quot; &amp;&amp; ac_cv_path_FIND=&quot;:&quot;
   ;;
 esac
 fi
 FIND=$ac_cv_path_FIND
-
 if test -n &quot;$FIND&quot;; then
-  echo &quot;$as_me:$LINENO: result: $FIND&quot; &gt;&amp;5
-echo &quot;${ECHO_T}$FIND&quot; &gt;&amp;6
+  { echo &quot;$as_me:$LINENO: result: $FIND&quot; &gt;&amp;5
+echo &quot;${ECHO_T}$FIND&quot; &gt;&amp;6; }
 else
-  echo &quot;$as_me:$LINENO: result: no&quot; &gt;&amp;5
-echo &quot;${ECHO_T}no&quot; &gt;&amp;6
+  { echo &quot;$as_me:$LINENO: result: no&quot; &gt;&amp;5
+echo &quot;${ECHO_T}no&quot; &gt;&amp;6; }
 fi
 
+
 # Extract the first word of &quot;compress&quot;, so it can be a program name with args.
 set dummy compress; ac_word=$2
-echo &quot;$as_me:$LINENO: checking for $ac_word&quot; &gt;&amp;5
-echo $ECHO_N &quot;checking for $ac_word... $ECHO_C&quot; &gt;&amp;6
+{ echo &quot;$as_me:$LINENO: checking for $ac_word&quot; &gt;&amp;5
+echo $ECHO_N &quot;checking for $ac_word... $ECHO_C&quot; &gt;&amp;6; }
 if test &quot;${ac_cv_path_COMPRESS+set}&quot; = set; then
   echo $ECHO_N &quot;(cached) $ECHO_C&quot; &gt;&amp;6
 else
@@ -4406,32 +4964,33 @@
   IFS=$as_save_IFS
   test -z &quot;$as_dir&quot; &amp;&amp; as_dir=.
   for ac_exec_ext in '' $ac_executable_extensions; do
-  if $as_executable_p &quot;$as_dir/$ac_word$ac_exec_ext&quot;; then
+  if { test -f &quot;$as_dir/$ac_word$ac_exec_ext&quot; &amp;&amp; $as_executable_p &quot;$as_dir/$ac_word$ac_exec_ext&quot;; }; then
     ac_cv_path_COMPRESS=&quot;$as_dir/$ac_word$ac_exec_ext&quot;
     echo &quot;$as_me:$LINENO: found $as_dir/$ac_word$ac_exec_ext&quot; &gt;&amp;5
     break 2
   fi
 done
 done
+IFS=$as_save_IFS
 
   test -z &quot;$ac_cv_path_COMPRESS&quot; &amp;&amp; ac_cv_path_COMPRESS=&quot;:&quot;
   ;;
 esac
 fi
 COMPRESS=$ac_cv_path_COMPRESS
-
 if test -n &quot;$COMPRESS&quot;; then
-  echo &quot;$as_me:$LINENO: result: $COMPRESS&quot; &gt;&amp;5
-echo &quot;${ECHO_T}$COMPRESS&quot; &gt;&amp;6
+  { echo &quot;$as_me:$LINENO: result: $COMPRESS&quot; &gt;&amp;5
+echo &quot;${ECHO_T}$COMPRESS&quot; &gt;&amp;6; }
 else
-  echo &quot;$as_me:$LINENO: result: no&quot; &gt;&amp;5
-echo &quot;${ECHO_T}no&quot; &gt;&amp;6
+  { echo &quot;$as_me:$LINENO: result: no&quot; &gt;&amp;5
+echo &quot;${ECHO_T}no&quot; &gt;&amp;6; }
 fi
 
+
 # Extract the first word of &quot;basename&quot;, so it can be a program name with args.
 set dummy basename; ac_word=$2
-echo &quot;$as_me:$LINENO: checking for $ac_word&quot; &gt;&amp;5
-echo $ECHO_N &quot;checking for $ac_word... $ECHO_C&quot; &gt;&amp;6
+{ echo &quot;$as_me:$LINENO: checking for $ac_word&quot; &gt;&amp;5
+echo $ECHO_N &quot;checking for $ac_word... $ECHO_C&quot; &gt;&amp;6; }
 if test &quot;${ac_cv_path_BASENAME+set}&quot; = set; then
   echo $ECHO_N &quot;(cached) $ECHO_C&quot; &gt;&amp;6
 else
@@ -4446,32 +5005,33 @@
   IFS=$as_save_IFS
   test -z &quot;$as_dir&quot; &amp;&amp; as_dir=.
   for ac_exec_ext in '' $ac_executable_extensions; do
-  if $as_executable_p &quot;$as_dir/$ac_word$ac_exec_ext&quot;; then
+  if { test -f &quot;$as_dir/$ac_word$ac_exec_ext&quot; &amp;&amp; $as_executable_p &quot;$as_dir/$ac_word$ac_exec_ext&quot;; }; then
     ac_cv_path_BASENAME=&quot;$as_dir/$ac_word$ac_exec_ext&quot;
     echo &quot;$as_me:$LINENO: found $as_dir/$ac_word$ac_exec_ext&quot; &gt;&amp;5
     break 2
   fi
 done
 done
+IFS=$as_save_IFS
 
   test -z &quot;$ac_cv_path_BASENAME&quot; &amp;&amp; ac_cv_path_BASENAME=&quot;:&quot;
   ;;
 esac
 fi
 BASENAME=$ac_cv_path_BASENAME
-
 if test -n &quot;$BASENAME&quot;; then
-  echo &quot;$as_me:$LINENO: result: $BASENAME&quot; &gt;&amp;5
-echo &quot;${ECHO_T}$BASENAME&quot; &gt;&amp;6
+  { echo &quot;$as_me:$LINENO: result: $BASENAME&quot; &gt;&amp;5
+echo &quot;${ECHO_T}$BASENAME&quot; &gt;&amp;6; }
 else
-  echo &quot;$as_me:$LINENO: result: no&quot; &gt;&amp;5
-echo &quot;${ECHO_T}no&quot; &gt;&amp;6
+  { echo &quot;$as_me:$LINENO: result: no&quot; &gt;&amp;5
+echo &quot;${ECHO_T}no&quot; &gt;&amp;6; }
 fi
 
+
 # Extract the first word of &quot;dirname&quot;, so it can be a program name with args.
 set dummy dirname; ac_word=$2
-echo &quot;$as_me:$LINENO: checking for $ac_word&quot; &gt;&amp;5
-echo $ECHO_N &quot;checking for $ac_word... $ECHO_C&quot; &gt;&amp;6
+{ echo &quot;$as_me:$LINENO: checking for $ac_word&quot; &gt;&amp;5
+echo $ECHO_N &quot;checking for $ac_word... $ECHO_C&quot; &gt;&amp;6; }
 if test &quot;${ac_cv_path_DIRNAME+set}&quot; = set; then
   echo $ECHO_N &quot;(cached) $ECHO_C&quot; &gt;&amp;6
 else
@@ -4486,32 +5046,33 @@
   IFS=$as_save_IFS
   test -z &quot;$as_dir&quot; &amp;&amp; as_dir=.
   for ac_exec_ext in '' $ac_executable_extensions; do
-  if $as_executable_p &quot;$as_dir/$ac_word$ac_exec_ext&quot;; then
+  if { test -f &quot;$as_dir/$ac_word$ac_exec_ext&quot; &amp;&amp; $as_executable_p &quot;$as_dir/$ac_word$ac_exec_ext&quot;; }; then
     ac_cv_path_DIRNAME=&quot;$as_dir/$ac_word$ac_exec_ext&quot;
     echo &quot;$as_me:$LINENO: found $as_dir/$ac_word$ac_exec_ext&quot; &gt;&amp;5
     break 2
   fi
 done
 done
+IFS=$as_save_IFS
 
   test -z &quot;$ac_cv_path_DIRNAME&quot; &amp;&amp; ac_cv_path_DIRNAME=&quot;:&quot;
   ;;
 esac
 fi
 DIRNAME=$ac_cv_path_DIRNAME
-
 if test -n &quot;$DIRNAME&quot;; then
-  echo &quot;$as_me:$LINENO: result: $DIRNAME&quot; &gt;&amp;5
-echo &quot;${ECHO_T}$DIRNAME&quot; &gt;&amp;6
+  { echo &quot;$as_me:$LINENO: result: $DIRNAME&quot; &gt;&amp;5
+echo &quot;${ECHO_T}$DIRNAME&quot; &gt;&amp;6; }
 else
-  echo &quot;$as_me:$LINENO: result: no&quot; &gt;&amp;5
-echo &quot;${ECHO_T}no&quot; &gt;&amp;6
+  { echo &quot;$as_me:$LINENO: result: no&quot; &gt;&amp;5
+echo &quot;${ECHO_T}no&quot; &gt;&amp;6; }
 fi
 
+
 # Extract the first word of &quot;sh&quot;, so it can be a program name with args.
 set dummy sh; ac_word=$2
-echo &quot;$as_me:$LINENO: checking for $ac_word&quot; &gt;&amp;5
-echo $ECHO_N &quot;checking for $ac_word... $ECHO_C&quot; &gt;&amp;6
+{ echo &quot;$as_me:$LINENO: checking for $ac_word&quot; &gt;&amp;5
+echo $ECHO_N &quot;checking for $ac_word... $ECHO_C&quot; &gt;&amp;6; }
 if test &quot;${ac_cv_path_SHELL+set}&quot; = set; then
   echo $ECHO_N &quot;(cached) $ECHO_C&quot; &gt;&amp;6
 else
@@ -4526,32 +5087,33 @@
   IFS=$as_save_IFS
   test -z &quot;$as_dir&quot; &amp;&amp; as_dir=.
   for ac_exec_ext in '' $ac_executable_extensions; do
-  if $as_executable_p &quot;$as_dir/$ac_word$ac_exec_ext&quot;; then
+  if { test -f &quot;$as_dir/$ac_word$ac_exec_ext&quot; &amp;&amp; $as_executable_p &quot;$as_dir/$ac_word$ac_exec_ext&quot;; }; then
     ac_cv_path_SHELL=&quot;$as_dir/$ac_word$ac_exec_ext&quot;
     echo &quot;$as_me:$LINENO: found $as_dir/$ac_word$ac_exec_ext&quot; &gt;&amp;5
     break 2
   fi
 done
 done
+IFS=$as_save_IFS
 
   test -z &quot;$ac_cv_path_SHELL&quot; &amp;&amp; ac_cv_path_SHELL=&quot;:&quot;
   ;;
 esac
 fi
 SHELL=$ac_cv_path_SHELL
-
 if test -n &quot;$SHELL&quot;; then
-  echo &quot;$as_me:$LINENO: result: $SHELL&quot; &gt;&amp;5
-echo &quot;${ECHO_T}$SHELL&quot; &gt;&amp;6
+  { echo &quot;$as_me:$LINENO: result: $SHELL&quot; &gt;&amp;5
+echo &quot;${ECHO_T}$SHELL&quot; &gt;&amp;6; }
 else
-  echo &quot;$as_me:$LINENO: result: no&quot; &gt;&amp;5
-echo &quot;${ECHO_T}no&quot; &gt;&amp;6
+  { echo &quot;$as_me:$LINENO: result: no&quot; &gt;&amp;5
+echo &quot;${ECHO_T}no&quot; &gt;&amp;6; }
 fi
 
+
 # Extract the first word of &quot;ln&quot;, so it can be a program name with args.
 set dummy ln; ac_word=$2
-echo &quot;$as_me:$LINENO: checking for $ac_word&quot; &gt;&amp;5
-echo $ECHO_N &quot;checking for $ac_word... $ECHO_C&quot; &gt;&amp;6
+{ echo &quot;$as_me:$LINENO: checking for $ac_word&quot; &gt;&amp;5
+echo $ECHO_N &quot;checking for $ac_word... $ECHO_C&quot; &gt;&amp;6; }
 if test &quot;${ac_cv_path_LN+set}&quot; = set; then
   echo $ECHO_N &quot;(cached) $ECHO_C&quot; &gt;&amp;6
 else
@@ -4566,32 +5128,33 @@
   IFS=$as_save_IFS
   test -z &quot;$as_dir&quot; &amp;&amp; as_dir=.
   for ac_exec_ext in '' $ac_executable_extensions; do
-  if $as_executable_p &quot;$as_dir/$ac_word$ac_exec_ext&quot;; then
+  if { test -f &quot;$as_dir/$ac_word$ac_exec_ext&quot; &amp;&amp; $as_executable_p &quot;$as_dir/$ac_word$ac_exec_ext&quot;; }; then
     ac_cv_path_LN=&quot;$as_dir/$ac_word$ac_exec_ext&quot;
     echo &quot;$as_me:$LINENO: found $as_dir/$ac_word$ac_exec_ext&quot; &gt;&amp;5
     break 2
   fi
 done
 done
+IFS=$as_save_IFS
 
   test -z &quot;$ac_cv_path_LN&quot; &amp;&amp; ac_cv_path_LN=&quot;:&quot;
   ;;
 esac
 fi
 LN=$ac_cv_path_LN
-
 if test -n &quot;$LN&quot;; then
-  echo &quot;$as_me:$LINENO: result: $LN&quot; &gt;&amp;5
-echo &quot;${ECHO_T}$LN&quot; &gt;&amp;6
+  { echo &quot;$as_me:$LINENO: result: $LN&quot; &gt;&amp;5
+echo &quot;${ECHO_T}$LN&quot; &gt;&amp;6; }
 else
-  echo &quot;$as_me:$LINENO: result: no&quot; &gt;&amp;5
-echo &quot;${ECHO_T}no&quot; &gt;&amp;6
+  { echo &quot;$as_me:$LINENO: result: no&quot; &gt;&amp;5
+echo &quot;${ECHO_T}no&quot; &gt;&amp;6; }
 fi
 
+
 # Extract the first word of &quot;dot&quot;, so it can be a program name with args.
 set dummy dot; ac_word=$2
-echo &quot;$as_me:$LINENO: checking for $ac_word&quot; &gt;&amp;5
-echo $ECHO_N &quot;checking for $ac_word... $ECHO_C&quot; &gt;&amp;6
+{ echo &quot;$as_me:$LINENO: checking for $ac_word&quot; &gt;&amp;5
+echo $ECHO_N &quot;checking for $ac_word... $ECHO_C&quot; &gt;&amp;6; }
 if test &quot;${ac_cv_path_DOT+set}&quot; = set; then
   echo $ECHO_N &quot;(cached) $ECHO_C&quot; &gt;&amp;6
 else
@@ -4606,29 +5169,30 @@
   IFS=$as_save_IFS
   test -z &quot;$as_dir&quot; &amp;&amp; as_dir=.
   for ac_exec_ext in '' $ac_executable_extensions; do
-  if $as_executable_p &quot;$as_dir/$ac_word$ac_exec_ext&quot;; then
+  if { test -f &quot;$as_dir/$ac_word$ac_exec_ext&quot; &amp;&amp; $as_executable_p &quot;$as_dir/$ac_word$ac_exec_ext&quot;; }; then
     ac_cv_path_DOT=&quot;$as_dir/$ac_word$ac_exec_ext&quot;
     echo &quot;$as_me:$LINENO: found $as_dir/$ac_word$ac_exec_ext&quot; &gt;&amp;5
     break 2
   fi
 done
 done
+IFS=$as_save_IFS
 
   test -z &quot;$ac_cv_path_DOT&quot; &amp;&amp; ac_cv_path_DOT=&quot;:&quot;
   ;;
 esac
 fi
 DOT=$ac_cv_path_DOT
-
 if test -n &quot;$DOT&quot;; then
-  echo &quot;$as_me:$LINENO: result: $DOT&quot; &gt;&amp;5
-echo &quot;${ECHO_T}$DOT&quot; &gt;&amp;6
+  { echo &quot;$as_me:$LINENO: result: $DOT&quot; &gt;&amp;5
+echo &quot;${ECHO_T}$DOT&quot; &gt;&amp;6; }
 else
-  echo &quot;$as_me:$LINENO: result: no&quot; &gt;&amp;5
-echo &quot;${ECHO_T}no&quot; &gt;&amp;6
+  { echo &quot;$as_me:$LINENO: result: no&quot; &gt;&amp;5
+echo &quot;${ECHO_T}no&quot; &gt;&amp;6; }
 fi
 
 
+
 ac_ext=c
 ac_cpp='$CPP $CPPFLAGS'
 ac_compile='$CC -c $CFLAGS $CPPFLAGS conftest.$ac_ext &gt;&amp;5'
@@ -4636,38 +5200,185 @@
 ac_compiler_gnu=$ac_cv_c_compiler_gnu
 
 
-# Check whether --enable-dev-mode or --disable-dev-mode was given.
+# Check whether --enable-dev-mode was given.
 if test &quot;${enable_dev_mode+set}&quot; = set; then
-  enableval=&quot;$enable_dev_mode&quot;
-  case &quot;${enableval}&quot; in
+  enableval=$enable_dev_mode; case &quot;${enableval}&quot; in
 	      y|ye|yes) AST_DEVMODE=yes ;;
 	      n|no)  AST_DEVMODE=no ;;
 	      *) { { echo &quot;$as_me:$LINENO: error: bad value ${enableval} for --enable-dev-mode&quot; &gt;&amp;5
 echo &quot;$as_me: error: bad value ${enableval} for --enable-dev-mode&quot; &gt;&amp;2;}
    { (exit 1); exit 1; }; }  ;;
 	esac
-fi;
+fi
 
 
 
 
-echo &quot;$as_me:$LINENO: checking for egrep&quot; &gt;&amp;5
-echo $ECHO_N &quot;checking for egrep... $ECHO_C&quot; &gt;&amp;6
-if test &quot;${ac_cv_prog_egrep+set}&quot; = set; then
+
+{ echo &quot;$as_me:$LINENO: checking for grep that handles long lines and -e&quot; &gt;&amp;5
+echo $ECHO_N &quot;checking for grep that handles long lines and -e... $ECHO_C&quot; &gt;&amp;6; }
+if test &quot;${ac_cv_path_GREP+set}&quot; = set; then
   echo $ECHO_N &quot;(cached) $ECHO_C&quot; &gt;&amp;6
 else
-  if echo a | (grep -E '(a|b)') &gt;/dev/null 2&gt;&amp;1
-    then ac_cv_prog_egrep='grep -E'
-    else ac_cv_prog_egrep='egrep'
+  # Extract the first word of &quot;grep ggrep&quot; to use in msg output
+if test -z &quot;$GREP&quot;; then
+set dummy grep ggrep; ac_prog_name=$2
+if test &quot;${ac_cv_path_GREP+set}&quot; = set; then
+  echo $ECHO_N &quot;(cached) $ECHO_C&quot; &gt;&amp;6
+else
+  ac_path_GREP_found=false
+# Loop through the user's path and test for each of PROGNAME-LIST
+as_save_IFS=$IFS; IFS=$PATH_SEPARATOR
+for as_dir in $PATH$PATH_SEPARATOR/usr/xpg4/bin
+do
+  IFS=$as_save_IFS
+  test -z &quot;$as_dir&quot; &amp;&amp; as_dir=.
+  for ac_prog in grep ggrep; do
+  for ac_exec_ext in '' $ac_executable_extensions; do
+    ac_path_GREP=&quot;$as_dir/$ac_prog$ac_exec_ext&quot;
+    { test -f &quot;$ac_path_GREP&quot; &amp;&amp; $as_executable_p &quot;$ac_path_GREP&quot;; } || continue
+    # Check for GNU ac_path_GREP and select it if it is found.
+  # Check for GNU $ac_path_GREP
+case `&quot;$ac_path_GREP&quot; --version 2&gt;&amp;1` in
+*GNU*)
+  ac_cv_path_GREP=&quot;$ac_path_GREP&quot; ac_path_GREP_found=:;;
+*)
+  ac_count=0
+  echo $ECHO_N &quot;0123456789$ECHO_C&quot; &gt;&quot;conftest.in&quot;
+  while :
+  do
+    cat &quot;conftest.in&quot; &quot;conftest.in&quot; &gt;&quot;conftest.tmp&quot;
+    mv &quot;conftest.tmp&quot; &quot;conftest.in&quot;
+    cp &quot;conftest.in&quot; &quot;conftest.nl&quot;
+    echo 'GREP' &gt;&gt; &quot;conftest.nl&quot;
+    &quot;$ac_path_GREP&quot; -e 'GREP$' -e '-(cannot match)-' &lt; &quot;conftest.nl&quot; &gt;&quot;conftest.out&quot; 2&gt;/dev/null || break
+    diff &quot;conftest.out&quot; &quot;conftest.nl&quot; &gt;/dev/null 2&gt;&amp;1 || break
+    ac_count=`expr $ac_count + 1`
+    if test $ac_count -gt ${ac_path_GREP_max-0}; then
+      # Best one so far, save it but keep looking for a better one
+      ac_cv_path_GREP=&quot;$ac_path_GREP&quot;
+      ac_path_GREP_max=$ac_count
     fi
+    # 10*(2^10) chars as input seems more than enough
+    test $ac_count -gt 10 &amp;&amp; break
+  done
+  rm -f conftest.*;;
+esac
+
+
+    $ac_path_GREP_found &amp;&amp; break 3
+  done
+done
+
+done
+IFS=$as_save_IFS
+
+
 fi
-echo &quot;$as_me:$LINENO: result: $ac_cv_prog_egrep&quot; &gt;&amp;5
-echo &quot;${ECHO_T}$ac_cv_prog_egrep&quot; &gt;&amp;6
- EGREP=$ac_cv_prog_egrep
 
+GREP=&quot;$ac_cv_path_GREP&quot;
+if test -z &quot;$GREP&quot;; then
+  { { echo &quot;$as_me:$LINENO: error: no acceptable $ac_prog_name could be found in $PATH$PATH_SEPARATOR/usr/xpg4/bin&quot; &gt;&amp;5
+echo &quot;$as_me: error: no acceptable $ac_prog_name could be found in $PATH$PATH_SEPARATOR/usr/xpg4/bin&quot; &gt;&amp;2;}
+   { (exit 1); exit 1; }; }
+fi
 
-echo &quot;$as_me:$LINENO: checking for ANSI C header files&quot; &gt;&amp;5
-echo $ECHO_N &quot;checking for ANSI C header files... $ECHO_C&quot; &gt;&amp;6
+else
+  ac_cv_path_GREP=$GREP
+fi
+
+
+fi
+{ echo &quot;$as_me:$LINENO: result: $ac_cv_path_GREP&quot; &gt;&amp;5
+echo &quot;${ECHO_T}$ac_cv_path_GREP&quot; &gt;&amp;6; }
+ GREP=&quot;$ac_cv_path_GREP&quot;
+
+
+{ echo &quot;$as_me:$LINENO: checking for egrep&quot; &gt;&amp;5
+echo $ECHO_N &quot;checking for egrep... $ECHO_C&quot; &gt;&amp;6; }
+if test &quot;${ac_cv_path_EGREP+set}&quot; = set; then
+  echo $ECHO_N &quot;(cached) $ECHO_C&quot; &gt;&amp;6
+else
+  if echo a | $GREP -E '(a|b)' &gt;/dev/null 2&gt;&amp;1
+   then ac_cv_path_EGREP=&quot;$GREP -E&quot;
+   else
+     # Extract the first word of &quot;egrep&quot; to use in msg output
+if test -z &quot;$EGREP&quot;; then
+set dummy egrep; ac_prog_name=$2
+if test &quot;${ac_cv_path_EGREP+set}&quot; = set; then
+  echo $ECHO_N &quot;(cached) $ECHO_C&quot; &gt;&amp;6
+else
+  ac_path_EGREP_found=false
+# Loop through the user's path and test for each of PROGNAME-LIST
+as_save_IFS=$IFS; IFS=$PATH_SEPARATOR
+for as_dir in $PATH$PATH_SEPARATOR/usr/xpg4/bin
+do
+  IFS=$as_save_IFS
+  test -z &quot;$as_dir&quot; &amp;&amp; as_dir=.
+  for ac_prog in egrep; do
+  for ac_exec_ext in '' $ac_executable_extensions; do
+    ac_path_EGREP=&quot;$as_dir/$ac_prog$ac_exec_ext&quot;
+    { test -f &quot;$ac_path_EGREP&quot; &amp;&amp; $as_executable_p &quot;$ac_path_EGREP&quot;; } || continue
+    # Check for GNU ac_path_EGREP and select it if it is found.
+  # Check for GNU $ac_path_EGREP
+case `&quot;$ac_path_EGREP&quot; --version 2&gt;&amp;1` in
+*GNU*)
+  ac_cv_path_EGREP=&quot;$ac_path_EGREP&quot; ac_path_EGREP_found=:;;
+*)
+  ac_count=0
+  echo $ECHO_N &quot;0123456789$ECHO_C&quot; &gt;&quot;conftest.in&quot;
+  while :
+  do
+    cat &quot;conftest.in&quot; &quot;conftest.in&quot; &gt;&quot;conftest.tmp&quot;
+    mv &quot;conftest.tmp&quot; &quot;conftest.in&quot;
+    cp &quot;conftest.in&quot; &quot;conftest.nl&quot;
+    echo 'EGREP' &gt;&gt; &quot;conftest.nl&quot;
+    &quot;$ac_path_EGREP&quot; 'EGREP$' &lt; &quot;conftest.nl&quot; &gt;&quot;conftest.out&quot; 2&gt;/dev/null || break
+    diff &quot;conftest.out&quot; &quot;conftest.nl&quot; &gt;/dev/null 2&gt;&amp;1 || break
+    ac_count=`expr $ac_count + 1`
+    if test $ac_count -gt ${ac_path_EGREP_max-0}; then
+      # Best one so far, save it but keep looking for a better one
+      ac_cv_path_EGREP=&quot;$ac_path_EGREP&quot;
+      ac_path_EGREP_max=$ac_count
+    fi
+    # 10*(2^10) chars as input seems more than enough
+    test $ac_count -gt 10 &amp;&amp; break
+  done
+  rm -f conftest.*;;
+esac
+
+
+    $ac_path_EGREP_found &amp;&amp; break 3
+  done
+done
+
+done
+IFS=$as_save_IFS
+
+
+fi
+
+EGREP=&quot;$ac_cv_path_EGREP&quot;
+if test -z &quot;$EGREP&quot;; then
+  { { echo &quot;$as_me:$LINENO: error: no acceptable $ac_prog_name could be found in $PATH$PATH_SEPARATOR/usr/xpg4/bin&quot; &gt;&amp;5
+echo &quot;$as_me: error: no acceptable $ac_prog_name could be found in $PATH$PATH_SEPARATOR/usr/xpg4/bin&quot; &gt;&amp;2;}
+   { (exit 1); exit 1; }; }
+fi
+
+else
+  ac_cv_path_EGREP=$EGREP
+fi
+
+
+   fi
+fi
+{ echo &quot;$as_me:$LINENO: result: $ac_cv_path_EGREP&quot; &gt;&amp;5
+echo &quot;${ECHO_T}$ac_cv_path_EGREP&quot; &gt;&amp;6; }
+ EGREP=&quot;$ac_cv_path_EGREP&quot;
+
+
+{ echo &quot;$as_me:$LINENO: checking for ANSI C header files&quot; &gt;&amp;5
+echo $ECHO_N &quot;checking for ANSI C header files... $ECHO_C&quot; &gt;&amp;6; }
 if test &quot;${ac_cv_header_stdc+set}&quot; = set; then
   echo $ECHO_N &quot;(cached) $ECHO_C&quot; &gt;&amp;6
 else
@@ -4717,8 +5428,9 @@
   echo &quot;$as_me: failed program was:&quot; &gt;&amp;5
 sed 's/^/| /' conftest.$ac_ext &gt;&amp;5
 
-ac_cv_header_stdc=no
+	ac_cv_header_stdc=no
 fi
+
 rm -f conftest.err conftest.$ac_objext conftest.$ac_ext
 
 if test $ac_cv_header_stdc = yes; then
@@ -4795,8 +5507,8 @@
   for (i = 0; i &lt; 256; i++)
     if (XOR (islower (i), ISLOWER (i))
 	|| toupper (i) != TOUPPER (i))
-      exit(2);
-  exit (0);
+      return 2;
+  return 0;
 }
 _ACEOF
 rm -f conftest$ac_exeext
@@ -4819,12 +5531,14 @@
 ( exit $ac_status )
 ac_cv_header_stdc=no
 fi
-rm -f core *.core gmon.out bb.out conftest$ac_exeext conftest.$ac_objext conftest.$ac_ext
+rm -f core *.core core.conftest.* gmon.out bb.out conftest$ac_exeext conftest.$ac_objext conftest.$ac_ext
 fi
+
+
 fi
 fi
-echo &quot;$as_me:$LINENO: result: $ac_cv_header_stdc&quot; &gt;&amp;5
-echo &quot;${ECHO_T}$ac_cv_header_stdc&quot; &gt;&amp;6
+{ echo &quot;$as_me:$LINENO: result: $ac_cv_header_stdc&quot; &gt;&amp;5
+echo &quot;${ECHO_T}$ac_cv_header_stdc&quot; &gt;&amp;6; }
 if test $ac_cv_header_stdc = yes; then
 
 cat &gt;&gt;confdefs.h &lt;&lt;\_ACEOF
@@ -4847,9 +5561,9 @@
 		  inttypes.h stdint.h unistd.h
 do
 as_ac_Header=`echo &quot;ac_cv_header_$ac_header&quot; | $as_tr_sh`
-echo &quot;$as_me:$LINENO: checking for $ac_header&quot; &gt;&amp;5
-echo $ECHO_N &quot;checking for $ac_header... $ECHO_C&quot; &gt;&amp;6
-if eval &quot;test \&quot;\${$as_ac_Header+set}\&quot; = set&quot;; then
+{ echo &quot;$as_me:$LINENO: checking for $ac_header&quot; &gt;&amp;5
+echo $ECHO_N &quot;checking for $ac_header... $ECHO_C&quot; &gt;&amp;6; }
+if { as_var=$as_ac_Header; eval &quot;test \&quot;\${$as_var+set}\&quot; = set&quot;; }; then
   echo $ECHO_N &quot;(cached) $ECHO_C&quot; &gt;&amp;6
 else
   cat &gt;conftest.$ac_ext &lt;&lt;_ACEOF
@@ -4889,12 +5603,14 @@
   echo &quot;$as_me: failed program was:&quot; &gt;&amp;5
 sed 's/^/| /' conftest.$ac_ext &gt;&amp;5
 
-eval &quot;$as_ac_Header=no&quot;
+	eval &quot;$as_ac_Header=no&quot;
 fi
+
 rm -f conftest.err conftest.$ac_objext conftest.$ac_ext
 fi
-echo &quot;$as_me:$LINENO: result: `eval echo '${'$as_ac_Header'}'`&quot; &gt;&amp;5
-echo &quot;${ECHO_T}`eval echo '${'$as_ac_Header'}'`&quot; &gt;&amp;6
+ac_res=`eval echo '${'$as_ac_Header'}'`
+	       { echo &quot;$as_me:$LINENO: result: $ac_res&quot; &gt;&amp;5
+echo &quot;${ECHO_T}$ac_res&quot; &gt;&amp;6; }
 if test `eval echo '${'$as_ac_Header'}'` = yes; then
   cat &gt;&gt;confdefs.h &lt;&lt;_ACEOF
 #define `echo &quot;HAVE_$ac_header&quot; | $as_tr_cpp` 1
@@ -4907,34 +5623,34 @@
 
 
 
-# Check whether --with-asound or --without-asound was given.
+# Check whether --with-asound was given.
 if test &quot;${with_asound+set}&quot; = set; then
-  withval=&quot;$with_asound&quot;
-
+  withval=$with_asound;
 case ${withval} in
      n|no)
-     USE_asound=no
+     USE_ALSA=no
      ;;
      y|ye|yes)
-     asound_MANDATORY=&quot;yes&quot;
+     ALSA_MANDATORY=&quot;yes&quot;
      ;;
      *)
-     asound_DIR=&quot;${withval}&quot;
-     asound_MANDATORY=&quot;yes&quot;
+     ALSA_DIR=&quot;${withval}&quot;
+     ALSA_MANDATORY=&quot;yes&quot;
      ;;
 esac
 
-fi;
+fi
 
-PBX_LIBasound=0
 
-if test &quot;${USE_asound}&quot; != &quot;no&quot;; then
+PBX_LIBALSA=0
+
+if test &quot;${USE_ALSA}&quot; != &quot;no&quot;; then
    pbxlibdir=&quot;&quot;
-   if test &quot;x${asound_DIR}&quot; != &quot;x&quot;; then
+   if test &quot;x${ALSA_DIR}&quot; != &quot;x&quot;; then
       pbxlibdir=&quot;-L${asound_DIR}/lib&quot;
    fi
-   echo &quot;$as_me:$LINENO: checking for snd_spcm_init in -lasound&quot; &gt;&amp;5
-echo $ECHO_N &quot;checking for snd_spcm_init in -lasound... $ECHO_C&quot; &gt;&amp;6
+   { echo &quot;$as_me:$LINENO: checking for snd_spcm_init in -lasound&quot; &gt;&amp;5
+echo $ECHO_N &quot;checking for snd_spcm_init in -lasound... $ECHO_C&quot; &gt;&amp;6; }
 if test &quot;${ac_cv_lib_asound_snd_spcm_init+set}&quot; = set; then
   echo $ECHO_N &quot;(cached) $ECHO_C&quot; &gt;&amp;6
 else
@@ -4947,17 +5663,17 @@
 cat &gt;&gt;conftest.$ac_ext &lt;&lt;_ACEOF
 /* end confdefs.h.  */
 
-/* Override any gcc2 internal prototype to avoid an error.  */
+/* Override any GCC internal prototype to avoid an error.
+   Use char because int might match the return type of a GCC
+   builtin and then its argument prototype would still apply.  */
 #ifdef __cplusplus
 extern &quot;C&quot;
 #endif
-/* We use char because int might match the return type of a gcc2
-   builtin and then its argument prototype would still apply.  */
 char snd_spcm_init ();
 int
 main ()
 {
-snd_spcm_init ();
+return snd_spcm_init ();
   ;
   return 0;
 }
@@ -4989,39 +5705,43 @@
   echo &quot;$as_me: failed program was:&quot; &gt;&amp;5
 sed 's/^/| /' conftest.$ac_ext &gt;&amp;5
 
-ac_cv_lib_asound_snd_spcm_init=no
+	ac_cv_lib_asound_snd_spcm_init=no
 fi
+
 rm -f conftest.err conftest.$ac_objext \
       conftest$ac_exeext conftest.$ac_ext
 LIBS=$ac_check_lib_save_LIBS
 fi
-echo &quot;$as_me:$LINENO: result: $ac_cv_lib_asound_snd_spcm_init&quot; &gt;&amp;5
-echo &quot;${ECHO_T}$ac_cv_lib_asound_snd_spcm_init&quot; &gt;&amp;6
+{ echo &quot;$as_me:$LINENO: result: $ac_cv_lib_asound_snd_spcm_init&quot; &gt;&amp;5
+echo &quot;${ECHO_T}$ac_cv_lib_asound_snd_spcm_init&quot; &gt;&amp;6; }
 if test $ac_cv_lib_asound_snd_spcm_init = yes; then
-  :
+  AST_ALSA_FOUND=yes
+else
+  AST_ALSA_FOUND=no
 fi
 
 
-   if test &quot;${ac_cv_lib_asound_snd_spcm_init}&quot; = &quot;yes&quot;; then
-      asound_LIB=&quot;-lasound -lm -ldl&quot;
+   if test &quot;${AST_ALSA_FOUND}&quot; = &quot;yes&quot;; then
+      ALSA_LIB=&quot;-lasound -lm -ldl&quot;
       ALSA_HEADER_FOUND=&quot;1&quot;
-      if test &quot;x${asound_DIR}&quot; != &quot;x&quot;; then
-         asound_LIB=&quot;${pbxlibdir} ${asound_LIB}&quot;
-	 asound_INCLUDE=&quot;-I${asound_DIR}/include&quot;
+      if test &quot;x${ALSA_DIR}&quot; != &quot;x&quot;; then
+         ALSA_LIB=&quot;${pbxlibdir} ${ALSA_LIB}&quot;
+	 ALSA_INCLUDE=&quot;-I${ALSA_DIR}/include&quot;
 	 if test &quot;xalsa/asoundlib.h&quot; != &quot;x&quot; ; then
-	    as_ac_Header=`echo &quot;ac_cv_header_${asound_DIR}/include/alsa/asoundlib.h&quot; | $as_tr_sh`
-if eval &quot;test \&quot;\${$as_ac_Header+set}\&quot; = set&quot;; then
-  echo &quot;$as_me:$LINENO: checking for ${asound_DIR}/include/alsa/asoundlib.h&quot; &gt;&amp;5
-echo $ECHO_N &quot;checking for ${asound_DIR}/include/alsa/asoundlib.h... $ECHO_C&quot; &gt;&amp;6
-if eval &quot;test \&quot;\${$as_ac_Header+set}\&quot; = set&quot;; then
+	    as_ac_Header=`echo &quot;ac_cv_header_${ALSA_DIR}/include/alsa/asoundlib.h&quot; | $as_tr_sh`
+if { as_var=$as_ac_Header; eval &quot;test \&quot;\${$as_var+set}\&quot; = set&quot;; }; then
+  { echo &quot;$as_me:$LINENO: checking for ${ALSA_DIR}/include/alsa/asoundlib.h&quot; &gt;&amp;5
+echo $ECHO_N &quot;checking for ${ALSA_DIR}/include/alsa/asoundlib.h... $ECHO_C&quot; &gt;&amp;6; }
+if { as_var=$as_ac_Header; eval &quot;test \&quot;\${$as_var+set}\&quot; = set&quot;; }; then
   echo $ECHO_N &quot;(cached) $ECHO_C&quot; &gt;&amp;6
 fi
-echo &quot;$as_me:$LINENO: result: `eval echo '${'$as_ac_Header'}'`&quot; &gt;&amp;5
-echo &quot;${ECHO_T}`eval echo '${'$as_ac_Header'}'`&quot; &gt;&amp;6
+ac_res=`eval echo '${'$as_ac_Header'}'`
+	       { echo &quot;$as_me:$LINENO: result: $ac_res&quot; &gt;&amp;5
+echo &quot;${ECHO_T}$ac_res&quot; &gt;&amp;6; }
 else
   # Is the header compilable?
-echo &quot;$as_me:$LINENO: checking ${asound_DIR}/include/alsa/asoundlib.h usability&quot; &gt;&amp;5
-echo $ECHO_N &quot;checking ${asound_DIR}/include/alsa/asoundlib.h usability... $ECHO_C&quot; &gt;&amp;6
+{ echo &quot;$as_me:$LINENO: checking ${ALSA_DIR}/include/alsa/asoundlib.h usability&quot; &gt;&amp;5
+echo $ECHO_N &quot;checking ${ALSA_DIR}/include/alsa/asoundlib.h usability... $ECHO_C&quot; &gt;&amp;6; }
 cat &gt;conftest.$ac_ext &lt;&lt;_ACEOF
 /* confdefs.h.  */
 _ACEOF
@@ -5029,7 +5749,7 @@
 cat &gt;&gt;conftest.$ac_ext &lt;&lt;_ACEOF
 /* end confdefs.h.  */
 $ac_includes_default
-#include &lt;${asound_DIR}/include/alsa/asoundlib.h&gt;
+#include &lt;${ALSA_DIR}/include/alsa/asoundlib.h&gt;
 _ACEOF
 rm -f conftest.$ac_objext
 if { (eval echo &quot;$as_me:$LINENO: \&quot;$ac_compile\&quot;&quot;) &gt;&amp;5
@@ -5058,22 +5778,23 @@
   echo &quot;$as_me: failed program was:&quot; &gt;&amp;5
 sed 's/^/| /' conftest.$ac_ext &gt;&amp;5
 
-ac_header_compiler=no
+	ac_header_compiler=no
 fi
+
 rm -f conftest.err conftest.$ac_objext conftest.$ac_ext
-echo &quot;$as_me:$LINENO: result: $ac_header_compiler&quot; &gt;&amp;5
-echo &quot;${ECHO_T}$ac_header_compiler&quot; &gt;&amp;6
+{ echo &quot;$as_me:$LINENO: result: $ac_header_compiler&quot; &gt;&amp;5
+echo &quot;${ECHO_T}$ac_header_compiler&quot; &gt;&amp;6; }
 
 # Is the header present?
-echo &quot;$as_me:$LINENO: checking ${asound_DIR}/include/alsa/asoundlib.h presence&quot; &gt;&amp;5
-echo $ECHO_N &quot;checking ${asound_DIR}/include/alsa/asoundlib.h presence... $ECHO_C&quot; &gt;&amp;6
+{ echo &quot;$as_me:$LINENO: checking ${ALSA_DIR}/include/alsa/asoundlib.h presence&quot; &gt;&amp;5
+echo $ECHO_N &quot;checking ${ALSA_DIR}/include/alsa/asoundlib.h presence... $ECHO_C&quot; &gt;&amp;6; }
 cat &gt;conftest.$ac_ext &lt;&lt;_ACEOF
 /* confdefs.h.  */
 _ACEOF
 cat confdefs.h &gt;&gt;conftest.$ac_ext
 cat &gt;&gt;conftest.$ac_ext &lt;&lt;_ACEOF
 /* end confdefs.h.  */
-#include &lt;${asound_DIR}/include/alsa/asoundlib.h&gt;
+#include &lt;${ALSA_DIR}/include/alsa/asoundlib.h&gt;
 _ACEOF
 if { (eval echo &quot;$as_me:$LINENO: \&quot;$ac_cpp conftest.$ac_ext\&quot;&quot;) &gt;&amp;5
   (eval $ac_cpp conftest.$ac_ext) 2&gt;conftest.er1
@@ -5100,51 +5821,46 @@
 
   ac_header_preproc=no
 fi
+
 rm -f conftest.err conftest.$ac_ext
-echo &quot;$as_me:$LINENO: result: $ac_header_preproc&quot; &gt;&amp;5
-echo &quot;${ECHO_T}$ac_header_preproc&quot; &gt;&amp;6
+{ echo &quot;$as_me:$LINENO: result: $ac_header_preproc&quot; &gt;&amp;5
+echo &quot;${ECHO_T}$ac_header_preproc&quot; &gt;&amp;6; }
 
 # So?  What about this header?
 case $ac_header_compiler:$ac_header_preproc:$ac_c_preproc_warn_flag in
   yes:no: )
-    { echo &quot;$as_me:$LINENO: WARNING: ${asound_DIR}/include/alsa/asoundlib.h: accepted by the compiler, rejected by the preprocessor!&quot; &gt;&amp;5
-echo &quot;$as_me: WARNING: ${asound_DIR}/include/alsa/asoundlib.h: accepted by the compiler, rejected by the preprocessor!&quot; &gt;&amp;2;}
-    { echo &quot;$as_me:$LINENO: WARNING: ${asound_DIR}/include/alsa/asoundlib.h: proceeding with the compiler's result&quot; &gt;&amp;5
-echo &quot;$as_me: WARNING: ${asound_DIR}/include/alsa/asoundlib.h: proceeding with the compiler's result&quot; &gt;&amp;2;}
+    { echo &quot;$as_me:$LINENO: WARNING: ${ALSA_DIR}/include/alsa/asoundlib.h: accepted by the compiler, rejected by the preprocessor!&quot; &gt;&amp;5
+echo &quot;$as_me: WARNING: ${ALSA_DIR}/include/alsa/asoundlib.h: accepted by the compiler, rejected by the preprocessor!&quot; &gt;&amp;2;}
+    { echo &quot;$as_me:$LINENO: WARNING: ${ALSA_DIR}/include/alsa/asoundlib.h: proceeding with the compiler's result&quot; &gt;&amp;5
+echo &quot;$as_me: WARNING: ${ALSA_DIR}/include/alsa/asoundlib.h: proceeding with the compiler's result&quot; &gt;&amp;2;}
     ac_header_preproc=yes
     ;;
   no:yes:* )
-    { echo &quot;$as_me:$LINENO: WARNING: ${asound_DIR}/include/alsa/asoundlib.h: present but cannot be compiled&quot; &gt;&amp;5
-echo &quot;$as_me: WARNING: ${asound_DIR}/include/alsa/asoundlib.h: present but cannot be compiled&quot; &gt;&amp;2;}
-    { echo &quot;$as_me:$LINENO: WARNING: ${asound_DIR}/include/alsa/asoundlib.h:     check for missing prerequisite headers?&quot; &gt;&amp;5
-echo &quot;$as_me: WARNING: ${asound_DIR}/include/alsa/asoundlib.h:     check for missing prerequisite headers?&quot; &gt;&amp;2;}
-    { echo &quot;$as_me:$LINENO: WARNING: ${asound_DIR}/include/alsa/asoundlib.h: see the Autoconf documentation&quot; &gt;&amp;5
-echo &quot;$as_me: WARNING: ${asound_DIR}/include/alsa/asoundlib.h: see the Autoconf documentation&quot; &gt;&amp;2;}
-    { echo &quot;$as_me:$LINENO: WARNING: ${asound_DIR}/include/alsa/asoundlib.h:     section \&quot;Present But Cannot Be Compiled\&quot;&quot; &gt;&amp;5
-echo &quot;$as_me: WARNING: ${asound_DIR}/include/alsa/asoundlib.h:     section \&quot;Present But Cannot Be Compiled\&quot;&quot; &gt;&amp;2;}
-    { echo &quot;$as_me:$LINENO: WARNING: ${asound_DIR}/include/alsa/asoundlib.h: proceeding with the preprocessor's result&quot; &gt;&amp;5
-echo &quot;$as_me: WARNING: ${asound_DIR}/include/alsa/asoundlib.h: proceeding with the preprocessor's result&quot; &gt;&amp;2;}
-    { echo &quot;$as_me:$LINENO: WARNING: ${asound_DIR}/include/alsa/asoundlib.h: in the future, the compiler will take precedence&quot; &gt;&amp;5
-echo &quot;$as_me: WARNING: ${asound_DIR}/include/alsa/asoundlib.h: in the future, the compiler will take precedence&quot; &gt;&amp;2;}
-    (
-      cat &lt;&lt;\_ASBOX
-## ------------------------------------------ ##
-## Report this to the AC_PACKAGE_NAME lists.  ##
-## ------------------------------------------ ##
-_ASBOX
-    ) |
-      sed &quot;s/^/$as_me: WARNING:     /&quot; &gt;&amp;2
+    { echo &quot;$as_me:$LINENO: WARNING: ${ALSA_DIR}/include/alsa/asoundlib.h: present but cannot be compiled&quot; &gt;&amp;5
+echo &quot;$as_me: WARNING: ${ALSA_DIR}/include/alsa/asoundlib.h: present but cannot be compiled&quot; &gt;&amp;2;}
+    { echo &quot;$as_me:$LINENO: WARNING: ${ALSA_DIR}/include/alsa/asoundlib.h:     check for missing prerequisite headers?&quot; &gt;&amp;5
+echo &quot;$as_me: WARNING: ${ALSA_DIR}/include/alsa/asoundlib.h:     check for missing prerequisite headers?&quot; &gt;&amp;2;}
+    { echo &quot;$as_me:$LINENO: WARNING: ${ALSA_DIR}/include/alsa/asoundlib.h: see the Autoconf documentation&quot; &gt;&amp;5
+echo &quot;$as_me: WARNING: ${ALSA_DIR}/include/alsa/asoundlib.h: see the Autoconf documentation&quot; &gt;&amp;2;}
+    { echo &quot;$as_me:$LINENO: WARNING: ${ALSA_DIR}/include/alsa/asoundlib.h:     section \&quot;Present But Cannot Be Compiled\&quot;&quot; &gt;&amp;5
+echo &quot;$as_me: WARNING: ${ALSA_DIR}/include/alsa/asoundlib.h:     section \&quot;Present But Cannot Be Compiled\&quot;&quot; &gt;&amp;2;}
+    { echo &quot;$as_me:$LINENO: WARNING: ${ALSA_DIR}/include/alsa/asoundlib.h: proceeding with the preprocessor's result&quot; &gt;&amp;5
+echo &quot;$as_me: WARNING: ${ALSA_DIR}/include/alsa/asoundlib.h: proceeding with the preprocessor's result&quot; &gt;&amp;2;}
+    { echo &quot;$as_me:$LINENO: WARNING: ${ALSA_DIR}/include/alsa/asoundlib.h: in the future, the compiler will take precedence&quot; &gt;&amp;5
+echo &quot;$as_me: WARNING: ${ALSA_DIR}/include/alsa/asoundlib.h: in the future, the compiler will take precedence&quot; &gt;&amp;2;}
+
     ;;
 esac
-echo &quot;$as_me:$LINENO: checking for ${asound_DIR}/include/alsa/asoundlib.h&quot; &gt;&amp;5
-echo $ECHO_N &quot;checking for ${asound_DIR}/include/alsa/asoundlib.h... $ECHO_C&quot; &gt;&amp;6
-if eval &quot;test \&quot;\${$as_ac_Header+set}\&quot; = set&quot;; then
+{ echo &quot;$as_me:$LINENO: checking for ${ALSA_DIR}/include/alsa/asoundlib.h&quot; &gt;&amp;5
+echo $ECHO_N &quot;checking for ${ALSA_DIR}/include/alsa/asoundlib.h... $ECHO_C&quot; &gt;&amp;6; }
+if { as_var=$as_ac_Header; eval &quot;test \&quot;\${$as_var+set}\&quot; = set&quot;; }; then
   echo $ECHO_N &quot;(cached) $ECHO_C&quot; &gt;&amp;6
 else
   eval &quot;$as_ac_Header=\$ac_header_preproc&quot;
 fi
-echo &quot;$as_me:$LINENO: result: `eval echo '${'$as_ac_Header'}'`&quot; &gt;&amp;5
-echo &quot;${ECHO_T}`eval echo '${'$as_ac_Header'}'`&quot; &gt;&amp;6
+ac_res=`eval echo '${'$as_ac_Header'}'`
+	       { echo &quot;$as_me:$LINENO: result: $ac_res&quot; &gt;&amp;5
+echo &quot;${ECHO_T}$ac_res&quot; &gt;&amp;6; }
 
 fi
 if test `eval echo '${'$as_ac_Header'}'` = yes; then
@@ -5158,17 +5874,17 @@
       else
 	 if test &quot;xalsa/asoundlib.h&quot; != &quot;x&quot; ; then
             if test &quot;${ac_cv_header_alsa_asoundlib_h+set}&quot; = set; then
-  echo &quot;$as_me:$LINENO: checking for alsa/asoundlib.h&quot; &gt;&amp;5
-echo $ECHO_N &quot;checking for alsa/asoundlib.h... $ECHO_C&quot; &gt;&amp;6
+  { echo &quot;$as_me:$LINENO: checking for alsa/asoundlib.h&quot; &gt;&amp;5
+echo $ECHO_N &quot;checking for alsa/asoundlib.h... $ECHO_C&quot; &gt;&amp;6; }
 if test &quot;${ac_cv_header_alsa_asoundlib_h+set}&quot; = set; then
   echo $ECHO_N &quot;(cached) $ECHO_C&quot; &gt;&amp;6
 fi
-echo &quot;$as_me:$LINENO: result: $ac_cv_header_alsa_asoundlib_h&quot; &gt;&amp;5
-echo &quot;${ECHO_T}$ac_cv_header_alsa_asoundlib_h&quot; &gt;&amp;6
+{ echo &quot;$as_me:$LINENO: result: $ac_cv_header_alsa_asoundlib_h&quot; &gt;&amp;5
+echo &quot;${ECHO_T}$ac_cv_header_alsa_asoundlib_h&quot; &gt;&amp;6; }
 else
   # Is the header compilable?
-echo &quot;$as_me:$LINENO: checking alsa/asoundlib.h usability&quot; &gt;&amp;5
-echo $ECHO_N &quot;checking alsa/asoundlib.h usability... $ECHO_C&quot; &gt;&amp;6
+{ echo &quot;$as_me:$LINENO: checking alsa/asoundlib.h usability&quot; &gt;&amp;5
+echo $ECHO_N &quot;checking alsa/asoundlib.h usability... $ECHO_C&quot; &gt;&amp;6; }
 cat &gt;conftest.$ac_ext &lt;&lt;_ACEOF
 /* confdefs.h.  */
 _ACEOF
@@ -5205,15 +5921,16 @@
   echo &quot;$as_me: failed program was:&quot; &gt;&amp;5
 sed 's/^/| /' conftest.$ac_ext &gt;&amp;5
 
-ac_header_compiler=no
+	ac_header_compiler=no
 fi
+
 rm -f conftest.err conftest.$ac_objext conftest.$ac_ext
-echo &quot;$as_me:$LINENO: result: $ac_header_compiler&quot; &gt;&amp;5
-echo &quot;${ECHO_T}$ac_header_compiler&quot; &gt;&amp;6
+{ echo &quot;$as_me:$LINENO: result: $ac_header_compiler&quot; &gt;&amp;5
+echo &quot;${ECHO_T}$ac_header_compiler&quot; &gt;&amp;6; }
 
 # Is the header present?
-echo &quot;$as_me:$LINENO: checking alsa/asoundlib.h presence&quot; &gt;&amp;5
-echo $ECHO_N &quot;checking alsa/asoundlib.h presence... $ECHO_C&quot; &gt;&amp;6
+{ echo &quot;$as_me:$LINENO: checking alsa/asoundlib.h presence&quot; &gt;&amp;5
+echo $ECHO_N &quot;checking alsa/asoundlib.h presence... $ECHO_C&quot; &gt;&amp;6; }
 cat &gt;conftest.$ac_ext &lt;&lt;_ACEOF
 /* confdefs.h.  */
 _ACEOF
@@ -5247,9 +5964,10 @@
 
   ac_header_preproc=no
 fi
+
 rm -f conftest.err conftest.$ac_ext
-echo &quot;$as_me:$LINENO: result: $ac_header_preproc&quot; &gt;&amp;5
-echo &quot;${ECHO_T}$ac_header_preproc&quot; &gt;&amp;6
+{ echo &quot;$as_me:$LINENO: result: $ac_header_preproc&quot; &gt;&amp;5
+echo &quot;${ECHO_T}$ac_header_preproc&quot; &gt;&amp;6; }
 
 # So?  What about this header?
 case $ac_header_compiler:$ac_header_preproc:$ac_c_preproc_warn_flag in
@@ -5273,25 +5991,18 @@
 echo &quot;$as_me: WARNING: alsa/asoundlib.h: proceeding with the preprocessor's result&quot; &gt;&amp;2;}
     { echo &quot;$as_me:$LINENO: WARNING: alsa/asoundlib.h: in the future, the compiler will take precedence&quot; &gt;&amp;5
 echo &quot;$as_me: WARNING: alsa/asoundlib.h: in the future, the compiler will take precedence&quot; &gt;&amp;2;}
-    (
-      cat &lt;&lt;\_ASBOX
-## ------------------------------------------ ##
-## Report this to the AC_PACKAGE_NAME lists.  ##
-## ------------------------------------------ ##
-_ASBOX
-    ) |
-      sed &quot;s/^/$as_me: WARNING:     /&quot; &gt;&amp;2
+
     ;;
 esac
-echo &quot;$as_me:$LINENO: checking for alsa/asoundlib.h&quot; &gt;&amp;5
-echo $ECHO_N &quot;checking for alsa/asoundlib.h... $ECHO_C&quot; &gt;&amp;6
+{ echo &quot;$as_me:$LINENO: checking for alsa/asoundlib.h&quot; &gt;&amp;5
+echo $ECHO_N &quot;checking for alsa/asoundlib.h... $ECHO_C&quot; &gt;&amp;6; }
 if test &quot;${ac_cv_header_alsa_asoundlib_h+set}&quot; = set; then
   echo $ECHO_N &quot;(cached) $ECHO_C&quot; &gt;&amp;6
 else
   ac_cv_header_alsa_asoundlib_h=$ac_header_preproc
 fi
-echo &quot;$as_me:$LINENO: result: $ac_cv_header_alsa_asoundlib_h&quot; &gt;&amp;5
-echo &quot;${ECHO_T}$ac_cv_header_alsa_asoundlib_h&quot; &gt;&amp;6
+{ echo &quot;$as_me:$LINENO: result: $ac_cv_header_alsa_asoundlib_h&quot; &gt;&amp;5
+echo &quot;${ECHO_T}$ac_cv_header_alsa_asoundlib_h&quot; &gt;&amp;6; }
 
 fi
 if test $ac_cv_header_alsa_asoundlib_h = yes; then
@@ -5304,7 +6015,7 @@
 	 fi
       fi
       if test &quot;x${ALSA_HEADER_FOUND}&quot; = &quot;x0&quot; ; then
-         if test ! -z &quot;${asound_MANDATORY}&quot; ;
+         if test ! -z &quot;${ALSA_MANDATORY}&quot; ;
          then
             echo &quot; ***&quot;
             echo &quot; *** It appears that you do not have the asound development package installed.&quot;
@@ -5312,18 +6023,18 @@
             echo &quot; *** without explicitly specifying --with-asound&quot;
             exit 1
          fi
-         asound_LIB=&quot;&quot;
-         asound_INCLUDE=&quot;&quot;
-         PBX_LIBasound=0
+         ALSA_LIB=&quot;&quot;
+         ALSA_INCLUDE=&quot;&quot;
+         PBX_LIBALSA=0
       else
-         PBX_LIBasound=1
+         PBX_LIBALSA=1
 
 cat &gt;&gt;confdefs.h &lt;&lt;_ACEOF
 #define HAVE_ALSA 1
 _ACEOF
 
       fi
-   elif test ! -z &quot;${asound_MANDATORY}&quot;;
+   elif test ! -z &quot;${ALSA_MANDATORY}&quot;;
    then
       echo &quot;***&quot;
       echo &quot;*** The Advanced Linux Sound Architecture installation on this system appears to be broken.&quot;
@@ -5338,34 +6049,34 @@
 
 
 
-# Check whether --with-curses or --without-curses was given.
+# Check whether --with-curses was given.
 if test &quot;${with_curses+set}&quot; = set; then
-  withval=&quot;$with_curses&quot;
-
+  withval=$with_curses;
 case ${withval} in
      n|no)
-     USE_curses=no
+     USE_CURSES=no
      ;;
      y|ye|yes)
-     curses_MANDATORY=&quot;yes&quot;
+     CURSES_MANDATORY=&quot;yes&quot;
      ;;
      *)
-     curses_DIR=&quot;${withval}&quot;
-     curses_MANDATORY=&quot;yes&quot;
+     CURSES_DIR=&quot;${withval}&quot;
+     CURSES_MANDATORY=&quot;yes&quot;
      ;;
 esac
 
-fi;
+fi
 
-PBX_LIBcurses=0
 
-if test &quot;${USE_curses}&quot; != &quot;no&quot;; then
+PBX_LIBCURSES=0
+
+if test &quot;${USE_CURSES}&quot; != &quot;no&quot;; then
    pbxlibdir=&quot;&quot;
-   if test &quot;x${curses_DIR}&quot; != &quot;x&quot;; then
+   if test &quot;x${CURSES_DIR}&quot; != &quot;x&quot;; then
       pbxlibdir=&quot;-L${curses_DIR}/lib&quot;
    fi
-   echo &quot;$as_me:$LINENO: checking for initscr in -lcurses&quot; &gt;&amp;5
-echo $ECHO_N &quot;checking for initscr in -lcurses... $ECHO_C&quot; &gt;&amp;6
+   { echo &quot;$as_me:$LINENO: checking for initscr in -lcurses&quot; &gt;&amp;5
+echo $ECHO_N &quot;checking for initscr in -lcurses... $ECHO_C&quot; &gt;&amp;6; }
 if test &quot;${ac_cv_lib_curses_initscr+set}&quot; = set; then
   echo $ECHO_N &quot;(cached) $ECHO_C&quot; &gt;&amp;6
 else
@@ -5378,17 +6089,17 @@
 cat &gt;&gt;conftest.$ac_ext &lt;&lt;_ACEOF
 /* end confdefs.h.  */
 
-/* Override any gcc2 internal prototype to avoid an error.  */
+/* Override any GCC internal prototype to avoid an error.
+   Use char because int might match the return type of a GCC
+   builtin and then its argument prototype would still apply.  */
 #ifdef __cplusplus
 extern &quot;C&quot;
 #endif
-/* We use char because int might match the return type of a gcc2
-   builtin and then its argument prototype would still apply.  */
 char initscr ();
 int
 main ()
 {
-initscr ();
+return initscr ();
   ;
   return 0;
 }
@@ -5420,39 +6131,43 @@
   echo &quot;$as_me: failed program was:&quot; &gt;&amp;5
 sed 's/^/| /' conftest.$ac_ext &gt;&amp;5
 
-ac_cv_lib_curses_initscr=no
+	ac_cv_lib_curses_initscr=no
 fi
+
 rm -f conftest.err conftest.$ac_objext \
       conftest$ac_exeext conftest.$ac_ext
 LIBS=$ac_check_lib_save_LIBS
 fi
-echo &quot;$as_me:$LINENO: result: $ac_cv_lib_curses_initscr&quot; &gt;&amp;5
-echo &quot;${ECHO_T}$ac_cv_lib_curses_initscr&quot; &gt;&amp;6
+{ echo &quot;$as_me:$LINENO: result: $ac_cv_lib_curses_initscr&quot; &gt;&amp;5
+echo &quot;${ECHO_T}$ac_cv_lib_curses_initscr&quot; &gt;&amp;6; }
 if test $ac_cv_lib_curses_initscr = yes; then
-  :
+  AST_CURSES_FOUND=yes
+else
+  AST_CURSES_FOUND=no
 fi
 
 
-   if test &quot;${ac_cv_lib_curses_initscr}&quot; = &quot;yes&quot;; then
-      curses_LIB=&quot;-lcurses &quot;
+   if test &quot;${AST_CURSES_FOUND}&quot; = &quot;yes&quot;; then
+      CURSES_LIB=&quot;-lcurses &quot;
       CURSES_HEADER_FOUND=&quot;1&quot;
-      if test &quot;x${curses_DIR}&quot; != &quot;x&quot;; then
-         curses_LIB=&quot;${pbxlibdir} ${curses_LIB}&quot;
-	 curses_INCLUDE=&quot;-I${curses_DIR}/include&quot;
+      if test &quot;x${CURSES_DIR}&quot; != &quot;x&quot;; then
+         CURSES_LIB=&quot;${pbxlibdir} ${CURSES_LIB}&quot;
+	 CURSES_INCLUDE=&quot;-I${CURSES_DIR}/include&quot;
 	 if test &quot;xcurses.h&quot; != &quot;x&quot; ; then
-	    as_ac_Header=`echo &quot;ac_cv_header_${curses_DIR}/include/curses.h&quot; | $as_tr_sh`
-if eval &quot;test \&quot;\${$as_ac_Header+set}\&quot; = set&quot;; then
-  echo &quot;$as_me:$LINENO: checking for ${curses_DIR}/include/curses.h&quot; &gt;&amp;5
-echo $ECHO_N &quot;checking for ${curses_DIR}/include/curses.h... $ECHO_C&quot; &gt;&amp;6
-if eval &quot;test \&quot;\${$as_ac_Header+set}\&quot; = set&quot;; then
+	    as_ac_Header=`echo &quot;ac_cv_header_${CURSES_DIR}/include/curses.h&quot; | $as_tr_sh`
+if { as_var=$as_ac_Header; eval &quot;test \&quot;\${$as_var+set}\&quot; = set&quot;; }; then
+  { echo &quot;$as_me:$LINENO: checking for ${CURSES_DIR}/include/curses.h&quot; &gt;&amp;5
+echo $ECHO_N &quot;checking for ${CURSES_DIR}/include/curses.h... $ECHO_C&quot; &gt;&amp;6; }
+if { as_var=$as_ac_Header; eval &quot;test \&quot;\${$as_var+set}\&quot; = set&quot;; }; then
   echo $ECHO_N &quot;(cached) $ECHO_C&quot; &gt;&amp;6
 fi
-echo &quot;$as_me:$LINENO: result: `eval echo '${'$as_ac_Header'}'`&quot; &gt;&amp;5
-echo &quot;${ECHO_T}`eval echo '${'$as_ac_Header'}'`&quot; &gt;&amp;6
+ac_res=`eval echo '${'$as_ac_Header'}'`
+	       { echo &quot;$as_me:$LINENO: result: $ac_res&quot; &gt;&amp;5
+echo &quot;${ECHO_T}$ac_res&quot; &gt;&amp;6; }
 else
   # Is the header compilable?
-echo &quot;$as_me:$LINENO: checking ${curses_DIR}/include/curses.h usability&quot; &gt;&amp;5
-echo $ECHO_N &quot;checking ${curses_DIR}/include/curses.h usability... $ECHO_C&quot; &gt;&amp;6
+{ echo &quot;$as_me:$LINENO: checking ${CURSES_DIR}/include/curses.h usability&quot; &gt;&amp;5
+echo $ECHO_N &quot;checking ${CURSES_DIR}/include/curses.h usability... $ECHO_C&quot; &gt;&amp;6; }
 cat &gt;conftest.$ac_ext &lt;&lt;_ACEOF
 /* confdefs.h.  */
 _ACEOF
@@ -5460,7 +6175,7 @@
 cat &gt;&gt;conftest.$ac_ext &lt;&lt;_ACEOF
 /* end confdefs.h.  */
 $ac_includes_default
-#include &lt;${curses_DIR}/include/curses.h&gt;
+#include &lt;${CURSES_DIR}/include/curses.h&gt;
 _ACEOF
 rm -f conftest.$ac_objext
 if { (eval echo &quot;$as_me:$LINENO: \&quot;$ac_compile\&quot;&quot;) &gt;&amp;5
@@ -5489,22 +6204,23 @@
   echo &quot;$as_me: failed program was:&quot; &gt;&amp;5
 sed 's/^/| /' conftest.$ac_ext &gt;&amp;5
 
-ac_header_compiler=no
+	ac_header_compiler=no
 fi
+
 rm -f conftest.err conftest.$ac_objext conftest.$ac_ext
-echo &quot;$as_me:$LINENO: result: $ac_header_compiler&quot; &gt;&amp;5
-echo &quot;${ECHO_T}$ac_header_compiler&quot; &gt;&amp;6
+{ echo &quot;$as_me:$LINENO: result: $ac_header_compiler&quot; &gt;&amp;5
+echo &quot;${ECHO_T}$ac_header_compiler&quot; &gt;&amp;6; }
 
 # Is the header present?
-echo &quot;$as_me:$LINENO: checking ${curses_DIR}/include/curses.h presence&quot; &gt;&amp;5
-echo $ECHO_N &quot;checking ${curses_DIR}/include/curses.h presence... $ECHO_C&quot; &gt;&amp;6
+{ echo &quot;$as_me:$LINENO: checking ${CURSES_DIR}/include/curses.h presence&quot; &gt;&amp;5
+echo $ECHO_N &quot;checking ${CURSES_DIR}/include/curses.h presence... $ECHO_C&quot; &gt;&amp;6; }
 cat &gt;conftest.$ac_ext &lt;&lt;_ACEOF
 /* confdefs.h.  */
 _ACEOF
 cat confdefs.h &gt;&gt;conftest.$ac_ext
 cat &gt;&gt;conftest.$ac_ext &lt;&lt;_ACEOF
 /* end confdefs.h.  */
-#include &lt;${curses_DIR}/include/curses.h&gt;
+#include &lt;${CURSES_DIR}/include/curses.h&gt;
 _ACEOF
 if { (eval echo &quot;$as_me:$LINENO: \&quot;$ac_cpp conftest.$ac_ext\&quot;&quot;) &gt;&amp;5
   (eval $ac_cpp conftest.$ac_ext) 2&gt;conftest.er1
@@ -5531,51 +6247,46 @@
 
   ac_header_preproc=no
 fi
+
 rm -f conftest.err conftest.$ac_ext
-echo &quot;$as_me:$LINENO: result: $ac_header_preproc&quot; &gt;&amp;5
-echo &quot;${ECHO_T}$ac_header_preproc&quot; &gt;&amp;6
+{ echo &quot;$as_me:$LINENO: result: $ac_header_preproc&quot; &gt;&amp;5
+echo &quot;${ECHO_T}$ac_header_preproc&quot; &gt;&amp;6; }
 
 # So?  What about this header?
 case $ac_header_compiler:$ac_header_preproc:$ac_c_preproc_warn_flag in
   yes:no: )
-    { echo &quot;$as_me:$LINENO: WARNING: ${curses_DIR}/include/curses.h: accepted by the compiler, rejected by the preprocessor!&quot; &gt;&amp;5
-echo &quot;$as_me: WARNING: ${curses_DIR}/include/curses.h: accepted by the compiler, rejected by the preprocessor!&quot; &gt;&amp;2;}
-    { echo &quot;$as_me:$LINENO: WARNING: ${curses_DIR}/include/curses.h: proceeding with the compiler's result&quot; &gt;&amp;5
-echo &quot;$as_me: WARNING: ${curses_DIR}/include/curses.h: proceeding with the compiler's result&quot; &gt;&amp;2;}
+    { echo &quot;$as_me:$LINENO: WARNING: ${CURSES_DIR}/include/curses.h: accepted by the compiler, rejected by the preprocessor!&quot; &gt;&amp;5
+echo &quot;$as_me: WARNING: ${CURSES_DIR}/include/curses.h: accepted by the compiler, rejected by the preprocessor!&quot; &gt;&amp;2;}
+    { echo &quot;$as_me:$LINENO: WARNING: ${CURSES_DIR}/include/curses.h: proceeding with the compiler's result&quot; &gt;&amp;5
+echo &quot;$as_me: WARNING: ${CURSES_DIR}/include/curses.h: proceeding with the compiler's result&quot; &gt;&amp;2;}
     ac_header_preproc=yes
     ;;
   no:yes:* )
-    { echo &quot;$as_me:$LINENO: WARNING: ${curses_DIR}/include/curses.h: present but cannot be compiled&quot; &gt;&amp;5
-echo &quot;$as_me: WARNING: ${curses_DIR}/include/curses.h: present but cannot be compiled&quot; &gt;&amp;2;}
-    { echo &quot;$as_me:$LINENO: WARNING: ${curses_DIR}/include/curses.h:     check for missing prerequisite headers?&quot; &gt;&amp;5
-echo &quot;$as_me: WARNING: ${curses_DIR}/include/curses.h:     check for missing prerequisite headers?&quot; &gt;&amp;2;}
-    { echo &quot;$as_me:$LINENO: WARNING: ${curses_DIR}/include/curses.h: see the Autoconf documentation&quot; &gt;&amp;5
-echo &quot;$as_me: WARNING: ${curses_DIR}/include/curses.h: see the Autoconf documentation&quot; &gt;&amp;2;}
-    { echo &quot;$as_me:$LINENO: WARNING: ${curses_DIR}/include/curses.h:     section \&quot;Present But Cannot Be Compiled\&quot;&quot; &gt;&amp;5
-echo &quot;$as_me: WARNING: ${curses_DIR}/include/curses.h:     section \&quot;Present But Cannot Be Compiled\&quot;&quot; &gt;&amp;2;}
-    { echo &quot;$as_me:$LINENO: WARNING: ${curses_DIR}/include/curses.h: proceeding with the preprocessor's result&quot; &gt;&amp;5
-echo &quot;$as_me: WARNING: ${curses_DIR}/include/curses.h: proceeding with the preprocessor's result&quot; &gt;&amp;2;}
-    { echo &quot;$as_me:$LINENO: WARNING: ${curses_DIR}/include/curses.h: in the future, the compiler will take precedence&quot; &gt;&amp;5
-echo &quot;$as_me: WARNING: ${curses_DIR}/include/curses.h: in the future, the compiler will take precedence&quot; &gt;&amp;2;}
-    (
-      cat &lt;&lt;\_ASBOX
-## ------------------------------------------ ##
-## Report this to the AC_PACKAGE_NAME lists.  ##
-## ------------------------------------------ ##
-_ASBOX
-    ) |
-      sed &quot;s/^/$as_me: WARNING:     /&quot; &gt;&amp;2
+    { echo &quot;$as_me:$LINENO: WARNING: ${CURSES_DIR}/include/curses.h: present but cannot be compiled&quot; &gt;&amp;5
+echo &quot;$as_me: WARNING: ${CURSES_DIR}/include/curses.h: present but cannot be compiled&quot; &gt;&amp;2;}
+    { echo &quot;$as_me:$LINENO: WARNING: ${CURSES_DIR}/include/curses.h:     check for missing prerequisite headers?&quot; &gt;&amp;5
+echo &quot;$as_me: WARNING: ${CURSES_DIR}/include/curses.h:     check for missing prerequisite headers?&quot; &gt;&amp;2;}
+    { echo &quot;$as_me:$LINENO: WARNING: ${CURSES_DIR}/include/curses.h: see the Autoconf documentation&quot; &gt;&amp;5
+echo &quot;$as_me: WARNING: ${CURSES_DIR}/include/curses.h: see the Autoconf documentation&quot; &gt;&amp;2;}
+    { echo &quot;$as_me:$LINENO: WARNING: ${CURSES_DIR}/include/curses.h:     section \&quot;Present But Cannot Be Compiled\&quot;&quot; &gt;&amp;5
+echo &quot;$as_me: WARNING: ${CURSES_DIR}/include/curses.h:     section \&quot;Present But Cannot Be Compiled\&quot;&quot; &gt;&amp;2;}
+    { echo &quot;$as_me:$LINENO: WARNING: ${CURSES_DIR}/include/curses.h: proceeding with the preprocessor's result&quot; &gt;&amp;5
+echo &quot;$as_me: WARNING: ${CURSES_DIR}/include/curses.h: proceeding with the preprocessor's result&quot; &gt;&amp;2;}
+    { echo &quot;$as_me:$LINENO: WARNING: ${CURSES_DIR}/include/curses.h: in the future, the compiler will take precedence&quot; &gt;&amp;5
+echo &quot;$as_me: WARNING: ${CURSES_DIR}/include/curses.h: in the future, the compiler will take precedence&quot; &gt;&amp;2;}
+
     ;;
 esac
-echo &quot;$as_me:$LINENO: checking for ${curses_DIR}/include/curses.h&quot; &gt;&amp;5
-echo $ECHO_N &quot;checking for ${curses_DIR}/include/curses.h... $ECHO_C&quot; &gt;&amp;6
-if eval &quot;test \&quot;\${$as_ac_Header+set}\&quot; = set&quot;; then
+{ echo &quot;$as_me:$LINENO: checking for ${CURSES_DIR}/include/curses.h&quot; &gt;&amp;5
+echo $ECHO_N &quot;checking for ${CURSES_DIR}/include/curses.h... $ECHO_C&quot; &gt;&amp;6; }
+if { as_var=$as_ac_Header; eval &quot;test \&quot;\${$as_var+set}\&quot; = set&quot;; }; then
   echo $ECHO_N &quot;(cached) $ECHO_C&quot; &gt;&amp;6
 else
   eval &quot;$as_ac_Header=\$ac_header_preproc&quot;
 fi
-echo &quot;$as_me:$LINENO: result: `eval echo '${'$as_ac_Header'}'`&quot; &gt;&amp;5
-echo &quot;${ECHO_T}`eval echo '${'$as_ac_Header'}'`&quot; &gt;&amp;6
+ac_res=`eval echo '${'$as_ac_Header'}'`
+	       { echo &quot;$as_me:$LINENO: result: $ac_res&quot; &gt;&amp;5
+echo &quot;${ECHO_T}$ac_res&quot; &gt;&amp;6; }
 
 fi
 if test `eval echo '${'$as_ac_Header'}'` = yes; then
@@ -5589,17 +6300,17 @@
       else
 	 if test &quot;xcurses.h&quot; != &quot;x&quot; ; then
             if test &quot;${ac_cv_header_curses_h+set}&quot; = set; then
-  echo &quot;$as_me:$LINENO: checking for curses.h&quot; &gt;&amp;5
-echo $ECHO_N &quot;checking for curses.h... $ECHO_C&quot; &gt;&amp;6
+  { echo &quot;$as_me:$LINENO: checking for curses.h&quot; &gt;&amp;5
+echo $ECHO_N &quot;checking for curses.h... $ECHO_C&quot; &gt;&amp;6; }
 if test &quot;${ac_cv_header_curses_h+set}&quot; = set; then
   echo $ECHO_N &quot;(cached) $ECHO_C&quot; &gt;&amp;6
 fi
-echo &quot;$as_me:$LINENO: result: $ac_cv_header_curses_h&quot; &gt;&amp;5
-echo &quot;${ECHO_T}$ac_cv_header_curses_h&quot; &gt;&amp;6
+{ echo &quot;$as_me:$LINENO: result: $ac_cv_header_curses_h&quot; &gt;&amp;5
+echo &quot;${ECHO_T}$ac_cv_header_curses_h&quot; &gt;&amp;6; }
 else
   # Is the header compilable?
-echo &quot;$as_me:$LINENO: checking curses.h usability&quot; &gt;&amp;5
-echo $ECHO_N &quot;checking curses.h usability... $ECHO_C&quot; &gt;&amp;6
+{ echo &quot;$as_me:$LINENO: checking curses.h usability&quot; &gt;&amp;5
+echo $ECHO_N &quot;checking curses.h usability... $ECHO_C&quot; &gt;&amp;6; }
 cat &gt;conftest.$ac_ext &lt;&lt;_ACEOF
 /* confdefs.h.  */
 _ACEOF
@@ -5636,15 +6347,16 @@
   echo &quot;$as_me: failed program was:&quot; &gt;&amp;5
 sed 's/^/| /' conftest.$ac_ext &gt;&amp;5
 
-ac_header_compiler=no
+	ac_header_compiler=no
 fi
+
 rm -f conftest.err conftest.$ac_objext conftest.$ac_ext
-echo &quot;$as_me:$LINENO: result: $ac_header_compiler&quot; &gt;&amp;5
-echo &quot;${ECHO_T}$ac_header_compiler&quot; &gt;&amp;6
+{ echo &quot;$as_me:$LINENO: result: $ac_header_compiler&quot; &gt;&amp;5
+echo &quot;${ECHO_T}$ac_header_compiler&quot; &gt;&amp;6; }
 
 # Is the header present?
-echo &quot;$as_me:$LINENO: checking curses.h presence&quot; &gt;&amp;5
-echo $ECHO_N &quot;checking curses.h presence... $ECHO_C&quot; &gt;&amp;6
+{ echo &quot;$as_me:$LINENO: checking curses.h presence&quot; &gt;&amp;5
+echo $ECHO_N &quot;checking curses.h presence... $ECHO_C&quot; &gt;&amp;6; }
 cat &gt;conftest.$ac_ext &lt;&lt;_ACEOF
 /* confdefs.h.  */
 _ACEOF
@@ -5678,9 +6390,10 @@
 
   ac_header_preproc=no
 fi
+
 rm -f conftest.err conftest.$ac_ext
-echo &quot;$as_me:$LINENO: result: $ac_header_preproc&quot; &gt;&amp;5
-echo &quot;${ECHO_T}$ac_header_preproc&quot; &gt;&amp;6
+{ echo &quot;$as_me:$LINENO: result: $ac_header_preproc&quot; &gt;&amp;5
+echo &quot;${ECHO_T}$ac_header_preproc&quot; &gt;&amp;6; }
 
 # So?  What about this header?
 case $ac_header_compiler:$ac_header_preproc:$ac_c_preproc_warn_flag in
@@ -5704,25 +6417,18 @@
 echo &quot;$as_me: WARNING: curses.h: proceeding with the preprocessor's result&quot; &gt;&amp;2;}
     { echo &quot;$as_me:$LINENO: WARNING: curses.h: in the future, the compiler will take precedence&quot; &gt;&amp;5
 echo &quot;$as_me: WARNING: curses.h: in the future, the compiler will take precedence&quot; &gt;&amp;2;}
-    (
-      cat &lt;&lt;\_ASBOX
-## ------------------------------------------ ##
-## Report this to the AC_PACKAGE_NAME lists.  ##
-## ------------------------------------------ ##
-_ASBOX
-    ) |
-      sed &quot;s/^/$as_me: WARNING:     /&quot; &gt;&amp;2
+
     ;;
 esac
-echo &quot;$as_me:$LINENO: checking for curses.h&quot; &gt;&amp;5
-echo $ECHO_N &quot;checking for curses.h... $ECHO_C&quot; &gt;&amp;6
+{ echo &quot;$as_me:$LINENO: checking for curses.h&quot; &gt;&amp;5
+echo $ECHO_N &quot;checking for curses.h... $ECHO_C&quot; &gt;&amp;6; }
 if test &quot;${ac_cv_header_curses_h+set}&quot; = set; then
   echo $ECHO_N &quot;(cached) $ECHO_C&quot; &gt;&amp;6
 else
   ac_cv_header_curses_h=$ac_header_preproc
 fi
-echo &quot;$as_me:$LINENO: result: $ac_cv_header_curses_h&quot; &gt;&amp;5
-echo &quot;${ECHO_T}$ac_cv_header_curses_h&quot; &gt;&amp;6
+{ echo &quot;$as_me:$LINENO: result: $ac_cv_header_curses_h&quot; &gt;&amp;5
+echo &quot;${ECHO_T}$ac_cv_header_curses_h&quot; &gt;&amp;6; }
 
 fi
 if test $ac_cv_header_curses_h = yes; then
@@ -5735,7 +6441,7 @@
 	 fi
       fi
       if test &quot;x${CURSES_HEADER_FOUND}&quot; = &quot;x0&quot; ; then
-         if test ! -z &quot;${curses_MANDATORY}&quot; ;
+         if test ! -z &quot;${CURSES_MANDATORY}&quot; ;
          then
             echo &quot; ***&quot;
             echo &quot; *** It appears that you do not have the curses development package installed.&quot;
@@ -5743,18 +6449,18 @@
             echo &quot; *** without explicitly specifying --with-curses&quot;
             exit 1
          fi
-         curses_LIB=&quot;&quot;
-         curses_INCLUDE=&quot;&quot;
-         PBX_LIBcurses=0
+         CURSES_LIB=&quot;&quot;
+         CURSES_INCLUDE=&quot;&quot;
+         PBX_LIBCURSES=0
       else
-         PBX_LIBcurses=1
+         PBX_LIBCURSES=1
 
 cat &gt;&gt;confdefs.h &lt;&lt;_ACEOF
 #define HAVE_CURSES 1
 _ACEOF
 
       fi
-   elif test ! -z &quot;${curses_MANDATORY}&quot;;
+   elif test ! -z &quot;${CURSES_MANDATORY}&quot;;
    then
       echo &quot;***&quot;
       echo &quot;*** The curses installation on this system appears to be broken.&quot;
@@ -5769,34 +6475,457 @@
 
 
 
-# Check whether --with-nbs or --without-nbs was given.
+# Check whether --with-iksemel was given.
+if test &quot;${with_iksemel+set}&quot; = set; then
+  withval=$with_iksemel;
+case ${withval} in
+     n|no)
+     USE_IKSEMEL=no
+     ;;
+     y|ye|yes)
+     IKSEMEL_MANDATORY=&quot;yes&quot;
+     ;;
+     *)
+     IKSEMEL_DIR=&quot;${withval}&quot;
+     IKSEMEL_MANDATORY=&quot;yes&quot;
+     ;;
+esac
+
+fi
+
+
+PBX_LIBIKSEMEL=0
+
+if test &quot;${USE_IKSEMEL}&quot; != &quot;no&quot;; then
+   pbxlibdir=&quot;&quot;
+   if test &quot;x${IKSEMEL_DIR}&quot; != &quot;x&quot;; then
+      pbxlibdir=&quot;-L${iksemel_DIR}/lib&quot;
+   fi
+   { echo &quot;$as_me:$LINENO: checking for iks_start_sasl in -liksemel&quot; &gt;&amp;5
+echo $ECHO_N &quot;checking for iks_start_sasl in -liksemel... $ECHO_C&quot; &gt;&amp;6; }
+if test &quot;${ac_cv_lib_iksemel_iks_start_sasl+set}&quot; = set; then
+  echo $ECHO_N &quot;(cached) $ECHO_C&quot; &gt;&amp;6
+else
+  ac_check_lib_save_LIBS=$LIBS
+LIBS=&quot;-liksemel ${pbxlibdir}  $LIBS&quot;
+cat &gt;conftest.$ac_ext &lt;&lt;_ACEOF
+/* confdefs.h.  */
+_ACEOF
+cat confdefs.h &gt;&gt;conftest.$ac_ext
+cat &gt;&gt;conftest.$ac_ext &lt;&lt;_ACEOF
+/* end confdefs.h.  */
+
+/* Override any GCC internal prototype to avoid an error.
+   Use char because int might match the return type of a GCC
+   builtin and then its argument prototype would still apply.  */
+#ifdef __cplusplus
+extern &quot;C&quot;
+#endif
+char iks_start_sasl ();
+int
+main ()
+{
+return iks_start_sasl ();
+  ;
+  return 0;
+}
+_ACEOF
+rm -f conftest.$ac_objext conftest$ac_exeext
+if { (eval echo &quot;$as_me:$LINENO: \&quot;$ac_link\&quot;&quot;) &gt;&amp;5
+  (eval $ac_link) 2&gt;conftest.er1
+  ac_status=$?
+  grep -v '^ *+' conftest.er1 &gt;conftest.err
+  rm -f conftest.er1
+  cat conftest.err &gt;&amp;5
+  echo &quot;$as_me:$LINENO: \$? = $ac_status&quot; &gt;&amp;5
+  (exit $ac_status); } &amp;&amp;
+	 { ac_try='test -z &quot;$ac_c_werror_flag&quot;			 || test ! -s conftest.err'
+  { (eval echo &quot;$as_me:$LINENO: \&quot;$ac_try\&quot;&quot;) &gt;&amp;5
+  (eval $ac_try) 2&gt;&amp;5
+  ac_status=$?
+  echo &quot;$as_me:$LINENO: \$? = $ac_status&quot; &gt;&amp;5
+  (exit $ac_status); }; } &amp;&amp;
+	 { ac_try='test -s conftest$ac_exeext'
+  { (eval echo &quot;$as_me:$LINENO: \&quot;$ac_try\&quot;&quot;) &gt;&amp;5
+  (eval $ac_try) 2&gt;&amp;5
+  ac_status=$?
+  echo &quot;$as_me:$LINENO: \$? = $ac_status&quot; &gt;&amp;5
+  (exit $ac_status); }; }; then
+  ac_cv_lib_iksemel_iks_start_sasl=yes
+else
+  echo &quot;$as_me: failed program was:&quot; &gt;&amp;5
+sed 's/^/| /' conftest.$ac_ext &gt;&amp;5
+
+	ac_cv_lib_iksemel_iks_start_sasl=no
+fi
+
+rm -f conftest.err conftest.$ac_objext \
+      conftest$ac_exeext conftest.$ac_ext
+LIBS=$ac_check_lib_save_LIBS
+fi
+{ echo &quot;$as_me:$LINENO: result: $ac_cv_lib_iksemel_iks_start_sasl&quot; &gt;&amp;5
+echo &quot;${ECHO_T}$ac_cv_lib_iksemel_iks_start_sasl&quot; &gt;&amp;6; }
+if test $ac_cv_lib_iksemel_iks_start_sasl = yes; then
+  AST_IKSEMEL_FOUND=yes
+else
+  AST_IKSEMEL_FOUND=no
+fi
+
+
+   if test &quot;${AST_IKSEMEL_FOUND}&quot; = &quot;yes&quot;; then
+      IKSEMEL_LIB=&quot;-liksemel &quot;
+      IKSEMEL_HEADER_FOUND=&quot;1&quot;
+      if test &quot;x${IKSEMEL_DIR}&quot; != &quot;x&quot;; then
+         IKSEMEL_LIB=&quot;${pbxlibdir} ${IKSEMEL_LIB}&quot;
+	 IKSEMEL_INCLUDE=&quot;-I${IKSEMEL_DIR}/include&quot;
+	 if test &quot;xiksemel.h&quot; != &quot;x&quot; ; then
+	    as_ac_Header=`echo &quot;ac_cv_header_${IKSEMEL_DIR}/include/iksemel.h&quot; | $as_tr_sh`
+if { as_var=$as_ac_Header; eval &quot;test \&quot;\${$as_var+set}\&quot; = set&quot;; }; then
+  { echo &quot;$as_me:$LINENO: checking for ${IKSEMEL_DIR}/include/iksemel.h&quot; &gt;&amp;5
+echo $ECHO_N &quot;checking for ${IKSEMEL_DIR}/include/iksemel.h... $ECHO_C&quot; &gt;&amp;6; }
+if { as_var=$as_ac_Header; eval &quot;test \&quot;\${$as_var+set}\&quot; = set&quot;; }; then
+  echo $ECHO_N &quot;(cached) $ECHO_C&quot; &gt;&amp;6
+fi
+ac_res=`eval echo '${'$as_ac_Header'}'`
+	       { echo &quot;$as_me:$LINENO: result: $ac_res&quot; &gt;&amp;5
+echo &quot;${ECHO_T}$ac_res&quot; &gt;&amp;6; }
+else
+  # Is the header compilable?
+{ echo &quot;$as_me:$LINENO: checking ${IKSEMEL_DIR}/include/iksemel.h usability&quot; &gt;&amp;5
+echo $ECHO_N &quot;checking ${IKSEMEL_DIR}/include/iksemel.h usability... $ECHO_C&quot; &gt;&amp;6; }
+cat &gt;conftest.$ac_ext &lt;&lt;_ACEOF
+/* confdefs.h.  */
+_ACEOF
+cat confdefs.h &gt;&gt;conftest.$ac_ext
+cat &gt;&gt;conftest.$ac_ext &lt;&lt;_ACEOF
+/* end confdefs.h.  */
+$ac_includes_default
+#include &lt;${IKSEMEL_DIR}/include/iksemel.h&gt;
+_ACEOF
+rm -f conftest.$ac_objext
+if { (eval echo &quot;$as_me:$LINENO: \&quot;$ac_compile\&quot;&quot;) &gt;&amp;5
+  (eval $ac_compile) 2&gt;conftest.er1
+  ac_status=$?
+  grep -v '^ *+' conftest.er1 &gt;conftest.err
+  rm -f conftest.er1
+  cat conftest.err &gt;&amp;5
+  echo &quot;$as_me:$LINENO: \$? = $ac_status&quot; &gt;&amp;5
+  (exit $ac_status); } &amp;&amp;
+	 { ac_try='test -z &quot;$ac_c_werror_flag&quot;			 || test ! -s conftest.err'
+  { (eval echo &quot;$as_me:$LINENO: \&quot;$ac_try\&quot;&quot;) &gt;&amp;5
+  (eval $ac_try) 2&gt;&amp;5
+  ac_status=$?
+  echo &quot;$as_me:$LINENO: \$? = $ac_status&quot; &gt;&amp;5
+  (exit $ac_status); }; } &amp;&amp;
+	 { ac_try='test -s conftest.$ac_objext'
+  { (eval echo &quot;$as_me:$LINENO: \&quot;$ac_try\&quot;&quot;) &gt;&amp;5
+  (eval $ac_try) 2&gt;&amp;5
+  ac_status=$?
+  echo &quot;$as_me:$LINENO: \$? = $ac_status&quot; &gt;&amp;5
+  (exit $ac_status); }; }; then
+  ac_header_compiler=yes
+else
+  echo &quot;$as_me: failed program was:&quot; &gt;&amp;5
+sed 's/^/| /' conftest.$ac_ext &gt;&amp;5
+
+	ac_header_compiler=no
+fi
+
+rm -f conftest.err conftest.$ac_objext conftest.$ac_ext
+{ echo &quot;$as_me:$LINENO: result: $ac_header_compiler&quot; &gt;&amp;5
+echo &quot;${ECHO_T}$ac_header_compiler&quot; &gt;&amp;6; }
+
+# Is the header present?
+{ echo &quot;$as_me:$LINENO: checking ${IKSEMEL_DIR}/include/iksemel.h presence&quot; &gt;&amp;5
+echo $ECHO_N &quot;checking ${IKSEMEL_DIR}/include/iksemel.h presence... $ECHO_C&quot; &gt;&amp;6; }
+cat &gt;conftest.$ac_ext &lt;&lt;_ACEOF
+/* confdefs.h.  */
+_ACEOF
+cat confdefs.h &gt;&gt;conftest.$ac_ext
+cat &gt;&gt;conftest.$ac_ext &lt;&lt;_ACEOF
+/* end confdefs.h.  */
+#include &lt;${IKSEMEL_DIR}/include/iksemel.h&gt;
+_ACEOF
+if { (eval echo &quot;$as_me:$LINENO: \&quot;$ac_cpp conftest.$ac_ext\&quot;&quot;) &gt;&amp;5
+  (eval $ac_cpp conftest.$ac_ext) 2&gt;conftest.er1
+  ac_status=$?
+  grep -v '^ *+' conftest.er1 &gt;conftest.err
+  rm -f conftest.er1
+  cat conftest.err &gt;&amp;5
+  echo &quot;$as_me:$LINENO: \$? = $ac_status&quot; &gt;&amp;5
+  (exit $ac_status); } &gt;/dev/null; then
+  if test -s conftest.err; then
+    ac_cpp_err=$ac_c_preproc_warn_flag
+    ac_cpp_err=$ac_cpp_err$ac_c_werror_flag
+  else
+    ac_cpp_err=
+  fi
+else
+  ac_cpp_err=yes
+fi
+if test -z &quot;$ac_cpp_err&quot;; then
+  ac_header_preproc=yes
+else
+  echo &quot;$as_me: failed program was:&quot; &gt;&amp;5
+sed 's/^/| /' conftest.$ac_ext &gt;&amp;5
+
+  ac_header_preproc=no
+fi
+
+rm -f conftest.err conftest.$ac_ext
+{ echo &quot;$as_me:$LINENO: result: $ac_header_preproc&quot; &gt;&amp;5
+echo &quot;${ECHO_T}$ac_header_preproc&quot; &gt;&amp;6; }
+
+# So?  What about this header?
+case $ac_header_compiler:$ac_header_preproc:$ac_c_preproc_warn_flag in
+  yes:no: )
+    { echo &quot;$as_me:$LINENO: WARNING: ${IKSEMEL_DIR}/include/iksemel.h: accepted by the compiler, rejected by the preprocessor!&quot; &gt;&amp;5
+echo &quot;$as_me: WARNING: ${IKSEMEL_DIR}/include/iksemel.h: accepted by the compiler, rejected by the preprocessor!&quot; &gt;&amp;2;}
+    { echo &quot;$as_me:$LINENO: WARNING: ${IKSEMEL_DIR}/include/iksemel.h: proceeding with the compiler's result&quot; &gt;&amp;5
+echo &quot;$as_me: WARNING: ${IKSEMEL_DIR}/include/iksemel.h: proceeding with the compiler's result&quot; &gt;&amp;2;}
+    ac_header_preproc=yes
+    ;;
+  no:yes:* )
+    { echo &quot;$as_me:$LINENO: WARNING: ${IKSEMEL_DIR}/include/iksemel.h: present but cannot be compiled&quot; &gt;&amp;5
+echo &quot;$as_me: WARNING: ${IKSEMEL_DIR}/include/iksemel.h: present but cannot be compiled&quot; &gt;&amp;2;}
+    { echo &quot;$as_me:$LINENO: WARNING: ${IKSEMEL_DIR}/include/iksemel.h:     check for missing prerequisite headers?&quot; &gt;&amp;5
+echo &quot;$as_me: WARNING: ${IKSEMEL_DIR}/include/iksemel.h:     check for missing prerequisite headers?&quot; &gt;&amp;2;}
+    { echo &quot;$as_me:$LINENO: WARNING: ${IKSEMEL_DIR}/include/iksemel.h: see the Autoconf documentation&quot; &gt;&amp;5
+echo &quot;$as_me: WARNING: ${IKSEMEL_DIR}/include/iksemel.h: see the Autoconf documentation&quot; &gt;&amp;2;}
+    { echo &quot;$as_me:$LINENO: WARNING: ${IKSEMEL_DIR}/include/iksemel.h:     section \&quot;Present But Cannot Be Compiled\&quot;&quot; &gt;&amp;5
+echo &quot;$as_me: WARNING: ${IKSEMEL_DIR}/include/iksemel.h:     section \&quot;Present But Cannot Be Compiled\&quot;&quot; &gt;&amp;2;}
+    { echo &quot;$as_me:$LINENO: WARNING: ${IKSEMEL_DIR}/include/iksemel.h: proceeding with the preprocessor's result&quot; &gt;&amp;5
+echo &quot;$as_me: WARNING: ${IKSEMEL_DIR}/include/iksemel.h: proceeding with the preprocessor's result&quot; &gt;&amp;2;}
+    { echo &quot;$as_me:$LINENO: WARNING: ${IKSEMEL_DIR}/include/iksemel.h: in the future, the compiler will take precedence&quot; &gt;&amp;5
+echo &quot;$as_me: WARNING: ${IKSEMEL_DIR}/include/iksemel.h: in the future, the compiler will take precedence&quot; &gt;&amp;2;}
+
+    ;;
+esac
+{ echo &quot;$as_me:$LINENO: checking for ${IKSEMEL_DIR}/include/iksemel.h&quot; &gt;&amp;5
+echo $ECHO_N &quot;checking for ${IKSEMEL_DIR}/include/iksemel.h... $ECHO_C&quot; &gt;&amp;6; }
+if { as_var=$as_ac_Header; eval &quot;test \&quot;\${$as_var+set}\&quot; = set&quot;; }; then
+  echo $ECHO_N &quot;(cached) $ECHO_C&quot; &gt;&amp;6
+else
+  eval &quot;$as_ac_Header=\$ac_header_preproc&quot;
+fi
+ac_res=`eval echo '${'$as_ac_Header'}'`
+	       { echo &quot;$as_me:$LINENO: result: $ac_res&quot; &gt;&amp;5
+echo &quot;${ECHO_T}$ac_res&quot; &gt;&amp;6; }
+
+fi
+if test `eval echo '${'$as_ac_Header'}'` = yes; then
+  IKSEMEL_HEADER_FOUND=1
+else
+  IKSEMEL_HEADER_FOUND=0
+fi
+
+
+	 fi
+      else
+	 if test &quot;xiksemel.h&quot; != &quot;x&quot; ; then
+            if test &quot;${ac_cv_header_iksemel_h+set}&quot; = set; then
+  { echo &quot;$as_me:$LINENO: checking for iksemel.h&quot; &gt;&amp;5
+echo $ECHO_N &quot;checking for iksemel.h... $ECHO_C&quot; &gt;&amp;6; }
+if test &quot;${ac_cv_header_iksemel_h+set}&quot; = set; then
+  echo $ECHO_N &quot;(cached) $ECHO_C&quot; &gt;&amp;6
+fi
+{ echo &quot;$as_me:$LINENO: result: $ac_cv_header_iksemel_h&quot; &gt;&amp;5
+echo &quot;${ECHO_T}$ac_cv_header_iksemel_h&quot; &gt;&amp;6; }
+else
+  # Is the header compilable?
+{ echo &quot;$as_me:$LINENO: checking iksemel.h usability&quot; &gt;&amp;5
+echo $ECHO_N &quot;checking iksemel.h usability... $ECHO_C&quot; &gt;&amp;6; }
+cat &gt;conftest.$ac_ext &lt;&lt;_ACEOF
+/* confdefs.h.  */
+_ACEOF
+cat confdefs.h &gt;&gt;conftest.$ac_ext
+cat &gt;&gt;conftest.$ac_ext &lt;&lt;_ACEOF
+/* end confdefs.h.  */
+$ac_includes_default
+#include &lt;iksemel.h&gt;
+_ACEOF
+rm -f conftest.$ac_objext
+if { (eval echo &quot;$as_me:$LINENO: \&quot;$ac_compile\&quot;&quot;) &gt;&amp;5
+  (eval $ac_compile) 2&gt;conftest.er1
+  ac_status=$?
+  grep -v '^ *+' conftest.er1 &gt;conftest.err
+  rm -f conftest.er1
+  cat conftest.err &gt;&amp;5
+  echo &quot;$as_me:$LINENO: \$? = $ac_status&quot; &gt;&amp;5
+  (exit $ac_status); } &amp;&amp;
+	 { ac_try='test -z &quot;$ac_c_werror_flag&quot;			 || test ! -s conftest.err'
+  { (eval echo &quot;$as_me:$LINENO: \&quot;$ac_try\&quot;&quot;) &gt;&amp;5
+  (eval $ac_try) 2&gt;&amp;5
+  ac_status=$?
+  echo &quot;$as_me:$LINENO: \$? = $ac_status&quot; &gt;&amp;5
+  (exit $ac_status); }; } &amp;&amp;
+	 { ac_try='test -s conftest.$ac_objext'
+  { (eval echo &quot;$as_me:$LINENO: \&quot;$ac_try\&quot;&quot;) &gt;&amp;5
+  (eval $ac_try) 2&gt;&amp;5
+  ac_status=$?
+  echo &quot;$as_me:$LINENO: \$? = $ac_status&quot; &gt;&amp;5
+  (exit $ac_status); }; }; then
+  ac_header_compiler=yes
+else
+  echo &quot;$as_me: failed program was:&quot; &gt;&amp;5
+sed 's/^/| /' conftest.$ac_ext &gt;&amp;5
+
+	ac_header_compiler=no
+fi
+
+rm -f conftest.err conftest.$ac_objext conftest.$ac_ext
+{ echo &quot;$as_me:$LINENO: result: $ac_header_compiler&quot; &gt;&amp;5
+echo &quot;${ECHO_T}$ac_header_compiler&quot; &gt;&amp;6; }
+
+# Is the header present?
+{ echo &quot;$as_me:$LINENO: checking iksemel.h presence&quot; &gt;&amp;5
+echo $ECHO_N &quot;checking iksemel.h presence... $ECHO_C&quot; &gt;&amp;6; }
+cat &gt;conftest.$ac_ext &lt;&lt;_ACEOF
+/* confdefs.h.  */
+_ACEOF
+cat confdefs.h &gt;&gt;conftest.$ac_ext
+cat &gt;&gt;conftest.$ac_ext &lt;&lt;_ACEOF
+/* end confdefs.h.  */
+#include &lt;iksemel.h&gt;
+_ACEOF
+if { (eval echo &quot;$as_me:$LINENO: \&quot;$ac_cpp conftest.$ac_ext\&quot;&quot;) &gt;&amp;5
+  (eval $ac_cpp conftest.$ac_ext) 2&gt;conftest.er1
+  ac_status=$?
+  grep -v '^ *+' conftest.er1 &gt;conftest.err
+  rm -f conftest.er1
+  cat conftest.err &gt;&amp;5
+  echo &quot;$as_me:$LINENO: \$? = $ac_status&quot; &gt;&amp;5
+  (exit $ac_status); } &gt;/dev/null; then
+  if test -s conftest.err; then
+    ac_cpp_err=$ac_c_preproc_warn_flag
+    ac_cpp_err=$ac_cpp_err$ac_c_werror_flag
+  else
+    ac_cpp_err=
+  fi
+else
+  ac_cpp_err=yes
+fi
+if test -z &quot;$ac_cpp_err&quot;; then
+  ac_header_preproc=yes
+else
+  echo &quot;$as_me: failed program was:&quot; &gt;&amp;5
+sed 's/^/| /' conftest.$ac_ext &gt;&amp;5
+
+  ac_header_preproc=no
+fi
+
+rm -f conftest.err conftest.$ac_ext
+{ echo &quot;$as_me:$LINENO: result: $ac_header_preproc&quot; &gt;&amp;5
+echo &quot;${ECHO_T}$ac_header_preproc&quot; &gt;&amp;6; }
+
+# So?  What about this header?
+case $ac_header_compiler:$ac_header_preproc:$ac_c_preproc_warn_flag in
+  yes:no: )
+    { echo &quot;$as_me:$LINENO: WARNING: iksemel.h: accepted by the compiler, rejected by the preprocessor!&quot; &gt;&amp;5
+echo &quot;$as_me: WARNING: iksemel.h: accepted by the compiler, rejected by the preprocessor!&quot; &gt;&amp;2;}
+    { echo &quot;$as_me:$LINENO: WARNING: iksemel.h: proceeding with the compiler's result&quot; &gt;&amp;5
+echo &quot;$as_me: WARNING: iksemel.h: proceeding with the compiler's result&quot; &gt;&amp;2;}
+    ac_header_preproc=yes
+    ;;
+  no:yes:* )
+    { echo &quot;$as_me:$LINENO: WARNING: iksemel.h: present but cannot be compiled&quot; &gt;&amp;5
+echo &quot;$as_me: WARNING: iksemel.h: present but cannot be compiled&quot; &gt;&amp;2;}
+    { echo &quot;$as_me:$LINENO: WARNING: iksemel.h:     check for missing prerequisite headers?&quot; &gt;&amp;5
+echo &quot;$as_me: WARNING: iksemel.h:     check for missing prerequisite headers?&quot; &gt;&amp;2;}
+    { echo &quot;$as_me:$LINENO: WARNING: iksemel.h: see the Autoconf documentation&quot; &gt;&amp;5
+echo &quot;$as_me: WARNING: iksemel.h: see the Autoconf documentation&quot; &gt;&amp;2;}
+    { echo &quot;$as_me:$LINENO: WARNING: iksemel.h:     section \&quot;Present But Cannot Be Compiled\&quot;&quot; &gt;&amp;5
+echo &quot;$as_me: WARNING: iksemel.h:     section \&quot;Present But Cannot Be Compiled\&quot;&quot; &gt;&amp;2;}
+    { echo &quot;$as_me:$LINENO: WARNING: iksemel.h: proceeding with the preprocessor's result&quot; &gt;&amp;5
+echo &quot;$as_me: WARNING: iksemel.h: proceeding with the preprocessor's result&quot; &gt;&amp;2;}
+    { echo &quot;$as_me:$LINENO: WARNING: iksemel.h: in the future, the compiler will take precedence&quot; &gt;&amp;5
+echo &quot;$as_me: WARNING: iksemel.h: in the future, the compiler will take precedence&quot; &gt;&amp;2;}
+
+    ;;
+esac
+{ echo &quot;$as_me:$LINENO: checking for iksemel.h&quot; &gt;&amp;5
+echo $ECHO_N &quot;checking for iksemel.h... $ECHO_C&quot; &gt;&amp;6; }
+if test &quot;${ac_cv_header_iksemel_h+set}&quot; = set; then
+  echo $ECHO_N &quot;(cached) $ECHO_C&quot; &gt;&amp;6
+else
+  ac_cv_header_iksemel_h=$ac_header_preproc
+fi
+{ echo &quot;$as_me:$LINENO: result: $ac_cv_header_iksemel_h&quot; &gt;&amp;5
+echo &quot;${ECHO_T}$ac_cv_header_iksemel_h&quot; &gt;&amp;6; }
+
+fi
+if test $ac_cv_header_iksemel_h = yes; then
+  IKSEMEL_HEADER_FOUND=1
+else
+  IKSEMEL_HEADER_FOUND=0
+fi
+
+
+	 fi
+      fi
+      if test &quot;x${IKSEMEL_HEADER_FOUND}&quot; = &quot;x0&quot; ; then
+         if test ! -z &quot;${IKSEMEL_MANDATORY}&quot; ;
+         then
+            echo &quot; ***&quot;
+            echo &quot; *** It appears that you do not have the iksemel development package installed.&quot;
+            echo &quot; *** Please install it to include Iksemel Jabber Library support, or re-run configure&quot;
+            echo &quot; *** without explicitly specifying --with-iksemel&quot;
+            exit 1
+         fi
+         IKSEMEL_LIB=&quot;&quot;
+         IKSEMEL_INCLUDE=&quot;&quot;
+         PBX_LIBIKSEMEL=0
+      else
+         PBX_LIBIKSEMEL=1
+
+cat &gt;&gt;confdefs.h &lt;&lt;_ACEOF
+#define HAVE_IKSEMEL 1
+_ACEOF
+
+      fi
+   elif test ! -z &quot;${IKSEMEL_MANDATORY}&quot;;
+   then
+      echo &quot;***&quot;
+      echo &quot;*** The Iksemel Jabber Library installation on this system appears to be broken.&quot;
+      echo &quot;*** Either correct the installation, or run configure&quot;
+      echo &quot;*** without explicity specifying --with-iksemel&quot;
+      exit 1
+   fi
+fi
+
+
+
+
+
+
+# Check whether --with-nbs was given.
 if test &quot;${with_nbs+set}&quot; = set; then
-  withval=&quot;$with_nbs&quot;
-
+  withval=$with_nbs;
 case ${withval} in
      n|no)
-     USE_nbs=no
+     USE_NBS=no
      ;;
      y|ye|yes)
-     nbs_MANDATORY=&quot;yes&quot;
+     NBS_MANDATORY=&quot;yes&quot;
      ;;
      *)
-     nbs_DIR=&quot;${withval}&quot;
-     nbs_MANDATORY=&quot;yes&quot;
+     NBS_DIR=&quot;${withval}&quot;
+     NBS_MANDATORY=&quot;yes&quot;
      ;;
 esac
 
-fi;
+fi
 
-PBX_LIBnbs=0
 
-if test &quot;${USE_nbs}&quot; != &quot;no&quot;; then
+PBX_LIBNBS=0
+
+if test &quot;${USE_NBS}&quot; != &quot;no&quot;; then
    pbxlibdir=&quot;&quot;
-   if test &quot;x${nbs_DIR}&quot; != &quot;x&quot;; then
+   if test &quot;x${NBS_DIR}&quot; != &quot;x&quot;; then
       pbxlibdir=&quot;-L${nbs_DIR}/lib&quot;
    fi
-   echo &quot;$as_me:$LINENO: checking for nbs_connect in -lnbs&quot; &gt;&amp;5
-echo $ECHO_N &quot;checking for nbs_connect in -lnbs... $ECHO_C&quot; &gt;&amp;6
+   { echo &quot;$as_me:$LINENO: checking for nbs_connect in -lnbs&quot; &gt;&amp;5
+echo $ECHO_N &quot;checking for nbs_connect in -lnbs... $ECHO_C&quot; &gt;&amp;6; }
 if test &quot;${ac_cv_lib_nbs_nbs_connect+set}&quot; = set; then
   echo $ECHO_N &quot;(cached) $ECHO_C&quot; &gt;&amp;6
 else
@@ -5809,17 +6938,17 @@
 cat &gt;&gt;conftest.$ac_ext &lt;&lt;_ACEOF
 /* end confdefs.h.  */
 
-/* Override any gcc2 internal prototype to avoid an error.  */
+/* Override any GCC internal prototype to avoid an error.
+   Use char because int might match the return type of a GCC
+   builtin and then its argument prototype would still apply.  */
 #ifdef __cplusplus
 extern &quot;C&quot;
 #endif
-/* We use char because int might match the return type of a gcc2
-   builtin and then its argument prototype would still apply.  */
 char nbs_connect ();
 int
 main ()
 {
-nbs_connect ();
+return nbs_connect ();
   ;
   return 0;
 }
@@ -5851,39 +6980,43 @@
   echo &quot;$as_me: failed program was:&quot; &gt;&amp;5
 sed 's/^/| /' conftest.$ac_ext &gt;&amp;5
 
-ac_cv_lib_nbs_nbs_connect=no
+	ac_cv_lib_nbs_nbs_connect=no
 fi
+
 rm -f conftest.err conftest.$ac_objext \
       conftest$ac_exeext conftest.$ac_ext
 LIBS=$ac_check_lib_save_LIBS
 fi
-echo &quot;$as_me:$LINENO: result: $ac_cv_lib_nbs_nbs_connect&quot; &gt;&amp;5
-echo &quot;${ECHO_T}$ac_cv_lib_nbs_nbs_connect&quot; &gt;&amp;6
+{ echo &quot;$as_me:$LINENO: result: $ac_cv_lib_nbs_nbs_connect&quot; &gt;&amp;5
+echo &quot;${ECHO_T}$ac_cv_lib_nbs_nbs_connect&quot; &gt;&amp;6; }
 if test $ac_cv_lib_nbs_nbs_connect = yes; then
-  :
+  AST_NBS_FOUND=yes
+else
+  AST_NBS_FOUND=no
 fi
 
 
-   if test &quot;${ac_cv_lib_nbs_nbs_connect}&quot; = &quot;yes&quot;; then
-      nbs_LIB=&quot;-lnbs &quot;
+   if test &quot;${AST_NBS_FOUND}&quot; = &quot;yes&quot;; then
+      NBS_LIB=&quot;-lnbs &quot;
       NBS_HEADER_FOUND=&quot;1&quot;
-      if test &quot;x${nbs_DIR}&quot; != &quot;x&quot;; then
-         nbs_LIB=&quot;${pbxlibdir} ${nbs_LIB}&quot;
-	 nbs_INCLUDE=&quot;-I${nbs_DIR}/include&quot;
+      if test &quot;x${NBS_DIR}&quot; != &quot;x&quot;; then
+         NBS_LIB=&quot;${pbxlibdir} ${NBS_LIB}&quot;
+	 NBS_INCLUDE=&quot;-I${NBS_DIR}/include&quot;
 	 if test &quot;xnbs.h&quot; != &quot;x&quot; ; then
-	    as_ac_Header=`echo &quot;ac_cv_header_${nbs_DIR}/include/nbs.h&quot; | $as_tr_sh`
-if eval &quot;test \&quot;\${$as_ac_Header+set}\&quot; = set&quot;; then
-  echo &quot;$as_me:$LINENO: checking for ${nbs_DIR}/include/nbs.h&quot; &gt;&amp;5
-echo $ECHO_N &quot;checking for ${nbs_DIR}/include/nbs.h... $ECHO_C&quot; &gt;&amp;6
-if eval &quot;test \&quot;\${$as_ac_Header+set}\&quot; = set&quot;; then
+	    as_ac_Header=`echo &quot;ac_cv_header_${NBS_DIR}/include/nbs.h&quot; | $as_tr_sh`
+if { as_var=$as_ac_Header; eval &quot;test \&quot;\${$as_var+set}\&quot; = set&quot;; }; then
+  { echo &quot;$as_me:$LINENO: checking for ${NBS_DIR}/include/nbs.h&quot; &gt;&amp;5
+echo $ECHO_N &quot;checking for ${NBS_DIR}/include/nbs.h... $ECHO_C&quot; &gt;&amp;6; }
+if { as_var=$as_ac_Header; eval &quot;test \&quot;\${$as_var+set}\&quot; = set&quot;; }; then
   echo $ECHO_N &quot;(cached) $ECHO_C&quot; &gt;&amp;6
 fi
-echo &quot;$as_me:$LINENO: result: `eval echo '${'$as_ac_Header'}'`&quot; &gt;&amp;5
-echo &quot;${ECHO_T}`eval echo '${'$as_ac_Header'}'`&quot; &gt;&amp;6
+ac_res=`eval echo '${'$as_ac_Header'}'`
+	       { echo &quot;$as_me:$LINENO: result: $ac_res&quot; &gt;&amp;5
+echo &quot;${ECHO_T}$ac_res&quot; &gt;&amp;6; }
 else
   # Is the header compilable?
-echo &quot;$as_me:$LINENO: checking ${nbs_DIR}/include/nbs.h usability&quot; &gt;&amp;5
-echo $ECHO_N &quot;checking ${nbs_DIR}/include/nbs.h usability... $ECHO_C&quot; &gt;&amp;6
+{ echo &quot;$as_me:$LINENO: checking ${NBS_DIR}/include/nbs.h usability&quot; &gt;&amp;5
+echo $ECHO_N &quot;checking ${NBS_DIR}/include/nbs.h usability... $ECHO_C&quot; &gt;&amp;6; }
 cat &gt;conftest.$ac_ext &lt;&lt;_ACEOF
 /* confdefs.h.  */
 _ACEOF
@@ -5891,7 +7024,7 @@
 cat &gt;&gt;conftest.$ac_ext &lt;&lt;_ACEOF
 /* end confdefs.h.  */
 $ac_includes_default
-#include &lt;${nbs_DIR}/include/nbs.h&gt;
+#include &lt;${NBS_DIR}/include/nbs.h&gt;
 _ACEOF
 rm -f conftest.$ac_objext
 if { (eval echo &quot;$as_me:$LINENO: \&quot;$ac_compile\&quot;&quot;) &gt;&amp;5
@@ -5920,22 +7053,23 @@
   echo &quot;$as_me: failed program was:&quot; &gt;&amp;5
 sed 's/^/| /' conftest.$ac_ext &gt;&amp;5
 
-ac_header_compiler=no
+	ac_header_compiler=no
 fi
+
 rm -f conftest.err conftest.$ac_objext conftest.$ac_ext
-echo &quot;$as_me:$LINENO: result: $ac_header_compiler&quot; &gt;&amp;5
-echo &quot;${ECHO_T}$ac_header_compiler&quot; &gt;&amp;6
+{ echo &quot;$as_me:$LINENO: result: $ac_header_compiler&quot; &gt;&amp;5
+echo &quot;${ECHO_T}$ac_header_compiler&quot; &gt;&amp;6; }
 
 # Is the header present?
-echo &quot;$as_me:$LINENO: checking ${nbs_DIR}/include/nbs.h presence&quot; &gt;&amp;5
-echo $ECHO_N &quot;checking ${nbs_DIR}/include/nbs.h presence... $ECHO_C&quot; &gt;&amp;6
+{ echo &quot;$as_me:$LINENO: checking ${NBS_DIR}/include/nbs.h presence&quot; &gt;&amp;5
+echo $ECHO_N &quot;checking ${NBS_DIR}/include/nbs.h presence... $ECHO_C&quot; &gt;&amp;6; }
 cat &gt;conftest.$ac_ext &lt;&lt;_ACEOF
 /* confdefs.h.  */
 _ACEOF
 cat confdefs.h &gt;&gt;conftest.$ac_ext
 cat &gt;&gt;conftest.$ac_ext &lt;&lt;_ACEOF
 /* end confdefs.h.  */
-#include &lt;${nbs_DIR}/include/nbs.h&gt;
+#include &lt;${NBS_DIR}/include/nbs.h&gt;
 _ACEOF
 if { (eval echo &quot;$as_me:$LINENO: \&quot;$ac_cpp conftest.$ac_ext\&quot;&quot;) &gt;&amp;5
   (eval $ac_cpp conftest.$ac_ext) 2&gt;conftest.er1
@@ -5962,51 +7096,46 @@
 
   ac_header_preproc=no
 fi
+
 rm -f conftest.err conftest.$ac_ext
-echo &quot;$as_me:$LINENO: result: $ac_header_preproc&quot; &gt;&amp;5
-echo &quot;${ECHO_T}$ac_header_preproc&quot; &gt;&amp;6
+{ echo &quot;$as_me:$LINENO: result: $ac_header_preproc&quot; &gt;&amp;5
+echo &quot;${ECHO_T}$ac_header_preproc&quot; &gt;&amp;6; }
 
 # So?  What about this header?
 case $ac_header_compiler:$ac_header_preproc:$ac_c_preproc_warn_flag in
   yes:no: )
-    { echo &quot;$as_me:$LINENO: WARNING: ${nbs_DIR}/include/nbs.h: accepted by the compiler, rejected by the preprocessor!&quot; &gt;&amp;5
-echo &quot;$as_me: WARNING: ${nbs_DIR}/include/nbs.h: accepted by the compiler, rejected by the preprocessor!&quot; &gt;&amp;2;}
-    { echo &quot;$as_me:$LINENO: WARNING: ${nbs_DIR}/include/nbs.h: proceeding with the compiler's result&quot; &gt;&amp;5
-echo &quot;$as_me: WARNING: ${nbs_DIR}/include/nbs.h: proceeding with the compiler's result&quot; &gt;&amp;2;}
+    { echo &quot;$as_me:$LINENO: WARNING: ${NBS_DIR}/include/nbs.h: accepted by the compiler, rejected by the preprocessor!&quot; &gt;&amp;5
+echo &quot;$as_me: WARNING: ${NBS_DIR}/include/nbs.h: accepted by the compiler, rejected by the preprocessor!&quot; &gt;&amp;2;}
+    { echo &quot;$as_me:$LINENO: WARNING: ${NBS_DIR}/include/nbs.h: proceeding with the compiler's result&quot; &gt;&amp;5
+echo &quot;$as_me: WARNING: ${NBS_DIR}/include/nbs.h: proceeding with the compiler's result&quot; &gt;&amp;2;}
     ac_header_preproc=yes
     ;;
   no:yes:* )
-    { echo &quot;$as_me:$LINENO: WARNING: ${nbs_DIR}/include/nbs.h: present but cannot be compiled&quot; &gt;&amp;5
-echo &quot;$as_me: WARNING: ${nbs_DIR}/include/nbs.h: present but cannot be compiled&quot; &gt;&amp;2;}
-    { echo &quot;$as_me:$LINENO: WARNING: ${nbs_DIR}/include/nbs.h:     check for missing prerequisite headers?&quot; &gt;&amp;5
-echo &quot;$as_me: WARNING: ${nbs_DIR}/include/nbs.h:     check for missing prerequisite headers?&quot; &gt;&amp;2;}
-    { echo &quot;$as_me:$LINENO: WARNING: ${nbs_DIR}/include/nbs.h: see the Autoconf documentation&quot; &gt;&amp;5
-echo &quot;$as_me: WARNING: ${nbs_DIR}/include/nbs.h: see the Autoconf documentation&quot; &gt;&amp;2;}
-    { echo &quot;$as_me:$LINENO: WARNING: ${nbs_DIR}/include/nbs.h:     section \&quot;Present But Cannot Be Compiled\&quot;&quot; &gt;&amp;5
-echo &quot;$as_me: WARNING: ${nbs_DIR}/include/nbs.h:     section \&quot;Present But Cannot Be Compiled\&quot;&quot; &gt;&amp;2;}
-    { echo &quot;$as_me:$LINENO: WARNING: ${nbs_DIR}/include/nbs.h: proceeding with the preprocessor's result&quot; &gt;&amp;5
-echo &quot;$as_me: WARNING: ${nbs_DIR}/include/nbs.h: proceeding with the preprocessor's result&quot; &gt;&amp;2;}
-    { echo &quot;$as_me:$LINENO: WARNING: ${nbs_DIR}/include/nbs.h: in the future, the compiler will take precedence&quot; &gt;&amp;5
-echo &quot;$as_me: WARNING: ${nbs_DIR}/include/nbs.h: in the future, the compiler will take precedence&quot; &gt;&amp;2;}
-    (
-      cat &lt;&lt;\_ASBOX
-## ------------------------------------------ ##
-## Report this to the AC_PACKAGE_NAME lists.  ##
-## ------------------------------------------ ##
-_ASBOX
-    ) |
-      sed &quot;s/^/$as_me: WARNING:     /&quot; &gt;&amp;2
+    { echo &quot;$as_me:$LINENO: WARNING: ${NBS_DIR}/include/nbs.h: present but cannot be compiled&quot; &gt;&amp;5
+echo &quot;$as_me: WARNING: ${NBS_DIR}/include/nbs.h: present but cannot be compiled&quot; &gt;&amp;2;}
+    { echo &quot;$as_me:$LINENO: WARNING: ${NBS_DIR}/include/nbs.h:     check for missing prerequisite headers?&quot; &gt;&amp;5
+echo &quot;$as_me: WARNING: ${NBS_DIR}/include/nbs.h:     check for missing prerequisite headers?&quot; &gt;&amp;2;}
+    { echo &quot;$as_me:$LINENO: WARNING: ${NBS_DIR}/include/nbs.h: see the Autoconf documentation&quot; &gt;&amp;5
+echo &quot;$as_me: WARNING: ${NBS_DIR}/include/nbs.h: see the Autoconf documentation&quot; &gt;&amp;2;}
+    { echo &quot;$as_me:$LINENO: WARNING: ${NBS_DIR}/include/nbs.h:     section \&quot;Present But Cannot Be Compiled\&quot;&quot; &gt;&amp;5
+echo &quot;$as_me: WARNING: ${NBS_DIR}/include/nbs.h:     section \&quot;Present But Cannot Be Compiled\&quot;&quot; &gt;&amp;2;}
+    { echo &quot;$as_me:$LINENO: WARNING: ${NBS_DIR}/include/nbs.h: proceeding with the preprocessor's result&quot; &gt;&amp;5
+echo &quot;$as_me: WARNING: ${NBS_DIR}/include/nbs.h: proceeding with the preprocessor's result&quot; &gt;&amp;2;}
+    { echo &quot;$as_me:$LINENO: WARNING: ${NBS_DIR}/include/nbs.h: in the future, the compiler will take precedence&quot; &gt;&amp;5
+echo &quot;$as_me: WARNING: ${NBS_DIR}/include/nbs.h: in the future, the compiler will take precedence&quot; &gt;&amp;2;}
+
     ;;
 esac
-echo &quot;$as_me:$LINENO: checking for ${nbs_DIR}/include/nbs.h&quot; &gt;&amp;5
-echo $ECHO_N &quot;checking for ${nbs_DIR}/include/nbs.h... $ECHO_C&quot; &gt;&amp;6
-if eval &quot;test \&quot;\${$as_ac_Header+set}\&quot; = set&quot;; then
+{ echo &quot;$as_me:$LINENO: checking for ${NBS_DIR}/include/nbs.h&quot; &gt;&amp;5
+echo $ECHO_N &quot;checking for ${NBS_DIR}/include/nbs.h... $ECHO_C&quot; &gt;&amp;6; }
+if { as_var=$as_ac_Header; eval &quot;test \&quot;\${$as_var+set}\&quot; = set&quot;; }; then
   echo $ECHO_N &quot;(cached) $ECHO_C&quot; &gt;&amp;6
 else
   eval &quot;$as_ac_Header=\$ac_header_preproc&quot;
 fi
-echo &quot;$as_me:$LINENO: result: `eval echo '${'$as_ac_Header'}'`&quot; &gt;&amp;5
-echo &quot;${ECHO_T}`eval echo '${'$as_ac_Header'}'`&quot; &gt;&amp;6
+ac_res=`eval echo '${'$as_ac_Header'}'`
+	       { echo &quot;$as_me:$LINENO: result: $ac_res&quot; &gt;&amp;5
+echo &quot;${ECHO_T}$ac_res&quot; &gt;&amp;6; }
 
 fi
 if test `eval echo '${'$as_ac_Header'}'` = yes; then
@@ -6020,17 +7149,17 @@
       else
 	 if test &quot;xnbs.h&quot; != &quot;x&quot; ; then
             if test &quot;${ac_cv_header_nbs_h+set}&quot; = set; then
-  echo &quot;$as_me:$LINENO: checking for nbs.h&quot; &gt;&amp;5
-echo $ECHO_N &quot;checking for nbs.h... $ECHO_C&quot; &gt;&amp;6
+  { echo &quot;$as_me:$LINENO: checking for nbs.h&quot; &gt;&amp;5
+echo $ECHO_N &quot;checking for nbs.h... $ECHO_C&quot; &gt;&amp;6; }
 if test &quot;${ac_cv_header_nbs_h+set}&quot; = set; then
   echo $ECHO_N &quot;(cached) $ECHO_C&quot; &gt;&amp;6
 fi
-echo &quot;$as_me:$LINENO: result: $ac_cv_header_nbs_h&quot; &gt;&amp;5
-echo &quot;${ECHO_T}$ac_cv_header_nbs_h&quot; &gt;&amp;6
+{ echo &quot;$as_me:$LINENO: result: $ac_cv_header_nbs_h&quot; &gt;&amp;5
+echo &quot;${ECHO_T}$ac_cv_header_nbs_h&quot; &gt;&amp;6; }
 else
   # Is the header compilable?
-echo &quot;$as_me:$LINENO: checking nbs.h usability&quot; &gt;&amp;5
-echo $ECHO_N &quot;checking nbs.h usability... $ECHO_C&quot; &gt;&amp;6
+{ echo &quot;$as_me:$LINENO: checking nbs.h usability&quot; &gt;&amp;5
+echo $ECHO_N &quot;checking nbs.h usability... $ECHO_C&quot; &gt;&amp;6; }
 cat &gt;conftest.$ac_ext &lt;&lt;_ACEOF
 /* confdefs.h.  */
 _ACEOF
@@ -6067,15 +7196,16 @@
   echo &quot;$as_me: failed program was:&quot; &gt;&amp;5
 sed 's/^/| /' conftest.$ac_ext &gt;&amp;5
 
-ac_header_compiler=no
+	ac_header_compiler=no
 fi
+
 rm -f conftest.err conftest.$ac_objext conftest.$ac_ext
-echo &quot;$as_me:$LINENO: result: $ac_header_compiler&quot; &gt;&amp;5
-echo &quot;${ECHO_T}$ac_header_compiler&quot; &gt;&amp;6
+{ echo &quot;$as_me:$LINENO: result: $ac_header_compiler&quot; &gt;&amp;5
+echo &quot;${ECHO_T}$ac_header_compiler&quot; &gt;&amp;6; }
 
 # Is the header present?
-echo &quot;$as_me:$LINENO: checking nbs.h presence&quot; &gt;&amp;5
-echo $ECHO_N &quot;checking nbs.h presence... $ECHO_C&quot; &gt;&amp;6
+{ echo &quot;$as_me:$LINENO: checking nbs.h presence&quot; &gt;&amp;5
+echo $ECHO_N &quot;checking nbs.h presence... $ECHO_C&quot; &gt;&amp;6; }
 cat &gt;conftest.$ac_ext &lt;&lt;_ACEOF
 /* confdefs.h.  */
 _ACEOF
@@ -6109,9 +7239,10 @@
 
   ac_header_preproc=no
 fi
+
 rm -f conftest.err conftest.$ac_ext
-echo &quot;$as_me:$LINENO: result: $ac_header_preproc&quot; &gt;&amp;5
-echo &quot;${ECHO_T}$ac_header_preproc&quot; &gt;&amp;6
+{ echo &quot;$as_me:$LINENO: result: $ac_header_preproc&quot; &gt;&amp;5
+echo &quot;${ECHO_T}$ac_header_preproc&quot; &gt;&amp;6; }
 
 # So?  What about this header?
 case $ac_header_compiler:$ac_header_preproc:$ac_c_preproc_warn_flag in
@@ -6135,25 +7266,18 @@
 echo &quot;$as_me: WARNING: nbs.h: proceeding with the preprocessor's result&quot; &gt;&amp;2;}
     { echo &quot;$as_me:$LINENO: WARNING: nbs.h: in the future, the compiler will take precedence&quot; &gt;&amp;5
 echo &quot;$as_me: WARNING: nbs.h: in the future, the compiler will take precedence&quot; &gt;&amp;2;}
-    (
-      cat &lt;&lt;\_ASBOX
-## ------------------------------------------ ##
-## Report this to the AC_PACKAGE_NAME lists.  ##
-## ------------------------------------------ ##
-_ASBOX
-    ) |
-      sed &quot;s/^/$as_me: WARNING:     /&quot; &gt;&amp;2
+
     ;;
 esac
-echo &quot;$as_me:$LINENO: checking for nbs.h&quot; &gt;&amp;5
-echo $ECHO_N &quot;checking for nbs.h... $ECHO_C&quot; &gt;&amp;6
+{ echo &quot;$as_me:$LINENO: checking for nbs.h&quot; &gt;&amp;5
+echo $ECHO_N &quot;checking for nbs.h... $ECHO_C&quot; &gt;&amp;6; }
 if test &quot;${ac_cv_header_nbs_h+set}&quot; = set; then
   echo $ECHO_N &quot;(cached) $ECHO_C&quot; &gt;&amp;6
 else
   ac_cv_header_nbs_h=$ac_header_preproc
 fi
-echo &quot;$as_me:$LINENO: result: $ac_cv_header_nbs_h&quot; &gt;&amp;5
-echo &quot;${ECHO_T}$ac_cv_header_nbs_h&quot; &gt;&amp;6
+{ echo &quot;$as_me:$LINENO: result: $ac_cv_header_nbs_h&quot; &gt;&amp;5
+echo &quot;${ECHO_T}$ac_cv_header_nbs_h&quot; &gt;&amp;6; }
 
 fi
 if test $ac_cv_header_nbs_h = yes; then
@@ -6166,7 +7290,7 @@
 	 fi
       fi
       if test &quot;x${NBS_HEADER_FOUND}&quot; = &quot;x0&quot; ; then
-         if test ! -z &quot;${nbs_MANDATORY}&quot; ;
+         if test ! -z &quot;${NBS_MANDATORY}&quot; ;
          then
             echo &quot; ***&quot;
             echo &quot; *** It appears that you do not have the nbs development package installed.&quot;
@@ -6174,18 +7298,18 @@
             echo &quot; *** without explicitly specifying --with-nbs&quot;
             exit 1
          fi
-         nbs_LIB=&quot;&quot;
-         nbs_INCLUDE=&quot;&quot;
-         PBX_LIBnbs=0
+         NBS_LIB=&quot;&quot;
+         NBS_INCLUDE=&quot;&quot;
+         PBX_LIBNBS=0
       else
-         PBX_LIBnbs=1
+         PBX_LIBNBS=1
 
 cat &gt;&gt;confdefs.h &lt;&lt;_ACEOF
 #define HAVE_NBS 1
 _ACEOF
 
       fi
-   elif test ! -z &quot;${nbs_MANDATORY}&quot;;
+   elif test ! -z &quot;${NBS_MANDATORY}&quot;;
    then
       echo &quot;***&quot;
       echo &quot;*** The Network Broadcast Sound installation on this system appears to be broken.&quot;
@@ -6200,34 +7324,34 @@
 
 
 
-# Check whether --with-ncurses or --without-ncurses was given.
+# Check whether --with-ncurses was given.
 if test &quot;${with_ncurses+set}&quot; = set; then
-  withval=&quot;$with_ncurses&quot;
-
+  withval=$with_ncurses;
 case ${withval} in
      n|no)
-     USE_ncurses=no
+     USE_NCURSES=no
      ;;
      y|ye|yes)
-     ncurses_MANDATORY=&quot;yes&quot;
+     NCURSES_MANDATORY=&quot;yes&quot;
      ;;
      *)
-     ncurses_DIR=&quot;${withval}&quot;
-     ncurses_MANDATORY=&quot;yes&quot;
+     NCURSES_DIR=&quot;${withval}&quot;
+     NCURSES_MANDATORY=&quot;yes&quot;
      ;;
 esac
 
-fi;
+fi
 
-PBX_LIBncurses=0
 
-if test &quot;${USE_ncurses}&quot; != &quot;no&quot;; then
+PBX_LIBNCURSES=0
+
+if test &quot;${USE_NCURSES}&quot; != &quot;no&quot;; then
    pbxlibdir=&quot;&quot;
-   if test &quot;x${ncurses_DIR}&quot; != &quot;x&quot;; then
+   if test &quot;x${NCURSES_DIR}&quot; != &quot;x&quot;; then
       pbxlibdir=&quot;-L${ncurses_DIR}/lib&quot;
    fi
-   echo &quot;$as_me:$LINENO: checking for initscr in -lncurses&quot; &gt;&amp;5
-echo $ECHO_N &quot;checking for initscr in -lncurses... $ECHO_C&quot; &gt;&amp;6
+   { echo &quot;$as_me:$LINENO: checking for initscr in -lncurses&quot; &gt;&amp;5
+echo $ECHO_N &quot;checking for initscr in -lncurses... $ECHO_C&quot; &gt;&amp;6; }
 if test &quot;${ac_cv_lib_ncurses_initscr+set}&quot; = set; then
   echo $ECHO_N &quot;(cached) $ECHO_C&quot; &gt;&amp;6
 else
@@ -6240,17 +7364,17 @@
 cat &gt;&gt;conftest.$ac_ext &lt;&lt;_ACEOF
 /* end confdefs.h.  */
 
-/* Override any gcc2 internal prototype to avoid an error.  */
+/* Override any GCC internal prototype to avoid an error.
+   Use char because int might match the return type of a GCC
+   builtin and then its argument prototype would still apply.  */
 #ifdef __cplusplus
 extern &quot;C&quot;
 #endif
-/* We use char because int might match the return type of a gcc2
-   builtin and then its argument prototype would still apply.  */
 char initscr ();
 int
 main ()
 {
-initscr ();
+return initscr ();
   ;
   return 0;
 }
@@ -6282,39 +7406,43 @@
   echo &quot;$as_me: failed program was:&quot; &gt;&amp;5
 sed 's/^/| /' conftest.$ac_ext &gt;&amp;5
 
-ac_cv_lib_ncurses_initscr=no
+	ac_cv_lib_ncurses_initscr=no
 fi
+
 rm -f conftest.err conftest.$ac_objext \
       conftest$ac_exeext conftest.$ac_ext
 LIBS=$ac_check_lib_save_LIBS
 fi
-echo &quot;$as_me:$LINENO: result: $ac_cv_lib_ncurses_initscr&quot; &gt;&amp;5
-echo &quot;${ECHO_T}$ac_cv_lib_ncurses_initscr&quot; &gt;&amp;6
+{ echo &quot;$as_me:$LINENO: result: $ac_cv_lib_ncurses_initscr&quot; &gt;&amp;5
+echo &quot;${ECHO_T}$ac_cv_lib_ncurses_initscr&quot; &gt;&amp;6; }
 if test $ac_cv_lib_ncurses_initscr = yes; then
-  :
+  AST_NCURSES_FOUND=yes
+else
+  AST_NCURSES_FOUND=no
 fi
 
 
-   if test &quot;${ac_cv_lib_ncurses_initscr}&quot; = &quot;yes&quot;; then
-      ncurses_LIB=&quot;-lncurses &quot;
+   if test &quot;${AST_NCURSES_FOUND}&quot; = &quot;yes&quot;; then
+      NCURSES_LIB=&quot;-lncurses &quot;
       NCURSES_HEADER_FOUND=&quot;1&quot;
-      if test &quot;x${ncurses_DIR}&quot; != &quot;x&quot;; then
-         ncurses_LIB=&quot;${pbxlibdir} ${ncurses_LIB}&quot;
-	 ncurses_INCLUDE=&quot;-I${ncurses_DIR}/include&quot;
+      if test &quot;x${NCURSES_DIR}&quot; != &quot;x&quot;; then
+         NCURSES_LIB=&quot;${pbxlibdir} ${NCURSES_LIB}&quot;
+	 NCURSES_INCLUDE=&quot;-I${NCURSES_DIR}/include&quot;
 	 if test &quot;xcurses.h&quot; != &quot;x&quot; ; then
-	    as_ac_Header=`echo &quot;ac_cv_header_${ncurses_DIR}/include/curses.h&quot; | $as_tr_sh`
-if eval &quot;test \&quot;\${$as_ac_Header+set}\&quot; = set&quot;; then
-  echo &quot;$as_me:$LINENO: checking for ${ncurses_DIR}/include/curses.h&quot; &gt;&amp;5
-echo $ECHO_N &quot;checking for ${ncurses_DIR}/include/curses.h... $ECHO_C&quot; &gt;&amp;6
-if eval &quot;test \&quot;\${$as_ac_Header+set}\&quot; = set&quot;; then
+	    as_ac_Header=`echo &quot;ac_cv_header_${NCURSES_DIR}/include/curses.h&quot; | $as_tr_sh`
+if { as_var=$as_ac_Header; eval &quot;test \&quot;\${$as_var+set}\&quot; = set&quot;; }; then
+  { echo &quot;$as_me:$LINENO: checking for ${NCURSES_DIR}/include/curses.h&quot; &gt;&amp;5
+echo $ECHO_N &quot;checking for ${NCURSES_DIR}/include/curses.h... $ECHO_C&quot; &gt;&amp;6; }
+if { as_var=$as_ac_Header; eval &quot;test \&quot;\${$as_var+set}\&quot; = set&quot;; }; then
   echo $ECHO_N &quot;(cached) $ECHO_C&quot; &gt;&amp;6
 fi
-echo &quot;$as_me:$LINENO: result: `eval echo '${'$as_ac_Header'}'`&quot; &gt;&amp;5
-echo &quot;${ECHO_T}`eval echo '${'$as_ac_Header'}'`&quot; &gt;&amp;6
+ac_res=`eval echo '${'$as_ac_Header'}'`
+	       { echo &quot;$as_me:$LINENO: result: $ac_res&quot; &gt;&amp;5
+echo &quot;${ECHO_T}$ac_res&quot; &gt;&amp;6; }
 else
   # Is the header compilable?
-echo &quot;$as_me:$LINENO: checking ${ncurses_DIR}/include/curses.h usability&quot; &gt;&amp;5
-echo $ECHO_N &quot;checking ${ncurses_DIR}/include/curses.h usability... $ECHO_C&quot; &gt;&amp;6
+{ echo &quot;$as_me:$LINENO: checking ${NCURSES_DIR}/include/curses.h usability&quot; &gt;&amp;5
+echo $ECHO_N &quot;checking ${NCURSES_DIR}/include/curses.h usability... $ECHO_C&quot; &gt;&amp;6; }
 cat &gt;conftest.$ac_ext &lt;&lt;_ACEOF
 /* confdefs.h.  */
 _ACEOF
@@ -6322,7 +7450,7 @@
 cat &gt;&gt;conftest.$ac_ext &lt;&lt;_ACEOF
 /* end confdefs.h.  */
 $ac_includes_default
-#include &lt;${ncurses_DIR}/include/curses.h&gt;
+#include &lt;${NCURSES_DIR}/include/curses.h&gt;
 _ACEOF
 rm -f conftest.$ac_objext
 if { (eval echo &quot;$as_me:$LINENO: \&quot;$ac_compile\&quot;&quot;) &gt;&amp;5
@@ -6351,22 +7479,23 @@
   echo &quot;$as_me: failed program was:&quot; &gt;&amp;5
 sed 's/^/| /' conftest.$ac_ext &gt;&amp;5
 
-ac_header_compiler=no
+	ac_header_compiler=no
 fi
+
 rm -f conftest.err conftest.$ac_objext conftest.$ac_ext
-echo &quot;$as_me:$LINENO: result: $ac_header_compiler&quot; &gt;&amp;5
-echo &quot;${ECHO_T}$ac_header_compiler&quot; &gt;&amp;6
+{ echo &quot;$as_me:$LINENO: result: $ac_header_compiler&quot; &gt;&amp;5
+echo &quot;${ECHO_T}$ac_header_compiler&quot; &gt;&amp;6; }
 
 # Is the header present?
-echo &quot;$as_me:$LINENO: checking ${ncurses_DIR}/include/curses.h presence&quot; &gt;&amp;5
-echo $ECHO_N &quot;checking ${ncurses_DIR}/include/curses.h presence... $ECHO_C&quot; &gt;&amp;6
+{ echo &quot;$as_me:$LINENO: checking ${NCURSES_DIR}/include/curses.h presence&quot; &gt;&amp;5
+echo $ECHO_N &quot;checking ${NCURSES_DIR}/include/curses.h presence... $ECHO_C&quot; &gt;&amp;6; }
 cat &gt;conftest.$ac_ext &lt;&lt;_ACEOF
 /* confdefs.h.  */
 _ACEOF
 cat confdefs.h &gt;&gt;conftest.$ac_ext
 cat &gt;&gt;conftest.$ac_ext &lt;&lt;_ACEOF
 /* end confdefs.h.  */
-#include &lt;${ncurses_DIR}/include/curses.h&gt;
+#include &lt;${NCURSES_DIR}/include/curses.h&gt;
 _ACEOF
 if { (eval echo &quot;$as_me:$LINENO: \&quot;$ac_cpp conftest.$ac_ext\&quot;&quot;) &gt;&amp;5
   (eval $ac_cpp conftest.$ac_ext) 2&gt;conftest.er1
@@ -6393,51 +7522,46 @@
 
   ac_header_preproc=no
 fi
+
 rm -f conftest.err conftest.$ac_ext
-echo &quot;$as_me:$LINENO: result: $ac_header_preproc&quot; &gt;&amp;5
-echo &quot;${ECHO_T}$ac_header_preproc&quot; &gt;&amp;6
+{ echo &quot;$as_me:$LINENO: result: $ac_header_preproc&quot; &gt;&amp;5
+echo &quot;${ECHO_T}$ac_header_preproc&quot; &gt;&amp;6; }
 
 # So?  What about this header?
 case $ac_header_compiler:$ac_header_preproc:$ac_c_preproc_warn_flag in
   yes:no: )
-    { echo &quot;$as_me:$LINENO: WARNING: ${ncurses_DIR}/include/curses.h: accepted by the compiler, rejected by the preprocessor!&quot; &gt;&amp;5
-echo &quot;$as_me: WARNING: ${ncurses_DIR}/include/curses.h: accepted by the compiler, rejected by the preprocessor!&quot; &gt;&amp;2;}
-    { echo &quot;$as_me:$LINENO: WARNING: ${ncurses_DIR}/include/curses.h: proceeding with the compiler's result&quot; &gt;&amp;5
-echo &quot;$as_me: WARNING: ${ncurses_DIR}/include/curses.h: proceeding with the compiler's result&quot; &gt;&amp;2;}
+    { echo &quot;$as_me:$LINENO: WARNING: ${NCURSES_DIR}/include/curses.h: accepted by the compiler, rejected by the preprocessor!&quot; &gt;&amp;5
+echo &quot;$as_me: WARNING: ${NCURSES_DIR}/include/curses.h: accepted by the compiler, rejected by the preprocessor!&quot; &gt;&amp;2;}
+    { echo &quot;$as_me:$LINENO: WARNING: ${NCURSES_DIR}/include/curses.h: proceeding with the compiler's result&quot; &gt;&amp;5
+echo &quot;$as_me: WARNING: ${NCURSES_DIR}/include/curses.h: proceeding with the compiler's result&quot; &gt;&amp;2;}
     ac_header_preproc=yes
     ;;
   no:yes:* )
-    { echo &quot;$as_me:$LINENO: WARNING: ${ncurses_DIR}/include/curses.h: present but cannot be compiled&quot; &gt;&amp;5
-echo &quot;$as_me: WARNING: ${ncurses_DIR}/include/curses.h: present but cannot be compiled&quot; &gt;&amp;2;}
-    { echo &quot;$as_me:$LINENO: WARNING: ${ncurses_DIR}/include/curses.h:     check for missing prerequisite headers?&quot; &gt;&amp;5
-echo &quot;$as_me: WARNING: ${ncurses_DIR}/include/curses.h:     check for missing prerequisite headers?&quot; &gt;&amp;2;}
-    { echo &quot;$as_me:$LINENO: WARNING: ${ncurses_DIR}/include/curses.h: see the Autoconf documentation&quot; &gt;&amp;5
-echo &quot;$as_me: WARNING: ${ncurses_DIR}/include/curses.h: see the Autoconf documentation&quot; &gt;&amp;2;}
-    { echo &quot;$as_me:$LINENO: WARNING: ${ncurses_DIR}/include/curses.h:     section \&quot;Present But Cannot Be Compiled\&quot;&quot; &gt;&amp;5
-echo &quot;$as_me: WARNING: ${ncurses_DIR}/include/curses.h:     section \&quot;Present But Cannot Be Compiled\&quot;&quot; &gt;&amp;2;}
-    { echo &quot;$as_me:$LINENO: WARNING: ${ncurses_DIR}/include/curses.h: proceeding with the preprocessor's result&quot; &gt;&amp;5
-echo &quot;$as_me: WARNING: ${ncurses_DIR}/include/curses.h: proceeding with the preprocessor's result&quot; &gt;&amp;2;}
-    { echo &quot;$as_me:$LINENO: WARNING: ${ncurses_DIR}/include/curses.h: in the future, the compiler will take precedence&quot; &gt;&amp;5
-echo &quot;$as_me: WARNING: ${ncurses_DIR}/include/curses.h: in the future, the compiler will take precedence&quot; &gt;&amp;2;}
-    (
-      cat &lt;&lt;\_ASBOX
-## ------------------------------------------ ##
-## Report this to the AC_PACKAGE_NAME lists.  ##
-## ------------------------------------------ ##
-_ASBOX
-    ) |
-      sed &quot;s/^/$as_me: WARNING:     /&quot; &gt;&amp;2
+    { echo &quot;$as_me:$LINENO: WARNING: ${NCURSES_DIR}/include/curses.h: present but cannot be compiled&quot; &gt;&amp;5
+echo &quot;$as_me: WARNING: ${NCURSES_DIR}/include/curses.h: present but cannot be compiled&quot; &gt;&amp;2;}
+    { echo &quot;$as_me:$LINENO: WARNING: ${NCURSES_DIR}/include/curses.h:     check for missing prerequisite headers?&quot; &gt;&amp;5
+echo &quot;$as_me: WARNING: ${NCURSES_DIR}/include/curses.h:     check for missing prerequisite headers?&quot; &gt;&amp;2;}
+    { echo &quot;$as_me:$LINENO: WARNING: ${NCURSES_DIR}/include/curses.h: see the Autoconf documentation&quot; &gt;&amp;5
+echo &quot;$as_me: WARNING: ${NCURSES_DIR}/include/curses.h: see the Autoconf documentation&quot; &gt;&amp;2;}
+    { echo &quot;$as_me:$LINENO: WARNING: ${NCURSES_DIR}/include/curses.h:     section \&quot;Present But Cannot Be Compiled\&quot;&quot; &gt;&amp;5
+echo &quot;$as_me: WARNING: ${NCURSES_DIR}/include/curses.h:     section \&quot;Present But Cannot Be Compiled\&quot;&quot; &gt;&amp;2;}
+    { echo &quot;$as_me:$LINENO: WARNING: ${NCURSES_DIR}/include/curses.h: proceeding with the preprocessor's result&quot; &gt;&amp;5
+echo &quot;$as_me: WARNING: ${NCURSES_DIR}/include/curses.h: proceeding with the preprocessor's result&quot; &gt;&amp;2;}
+    { echo &quot;$as_me:$LINENO: WARNING: ${NCURSES_DIR}/include/curses.h: in the future, the compiler will take precedence&quot; &gt;&amp;5
+echo &quot;$as_me: WARNING: ${NCURSES_DIR}/include/curses.h: in the future, the compiler will take precedence&quot; &gt;&amp;2;}
+
     ;;
 esac
-echo &quot;$as_me:$LINENO: checking for ${ncurses_DIR}/include/curses.h&quot; &gt;&amp;5
-echo $ECHO_N &quot;checking for ${ncurses_DIR}/include/curses.h... $ECHO_C&quot; &gt;&amp;6
-if eval &quot;test \&quot;\${$as_ac_Header+set}\&quot; = set&quot;; then
+{ echo &quot;$as_me:$LINENO: checking for ${NCURSES_DIR}/include/curses.h&quot; &gt;&amp;5
+echo $ECHO_N &quot;checking for ${NCURSES_DIR}/include/curses.h... $ECHO_C&quot; &gt;&amp;6; }
+if { as_var=$as_ac_Header; eval &quot;test \&quot;\${$as_var+set}\&quot; = set&quot;; }; then
   echo $ECHO_N &quot;(cached) $ECHO_C&quot; &gt;&amp;6
 else
   eval &quot;$as_ac_Header=\$ac_header_preproc&quot;
 fi
-echo &quot;$as_me:$LINENO: result: `eval echo '${'$as_ac_Header'}'`&quot; &gt;&amp;5
-echo &quot;${ECHO_T}`eval echo '${'$as_ac_Header'}'`&quot; &gt;&amp;6
+ac_res=`eval echo '${'$as_ac_Header'}'`
+	       { echo &quot;$as_me:$LINENO: result: $ac_res&quot; &gt;&amp;5
+echo &quot;${ECHO_T}$ac_res&quot; &gt;&amp;6; }
 
 fi
 if test `eval echo '${'$as_ac_Header'}'` = yes; then
@@ -6451,17 +7575,17 @@
       else
 	 if test &quot;xcurses.h&quot; != &quot;x&quot; ; then
             if test &quot;${ac_cv_header_curses_h+set}&quot; = set; then
-  echo &quot;$as_me:$LINENO: checking for curses.h&quot; &gt;&amp;5
-echo $ECHO_N &quot;checking for curses.h... $ECHO_C&quot; &gt;&amp;6
+  { echo &quot;$as_me:$LINENO: checking for curses.h&quot; &gt;&amp;5
+echo $ECHO_N &quot;checking for curses.h... $ECHO_C&quot; &gt;&amp;6; }
 if test &quot;${ac_cv_header_curses_h+set}&quot; = set; then
   echo $ECHO_N &quot;(cached) $ECHO_C&quot; &gt;&amp;6
 fi
-echo &quot;$as_me:$LINENO: result: $ac_cv_header_curses_h&quot; &gt;&amp;5
-echo &quot;${ECHO_T}$ac_cv_header_curses_h&quot; &gt;&amp;6
+{ echo &quot;$as_me:$LINENO: result: $ac_cv_header_curses_h&quot; &gt;&amp;5
+echo &quot;${ECHO_T}$ac_cv_header_curses_h&quot; &gt;&amp;6; }
 else
   # Is the header compilable?
-echo &quot;$as_me:$LINENO: checking curses.h usability&quot; &gt;&amp;5
-echo $ECHO_N &quot;checking curses.h usability... $ECHO_C&quot; &gt;&amp;6
+{ echo &quot;$as_me:$LINENO: checking curses.h usability&quot; &gt;&amp;5
+echo $ECHO_N &quot;checking curses.h usability... $ECHO_C&quot; &gt;&amp;6; }
 cat &gt;conftest.$ac_ext &lt;&lt;_ACEOF
 /* confdefs.h.  */
 _ACEOF
@@ -6498,15 +7622,16 @@
   echo &quot;$as_me: failed program was:&quot; &gt;&amp;5
 sed 's/^/| /' conftest.$ac_ext &gt;&amp;5
 
-ac_header_compiler=no
+	ac_header_compiler=no
 fi
+
 rm -f conftest.err conftest.$ac_objext conftest.$ac_ext
-echo &quot;$as_me:$LINENO: result: $ac_header_compiler&quot; &gt;&amp;5
-echo &quot;${ECHO_T}$ac_header_compiler&quot; &gt;&amp;6
+{ echo &quot;$as_me:$LINENO: result: $ac_header_compiler&quot; &gt;&amp;5
+echo &quot;${ECHO_T}$ac_header_compiler&quot; &gt;&amp;6; }
 
 # Is the header present?
-echo &quot;$as_me:$LINENO: checking curses.h presence&quot; &gt;&amp;5
-echo $ECHO_N &quot;checking curses.h presence... $ECHO_C&quot; &gt;&amp;6
+{ echo &quot;$as_me:$LINENO: checking curses.h presence&quot; &gt;&amp;5
+echo $ECHO_N &quot;checking curses.h presence... $ECHO_C&quot; &gt;&amp;6; }
 cat &gt;conftest.$ac_ext &lt;&lt;_ACEOF
 /* confdefs.h.  */
 _ACEOF
@@ -6540,9 +7665,10 @@
 
   ac_header_preproc=no
 fi
+
 rm -f conftest.err conftest.$ac_ext
-echo &quot;$as_me:$LINENO: result: $ac_header_preproc&quot; &gt;&amp;5
-echo &quot;${ECHO_T}$ac_header_preproc&quot; &gt;&amp;6
+{ echo &quot;$as_me:$LINENO: result: $ac_header_preproc&quot; &gt;&amp;5
+echo &quot;${ECHO_T}$ac_header_preproc&quot; &gt;&amp;6; }
 
 # So?  What about this header?
 case $ac_header_compiler:$ac_header_preproc:$ac_c_preproc_warn_flag in
@@ -6566,25 +7692,18 @@
 echo &quot;$as_me: WARNING: curses.h: proceeding with the preprocessor's result&quot; &gt;&amp;2;}
     { echo &quot;$as_me:$LINENO: WARNING: curses.h: in the future, the compiler will take precedence&quot; &gt;&amp;5
 echo &quot;$as_me: WARNING: curses.h: in the future, the compiler will take precedence&quot; &gt;&amp;2;}
-    (
-      cat &lt;&lt;\_ASBOX
-## ------------------------------------------ ##
-## Report this to the AC_PACKAGE_NAME lists.  ##
-## ------------------------------------------ ##
-_ASBOX
-    ) |
-      sed &quot;s/^/$as_me: WARNING:     /&quot; &gt;&amp;2
+
     ;;
 esac
-echo &quot;$as_me:$LINENO: checking for curses.h&quot; &gt;&amp;5
-echo $ECHO_N &quot;checking for curses.h... $ECHO_C&quot; &gt;&amp;6
+{ echo &quot;$as_me:$LINENO: checking for curses.h&quot; &gt;&amp;5
+echo $ECHO_N &quot;checking for curses.h... $ECHO_C&quot; &gt;&amp;6; }
 if test &quot;${ac_cv_header_curses_h+set}&quot; = set; then
   echo $ECHO_N &quot;(cached) $ECHO_C&quot; &gt;&amp;6
 else
   ac_cv_header_curses_h=$ac_header_preproc
 fi
-echo &quot;$as_me:$LINENO: result: $ac_cv_header_curses_h&quot; &gt;&amp;5
-echo &quot;${ECHO_T}$ac_cv_header_curses_h&quot; &gt;&amp;6
+{ echo &quot;$as_me:$LINENO: result: $ac_cv_header_curses_h&quot; &gt;&amp;5
+echo &quot;${ECHO_T}$ac_cv_header_curses_h&quot; &gt;&amp;6; }
 
 fi
 if test $ac_cv_header_curses_h = yes; then
@@ -6597,7 +7716,7 @@
 	 fi
       fi
       if test &quot;x${NCURSES_HEADER_FOUND}&quot; = &quot;x0&quot; ; then
-         if test ! -z &quot;${ncurses_MANDATORY}&quot; ;
+         if test ! -z &quot;${NCURSES_MANDATORY}&quot; ;
          then
             echo &quot; ***&quot;
             echo &quot; *** It appears that you do not have the ncurses development package installed.&quot;
@@ -6605,18 +7724,18 @@
             echo &quot; *** without explicitly specifying --with-ncurses&quot;
             exit 1
          fi
-         ncurses_LIB=&quot;&quot;
-         ncurses_INCLUDE=&quot;&quot;
-         PBX_LIBncurses=0
+         NCURSES_LIB=&quot;&quot;
+         NCURSES_INCLUDE=&quot;&quot;
+         PBX_LIBNCURSES=0
       else
-         PBX_LIBncurses=1
+         PBX_LIBNCURSES=1
 
 cat &gt;&gt;confdefs.h &lt;&lt;_ACEOF
 #define HAVE_NCURSES 1
 _ACEOF
 
       fi
-   elif test ! -z &quot;${ncurses_MANDATORY}&quot;;
+   elif test ! -z &quot;${NCURSES_MANDATORY}&quot;;
    then
       echo &quot;***&quot;
       echo &quot;*** The ncurses installation on this system appears to be broken.&quot;
@@ -6631,34 +7750,34 @@
 
 
 
-# Check whether --with-newt or --without-newt was given.
+# Check whether --with-newt was given.
 if test &quot;${with_newt+set}&quot; = set; then
-  withval=&quot;$with_newt&quot;
-
+  withval=$with_newt;
 case ${withval} in
      n|no)
-     USE_newt=no
+     USE_NEWT=no
      ;;
      y|ye|yes)
-     newt_MANDATORY=&quot;yes&quot;
+     NEWT_MANDATORY=&quot;yes&quot;
      ;;
      *)
-     newt_DIR=&quot;${withval}&quot;
-     newt_MANDATORY=&quot;yes&quot;
+     NEWT_DIR=&quot;${withval}&quot;
+     NEWT_MANDATORY=&quot;yes&quot;
      ;;
 esac
 
-fi;
+fi
 
-PBX_LIBnewt=0
 
-if test &quot;${USE_newt}&quot; != &quot;no&quot;; then
+PBX_LIBNEWT=0
+
+if test &quot;${USE_NEWT}&quot; != &quot;no&quot;; then
    pbxlibdir=&quot;&quot;
-   if test &quot;x${newt_DIR}&quot; != &quot;x&quot;; then
+   if test &quot;x${NEWT_DIR}&quot; != &quot;x&quot;; then
       pbxlibdir=&quot;-L${newt_DIR}/lib&quot;
    fi
-   echo &quot;$as_me:$LINENO: checking for newtBell in -lnewt&quot; &gt;&amp;5
-echo $ECHO_N &quot;checking for newtBell in -lnewt... $ECHO_C&quot; &gt;&amp;6
+   { echo &quot;$as_me:$LINENO: checking for newtBell in -lnewt&quot; &gt;&amp;5
+echo $ECHO_N &quot;checking for newtBell in -lnewt... $ECHO_C&quot; &gt;&amp;6; }
 if test &quot;${ac_cv_lib_newt_newtBell+set}&quot; = set; then
   echo $ECHO_N &quot;(cached) $ECHO_C&quot; &gt;&amp;6
 else
@@ -6671,17 +7790,17 @@
 cat &gt;&gt;conftest.$ac_ext &lt;&lt;_ACEOF
 /* end confdefs.h.  */
 
-/* Override any gcc2 internal prototype to avoid an error.  */
+/* Override any GCC internal prototype to avoid an error.
+   Use char because int might match the return type of a GCC
+   builtin and then its argument prototype would still apply.  */
 #ifdef __cplusplus
 extern &quot;C&quot;
 #endif
-/* We use char because int might match the return type of a gcc2
-   builtin and then its argument prototype would still apply.  */
 char newtBell ();
 int
 main ()
 {
-newtBell ();
+return newtBell ();
   ;
   return 0;
 }
@@ -6713,39 +7832,43 @@
   echo &quot;$as_me: failed program was:&quot; &gt;&amp;5
 sed 's/^/| /' conftest.$ac_ext &gt;&amp;5
 
-ac_cv_lib_newt_newtBell=no
+	ac_cv_lib_newt_newtBell=no
 fi
+
 rm -f conftest.err conftest.$ac_objext \
       conftest$ac_exeext conftest.$ac_ext
 LIBS=$ac_check_lib_save_LIBS
 fi
-echo &quot;$as_me:$LINENO: result: $ac_cv_lib_newt_newtBell&quot; &gt;&amp;5
-echo &quot;${ECHO_T}$ac_cv_lib_newt_newtBell&quot; &gt;&amp;6
+{ echo &quot;$as_me:$LINENO: result: $ac_cv_lib_newt_newtBell&quot; &gt;&amp;5
+echo &quot;${ECHO_T}$ac_cv_lib_newt_newtBell&quot; &gt;&amp;6; }
 if test $ac_cv_lib_newt_newtBell = yes; then
-  :
+  AST_NEWT_FOUND=yes
+else
+  AST_NEWT_FOUND=no
 fi
 
 
-   if test &quot;${ac_cv_lib_newt_newtBell}&quot; = &quot;yes&quot;; then
-      newt_LIB=&quot;-lnewt &quot;
+   if test &quot;${AST_NEWT_FOUND}&quot; = &quot;yes&quot;; then
+      NEWT_LIB=&quot;-lnewt &quot;
       NEWT_HEADER_FOUND=&quot;1&quot;
-      if test &quot;x${newt_DIR}&quot; != &quot;x&quot;; then
-         newt_LIB=&quot;${pbxlibdir} ${newt_LIB}&quot;
-	 newt_INCLUDE=&quot;-I${newt_DIR}/include&quot;
+      if test &quot;x${NEWT_DIR}&quot; != &quot;x&quot;; then
+         NEWT_LIB=&quot;${pbxlibdir} ${NEWT_LIB}&quot;
+	 NEWT_INCLUDE=&quot;-I${NEWT_DIR}/include&quot;
 	 if test &quot;xnewt.h&quot; != &quot;x&quot; ; then
-	    as_ac_Header=`echo &quot;ac_cv_header_${newt_DIR}/include/newt.h&quot; | $as_tr_sh`
-if eval &quot;test \&quot;\${$as_ac_Header+set}\&quot; = set&quot;; then
-  echo &quot;$as_me:$LINENO: checking for ${newt_DIR}/include/newt.h&quot; &gt;&amp;5
-echo $ECHO_N &quot;checking for ${newt_DIR}/include/newt.h... $ECHO_C&quot; &gt;&amp;6
-if eval &quot;test \&quot;\${$as_ac_Header+set}\&quot; = set&quot;; then
+	    as_ac_Header=`echo &quot;ac_cv_header_${NEWT_DIR}/include/newt.h&quot; | $as_tr_sh`
+if { as_var=$as_ac_Header; eval &quot;test \&quot;\${$as_var+set}\&quot; = set&quot;; }; then
+  { echo &quot;$as_me:$LINENO: checking for ${NEWT_DIR}/include/newt.h&quot; &gt;&amp;5
+echo $ECHO_N &quot;checking for ${NEWT_DIR}/include/newt.h... $ECHO_C&quot; &gt;&amp;6; }
+if { as_var=$as_ac_Header; eval &quot;test \&quot;\${$as_var+set}\&quot; = set&quot;; }; then
   echo $ECHO_N &quot;(cached) $ECHO_C&quot; &gt;&amp;6
 fi
-echo &quot;$as_me:$LINENO: result: `eval echo '${'$as_ac_Header'}'`&quot; &gt;&amp;5
-echo &quot;${ECHO_T}`eval echo '${'$as_ac_Header'}'`&quot; &gt;&amp;6
+ac_res=`eval echo '${'$as_ac_Header'}'`
+	       { echo &quot;$as_me:$LINENO: result: $ac_res&quot; &gt;&amp;5
+echo &quot;${ECHO_T}$ac_res&quot; &gt;&amp;6; }
 else
   # Is the header compilable?
-echo &quot;$as_me:$LINENO: checking ${newt_DIR}/include/newt.h usability&quot; &gt;&amp;5
-echo $ECHO_N &quot;checking ${newt_DIR}/include/newt.h usability... $ECHO_C&quot; &gt;&amp;6
+{ echo &quot;$as_me:$LINENO: checking ${NEWT_DIR}/include/newt.h usability&quot; &gt;&amp;5
+echo $ECHO_N &quot;checking ${NEWT_DIR}/include/newt.h usability... $ECHO_C&quot; &gt;&amp;6; }
 cat &gt;conftest.$ac_ext &lt;&lt;_ACEOF
 /* confdefs.h.  */
 _ACEOF
@@ -6753,7 +7876,7 @@
 cat &gt;&gt;conftest.$ac_ext &lt;&lt;_ACEOF
 /* end confdefs.h.  */
 $ac_includes_default
-#include &lt;${newt_DIR}/include/newt.h&gt;
+#include &lt;${NEWT_DIR}/include/newt.h&gt;
 _ACEOF
 rm -f conftest.$ac_objext
 if { (eval echo &quot;$as_me:$LINENO: \&quot;$ac_compile\&quot;&quot;) &gt;&amp;5
@@ -6782,22 +7905,23 @@
   echo &quot;$as_me: failed program was:&quot; &gt;&amp;5
 sed 's/^/| /' conftest.$ac_ext &gt;&amp;5
 
-ac_header_compiler=no
+	ac_header_compiler=no
 fi
+
 rm -f conftest.err conftest.$ac_objext conftest.$ac_ext
-echo &quot;$as_me:$LINENO: result: $ac_header_compiler&quot; &gt;&amp;5
-echo &quot;${ECHO_T}$ac_header_compiler&quot; &gt;&amp;6
+{ echo &quot;$as_me:$LINENO: result: $ac_header_compiler&quot; &gt;&amp;5
+echo &quot;${ECHO_T}$ac_header_compiler&quot; &gt;&amp;6; }
 
 # Is the header present?
-echo &quot;$as_me:$LINENO: checking ${newt_DIR}/include/newt.h presence&quot; &gt;&amp;5
-echo $ECHO_N &quot;checking ${newt_DIR}/include/newt.h presence... $ECHO_C&quot; &gt;&amp;6
+{ echo &quot;$as_me:$LINENO: checking ${NEWT_DIR}/include/newt.h presence&quot; &gt;&amp;5
+echo $ECHO_N &quot;checking ${NEWT_DIR}/include/newt.h presence... $ECHO_C&quot; &gt;&amp;6; }
 cat &gt;conftest.$ac_ext &lt;&lt;_ACEOF
 /* confdefs.h.  */
 _ACEOF
 cat confdefs.h &gt;&gt;conftest.$ac_ext
 cat &gt;&gt;conftest.$ac_ext &lt;&lt;_ACEOF
 /* end confdefs.h.  */
-#include &lt;${newt_DIR}/include/newt.h&gt;
+#include &lt;${NEWT_DIR}/include/newt.h&gt;
 _ACEOF
 if { (eval echo &quot;$as_me:$LINENO: \&quot;$ac_cpp conftest.$ac_ext\&quot;&quot;) &gt;&amp;5
   (eval $ac_cpp conftest.$ac_ext) 2&gt;conftest.er1
@@ -6824,51 +7948,46 @@
 
   ac_header_preproc=no
 fi
+
 rm -f conftest.err conftest.$ac_ext
-echo &quot;$as_me:$LINENO: result: $ac_header_preproc&quot; &gt;&amp;5
-echo &quot;${ECHO_T}$ac_header_preproc&quot; &gt;&amp;6
+{ echo &quot;$as_me:$LINENO: result: $ac_header_preproc&quot; &gt;&amp;5
+echo &quot;${ECHO_T}$ac_header_preproc&quot; &gt;&amp;6; }
 
 # So?  What about this header?
 case $ac_header_compiler:$ac_header_preproc:$ac_c_preproc_warn_flag in
   yes:no: )
-    { echo &quot;$as_me:$LINENO: WARNING: ${newt_DIR}/include/newt.h: accepted by the compiler, rejected by the preprocessor!&quot; &gt;&amp;5
-echo &quot;$as_me: WARNING: ${newt_DIR}/include/newt.h: accepted by the compiler, rejected by the preprocessor!&quot; &gt;&amp;2;}
-    { echo &quot;$as_me:$LINENO: WARNING: ${newt_DIR}/include/newt.h: proceeding with the compiler's result&quot; &gt;&amp;5
-echo &quot;$as_me: WARNING: ${newt_DIR}/include/newt.h: proceeding with the compiler's result&quot; &gt;&amp;2;}
+    { echo &quot;$as_me:$LINENO: WARNING: ${NEWT_DIR}/include/newt.h: accepted by the compiler, rejected by the preprocessor!&quot; &gt;&amp;5
+echo &quot;$as_me: WARNING: ${NEWT_DIR}/include/newt.h: accepted by the compiler, rejected by the preprocessor!&quot; &gt;&amp;2;}
+    { echo &quot;$as_me:$LINENO: WARNING: ${NEWT_DIR}/include/newt.h: proceeding with the compiler's result&quot; &gt;&amp;5
+echo &quot;$as_me: WARNING: ${NEWT_DIR}/include/newt.h: proceeding with the compiler's result&quot; &gt;&amp;2;}
     ac_header_preproc=yes
     ;;
   no:yes:* )
-    { echo &quot;$as_me:$LINENO: WARNING: ${newt_DIR}/include/newt.h: present but cannot be compiled&quot; &gt;&amp;5
-echo &quot;$as_me: WARNING: ${newt_DIR}/include/newt.h: present but cannot be compiled&quot; &gt;&amp;2;}
-    { echo &quot;$as_me:$LINENO: WARNING: ${newt_DIR}/include/newt.h:     check for missing prerequisite headers?&quot; &gt;&amp;5
-echo &quot;$as_me: WARNING: ${newt_DIR}/include/newt.h:     check for missing prerequisite headers?&quot; &gt;&amp;2;}
-    { echo &quot;$as_me:$LINENO: WARNING: ${newt_DIR}/include/newt.h: see the Autoconf documentation&quot; &gt;&amp;5
-echo &quot;$as_me: WARNING: ${newt_DIR}/include/newt.h: see the Autoconf documentation&quot; &gt;&amp;2;}
-    { echo &quot;$as_me:$LINENO: WARNING: ${newt_DIR}/include/newt.h:     section \&quot;Present But Cannot Be Compiled\&quot;&quot; &gt;&amp;5
-echo &quot;$as_me: WARNING: ${newt_DIR}/include/newt.h:     section \&quot;Present But Cannot Be Compiled\&quot;&quot; &gt;&amp;2;}
-    { echo &quot;$as_me:$LINENO: WARNING: ${newt_DIR}/include/newt.h: proceeding with the preprocessor's result&quot; &gt;&amp;5
-echo &quot;$as_me: WARNING: ${newt_DIR}/include/newt.h: proceeding with the preprocessor's result&quot; &gt;&amp;2;}
-    { echo &quot;$as_me:$LINENO: WARNING: ${newt_DIR}/include/newt.h: in the future, the compiler will take precedence&quot; &gt;&amp;5
-echo &quot;$as_me: WARNING: ${newt_DIR}/include/newt.h: in the future, the compiler will take precedence&quot; &gt;&amp;2;}
-    (
-      cat &lt;&lt;\_ASBOX
-## ------------------------------------------ ##
-## Report this to the AC_PACKAGE_NAME lists.  ##
-## ------------------------------------------ ##
-_ASBOX
-    ) |
-      sed &quot;s/^/$as_me: WARNING:     /&quot; &gt;&amp;2
+    { echo &quot;$as_me:$LINENO: WARNING: ${NEWT_DIR}/include/newt.h: present but cannot be compiled&quot; &gt;&amp;5
+echo &quot;$as_me: WARNING: ${NEWT_DIR}/include/newt.h: present but cannot be compiled&quot; &gt;&amp;2;}
+    { echo &quot;$as_me:$LINENO: WARNING: ${NEWT_DIR}/include/newt.h:     check for missing prerequisite headers?&quot; &gt;&amp;5
+echo &quot;$as_me: WARNING: ${NEWT_DIR}/include/newt.h:     check for missing prerequisite headers?&quot; &gt;&amp;2;}
+    { echo &quot;$as_me:$LINENO: WARNING: ${NEWT_DIR}/include/newt.h: see the Autoconf documentation&quot; &gt;&amp;5
+echo &quot;$as_me: WARNING: ${NEWT_DIR}/include/newt.h: see the Autoconf documentation&quot; &gt;&amp;2;}
+    { echo &quot;$as_me:$LINENO: WARNING: ${NEWT_DIR}/include/newt.h:     section \&quot;Present But Cannot Be Compiled\&quot;&quot; &gt;&amp;5
+echo &quot;$as_me: WARNING: ${NEWT_DIR}/include/newt.h:     section \&quot;Present But Cannot Be Compiled\&quot;&quot; &gt;&amp;2;}
+    { echo &quot;$as_me:$LINENO: WARNING: ${NEWT_DIR}/include/newt.h: proceeding with the preprocessor's result&quot; &gt;&amp;5
+echo &quot;$as_me: WARNING: ${NEWT_DIR}/include/newt.h: proceeding with the preprocessor's result&quot; &gt;&amp;2;}
+    { echo &quot;$as_me:$LINENO: WARNING: ${NEWT_DIR}/include/newt.h: in the future, the compiler will take precedence&quot; &gt;&amp;5
+echo &quot;$as_me: WARNING: ${NEWT_DIR}/include/newt.h: in the future, the compiler will take precedence&quot; &gt;&amp;2;}
+
     ;;
 esac
-echo &quot;$as_me:$LINENO: checking for ${newt_DIR}/include/newt.h&quot; &gt;&amp;5
-echo $ECHO_N &quot;checking for ${newt_DIR}/include/newt.h... $ECHO_C&quot; &gt;&amp;6
-if eval &quot;test \&quot;\${$as_ac_Header+set}\&quot; = set&quot;; then
+{ echo &quot;$as_me:$LINENO: checking for ${NEWT_DIR}/include/newt.h&quot; &gt;&amp;5
+echo $ECHO_N &quot;checking for ${NEWT_DIR}/include/newt.h... $ECHO_C&quot; &gt;&amp;6; }
+if { as_var=$as_ac_Header; eval &quot;test \&quot;\${$as_var+set}\&quot; = set&quot;; }; then
   echo $ECHO_N &quot;(cached) $ECHO_C&quot; &gt;&amp;6
 else
   eval &quot;$as_ac_Header=\$ac_header_preproc&quot;
 fi
-echo &quot;$as_me:$LINENO: result: `eval echo '${'$as_ac_Header'}'`&quot; &gt;&amp;5
-echo &quot;${ECHO_T}`eval echo '${'$as_ac_Header'}'`&quot; &gt;&amp;6
+ac_res=`eval echo '${'$as_ac_Header'}'`
+	       { echo &quot;$as_me:$LINENO: result: $ac_res&quot; &gt;&amp;5
+echo &quot;${ECHO_T}$ac_res&quot; &gt;&amp;6; }
 
 fi
 if test `eval echo '${'$as_ac_Header'}'` = yes; then
@@ -6882,17 +8001,17 @@
       else
 	 if test &quot;xnewt.h&quot; != &quot;x&quot; ; then
             if test &quot;${ac_cv_header_newt_h+set}&quot; = set; then
-  echo &quot;$as_me:$LINENO: checking for newt.h&quot; &gt;&amp;5
-echo $ECHO_N &quot;checking for newt.h... $ECHO_C&quot; &gt;&amp;6
+  { echo &quot;$as_me:$LINENO: checking for newt.h&quot; &gt;&amp;5
+echo $ECHO_N &quot;checking for newt.h... $ECHO_C&quot; &gt;&amp;6; }
 if test &quot;${ac_cv_header_newt_h+set}&quot; = set; then
   echo $ECHO_N &quot;(cached) $ECHO_C&quot; &gt;&amp;6
 fi
-echo &quot;$as_me:$LINENO: result: $ac_cv_header_newt_h&quot; &gt;&amp;5
-echo &quot;${ECHO_T}$ac_cv_header_newt_h&quot; &gt;&amp;6
+{ echo &quot;$as_me:$LINENO: result: $ac_cv_header_newt_h&quot; &gt;&amp;5
+echo &quot;${ECHO_T}$ac_cv_header_newt_h&quot; &gt;&amp;6; }
 else
   # Is the header compilable?
-echo &quot;$as_me:$LINENO: checking newt.h usability&quot; &gt;&amp;5
-echo $ECHO_N &quot;checking newt.h usability... $ECHO_C&quot; &gt;&amp;6
+{ echo &quot;$as_me:$LINENO: checking newt.h usability&quot; &gt;&amp;5
+echo $ECHO_N &quot;checking newt.h usability... $ECHO_C&quot; &gt;&amp;6; }
 cat &gt;conftest.$ac_ext &lt;&lt;_ACEOF
 /* confdefs.h.  */
 _ACEOF
@@ -6929,15 +8048,16 @@
   echo &quot;$as_me: failed program was:&quot; &gt;&amp;5
 sed 's/^/| /' conftest.$ac_ext &gt;&amp;5
 
-ac_header_compiler=no
+	ac_header_compiler=no
 fi
+
 rm -f conftest.err conftest.$ac_objext conftest.$ac_ext
-echo &quot;$as_me:$LINENO: result: $ac_header_compiler&quot; &gt;&amp;5
-echo &quot;${ECHO_T}$ac_header_compiler&quot; &gt;&amp;6
+{ echo &quot;$as_me:$LINENO: result: $ac_header_compiler&quot; &gt;&amp;5
+echo &quot;${ECHO_T}$ac_header_compiler&quot; &gt;&amp;6; }
 
 # Is the header present?
-echo &quot;$as_me:$LINENO: checking newt.h presence&quot; &gt;&amp;5
-echo $ECHO_N &quot;checking newt.h presence... $ECHO_C&quot; &gt;&amp;6
+{ echo &quot;$as_me:$LINENO: checking newt.h presence&quot; &gt;&amp;5
+echo $ECHO_N &quot;checking newt.h presence... $ECHO_C&quot; &gt;&amp;6; }
 cat &gt;conftest.$ac_ext &lt;&lt;_ACEOF
 /* confdefs.h.  */
 _ACEOF
@@ -6971,9 +8091,10 @@
 
   ac_header_preproc=no
 fi
+
 rm -f conftest.err conftest.$ac_ext
-echo &quot;$as_me:$LINENO: result: $ac_header_preproc&quot; &gt;&amp;5
-echo &quot;${ECHO_T}$ac_header_preproc&quot; &gt;&amp;6
+{ echo &quot;$as_me:$LINENO: result: $ac_header_preproc&quot; &gt;&amp;5
+echo &quot;${ECHO_T}$ac_header_preproc&quot; &gt;&amp;6; }
 
 # So?  What about this header?
 case $ac_header_compiler:$ac_header_preproc:$ac_c_preproc_warn_flag in
@@ -6997,25 +8118,18 @@
 echo &quot;$as_me: WARNING: newt.h: proceeding with the preprocessor's result&quot; &gt;&amp;2;}
     { echo &quot;$as_me:$LINENO: WARNING: newt.h: in the future, the compiler will take precedence&quot; &gt;&amp;5
 echo &quot;$as_me: WARNING: newt.h: in the future, the compiler will take precedence&quot; &gt;&amp;2;}
-    (
-      cat &lt;&lt;\_ASBOX
-## ------------------------------------------ ##
-## Report this to the AC_PACKAGE_NAME lists.  ##
-## ------------------------------------------ ##
-_ASBOX
-    ) |
-      sed &quot;s/^/$as_me: WARNING:     /&quot; &gt;&amp;2
+
     ;;
 esac
-echo &quot;$as_me:$LINENO: checking for newt.h&quot; &gt;&amp;5
-echo $ECHO_N &quot;checking for newt.h... $ECHO_C&quot; &gt;&amp;6
+{ echo &quot;$as_me:$LINENO: checking for newt.h&quot; &gt;&amp;5
+echo $ECHO_N &quot;checking for newt.h... $ECHO_C&quot; &gt;&amp;6; }
 if test &quot;${ac_cv_header_newt_h+set}&quot; = set; then
   echo $ECHO_N &quot;(cached) $ECHO_C&quot; &gt;&amp;6
 else
   ac_cv_header_newt_h=$ac_header_preproc
 fi
-echo &quot;$as_me:$LINENO: result: $ac_cv_header_newt_h&quot; &gt;&amp;5
-echo &quot;${ECHO_T}$ac_cv_header_newt_h&quot; &gt;&amp;6
+{ echo &quot;$as_me:$LINENO: result: $ac_cv_header_newt_h&quot; &gt;&amp;5
+echo &quot;${ECHO_T}$ac_cv_header_newt_h&quot; &gt;&amp;6; }
 
 fi
 if test $ac_cv_header_newt_h = yes; then
@@ -7028,7 +8142,7 @@
 	 fi
       fi
       if test &quot;x${NEWT_HEADER_FOUND}&quot; = &quot;x0&quot; ; then
-         if test ! -z &quot;${newt_MANDATORY}&quot; ;
+         if test ! -z &quot;${NEWT_MANDATORY}&quot; ;
          then
             echo &quot; ***&quot;
             echo &quot; *** It appears that you do not have the newt development package installed.&quot;
@@ -7036,18 +8150,18 @@
             echo &quot; *** without explicitly specifying --with-newt&quot;
             exit 1
          fi
-         newt_LIB=&quot;&quot;
-         newt_INCLUDE=&quot;&quot;
-         PBX_LIBnewt=0
+         NEWT_LIB=&quot;&quot;
+         NEWT_INCLUDE=&quot;&quot;
+         PBX_LIBNEWT=0
       else
-         PBX_LIBnewt=1
+         PBX_LIBNEWT=1
 
 cat &gt;&gt;confdefs.h &lt;&lt;_ACEOF
 #define HAVE_NEWT 1
 _ACEOF
 
       fi
-   elif test ! -z &quot;${newt_MANDATORY}&quot;;
+   elif test ! -z &quot;${NEWT_MANDATORY}&quot;;
    then
       echo &quot;***&quot;
       echo &quot;*** The newt installation on this system appears to be broken.&quot;
@@ -7062,34 +8176,34 @@
 
 
 
-# Check whether --with-odbc or --without-odbc was given.
+# Check whether --with-odbc was given.
 if test &quot;${with_odbc+set}&quot; = set; then
-  withval=&quot;$with_odbc&quot;
-
+  withval=$with_odbc;
 case ${withval} in
      n|no)
-     USE_odbc=no
+     USE_UNIXODBC=no
      ;;
      y|ye|yes)
-     odbc_MANDATORY=&quot;yes&quot;
+     UNIXODBC_MANDATORY=&quot;yes&quot;
      ;;
      *)
-     odbc_DIR=&quot;${withval}&quot;
-     odbc_MANDATORY=&quot;yes&quot;
+     UNIXODBC_DIR=&quot;${withval}&quot;
+     UNIXODBC_MANDATORY=&quot;yes&quot;
      ;;
 esac
 
-fi;
+fi
 
-PBX_LIBodbc=0
 
-if test &quot;${USE_odbc}&quot; != &quot;no&quot;; then
+PBX_LIBUNIXODBC=0
+
+if test &quot;${USE_UNIXODBC}&quot; != &quot;no&quot;; then
    pbxlibdir=&quot;&quot;
-   if test &quot;x${odbc_DIR}&quot; != &quot;x&quot;; then
+   if test &quot;x${UNIXODBC_DIR}&quot; != &quot;x&quot;; then
       pbxlibdir=&quot;-L${odbc_DIR}/lib&quot;
    fi
-   echo &quot;$as_me:$LINENO: checking for SQLConnect in -lodbc&quot; &gt;&amp;5
-echo $ECHO_N &quot;checking for SQLConnect in -lodbc... $ECHO_C&quot; &gt;&amp;6
+   { echo &quot;$as_me:$LINENO: checking for SQLConnect in -lodbc&quot; &gt;&amp;5
+echo $ECHO_N &quot;checking for SQLConnect in -lodbc... $ECHO_C&quot; &gt;&amp;6; }
 if test &quot;${ac_cv_lib_odbc_SQLConnect+set}&quot; = set; then
   echo $ECHO_N &quot;(cached) $ECHO_C&quot; &gt;&amp;6
 else
@@ -7102,17 +8216,17 @@
 cat &gt;&gt;conftest.$ac_ext &lt;&lt;_ACEOF
 /* end confdefs.h.  */
 
-/* Override any gcc2 internal prototype to avoid an error.  */
+/* Override any GCC internal prototype to avoid an error.
+   Use char because int might match the return type of a GCC
+   builtin and then its argument prototype would still apply.  */
 #ifdef __cplusplus
 extern &quot;C&quot;
 #endif
-/* We use char because int might match the return type of a gcc2
-   builtin and then its argument prototype would still apply.  */
 char SQLConnect ();
 int
 main ()
 {
-SQLConnect ();
+return SQLConnect ();
   ;
   return 0;
 }
@@ -7144,39 +8258,43 @@
   echo &quot;$as_me: failed program was:&quot; &gt;&amp;5
 sed 's/^/| /' conftest.$ac_ext &gt;&amp;5
 
-ac_cv_lib_odbc_SQLConnect=no
+	ac_cv_lib_odbc_SQLConnect=no
 fi
+
 rm -f conftest.err conftest.$ac_objext \
       conftest$ac_exeext conftest.$ac_ext
 LIBS=$ac_check_lib_save_LIBS
 fi
-echo &quot;$as_me:$LINENO: result: $ac_cv_lib_odbc_SQLConnect&quot; &gt;&amp;5
-echo &quot;${ECHO_T}$ac_cv_lib_odbc_SQLConnect&quot; &gt;&amp;6
+{ echo &quot;$as_me:$LINENO: result: $ac_cv_lib_odbc_SQLConnect&quot; &gt;&amp;5
+echo &quot;${ECHO_T}$ac_cv_lib_odbc_SQLConnect&quot; &gt;&amp;6; }
 if test $ac_cv_lib_odbc_SQLConnect = yes; then
-  :
+  AST_UNIXODBC_FOUND=yes
+else
+  AST_UNIXODBC_FOUND=no
 fi
 
 
-   if test &quot;${ac_cv_lib_odbc_SQLConnect}&quot; = &quot;yes&quot;; then
-      odbc_LIB=&quot;-lodbc &quot;
+   if test &quot;${AST_UNIXODBC_FOUND}&quot; = &quot;yes&quot;; then
+      UNIXODBC_LIB=&quot;-lodbc &quot;
       UNIXODBC_HEADER_FOUND=&quot;1&quot;
-      if test &quot;x${odbc_DIR}&quot; != &quot;x&quot;; then
-         odbc_LIB=&quot;${pbxlibdir} ${odbc_LIB}&quot;
-	 odbc_INCLUDE=&quot;-I${odbc_DIR}/include&quot;
+      if test &quot;x${UNIXODBC_DIR}&quot; != &quot;x&quot;; then
+         UNIXODBC_LIB=&quot;${pbxlibdir} ${UNIXODBC_LIB}&quot;
+	 UNIXODBC_INCLUDE=&quot;-I${UNIXODBC_DIR}/include&quot;
 	 if test &quot;xsql.h&quot; != &quot;x&quot; ; then
-	    as_ac_Header=`echo &quot;ac_cv_header_${odbc_DIR}/include/sql.h&quot; | $as_tr_sh`
-if eval &quot;test \&quot;\${$as_ac_Header+set}\&quot; = set&quot;; then
-  echo &quot;$as_me:$LINENO: checking for ${odbc_DIR}/include/sql.h&quot; &gt;&amp;5
-echo $ECHO_N &quot;checking for ${odbc_DIR}/include/sql.h... $ECHO_C&quot; &gt;&amp;6
-if eval &quot;test \&quot;\${$as_ac_Header+set}\&quot; = set&quot;; then
+	    as_ac_Header=`echo &quot;ac_cv_header_${UNIXODBC_DIR}/include/sql.h&quot; | $as_tr_sh`
+if { as_var=$as_ac_Header; eval &quot;test \&quot;\${$as_var+set}\&quot; = set&quot;; }; then
+  { echo &quot;$as_me:$LINENO: checking for ${UNIXODBC_DIR}/include/sql.h&quot; &gt;&amp;5
+echo $ECHO_N &quot;checking for ${UNIXODBC_DIR}/include/sql.h... $ECHO_C&quot; &gt;&amp;6; }
+if { as_var=$as_ac_Header; eval &quot;test \&quot;\${$as_var+set}\&quot; = set&quot;; }; then
   echo $ECHO_N &quot;(cached) $ECHO_C&quot; &gt;&amp;6
 fi
-echo &quot;$as_me:$LINENO: result: `eval echo '${'$as_ac_Header'}'`&quot; &gt;&amp;5
-echo &quot;${ECHO_T}`eval echo '${'$as_ac_Header'}'`&quot; &gt;&amp;6
+ac_res=`eval echo '${'$as_ac_Header'}'`
+	       { echo &quot;$as_me:$LINENO: result: $ac_res&quot; &gt;&amp;5
+echo &quot;${ECHO_T}$ac_res&quot; &gt;&amp;6; }
 else
   # Is the header compilable?
-echo &quot;$as_me:$LINENO: checking ${odbc_DIR}/include/sql.h usability&quot; &gt;&amp;5
-echo $ECHO_N &quot;checking ${odbc_DIR}/include/sql.h usability... $ECHO_C&quot; &gt;&amp;6
+{ echo &quot;$as_me:$LINENO: checking ${UNIXODBC_DIR}/include/sql.h usability&quot; &gt;&amp;5
+echo $ECHO_N &quot;checking ${UNIXODBC_DIR}/include/sql.h usability... $ECHO_C&quot; &gt;&amp;6; }
 cat &gt;conftest.$ac_ext &lt;&lt;_ACEOF
 /* confdefs.h.  */
 _ACEOF
@@ -7184,7 +8302,7 @@
 cat &gt;&gt;conftest.$ac_ext &lt;&lt;_ACEOF
 /* end confdefs.h.  */
 $ac_includes_default
-#include &lt;${odbc_DIR}/include/sql.h&gt;
+#include &lt;${UNIXODBC_DIR}/include/sql.h&gt;
 _ACEOF
 rm -f conftest.$ac_objext
 if { (eval echo &quot;$as_me:$LINENO: \&quot;$ac_compile\&quot;&quot;) &gt;&amp;5
@@ -7213,22 +8331,23 @@
   echo &quot;$as_me: failed program was:&quot; &gt;&amp;5
 sed 's/^/| /' conftest.$ac_ext &gt;&amp;5
 
-ac_header_compiler=no
+	ac_header_compiler=no
 fi
+
 rm -f conftest.err conftest.$ac_objext conftest.$ac_ext
-echo &quot;$as_me:$LINENO: result: $ac_header_compiler&quot; &gt;&amp;5
-echo &quot;${ECHO_T}$ac_header_compiler&quot; &gt;&amp;6
+{ echo &quot;$as_me:$LINENO: result: $ac_header_compiler&quot; &gt;&amp;5
+echo &quot;${ECHO_T}$ac_header_compiler&quot; &gt;&amp;6; }
 
 # Is the header present?
-echo &quot;$as_me:$LINENO: checking ${odbc_DIR}/include/sql.h presence&quot; &gt;&amp;5
-echo $ECHO_N &quot;checking ${odbc_DIR}/include/sql.h presence... $ECHO_C&quot; &gt;&amp;6
+{ echo &quot;$as_me:$LINENO: checking ${UNIXODBC_DIR}/include/sql.h presence&quot; &gt;&amp;5
+echo $ECHO_N &quot;checking ${UNIXODBC_DIR}/include/sql.h presence... $ECHO_C&quot; &gt;&amp;6; }
 cat &gt;conftest.$ac_ext &lt;&lt;_ACEOF
 /* confdefs.h.  */
 _ACEOF
 cat confdefs.h &gt;&gt;conftest.$ac_ext
 cat &gt;&gt;conftest.$ac_ext &lt;&lt;_ACEOF
 /* end confdefs.h.  */
-#include &lt;${odbc_DIR}/include/sql.h&gt;
+#include &lt;${UNIXODBC_DIR}/include/sql.h&gt;
 _ACEOF
 if { (eval echo &quot;$as_me:$LINENO: \&quot;$ac_cpp conftest.$ac_ext\&quot;&quot;) &gt;&amp;5
   (eval $ac_cpp conftest.$ac_ext) 2&gt;conftest.er1
@@ -7255,51 +8374,46 @@
 
   ac_header_preproc=no
 fi
+
 rm -f conftest.err conftest.$ac_ext
-echo &quot;$as_me:$LINENO: result: $ac_header_preproc&quot; &gt;&amp;5
-echo &quot;${ECHO_T}$ac_header_preproc&quot; &gt;&amp;6
+{ echo &quot;$as_me:$LINENO: result: $ac_header_preproc&quot; &gt;&amp;5
+echo &quot;${ECHO_T}$ac_header_preproc&quot; &gt;&amp;6; }
 
 # So?  What about this header?
 case $ac_header_compiler:$ac_header_preproc:$ac_c_preproc_warn_flag in
   yes:no: )
-    { echo &quot;$as_me:$LINENO: WARNING: ${odbc_DIR}/include/sql.h: accepted by the compiler, rejected by the preprocessor!&quot; &gt;&amp;5
-echo &quot;$as_me: WARNING: ${odbc_DIR}/include/sql.h: accepted by the compiler, rejected by the preprocessor!&quot; &gt;&amp;2;}
-    { echo &quot;$as_me:$LINENO: WARNING: ${odbc_DIR}/include/sql.h: proceeding with the compiler's result&quot; &gt;&amp;5
-echo &quot;$as_me: WARNING: ${odbc_DIR}/include/sql.h: proceeding with the compiler's result&quot; &gt;&amp;2;}
+    { echo &quot;$as_me:$LINENO: WARNING: ${UNIXODBC_DIR}/include/sql.h: accepted by the compiler, rejected by the preprocessor!&quot; &gt;&amp;5
+echo &quot;$as_me: WARNING: ${UNIXODBC_DIR}/include/sql.h: accepted by the compiler, rejected by the preprocessor!&quot; &gt;&amp;2;}
+    { echo &quot;$as_me:$LINENO: WARNING: ${UNIXODBC_DIR}/include/sql.h: proceeding with the compiler's result&quot; &gt;&amp;5
+echo &quot;$as_me: WARNING: ${UNIXODBC_DIR}/include/sql.h: proceeding with the compiler's result&quot; &gt;&amp;2;}
     ac_header_preproc=yes
     ;;
   no:yes:* )
-    { echo &quot;$as_me:$LINENO: WARNING: ${odbc_DIR}/include/sql.h: present but cannot be compiled&quot; &gt;&amp;5
-echo &quot;$as_me: WARNING: ${odbc_DIR}/include/sql.h: present but cannot be compiled&quot; &gt;&amp;2;}
-    { echo &quot;$as_me:$LINENO: WARNING: ${odbc_DIR}/include/sql.h:     check for missing prerequisite headers?&quot; &gt;&amp;5
-echo &quot;$as_me: WARNING: ${odbc_DIR}/include/sql.h:     check for missing prerequisite headers?&quot; &gt;&amp;2;}
-    { echo &quot;$as_me:$LINENO: WARNING: ${odbc_DIR}/include/sql.h: see the Autoconf documentation&quot; &gt;&amp;5
-echo &quot;$as_me: WARNING: ${odbc_DIR}/include/sql.h: see the Autoconf documentation&quot; &gt;&amp;2;}
-    { echo &quot;$as_me:$LINENO: WARNING: ${odbc_DIR}/include/sql.h:     section \&quot;Present But Cannot Be Compiled\&quot;&quot; &gt;&amp;5
-echo &quot;$as_me: WARNING: ${odbc_DIR}/include/sql.h:     section \&quot;Present But Cannot Be Compiled\&quot;&quot; &gt;&amp;2;}
-    { echo &quot;$as_me:$LINENO: WARNING: ${odbc_DIR}/include/sql.h: proceeding with the preprocessor's result&quot; &gt;&amp;5
-echo &quot;$as_me: WARNING: ${odbc_DIR}/include/sql.h: proceeding with the preprocessor's result&quot; &gt;&amp;2;}
-    { echo &quot;$as_me:$LINENO: WARNING: ${odbc_DIR}/include/sql.h: in the future, the compiler will take precedence&quot; &gt;&amp;5
-echo &quot;$as_me: WARNING: ${odbc_DIR}/include/sql.h: in the future, the compiler will take precedence&quot; &gt;&amp;2;}
-    (
-      cat &lt;&lt;\_ASBOX
-## ------------------------------------------ ##
-## Report this to the AC_PACKAGE_NAME lists.  ##
-## ------------------------------------------ ##
-_ASBOX
-    ) |
-      sed &quot;s/^/$as_me: WARNING:     /&quot; &gt;&amp;2
+    { echo &quot;$as_me:$LINENO: WARNING: ${UNIXODBC_DIR}/include/sql.h: present but cannot be compiled&quot; &gt;&amp;5
+echo &quot;$as_me: WARNING: ${UNIXODBC_DIR}/include/sql.h: present but cannot be compiled&quot; &gt;&amp;2;}
+    { echo &quot;$as_me:$LINENO: WARNING: ${UNIXODBC_DIR}/include/sql.h:     check for missing prerequisite headers?&quot; &gt;&amp;5
+echo &quot;$as_me: WARNING: ${UNIXODBC_DIR}/include/sql.h:     check for missing prerequisite headers?&quot; &gt;&amp;2;}
+    { echo &quot;$as_me:$LINENO: WARNING: ${UNIXODBC_DIR}/include/sql.h: see the Autoconf documentation&quot; &gt;&amp;5
+echo &quot;$as_me: WARNING: ${UNIXODBC_DIR}/include/sql.h: see the Autoconf documentation&quot; &gt;&amp;2;}
+    { echo &quot;$as_me:$LINENO: WARNING: ${UNIXODBC_DIR}/include/sql.h:     section \&quot;Present But Cannot Be Compiled\&quot;&quot; &gt;&amp;5
+echo &quot;$as_me: WARNING: ${UNIXODBC_DIR}/include/sql.h:     section \&quot;Present But Cannot Be Compiled\&quot;&quot; &gt;&amp;2;}
+    { echo &quot;$as_me:$LINENO: WARNING: ${UNIXODBC_DIR}/include/sql.h: proceeding with the preprocessor's result&quot; &gt;&amp;5
+echo &quot;$as_me: WARNING: ${UNIXODBC_DIR}/include/sql.h: proceeding with the preprocessor's result&quot; &gt;&amp;2;}
+    { echo &quot;$as_me:$LINENO: WARNING: ${UNIXODBC_DIR}/include/sql.h: in the future, the compiler will take precedence&quot; &gt;&amp;5
+echo &quot;$as_me: WARNING: ${UNIXODBC_DIR}/include/sql.h: in the future, the compiler will take precedence&quot; &gt;&amp;2;}
+
     ;;
 esac
-echo &quot;$as_me:$LINENO: checking for ${odbc_DIR}/include/sql.h&quot; &gt;&amp;5
-echo $ECHO_N &quot;checking for ${odbc_DIR}/include/sql.h... $ECHO_C&quot; &gt;&amp;6
-if eval &quot;test \&quot;\${$as_ac_Header+set}\&quot; = set&quot;; then
+{ echo &quot;$as_me:$LINENO: checking for ${UNIXODBC_DIR}/include/sql.h&quot; &gt;&amp;5
+echo $ECHO_N &quot;checking for ${UNIXODBC_DIR}/include/sql.h... $ECHO_C&quot; &gt;&amp;6; }
+if { as_var=$as_ac_Header; eval &quot;test \&quot;\${$as_var+set}\&quot; = set&quot;; }; then
   echo $ECHO_N &quot;(cached) $ECHO_C&quot; &gt;&amp;6
 else
   eval &quot;$as_ac_Header=\$ac_header_preproc&quot;
 fi
-echo &quot;$as_me:$LINENO: result: `eval echo '${'$as_ac_Header'}'`&quot; &gt;&amp;5
-echo &quot;${ECHO_T}`eval echo '${'$as_ac_Header'}'`&quot; &gt;&amp;6
+ac_res=`eval echo '${'$as_ac_Header'}'`
+	       { echo &quot;$as_me:$LINENO: result: $ac_res&quot; &gt;&amp;5
+echo &quot;${ECHO_T}$ac_res&quot; &gt;&amp;6; }
 
 fi
 if test `eval echo '${'$as_ac_Header'}'` = yes; then
@@ -7313,17 +8427,17 @@
       else
 	 if test &quot;xsql.h&quot; != &quot;x&quot; ; then
             if test &quot;${ac_cv_header_sql_h+set}&quot; = set; then
-  echo &quot;$as_me:$LINENO: checking for sql.h&quot; &gt;&amp;5
-echo $ECHO_N &quot;checking for sql.h... $ECHO_C&quot; &gt;&amp;6
+  { echo &quot;$as_me:$LINENO: checking for sql.h&quot; &gt;&amp;5
+echo $ECHO_N &quot;checking for sql.h... $ECHO_C&quot; &gt;&amp;6; }
 if test &quot;${ac_cv_header_sql_h+set}&quot; = set; then
   echo $ECHO_N &quot;(cached) $ECHO_C&quot; &gt;&amp;6
 fi
-echo &quot;$as_me:$LINENO: result: $ac_cv_header_sql_h&quot; &gt;&amp;5
-echo &quot;${ECHO_T}$ac_cv_header_sql_h&quot; &gt;&amp;6
+{ echo &quot;$as_me:$LINENO: result: $ac_cv_header_sql_h&quot; &gt;&amp;5
+echo &quot;${ECHO_T}$ac_cv_header_sql_h&quot; &gt;&amp;6; }
 else
   # Is the header compilable?
-echo &quot;$as_me:$LINENO: checking sql.h usability&quot; &gt;&amp;5
-echo $ECHO_N &quot;checking sql.h usability... $ECHO_C&quot; &gt;&amp;6
+{ echo &quot;$as_me:$LINENO: checking sql.h usability&quot; &gt;&amp;5
+echo $ECHO_N &quot;checking sql.h usability... $ECHO_C&quot; &gt;&amp;6; }
 cat &gt;conftest.$ac_ext &lt;&lt;_ACEOF
 /* confdefs.h.  */
 _ACEOF
@@ -7360,15 +8474,16 @@
   echo &quot;$as_me: failed program was:&quot; &gt;&amp;5
 sed 's/^/| /' conftest.$ac_ext &gt;&amp;5
 
-ac_header_compiler=no
+	ac_header_compiler=no
 fi
+
 rm -f conftest.err conftest.$ac_objext conftest.$ac_ext
-echo &quot;$as_me:$LINENO: result: $ac_header_compiler&quot; &gt;&amp;5
-echo &quot;${ECHO_T}$ac_header_compiler&quot; &gt;&amp;6
+{ echo &quot;$as_me:$LINENO: result: $ac_header_compiler&quot; &gt;&amp;5
+echo &quot;${ECHO_T}$ac_header_compiler&quot; &gt;&amp;6; }
 
 # Is the header present?
-echo &quot;$as_me:$LINENO: checking sql.h presence&quot; &gt;&amp;5
-echo $ECHO_N &quot;checking sql.h presence... $ECHO_C&quot; &gt;&amp;6
+{ echo &quot;$as_me:$LINENO: checking sql.h presence&quot; &gt;&amp;5
+echo $ECHO_N &quot;checking sql.h presence... $ECHO_C&quot; &gt;&amp;6; }
 cat &gt;conftest.$ac_ext &lt;&lt;_ACEOF
 /* confdefs.h.  */
 _ACEOF
@@ -7402,9 +8517,10 @@
 
   ac_header_preproc=no
 fi
+
 rm -f conftest.err conftest.$ac_ext
-echo &quot;$as_me:$LINENO: result: $ac_header_preproc&quot; &gt;&amp;5
-echo &quot;${ECHO_T}$ac_header_preproc&quot; &gt;&amp;6
+{ echo &quot;$as_me:$LINENO: result: $ac_header_preproc&quot; &gt;&amp;5
+echo &quot;${ECHO_T}$ac_header_preproc&quot; &gt;&amp;6; }
 
 # So?  What about this header?
 case $ac_header_compiler:$ac_header_preproc:$ac_c_preproc_warn_flag in
@@ -7428,25 +8544,18 @@
 echo &quot;$as_me: WARNING: sql.h: proceeding with the preprocessor's result&quot; &gt;&amp;2;}
     { echo &quot;$as_me:$LINENO: WARNING: sql.h: in the future, the compiler will take precedence&quot; &gt;&amp;5
 echo &quot;$as_me: WARNING: sql.h: in the future, the compiler will take precedence&quot; &gt;&amp;2;}
-    (
-      cat &lt;&lt;\_ASBOX
-## ------------------------------------------ ##
-## Report this to the AC_PACKAGE_NAME lists.  ##
-## ------------------------------------------ ##
-_ASBOX
-    ) |
-      sed &quot;s/^/$as_me: WARNING:     /&quot; &gt;&amp;2
+
     ;;
 esac
-echo &quot;$as_me:$LINENO: checking for sql.h&quot; &gt;&amp;5
-echo $ECHO_N &quot;checking for sql.h... $ECHO_C&quot; &gt;&amp;6
+{ echo &quot;$as_me:$LINENO: checking for sql.h&quot; &gt;&amp;5
+echo $ECHO_N &quot;checking for sql.h... $ECHO_C&quot; &gt;&amp;6; }
 if test &quot;${ac_cv_header_sql_h+set}&quot; = set; then
   echo $ECHO_N &quot;(cached) $ECHO_C&quot; &gt;&amp;6
 else
   ac_cv_header_sql_h=$ac_header_preproc
 fi
-echo &quot;$as_me:$LINENO: result: $ac_cv_header_sql_h&quot; &gt;&amp;5
-echo &quot;${ECHO_T}$ac_cv_header_sql_h&quot; &gt;&amp;6
+{ echo &quot;$as_me:$LINENO: result: $ac_cv_header_sql_h&quot; &gt;&amp;5
+echo &quot;${ECHO_T}$ac_cv_header_sql_h&quot; &gt;&amp;6; }
 
 fi
 if test $ac_cv_header_sql_h = yes; then
@@ -7459,7 +8568,7 @@
 	 fi
       fi
       if test &quot;x${UNIXODBC_HEADER_FOUND}&quot; = &quot;x0&quot; ; then
-         if test ! -z &quot;${odbc_MANDATORY}&quot; ;
+         if test ! -z &quot;${UNIXODBC_MANDATORY}&quot; ;
          then
             echo &quot; ***&quot;
             echo &quot; *** It appears that you do not have the odbc development package installed.&quot;
@@ -7467,18 +8576,18 @@
             echo &quot; *** without explicitly specifying --with-odbc&quot;
             exit 1
          fi
-         odbc_LIB=&quot;&quot;
-         odbc_INCLUDE=&quot;&quot;
-         PBX_LIBodbc=0
+         UNIXODBC_LIB=&quot;&quot;
+         UNIXODBC_INCLUDE=&quot;&quot;
+         PBX_LIBUNIXODBC=0
       else
-         PBX_LIBodbc=1
+         PBX_LIBUNIXODBC=1
 
 cat &gt;&gt;confdefs.h &lt;&lt;_ACEOF
 #define HAVE_UNIXODBC 1
 _ACEOF
 
       fi
-   elif test ! -z &quot;${odbc_MANDATORY}&quot;;
+   elif test ! -z &quot;${UNIXODBC_MANDATORY}&quot;;
    then
       echo &quot;***&quot;
       echo &quot;*** The unixODBC installation on this system appears to be broken.&quot;
@@ -7493,34 +8602,34 @@
 
 
 
-# Check whether --with-ogg or --without-ogg was given.
+# Check whether --with-ogg was given.
 if test &quot;${with_ogg+set}&quot; = set; then
-  withval=&quot;$with_ogg&quot;
-
+  withval=$with_ogg;
 case ${withval} in
      n|no)
-     USE_ogg=no
+     USE_OGG=no
      ;;
      y|ye|yes)
-     ogg_MANDATORY=&quot;yes&quot;
+     OGG_MANDATORY=&quot;yes&quot;
      ;;
      *)
-     ogg_DIR=&quot;${withval}&quot;
-     ogg_MANDATORY=&quot;yes&quot;
+     OGG_DIR=&quot;${withval}&quot;
+     OGG_MANDATORY=&quot;yes&quot;
      ;;
 esac
 
-fi;
+fi
 
-PBX_LIBogg=0
 
-if test &quot;${USE_ogg}&quot; != &quot;no&quot;; then
+PBX_LIBOGG=0
+
+if test &quot;${USE_OGG}&quot; != &quot;no&quot;; then
    pbxlibdir=&quot;&quot;
-   if test &quot;x${ogg_DIR}&quot; != &quot;x&quot;; then
+   if test &quot;x${OGG_DIR}&quot; != &quot;x&quot;; then
       pbxlibdir=&quot;-L${ogg_DIR}/lib&quot;
    fi
-   echo &quot;$as_me:$LINENO: checking for ogg_sync_init in -logg&quot; &gt;&amp;5
-echo $ECHO_N &quot;checking for ogg_sync_init in -logg... $ECHO_C&quot; &gt;&amp;6
+   { echo &quot;$as_me:$LINENO: checking for ogg_sync_init in -logg&quot; &gt;&amp;5
+echo $ECHO_N &quot;checking for ogg_sync_init in -logg... $ECHO_C&quot; &gt;&amp;6; }
 if test &quot;${ac_cv_lib_ogg_ogg_sync_init+set}&quot; = set; then
   echo $ECHO_N &quot;(cached) $ECHO_C&quot; &gt;&amp;6
 else
@@ -7533,17 +8642,17 @@
 cat &gt;&gt;conftest.$ac_ext &lt;&lt;_ACEOF
 /* end confdefs.h.  */
 
-/* Override any gcc2 internal prototype to avoid an error.  */
+/* Override any GCC internal prototype to avoid an error.
+   Use char because int might match the return type of a GCC
+   builtin and then its argument prototype would still apply.  */
 #ifdef __cplusplus
 extern &quot;C&quot;
 #endif
-/* We use char because int might match the return type of a gcc2
-   builtin and then its argument prototype would still apply.  */
 char ogg_sync_init ();
 int
 main ()
 {
-ogg_sync_init ();
+return ogg_sync_init ();
   ;
   return 0;
 }
@@ -7575,39 +8684,43 @@
   echo &quot;$as_me: failed program was:&quot; &gt;&amp;5
 sed 's/^/| /' conftest.$ac_ext &gt;&amp;5
 
-ac_cv_lib_ogg_ogg_sync_init=no
+	ac_cv_lib_ogg_ogg_sync_init=no
 fi
+
 rm -f conftest.err conftest.$ac_objext \
       conftest$ac_exeext conftest.$ac_ext
 LIBS=$ac_check_lib_save_LIBS
 fi
-echo &quot;$as_me:$LINENO: result: $ac_cv_lib_ogg_ogg_sync_init&quot; &gt;&amp;5
-echo &quot;${ECHO_T}$ac_cv_lib_ogg_ogg_sync_init&quot; &gt;&amp;6
+{ echo &quot;$as_me:$LINENO: result: $ac_cv_lib_ogg_ogg_sync_init&quot; &gt;&amp;5
+echo &quot;${ECHO_T}$ac_cv_lib_ogg_ogg_sync_init&quot; &gt;&amp;6; }
 if test $ac_cv_lib_ogg_ogg_sync_init = yes; then
-  :
+  AST_OGG_FOUND=yes
+else
+  AST_OGG_FOUND=no
 fi
 
 
-   if test &quot;${ac_cv_lib_ogg_ogg_sync_init}&quot; = &quot;yes&quot;; then
-      ogg_LIB=&quot;-logg &quot;
+   if test &quot;${AST_OGG_FOUND}&quot; = &quot;yes&quot;; then
+      OGG_LIB=&quot;-logg &quot;
       OGG_HEADER_FOUND=&quot;1&quot;
-      if test &quot;x${ogg_DIR}&quot; != &quot;x&quot;; then
-         ogg_LIB=&quot;${pbxlibdir} ${ogg_LIB}&quot;
-	 ogg_INCLUDE=&quot;-I${ogg_DIR}/include&quot;
+      if test &quot;x${OGG_DIR}&quot; != &quot;x&quot;; then
+         OGG_LIB=&quot;${pbxlibdir} ${OGG_LIB}&quot;
+	 OGG_INCLUDE=&quot;-I${OGG_DIR}/include&quot;
 	 if test &quot;x&quot; != &quot;x&quot; ; then
-	    as_ac_Header=`echo &quot;ac_cv_header_${ogg_DIR}/include/&quot; | $as_tr_sh`
-if eval &quot;test \&quot;\${$as_ac_Header+set}\&quot; = set&quot;; then
-  echo &quot;$as_me:$LINENO: checking for ${ogg_DIR}/include/&quot; &gt;&amp;5
-echo $ECHO_N &quot;checking for ${ogg_DIR}/include/... $ECHO_C&quot; &gt;&amp;6
-if eval &quot;test \&quot;\${$as_ac_Header+set}\&quot; = set&quot;; then
+	    as_ac_Header=`echo &quot;ac_cv_header_${OGG_DIR}/include/&quot; | $as_tr_sh`
+if { as_var=$as_ac_Header; eval &quot;test \&quot;\${$as_var+set}\&quot; = set&quot;; }; then
+  { echo &quot;$as_me:$LINENO: checking for ${OGG_DIR}/include/&quot; &gt;&amp;5
+echo $ECHO_N &quot;checking for ${OGG_DIR}/include/... $ECHO_C&quot; &gt;&amp;6; }
+if { as_var=$as_ac_Header; eval &quot;test \&quot;\${$as_var+set}\&quot; = set&quot;; }; then
   echo $ECHO_N &quot;(cached) $ECHO_C&quot; &gt;&amp;6
 fi
-echo &quot;$as_me:$LINENO: result: `eval echo '${'$as_ac_Header'}'`&quot; &gt;&amp;5
-echo &quot;${ECHO_T}`eval echo '${'$as_ac_Header'}'`&quot; &gt;&amp;6
+ac_res=`eval echo '${'$as_ac_Header'}'`
+	       { echo &quot;$as_me:$LINENO: result: $ac_res&quot; &gt;&amp;5
+echo &quot;${ECHO_T}$ac_res&quot; &gt;&amp;6; }
 else
   # Is the header compilable?
-echo &quot;$as_me:$LINENO: checking ${ogg_DIR}/include/ usability&quot; &gt;&amp;5
-echo $ECHO_N &quot;checking ${ogg_DIR}/include/ usability... $ECHO_C&quot; &gt;&amp;6
+{ echo &quot;$as_me:$LINENO: checking ${OGG_DIR}/include/ usability&quot; &gt;&amp;5
+echo $ECHO_N &quot;checking ${OGG_DIR}/include/ usability... $ECHO_C&quot; &gt;&amp;6; }
 cat &gt;conftest.$ac_ext &lt;&lt;_ACEOF
 /* confdefs.h.  */
 _ACEOF
@@ -7615,7 +8728,7 @@
 cat &gt;&gt;conftest.$ac_ext &lt;&lt;_ACEOF
 /* end confdefs.h.  */
 $ac_includes_default
-#include &lt;${ogg_DIR}/include/&gt;
+#include &lt;${OGG_DIR}/include/&gt;
 _ACEOF
 rm -f conftest.$ac_objext
 if { (eval echo &quot;$as_me:$LINENO: \&quot;$ac_compile\&quot;&quot;) &gt;&amp;5
@@ -7644,22 +8757,23 @@
   echo &quot;$as_me: failed program was:&quot; &gt;&amp;5
 sed 's/^/| /' conftest.$ac_ext &gt;&amp;5
 
-ac_header_compiler=no
+	ac_header_compiler=no
 fi
+
 rm -f conftest.err conftest.$ac_objext conftest.$ac_ext
-echo &quot;$as_me:$LINENO: result: $ac_header_compiler&quot; &gt;&amp;5
-echo &quot;${ECHO_T}$ac_header_compiler&quot; &gt;&amp;6
+{ echo &quot;$as_me:$LINENO: result: $ac_header_compiler&quot; &gt;&amp;5
+echo &quot;${ECHO_T}$ac_header_compiler&quot; &gt;&amp;6; }
 
 # Is the header present?
-echo &quot;$as_me:$LINENO: checking ${ogg_DIR}/include/ presence&quot; &gt;&amp;5
-echo $ECHO_N &quot;checking ${ogg_DIR}/include/ presence... $ECHO_C&quot; &gt;&amp;6
+{ echo &quot;$as_me:$LINENO: checking ${OGG_DIR}/include/ presence&quot; &gt;&amp;5
+echo $ECHO_N &quot;checking ${OGG_DIR}/include/ presence... $ECHO_C&quot; &gt;&amp;6; }
 cat &gt;conftest.$ac_ext &lt;&lt;_ACEOF
 /* confdefs.h.  */
 _ACEOF
 cat confdefs.h &gt;&gt;conftest.$ac_ext
 cat &gt;&gt;conftest.$ac_ext &lt;&lt;_ACEOF
 /* end confdefs.h.  */
-#include &lt;${ogg_DIR}/include/&gt;
+#include &lt;${OGG_DIR}/include/&gt;
 _ACEOF
 if { (eval echo &quot;$as_me:$LINENO: \&quot;$ac_cpp conftest.$ac_ext\&quot;&quot;) &gt;&amp;5
   (eval $ac_cpp conftest.$ac_ext) 2&gt;conftest.er1
@@ -7686,51 +8800,46 @@
 
   ac_header_preproc=no
 fi
+
 rm -f conftest.err conftest.$ac_ext
-echo &quot;$as_me:$LINENO: result: $ac_header_preproc&quot; &gt;&amp;5
-echo &quot;${ECHO_T}$ac_header_preproc&quot; &gt;&amp;6
+{ echo &quot;$as_me:$LINENO: result: $ac_header_preproc&quot; &gt;&amp;5
+echo &quot;${ECHO_T}$ac_header_preproc&quot; &gt;&amp;6; }
 
 # So?  What about this header?
 case $ac_header_compiler:$ac_header_preproc:$ac_c_preproc_warn_flag in
   yes:no: )
-    { echo &quot;$as_me:$LINENO: WARNING: ${ogg_DIR}/include/: accepted by the compiler, rejected by the preprocessor!&quot; &gt;&amp;5
-echo &quot;$as_me: WARNING: ${ogg_DIR}/include/: accepted by the compiler, rejected by the preprocessor!&quot; &gt;&amp;2;}
-    { echo &quot;$as_me:$LINENO: WARNING: ${ogg_DIR}/include/: proceeding with the compiler's result&quot; &gt;&amp;5
-echo &quot;$as_me: WARNING: ${ogg_DIR}/include/: proceeding with the compiler's result&quot; &gt;&amp;2;}
+    { echo &quot;$as_me:$LINENO: WARNING: ${OGG_DIR}/include/: accepted by the compiler, rejected by the preprocessor!&quot; &gt;&amp;5
+echo &quot;$as_me: WARNING: ${OGG_DIR}/include/: accepted by the compiler, rejected by the preprocessor!&quot; &gt;&amp;2;}
+    { echo &quot;$as_me:$LINENO: WARNING: ${OGG_DIR}/include/: proceeding with the compiler's result&quot; &gt;&amp;5
+echo &quot;$as_me: WARNING: ${OGG_DIR}/include/: proceeding with the compiler's result&quot; &gt;&amp;2;}
     ac_header_preproc=yes
     ;;
   no:yes:* )
-    { echo &quot;$as_me:$LINENO: WARNING: ${ogg_DIR}/include/: present but cannot be compiled&quot; &gt;&amp;5
-echo &quot;$as_me: WARNING: ${ogg_DIR}/include/: present but cannot be compiled&quot; &gt;&amp;2;}
-    { echo &quot;$as_me:$LINENO: WARNING: ${ogg_DIR}/include/:     check for missing prerequisite headers?&quot; &gt;&amp;5
-echo &quot;$as_me: WARNING: ${ogg_DIR}/include/:     check for missing prerequisite headers?&quot; &gt;&amp;2;}
-    { echo &quot;$as_me:$LINENO: WARNING: ${ogg_DIR}/include/: see the Autoconf documentation&quot; &gt;&amp;5
-echo &quot;$as_me: WARNING: ${ogg_DIR}/include/: see the Autoconf documentation&quot; &gt;&amp;2;}
-    { echo &quot;$as_me:$LINENO: WARNING: ${ogg_DIR}/include/:     section \&quot;Present But Cannot Be Compiled\&quot;&quot; &gt;&amp;5
-echo &quot;$as_me: WARNING: ${ogg_DIR}/include/:     section \&quot;Present But Cannot Be Compiled\&quot;&quot; &gt;&amp;2;}
-    { echo &quot;$as_me:$LINENO: WARNING: ${ogg_DIR}/include/: proceeding with the preprocessor's result&quot; &gt;&amp;5
-echo &quot;$as_me: WARNING: ${ogg_DIR}/include/: proceeding with the preprocessor's result&quot; &gt;&amp;2;}
-    { echo &quot;$as_me:$LINENO: WARNING: ${ogg_DIR}/include/: in the future, the compiler will take precedence&quot; &gt;&amp;5
-echo &quot;$as_me: WARNING: ${ogg_DIR}/include/: in the future, the compiler will take precedence&quot; &gt;&amp;2;}
-    (
-      cat &lt;&lt;\_ASBOX
-## ------------------------------------------ ##
-## Report this to the AC_PACKAGE_NAME lists.  ##
-## ------------------------------------------ ##
-_ASBOX
-    ) |
-      sed &quot;s/^/$as_me: WARNING:     /&quot; &gt;&amp;2
+    { echo &quot;$as_me:$LINENO: WARNING: ${OGG_DIR}/include/: present but cannot be compiled&quot; &gt;&amp;5
+echo &quot;$as_me: WARNING: ${OGG_DIR}/include/: present but cannot be compiled&quot; &gt;&amp;2;}
+    { echo &quot;$as_me:$LINENO: WARNING: ${OGG_DIR}/include/:     check for missing prerequisite headers?&quot; &gt;&amp;5
+echo &quot;$as_me: WARNING: ${OGG_DIR}/include/:     check for missing prerequisite headers?&quot; &gt;&amp;2;}
+    { echo &quot;$as_me:$LINENO: WARNING: ${OGG_DIR}/include/: see the Autoconf documentation&quot; &gt;&amp;5
+echo &quot;$as_me: WARNING: ${OGG_DIR}/include/: see the Autoconf documentation&quot; &gt;&amp;2;}
+    { echo &quot;$as_me:$LINENO: WARNING: ${OGG_DIR}/include/:     section \&quot;Present But Cannot Be Compiled\&quot;&quot; &gt;&amp;5
+echo &quot;$as_me: WARNING: ${OGG_DIR}/include/:     section \&quot;Present But Cannot Be Compiled\&quot;&quot; &gt;&amp;2;}
+    { echo &quot;$as_me:$LINENO: WARNING: ${OGG_DIR}/include/: proceeding with the preprocessor's result&quot; &gt;&amp;5
+echo &quot;$as_me: WARNING: ${OGG_DIR}/include/: proceeding with the preprocessor's result&quot; &gt;&amp;2;}
+    { echo &quot;$as_me:$LINENO: WARNING: ${OGG_DIR}/include/: in the future, the compiler will take precedence&quot; &gt;&amp;5
+echo &quot;$as_me: WARNING: ${OGG_DIR}/include/: in the future, the compiler will take precedence&quot; &gt;&amp;2;}
+
     ;;
 esac
-echo &quot;$as_me:$LINENO: checking for ${ogg_DIR}/include/&quot; &gt;&amp;5
-echo $ECHO_N &quot;checking for ${ogg_DIR}/include/... $ECHO_C&quot; &gt;&amp;6
-if eval &quot;test \&quot;\${$as_ac_Header+set}\&quot; = set&quot;; then
+{ echo &quot;$as_me:$LINENO: checking for ${OGG_DIR}/include/&quot; &gt;&amp;5
+echo $ECHO_N &quot;checking for ${OGG_DIR}/include/... $ECHO_C&quot; &gt;&amp;6; }
+if { as_var=$as_ac_Header; eval &quot;test \&quot;\${$as_var+set}\&quot; = set&quot;; }; then
   echo $ECHO_N &quot;(cached) $ECHO_C&quot; &gt;&amp;6
 else
   eval &quot;$as_ac_Header=\$ac_header_preproc&quot;
 fi
-echo &quot;$as_me:$LINENO: result: `eval echo '${'$as_ac_Header'}'`&quot; &gt;&amp;5
-echo &quot;${ECHO_T}`eval echo '${'$as_ac_Header'}'`&quot; &gt;&amp;6
+ac_res=`eval echo '${'$as_ac_Header'}'`
+	       { echo &quot;$as_me:$LINENO: result: $ac_res&quot; &gt;&amp;5
+echo &quot;${ECHO_T}$ac_res&quot; &gt;&amp;6; }
 
 fi
 if test `eval echo '${'$as_ac_Header'}'` = yes; then
@@ -7744,17 +8853,17 @@
       else
 	 if test &quot;x&quot; != &quot;x&quot; ; then
             if test &quot;${ac_cv_header_+set}&quot; = set; then
-  echo &quot;$as_me:$LINENO: checking for &quot; &gt;&amp;5
-echo $ECHO_N &quot;checking for ... $ECHO_C&quot; &gt;&amp;6
+  { echo &quot;$as_me:$LINENO: checking for &quot; &gt;&amp;5
+echo $ECHO_N &quot;checking for ... $ECHO_C&quot; &gt;&amp;6; }
 if test &quot;${ac_cv_header_+set}&quot; = set; then
   echo $ECHO_N &quot;(cached) $ECHO_C&quot; &gt;&amp;6
 fi
-echo &quot;$as_me:$LINENO: result: $ac_cv_header_&quot; &gt;&amp;5
-echo &quot;${ECHO_T}$ac_cv_header_&quot; &gt;&amp;6
+{ echo &quot;$as_me:$LINENO: result: $ac_cv_header_&quot; &gt;&amp;5
+echo &quot;${ECHO_T}$ac_cv_header_&quot; &gt;&amp;6; }
 else
   # Is the header compilable?
-echo &quot;$as_me:$LINENO: checking  usability&quot; &gt;&amp;5
-echo $ECHO_N &quot;checking  usability... $ECHO_C&quot; &gt;&amp;6
+{ echo &quot;$as_me:$LINENO: checking  usability&quot; &gt;&amp;5
+echo $ECHO_N &quot;checking  usability... $ECHO_C&quot; &gt;&amp;6; }
 cat &gt;conftest.$ac_ext &lt;&lt;_ACEOF
 /* confdefs.h.  */
 _ACEOF
@@ -7791,15 +8900,16 @@
   echo &quot;$as_me: failed program was:&quot; &gt;&amp;5
 sed 's/^/| /' conftest.$ac_ext &gt;&amp;5
 
-ac_header_compiler=no
+	ac_header_compiler=no
 fi
+
 rm -f conftest.err conftest.$ac_objext conftest.$ac_ext
-echo &quot;$as_me:$LINENO: result: $ac_header_compiler&quot; &gt;&amp;5
-echo &quot;${ECHO_T}$ac_header_compiler&quot; &gt;&amp;6
+{ echo &quot;$as_me:$LINENO: result: $ac_header_compiler&quot; &gt;&amp;5
+echo &quot;${ECHO_T}$ac_header_compiler&quot; &gt;&amp;6; }
 
 # Is the header present?
-echo &quot;$as_me:$LINENO: checking  presence&quot; &gt;&amp;5
-echo $ECHO_N &quot;checking  presence... $ECHO_C&quot; &gt;&amp;6
+{ echo &quot;$as_me:$LINENO: checking  presence&quot; &gt;&amp;5
+echo $ECHO_N &quot;checking  presence... $ECHO_C&quot; &gt;&amp;6; }
 cat &gt;conftest.$ac_ext &lt;&lt;_ACEOF
 /* confdefs.h.  */
 _ACEOF
@@ -7833,9 +8943,10 @@
 
   ac_header_preproc=no
 fi
+
 rm -f conftest.err conftest.$ac_ext
-echo &quot;$as_me:$LINENO: result: $ac_header_preproc&quot; &gt;&amp;5
-echo &quot;${ECHO_T}$ac_header_preproc&quot; &gt;&amp;6
+{ echo &quot;$as_me:$LINENO: result: $ac_header_preproc&quot; &gt;&amp;5
+echo &quot;${ECHO_T}$ac_header_preproc&quot; &gt;&amp;6; }
 
 # So?  What about this header?
 case $ac_header_compiler:$ac_header_preproc:$ac_c_preproc_warn_flag in
@@ -7859,25 +8970,18 @@
 echo &quot;$as_me: WARNING: : proceeding with the preprocessor's result&quot; &gt;&amp;2;}
     { echo &quot;$as_me:$LINENO: WARNING: : in the future, the compiler will take precedence&quot; &gt;&amp;5
 echo &quot;$as_me: WARNING: : in the future, the compiler will take precedence&quot; &gt;&amp;2;}
-    (
-      cat &lt;&lt;\_ASBOX
-## ------------------------------------------ ##
-## Report this to the AC_PACKAGE_NAME lists.  ##
-## ------------------------------------------ ##
-_ASBOX
-    ) |
-      sed &quot;s/^/$as_me: WARNING:     /&quot; &gt;&amp;2
+
     ;;
 esac
-echo &quot;$as_me:$LINENO: checking for &quot; &gt;&amp;5
-echo $ECHO_N &quot;checking for ... $ECHO_C&quot; &gt;&amp;6
+{ echo &quot;$as_me:$LINENO: checking for &quot; &gt;&amp;5
+echo $ECHO_N &quot;checking for ... $ECHO_C&quot; &gt;&amp;6; }
 if test &quot;${ac_cv_header_+set}&quot; = set; then
   echo $ECHO_N &quot;(cached) $ECHO_C&quot; &gt;&amp;6
 else
   ac_cv_header_=$ac_header_preproc
 fi
-echo &quot;$as_me:$LINENO: result: $ac_cv_header_&quot; &gt;&amp;5
-echo &quot;${ECHO_T}$ac_cv_header_&quot; &gt;&amp;6
+{ echo &quot;$as_me:$LINENO: result: $ac_cv_header_&quot; &gt;&amp;5
+echo &quot;${ECHO_T}$ac_cv_header_&quot; &gt;&amp;6; }
 
 fi
 if test $ac_cv_header_ = yes; then
@@ -7890,7 +8994,7 @@
 	 fi
       fi
       if test &quot;x${OGG_HEADER_FOUND}&quot; = &quot;x0&quot; ; then
-         if test ! -z &quot;${ogg_MANDATORY}&quot; ;
+         if test ! -z &quot;${OGG_MANDATORY}&quot; ;
          then
             echo &quot; ***&quot;
             echo &quot; *** It appears that you do not have the ogg development package installed.&quot;
@@ -7898,18 +9002,18 @@
             echo &quot; *** without explicitly specifying --with-ogg&quot;
             exit 1
          fi
-         ogg_LIB=&quot;&quot;
-         ogg_INCLUDE=&quot;&quot;
-         PBX_LIBogg=0
+         OGG_LIB=&quot;&quot;
+         OGG_INCLUDE=&quot;&quot;
+         PBX_LIBOGG=0
       else
-         PBX_LIBogg=1
+         PBX_LIBOGG=1
 
 cat &gt;&gt;confdefs.h &lt;&lt;_ACEOF
 #define HAVE_OGG 1
 _ACEOF
 
       fi
-   elif test ! -z &quot;${ogg_MANDATORY}&quot;;
+   elif test ! -z &quot;${OGG_MANDATORY}&quot;;
    then
       echo &quot;***&quot;
       echo &quot;*** The OGG installation on this system appears to be broken.&quot;
@@ -7924,34 +9028,34 @@
 
 
 
-# Check whether --with-osptk or --without-osptk was given.
+# Check whether --with-osptk was given.
 if test &quot;${with_osptk+set}&quot; = set; then
-  withval=&quot;$with_osptk&quot;
-
+  withval=$with_osptk;
 case ${withval} in
      n|no)
-     USE_osptk=no
+     USE_OSPTK=no
      ;;
      y|ye|yes)
-     osptk_MANDATORY=&quot;yes&quot;
+     OSPTK_MANDATORY=&quot;yes&quot;
      ;;
      *)
-     osptk_DIR=&quot;${withval}&quot;
-     osptk_MANDATORY=&quot;yes&quot;
+     OSPTK_DIR=&quot;${withval}&quot;
+     OSPTK_MANDATORY=&quot;yes&quot;
      ;;
 esac
 
-fi;
+fi
 
-PBX_LIBosptk=0
 
-if test &quot;${USE_osptk}&quot; != &quot;no&quot;; then
+PBX_LIBOSPTK=0
+
+if test &quot;${USE_OSPTK}&quot; != &quot;no&quot;; then
    pbxlibdir=&quot;&quot;
-   if test &quot;x${osptk_DIR}&quot; != &quot;x&quot;; then
+   if test &quot;x${OSPTK_DIR}&quot; != &quot;x&quot;; then
       pbxlibdir=&quot;-L${osptk_DIR}/lib&quot;
    fi
-   echo &quot;$as_me:$LINENO: checking for OSPPCryptoDecrypt in -losptk&quot; &gt;&amp;5
-echo $ECHO_N &quot;checking for OSPPCryptoDecrypt in -losptk... $ECHO_C&quot; &gt;&amp;6
+   { echo &quot;$as_me:$LINENO: checking for OSPPCryptoDecrypt in -losptk&quot; &gt;&amp;5
+echo $ECHO_N &quot;checking for OSPPCryptoDecrypt in -losptk... $ECHO_C&quot; &gt;&amp;6; }
 if test &quot;${ac_cv_lib_osptk_OSPPCryptoDecrypt+set}&quot; = set; then
   echo $ECHO_N &quot;(cached) $ECHO_C&quot; &gt;&amp;6
 else
@@ -7964,17 +9068,17 @@
 cat &gt;&gt;conftest.$ac_ext &lt;&lt;_ACEOF
 /* end confdefs.h.  */
 
-/* Override any gcc2 internal prototype to avoid an error.  */
+/* Override any GCC internal prototype to avoid an error.
+   Use char because int might match the return type of a GCC
+   builtin and then its argument prototype would still apply.  */
 #ifdef __cplusplus
 extern &quot;C&quot;
 #endif
-/* We use char because int might match the return type of a gcc2
-   builtin and then its argument prototype would still apply.  */
 char OSPPCryptoDecrypt ();
 int
 main ()
 {
-OSPPCryptoDecrypt ();
+return OSPPCryptoDecrypt ();
   ;
   return 0;
 }
@@ -8006,39 +9110,43 @@
   echo &quot;$as_me: failed program was:&quot; &gt;&amp;5
 sed 's/^/| /' conftest.$ac_ext &gt;&amp;5
 
-ac_cv_lib_osptk_OSPPCryptoDecrypt=no
+	ac_cv_lib_osptk_OSPPCryptoDecrypt=no
 fi
+
 rm -f conftest.err conftest.$ac_objext \
       conftest$ac_exeext conftest.$ac_ext
 LIBS=$ac_check_lib_save_LIBS
 fi
-echo &quot;$as_me:$LINENO: result: $ac_cv_lib_osptk_OSPPCryptoDecrypt&quot; &gt;&amp;5
-echo &quot;${ECHO_T}$ac_cv_lib_osptk_OSPPCryptoDecrypt&quot; &gt;&amp;6
+{ echo &quot;$as_me:$LINENO: result: $ac_cv_lib_osptk_OSPPCryptoDecrypt&quot; &gt;&amp;5
+echo &quot;${ECHO_T}$ac_cv_lib_osptk_OSPPCryptoDecrypt&quot; &gt;&amp;6; }
 if test $ac_cv_lib_osptk_OSPPCryptoDecrypt = yes; then
-  :
+  AST_OSPTK_FOUND=yes
+else
+  AST_OSPTK_FOUND=no
 fi
 
 
-   if test &quot;${ac_cv_lib_osptk_OSPPCryptoDecrypt}&quot; = &quot;yes&quot;; then
-      osptk_LIB=&quot;-losptk -lcrypto -lssl&quot;
+   if test &quot;${AST_OSPTK_FOUND}&quot; = &quot;yes&quot;; then
+      OSPTK_LIB=&quot;-losptk -lcrypto -lssl&quot;
       OSPTK_HEADER_FOUND=&quot;1&quot;
-      if test &quot;x${osptk_DIR}&quot; != &quot;x&quot;; then
-         osptk_LIB=&quot;${pbxlibdir} ${osptk_LIB}&quot;
-	 osptk_INCLUDE=&quot;-I${osptk_DIR}/include&quot;
+      if test &quot;x${OSPTK_DIR}&quot; != &quot;x&quot;; then
+         OSPTK_LIB=&quot;${pbxlibdir} ${OSPTK_LIB}&quot;
+	 OSPTK_INCLUDE=&quot;-I${OSPTK_DIR}/include&quot;
 	 if test &quot;xosp/osp.h&quot; != &quot;x&quot; ; then
-	    as_ac_Header=`echo &quot;ac_cv_header_${osptk_DIR}/include/osp/osp.h&quot; | $as_tr_sh`
-if eval &quot;test \&quot;\${$as_ac_Header+set}\&quot; = set&quot;; then
-  echo &quot;$as_me:$LINENO: checking for ${osptk_DIR}/include/osp/osp.h&quot; &gt;&amp;5
-echo $ECHO_N &quot;checking for ${osptk_DIR}/include/osp/osp.h... $ECHO_C&quot; &gt;&amp;6
-if eval &quot;test \&quot;\${$as_ac_Header+set}\&quot; = set&quot;; then
+	    as_ac_Header=`echo &quot;ac_cv_header_${OSPTK_DIR}/include/osp/osp.h&quot; | $as_tr_sh`
+if { as_var=$as_ac_Header; eval &quot;test \&quot;\${$as_var+set}\&quot; = set&quot;; }; then
+  { echo &quot;$as_me:$LINENO: checking for ${OSPTK_DIR}/include/osp/osp.h&quot; &gt;&amp;5
+echo $ECHO_N &quot;checking for ${OSPTK_DIR}/include/osp/osp.h... $ECHO_C&quot; &gt;&amp;6; }
+if { as_var=$as_ac_Header; eval &quot;test \&quot;\${$as_var+set}\&quot; = set&quot;; }; then
   echo $ECHO_N &quot;(cached) $ECHO_C&quot; &gt;&amp;6
 fi
-echo &quot;$as_me:$LINENO: result: `eval echo '${'$as_ac_Header'}'`&quot; &gt;&amp;5
-echo &quot;${ECHO_T}`eval echo '${'$as_ac_Header'}'`&quot; &gt;&amp;6
+ac_res=`eval echo '${'$as_ac_Header'}'`
+	       { echo &quot;$as_me:$LINENO: result: $ac_res&quot; &gt;&amp;5
+echo &quot;${ECHO_T}$ac_res&quot; &gt;&amp;6; }
 else
   # Is the header compilable?
-echo &quot;$as_me:$LINENO: checking ${osptk_DIR}/include/osp/osp.h usability&quot; &gt;&amp;5
-echo $ECHO_N &quot;checking ${osptk_DIR}/include/osp/osp.h usability... $ECHO_C&quot; &gt;&amp;6
+{ echo &quot;$as_me:$LINENO: checking ${OSPTK_DIR}/include/osp/osp.h usability&quot; &gt;&amp;5
+echo $ECHO_N &quot;checking ${OSPTK_DIR}/include/osp/osp.h usability... $ECHO_C&quot; &gt;&amp;6; }
 cat &gt;conftest.$ac_ext &lt;&lt;_ACEOF
 /* confdefs.h.  */
 _ACEOF
@@ -8046,7 +9154,7 @@
 cat &gt;&gt;conftest.$ac_ext &lt;&lt;_ACEOF
 /* end confdefs.h.  */
 $ac_includes_default
-#include &lt;${osptk_DIR}/include/osp/osp.h&gt;
+#include &lt;${OSPTK_DIR}/include/osp/osp.h&gt;
 _ACEOF
 rm -f conftest.$ac_objext
 if { (eval echo &quot;$as_me:$LINENO: \&quot;$ac_compile\&quot;&quot;) &gt;&amp;5
@@ -8075,22 +9183,23 @@
   echo &quot;$as_me: failed program was:&quot; &gt;&amp;5
 sed 's/^/| /' conftest.$ac_ext &gt;&amp;5
 
-ac_header_compiler=no
+	ac_header_compiler=no
 fi
+
 rm -f conftest.err conftest.$ac_objext conftest.$ac_ext
-echo &quot;$as_me:$LINENO: result: $ac_header_compiler&quot; &gt;&amp;5
-echo &quot;${ECHO_T}$ac_header_compiler&quot; &gt;&amp;6
+{ echo &quot;$as_me:$LINENO: result: $ac_header_compiler&quot; &gt;&amp;5
+echo &quot;${ECHO_T}$ac_header_compiler&quot; &gt;&amp;6; }
 
 # Is the header present?
-echo &quot;$as_me:$LINENO: checking ${osptk_DIR}/include/osp/osp.h presence&quot; &gt;&amp;5
-echo $ECHO_N &quot;checking ${osptk_DIR}/include/osp/osp.h presence... $ECHO_C&quot; &gt;&amp;6
+{ echo &quot;$as_me:$LINENO: checking ${OSPTK_DIR}/include/osp/osp.h presence&quot; &gt;&amp;5
+echo $ECHO_N &quot;checking ${OSPTK_DIR}/include/osp/osp.h presence... $ECHO_C&quot; &gt;&amp;6; }
 cat &gt;conftest.$ac_ext &lt;&lt;_ACEOF
 /* confdefs.h.  */
 _ACEOF
 cat confdefs.h &gt;&gt;conftest.$ac_ext
 cat &gt;&gt;conftest.$ac_ext &lt;&lt;_ACEOF
 /* end confdefs.h.  */
-#include &lt;${osptk_DIR}/include/osp/osp.h&gt;
+#include &lt;${OSPTK_DIR}/include/osp/osp.h&gt;
 _ACEOF
 if { (eval echo &quot;$as_me:$LINENO: \&quot;$ac_cpp conftest.$ac_ext\&quot;&quot;) &gt;&amp;5
   (eval $ac_cpp conftest.$ac_ext) 2&gt;conftest.er1
@@ -8117,51 +9226,46 @@
 
   ac_header_preproc=no
 fi
+
 rm -f conftest.err conftest.$ac_ext
-echo &quot;$as_me:$LINENO: result: $ac_header_preproc&quot; &gt;&amp;5
-echo &quot;${ECHO_T}$ac_header_preproc&quot; &gt;&amp;6
+{ echo &quot;$as_me:$LINENO: result: $ac_header_preproc&quot; &gt;&amp;5
+echo &quot;${ECHO_T}$ac_header_preproc&quot; &gt;&amp;6; }
 
 # So?  What about this header?
 case $ac_header_compiler:$ac_header_preproc:$ac_c_preproc_warn_flag in
   yes:no: )
-    { echo &quot;$as_me:$LINENO: WARNING: ${osptk_DIR}/include/osp/osp.h: accepted by the compiler, rejected by the preprocessor!&quot; &gt;&amp;5
-echo &quot;$as_me: WARNING: ${osptk_DIR}/include/osp/osp.h: accepted by the compiler, rejected by the preprocessor!&quot; &gt;&amp;2;}
-    { echo &quot;$as_me:$LINENO: WARNING: ${osptk_DIR}/include/osp/osp.h: proceeding with the compiler's result&quot; &gt;&amp;5
-echo &quot;$as_me: WARNING: ${osptk_DIR}/include/osp/osp.h: proceeding with the compiler's result&quot; &gt;&amp;2;}
+    { echo &quot;$as_me:$LINENO: WARNING: ${OSPTK_DIR}/include/osp/osp.h: accepted by the compiler, rejected by the preprocessor!&quot; &gt;&amp;5
+echo &quot;$as_me: WARNING: ${OSPTK_DIR}/include/osp/osp.h: accepted by the compiler, rejected by the preprocessor!&quot; &gt;&amp;2;}
+    { echo &quot;$as_me:$LINENO: WARNING: ${OSPTK_DIR}/include/osp/osp.h: proceeding with the compiler's result&quot; &gt;&amp;5
+echo &quot;$as_me: WARNING: ${OSPTK_DIR}/include/osp/osp.h: proceeding with the compiler's result&quot; &gt;&amp;2;}
     ac_header_preproc=yes
     ;;
   no:yes:* )
-    { echo &quot;$as_me:$LINENO: WARNING: ${osptk_DIR}/include/osp/osp.h: present but cannot be compiled&quot; &gt;&amp;5
-echo &quot;$as_me: WARNING: ${osptk_DIR}/include/osp/osp.h: present but cannot be compiled&quot; &gt;&amp;2;}
-    { echo &quot;$as_me:$LINENO: WARNING: ${osptk_DIR}/include/osp/osp.h:     check for missing prerequisite headers?&quot; &gt;&amp;5
-echo &quot;$as_me: WARNING: ${osptk_DIR}/include/osp/osp.h:     check for missing prerequisite headers?&quot; &gt;&amp;2;}
-    { echo &quot;$as_me:$LINENO: WARNING: ${osptk_DIR}/include/osp/osp.h: see the Autoconf documentation&quot; &gt;&amp;5
-echo &quot;$as_me: WARNING: ${osptk_DIR}/include/osp/osp.h: see the Autoconf documentation&quot; &gt;&amp;2;}
-    { echo &quot;$as_me:$LINENO: WARNING: ${osptk_DIR}/include/osp/osp.h:     section \&quot;Present But Cannot Be Compiled\&quot;&quot; &gt;&amp;5
-echo &quot;$as_me: WARNING: ${osptk_DIR}/include/osp/osp.h:     section \&quot;Present But Cannot Be Compiled\&quot;&quot; &gt;&amp;2;}
-    { echo &quot;$as_me:$LINENO: WARNING: ${osptk_DIR}/include/osp/osp.h: proceeding with the preprocessor's result&quot; &gt;&amp;5
-echo &quot;$as_me: WARNING: ${osptk_DIR}/include/osp/osp.h: proceeding with the preprocessor's result&quot; &gt;&amp;2;}
-    { echo &quot;$as_me:$LINENO: WARNING: ${osptk_DIR}/include/osp/osp.h: in the future, the compiler will take precedence&quot; &gt;&amp;5
-echo &quot;$as_me: WARNING: ${osptk_DIR}/include/osp/osp.h: in the future, the compiler will take precedence&quot; &gt;&amp;2;}
-    (
-      cat &lt;&lt;\_ASBOX
-## ------------------------------------------ ##
-## Report this to the AC_PACKAGE_NAME lists.  ##
-## ------------------------------------------ ##
-_ASBOX
-    ) |
-      sed &quot;s/^/$as_me: WARNING:     /&quot; &gt;&amp;2
+    { echo &quot;$as_me:$LINENO: WARNING: ${OSPTK_DIR}/include/osp/osp.h: present but cannot be compiled&quot; &gt;&amp;5
+echo &quot;$as_me: WARNING: ${OSPTK_DIR}/include/osp/osp.h: present but cannot be compiled&quot; &gt;&amp;2;}
+    { echo &quot;$as_me:$LINENO: WARNING: ${OSPTK_DIR}/include/osp/osp.h:     check for missing prerequisite headers?&quot; &gt;&amp;5
+echo &quot;$as_me: WARNING: ${OSPTK_DIR}/include/osp/osp.h:     check for missing prerequisite headers?&quot; &gt;&amp;2;}
+    { echo &quot;$as_me:$LINENO: WARNING: ${OSPTK_DIR}/include/osp/osp.h: see the Autoconf documentation&quot; &gt;&amp;5
+echo &quot;$as_me: WARNING: ${OSPTK_DIR}/include/osp/osp.h: see the Autoconf documentation&quot; &gt;&amp;2;}
+    { echo &quot;$as_me:$LINENO: WARNING: ${OSPTK_DIR}/include/osp/osp.h:     section \&quot;Present But Cannot Be Compiled\&quot;&quot; &gt;&amp;5
+echo &quot;$as_me: WARNING: ${OSPTK_DIR}/include/osp/osp.h:     section \&quot;Present But Cannot Be Compiled\&quot;&quot; &gt;&amp;2;}
+    { echo &quot;$as_me:$LINENO: WARNING: ${OSPTK_DIR}/include/osp/osp.h: proceeding with the preprocessor's result&quot; &gt;&amp;5
+echo &quot;$as_me: WARNING: ${OSPTK_DIR}/include/osp/osp.h: proceeding with the preprocessor's result&quot; &gt;&amp;2;}
+    { echo &quot;$as_me:$LINENO: WARNING: ${OSPTK_DIR}/include/osp/osp.h: in the future, the compiler will take precedence&quot; &gt;&amp;5
+echo &quot;$as_me: WARNING: ${OSPTK_DIR}/include/osp/osp.h: in the future, the compiler will take precedence&quot; &gt;&amp;2;}
+
     ;;
 esac
-echo &quot;$as_me:$LINENO: checking for ${osptk_DIR}/include/osp/osp.h&quot; &gt;&amp;5
-echo $ECHO_N &quot;checking for ${osptk_DIR}/include/osp/osp.h... $ECHO_C&quot; &gt;&amp;6
-if eval &quot;test \&quot;\${$as_ac_Header+set}\&quot; = set&quot;; then
+{ echo &quot;$as_me:$LINENO: checking for ${OSPTK_DIR}/include/osp/osp.h&quot; &gt;&amp;5
+echo $ECHO_N &quot;checking for ${OSPTK_DIR}/include/osp/osp.h... $ECHO_C&quot; &gt;&amp;6; }
+if { as_var=$as_ac_Header; eval &quot;test \&quot;\${$as_var+set}\&quot; = set&quot;; }; then
   echo $ECHO_N &quot;(cached) $ECHO_C&quot; &gt;&amp;6
 else
   eval &quot;$as_ac_Header=\$ac_header_preproc&quot;
 fi
-echo &quot;$as_me:$LINENO: result: `eval echo '${'$as_ac_Header'}'`&quot; &gt;&amp;5
-echo &quot;${ECHO_T}`eval echo '${'$as_ac_Header'}'`&quot; &gt;&amp;6
+ac_res=`eval echo '${'$as_ac_Header'}'`
+	       { echo &quot;$as_me:$LINENO: result: $ac_res&quot; &gt;&amp;5
+echo &quot;${ECHO_T}$ac_res&quot; &gt;&amp;6; }
 
 fi
 if test `eval echo '${'$as_ac_Header'}'` = yes; then
@@ -8175,17 +9279,17 @@
       else
 	 if test &quot;xosp/osp.h&quot; != &quot;x&quot; ; then
             if test &quot;${ac_cv_header_osp_osp_h+set}&quot; = set; then
-  echo &quot;$as_me:$LINENO: checking for osp/osp.h&quot; &gt;&amp;5
-echo $ECHO_N &quot;checking for osp/osp.h... $ECHO_C&quot; &gt;&amp;6
+  { echo &quot;$as_me:$LINENO: checking for osp/osp.h&quot; &gt;&amp;5
+echo $ECHO_N &quot;checking for osp/osp.h... $ECHO_C&quot; &gt;&amp;6; }
 if test &quot;${ac_cv_header_osp_osp_h+set}&quot; = set; then
   echo $ECHO_N &quot;(cached) $ECHO_C&quot; &gt;&amp;6
 fi
-echo &quot;$as_me:$LINENO: result: $ac_cv_header_osp_osp_h&quot; &gt;&amp;5
-echo &quot;${ECHO_T}$ac_cv_header_osp_osp_h&quot; &gt;&amp;6
+{ echo &quot;$as_me:$LINENO: result: $ac_cv_header_osp_osp_h&quot; &gt;&amp;5
+echo &quot;${ECHO_T}$ac_cv_header_osp_osp_h&quot; &gt;&amp;6; }
 else
   # Is the header compilable?
-echo &quot;$as_me:$LINENO: checking osp/osp.h usability&quot; &gt;&amp;5
-echo $ECHO_N &quot;checking osp/osp.h usability... $ECHO_C&quot; &gt;&amp;6
+{ echo &quot;$as_me:$LINENO: checking osp/osp.h usability&quot; &gt;&amp;5
+echo $ECHO_N &quot;checking osp/osp.h usability... $ECHO_C&quot; &gt;&amp;6; }
 cat &gt;conftest.$ac_ext &lt;&lt;_ACEOF
 /* confdefs.h.  */
 _ACEOF
@@ -8222,15 +9326,16 @@
   echo &quot;$as_me: failed program was:&quot; &gt;&amp;5
 sed 's/^/| /' conftest.$ac_ext &gt;&amp;5
 
-ac_header_compiler=no
+	ac_header_compiler=no
 fi
+
 rm -f conftest.err conftest.$ac_objext conftest.$ac_ext
-echo &quot;$as_me:$LINENO: result: $ac_header_compiler&quot; &gt;&amp;5
-echo &quot;${ECHO_T}$ac_header_compiler&quot; &gt;&amp;6
+{ echo &quot;$as_me:$LINENO: result: $ac_header_compiler&quot; &gt;&amp;5
+echo &quot;${ECHO_T}$ac_header_compiler&quot; &gt;&amp;6; }
 
 # Is the header present?
-echo &quot;$as_me:$LINENO: checking osp/osp.h presence&quot; &gt;&amp;5
-echo $ECHO_N &quot;checking osp/osp.h presence... $ECHO_C&quot; &gt;&amp;6
+{ echo &quot;$as_me:$LINENO: checking osp/osp.h presence&quot; &gt;&amp;5
+echo $ECHO_N &quot;checking osp/osp.h presence... $ECHO_C&quot; &gt;&amp;6; }
 cat &gt;conftest.$ac_ext &lt;&lt;_ACEOF
 /* confdefs.h.  */
 _ACEOF
@@ -8264,9 +9369,10 @@
 
   ac_header_preproc=no
 fi
+
 rm -f conftest.err conftest.$ac_ext
-echo &quot;$as_me:$LINENO: result: $ac_header_preproc&quot; &gt;&amp;5
-echo &quot;${ECHO_T}$ac_header_preproc&quot; &gt;&amp;6
+{ echo &quot;$as_me:$LINENO: result: $ac_header_preproc&quot; &gt;&amp;5
+echo &quot;${ECHO_T}$ac_header_preproc&quot; &gt;&amp;6; }
 
 # So?  What about this header?
 case $ac_header_compiler:$ac_header_preproc:$ac_c_preproc_warn_flag in
@@ -8290,25 +9396,18 @@
 echo &quot;$as_me: WARNING: osp/osp.h: proceeding with the preprocessor's result&quot; &gt;&amp;2;}
     { echo &quot;$as_me:$LINENO: WARNING: osp/osp.h: in the future, the compiler will take precedence&quot; &gt;&amp;5
 echo &quot;$as_me: WARNING: osp/osp.h: in the future, the compiler will take precedence&quot; &gt;&amp;2;}
-    (
-      cat &lt;&lt;\_ASBOX
-## ------------------------------------------ ##
-## Report this to the AC_PACKAGE_NAME lists.  ##
-## ------------------------------------------ ##
-_ASBOX
-    ) |
-      sed &quot;s/^/$as_me: WARNING:     /&quot; &gt;&amp;2
+
     ;;
 esac
-echo &quot;$as_me:$LINENO: checking for osp/osp.h&quot; &gt;&amp;5
-echo $ECHO_N &quot;checking for osp/osp.h... $ECHO_C&quot; &gt;&amp;6
+{ echo &quot;$as_me:$LINENO: checking for osp/osp.h&quot; &gt;&amp;5
+echo $ECHO_N &quot;checking for osp/osp.h... $ECHO_C&quot; &gt;&amp;6; }
 if test &quot;${ac_cv_header_osp_osp_h+set}&quot; = set; then
   echo $ECHO_N &quot;(cached) $ECHO_C&quot; &gt;&amp;6
 else
   ac_cv_header_osp_osp_h=$ac_header_preproc
 fi
-echo &quot;$as_me:$LINENO: result: $ac_cv_header_osp_osp_h&quot; &gt;&amp;5
-echo &quot;${ECHO_T}$ac_cv_header_osp_osp_h&quot; &gt;&amp;6
+{ echo &quot;$as_me:$LINENO: result: $ac_cv_header_osp_osp_h&quot; &gt;&amp;5
+echo &quot;${ECHO_T}$ac_cv_header_osp_osp_h&quot; &gt;&amp;6; }
 
 fi
 if test $ac_cv_header_osp_osp_h = yes; then
@@ -8321,7 +9420,7 @@
 	 fi
       fi
       if test &quot;x${OSPTK_HEADER_FOUND}&quot; = &quot;x0&quot; ; then
-         if test ! -z &quot;${osptk_MANDATORY}&quot; ;
+         if test ! -z &quot;${OSPTK_MANDATORY}&quot; ;
          then
             echo &quot; ***&quot;
             echo &quot; *** It appears that you do not have the osptk development package installed.&quot;
@@ -8329,18 +9428,18 @@
             echo &quot; *** without explicitly specifying --with-osptk&quot;
             exit 1
          fi
-         osptk_LIB=&quot;&quot;
-         osptk_INCLUDE=&quot;&quot;
-         PBX_LIBosptk=0
+         OSPTK_LIB=&quot;&quot;
+         OSPTK_INCLUDE=&quot;&quot;
+         PBX_LIBOSPTK=0
       else
-         PBX_LIBosptk=1
+         PBX_LIBOSPTK=1
 
 cat &gt;&gt;confdefs.h &lt;&lt;_ACEOF
 #define HAVE_OSPTK 1
 _ACEOF
 
       fi
-   elif test ! -z &quot;${osptk_MANDATORY}&quot;;
+   elif test ! -z &quot;${OSPTK_MANDATORY}&quot;;
    then
       echo &quot;***&quot;
       echo &quot;*** The OSP Toolkit installation on this system appears to be broken.&quot;
@@ -8355,34 +9454,34 @@
 
 
 
-# Check whether --with-popt or --without-popt was given.
+# Check whether --with-popt was given.
 if test &quot;${with_popt+set}&quot; = set; then
-  withval=&quot;$with_popt&quot;
-
+  withval=$with_popt;
 case ${withval} in
      n|no)
-     USE_popt=no
+     USE_POPT=no
      ;;
      y|ye|yes)
-     popt_MANDATORY=&quot;yes&quot;
+     POPT_MANDATORY=&quot;yes&quot;
      ;;
      *)
-     popt_DIR=&quot;${withval}&quot;
-     popt_MANDATORY=&quot;yes&quot;
+     POPT_DIR=&quot;${withval}&quot;
+     POPT_MANDATORY=&quot;yes&quot;
      ;;
 esac
 
-fi;
+fi
 
-PBX_LIBpopt=0
 
-if test &quot;${USE_popt}&quot; != &quot;no&quot;; then
+PBX_LIBPOPT=0
+
+if test &quot;${USE_POPT}&quot; != &quot;no&quot;; then
    pbxlibdir=&quot;&quot;
-   if test &quot;x${popt_DIR}&quot; != &quot;x&quot;; then
+   if test &quot;x${POPT_DIR}&quot; != &quot;x&quot;; then
       pbxlibdir=&quot;-L${popt_DIR}/lib&quot;
    fi
-   echo &quot;$as_me:$LINENO: checking for poptStrerror in -lpopt&quot; &gt;&amp;5
-echo $ECHO_N &quot;checking for poptStrerror in -lpopt... $ECHO_C&quot; &gt;&amp;6
+   { echo &quot;$as_me:$LINENO: checking for poptStrerror in -lpopt&quot; &gt;&amp;5
+echo $ECHO_N &quot;checking for poptStrerror in -lpopt... $ECHO_C&quot; &gt;&amp;6; }
 if test &quot;${ac_cv_lib_popt_poptStrerror+set}&quot; = set; then
   echo $ECHO_N &quot;(cached) $ECHO_C&quot; &gt;&amp;6
 else
@@ -8395,17 +9494,17 @@
 cat &gt;&gt;conftest.$ac_ext &lt;&lt;_ACEOF
 /* end confdefs.h.  */
 
-/* Override any gcc2 internal prototype to avoid an error.  */
+/* Override any GCC internal prototype to avoid an error.
+   Use char because int might match the return type of a GCC
+   builtin and then its argument prototype would still apply.  */
 #ifdef __cplusplus
 extern &quot;C&quot;
 #endif
-/* We use char because int might match the return type of a gcc2
-   builtin and then its argument prototype would still apply.  */
 char poptStrerror ();
 int
 main ()
 {
-poptStrerror ();
+return poptStrerror ();
   ;
   return 0;
 }
@@ -8437,39 +9536,43 @@
   echo &quot;$as_me: failed program was:&quot; &gt;&amp;5
 sed 's/^/| /' conftest.$ac_ext &gt;&amp;5
 
-ac_cv_lib_popt_poptStrerror=no
+	ac_cv_lib_popt_poptStrerror=no
 fi
+
 rm -f conftest.err conftest.$ac_objext \
       conftest$ac_exeext conftest.$ac_ext
 LIBS=$ac_check_lib_save_LIBS
 fi
-echo &quot;$as_me:$LINENO: result: $ac_cv_lib_popt_poptStrerror&quot; &gt;&amp;5
-echo &quot;${ECHO_T}$ac_cv_lib_popt_poptStrerror&quot; &gt;&amp;6
+{ echo &quot;$as_me:$LINENO: result: $ac_cv_lib_popt_poptStrerror&quot; &gt;&amp;5
+echo &quot;${ECHO_T}$ac_cv_lib_popt_poptStrerror&quot; &gt;&amp;6; }
 if test $ac_cv_lib_popt_poptStrerror = yes; then
-  :
+  AST_POPT_FOUND=yes
+else
+  AST_POPT_FOUND=no
 fi
 
 
-   if test &quot;${ac_cv_lib_popt_poptStrerror}&quot; = &quot;yes&quot;; then
-      popt_LIB=&quot;-lpopt &quot;
+   if test &quot;${AST_POPT_FOUND}&quot; = &quot;yes&quot;; then
+      POPT_LIB=&quot;-lpopt &quot;
       POPT_HEADER_FOUND=&quot;1&quot;
-      if test &quot;x${popt_DIR}&quot; != &quot;x&quot;; then
-         popt_LIB=&quot;${pbxlibdir} ${popt_LIB}&quot;
-	 popt_INCLUDE=&quot;-I${popt_DIR}/include&quot;
+      if test &quot;x${POPT_DIR}&quot; != &quot;x&quot;; then
+         POPT_LIB=&quot;${pbxlibdir} ${POPT_LIB}&quot;
+	 POPT_INCLUDE=&quot;-I${POPT_DIR}/include&quot;
 	 if test &quot;xpopt.h&quot; != &quot;x&quot; ; then
-	    as_ac_Header=`echo &quot;ac_cv_header_${popt_DIR}/include/popt.h&quot; | $as_tr_sh`
-if eval &quot;test \&quot;\${$as_ac_Header+set}\&quot; = set&quot;; then
-  echo &quot;$as_me:$LINENO: checking for ${popt_DIR}/include/popt.h&quot; &gt;&amp;5
-echo $ECHO_N &quot;checking for ${popt_DIR}/include/popt.h... $ECHO_C&quot; &gt;&amp;6
-if eval &quot;test \&quot;\${$as_ac_Header+set}\&quot; = set&quot;; then
+	    as_ac_Header=`echo &quot;ac_cv_header_${POPT_DIR}/include/popt.h&quot; | $as_tr_sh`
+if { as_var=$as_ac_Header; eval &quot;test \&quot;\${$as_var+set}\&quot; = set&quot;; }; then
+  { echo &quot;$as_me:$LINENO: checking for ${POPT_DIR}/include/popt.h&quot; &gt;&amp;5
+echo $ECHO_N &quot;checking for ${POPT_DIR}/include/popt.h... $ECHO_C&quot; &gt;&amp;6; }
+if { as_var=$as_ac_Header; eval &quot;test \&quot;\${$as_var+set}\&quot; = set&quot;; }; then
   echo $ECHO_N &quot;(cached) $ECHO_C&quot; &gt;&amp;6
 fi
-echo &quot;$as_me:$LINENO: result: `eval echo '${'$as_ac_Header'}'`&quot; &gt;&amp;5
-echo &quot;${ECHO_T}`eval echo '${'$as_ac_Header'}'`&quot; &gt;&amp;6
+ac_res=`eval echo '${'$as_ac_Header'}'`
+	       { echo &quot;$as_me:$LINENO: result: $ac_res&quot; &gt;&amp;5
+echo &quot;${ECHO_T}$ac_res&quot; &gt;&amp;6; }
 else
   # Is the header compilable?
-echo &quot;$as_me:$LINENO: checking ${popt_DIR}/include/popt.h usability&quot; &gt;&amp;5
-echo $ECHO_N &quot;checking ${popt_DIR}/include/popt.h usability... $ECHO_C&quot; &gt;&amp;6
+{ echo &quot;$as_me:$LINENO: checking ${POPT_DIR}/include/popt.h usability&quot; &gt;&amp;5
+echo $ECHO_N &quot;checking ${POPT_DIR}/include/popt.h usability... $ECHO_C&quot; &gt;&amp;6; }
 cat &gt;conftest.$ac_ext &lt;&lt;_ACEOF
 /* confdefs.h.  */
 _ACEOF
@@ -8477,7 +9580,7 @@
 cat &gt;&gt;conftest.$ac_ext &lt;&lt;_ACEOF
 /* end confdefs.h.  */
 $ac_includes_default
-#include &lt;${popt_DIR}/include/popt.h&gt;
+#include &lt;${POPT_DIR}/include/popt.h&gt;
 _ACEOF
 rm -f conftest.$ac_objext
 if { (eval echo &quot;$as_me:$LINENO: \&quot;$ac_compile\&quot;&quot;) &gt;&amp;5
@@ -8506,22 +9609,23 @@
   echo &quot;$as_me: failed program was:&quot; &gt;&amp;5
 sed 's/^/| /' conftest.$ac_ext &gt;&amp;5
 
-ac_header_compiler=no
+	ac_header_compiler=no
 fi
+
 rm -f conftest.err conftest.$ac_objext conftest.$ac_ext
-echo &quot;$as_me:$LINENO: result: $ac_header_compiler&quot; &gt;&amp;5
-echo &quot;${ECHO_T}$ac_header_compiler&quot; &gt;&amp;6
+{ echo &quot;$as_me:$LINENO: result: $ac_header_compiler&quot; &gt;&amp;5
+echo &quot;${ECHO_T}$ac_header_compiler&quot; &gt;&amp;6; }
 
 # Is the header present?
-echo &quot;$as_me:$LINENO: checking ${popt_DIR}/include/popt.h presence&quot; &gt;&amp;5
-echo $ECHO_N &quot;checking ${popt_DIR}/include/popt.h presence... $ECHO_C&quot; &gt;&amp;6
+{ echo &quot;$as_me:$LINENO: checking ${POPT_DIR}/include/popt.h presence&quot; &gt;&amp;5
+echo $ECHO_N &quot;checking ${POPT_DIR}/include/popt.h presence... $ECHO_C&quot; &gt;&amp;6; }
 cat &gt;conftest.$ac_ext &lt;&lt;_ACEOF
 /* confdefs.h.  */
 _ACEOF
 cat confdefs.h &gt;&gt;conftest.$ac_ext
 cat &gt;&gt;conftest.$ac_ext &lt;&lt;_ACEOF
 /* end confdefs.h.  */
-#include &lt;${popt_DIR}/include/popt.h&gt;
+#include &lt;${POPT_DIR}/include/popt.h&gt;
 _ACEOF
 if { (eval echo &quot;$as_me:$LINENO: \&quot;$ac_cpp conftest.$ac_ext\&quot;&quot;) &gt;&amp;5
   (eval $ac_cpp conftest.$ac_ext) 2&gt;conftest.er1
@@ -8548,51 +9652,46 @@
 
   ac_header_preproc=no
 fi
+
 rm -f conftest.err conftest.$ac_ext
-echo &quot;$as_me:$LINENO: result: $ac_header_preproc&quot; &gt;&amp;5
-echo &quot;${ECHO_T}$ac_header_preproc&quot; &gt;&amp;6
+{ echo &quot;$as_me:$LINENO: result: $ac_header_preproc&quot; &gt;&amp;5
+echo &quot;${ECHO_T}$ac_header_preproc&quot; &gt;&amp;6; }
 
 # So?  What about this header?
 case $ac_header_compiler:$ac_header_preproc:$ac_c_preproc_warn_flag in
   yes:no: )
-    { echo &quot;$as_me:$LINENO: WARNING: ${popt_DIR}/include/popt.h: accepted by the compiler, rejected by the preprocessor!&quot; &gt;&amp;5
-echo &quot;$as_me: WARNING: ${popt_DIR}/include/popt.h: accepted by the compiler, rejected by the preprocessor!&quot; &gt;&amp;2;}
-    { echo &quot;$as_me:$LINENO: WARNING: ${popt_DIR}/include/popt.h: proceeding with the compiler's result&quot; &gt;&amp;5
-echo &quot;$as_me: WARNING: ${popt_DIR}/include/popt.h: proceeding with the compiler's result&quot; &gt;&amp;2;}
+    { echo &quot;$as_me:$LINENO: WARNING: ${POPT_DIR}/include/popt.h: accepted by the compiler, rejected by the preprocessor!&quot; &gt;&amp;5
+echo &quot;$as_me: WARNING: ${POPT_DIR}/include/popt.h: accepted by the compiler, rejected by the preprocessor!&quot; &gt;&amp;2;}
+    { echo &quot;$as_me:$LINENO: WARNING: ${POPT_DIR}/include/popt.h: proceeding with the compiler's result&quot; &gt;&amp;5
+echo &quot;$as_me: WARNING: ${POPT_DIR}/include/popt.h: proceeding with the compiler's result&quot; &gt;&amp;2;}
     ac_header_preproc=yes
     ;;
   no:yes:* )
-    { echo &quot;$as_me:$LINENO: WARNING: ${popt_DIR}/include/popt.h: present but cannot be compiled&quot; &gt;&amp;5
-echo &quot;$as_me: WARNING: ${popt_DIR}/include/popt.h: present but cannot be compiled&quot; &gt;&amp;2;}
-    { echo &quot;$as_me:$LINENO: WARNING: ${popt_DIR}/include/popt.h:     check for missing prerequisite headers?&quot; &gt;&amp;5
-echo &quot;$as_me: WARNING: ${popt_DIR}/include/popt.h:     check for missing prerequisite headers?&quot; &gt;&amp;2;}
-    { echo &quot;$as_me:$LINENO: WARNING: ${popt_DIR}/include/popt.h: see the Autoconf documentation&quot; &gt;&amp;5
-echo &quot;$as_me: WARNING: ${popt_DIR}/include/popt.h: see the Autoconf documentation&quot; &gt;&amp;2;}
-    { echo &quot;$as_me:$LINENO: WARNING: ${popt_DIR}/include/popt.h:     section \&quot;Present But Cannot Be Compiled\&quot;&quot; &gt;&amp;5
-echo &quot;$as_me: WARNING: ${popt_DIR}/include/popt.h:     section \&quot;Present But Cannot Be Compiled\&quot;&quot; &gt;&amp;2;}
-    { echo &quot;$as_me:$LINENO: WARNING: ${popt_DIR}/include/popt.h: proceeding with the preprocessor's result&quot; &gt;&amp;5
-echo &quot;$as_me: WARNING: ${popt_DIR}/include/popt.h: proceeding with the preprocessor's result&quot; &gt;&amp;2;}
-    { echo &quot;$as_me:$LINENO: WARNING: ${popt_DIR}/include/popt.h: in the future, the compiler will take precedence&quot; &gt;&amp;5
-echo &quot;$as_me: WARNING: ${popt_DIR}/include/popt.h: in the future, the compiler will take precedence&quot; &gt;&amp;2;}
-    (
-      cat &lt;&lt;\_ASBOX
-## ------------------------------------------ ##
-## Report this to the AC_PACKAGE_NAME lists.  ##
-## ------------------------------------------ ##
-_ASBOX
-    ) |
-      sed &quot;s/^/$as_me: WARNING:     /&quot; &gt;&amp;2
+    { echo &quot;$as_me:$LINENO: WARNING: ${POPT_DIR}/include/popt.h: present but cannot be compiled&quot; &gt;&amp;5
+echo &quot;$as_me: WARNING: ${POPT_DIR}/include/popt.h: present but cannot be compiled&quot; &gt;&amp;2;}
+    { echo &quot;$as_me:$LINENO: WARNING: ${POPT_DIR}/include/popt.h:     check for missing prerequisite headers?&quot; &gt;&amp;5
+echo &quot;$as_me: WARNING: ${POPT_DIR}/include/popt.h:     check for missing prerequisite headers?&quot; &gt;&amp;2;}
+    { echo &quot;$as_me:$LINENO: WARNING: ${POPT_DIR}/include/popt.h: see the Autoconf documentation&quot; &gt;&amp;5
+echo &quot;$as_me: WARNING: ${POPT_DIR}/include/popt.h: see the Autoconf documentation&quot; &gt;&amp;2;}
+    { echo &quot;$as_me:$LINENO: WARNING: ${POPT_DIR}/include/popt.h:     section \&quot;Present But Cannot Be Compiled\&quot;&quot; &gt;&amp;5
+echo &quot;$as_me: WARNING: ${POPT_DIR}/include/popt.h:     section \&quot;Present But Cannot Be Compiled\&quot;&quot; &gt;&amp;2;}
+    { echo &quot;$as_me:$LINENO: WARNING: ${POPT_DIR}/include/popt.h: proceeding with the preprocessor's result&quot; &gt;&amp;5
+echo &quot;$as_me: WARNING: ${POPT_DIR}/include/popt.h: proceeding with the preprocessor's result&quot; &gt;&amp;2;}
+    { echo &quot;$as_me:$LINENO: WARNING: ${POPT_DIR}/include/popt.h: in the future, the compiler will take precedence&quot; &gt;&amp;5
+echo &quot;$as_me: WARNING: ${POPT_DIR}/include/popt.h: in the future, the compiler will take precedence&quot; &gt;&amp;2;}
+
     ;;
 esac
-echo &quot;$as_me:$LINENO: checking for ${popt_DIR}/include/popt.h&quot; &gt;&amp;5
-echo $ECHO_N &quot;checking for ${popt_DIR}/include/popt.h... $ECHO_C&quot; &gt;&amp;6
-if eval &quot;test \&quot;\${$as_ac_Header+set}\&quot; = set&quot;; then
+{ echo &quot;$as_me:$LINENO: checking for ${POPT_DIR}/include/popt.h&quot; &gt;&amp;5
+echo $ECHO_N &quot;checking for ${POPT_DIR}/include/popt.h... $ECHO_C&quot; &gt;&amp;6; }
+if { as_var=$as_ac_Header; eval &quot;test \&quot;\${$as_var+set}\&quot; = set&quot;; }; then
   echo $ECHO_N &quot;(cached) $ECHO_C&quot; &gt;&amp;6
 else
   eval &quot;$as_ac_Header=\$ac_header_preproc&quot;
 fi
-echo &quot;$as_me:$LINENO: result: `eval echo '${'$as_ac_Header'}'`&quot; &gt;&amp;5
-echo &quot;${ECHO_T}`eval echo '${'$as_ac_Header'}'`&quot; &gt;&amp;6
+ac_res=`eval echo '${'$as_ac_Header'}'`
+	       { echo &quot;$as_me:$LINENO: result: $ac_res&quot; &gt;&amp;5
+echo &quot;${ECHO_T}$ac_res&quot; &gt;&amp;6; }
 
 fi
 if test `eval echo '${'$as_ac_Header'}'` = yes; then
@@ -8606,17 +9705,17 @@
       else
 	 if test &quot;xpopt.h&quot; != &quot;x&quot; ; then
             if test &quot;${ac_cv_header_popt_h+set}&quot; = set; then
-  echo &quot;$as_me:$LINENO: checking for popt.h&quot; &gt;&amp;5
-echo $ECHO_N &quot;checking for popt.h... $ECHO_C&quot; &gt;&amp;6
+  { echo &quot;$as_me:$LINENO: checking for popt.h&quot; &gt;&amp;5
+echo $ECHO_N &quot;checking for popt.h... $ECHO_C&quot; &gt;&amp;6; }
 if test &quot;${ac_cv_header_popt_h+set}&quot; = set; then
   echo $ECHO_N &quot;(cached) $ECHO_C&quot; &gt;&amp;6
 fi
-echo &quot;$as_me:$LINENO: result: $ac_cv_header_popt_h&quot; &gt;&amp;5
-echo &quot;${ECHO_T}$ac_cv_header_popt_h&quot; &gt;&amp;6
+{ echo &quot;$as_me:$LINENO: result: $ac_cv_header_popt_h&quot; &gt;&amp;5
+echo &quot;${ECHO_T}$ac_cv_header_popt_h&quot; &gt;&amp;6; }
 else
   # Is the header compilable?
-echo &quot;$as_me:$LINENO: checking popt.h usability&quot; &gt;&amp;5
-echo $ECHO_N &quot;checking popt.h usability... $ECHO_C&quot; &gt;&amp;6
+{ echo &quot;$as_me:$LINENO: checking popt.h usability&quot; &gt;&amp;5
+echo $ECHO_N &quot;checking popt.h usability... $ECHO_C&quot; &gt;&amp;6; }
 cat &gt;conftest.$ac_ext &lt;&lt;_ACEOF
 /* confdefs.h.  */
 _ACEOF
@@ -8653,15 +9752,16 @@
   echo &quot;$as_me: failed program was:&quot; &gt;&amp;5
 sed 's/^/| /' conftest.$ac_ext &gt;&amp;5
 
-ac_header_compiler=no
+	ac_header_compiler=no
 fi
+
 rm -f conftest.err conftest.$ac_objext conftest.$ac_ext
-echo &quot;$as_me:$LINENO: result: $ac_header_compiler&quot; &gt;&amp;5
-echo &quot;${ECHO_T}$ac_header_compiler&quot; &gt;&amp;6
+{ echo &quot;$as_me:$LINENO: result: $ac_header_compiler&quot; &gt;&amp;5
+echo &quot;${ECHO_T}$ac_header_compiler&quot; &gt;&amp;6; }
 
 # Is the header present?
-echo &quot;$as_me:$LINENO: checking popt.h presence&quot; &gt;&amp;5
-echo $ECHO_N &quot;checking popt.h presence... $ECHO_C&quot; &gt;&amp;6
+{ echo &quot;$as_me:$LINENO: checking popt.h presence&quot; &gt;&amp;5
+echo $ECHO_N &quot;checking popt.h presence... $ECHO_C&quot; &gt;&amp;6; }
 cat &gt;conftest.$ac_ext &lt;&lt;_ACEOF
 /* confdefs.h.  */
 _ACEOF
@@ -8695,9 +9795,10 @@
 
   ac_header_preproc=no
 fi
+
 rm -f conftest.err conftest.$ac_ext
-echo &quot;$as_me:$LINENO: result: $ac_header_preproc&quot; &gt;&amp;5
-echo &quot;${ECHO_T}$ac_header_preproc&quot; &gt;&amp;6
+{ echo &quot;$as_me:$LINENO: result: $ac_header_preproc&quot; &gt;&amp;5
+echo &quot;${ECHO_T}$ac_header_preproc&quot; &gt;&amp;6; }
 
 # So?  What about this header?
 case $ac_header_compiler:$ac_header_preproc:$ac_c_preproc_warn_flag in
@@ -8721,25 +9822,18 @@
 echo &quot;$as_me: WARNING: popt.h: proceeding with the preprocessor's result&quot; &gt;&amp;2;}
     { echo &quot;$as_me:$LINENO: WARNING: popt.h: in the future, the compiler will take precedence&quot; &gt;&amp;5
 echo &quot;$as_me: WARNING: popt.h: in the future, the compiler will take precedence&quot; &gt;&amp;2;}
-    (
-      cat &lt;&lt;\_ASBOX
-## ------------------------------------------ ##
-## Report this to the AC_PACKAGE_NAME lists.  ##
-## ------------------------------------------ ##
-_ASBOX
-    ) |
-      sed &quot;s/^/$as_me: WARNING:     /&quot; &gt;&amp;2
+
     ;;
 esac
-echo &quot;$as_me:$LINENO: checking for popt.h&quot; &gt;&amp;5
-echo $ECHO_N &quot;checking for popt.h... $ECHO_C&quot; &gt;&amp;6
+{ echo &quot;$as_me:$LINENO: checking for popt.h&quot; &gt;&amp;5
+echo $ECHO_N &quot;checking for popt.h... $ECHO_C&quot; &gt;&amp;6; }
 if test &quot;${ac_cv_header_popt_h+set}&quot; = set; then
   echo $ECHO_N &quot;(cached) $ECHO_C&quot; &gt;&amp;6
 else
   ac_cv_header_popt_h=$ac_header_preproc
 fi
-echo &quot;$as_me:$LINENO: result: $ac_cv_header_popt_h&quot; &gt;&amp;5
-echo &quot;${ECHO_T}$ac_cv_header_popt_h&quot; &gt;&amp;6
+{ echo &quot;$as_me:$LINENO: result: $ac_cv_header_popt_h&quot; &gt;&amp;5
+echo &quot;${ECHO_T}$ac_cv_header_popt_h&quot; &gt;&amp;6; }
 
 fi
 if test $ac_cv_header_popt_h = yes; then
@@ -8752,7 +9846,7 @@
 	 fi
       fi
       if test &quot;x${POPT_HEADER_FOUND}&quot; = &quot;x0&quot; ; then
-         if test ! -z &quot;${popt_MANDATORY}&quot; ;
+         if test ! -z &quot;${POPT_MANDATORY}&quot; ;
          then
             echo &quot; ***&quot;
             echo &quot; *** It appears that you do not have the popt development package installed.&quot;
@@ -8760,18 +9854,18 @@
             echo &quot; *** without explicitly specifying --with-popt&quot;
             exit 1
          fi
-         popt_LIB=&quot;&quot;
-         popt_INCLUDE=&quot;&quot;
-         PBX_LIBpopt=0
+         POPT_LIB=&quot;&quot;
+         POPT_INCLUDE=&quot;&quot;
+         PBX_LIBPOPT=0
       else
-         PBX_LIBpopt=1
+         PBX_LIBPOPT=1
 
 cat &gt;&gt;confdefs.h &lt;&lt;_ACEOF
 #define HAVE_POPT 1
 _ACEOF
 
       fi
-   elif test ! -z &quot;${popt_MANDATORY}&quot;;
+   elif test ! -z &quot;${POPT_MANDATORY}&quot;;
    then
       echo &quot;***&quot;
       echo &quot;*** The popt installation on this system appears to be broken.&quot;
@@ -8786,34 +9880,34 @@
 
 
 
-# Check whether --with-pri or --without-pri was given.
+# Check whether --with-pri was given.
 if test &quot;${with_pri+set}&quot; = set; then
-  withval=&quot;$with_pri&quot;
-
+  withval=$with_pri;
 case ${withval} in
      n|no)
-     USE_pri=no
+     USE_LIBPRI=no
      ;;
      y|ye|yes)
-     pri_MANDATORY=&quot;yes&quot;
+     LIBPRI_MANDATORY=&quot;yes&quot;
      ;;
      *)
-     pri_DIR=&quot;${withval}&quot;
-     pri_MANDATORY=&quot;yes&quot;
+     LIBPRI_DIR=&quot;${withval}&quot;
+     LIBPRI_MANDATORY=&quot;yes&quot;
      ;;
 esac
 
-fi;
+fi
 
-PBX_LIBpri=0
 
-if test &quot;${USE_pri}&quot; != &quot;no&quot;; then
+PBX_LIBLIBPRI=0
+
+if test &quot;${USE_LIBPRI}&quot; != &quot;no&quot;; then
    pbxlibdir=&quot;&quot;
-   if test &quot;x${pri_DIR}&quot; != &quot;x&quot;; then
+   if test &quot;x${LIBPRI_DIR}&quot; != &quot;x&quot;; then
       pbxlibdir=&quot;-L${pri_DIR}/lib&quot;
    fi
-   echo &quot;$as_me:$LINENO: checking for pri_call in -lpri&quot; &gt;&amp;5
-echo $ECHO_N &quot;checking for pri_call in -lpri... $ECHO_C&quot; &gt;&amp;6
+   { echo &quot;$as_me:$LINENO: checking for pri_call in -lpri&quot; &gt;&amp;5
+echo $ECHO_N &quot;checking for pri_call in -lpri... $ECHO_C&quot; &gt;&amp;6; }
 if test &quot;${ac_cv_lib_pri_pri_call+set}&quot; = set; then
   echo $ECHO_N &quot;(cached) $ECHO_C&quot; &gt;&amp;6
 else
@@ -8826,17 +9920,17 @@
 cat &gt;&gt;conftest.$ac_ext &lt;&lt;_ACEOF
 /* end confdefs.h.  */
 
-/* Override any gcc2 internal prototype to avoid an error.  */
+/* Override any GCC internal prototype to avoid an error.
+   Use char because int might match the return type of a GCC
+   builtin and then its argument prototype would still apply.  */
 #ifdef __cplusplus
 extern &quot;C&quot;
 #endif
-/* We use char because int might match the return type of a gcc2
-   builtin and then its argument prototype would still apply.  */
 char pri_call ();
 int
 main ()
 {
-pri_call ();
+return pri_call ();
   ;
   return 0;
 }
@@ -8868,39 +9962,43 @@
   echo &quot;$as_me: failed program was:&quot; &gt;&amp;5
 sed 's/^/| /' conftest.$ac_ext &gt;&amp;5
 
-ac_cv_lib_pri_pri_call=no
+	ac_cv_lib_pri_pri_call=no
 fi
+
 rm -f conftest.err conftest.$ac_objext \
       conftest$ac_exeext conftest.$ac_ext
 LIBS=$ac_check_lib_save_LIBS
 fi
-echo &quot;$as_me:$LINENO: result: $ac_cv_lib_pri_pri_call&quot; &gt;&amp;5
-echo &quot;${ECHO_T}$ac_cv_lib_pri_pri_call&quot; &gt;&amp;6
+{ echo &quot;$as_me:$LINENO: result: $ac_cv_lib_pri_pri_call&quot; &gt;&amp;5
+echo &quot;${ECHO_T}$ac_cv_lib_pri_pri_call&quot; &gt;&amp;6; }
 if test $ac_cv_lib_pri_pri_call = yes; then
-  :
+  AST_LIBPRI_FOUND=yes
+else
+  AST_LIBPRI_FOUND=no
 fi
 
 
-   if test &quot;${ac_cv_lib_pri_pri_call}&quot; = &quot;yes&quot;; then
-      pri_LIB=&quot;-lpri &quot;
+   if test &quot;${AST_LIBPRI_FOUND}&quot; = &quot;yes&quot;; then
+      LIBPRI_LIB=&quot;-lpri &quot;
       LIBPRI_HEADER_FOUND=&quot;1&quot;
-      if test &quot;x${pri_DIR}&quot; != &quot;x&quot;; then
-         pri_LIB=&quot;${pbxlibdir} ${pri_LIB}&quot;
-	 pri_INCLUDE=&quot;-I${pri_DIR}/include&quot;
+      if test &quot;x${LIBPRI_DIR}&quot; != &quot;x&quot;; then
+         LIBPRI_LIB=&quot;${pbxlibdir} ${LIBPRI_LIB}&quot;
+	 LIBPRI_INCLUDE=&quot;-I${LIBPRI_DIR}/include&quot;
 	 if test &quot;xlibpri.h&quot; != &quot;x&quot; ; then
-	    as_ac_Header=`echo &quot;ac_cv_header_${pri_DIR}/include/libpri.h&quot; | $as_tr_sh`
-if eval &quot;test \&quot;\${$as_ac_Header+set}\&quot; = set&quot;; then
-  echo &quot;$as_me:$LINENO: checking for ${pri_DIR}/include/libpri.h&quot; &gt;&amp;5
-echo $ECHO_N &quot;checking for ${pri_DIR}/include/libpri.h... $ECHO_C&quot; &gt;&amp;6
-if eval &quot;test \&quot;\${$as_ac_Header+set}\&quot; = set&quot;; then
+	    as_ac_Header=`echo &quot;ac_cv_header_${LIBPRI_DIR}/include/libpri.h&quot; | $as_tr_sh`
+if { as_var=$as_ac_Header; eval &quot;test \&quot;\${$as_var+set}\&quot; = set&quot;; }; then
+  { echo &quot;$as_me:$LINENO: checking for ${LIBPRI_DIR}/include/libpri.h&quot; &gt;&amp;5
+echo $ECHO_N &quot;checking for ${LIBPRI_DIR}/include/libpri.h... $ECHO_C&quot; &gt;&amp;6; }
+if { as_var=$as_ac_Header; eval &quot;test \&quot;\${$as_var+set}\&quot; = set&quot;; }; then
   echo $ECHO_N &quot;(cached) $ECHO_C&quot; &gt;&amp;6
 fi
-echo &quot;$as_me:$LINENO: result: `eval echo '${'$as_ac_Header'}'`&quot; &gt;&amp;5
-echo &quot;${ECHO_T}`eval echo '${'$as_ac_Header'}'`&quot; &gt;&amp;6
+ac_res=`eval echo '${'$as_ac_Header'}'`
+	       { echo &quot;$as_me:$LINENO: result: $ac_res&quot; &gt;&amp;5
+echo &quot;${ECHO_T}$ac_res&quot; &gt;&amp;6; }
 else
   # Is the header compilable?
-echo &quot;$as_me:$LINENO: checking ${pri_DIR}/include/libpri.h usability&quot; &gt;&amp;5
-echo $ECHO_N &quot;checking ${pri_DIR}/include/libpri.h usability... $ECHO_C&quot; &gt;&amp;6
+{ echo &quot;$as_me:$LINENO: checking ${LIBPRI_DIR}/include/libpri.h usability&quot; &gt;&amp;5
+echo $ECHO_N &quot;checking ${LIBPRI_DIR}/include/libpri.h usability... $ECHO_C&quot; &gt;&amp;6; }
 cat &gt;conftest.$ac_ext &lt;&lt;_ACEOF
 /* confdefs.h.  */
 _ACEOF
@@ -8908,7 +10006,7 @@
 cat &gt;&gt;conftest.$ac_ext &lt;&lt;_ACEOF
 /* end confdefs.h.  */
 $ac_includes_default
-#include &lt;${pri_DIR}/include/libpri.h&gt;
+#include &lt;${LIBPRI_DIR}/include/libpri.h&gt;
 _ACEOF
 rm -f conftest.$ac_objext
 if { (eval echo &quot;$as_me:$LINENO: \&quot;$ac_compile\&quot;&quot;) &gt;&amp;5
@@ -8937,22 +10035,23 @@
   echo &quot;$as_me: failed program was:&quot; &gt;&amp;5
 sed 's/^/| /' conftest.$ac_ext &gt;&amp;5
 
-ac_header_compiler=no
+	ac_header_compiler=no
 fi
+
 rm -f conftest.err conftest.$ac_objext conftest.$ac_ext
-echo &quot;$as_me:$LINENO: result: $ac_header_compiler&quot; &gt;&amp;5
-echo &quot;${ECHO_T}$ac_header_compiler&quot; &gt;&amp;6
+{ echo &quot;$as_me:$LINENO: result: $ac_header_compiler&quot; &gt;&amp;5
+echo &quot;${ECHO_T}$ac_header_compiler&quot; &gt;&amp;6; }
 
 # Is the header present?
-echo &quot;$as_me:$LINENO: checking ${pri_DIR}/include/libpri.h presence&quot; &gt;&amp;5
-echo $ECHO_N &quot;checking ${pri_DIR}/include/libpri.h presence... $ECHO_C&quot; &gt;&amp;6
+{ echo &quot;$as_me:$LINENO: checking ${LIBPRI_DIR}/include/libpri.h presence&quot; &gt;&amp;5
+echo $ECHO_N &quot;checking ${LIBPRI_DIR}/include/libpri.h presence... $ECHO_C&quot; &gt;&amp;6; }
 cat &gt;conftest.$ac_ext &lt;&lt;_ACEOF
 /* confdefs.h.  */
 _ACEOF
 cat confdefs.h &gt;&gt;conftest.$ac_ext
 cat &gt;&gt;conftest.$ac_ext &lt;&lt;_ACEOF
 /* end confdefs.h.  */
-#include &lt;${pri_DIR}/include/libpri.h&gt;
+#include &lt;${LIBPRI_DIR}/include/libpri.h&gt;
 _ACEOF
 if { (eval echo &quot;$as_me:$LINENO: \&quot;$ac_cpp conftest.$ac_ext\&quot;&quot;) &gt;&amp;5
   (eval $ac_cpp conftest.$ac_ext) 2&gt;conftest.er1
@@ -8979,51 +10078,46 @@
 
   ac_header_preproc=no
 fi
+
 rm -f conftest.err conftest.$ac_ext
-echo &quot;$as_me:$LINENO: result: $ac_header_preproc&quot; &gt;&amp;5
-echo &quot;${ECHO_T}$ac_header_preproc&quot; &gt;&amp;6
+{ echo &quot;$as_me:$LINENO: result: $ac_header_preproc&quot; &gt;&amp;5
+echo &quot;${ECHO_T}$ac_header_preproc&quot; &gt;&amp;6; }
 
 # So?  What about this header?
 case $ac_header_compiler:$ac_header_preproc:$ac_c_preproc_warn_flag in
   yes:no: )
-    { echo &quot;$as_me:$LINENO: WARNING: ${pri_DIR}/include/libpri.h: accepted by the compiler, rejected by the preprocessor!&quot; &gt;&amp;5
-echo &quot;$as_me: WARNING: ${pri_DIR}/include/libpri.h: accepted by the compiler, rejected by the preprocessor!&quot; &gt;&amp;2;}
-    { echo &quot;$as_me:$LINENO: WARNING: ${pri_DIR}/include/libpri.h: proceeding with the compiler's result&quot; &gt;&amp;5
-echo &quot;$as_me: WARNING: ${pri_DIR}/include/libpri.h: proceeding with the compiler's result&quot; &gt;&amp;2;}
+    { echo &quot;$as_me:$LINENO: WARNING: ${LIBPRI_DIR}/include/libpri.h: accepted by the compiler, rejected by the preprocessor!&quot; &gt;&amp;5
+echo &quot;$as_me: WARNING: ${LIBPRI_DIR}/include/libpri.h: accepted by the compiler, rejected by the preprocessor!&quot; &gt;&amp;2;}
+    { echo &quot;$as_me:$LINENO: WARNING: ${LIBPRI_DIR}/include/libpri.h: proceeding with the compiler's result&quot; &gt;&amp;5
+echo &quot;$as_me: WARNING: ${LIBPRI_DIR}/include/libpri.h: proceeding with the compiler's result&quot; &gt;&amp;2;}
     ac_header_preproc=yes
     ;;
   no:yes:* )
-    { echo &quot;$as_me:$LINENO: WARNING: ${pri_DIR}/include/libpri.h: present but cannot be compiled&quot; &gt;&amp;5
-echo &quot;$as_me: WARNING: ${pri_DIR}/include/libpri.h: present but cannot be compiled&quot; &gt;&amp;2;}
-    { echo &quot;$as_me:$LINENO: WARNING: ${pri_DIR}/include/libpri.h:     check for missing prerequisite headers?&quot; &gt;&amp;5
-echo &quot;$as_me: WARNING: ${pri_DIR}/include/libpri.h:     check for missing prerequisite headers?&quot; &gt;&amp;2;}
-    { echo &quot;$as_me:$LINENO: WARNING: ${pri_DIR}/include/libpri.h: see the Autoconf documentation&quot; &gt;&amp;5
-echo &quot;$as_me: WARNING: ${pri_DIR}/include/libpri.h: see the Autoconf documentation&quot; &gt;&amp;2;}
-    { echo &quot;$as_me:$LINENO: WARNING: ${pri_DIR}/include/libpri.h:     section \&quot;Present But Cannot Be Compiled\&quot;&quot; &gt;&amp;5
-echo &quot;$as_me: WARNING: ${pri_DIR}/include/libpri.h:     section \&quot;Present But Cannot Be Compiled\&quot;&quot; &gt;&amp;2;}
-    { echo &quot;$as_me:$LINENO: WARNING: ${pri_DIR}/include/libpri.h: proceeding with the preprocessor's result&quot; &gt;&amp;5
-echo &quot;$as_me: WARNING: ${pri_DIR}/include/libpri.h: proceeding with the preprocessor's result&quot; &gt;&amp;2;}
-    { echo &quot;$as_me:$LINENO: WARNING: ${pri_DIR}/include/libpri.h: in the future, the compiler will take precedence&quot; &gt;&amp;5
-echo &quot;$as_me: WARNING: ${pri_DIR}/include/libpri.h: in the future, the compiler will take precedence&quot; &gt;&amp;2;}
-    (
-      cat &lt;&lt;\_ASBOX
-## ------------------------------------------ ##
-## Report this to the AC_PACKAGE_NAME lists.  ##
-## ------------------------------------------ ##
-_ASBOX
-    ) |
-      sed &quot;s/^/$as_me: WARNING:     /&quot; &gt;&amp;2
+    { echo &quot;$as_me:$LINENO: WARNING: ${LIBPRI_DIR}/include/libpri.h: present but cannot be compiled&quot; &gt;&amp;5
+echo &quot;$as_me: WARNING: ${LIBPRI_DIR}/include/libpri.h: present but cannot be compiled&quot; &gt;&amp;2;}
+    { echo &quot;$as_me:$LINENO: WARNING: ${LIBPRI_DIR}/include/libpri.h:     check for missing prerequisite headers?&quot; &gt;&amp;5
+echo &quot;$as_me: WARNING: ${LIBPRI_DIR}/include/libpri.h:     check for missing prerequisite headers?&quot; &gt;&amp;2;}
+    { echo &quot;$as_me:$LINENO: WARNING: ${LIBPRI_DIR}/include/libpri.h: see the Autoconf documentation&quot; &gt;&amp;5
+echo &quot;$as_me: WARNING: ${LIBPRI_DIR}/include/libpri.h: see the Autoconf documentation&quot; &gt;&amp;2;}
+    { echo &quot;$as_me:$LINENO: WARNING: ${LIBPRI_DIR}/include/libpri.h:     section \&quot;Present But Cannot Be Compiled\&quot;&quot; &gt;&amp;5
+echo &quot;$as_me: WARNING: ${LIBPRI_DIR}/include/libpri.h:     section \&quot;Present But Cannot Be Compiled\&quot;&quot; &gt;&amp;2;}
+    { echo &quot;$as_me:$LINENO: WARNING: ${LIBPRI_DIR}/include/libpri.h: proceeding with the preprocessor's result&quot; &gt;&amp;5
+echo &quot;$as_me: WARNING: ${LIBPRI_DIR}/include/libpri.h: proceeding with the preprocessor's result&quot; &gt;&amp;2;}
+    { echo &quot;$as_me:$LINENO: WARNING: ${LIBPRI_DIR}/include/libpri.h: in the future, the compiler will take precedence&quot; &gt;&amp;5
+echo &quot;$as_me: WARNING: ${LIBPRI_DIR}/include/libpri.h: in the future, the compiler will take precedence&quot; &gt;&amp;2;}
+
     ;;
 esac
-echo &quot;$as_me:$LINENO: checking for ${pri_DIR}/include/libpri.h&quot; &gt;&amp;5
-echo $ECHO_N &quot;checking for ${pri_DIR}/include/libpri.h... $ECHO_C&quot; &gt;&amp;6
-if eval &quot;test \&quot;\${$as_ac_Header+set}\&quot; = set&quot;; then
+{ echo &quot;$as_me:$LINENO: checking for ${LIBPRI_DIR}/include/libpri.h&quot; &gt;&amp;5
+echo $ECHO_N &quot;checking for ${LIBPRI_DIR}/include/libpri.h... $ECHO_C&quot; &gt;&amp;6; }
+if { as_var=$as_ac_Header; eval &quot;test \&quot;\${$as_var+set}\&quot; = set&quot;; }; then
   echo $ECHO_N &quot;(cached) $ECHO_C&quot; &gt;&amp;6
 else
   eval &quot;$as_ac_Header=\$ac_header_preproc&quot;
 fi
-echo &quot;$as_me:$LINENO: result: `eval echo '${'$as_ac_Header'}'`&quot; &gt;&amp;5
-echo &quot;${ECHO_T}`eval echo '${'$as_ac_Header'}'`&quot; &gt;&amp;6
+ac_res=`eval echo '${'$as_ac_Header'}'`
+	       { echo &quot;$as_me:$LINENO: result: $ac_res&quot; &gt;&amp;5
+echo &quot;${ECHO_T}$ac_res&quot; &gt;&amp;6; }
 
 fi
 if test `eval echo '${'$as_ac_Header'}'` = yes; then
@@ -9037,17 +10131,17 @@
       else
 	 if test &quot;xlibpri.h&quot; != &quot;x&quot; ; then
             if test &quot;${ac_cv_header_libpri_h+set}&quot; = set; then
-  echo &quot;$as_me:$LINENO: checking for libpri.h&quot; &gt;&amp;5
-echo $ECHO_N &quot;checking for libpri.h... $ECHO_C&quot; &gt;&amp;6
+  { echo &quot;$as_me:$LINENO: checking for libpri.h&quot; &gt;&amp;5
+echo $ECHO_N &quot;checking for libpri.h... $ECHO_C&quot; &gt;&amp;6; }
 if test &quot;${ac_cv_header_libpri_h+set}&quot; = set; then
   echo $ECHO_N &quot;(cached) $ECHO_C&quot; &gt;&amp;6
 fi
-echo &quot;$as_me:$LINENO: result: $ac_cv_header_libpri_h&quot; &gt;&amp;5
-echo &quot;${ECHO_T}$ac_cv_header_libpri_h&quot; &gt;&amp;6
+{ echo &quot;$as_me:$LINENO: result: $ac_cv_header_libpri_h&quot; &gt;&amp;5
+echo &quot;${ECHO_T}$ac_cv_header_libpri_h&quot; &gt;&amp;6; }
 else
   # Is the header compilable?
-echo &quot;$as_me:$LINENO: checking libpri.h usability&quot; &gt;&amp;5
-echo $ECHO_N &quot;checking libpri.h usability... $ECHO_C&quot; &gt;&amp;6
+{ echo &quot;$as_me:$LINENO: checking libpri.h usability&quot; &gt;&amp;5
+echo $ECHO_N &quot;checking libpri.h usability... $ECHO_C&quot; &gt;&amp;6; }
 cat &gt;conftest.$ac_ext &lt;&lt;_ACEOF
 /* confdefs.h.  */
 _ACEOF
@@ -9084,15 +10178,16 @@
   echo &quot;$as_me: failed program was:&quot; &gt;&amp;5
 sed 's/^/| /' conftest.$ac_ext &gt;&amp;5
 
-ac_header_compiler=no
+	ac_header_compiler=no
 fi
+
 rm -f conftest.err conftest.$ac_objext conftest.$ac_ext
-echo &quot;$as_me:$LINENO: result: $ac_header_compiler&quot; &gt;&amp;5
-echo &quot;${ECHO_T}$ac_header_compiler&quot; &gt;&amp;6
+{ echo &quot;$as_me:$LINENO: result: $ac_header_compiler&quot; &gt;&amp;5
+echo &quot;${ECHO_T}$ac_header_compiler&quot; &gt;&amp;6; }
 
 # Is the header present?
-echo &quot;$as_me:$LINENO: checking libpri.h presence&quot; &gt;&amp;5
-echo $ECHO_N &quot;checking libpri.h presence... $ECHO_C&quot; &gt;&amp;6
+{ echo &quot;$as_me:$LINENO: checking libpri.h presence&quot; &gt;&amp;5
+echo $ECHO_N &quot;checking libpri.h presence... $ECHO_C&quot; &gt;&amp;6; }
 cat &gt;conftest.$ac_ext &lt;&lt;_ACEOF
 /* confdefs.h.  */
 _ACEOF
@@ -9126,9 +10221,10 @@
 
   ac_header_preproc=no
 fi
+
 rm -f conftest.err conftest.$ac_ext
-echo &quot;$as_me:$LINENO: result: $ac_header_preproc&quot; &gt;&amp;5
-echo &quot;${ECHO_T}$ac_header_preproc&quot; &gt;&amp;6
+{ echo &quot;$as_me:$LINENO: result: $ac_header_preproc&quot; &gt;&amp;5
+echo &quot;${ECHO_T}$ac_header_preproc&quot; &gt;&amp;6; }
 
 # So?  What about this header?
 case $ac_header_compiler:$ac_header_preproc:$ac_c_preproc_warn_flag in
@@ -9152,25 +10248,18 @@
 echo &quot;$as_me: WARNING: libpri.h: proceeding with the preprocessor's result&quot; &gt;&amp;2;}
     { echo &quot;$as_me:$LINENO: WARNING: libpri.h: in the future, the compiler will take precedence&quot; &gt;&amp;5
 echo &quot;$as_me: WARNING: libpri.h: in the future, the compiler will take precedence&quot; &gt;&amp;2;}
-    (
-      cat &lt;&lt;\_ASBOX
-## ------------------------------------------ ##
-## Report this to the AC_PACKAGE_NAME lists.  ##
-## ------------------------------------------ ##
-_ASBOX
-    ) |
-      sed &quot;s/^/$as_me: WARNING:     /&quot; &gt;&amp;2
+
     ;;
 esac
-echo &quot;$as_me:$LINENO: checking for libpri.h&quot; &gt;&amp;5
-echo $ECHO_N &quot;checking for libpri.h... $ECHO_C&quot; &gt;&amp;6
+{ echo &quot;$as_me:$LINENO: checking for libpri.h&quot; &gt;&amp;5
+echo $ECHO_N &quot;checking for libpri.h... $ECHO_C&quot; &gt;&amp;6; }
 if test &quot;${ac_cv_header_libpri_h+set}&quot; = set; then
   echo $ECHO_N &quot;(cached) $ECHO_C&quot; &gt;&amp;6
 else
   ac_cv_header_libpri_h=$ac_header_preproc
 fi
-echo &quot;$as_me:$LINENO: result: $ac_cv_header_libpri_h&quot; &gt;&amp;5
-echo &quot;${ECHO_T}$ac_cv_header_libpri_h&quot; &gt;&amp;6
+{ echo &quot;$as_me:$LINENO: result: $ac_cv_header_libpri_h&quot; &gt;&amp;5
+echo &quot;${ECHO_T}$ac_cv_header_libpri_h&quot; &gt;&amp;6; }
 
 fi
 if test $ac_cv_header_libpri_h = yes; then
@@ -9183,7 +10272,7 @@
 	 fi
       fi
       if test &quot;x${LIBPRI_HEADER_FOUND}&quot; = &quot;x0&quot; ; then
-         if test ! -z &quot;${pri_MANDATORY}&quot; ;
+         if test ! -z &quot;${LIBPRI_MANDATORY}&quot; ;
          then
             echo &quot; ***&quot;
             echo &quot; *** It appears that you do not have the pri development package installed.&quot;
@@ -9191,18 +10280,18 @@
             echo &quot; *** without explicitly specifying --with-pri&quot;
             exit 1
          fi
-         pri_LIB=&quot;&quot;
-         pri_INCLUDE=&quot;&quot;
-         PBX_LIBpri=0
+         LIBPRI_LIB=&quot;&quot;
+         LIBPRI_INCLUDE=&quot;&quot;
+         PBX_LIBLIBPRI=0
       else
-         PBX_LIBpri=1
+         PBX_LIBLIBPRI=1
 
 cat &gt;&gt;confdefs.h &lt;&lt;_ACEOF
 #define HAVE_LIBPRI 1
 _ACEOF
 
       fi
-   elif test ! -z &quot;${pri_MANDATORY}&quot;;
+   elif test ! -z &quot;${LIBPRI_MANDATORY}&quot;;
    then
       echo &quot;***&quot;
       echo &quot;*** The ISDN PRI installation on this system appears to be broken.&quot;
@@ -9217,34 +10306,457 @@
 
 
 
-# Check whether --with-speex or --without-speex was given.
+# Check whether --with-radiusclient-ng was given.
+if test &quot;${with_radiusclient_ng+set}&quot; = set; then
+  withval=$with_radiusclient_ng;
+case ${withval} in
+     n|no)
+     USE_RADIUSCLIENT=no
+     ;;
+     y|ye|yes)
+     RADIUSCLIENT_MANDATORY=&quot;yes&quot;
+     ;;
+     *)
+     RADIUSCLIENT_DIR=&quot;${withval}&quot;
+     RADIUSCLIENT_MANDATORY=&quot;yes&quot;
+     ;;
+esac
+
+fi
+
+
+PBX_LIBRADIUSCLIENT=0
+
+if test &quot;${USE_RADIUSCLIENT}&quot; != &quot;no&quot;; then
+   pbxlibdir=&quot;&quot;
+   if test &quot;x${RADIUSCLIENT_DIR}&quot; != &quot;x&quot;; then
+      pbxlibdir=&quot;-L${radiusclient-ng_DIR}/lib&quot;
+   fi
+   { echo &quot;$as_me:$LINENO: checking for rc_read_config in -lradiusclient-ng&quot; &gt;&amp;5
+echo $ECHO_N &quot;checking for rc_read_config in -lradiusclient-ng... $ECHO_C&quot; &gt;&amp;6; }
+if test &quot;${ac_cv_lib_radiusclient_ng_rc_read_config+set}&quot; = set; then
+  echo $ECHO_N &quot;(cached) $ECHO_C&quot; &gt;&amp;6
+else
+  ac_check_lib_save_LIBS=$LIBS
+LIBS=&quot;-lradiusclient-ng ${pbxlibdir}  $LIBS&quot;
+cat &gt;conftest.$ac_ext &lt;&lt;_ACEOF
+/* confdefs.h.  */
+_ACEOF
+cat confdefs.h &gt;&gt;conftest.$ac_ext
+cat &gt;&gt;conftest.$ac_ext &lt;&lt;_ACEOF
+/* end confdefs.h.  */
+
+/* Override any GCC internal prototype to avoid an error.
+   Use char because int might match the return type of a GCC
+   builtin and then its argument prototype would still apply.  */
+#ifdef __cplusplus
+extern &quot;C&quot;
+#endif
+char rc_read_config ();
+int
+main ()
+{
+return rc_read_config ();
+  ;
+  return 0;
+}
+_ACEOF
+rm -f conftest.$ac_objext conftest$ac_exeext
+if { (eval echo &quot;$as_me:$LINENO: \&quot;$ac_link\&quot;&quot;) &gt;&amp;5
+  (eval $ac_link) 2&gt;conftest.er1
+  ac_status=$?
+  grep -v '^ *+' conftest.er1 &gt;conftest.err
+  rm -f conftest.er1
+  cat conftest.err &gt;&amp;5
+  echo &quot;$as_me:$LINENO: \$? = $ac_status&quot; &gt;&amp;5
+  (exit $ac_status); } &amp;&amp;
+	 { ac_try='test -z &quot;$ac_c_werror_flag&quot;			 || test ! -s conftest.err'
+  { (eval echo &quot;$as_me:$LINENO: \&quot;$ac_try\&quot;&quot;) &gt;&amp;5
+  (eval $ac_try) 2&gt;&amp;5
+  ac_status=$?
+  echo &quot;$as_me:$LINENO: \$? = $ac_status&quot; &gt;&amp;5
+  (exit $ac_status); }; } &amp;&amp;
+	 { ac_try='test -s conftest$ac_exeext'
+  { (eval echo &quot;$as_me:$LINENO: \&quot;$ac_try\&quot;&quot;) &gt;&amp;5
+  (eval $ac_try) 2&gt;&amp;5
+  ac_status=$?
+  echo &quot;$as_me:$LINENO: \$? = $ac_status&quot; &gt;&amp;5
+  (exit $ac_status); }; }; then
+  ac_cv_lib_radiusclient_ng_rc_read_config=yes
+else
+  echo &quot;$as_me: failed program was:&quot; &gt;&amp;5
+sed 's/^/| /' conftest.$ac_ext &gt;&amp;5
+
+	ac_cv_lib_radiusclient_ng_rc_read_config=no
+fi
+
+rm -f conftest.err conftest.$ac_objext \
+      conftest$ac_exeext conftest.$ac_ext
+LIBS=$ac_check_lib_save_LIBS
+fi
+{ echo &quot;$as_me:$LINENO: result: $ac_cv_lib_radiusclient_ng_rc_read_config&quot; &gt;&amp;5
+echo &quot;${ECHO_T}$ac_cv_lib_radiusclient_ng_rc_read_config&quot; &gt;&amp;6; }
+if test $ac_cv_lib_radiusclient_ng_rc_read_config = yes; then
+  AST_RADIUSCLIENT_FOUND=yes
+else
+  AST_RADIUSCLIENT_FOUND=no
+fi
+
+
+   if test &quot;${AST_RADIUSCLIENT_FOUND}&quot; = &quot;yes&quot;; then
+      RADIUSCLIENT_LIB=&quot;-lradiusclient-ng &quot;
+      RADIUSCLIENT_HEADER_FOUND=&quot;1&quot;
+      if test &quot;x${RADIUSCLIENT_DIR}&quot; != &quot;x&quot;; then
+         RADIUSCLIENT_LIB=&quot;${pbxlibdir} ${RADIUSCLIENT_LIB}&quot;
+	 RADIUSCLIENT_INCLUDE=&quot;-I${RADIUSCLIENT_DIR}/include&quot;
+	 if test &quot;xradiusclient-ng.h&quot; != &quot;x&quot; ; then
+	    as_ac_Header=`echo &quot;ac_cv_header_${RADIUSCLIENT_DIR}/include/radiusclient-ng.h&quot; | $as_tr_sh`
+if { as_var=$as_ac_Header; eval &quot;test \&quot;\${$as_var+set}\&quot; = set&quot;; }; then
+  { echo &quot;$as_me:$LINENO: checking for ${RADIUSCLIENT_DIR}/include/radiusclient-ng.h&quot; &gt;&amp;5
+echo $ECHO_N &quot;checking for ${RADIUSCLIENT_DIR}/include/radiusclient-ng.h... $ECHO_C&quot; &gt;&amp;6; }
+if { as_var=$as_ac_Header; eval &quot;test \&quot;\${$as_var+set}\&quot; = set&quot;; }; then
+  echo $ECHO_N &quot;(cached) $ECHO_C&quot; &gt;&amp;6
+fi
+ac_res=`eval echo '${'$as_ac_Header'}'`
+	       { echo &quot;$as_me:$LINENO: result: $ac_res&quot; &gt;&amp;5
+echo &quot;${ECHO_T}$ac_res&quot; &gt;&amp;6; }
+else
+  # Is the header compilable?
+{ echo &quot;$as_me:$LINENO: checking ${RADIUSCLIENT_DIR}/include/radiusclient-ng.h usability&quot; &gt;&amp;5
+echo $ECHO_N &quot;checking ${RADIUSCLIENT_DIR}/include/radiusclient-ng.h usability... $ECHO_C&quot; &gt;&amp;6; }
+cat &gt;conftest.$ac_ext &lt;&lt;_ACEOF
+/* confdefs.h.  */
+_ACEOF
+cat confdefs.h &gt;&gt;conftest.$ac_ext
+cat &gt;&gt;conftest.$ac_ext &lt;&lt;_ACEOF
+/* end confdefs.h.  */
+$ac_includes_default
+#include &lt;${RADIUSCLIENT_DIR}/include/radiusclient-ng.h&gt;
+_ACEOF
+rm -f conftest.$ac_objext
+if { (eval echo &quot;$as_me:$LINENO: \&quot;$ac_compile\&quot;&quot;) &gt;&amp;5
+  (eval $ac_compile) 2&gt;conftest.er1
+  ac_status=$?
+  grep -v '^ *+' conftest.er1 &gt;conftest.err
+  rm -f conftest.er1
+  cat conftest.err &gt;&amp;5
+  echo &quot;$as_me:$LINENO: \$? = $ac_status&quot; &gt;&amp;5
+  (exit $ac_status); } &amp;&amp;
+	 { ac_try='test -z &quot;$ac_c_werror_flag&quot;			 || test ! -s conftest.err'
+  { (eval echo &quot;$as_me:$LINENO: \&quot;$ac_try\&quot;&quot;) &gt;&amp;5
+  (eval $ac_try) 2&gt;&amp;5
+  ac_status=$?
+  echo &quot;$as_me:$LINENO: \$? = $ac_status&quot; &gt;&amp;5
+  (exit $ac_status); }; } &amp;&amp;
+	 { ac_try='test -s conftest.$ac_objext'
+  { (eval echo &quot;$as_me:$LINENO: \&quot;$ac_try\&quot;&quot;) &gt;&amp;5
+  (eval $ac_try) 2&gt;&amp;5
+  ac_status=$?
+  echo &quot;$as_me:$LINENO: \$? = $ac_status&quot; &gt;&amp;5
+  (exit $ac_status); }; }; then
+  ac_header_compiler=yes
+else
+  echo &quot;$as_me: failed program was:&quot; &gt;&amp;5
+sed 's/^/| /' conftest.$ac_ext &gt;&amp;5
+
+	ac_header_compiler=no
+fi
+
+rm -f conftest.err conftest.$ac_objext conftest.$ac_ext
+{ echo &quot;$as_me:$LINENO: result: $ac_header_compiler&quot; &gt;&amp;5
+echo &quot;${ECHO_T}$ac_header_compiler&quot; &gt;&amp;6; }
+
+# Is the header present?
+{ echo &quot;$as_me:$LINENO: checking ${RADIUSCLIENT_DIR}/include/radiusclient-ng.h presence&quot; &gt;&amp;5
+echo $ECHO_N &quot;checking ${RADIUSCLIENT_DIR}/include/radiusclient-ng.h presence... $ECHO_C&quot; &gt;&amp;6; }
+cat &gt;conftest.$ac_ext &lt;&lt;_ACEOF
+/* confdefs.h.  */
+_ACEOF
+cat confdefs.h &gt;&gt;conftest.$ac_ext
+cat &gt;&gt;conftest.$ac_ext &lt;&lt;_ACEOF
+/* end confdefs.h.  */
+#include &lt;${RADIUSCLIENT_DIR}/include/radiusclient-ng.h&gt;
+_ACEOF
+if { (eval echo &quot;$as_me:$LINENO: \&quot;$ac_cpp conftest.$ac_ext\&quot;&quot;) &gt;&amp;5
+  (eval $ac_cpp conftest.$ac_ext) 2&gt;conftest.er1
+  ac_status=$?
+  grep -v '^ *+' conftest.er1 &gt;conftest.err
+  rm -f conftest.er1
+  cat conftest.err &gt;&amp;5
+  echo &quot;$as_me:$LINENO: \$? = $ac_status&quot; &gt;&amp;5
+  (exit $ac_status); } &gt;/dev/null; then
+  if test -s conftest.err; then
+    ac_cpp_err=$ac_c_preproc_warn_flag
+    ac_cpp_err=$ac_cpp_err$ac_c_werror_flag
+  else
+    ac_cpp_err=
+  fi
+else
+  ac_cpp_err=yes
+fi
+if test -z &quot;$ac_cpp_err&quot;; then
+  ac_header_preproc=yes
+else
+  echo &quot;$as_me: failed program was:&quot; &gt;&amp;5
+sed 's/^/| /' conftest.$ac_ext &gt;&amp;5
+
+  ac_header_preproc=no
+fi
+
+rm -f conftest.err conftest.$ac_ext
+{ echo &quot;$as_me:$LINENO: result: $ac_header_preproc&quot; &gt;&amp;5
+echo &quot;${ECHO_T}$ac_header_preproc&quot; &gt;&amp;6; }
+
+# So?  What about this header?
+case $ac_header_compiler:$ac_header_preproc:$ac_c_preproc_warn_flag in
+  yes:no: )
+    { echo &quot;$as_me:$LINENO: WARNING: ${RADIUSCLIENT_DIR}/include/radiusclient-ng.h: accepted by the compiler, rejected by the preprocessor!&quot; &gt;&amp;5
+echo &quot;$as_me: WARNING: ${RADIUSCLIENT_DIR}/include/radiusclient-ng.h: accepted by the compiler, rejected by the preprocessor!&quot; &gt;&amp;2;}
+    { echo &quot;$as_me:$LINENO: WARNING: ${RADIUSCLIENT_DIR}/include/radiusclient-ng.h: proceeding with the compiler's result&quot; &gt;&amp;5
+echo &quot;$as_me: WARNING: ${RADIUSCLIENT_DIR}/include/radiusclient-ng.h: proceeding with the compiler's result&quot; &gt;&amp;2;}
+    ac_header_preproc=yes
+    ;;
+  no:yes:* )
+    { echo &quot;$as_me:$LINENO: WARNING: ${RADIUSCLIENT_DIR}/include/radiusclient-ng.h: present but cannot be compiled&quot; &gt;&amp;5
+echo &quot;$as_me: WARNING: ${RADIUSCLIENT_DIR}/include/radiusclient-ng.h: present but cannot be compiled&quot; &gt;&amp;2;}
+    { echo &quot;$as_me:$LINENO: WARNING: ${RADIUSCLIENT_DIR}/include/radiusclient-ng.h:     check for missing prerequisite headers?&quot; &gt;&amp;5
+echo &quot;$as_me: WARNING: ${RADIUSCLIENT_DIR}/include/radiusclient-ng.h:     check for missing prerequisite headers?&quot; &gt;&amp;2;}
+    { echo &quot;$as_me:$LINENO: WARNING: ${RADIUSCLIENT_DIR}/include/radiusclient-ng.h: see the Autoconf documentation&quot; &gt;&amp;5
+echo &quot;$as_me: WARNING: ${RADIUSCLIENT_DIR}/include/radiusclient-ng.h: see the Autoconf documentation&quot; &gt;&amp;2;}
+    { echo &quot;$as_me:$LINENO: WARNING: ${RADIUSCLIENT_DIR}/include/radiusclient-ng.h:     section \&quot;Present But Cannot Be Compiled\&quot;&quot; &gt;&amp;5
+echo &quot;$as_me: WARNING: ${RADIUSCLIENT_DIR}/include/radiusclient-ng.h:     section \&quot;Present But Cannot Be Compiled\&quot;&quot; &gt;&amp;2;}
+    { echo &quot;$as_me:$LINENO: WARNING: ${RADIUSCLIENT_DIR}/include/radiusclient-ng.h: proceeding with the preprocessor's result&quot; &gt;&amp;5
+echo &quot;$as_me: WARNING: ${RADIUSCLIENT_DIR}/include/radiusclient-ng.h: proceeding with the preprocessor's result&quot; &gt;&amp;2;}
+    { echo &quot;$as_me:$LINENO: WARNING: ${RADIUSCLIENT_DIR}/include/radiusclient-ng.h: in the future, the compiler will take precedence&quot; &gt;&amp;5
+echo &quot;$as_me: WARNING: ${RADIUSCLIENT_DIR}/include/radiusclient-ng.h: in the future, the compiler will take precedence&quot; &gt;&amp;2;}
+
+    ;;
+esac
+{ echo &quot;$as_me:$LINENO: checking for ${RADIUSCLIENT_DIR}/include/radiusclient-ng.h&quot; &gt;&amp;5
+echo $ECHO_N &quot;checking for ${RADIUSCLIENT_DIR}/include/radiusclient-ng.h... $ECHO_C&quot; &gt;&amp;6; }
+if { as_var=$as_ac_Header; eval &quot;test \&quot;\${$as_var+set}\&quot; = set&quot;; }; then
+  echo $ECHO_N &quot;(cached) $ECHO_C&quot; &gt;&amp;6
+else
+  eval &quot;$as_ac_Header=\$ac_header_preproc&quot;
+fi
+ac_res=`eval echo '${'$as_ac_Header'}'`
+	       { echo &quot;$as_me:$LINENO: result: $ac_res&quot; &gt;&amp;5
+echo &quot;${ECHO_T}$ac_res&quot; &gt;&amp;6; }
+
+fi
+if test `eval echo '${'$as_ac_Header'}'` = yes; then
+  RADIUSCLIENT_HEADER_FOUND=1
+else
+  RADIUSCLIENT_HEADER_FOUND=0
+fi
+
+
+	 fi
+      else
+	 if test &quot;xradiusclient-ng.h&quot; != &quot;x&quot; ; then
+            if test &quot;${ac_cv_header_radiusclient_ng_h+set}&quot; = set; then
+  { echo &quot;$as_me:$LINENO: checking for radiusclient-ng.h&quot; &gt;&amp;5
+echo $ECHO_N &quot;checking for radiusclient-ng.h... $ECHO_C&quot; &gt;&amp;6; }
+if test &quot;${ac_cv_header_radiusclient_ng_h+set}&quot; = set; then
+  echo $ECHO_N &quot;(cached) $ECHO_C&quot; &gt;&amp;6
+fi
+{ echo &quot;$as_me:$LINENO: result: $ac_cv_header_radiusclient_ng_h&quot; &gt;&amp;5
+echo &quot;${ECHO_T}$ac_cv_header_radiusclient_ng_h&quot; &gt;&amp;6; }
+else
+  # Is the header compilable?
+{ echo &quot;$as_me:$LINENO: checking radiusclient-ng.h usability&quot; &gt;&amp;5
+echo $ECHO_N &quot;checking radiusclient-ng.h usability... $ECHO_C&quot; &gt;&amp;6; }
+cat &gt;conftest.$ac_ext &lt;&lt;_ACEOF
+/* confdefs.h.  */
+_ACEOF
+cat confdefs.h &gt;&gt;conftest.$ac_ext
+cat &gt;&gt;conftest.$ac_ext &lt;&lt;_ACEOF
+/* end confdefs.h.  */
+$ac_includes_default
+#include &lt;radiusclient-ng.h&gt;
+_ACEOF
+rm -f conftest.$ac_objext
+if { (eval echo &quot;$as_me:$LINENO: \&quot;$ac_compile\&quot;&quot;) &gt;&amp;5
+  (eval $ac_compile) 2&gt;conftest.er1
+  ac_status=$?
+  grep -v '^ *+' conftest.er1 &gt;conftest.err
+  rm -f conftest.er1
+  cat conftest.err &gt;&amp;5
+  echo &quot;$as_me:$LINENO: \$? = $ac_status&quot; &gt;&amp;5
+  (exit $ac_status); } &amp;&amp;
+	 { ac_try='test -z &quot;$ac_c_werror_flag&quot;			 || test ! -s conftest.err'
+  { (eval echo &quot;$as_me:$LINENO: \&quot;$ac_try\&quot;&quot;) &gt;&amp;5
+  (eval $ac_try) 2&gt;&amp;5
+  ac_status=$?
+  echo &quot;$as_me:$LINENO: \$? = $ac_status&quot; &gt;&amp;5
+  (exit $ac_status); }; } &amp;&amp;
+	 { ac_try='test -s conftest.$ac_objext'
+  { (eval echo &quot;$as_me:$LINENO: \&quot;$ac_try\&quot;&quot;) &gt;&amp;5
+  (eval $ac_try) 2&gt;&amp;5
+  ac_status=$?
+  echo &quot;$as_me:$LINENO: \$? = $ac_status&quot; &gt;&amp;5
+  (exit $ac_status); }; }; then
+  ac_header_compiler=yes
+else
+  echo &quot;$as_me: failed program was:&quot; &gt;&amp;5
+sed 's/^/| /' conftest.$ac_ext &gt;&amp;5
+
+	ac_header_compiler=no
+fi
+
+rm -f conftest.err conftest.$ac_objext conftest.$ac_ext
+{ echo &quot;$as_me:$LINENO: result: $ac_header_compiler&quot; &gt;&amp;5
+echo &quot;${ECHO_T}$ac_header_compiler&quot; &gt;&amp;6; }
+
+# Is the header present?
+{ echo &quot;$as_me:$LINENO: checking radiusclient-ng.h presence&quot; &gt;&amp;5
+echo $ECHO_N &quot;checking radiusclient-ng.h presence... $ECHO_C&quot; &gt;&amp;6; }
+cat &gt;conftest.$ac_ext &lt;&lt;_ACEOF
+/* confdefs.h.  */
+_ACEOF
+cat confdefs.h &gt;&gt;conftest.$ac_ext
+cat &gt;&gt;conftest.$ac_ext &lt;&lt;_ACEOF
+/* end confdefs.h.  */
+#include &lt;radiusclient-ng.h&gt;
+_ACEOF
+if { (eval echo &quot;$as_me:$LINENO: \&quot;$ac_cpp conftest.$ac_ext\&quot;&quot;) &gt;&amp;5
+  (eval $ac_cpp conftest.$ac_ext) 2&gt;conftest.er1
+  ac_status=$?
+  grep -v '^ *+' conftest.er1 &gt;conftest.err
+  rm -f conftest.er1
+  cat conftest.err &gt;&amp;5
+  echo &quot;$as_me:$LINENO: \$? = $ac_status&quot; &gt;&amp;5
+  (exit $ac_status); } &gt;/dev/null; then
+  if test -s conftest.err; then
+    ac_cpp_err=$ac_c_preproc_warn_flag
+    ac_cpp_err=$ac_cpp_err$ac_c_werror_flag
+  else
+    ac_cpp_err=
+  fi
+else
+  ac_cpp_err=yes
+fi
+if test -z &quot;$ac_cpp_err&quot;; then
+  ac_header_preproc=yes
+else
+  echo &quot;$as_me: failed program was:&quot; &gt;&amp;5
+sed 's/^/| /' conftest.$ac_ext &gt;&amp;5
+
+  ac_header_preproc=no
+fi
+
+rm -f conftest.err conftest.$ac_ext
+{ echo &quot;$as_me:$LINENO: result: $ac_header_preproc&quot; &gt;&amp;5
+echo &quot;${ECHO_T}$ac_header_preproc&quot; &gt;&amp;6; }
+
+# So?  What about this header?
+case $ac_header_compiler:$ac_header_preproc:$ac_c_preproc_warn_flag in
+  yes:no: )
+    { echo &quot;$as_me:$LINENO: WARNING: radiusclient-ng.h: accepted by the compiler, rejected by the preprocessor!&quot; &gt;&amp;5
+echo &quot;$as_me: WARNING: radiusclient-ng.h: accepted by the compiler, rejected by the preprocessor!&quot; &gt;&amp;2;}
+    { echo &quot;$as_me:$LINENO: WARNING: radiusclient-ng.h: proceeding with the compiler's result&quot; &gt;&amp;5
+echo &quot;$as_me: WARNING: radiusclient-ng.h: proceeding with the compiler's result&quot; &gt;&amp;2;}
+    ac_header_preproc=yes
+    ;;
+  no:yes:* )
+    { echo &quot;$as_me:$LINENO: WARNING: radiusclient-ng.h: present but cannot be compiled&quot; &gt;&amp;5
+echo &quot;$as_me: WARNING: radiusclient-ng.h: present but cannot be compiled&quot; &gt;&amp;2;}
+    { echo &quot;$as_me:$LINENO: WARNING: radiusclient-ng.h:     check for missing prerequisite headers?&quot; &gt;&amp;5
+echo &quot;$as_me: WARNING: radiusclient-ng.h:     check for missing prerequisite headers?&quot; &gt;&amp;2;}
+    { echo &quot;$as_me:$LINENO: WARNING: radiusclient-ng.h: see the Autoconf documentation&quot; &gt;&amp;5
+echo &quot;$as_me: WARNING: radiusclient-ng.h: see the Autoconf documentation&quot; &gt;&amp;2;}
+    { echo &quot;$as_me:$LINENO: WARNING: radiusclient-ng.h:     section \&quot;Present But Cannot Be Compiled\&quot;&quot; &gt;&amp;5
+echo &quot;$as_me: WARNING: radiusclient-ng.h:     section \&quot;Present But Cannot Be Compiled\&quot;&quot; &gt;&amp;2;}
+    { echo &quot;$as_me:$LINENO: WARNING: radiusclient-ng.h: proceeding with the preprocessor's result&quot; &gt;&amp;5
+echo &quot;$as_me: WARNING: radiusclient-ng.h: proceeding with the preprocessor's result&quot; &gt;&amp;2;}
+    { echo &quot;$as_me:$LINENO: WARNING: radiusclient-ng.h: in the future, the compiler will take precedence&quot; &gt;&amp;5
+echo &quot;$as_me: WARNING: radiusclient-ng.h: in the future, the compiler will take precedence&quot; &gt;&amp;2;}
+
+    ;;
+esac
+{ echo &quot;$as_me:$LINENO: checking for radiusclient-ng.h&quot; &gt;&amp;5
+echo $ECHO_N &quot;checking for radiusclient-ng.h... $ECHO_C&quot; &gt;&amp;6; }
+if test &quot;${ac_cv_header_radiusclient_ng_h+set}&quot; = set; then
+  echo $ECHO_N &quot;(cached) $ECHO_C&quot; &gt;&amp;6
+else
+  ac_cv_header_radiusclient_ng_h=$ac_header_preproc
+fi
+{ echo &quot;$as_me:$LINENO: result: $ac_cv_header_radiusclient_ng_h&quot; &gt;&amp;5
+echo &quot;${ECHO_T}$ac_cv_header_radiusclient_ng_h&quot; &gt;&amp;6; }
+
+fi
+if test $ac_cv_header_radiusclient_ng_h = yes; then
+  RADIUSCLIENT_HEADER_FOUND=1
+else
+  RADIUSCLIENT_HEADER_FOUND=0
+fi
+
+
+	 fi
+      fi
+      if test &quot;x${RADIUSCLIENT_HEADER_FOUND}&quot; = &quot;x0&quot; ; then
+         if test ! -z &quot;${RADIUSCLIENT_MANDATORY}&quot; ;
+         then
+            echo &quot; ***&quot;
+            echo &quot; *** It appears that you do not have the radiusclient-ng development package installed.&quot;
+            echo &quot; *** Please install it to include Radius Client support, or re-run configure&quot;
+            echo &quot; *** without explicitly specifying --with-radiusclient-ng&quot;
+            exit 1
+         fi
+         RADIUSCLIENT_LIB=&quot;&quot;
+         RADIUSCLIENT_INCLUDE=&quot;&quot;
+         PBX_LIBRADIUSCLIENT=0
+      else
+         PBX_LIBRADIUSCLIENT=1
+
+cat &gt;&gt;confdefs.h &lt;&lt;_ACEOF
+#define HAVE_RADIUSCLIENT 1
+_ACEOF
+
+      fi
+   elif test ! -z &quot;${RADIUSCLIENT_MANDATORY}&quot;;
+   then
+      echo &quot;***&quot;
+      echo &quot;*** The Radius Client installation on this system appears to be broken.&quot;
+      echo &quot;*** Either correct the installation, or run configure&quot;
+      echo &quot;*** without explicity specifying --with-radiusclient-ng&quot;
+      exit 1
+   fi
+fi
+
+
+
+
+
+
+# Check whether --with-speex was given.
 if test &quot;${with_speex+set}&quot; = set; then
-  withval=&quot;$with_speex&quot;
-
+  withval=$with_speex;
 case ${withval} in
      n|no)
-     USE_speex=no
+     USE_SPEEX=no
      ;;
      y|ye|yes)
-     speex_MANDATORY=&quot;yes&quot;
+     SPEEX_MANDATORY=&quot;yes&quot;
      ;;
      *)
-     speex_DIR=&quot;${withval}&quot;
-     speex_MANDATORY=&quot;yes&quot;
+     SPEEX_DIR=&quot;${withval}&quot;
+     SPEEX_MANDATORY=&quot;yes&quot;
      ;;
 esac
 
-fi;
+fi
 
-PBX_LIBspeex=0
 
-if test &quot;${USE_speex}&quot; != &quot;no&quot;; then
+PBX_LIBSPEEX=0
+
+if test &quot;${USE_SPEEX}&quot; != &quot;no&quot;; then
    pbxlibdir=&quot;&quot;
-   if test &quot;x${speex_DIR}&quot; != &quot;x&quot;; then
+   if test &quot;x${SPEEX_DIR}&quot; != &quot;x&quot;; then
       pbxlibdir=&quot;-L${speex_DIR}/lib&quot;
    fi
-   echo &quot;$as_me:$LINENO: checking for speex_encode in -lspeex&quot; &gt;&amp;5
-echo $ECHO_N &quot;checking for speex_encode in -lspeex... $ECHO_C&quot; &gt;&amp;6
+   { echo &quot;$as_me:$LINENO: checking for speex_encode in -lspeex&quot; &gt;&amp;5
+echo $ECHO_N &quot;checking for speex_encode in -lspeex... $ECHO_C&quot; &gt;&amp;6; }
 if test &quot;${ac_cv_lib_speex_speex_encode+set}&quot; = set; then
   echo $ECHO_N &quot;(cached) $ECHO_C&quot; &gt;&amp;6
 else
@@ -9257,17 +10769,17 @@
 cat &gt;&gt;conftest.$ac_ext &lt;&lt;_ACEOF
 /* end confdefs.h.  */
 
-/* Override any gcc2 internal prototype to avoid an error.  */
+/* Override any GCC internal prototype to avoid an error.
+   Use char because int might match the return type of a GCC
+   builtin and then its argument prototype would still apply.  */
 #ifdef __cplusplus
 extern &quot;C&quot;
 #endif
-/* We use char because int might match the return type of a gcc2
-   builtin and then its argument prototype would still apply.  */
 char speex_encode ();
 int
 main ()
 {
-speex_encode ();
+return speex_encode ();
   ;
   return 0;
 }
@@ -9299,39 +10811,43 @@
   echo &quot;$as_me: failed program was:&quot; &gt;&amp;5
 sed 's/^/| /' conftest.$ac_ext &gt;&amp;5
 
-ac_cv_lib_speex_speex_encode=no
+	ac_cv_lib_speex_speex_encode=no
 fi
+
 rm -f conftest.err conftest.$ac_objext \
       conftest$ac_exeext conftest.$ac_ext
 LIBS=$ac_check_lib_save_LIBS
 fi
-echo &quot;$as_me:$LINENO: result: $ac_cv_lib_speex_speex_encode&quot; &gt;&amp;5
-echo &quot;${ECHO_T}$ac_cv_lib_speex_speex_encode&quot; &gt;&amp;6
+{ echo &quot;$as_me:$LINENO: result: $ac_cv_lib_speex_speex_encode&quot; &gt;&amp;5
+echo &quot;${ECHO_T}$ac_cv_lib_speex_speex_encode&quot; &gt;&amp;6; }
 if test $ac_cv_lib_speex_speex_encode = yes; then
-  :
+  AST_SPEEX_FOUND=yes
+else
+  AST_SPEEX_FOUND=no
 fi
 
 
-   if test &quot;${ac_cv_lib_speex_speex_encode}&quot; = &quot;yes&quot;; then
-      speex_LIB=&quot;-lspeex -lm&quot;
+   if test &quot;${AST_SPEEX_FOUND}&quot; = &quot;yes&quot;; then
+      SPEEX_LIB=&quot;-lspeex -lm&quot;
       SPEEX_HEADER_FOUND=&quot;1&quot;
-      if test &quot;x${speex_DIR}&quot; != &quot;x&quot;; then
-         speex_LIB=&quot;${pbxlibdir} ${speex_LIB}&quot;
-	 speex_INCLUDE=&quot;-I${speex_DIR}/include&quot;
+      if test &quot;x${SPEEX_DIR}&quot; != &quot;x&quot;; then
+         SPEEX_LIB=&quot;${pbxlibdir} ${SPEEX_LIB}&quot;
+	 SPEEX_INCLUDE=&quot;-I${SPEEX_DIR}/include&quot;
 	 if test &quot;xspeex/speex.h&quot; != &quot;x&quot; ; then
-	    as_ac_Header=`echo &quot;ac_cv_header_${speex_DIR}/include/speex/speex.h&quot; | $as_tr_sh`
-if eval &quot;test \&quot;\${$as_ac_Header+set}\&quot; = set&quot;; then
-  echo &quot;$as_me:$LINENO: checking for ${speex_DIR}/include/speex/speex.h&quot; &gt;&amp;5
-echo $ECHO_N &quot;checking for ${speex_DIR}/include/speex/speex.h... $ECHO_C&quot; &gt;&amp;6
-if eval &quot;test \&quot;\${$as_ac_Header+set}\&quot; = set&quot;; then
+	    as_ac_Header=`echo &quot;ac_cv_header_${SPEEX_DIR}/include/speex/speex.h&quot; | $as_tr_sh`
+if { as_var=$as_ac_Header; eval &quot;test \&quot;\${$as_var+set}\&quot; = set&quot;; }; then
+  { echo &quot;$as_me:$LINENO: checking for ${SPEEX_DIR}/include/speex/speex.h&quot; &gt;&amp;5
+echo $ECHO_N &quot;checking for ${SPEEX_DIR}/include/speex/speex.h... $ECHO_C&quot; &gt;&amp;6; }
+if { as_var=$as_ac_Header; eval &quot;test \&quot;\${$as_var+set}\&quot; = set&quot;; }; then
   echo $ECHO_N &quot;(cached) $ECHO_C&quot; &gt;&amp;6
 fi
-echo &quot;$as_me:$LINENO: result: `eval echo '${'$as_ac_Header'}'`&quot; &gt;&amp;5
-echo &quot;${ECHO_T}`eval echo '${'$as_ac_Header'}'`&quot; &gt;&amp;6
+ac_res=`eval echo '${'$as_ac_Header'}'`
+	       { echo &quot;$as_me:$LINENO: result: $ac_res&quot; &gt;&amp;5
+echo &quot;${ECHO_T}$ac_res&quot; &gt;&amp;6; }
 else
   # Is the header compilable?
-echo &quot;$as_me:$LINENO: checking ${speex_DIR}/include/speex/speex.h usability&quot; &gt;&amp;5
-echo $ECHO_N &quot;checking ${speex_DIR}/include/speex/speex.h usability... $ECHO_C&quot; &gt;&amp;6
+{ echo &quot;$as_me:$LINENO: checking ${SPEEX_DIR}/include/speex/speex.h usability&quot; &gt;&amp;5
+echo $ECHO_N &quot;checking ${SPEEX_DIR}/include/speex/speex.h usability... $ECHO_C&quot; &gt;&amp;6; }
 cat &gt;conftest.$ac_ext &lt;&lt;_ACEOF
 /* confdefs.h.  */
 _ACEOF
@@ -9339,7 +10855,7 @@
 cat &gt;&gt;conftest.$ac_ext &lt;&lt;_ACEOF
 /* end confdefs.h.  */
 $ac_includes_default
-#include &lt;${speex_DIR}/include/speex/speex.h&gt;
+#include &lt;${SPEEX_DIR}/include/speex/speex.h&gt;
 _ACEOF
 rm -f conftest.$ac_objext
 if { (eval echo &quot;$as_me:$LINENO: \&quot;$ac_compile\&quot;&quot;) &gt;&amp;5
@@ -9368,22 +10884,23 @@
   echo &quot;$as_me: failed program was:&quot; &gt;&amp;5
 sed 's/^/| /' conftest.$ac_ext &gt;&amp;5
 
-ac_header_compiler=no
+	ac_header_compiler=no
 fi
+
 rm -f conftest.err conftest.$ac_objext conftest.$ac_ext
-echo &quot;$as_me:$LINENO: result: $ac_header_compiler&quot; &gt;&amp;5
-echo &quot;${ECHO_T}$ac_header_compiler&quot; &gt;&amp;6
+{ echo &quot;$as_me:$LINENO: result: $ac_header_compiler&quot; &gt;&amp;5
+echo &quot;${ECHO_T}$ac_header_compiler&quot; &gt;&amp;6; }
 
 # Is the header present?
-echo &quot;$as_me:$LINENO: checking ${speex_DIR}/include/speex/speex.h presence&quot; &gt;&amp;5
-echo $ECHO_N &quot;checking ${speex_DIR}/include/speex/speex.h presence... $ECHO_C&quot; &gt;&amp;6
+{ echo &quot;$as_me:$LINENO: checking ${SPEEX_DIR}/include/speex/speex.h presence&quot; &gt;&amp;5
+echo $ECHO_N &quot;checking ${SPEEX_DIR}/include/speex/speex.h presence... $ECHO_C&quot; &gt;&amp;6; }
 cat &gt;conftest.$ac_ext &lt;&lt;_ACEOF
 /* confdefs.h.  */
 _ACEOF
 cat confdefs.h &gt;&gt;conftest.$ac_ext
 cat &gt;&gt;conftest.$ac_ext &lt;&lt;_ACEOF
 /* end confdefs.h.  */
-#include &lt;${speex_DIR}/include/speex/speex.h&gt;
+#include &lt;${SPEEX_DIR}/include/speex/speex.h&gt;
 _ACEOF
 if { (eval echo &quot;$as_me:$LINENO: \&quot;$ac_cpp conftest.$ac_ext\&quot;&quot;) &gt;&amp;5
   (eval $ac_cpp conftest.$ac_ext) 2&gt;conftest.er1
@@ -9410,51 +10927,46 @@
 
   ac_header_preproc=no
 fi
+
 rm -f conftest.err conftest.$ac_ext
-echo &quot;$as_me:$LINENO: result: $ac_header_preproc&quot; &gt;&amp;5
-echo &quot;${ECHO_T}$ac_header_preproc&quot; &gt;&amp;6
+{ echo &quot;$as_me:$LINENO: result: $ac_header_preproc&quot; &gt;&amp;5
+echo &quot;${ECHO_T}$ac_header_preproc&quot; &gt;&amp;6; }
 
 # So?  What about this header?
 case $ac_header_compiler:$ac_header_preproc:$ac_c_preproc_warn_flag in
   yes:no: )
-    { echo &quot;$as_me:$LINENO: WARNING: ${speex_DIR}/include/speex/speex.h: accepted by the compiler, rejected by the preprocessor!&quot; &gt;&amp;5
-echo &quot;$as_me: WARNING: ${speex_DIR}/include/speex/speex.h: accepted by the compiler, rejected by the preprocessor!&quot; &gt;&amp;2;}
-    { echo &quot;$as_me:$LINENO: WARNING: ${speex_DIR}/include/speex/speex.h: proceeding with the compiler's result&quot; &gt;&amp;5
-echo &quot;$as_me: WARNING: ${speex_DIR}/include/speex/speex.h: proceeding with the compiler's result&quot; &gt;&amp;2;}
+    { echo &quot;$as_me:$LINENO: WARNING: ${SPEEX_DIR}/include/speex/speex.h: accepted by the compiler, rejected by the preprocessor!&quot; &gt;&amp;5
+echo &quot;$as_me: WARNING: ${SPEEX_DIR}/include/speex/speex.h: accepted by the compiler, rejected by the preprocessor!&quot; &gt;&amp;2;}
+    { echo &quot;$as_me:$LINENO: WARNING: ${SPEEX_DIR}/include/speex/speex.h: proceeding with the compiler's result&quot; &gt;&amp;5
+echo &quot;$as_me: WARNING: ${SPEEX_DIR}/include/speex/speex.h: proceeding with the compiler's result&quot; &gt;&amp;2;}
     ac_header_preproc=yes
     ;;
   no:yes:* )
-    { echo &quot;$as_me:$LINENO: WARNING: ${speex_DIR}/include/speex/speex.h: present but cannot be compiled&quot; &gt;&amp;5
-echo &quot;$as_me: WARNING: ${speex_DIR}/include/speex/speex.h: present but cannot be compiled&quot; &gt;&amp;2;}
-    { echo &quot;$as_me:$LINENO: WARNING: ${speex_DIR}/include/speex/speex.h:     check for missing prerequisite headers?&quot; &gt;&amp;5
-echo &quot;$as_me: WARNING: ${speex_DIR}/include/speex/speex.h:     check for missing prerequisite headers?&quot; &gt;&amp;2;}
-    { echo &quot;$as_me:$LINENO: WARNING: ${speex_DIR}/include/speex/speex.h: see the Autoconf documentation&quot; &gt;&amp;5
-echo &quot;$as_me: WARNING: ${speex_DIR}/include/speex/speex.h: see the Autoconf documentation&quot; &gt;&amp;2;}
-    { echo &quot;$as_me:$LINENO: WARNING: ${speex_DIR}/include/speex/speex.h:     section \&quot;Present But Cannot Be Compiled\&quot;&quot; &gt;&amp;5
-echo &quot;$as_me: WARNING: ${speex_DIR}/include/speex/speex.h:     section \&quot;Present But Cannot Be Compiled\&quot;&quot; &gt;&amp;2;}
-    { echo &quot;$as_me:$LINENO: WARNING: ${speex_DIR}/include/speex/speex.h: proceeding with the preprocessor's result&quot; &gt;&amp;5
-echo &quot;$as_me: WARNING: ${speex_DIR}/include/speex/speex.h: proceeding with the preprocessor's result&quot; &gt;&amp;2;}
-    { echo &quot;$as_me:$LINENO: WARNING: ${speex_DIR}/include/speex/speex.h: in the future, the compiler will take precedence&quot; &gt;&amp;5
-echo &quot;$as_me: WARNING: ${speex_DIR}/include/speex/speex.h: in the future, the compiler will take precedence&quot; &gt;&amp;2;}
-    (
-      cat &lt;&lt;\_ASBOX
-## ------------------------------------------ ##
-## Report this to the AC_PACKAGE_NAME lists.  ##
-## ------------------------------------------ ##
-_ASBOX
-    ) |
-      sed &quot;s/^/$as_me: WARNING:     /&quot; &gt;&amp;2
+    { echo &quot;$as_me:$LINENO: WARNING: ${SPEEX_DIR}/include/speex/speex.h: present but cannot be compiled&quot; &gt;&amp;5
+echo &quot;$as_me: WARNING: ${SPEEX_DIR}/include/speex/speex.h: present but cannot be compiled&quot; &gt;&amp;2;}
+    { echo &quot;$as_me:$LINENO: WARNING: ${SPEEX_DIR}/include/speex/speex.h:     check for missing prerequisite headers?&quot; &gt;&amp;5
+echo &quot;$as_me: WARNING: ${SPEEX_DIR}/include/speex/speex.h:     check for missing prerequisite headers?&quot; &gt;&amp;2;}
+    { echo &quot;$as_me:$LINENO: WARNING: ${SPEEX_DIR}/include/speex/speex.h: see the Autoconf documentation&quot; &gt;&amp;5
+echo &quot;$as_me: WARNING: ${SPEEX_DIR}/include/speex/speex.h: see the Autoconf documentation&quot; &gt;&amp;2;}
+    { echo &quot;$as_me:$LINENO: WARNING: ${SPEEX_DIR}/include/speex/speex.h:     section \&quot;Present But Cannot Be Compiled\&quot;&quot; &gt;&amp;5
+echo &quot;$as_me: WARNING: ${SPEEX_DIR}/include/speex/speex.h:     section \&quot;Present But Cannot Be Compiled\&quot;&quot; &gt;&amp;2;}
+    { echo &quot;$as_me:$LINENO: WARNING: ${SPEEX_DIR}/include/speex/speex.h: proceeding with the preprocessor's result&quot; &gt;&amp;5
+echo &quot;$as_me: WARNING: ${SPEEX_DIR}/include/speex/speex.h: proceeding with the preprocessor's result&quot; &gt;&amp;2;}
+    { echo &quot;$as_me:$LINENO: WARNING: ${SPEEX_DIR}/include/speex/speex.h: in the future, the compiler will take precedence&quot; &gt;&amp;5
+echo &quot;$as_me: WARNING: ${SPEEX_DIR}/include/speex/speex.h: in the future, the compiler will take precedence&quot; &gt;&amp;2;}
+
     ;;
 esac
-echo &quot;$as_me:$LINENO: checking for ${speex_DIR}/include/speex/speex.h&quot; &gt;&amp;5
-echo $ECHO_N &quot;checking for ${speex_DIR}/include/speex/speex.h... $ECHO_C&quot; &gt;&amp;6
-if eval &quot;test \&quot;\${$as_ac_Header+set}\&quot; = set&quot;; then
+{ echo &quot;$as_me:$LINENO: checking for ${SPEEX_DIR}/include/speex/speex.h&quot; &gt;&amp;5
+echo $ECHO_N &quot;checking for ${SPEEX_DIR}/include/speex/speex.h... $ECHO_C&quot; &gt;&amp;6; }
+if { as_var=$as_ac_Header; eval &quot;test \&quot;\${$as_var+set}\&quot; = set&quot;; }; then
   echo $ECHO_N &quot;(cached) $ECHO_C&quot; &gt;&amp;6
 else
   eval &quot;$as_ac_Header=\$ac_header_preproc&quot;
 fi
-echo &quot;$as_me:$LINENO: result: `eval echo '${'$as_ac_Header'}'`&quot; &gt;&amp;5
-echo &quot;${ECHO_T}`eval echo '${'$as_ac_Header'}'`&quot; &gt;&amp;6
+ac_res=`eval echo '${'$as_ac_Header'}'`
+	       { echo &quot;$as_me:$LINENO: result: $ac_res&quot; &gt;&amp;5
+echo &quot;${ECHO_T}$ac_res&quot; &gt;&amp;6; }
 
 fi
 if test `eval echo '${'$as_ac_Header'}'` = yes; then
@@ -9468,17 +10980,17 @@
       else
 	 if test &quot;xspeex/speex.h&quot; != &quot;x&quot; ; then
             if test &quot;${ac_cv_header_speex_speex_h+set}&quot; = set; then
-  echo &quot;$as_me:$LINENO: checking for speex/speex.h&quot; &gt;&amp;5
-echo $ECHO_N &quot;checking for speex/speex.h... $ECHO_C&quot; &gt;&amp;6
+  { echo &quot;$as_me:$LINENO: checking for speex/speex.h&quot; &gt;&amp;5
+echo $ECHO_N &quot;checking for speex/speex.h... $ECHO_C&quot; &gt;&amp;6; }
 if test &quot;${ac_cv_header_speex_speex_h+set}&quot; = set; then
   echo $ECHO_N &quot;(cached) $ECHO_C&quot; &gt;&amp;6
 fi
-echo &quot;$as_me:$LINENO: result: $ac_cv_header_speex_speex_h&quot; &gt;&amp;5
-echo &quot;${ECHO_T}$ac_cv_header_speex_speex_h&quot; &gt;&amp;6
+{ echo &quot;$as_me:$LINENO: result: $ac_cv_header_speex_speex_h&quot; &gt;&amp;5
+echo &quot;${ECHO_T}$ac_cv_header_speex_speex_h&quot; &gt;&amp;6; }
 else
   # Is the header compilable?
-echo &quot;$as_me:$LINENO: checking speex/speex.h usability&quot; &gt;&amp;5
-echo $ECHO_N &quot;checking speex/speex.h usability... $ECHO_C&quot; &gt;&amp;6
+{ echo &quot;$as_me:$LINENO: checking speex/speex.h usability&quot; &gt;&amp;5
+echo $ECHO_N &quot;checking speex/speex.h usability... $ECHO_C&quot; &gt;&amp;6; }
 cat &gt;conftest.$ac_ext &lt;&lt;_ACEOF
 /* confdefs.h.  */
 _ACEOF
@@ -9515,15 +11027,16 @@
   echo &quot;$as_me: failed program was:&quot; &gt;&amp;5
 sed 's/^/| /' conftest.$ac_ext &gt;&amp;5
 
-ac_header_compiler=no
+	ac_header_compiler=no
 fi
+
 rm -f conftest.err conftest.$ac_objext conftest.$ac_ext
-echo &quot;$as_me:$LINENO: result: $ac_header_compiler&quot; &gt;&amp;5
-echo &quot;${ECHO_T}$ac_header_compiler&quot; &gt;&amp;6
+{ echo &quot;$as_me:$LINENO: result: $ac_header_compiler&quot; &gt;&amp;5
+echo &quot;${ECHO_T}$ac_header_compiler&quot; &gt;&amp;6; }
 
 # Is the header present?
-echo &quot;$as_me:$LINENO: checking speex/speex.h presence&quot; &gt;&amp;5
-echo $ECHO_N &quot;checking speex/speex.h presence... $ECHO_C&quot; &gt;&amp;6
+{ echo &quot;$as_me:$LINENO: checking speex/speex.h presence&quot; &gt;&amp;5
+echo $ECHO_N &quot;checking speex/speex.h presence... $ECHO_C&quot; &gt;&amp;6; }
 cat &gt;conftest.$ac_ext &lt;&lt;_ACEOF
 /* confdefs.h.  */
 _ACEOF
@@ -9557,9 +11070,10 @@
 
   ac_header_preproc=no
 fi
+
 rm -f conftest.err conftest.$ac_ext
-echo &quot;$as_me:$LINENO: result: $ac_header_preproc&quot; &gt;&amp;5
-echo &quot;${ECHO_T}$ac_header_preproc&quot; &gt;&amp;6
+{ echo &quot;$as_me:$LINENO: result: $ac_header_preproc&quot; &gt;&amp;5
+echo &quot;${ECHO_T}$ac_header_preproc&quot; &gt;&amp;6; }
 
 # So?  What about this header?
 case $ac_header_compiler:$ac_header_preproc:$ac_c_preproc_warn_flag in
@@ -9583,25 +11097,18 @@
 echo &quot;$as_me: WARNING: speex/speex.h: proceeding with the preprocessor's result&quot; &gt;&amp;2;}
     { echo &quot;$as_me:$LINENO: WARNING: speex/speex.h: in the future, the compiler will take precedence&quot; &gt;&amp;5
 echo &quot;$as_me: WARNING: speex/speex.h: in the future, the compiler will take precedence&quot; &gt;&amp;2;}
-    (
-      cat &lt;&lt;\_ASBOX
-## ------------------------------------------ ##
-## Report this to the AC_PACKAGE_NAME lists.  ##
-## ------------------------------------------ ##
-_ASBOX
-    ) |
-      sed &quot;s/^/$as_me: WARNING:     /&quot; &gt;&amp;2
+
     ;;
 esac
-echo &quot;$as_me:$LINENO: checking for speex/speex.h&quot; &gt;&amp;5
-echo $ECHO_N &quot;checking for speex/speex.h... $ECHO_C&quot; &gt;&amp;6
+{ echo &quot;$as_me:$LINENO: checking for speex/speex.h&quot; &gt;&amp;5
+echo $ECHO_N &quot;checking for speex/speex.h... $ECHO_C&quot; &gt;&amp;6; }
 if test &quot;${ac_cv_header_speex_speex_h+set}&quot; = set; then
   echo $ECHO_N &quot;(cached) $ECHO_C&quot; &gt;&amp;6
 else
   ac_cv_header_speex_speex_h=$ac_header_preproc
 fi
-echo &quot;$as_me:$LINENO: result: $ac_cv_header_speex_speex_h&quot; &gt;&amp;5
-echo &quot;${ECHO_T}$ac_cv_header_speex_speex_h&quot; &gt;&amp;6
+{ echo &quot;$as_me:$LINENO: result: $ac_cv_header_speex_speex_h&quot; &gt;&amp;5
+echo &quot;${ECHO_T}$ac_cv_header_speex_speex_h&quot; &gt;&amp;6; }
 
 fi
 if test $ac_cv_header_speex_speex_h = yes; then
@@ -9614,7 +11121,7 @@
 	 fi
       fi
       if test &quot;x${SPEEX_HEADER_FOUND}&quot; = &quot;x0&quot; ; then
-         if test ! -z &quot;${speex_MANDATORY}&quot; ;
+         if test ! -z &quot;${SPEEX_MANDATORY}&quot; ;
          then
             echo &quot; ***&quot;
             echo &quot; *** It appears that you do not have the speex development package installed.&quot;
@@ -9622,18 +11129,18 @@
             echo &quot; *** without explicitly specifying --with-speex&quot;
             exit 1
          fi
-         speex_LIB=&quot;&quot;
-         speex_INCLUDE=&quot;&quot;
-         PBX_LIBspeex=0
+         SPEEX_LIB=&quot;&quot;
+         SPEEX_INCLUDE=&quot;&quot;
+         PBX_LIBSPEEX=0
       else
-         PBX_LIBspeex=1
+         PBX_LIBSPEEX=1
 
 cat &gt;&gt;confdefs.h &lt;&lt;_ACEOF
 #define HAVE_SPEEX 1
 _ACEOF
 
       fi
-   elif test ! -z &quot;${speex_MANDATORY}&quot;;
+   elif test ! -z &quot;${SPEEX_MANDATORY}&quot;;
    then
       echo &quot;***&quot;
       echo &quot;*** The Speex installation on this system appears to be broken.&quot;
@@ -9648,34 +11155,34 @@
 
 
 
-# Check whether --with-sqlite or --without-sqlite was given.
+# Check whether --with-sqlite was given.
 if test &quot;${with_sqlite+set}&quot; = set; then
-  withval=&quot;$with_sqlite&quot;
-
+  withval=$with_sqlite;
 case ${withval} in
      n|no)
-     USE_sqlite=no
+     USE_SQLITE=no
      ;;
      y|ye|yes)
-     sqlite_MANDATORY=&quot;yes&quot;
+     SQLITE_MANDATORY=&quot;yes&quot;
      ;;
      *)
-     sqlite_DIR=&quot;${withval}&quot;
-     sqlite_MANDATORY=&quot;yes&quot;
+     SQLITE_DIR=&quot;${withval}&quot;
+     SQLITE_MANDATORY=&quot;yes&quot;
      ;;
 esac
 
-fi;
+fi
 
-PBX_LIBsqlite=0
 
-if test &quot;${USE_sqlite}&quot; != &quot;no&quot;; then
+PBX_LIBSQLITE=0
+
+if test &quot;${USE_SQLITE}&quot; != &quot;no&quot;; then
    pbxlibdir=&quot;&quot;
-   if test &quot;x${sqlite_DIR}&quot; != &quot;x&quot;; then
+   if test &quot;x${SQLITE_DIR}&quot; != &quot;x&quot;; then
       pbxlibdir=&quot;-L${sqlite_DIR}/lib&quot;
    fi
-   echo &quot;$as_me:$LINENO: checking for sqlite_exec in -lsqlite&quot; &gt;&amp;5
-echo $ECHO_N &quot;checking for sqlite_exec in -lsqlite... $ECHO_C&quot; &gt;&amp;6
+   { echo &quot;$as_me:$LINENO: checking for sqlite_exec in -lsqlite&quot; &gt;&amp;5
+echo $ECHO_N &quot;checking for sqlite_exec in -lsqlite... $ECHO_C&quot; &gt;&amp;6; }
 if test &quot;${ac_cv_lib_sqlite_sqlite_exec+set}&quot; = set; then
   echo $ECHO_N &quot;(cached) $ECHO_C&quot; &gt;&amp;6
 else
@@ -9688,17 +11195,17 @@
 cat &gt;&gt;conftest.$ac_ext &lt;&lt;_ACEOF
 /* end confdefs.h.  */
 
-/* Override any gcc2 internal prototype to avoid an error.  */
+/* Override any GCC internal prototype to avoid an error.
+   Use char because int might match the return type of a GCC
+   builtin and then its argument prototype would still apply.  */
 #ifdef __cplusplus
 extern &quot;C&quot;
 #endif
-/* We use char because int might match the return type of a gcc2
-   builtin and then its argument prototype would still apply.  */
 char sqlite_exec ();
 int
 main ()
 {
-sqlite_exec ();
+return sqlite_exec ();
   ;
   return 0;
 }
@@ -9730,39 +11237,43 @@
   echo &quot;$as_me: failed program was:&quot; &gt;&amp;5
 sed 's/^/| /' conftest.$ac_ext &gt;&amp;5
 
-ac_cv_lib_sqlite_sqlite_exec=no
+	ac_cv_lib_sqlite_sqlite_exec=no
 fi
+
 rm -f conftest.err conftest.$ac_objext \
       conftest$ac_exeext conftest.$ac_ext
 LIBS=$ac_check_lib_save_LIBS
 fi
-echo &quot;$as_me:$LINENO: result: $ac_cv_lib_sqlite_sqlite_exec&quot; &gt;&amp;5
-echo &quot;${ECHO_T}$ac_cv_lib_sqlite_sqlite_exec&quot; &gt;&amp;6
+{ echo &quot;$as_me:$LINENO: result: $ac_cv_lib_sqlite_sqlite_exec&quot; &gt;&amp;5
+echo &quot;${ECHO_T}$ac_cv_lib_sqlite_sqlite_exec&quot; &gt;&amp;6; }
 if test $ac_cv_lib_sqlite_sqlite_exec = yes; then
-  :
+  AST_SQLITE_FOUND=yes
+else
+  AST_SQLITE_FOUND=no
 fi
 
 
-   if test &quot;${ac_cv_lib_sqlite_sqlite_exec}&quot; = &quot;yes&quot;; then
-      sqlite_LIB=&quot;-lsqlite &quot;
+   if test &quot;${AST_SQLITE_FOUND}&quot; = &quot;yes&quot;; then
+      SQLITE_LIB=&quot;-lsqlite &quot;
       SQLITE_HEADER_FOUND=&quot;1&quot;
-      if test &quot;x${sqlite_DIR}&quot; != &quot;x&quot;; then
-         sqlite_LIB=&quot;${pbxlibdir} ${sqlite_LIB}&quot;
-	 sqlite_INCLUDE=&quot;-I${sqlite_DIR}/include&quot;
+      if test &quot;x${SQLITE_DIR}&quot; != &quot;x&quot;; then
+         SQLITE_LIB=&quot;${pbxlibdir} ${SQLITE_LIB}&quot;
+	 SQLITE_INCLUDE=&quot;-I${SQLITE_DIR}/include&quot;
 	 if test &quot;xsqlite.h&quot; != &quot;x&quot; ; then
-	    as_ac_Header=`echo &quot;ac_cv_header_${sqlite_DIR}/include/sqlite.h&quot; | $as_tr_sh`
-if eval &quot;test \&quot;\${$as_ac_Header+set}\&quot; = set&quot;; then
-  echo &quot;$as_me:$LINENO: checking for ${sqlite_DIR}/include/sqlite.h&quot; &gt;&amp;5
-echo $ECHO_N &quot;checking for ${sqlite_DIR}/include/sqlite.h... $ECHO_C&quot; &gt;&amp;6
-if eval &quot;test \&quot;\${$as_ac_Header+set}\&quot; = set&quot;; then
+	    as_ac_Header=`echo &quot;ac_cv_header_${SQLITE_DIR}/include/sqlite.h&quot; | $as_tr_sh`
+if { as_var=$as_ac_Header; eval &quot;test \&quot;\${$as_var+set}\&quot; = set&quot;; }; then
+  { echo &quot;$as_me:$LINENO: checking for ${SQLITE_DIR}/include/sqlite.h&quot; &gt;&amp;5
+echo $ECHO_N &quot;checking for ${SQLITE_DIR}/include/sqlite.h... $ECHO_C&quot; &gt;&amp;6; }
+if { as_var=$as_ac_Header; eval &quot;test \&quot;\${$as_var+set}\&quot; = set&quot;; }; then
   echo $ECHO_N &quot;(cached) $ECHO_C&quot; &gt;&amp;6
 fi
-echo &quot;$as_me:$LINENO: result: `eval echo '${'$as_ac_Header'}'`&quot; &gt;&amp;5
-echo &quot;${ECHO_T}`eval echo '${'$as_ac_Header'}'`&quot; &gt;&amp;6
+ac_res=`eval echo '${'$as_ac_Header'}'`
+	       { echo &quot;$as_me:$LINENO: result: $ac_res&quot; &gt;&amp;5
+echo &quot;${ECHO_T}$ac_res&quot; &gt;&amp;6; }
 else
   # Is the header compilable?
-echo &quot;$as_me:$LINENO: checking ${sqlite_DIR}/include/sqlite.h usability&quot; &gt;&amp;5
-echo $ECHO_N &quot;checking ${sqlite_DIR}/include/sqlite.h usability... $ECHO_C&quot; &gt;&amp;6
+{ echo &quot;$as_me:$LINENO: checking ${SQLITE_DIR}/include/sqlite.h usability&quot; &gt;&amp;5
+echo $ECHO_N &quot;checking ${SQLITE_DIR}/include/sqlite.h usability... $ECHO_C&quot; &gt;&amp;6; }
 cat &gt;conftest.$ac_ext &lt;&lt;_ACEOF
 /* confdefs.h.  */
 _ACEOF
@@ -9770,7 +11281,7 @@
 cat &gt;&gt;conftest.$ac_ext &lt;&lt;_ACEOF
 /* end confdefs.h.  */
 $ac_includes_default
-#include &lt;${sqlite_DIR}/include/sqlite.h&gt;
+#include &lt;${SQLITE_DIR}/include/sqlite.h&gt;
 _ACEOF
 rm -f conftest.$ac_objext
 if { (eval echo &quot;$as_me:$LINENO: \&quot;$ac_compile\&quot;&quot;) &gt;&amp;5
@@ -9799,22 +11310,23 @@
   echo &quot;$as_me: failed program was:&quot; &gt;&amp;5
 sed 's/^/| /' conftest.$ac_ext &gt;&amp;5
 
-ac_header_compiler=no
+	ac_header_compiler=no
 fi
+
 rm -f conftest.err conftest.$ac_objext conftest.$ac_ext
-echo &quot;$as_me:$LINENO: result: $ac_header_compiler&quot; &gt;&amp;5
-echo &quot;${ECHO_T}$ac_header_compiler&quot; &gt;&amp;6
+{ echo &quot;$as_me:$LINENO: result: $ac_header_compiler&quot; &gt;&amp;5
+echo &quot;${ECHO_T}$ac_header_compiler&quot; &gt;&amp;6; }
 
 # Is the header present?
-echo &quot;$as_me:$LINENO: checking ${sqlite_DIR}/include/sqlite.h presence&quot; &gt;&amp;5
-echo $ECHO_N &quot;checking ${sqlite_DIR}/include/sqlite.h presence... $ECHO_C&quot; &gt;&amp;6
+{ echo &quot;$as_me:$LINENO: checking ${SQLITE_DIR}/include/sqlite.h presence&quot; &gt;&amp;5
+echo $ECHO_N &quot;checking ${SQLITE_DIR}/include/sqlite.h presence... $ECHO_C&quot; &gt;&amp;6; }
 cat &gt;conftest.$ac_ext &lt;&lt;_ACEOF
 /* confdefs.h.  */
 _ACEOF
 cat confdefs.h &gt;&gt;conftest.$ac_ext
 cat &gt;&gt;conftest.$ac_ext &lt;&lt;_ACEOF
 /* end confdefs.h.  */
-#include &lt;${sqlite_DIR}/include/sqlite.h&gt;
+#include &lt;${SQLITE_DIR}/include/sqlite.h&gt;
 _ACEOF
 if { (eval echo &quot;$as_me:$LINENO: \&quot;$ac_cpp conftest.$ac_ext\&quot;&quot;) &gt;&amp;5
   (eval $ac_cpp conftest.$ac_ext) 2&gt;conftest.er1
@@ -9841,51 +11353,46 @@
 
   ac_header_preproc=no
 fi
+
 rm -f conftest.err conftest.$ac_ext
-echo &quot;$as_me:$LINENO: result: $ac_header_preproc&quot; &gt;&amp;5
-echo &quot;${ECHO_T}$ac_header_preproc&quot; &gt;&amp;6
+{ echo &quot;$as_me:$LINENO: result: $ac_header_preproc&quot; &gt;&amp;5
+echo &quot;${ECHO_T}$ac_header_preproc&quot; &gt;&amp;6; }
 
 # So?  What about this header?
 case $ac_header_compiler:$ac_header_preproc:$ac_c_preproc_warn_flag in
   yes:no: )
-    { echo &quot;$as_me:$LINENO: WARNING: ${sqlite_DIR}/include/sqlite.h: accepted by the compiler, rejected by the preprocessor!&quot; &gt;&amp;5
-echo &quot;$as_me: WARNING: ${sqlite_DIR}/include/sqlite.h: accepted by the compiler, rejected by the preprocessor!&quot; &gt;&amp;2;}
-    { echo &quot;$as_me:$LINENO: WARNING: ${sqlite_DIR}/include/sqlite.h: proceeding with the compiler's result&quot; &gt;&amp;5
-echo &quot;$as_me: WARNING: ${sqlite_DIR}/include/sqlite.h: proceeding with the compiler's result&quot; &gt;&amp;2;}
+    { echo &quot;$as_me:$LINENO: WARNING: ${SQLITE_DIR}/include/sqlite.h: accepted by the compiler, rejected by the preprocessor!&quot; &gt;&amp;5
+echo &quot;$as_me: WARNING: ${SQLITE_DIR}/include/sqlite.h: accepted by the compiler, rejected by the preprocessor!&quot; &gt;&amp;2;}
+    { echo &quot;$as_me:$LINENO: WARNING: ${SQLITE_DIR}/include/sqlite.h: proceeding with the compiler's result&quot; &gt;&amp;5
+echo &quot;$as_me: WARNING: ${SQLITE_DIR}/include/sqlite.h: proceeding with the compiler's result&quot; &gt;&amp;2;}
     ac_header_preproc=yes
     ;;
   no:yes:* )
-    { echo &quot;$as_me:$LINENO: WARNING: ${sqlite_DIR}/include/sqlite.h: present but cannot be compiled&quot; &gt;&amp;5
-echo &quot;$as_me: WARNING: ${sqlite_DIR}/include/sqlite.h: present but cannot be compiled&quot; &gt;&amp;2;}
-    { echo &quot;$as_me:$LINENO: WARNING: ${sqlite_DIR}/include/sqlite.h:     check for missing prerequisite headers?&quot; &gt;&amp;5
-echo &quot;$as_me: WARNING: ${sqlite_DIR}/include/sqlite.h:     check for missing prerequisite headers?&quot; &gt;&amp;2;}
-    { echo &quot;$as_me:$LINENO: WARNING: ${sqlite_DIR}/include/sqlite.h: see the Autoconf documentation&quot; &gt;&amp;5
-echo &quot;$as_me: WARNING: ${sqlite_DIR}/include/sqlite.h: see the Autoconf documentation&quot; &gt;&amp;2;}
-    { echo &quot;$as_me:$LINENO: WARNING: ${sqlite_DIR}/include/sqlite.h:     section \&quot;Present But Cannot Be Compiled\&quot;&quot; &gt;&amp;5
-echo &quot;$as_me: WARNING: ${sqlite_DIR}/include/sqlite.h:     section \&quot;Present But Cannot Be Compiled\&quot;&quot; &gt;&amp;2;}
-    { echo &quot;$as_me:$LINENO: WARNING: ${sqlite_DIR}/include/sqlite.h: proceeding with the preprocessor's result&quot; &gt;&amp;5
-echo &quot;$as_me: WARNING: ${sqlite_DIR}/include/sqlite.h: proceeding with the preprocessor's result&quot; &gt;&amp;2;}
-    { echo &quot;$as_me:$LINENO: WARNING: ${sqlite_DIR}/include/sqlite.h: in the future, the compiler will take precedence&quot; &gt;&amp;5
-echo &quot;$as_me: WARNING: ${sqlite_DIR}/include/sqlite.h: in the future, the compiler will take precedence&quot; &gt;&amp;2;}
-    (
-      cat &lt;&lt;\_ASBOX
-## ------------------------------------------ ##
-## Report this to the AC_PACKAGE_NAME lists.  ##
-## ------------------------------------------ ##
-_ASBOX
-    ) |
-      sed &quot;s/^/$as_me: WARNING:     /&quot; &gt;&amp;2
+    { echo &quot;$as_me:$LINENO: WARNING: ${SQLITE_DIR}/include/sqlite.h: present but cannot be compiled&quot; &gt;&amp;5
+echo &quot;$as_me: WARNING: ${SQLITE_DIR}/include/sqlite.h: present but cannot be compiled&quot; &gt;&amp;2;}
+    { echo &quot;$as_me:$LINENO: WARNING: ${SQLITE_DIR}/include/sqlite.h:     check for missing prerequisite headers?&quot; &gt;&amp;5
+echo &quot;$as_me: WARNING: ${SQLITE_DIR}/include/sqlite.h:     check for missing prerequisite headers?&quot; &gt;&amp;2;}
+    { echo &quot;$as_me:$LINENO: WARNING: ${SQLITE_DIR}/include/sqlite.h: see the Autoconf documentation&quot; &gt;&amp;5
+echo &quot;$as_me: WARNING: ${SQLITE_DIR}/include/sqlite.h: see the Autoconf documentation&quot; &gt;&amp;2;}
+    { echo &quot;$as_me:$LINENO: WARNING: ${SQLITE_DIR}/include/sqlite.h:     section \&quot;Present But Cannot Be Compiled\&quot;&quot; &gt;&amp;5
+echo &quot;$as_me: WARNING: ${SQLITE_DIR}/include/sqlite.h:     section \&quot;Present But Cannot Be Compiled\&quot;&quot; &gt;&amp;2;}
+    { echo &quot;$as_me:$LINENO: WARNING: ${SQLITE_DIR}/include/sqlite.h: proceeding with the preprocessor's result&quot; &gt;&amp;5
+echo &quot;$as_me: WARNING: ${SQLITE_DIR}/include/sqlite.h: proceeding with the preprocessor's result&quot; &gt;&amp;2;}
+    { echo &quot;$as_me:$LINENO: WARNING: ${SQLITE_DIR}/include/sqlite.h: in the future, the compiler will take precedence&quot; &gt;&amp;5
+echo &quot;$as_me: WARNING: ${SQLITE_DIR}/include/sqlite.h: in the future, the compiler will take precedence&quot; &gt;&amp;2;}
+
     ;;
 esac
-echo &quot;$as_me:$LINENO: checking for ${sqlite_DIR}/include/sqlite.h&quot; &gt;&amp;5
-echo $ECHO_N &quot;checking for ${sqlite_DIR}/include/sqlite.h... $ECHO_C&quot; &gt;&amp;6
-if eval &quot;test \&quot;\${$as_ac_Header+set}\&quot; = set&quot;; then
+{ echo &quot;$as_me:$LINENO: checking for ${SQLITE_DIR}/include/sqlite.h&quot; &gt;&amp;5
+echo $ECHO_N &quot;checking for ${SQLITE_DIR}/include/sqlite.h... $ECHO_C&quot; &gt;&amp;6; }
+if { as_var=$as_ac_Header; eval &quot;test \&quot;\${$as_var+set}\&quot; = set&quot;; }; then
   echo $ECHO_N &quot;(cached) $ECHO_C&quot; &gt;&amp;6
 else
   eval &quot;$as_ac_Header=\$ac_header_preproc&quot;
 fi
-echo &quot;$as_me:$LINENO: result: `eval echo '${'$as_ac_Header'}'`&quot; &gt;&amp;5
-echo &quot;${ECHO_T}`eval echo '${'$as_ac_Header'}'`&quot; &gt;&amp;6
+ac_res=`eval echo '${'$as_ac_Header'}'`
+	       { echo &quot;$as_me:$LINENO: result: $ac_res&quot; &gt;&amp;5
+echo &quot;${ECHO_T}$ac_res&quot; &gt;&amp;6; }
 
 fi
 if test `eval echo '${'$as_ac_Header'}'` = yes; then
@@ -9899,17 +11406,17 @@
       else
 	 if test &quot;xsqlite.h&quot; != &quot;x&quot; ; then
             if test &quot;${ac_cv_header_sqlite_h+set}&quot; = set; then
-  echo &quot;$as_me:$LINENO: checking for sqlite.h&quot; &gt;&amp;5
-echo $ECHO_N &quot;checking for sqlite.h... $ECHO_C&quot; &gt;&amp;6
+  { echo &quot;$as_me:$LINENO: checking for sqlite.h&quot; &gt;&amp;5
+echo $ECHO_N &quot;checking for sqlite.h... $ECHO_C&quot; &gt;&amp;6; }
 if test &quot;${ac_cv_header_sqlite_h+set}&quot; = set; then
   echo $ECHO_N &quot;(cached) $ECHO_C&quot; &gt;&amp;6
 fi
-echo &quot;$as_me:$LINENO: result: $ac_cv_header_sqlite_h&quot; &gt;&amp;5
-echo &quot;${ECHO_T}$ac_cv_header_sqlite_h&quot; &gt;&amp;6
+{ echo &quot;$as_me:$LINENO: result: $ac_cv_header_sqlite_h&quot; &gt;&amp;5
+echo &quot;${ECHO_T}$ac_cv_header_sqlite_h&quot; &gt;&amp;6; }
 else
   # Is the header compilable?
-echo &quot;$as_me:$LINENO: checking sqlite.h usability&quot; &gt;&amp;5
-echo $ECHO_N &quot;checking sqlite.h usability... $ECHO_C&quot; &gt;&amp;6
+{ echo &quot;$as_me:$LINENO: checking sqlite.h usability&quot; &gt;&amp;5
+echo $ECHO_N &quot;checking sqlite.h usability... $ECHO_C&quot; &gt;&amp;6; }
 cat &gt;conftest.$ac_ext &lt;&lt;_ACEOF
 /* confdefs.h.  */
 _ACEOF
@@ -9946,15 +11453,16 @@
   echo &quot;$as_me: failed program was:&quot; &gt;&amp;5
 sed 's/^/| /' conftest.$ac_ext &gt;&amp;5
 
-ac_header_compiler=no
+	ac_header_compiler=no
 fi
+
 rm -f conftest.err conftest.$ac_objext conftest.$ac_ext
-echo &quot;$as_me:$LINENO: result: $ac_header_compiler&quot; &gt;&amp;5
-echo &quot;${ECHO_T}$ac_header_compiler&quot; &gt;&amp;6
+{ echo &quot;$as_me:$LINENO: result: $ac_header_compiler&quot; &gt;&amp;5
+echo &quot;${ECHO_T}$ac_header_compiler&quot; &gt;&amp;6; }
 
 # Is the header present?
-echo &quot;$as_me:$LINENO: checking sqlite.h presence&quot; &gt;&amp;5
-echo $ECHO_N &quot;checking sqlite.h presence... $ECHO_C&quot; &gt;&amp;6
+{ echo &quot;$as_me:$LINENO: checking sqlite.h presence&quot; &gt;&amp;5
+echo $ECHO_N &quot;checking sqlite.h presence... $ECHO_C&quot; &gt;&amp;6; }
 cat &gt;conftest.$ac_ext &lt;&lt;_ACEOF
 /* confdefs.h.  */
 _ACEOF
@@ -9988,9 +11496,10 @@
 
   ac_header_preproc=no
 fi
+
 rm -f conftest.err conftest.$ac_ext
-echo &quot;$as_me:$LINENO: result: $ac_header_preproc&quot; &gt;&amp;5
-echo &quot;${ECHO_T}$ac_header_preproc&quot; &gt;&amp;6
+{ echo &quot;$as_me:$LINENO: result: $ac_header_preproc&quot; &gt;&amp;5
+echo &quot;${ECHO_T}$ac_header_preproc&quot; &gt;&amp;6; }
 
 # So?  What about this header?
 case $ac_header_compiler:$ac_header_preproc:$ac_c_preproc_warn_flag in
@@ -10014,25 +11523,18 @@
 echo &quot;$as_me: WARNING: sqlite.h: proceeding with the preprocessor's result&quot; &gt;&amp;2;}
     { echo &quot;$as_me:$LINENO: WARNING: sqlite.h: in the future, the compiler will take precedence&quot; &gt;&amp;5
 echo &quot;$as_me: WARNING: sqlite.h: in the future, the compiler will take precedence&quot; &gt;&amp;2;}
-    (
-      cat &lt;&lt;\_ASBOX
-## ------------------------------------------ ##
-## Report this to the AC_PACKAGE_NAME lists.  ##
-## ------------------------------------------ ##
-_ASBOX
-    ) |
-      sed &quot;s/^/$as_me: WARNING:     /&quot; &gt;&amp;2
+
     ;;
 esac
-echo &quot;$as_me:$LINENO: checking for sqlite.h&quot; &gt;&amp;5
-echo $ECHO_N &quot;checking for sqlite.h... $ECHO_C&quot; &gt;&amp;6
+{ echo &quot;$as_me:$LINENO: checking for sqlite.h&quot; &gt;&amp;5
+echo $ECHO_N &quot;checking for sqlite.h... $ECHO_C&quot; &gt;&amp;6; }
 if test &quot;${ac_cv_header_sqlite_h+set}&quot; = set; then
   echo $ECHO_N &quot;(cached) $ECHO_C&quot; &gt;&amp;6
 else
   ac_cv_header_sqlite_h=$ac_header_preproc
 fi
-echo &quot;$as_me:$LINENO: result: $ac_cv_header_sqlite_h&quot; &gt;&amp;5
-echo &quot;${ECHO_T}$ac_cv_header_sqlite_h&quot; &gt;&amp;6
+{ echo &quot;$as_me:$LINENO: result: $ac_cv_header_sqlite_h&quot; &gt;&amp;5
+echo &quot;${ECHO_T}$ac_cv_header_sqlite_h&quot; &gt;&amp;6; }
 
 fi
 if test $ac_cv_header_sqlite_h = yes; then
@@ -10045,7 +11547,7 @@
 	 fi
       fi
       if test &quot;x${SQLITE_HEADER_FOUND}&quot; = &quot;x0&quot; ; then
-         if test ! -z &quot;${sqlite_MANDATORY}&quot; ;
+         if test ! -z &quot;${SQLITE_MANDATORY}&quot; ;
          then
             echo &quot; ***&quot;
             echo &quot; *** It appears that you do not have the sqlite development package installed.&quot;
@@ -10053,18 +11555,18 @@
             echo &quot; *** without explicitly specifying --with-sqlite&quot;
             exit 1
          fi
-         sqlite_LIB=&quot;&quot;
-         sqlite_INCLUDE=&quot;&quot;
-         PBX_LIBsqlite=0
+         SQLITE_LIB=&quot;&quot;
+         SQLITE_INCLUDE=&quot;&quot;
+         PBX_LIBSQLITE=0
       else
-         PBX_LIBsqlite=1
+         PBX_LIBSQLITE=1
 
 cat &gt;&gt;confdefs.h &lt;&lt;_ACEOF
 #define HAVE_SQLITE 1
 _ACEOF
 
       fi
-   elif test ! -z &quot;${sqlite_MANDATORY}&quot;;
+   elif test ! -z &quot;${SQLITE_MANDATORY}&quot;;
    then
       echo &quot;***&quot;
       echo &quot;*** The SQLite installation on this system appears to be broken.&quot;
@@ -10079,34 +11581,34 @@
 
 
 
-# Check whether --with-ssl or --without-ssl was given.
+# Check whether --with-ssl was given.
 if test &quot;${with_ssl+set}&quot; = set; then
-  withval=&quot;$with_ssl&quot;
-
+  withval=$with_ssl;
 case ${withval} in
      n|no)
-     USE_ssl=no
+     USE_OPENSSL=no
      ;;
      y|ye|yes)
-     ssl_MANDATORY=&quot;yes&quot;
+     OPENSSL_MANDATORY=&quot;yes&quot;
      ;;
      *)
-     ssl_DIR=&quot;${withval}&quot;
-     ssl_MANDATORY=&quot;yes&quot;
+     OPENSSL_DIR=&quot;${withval}&quot;
+     OPENSSL_MANDATORY=&quot;yes&quot;
      ;;
 esac
 
-fi;
+fi
 
-PBX_LIBssl=0
 
-if test &quot;${USE_ssl}&quot; != &quot;no&quot;; then
+PBX_LIBOPENSSL=0
+
+if test &quot;${USE_OPENSSL}&quot; != &quot;no&quot;; then
    pbxlibdir=&quot;&quot;
-   if test &quot;x${ssl_DIR}&quot; != &quot;x&quot;; then
+   if test &quot;x${OPENSSL_DIR}&quot; != &quot;x&quot;; then
       pbxlibdir=&quot;-L${ssl_DIR}/lib&quot;
    fi
-   echo &quot;$as_me:$LINENO: checking for ssl2_connect in -lssl&quot; &gt;&amp;5
-echo $ECHO_N &quot;checking for ssl2_connect in -lssl... $ECHO_C&quot; &gt;&amp;6
+   { echo &quot;$as_me:$LINENO: checking for ssl2_connect in -lssl&quot; &gt;&amp;5
+echo $ECHO_N &quot;checking for ssl2_connect in -lssl... $ECHO_C&quot; &gt;&amp;6; }
 if test &quot;${ac_cv_lib_ssl_ssl2_connect+set}&quot; = set; then
   echo $ECHO_N &quot;(cached) $ECHO_C&quot; &gt;&amp;6
 else
@@ -10119,17 +11621,17 @@
 cat &gt;&gt;conftest.$ac_ext &lt;&lt;_ACEOF
 /* end confdefs.h.  */
 
-/* Override any gcc2 internal prototype to avoid an error.  */
+/* Override any GCC internal prototype to avoid an error.
+   Use char because int might match the return type of a GCC
+   builtin and then its argument prototype would still apply.  */
 #ifdef __cplusplus
 extern &quot;C&quot;
 #endif
-/* We use char because int might match the return type of a gcc2
-   builtin and then its argument prototype would still apply.  */
 char ssl2_connect ();
 int
 main ()
 {
-ssl2_connect ();
+return ssl2_connect ();
   ;
   return 0;
 }
@@ -10161,39 +11663,43 @@
   echo &quot;$as_me: failed program was:&quot; &gt;&amp;5
 sed 's/^/| /' conftest.$ac_ext &gt;&amp;5
 
-ac_cv_lib_ssl_ssl2_connect=no
+	ac_cv_lib_ssl_ssl2_connect=no
 fi
+
 rm -f conftest.err conftest.$ac_objext \
       conftest$ac_exeext conftest.$ac_ext
 LIBS=$ac_check_lib_save_LIBS
 fi
-echo &quot;$as_me:$LINENO: result: $ac_cv_lib_ssl_ssl2_connect&quot; &gt;&amp;5
-echo &quot;${ECHO_T}$ac_cv_lib_ssl_ssl2_connect&quot; &gt;&amp;6
+{ echo &quot;$as_me:$LINENO: result: $ac_cv_lib_ssl_ssl2_connect&quot; &gt;&amp;5
+echo &quot;${ECHO_T}$ac_cv_lib_ssl_ssl2_connect&quot; &gt;&amp;6; }
 if test $ac_cv_lib_ssl_ssl2_connect = yes; then
-  :
+  AST_OPENSSL_FOUND=yes
+else
+  AST_OPENSSL_FOUND=no
 fi
 
 
-   if test &quot;${ac_cv_lib_ssl_ssl2_connect}&quot; = &quot;yes&quot;; then
-      ssl_LIB=&quot;-lssl -lcrypto&quot;
+   if test &quot;${AST_OPENSSL_FOUND}&quot; = &quot;yes&quot;; then
+      OPENSSL_LIB=&quot;-lssl -lcrypto&quot;
       OPENSSL_HEADER_FOUND=&quot;1&quot;
-      if test &quot;x${ssl_DIR}&quot; != &quot;x&quot;; then
-         ssl_LIB=&quot;${pbxlibdir} ${ssl_LIB}&quot;
-	 ssl_INCLUDE=&quot;-I${ssl_DIR}/include&quot;
+      if test &quot;x${OPENSSL_DIR}&quot; != &quot;x&quot;; then
+         OPENSSL_LIB=&quot;${pbxlibdir} ${OPENSSL_LIB}&quot;
+	 OPENSSL_INCLUDE=&quot;-I${OPENSSL_DIR}/include&quot;
 	 if test &quot;xopenssl/ssl.h&quot; != &quot;x&quot; ; then
-	    as_ac_Header=`echo &quot;ac_cv_header_${ssl_DIR}/include/openssl/ssl.h&quot; | $as_tr_sh`
-if eval &quot;test \&quot;\${$as_ac_Header+set}\&quot; = set&quot;; then
-  echo &quot;$as_me:$LINENO: checking for ${ssl_DIR}/include/openssl/ssl.h&quot; &gt;&amp;5
-echo $ECHO_N &quot;checking for ${ssl_DIR}/include/openssl/ssl.h... $ECHO_C&quot; &gt;&amp;6
-if eval &quot;test \&quot;\${$as_ac_Header+set}\&quot; = set&quot;; then
+	    as_ac_Header=`echo &quot;ac_cv_header_${OPENSSL_DIR}/include/openssl/ssl.h&quot; | $as_tr_sh`
+if { as_var=$as_ac_Header; eval &quot;test \&quot;\${$as_var+set}\&quot; = set&quot;; }; then
+  { echo &quot;$as_me:$LINENO: checking for ${OPENSSL_DIR}/include/openssl/ssl.h&quot; &gt;&amp;5
+echo $ECHO_N &quot;checking for ${OPENSSL_DIR}/include/openssl/ssl.h... $ECHO_C&quot; &gt;&amp;6; }
+if { as_var=$as_ac_Header; eval &quot;test \&quot;\${$as_var+set}\&quot; = set&quot;; }; then
   echo $ECHO_N &quot;(cached) $ECHO_C&quot; &gt;&amp;6
 fi
-echo &quot;$as_me:$LINENO: result: `eval echo '${'$as_ac_Header'}'`&quot; &gt;&amp;5
-echo &quot;${ECHO_T}`eval echo '${'$as_ac_Header'}'`&quot; &gt;&amp;6
+ac_res=`eval echo '${'$as_ac_Header'}'`
+	       { echo &quot;$as_me:$LINENO: result: $ac_res&quot; &gt;&amp;5
+echo &quot;${ECHO_T}$ac_res&quot; &gt;&amp;6; }
 else
   # Is the header compilable?
-echo &quot;$as_me:$LINENO: checking ${ssl_DIR}/include/openssl/ssl.h usability&quot; &gt;&amp;5
-echo $ECHO_N &quot;checking ${ssl_DIR}/include/openssl/ssl.h usability... $ECHO_C&quot; &gt;&amp;6
+{ echo &quot;$as_me:$LINENO: checking ${OPENSSL_DIR}/include/openssl/ssl.h usability&quot; &gt;&amp;5
+echo $ECHO_N &quot;checking ${OPENSSL_DIR}/include/openssl/ssl.h usability... $ECHO_C&quot; &gt;&amp;6; }
 cat &gt;conftest.$ac_ext &lt;&lt;_ACEOF
 /* confdefs.h.  */
 _ACEOF
@@ -10201,7 +11707,7 @@
 cat &gt;&gt;conftest.$ac_ext &lt;&lt;_ACEOF
 /* end confdefs.h.  */
 $ac_includes_default
-#include &lt;${ssl_DIR}/include/openssl/ssl.h&gt;
+#include &lt;${OPENSSL_DIR}/include/openssl/ssl.h&gt;
 _ACEOF
 rm -f conftest.$ac_objext
 if { (eval echo &quot;$as_me:$LINENO: \&quot;$ac_compile\&quot;&quot;) &gt;&amp;5
@@ -10230,22 +11736,23 @@
   echo &quot;$as_me: failed program was:&quot; &gt;&amp;5
 sed 's/^/| /' conftest.$ac_ext &gt;&amp;5
 
-ac_header_compiler=no
+	ac_header_compiler=no
 fi
+
 rm -f conftest.err conftest.$ac_objext conftest.$ac_ext
-echo &quot;$as_me:$LINENO: result: $ac_header_compiler&quot; &gt;&amp;5
-echo &quot;${ECHO_T}$ac_header_compiler&quot; &gt;&amp;6
+{ echo &quot;$as_me:$LINENO: result: $ac_header_compiler&quot; &gt;&amp;5
+echo &quot;${ECHO_T}$ac_header_compiler&quot; &gt;&amp;6; }
 
 # Is the header present?
-echo &quot;$as_me:$LINENO: checking ${ssl_DIR}/include/openssl/ssl.h presence&quot; &gt;&amp;5
-echo $ECHO_N &quot;checking ${ssl_DIR}/include/openssl/ssl.h presence... $ECHO_C&quot; &gt;&amp;6
+{ echo &quot;$as_me:$LINENO: checking ${OPENSSL_DIR}/include/openssl/ssl.h presence&quot; &gt;&amp;5
+echo $ECHO_N &quot;checking ${OPENSSL_DIR}/include/openssl/ssl.h presence... $ECHO_C&quot; &gt;&amp;6; }
 cat &gt;conftest.$ac_ext &lt;&lt;_ACEOF
 /* confdefs.h.  */
 _ACEOF
 cat confdefs.h &gt;&gt;conftest.$ac_ext
 cat &gt;&gt;conftest.$ac_ext &lt;&lt;_ACEOF
 /* end confdefs.h.  */
-#include &lt;${ssl_DIR}/include/openssl/ssl.h&gt;
+#include &lt;${OPENSSL_DIR}/include/openssl/ssl.h&gt;
 _ACEOF
 if { (eval echo &quot;$as_me:$LINENO: \&quot;$ac_cpp conftest.$ac_ext\&quot;&quot;) &gt;&amp;5
   (eval $ac_cpp conftest.$ac_ext) 2&gt;conftest.er1
@@ -10272,51 +11779,46 @@
 
   ac_header_preproc=no
 fi
+
 rm -f conftest.err conftest.$ac_ext
-echo &quot;$as_me:$LINENO: result: $ac_header_preproc&quot; &gt;&amp;5
-echo &quot;${ECHO_T}$ac_header_preproc&quot; &gt;&amp;6
+{ echo &quot;$as_me:$LINENO: result: $ac_header_preproc&quot; &gt;&amp;5
+echo &quot;${ECHO_T}$ac_header_preproc&quot; &gt;&amp;6; }
 
 # So?  What about this header?
 case $ac_header_compiler:$ac_header_preproc:$ac_c_preproc_warn_flag in
   yes:no: )
-    { echo &quot;$as_me:$LINENO: WARNING: ${ssl_DIR}/include/openssl/ssl.h: accepted by the compiler, rejected by the preprocessor!&quot; &gt;&amp;5
-echo &quot;$as_me: WARNING: ${ssl_DIR}/include/openssl/ssl.h: accepted by the compiler, rejected by the preprocessor!&quot; &gt;&amp;2;}
-    { echo &quot;$as_me:$LINENO: WARNING: ${ssl_DIR}/include/openssl/ssl.h: proceeding with the compiler's result&quot; &gt;&amp;5
-echo &quot;$as_me: WARNING: ${ssl_DIR}/include/openssl/ssl.h: proceeding with the compiler's result&quot; &gt;&amp;2;}
+    { echo &quot;$as_me:$LINENO: WARNING: ${OPENSSL_DIR}/include/openssl/ssl.h: accepted by the compiler, rejected by the preprocessor!&quot; &gt;&amp;5
+echo &quot;$as_me: WARNING: ${OPENSSL_DIR}/include/openssl/ssl.h: accepted by the compiler, rejected by the preprocessor!&quot; &gt;&amp;2;}
+    { echo &quot;$as_me:$LINENO: WARNING: ${OPENSSL_DIR}/include/openssl/ssl.h: proceeding with the compiler's result&quot; &gt;&amp;5
+echo &quot;$as_me: WARNING: ${OPENSSL_DIR}/include/openssl/ssl.h: proceeding with the compiler's result&quot; &gt;&amp;2;}
     ac_header_preproc=yes
     ;;
   no:yes:* )
-    { echo &quot;$as_me:$LINENO: WARNING: ${ssl_DIR}/include/openssl/ssl.h: present but cannot be compiled&quot; &gt;&amp;5
-echo &quot;$as_me: WARNING: ${ssl_DIR}/include/openssl/ssl.h: present but cannot be compiled&quot; &gt;&amp;2;}
-    { echo &quot;$as_me:$LINENO: WARNING: ${ssl_DIR}/include/openssl/ssl.h:     check for missing prerequisite headers?&quot; &gt;&amp;5
-echo &quot;$as_me: WARNING: ${ssl_DIR}/include/openssl/ssl.h:     check for missing prerequisite headers?&quot; &gt;&amp;2;}
-    { echo &quot;$as_me:$LINENO: WARNING: ${ssl_DIR}/include/openssl/ssl.h: see the Autoconf documentation&quot; &gt;&amp;5
-echo &quot;$as_me: WARNING: ${ssl_DIR}/include/openssl/ssl.h: see the Autoconf documentation&quot; &gt;&amp;2;}
-    { echo &quot;$as_me:$LINENO: WARNING: ${ssl_DIR}/include/openssl/ssl.h:     section \&quot;Present But Cannot Be Compiled\&quot;&quot; &gt;&amp;5
-echo &quot;$as_me: WARNING: ${ssl_DIR}/include/openssl/ssl.h:     section \&quot;Present But Cannot Be Compiled\&quot;&quot; &gt;&amp;2;}
-    { echo &quot;$as_me:$LINENO: WARNING: ${ssl_DIR}/include/openssl/ssl.h: proceeding with the preprocessor's result&quot; &gt;&amp;5
-echo &quot;$as_me: WARNING: ${ssl_DIR}/include/openssl/ssl.h: proceeding with the preprocessor's result&quot; &gt;&amp;2;}
-    { echo &quot;$as_me:$LINENO: WARNING: ${ssl_DIR}/include/openssl/ssl.h: in the future, the compiler will take precedence&quot; &gt;&amp;5
-echo &quot;$as_me: WARNING: ${ssl_DIR}/include/openssl/ssl.h: in the future, the compiler will take precedence&quot; &gt;&amp;2;}
-    (
-      cat &lt;&lt;\_ASBOX
-## ------------------------------------------ ##
-## Report this to the AC_PACKAGE_NAME lists.  ##
-## ------------------------------------------ ##
-_ASBOX
-    ) |
-      sed &quot;s/^/$as_me: WARNING:     /&quot; &gt;&amp;2
+    { echo &quot;$as_me:$LINENO: WARNING: ${OPENSSL_DIR}/include/openssl/ssl.h: present but cannot be compiled&quot; &gt;&amp;5
+echo &quot;$as_me: WARNING: ${OPENSSL_DIR}/include/openssl/ssl.h: present but cannot be compiled&quot; &gt;&amp;2;}
+    { echo &quot;$as_me:$LINENO: WARNING: ${OPENSSL_DIR}/include/openssl/ssl.h:     check for missing prerequisite headers?&quot; &gt;&amp;5
+echo &quot;$as_me: WARNING: ${OPENSSL_DIR}/include/openssl/ssl.h:     check for missing prerequisite headers?&quot; &gt;&amp;2;}
+    { echo &quot;$as_me:$LINENO: WARNING: ${OPENSSL_DIR}/include/openssl/ssl.h: see the Autoconf documentation&quot; &gt;&amp;5
+echo &quot;$as_me: WARNING: ${OPENSSL_DIR}/include/openssl/ssl.h: see the Autoconf documentation&quot; &gt;&amp;2;}
+    { echo &quot;$as_me:$LINENO: WARNING: ${OPENSSL_DIR}/include/openssl/ssl.h:     section \&quot;Present But Cannot Be Compiled\&quot;&quot; &gt;&amp;5
+echo &quot;$as_me: WARNING: ${OPENSSL_DIR}/include/openssl/ssl.h:     section \&quot;Present But Cannot Be Compiled\&quot;&quot; &gt;&amp;2;}
+    { echo &quot;$as_me:$LINENO: WARNING: ${OPENSSL_DIR}/include/openssl/ssl.h: proceeding with the preprocessor's result&quot; &gt;&amp;5
+echo &quot;$as_me: WARNING: ${OPENSSL_DIR}/include/openssl/ssl.h: proceeding with the preprocessor's result&quot; &gt;&amp;2;}
+    { echo &quot;$as_me:$LINENO: WARNING: ${OPENSSL_DIR}/include/openssl/ssl.h: in the future, the compiler will take precedence&quot; &gt;&amp;5
+echo &quot;$as_me: WARNING: ${OPENSSL_DIR}/include/openssl/ssl.h: in the future, the compiler will take precedence&quot; &gt;&amp;2;}
+
     ;;
 esac
-echo &quot;$as_me:$LINENO: checking for ${ssl_DIR}/include/openssl/ssl.h&quot; &gt;&amp;5
-echo $ECHO_N &quot;checking for ${ssl_DIR}/include/openssl/ssl.h... $ECHO_C&quot; &gt;&amp;6
-if eval &quot;test \&quot;\${$as_ac_Header+set}\&quot; = set&quot;; then
+{ echo &quot;$as_me:$LINENO: checking for ${OPENSSL_DIR}/include/openssl/ssl.h&quot; &gt;&amp;5
+echo $ECHO_N &quot;checking for ${OPENSSL_DIR}/include/openssl/ssl.h... $ECHO_C&quot; &gt;&amp;6; }
+if { as_var=$as_ac_Header; eval &quot;test \&quot;\${$as_var+set}\&quot; = set&quot;; }; then
   echo $ECHO_N &quot;(cached) $ECHO_C&quot; &gt;&amp;6
 else
   eval &quot;$as_ac_Header=\$ac_header_preproc&quot;
 fi
-echo &quot;$as_me:$LINENO: result: `eval echo '${'$as_ac_Header'}'`&quot; &gt;&amp;5
-echo &quot;${ECHO_T}`eval echo '${'$as_ac_Header'}'`&quot; &gt;&amp;6
+ac_res=`eval echo '${'$as_ac_Header'}'`
+	       { echo &quot;$as_me:$LINENO: result: $ac_res&quot; &gt;&amp;5
+echo &quot;${ECHO_T}$ac_res&quot; &gt;&amp;6; }
 
 fi
 if test `eval echo '${'$as_ac_Header'}'` = yes; then
@@ -10330,17 +11832,17 @@
       else
 	 if test &quot;xopenssl/ssl.h&quot; != &quot;x&quot; ; then
             if test &quot;${ac_cv_header_openssl_ssl_h+set}&quot; = set; then
-  echo &quot;$as_me:$LINENO: checking for openssl/ssl.h&quot; &gt;&amp;5
-echo $ECHO_N &quot;checking for openssl/ssl.h... $ECHO_C&quot; &gt;&amp;6
+  { echo &quot;$as_me:$LINENO: checking for openssl/ssl.h&quot; &gt;&amp;5
+echo $ECHO_N &quot;checking for openssl/ssl.h... $ECHO_C&quot; &gt;&amp;6; }
 if test &quot;${ac_cv_header_openssl_ssl_h+set}&quot; = set; then
   echo $ECHO_N &quot;(cached) $ECHO_C&quot; &gt;&amp;6
 fi
-echo &quot;$as_me:$LINENO: result: $ac_cv_header_openssl_ssl_h&quot; &gt;&amp;5
-echo &quot;${ECHO_T}$ac_cv_header_openssl_ssl_h&quot; &gt;&amp;6
+{ echo &quot;$as_me:$LINENO: result: $ac_cv_header_openssl_ssl_h&quot; &gt;&amp;5
+echo &quot;${ECHO_T}$ac_cv_header_openssl_ssl_h&quot; &gt;&amp;6; }
 else
   # Is the header compilable?
-echo &quot;$as_me:$LINENO: checking openssl/ssl.h usability&quot; &gt;&amp;5
-echo $ECHO_N &quot;checking openssl/ssl.h usability... $ECHO_C&quot; &gt;&amp;6
+{ echo &quot;$as_me:$LINENO: checking openssl/ssl.h usability&quot; &gt;&amp;5
+echo $ECHO_N &quot;checking openssl/ssl.h usability... $ECHO_C&quot; &gt;&amp;6; }
 cat &gt;conftest.$ac_ext &lt;&lt;_ACEOF
 /* confdefs.h.  */
 _ACEOF
@@ -10377,15 +11879,16 @@
   echo &quot;$as_me: failed program was:&quot; &gt;&amp;5
 sed 's/^/| /' conftest.$ac_ext &gt;&amp;5
 
-ac_header_compiler=no
+	ac_header_compiler=no
 fi
+
 rm -f conftest.err conftest.$ac_objext conftest.$ac_ext
-echo &quot;$as_me:$LINENO: result: $ac_header_compiler&quot; &gt;&amp;5
-echo &quot;${ECHO_T}$ac_header_compiler&quot; &gt;&amp;6
+{ echo &quot;$as_me:$LINENO: result: $ac_header_compiler&quot; &gt;&amp;5
+echo &quot;${ECHO_T}$ac_header_compiler&quot; &gt;&amp;6; }
 
 # Is the header present?
-echo &quot;$as_me:$LINENO: checking openssl/ssl.h presence&quot; &gt;&amp;5
-echo $ECHO_N &quot;checking openssl/ssl.h presence... $ECHO_C&quot; &gt;&amp;6
+{ echo &quot;$as_me:$LINENO: checking openssl/ssl.h presence&quot; &gt;&amp;5
+echo $ECHO_N &quot;checking openssl/ssl.h presence... $ECHO_C&quot; &gt;&amp;6; }
 cat &gt;conftest.$ac_ext &lt;&lt;_ACEOF
 /* confdefs.h.  */
 _ACEOF
@@ -10419,9 +11922,10 @@
 
   ac_header_preproc=no
 fi
+
 rm -f conftest.err conftest.$ac_ext
-echo &quot;$as_me:$LINENO: result: $ac_header_preproc&quot; &gt;&amp;5
-echo &quot;${ECHO_T}$ac_header_preproc&quot; &gt;&amp;6
+{ echo &quot;$as_me:$LINENO: result: $ac_header_preproc&quot; &gt;&amp;5
+echo &quot;${ECHO_T}$ac_header_preproc&quot; &gt;&amp;6; }
 
 # So?  What about this header?
 case $ac_header_compiler:$ac_header_preproc:$ac_c_preproc_warn_flag in
@@ -10445,25 +11949,18 @@
 echo &quot;$as_me: WARNING: openssl/ssl.h: proceeding with the preprocessor's result&quot; &gt;&amp;2;}
     { echo &quot;$as_me:$LINENO: WARNING: openssl/ssl.h: in the future, the compiler will take precedence&quot; &gt;&amp;5
 echo &quot;$as_me: WARNING: openssl/ssl.h: in the future, the compiler will take precedence&quot; &gt;&amp;2;}
-    (
-      cat &lt;&lt;\_ASBOX
-## ------------------------------------------ ##
-## Report this to the AC_PACKAGE_NAME lists.  ##
-## ------------------------------------------ ##
-_ASBOX
-    ) |
-      sed &quot;s/^/$as_me: WARNING:     /&quot; &gt;&amp;2
+
     ;;
 esac
-echo &quot;$as_me:$LINENO: checking for openssl/ssl.h&quot; &gt;&amp;5
-echo $ECHO_N &quot;checking for openssl/ssl.h... $ECHO_C&quot; &gt;&amp;6
+{ echo &quot;$as_me:$LINENO: checking for openssl/ssl.h&quot; &gt;&amp;5
+echo $ECHO_N &quot;checking for openssl/ssl.h... $ECHO_C&quot; &gt;&amp;6; }
 if test &quot;${ac_cv_header_openssl_ssl_h+set}&quot; = set; then
   echo $ECHO_N &quot;(cached) $ECHO_C&quot; &gt;&amp;6
 else
   ac_cv_header_openssl_ssl_h=$ac_header_preproc
 fi
-echo &quot;$as_me:$LINENO: result: $ac_cv_header_openssl_ssl_h&quot; &gt;&amp;5
-echo &quot;${ECHO_T}$ac_cv_header_openssl_ssl_h&quot; &gt;&amp;6
+{ echo &quot;$as_me:$LINENO: result: $ac_cv_header_openssl_ssl_h&quot; &gt;&amp;5
+echo &quot;${ECHO_T}$ac_cv_header_openssl_ssl_h&quot; &gt;&amp;6; }
 
 fi
 if test $ac_cv_header_openssl_ssl_h = yes; then
@@ -10476,7 +11973,7 @@
 	 fi
       fi
       if test &quot;x${OPENSSL_HEADER_FOUND}&quot; = &quot;x0&quot; ; then
-         if test ! -z &quot;${ssl_MANDATORY}&quot; ;
+         if test ! -z &quot;${OPENSSL_MANDATORY}&quot; ;
          then
             echo &quot; ***&quot;
             echo &quot; *** It appears that you do not have the ssl development package installed.&quot;
@@ -10484,18 +11981,18 @@
             echo &quot; *** without explicitly specifying --with-ssl&quot;
             exit 1
          fi
-         ssl_LIB=&quot;&quot;
-         ssl_INCLUDE=&quot;&quot;
-         PBX_LIBssl=0
+         OPENSSL_LIB=&quot;&quot;
+         OPENSSL_INCLUDE=&quot;&quot;
+         PBX_LIBOPENSSL=0
       else
-         PBX_LIBssl=1
+         PBX_LIBOPENSSL=1
 
 cat &gt;&gt;confdefs.h &lt;&lt;_ACEOF
 #define HAVE_OPENSSL 1
 _ACEOF
 
       fi
-   elif test ! -z &quot;${ssl_MANDATORY}&quot;;
+   elif test ! -z &quot;${OPENSSL_MANDATORY}&quot;;
    then
       echo &quot;***&quot;
       echo &quot;*** The OpenSSL installation on this system appears to be broken.&quot;
@@ -10510,34 +12007,34 @@
 
 
 
-# Check whether --with-tds or --without-tds was given.
+# Check whether --with-tds was given.
 if test &quot;${with_tds+set}&quot; = set; then
-  withval=&quot;$with_tds&quot;
-
+  withval=$with_tds;
 case ${withval} in
      n|no)
-     USE_tds=no
+     USE_FREETDS=no
      ;;
      y|ye|yes)
-     tds_MANDATORY=&quot;yes&quot;
+     FREETDS_MANDATORY=&quot;yes&quot;
      ;;
      *)
-     tds_DIR=&quot;${withval}&quot;
-     tds_MANDATORY=&quot;yes&quot;
+     FREETDS_DIR=&quot;${withval}&quot;
+     FREETDS_MANDATORY=&quot;yes&quot;
      ;;
 esac
 
-fi;
+fi
 
-PBX_LIBtds=0
 
-if test &quot;${USE_tds}&quot; != &quot;no&quot;; then
+PBX_LIBFREETDS=0
+
+if test &quot;${USE_FREETDS}&quot; != &quot;no&quot;; then
    pbxlibdir=&quot;&quot;
-   if test &quot;x${tds_DIR}&quot; != &quot;x&quot;; then
+   if test &quot;x${FREETDS_DIR}&quot; != &quot;x&quot;; then
       pbxlibdir=&quot;-L${tds_DIR}/lib&quot;
    fi
-   echo &quot;$as_me:$LINENO: checking for tds_version in -ltds&quot; &gt;&amp;5
-echo $ECHO_N &quot;checking for tds_version in -ltds... $ECHO_C&quot; &gt;&amp;6
+   { echo &quot;$as_me:$LINENO: checking for tds_version in -ltds&quot; &gt;&amp;5
+echo $ECHO_N &quot;checking for tds_version in -ltds... $ECHO_C&quot; &gt;&amp;6; }
 if test &quot;${ac_cv_lib_tds_tds_version+set}&quot; = set; then
   echo $ECHO_N &quot;(cached) $ECHO_C&quot; &gt;&amp;6
 else
@@ -10550,17 +12047,17 @@
 cat &gt;&gt;conftest.$ac_ext &lt;&lt;_ACEOF
 /* end confdefs.h.  */
 
-/* Override any gcc2 internal prototype to avoid an error.  */
+/* Override any GCC internal prototype to avoid an error.
+   Use char because int might match the return type of a GCC
+   builtin and then its argument prototype would still apply.  */
 #ifdef __cplusplus
 extern &quot;C&quot;
 #endif
-/* We use char because int might match the return type of a gcc2
-   builtin and then its argument prototype would still apply.  */
 char tds_version ();
 int
 main ()
 {
-tds_version ();
+return tds_version ();
   ;
   return 0;
 }
@@ -10592,39 +12089,43 @@
   echo &quot;$as_me: failed program was:&quot; &gt;&amp;5
 sed 's/^/| /' conftest.$ac_ext &gt;&amp;5
 
-ac_cv_lib_tds_tds_version=no
+	ac_cv_lib_tds_tds_version=no
 fi
+
 rm -f conftest.err conftest.$ac_objext \
       conftest$ac_exeext conftest.$ac_ext
 LIBS=$ac_check_lib_save_LIBS
 fi
-echo &quot;$as_me:$LINENO: result: $ac_cv_lib_tds_tds_version&quot; &gt;&amp;5
-echo &quot;${ECHO_T}$ac_cv_lib_tds_tds_version&quot; &gt;&amp;6
+{ echo &quot;$as_me:$LINENO: result: $ac_cv_lib_tds_tds_version&quot; &gt;&amp;5
+echo &quot;${ECHO_T}$ac_cv_lib_tds_tds_version&quot; &gt;&amp;6; }
 if test $ac_cv_lib_tds_tds_version = yes; then
-  :
+  AST_FREETDS_FOUND=yes
+else
+  AST_FREETDS_FOUND=no
 fi
 
 
-   if test &quot;${ac_cv_lib_tds_tds_version}&quot; = &quot;yes&quot;; then
-      tds_LIB=&quot;-ltds &quot;
+   if test &quot;${AST_FREETDS_FOUND}&quot; = &quot;yes&quot;; then
+      FREETDS_LIB=&quot;-ltds &quot;
       FREETDS_HEADER_FOUND=&quot;1&quot;
-      if test &quot;x${tds_DIR}&quot; != &quot;x&quot;; then
-         tds_LIB=&quot;${pbxlibdir} ${tds_LIB}&quot;
-	 tds_INCLUDE=&quot;-I${tds_DIR}/include&quot;
+      if test &quot;x${FREETDS_DIR}&quot; != &quot;x&quot;; then
+         FREETDS_LIB=&quot;${pbxlibdir} ${FREETDS_LIB}&quot;
+	 FREETDS_INCLUDE=&quot;-I${FREETDS_DIR}/include&quot;
 	 if test &quot;xtds.h&quot; != &quot;x&quot; ; then
-	    as_ac_Header=`echo &quot;ac_cv_header_${tds_DIR}/include/tds.h&quot; | $as_tr_sh`
-if eval &quot;test \&quot;\${$as_ac_Header+set}\&quot; = set&quot;; then
-  echo &quot;$as_me:$LINENO: checking for ${tds_DIR}/include/tds.h&quot; &gt;&amp;5
-echo $ECHO_N &quot;checking for ${tds_DIR}/include/tds.h... $ECHO_C&quot; &gt;&amp;6
-if eval &quot;test \&quot;\${$as_ac_Header+set}\&quot; = set&quot;; then
+	    as_ac_Header=`echo &quot;ac_cv_header_${FREETDS_DIR}/include/tds.h&quot; | $as_tr_sh`
+if { as_var=$as_ac_Header; eval &quot;test \&quot;\${$as_var+set}\&quot; = set&quot;; }; then
+  { echo &quot;$as_me:$LINENO: checking for ${FREETDS_DIR}/include/tds.h&quot; &gt;&amp;5
+echo $ECHO_N &quot;checking for ${FREETDS_DIR}/include/tds.h... $ECHO_C&quot; &gt;&amp;6; }
+if { as_var=$as_ac_Header; eval &quot;test \&quot;\${$as_var+set}\&quot; = set&quot;; }; then
   echo $ECHO_N &quot;(cached) $ECHO_C&quot; &gt;&amp;6
 fi
-echo &quot;$as_me:$LINENO: result: `eval echo '${'$as_ac_Header'}'`&quot; &gt;&amp;5
-echo &quot;${ECHO_T}`eval echo '${'$as_ac_Header'}'`&quot; &gt;&amp;6
+ac_res=`eval echo '${'$as_ac_Header'}'`
+	       { echo &quot;$as_me:$LINENO: result: $ac_res&quot; &gt;&amp;5
+echo &quot;${ECHO_T}$ac_res&quot; &gt;&amp;6; }
 else
   # Is the header compilable?
-echo &quot;$as_me:$LINENO: checking ${tds_DIR}/include/tds.h usability&quot; &gt;&amp;5
-echo $ECHO_N &quot;checking ${tds_DIR}/include/tds.h usability... $ECHO_C&quot; &gt;&amp;6
+{ echo &quot;$as_me:$LINENO: checking ${FREETDS_DIR}/include/tds.h usability&quot; &gt;&amp;5
+echo $ECHO_N &quot;checking ${FREETDS_DIR}/include/tds.h usability... $ECHO_C&quot; &gt;&amp;6; }
 cat &gt;conftest.$ac_ext &lt;&lt;_ACEOF
 /* confdefs.h.  */
 _ACEOF
@@ -10632,7 +12133,7 @@
 cat &gt;&gt;conftest.$ac_ext &lt;&lt;_ACEOF
 /* end confdefs.h.  */
 $ac_includes_default
-#include &lt;${tds_DIR}/include/tds.h&gt;
+#include &lt;${FREETDS_DIR}/include/tds.h&gt;
 _ACEOF
 rm -f conftest.$ac_objext
 if { (eval echo &quot;$as_me:$LINENO: \&quot;$ac_compile\&quot;&quot;) &gt;&amp;5
@@ -10661,22 +12162,23 @@
   echo &quot;$as_me: failed program was:&quot; &gt;&amp;5
 sed 's/^/| /' conftest.$ac_ext &gt;&amp;5
 
-ac_header_compiler=no
+	ac_header_compiler=no
 fi
+
 rm -f conftest.err conftest.$ac_objext conftest.$ac_ext
-echo &quot;$as_me:$LINENO: result: $ac_header_compiler&quot; &gt;&amp;5
-echo &quot;${ECHO_T}$ac_header_compiler&quot; &gt;&amp;6
+{ echo &quot;$as_me:$LINENO: result: $ac_header_compiler&quot; &gt;&amp;5
+echo &quot;${ECHO_T}$ac_header_compiler&quot; &gt;&amp;6; }
 
 # Is the header present?
-echo &quot;$as_me:$LINENO: checking ${tds_DIR}/include/tds.h presence&quot; &gt;&amp;5
-echo $ECHO_N &quot;checking ${tds_DIR}/include/tds.h presence... $ECHO_C&quot; &gt;&amp;6
+{ echo &quot;$as_me:$LINENO: checking ${FREETDS_DIR}/include/tds.h presence&quot; &gt;&amp;5
+echo $ECHO_N &quot;checking ${FREETDS_DIR}/include/tds.h presence... $ECHO_C&quot; &gt;&amp;6; }
 cat &gt;conftest.$ac_ext &lt;&lt;_ACEOF
 /* confdefs.h.  */
 _ACEOF
 cat confdefs.h &gt;&gt;conftest.$ac_ext
 cat &gt;&gt;conftest.$ac_ext &lt;&lt;_ACEOF
 /* end confdefs.h.  */
-#include &lt;${tds_DIR}/include/tds.h&gt;
+#include &lt;${FREETDS_DIR}/include/tds.h&gt;
 _ACEOF
 if { (eval echo &quot;$as_me:$LINENO: \&quot;$ac_cpp conftest.$ac_ext\&quot;&quot;) &gt;&amp;5
   (eval $ac_cpp conftest.$ac_ext) 2&gt;conftest.er1
@@ -10703,51 +12205,46 @@
 
   ac_header_preproc=no
 fi
+
 rm -f conftest.err conftest.$ac_ext
-echo &quot;$as_me:$LINENO: result: $ac_header_preproc&quot; &gt;&amp;5
-echo &quot;${ECHO_T}$ac_header_preproc&quot; &gt;&amp;6
+{ echo &quot;$as_me:$LINENO: result: $ac_header_preproc&quot; &gt;&amp;5
+echo &quot;${ECHO_T}$ac_header_preproc&quot; &gt;&amp;6; }
 
 # So?  What about this header?
 case $ac_header_compiler:$ac_header_preproc:$ac_c_preproc_warn_flag in
   yes:no: )
-    { echo &quot;$as_me:$LINENO: WARNING: ${tds_DIR}/include/tds.h: accepted by the compiler, rejected by the preprocessor!&quot; &gt;&amp;5
-echo &quot;$as_me: WARNING: ${tds_DIR}/include/tds.h: accepted by the compiler, rejected by the preprocessor!&quot; &gt;&amp;2;}
-    { echo &quot;$as_me:$LINENO: WARNING: ${tds_DIR}/include/tds.h: proceeding with the compiler's result&quot; &gt;&amp;5
-echo &quot;$as_me: WARNING: ${tds_DIR}/include/tds.h: proceeding with the compiler's result&quot; &gt;&amp;2;}
+    { echo &quot;$as_me:$LINENO: WARNING: ${FREETDS_DIR}/include/tds.h: accepted by the compiler, rejected by the preprocessor!&quot; &gt;&amp;5
+echo &quot;$as_me: WARNING: ${FREETDS_DIR}/include/tds.h: accepted by the compiler, rejected by the preprocessor!&quot; &gt;&amp;2;}
+    { echo &quot;$as_me:$LINENO: WARNING: ${FREETDS_DIR}/include/tds.h: proceeding with the compiler's result&quot; &gt;&amp;5
+echo &quot;$as_me: WARNING: ${FREETDS_DIR}/include/tds.h: proceeding with the compiler's result&quot; &gt;&amp;2;}
     ac_header_preproc=yes
     ;;
   no:yes:* )
-    { echo &quot;$as_me:$LINENO: WARNING: ${tds_DIR}/include/tds.h: present but cannot be compiled&quot; &gt;&amp;5
-echo &quot;$as_me: WARNING: ${tds_DIR}/include/tds.h: present but cannot be compiled&quot; &gt;&amp;2;}
-    { echo &quot;$as_me:$LINENO: WARNING: ${tds_DIR}/include/tds.h:     check for missing prerequisite headers?&quot; &gt;&amp;5
-echo &quot;$as_me: WARNING: ${tds_DIR}/include/tds.h:     check for missing prerequisite headers?&quot; &gt;&amp;2;}
-    { echo &quot;$as_me:$LINENO: WARNING: ${tds_DIR}/include/tds.h: see the Autoconf documentation&quot; &gt;&amp;5
-echo &quot;$as_me: WARNING: ${tds_DIR}/include/tds.h: see the Autoconf documentation&quot; &gt;&amp;2;}
-    { echo &quot;$as_me:$LINENO: WARNING: ${tds_DIR}/include/tds.h:     section \&quot;Present But Cannot Be Compiled\&quot;&quot; &gt;&amp;5
-echo &quot;$as_me: WARNING: ${tds_DIR}/include/tds.h:     section \&quot;Present But Cannot Be Compiled\&quot;&quot; &gt;&amp;2;}
-    { echo &quot;$as_me:$LINENO: WARNING: ${tds_DIR}/include/tds.h: proceeding with the preprocessor's result&quot; &gt;&amp;5
-echo &quot;$as_me: WARNING: ${tds_DIR}/include/tds.h: proceeding with the preprocessor's result&quot; &gt;&amp;2;}
-    { echo &quot;$as_me:$LINENO: WARNING: ${tds_DIR}/include/tds.h: in the future, the compiler will take precedence&quot; &gt;&amp;5
-echo &quot;$as_me: WARNING: ${tds_DIR}/include/tds.h: in the future, the compiler will take precedence&quot; &gt;&amp;2;}
-    (
-      cat &lt;&lt;\_ASBOX
-## ------------------------------------------ ##
-## Report this to the AC_PACKAGE_NAME lists.  ##
-## ------------------------------------------ ##
-_ASBOX
-    ) |
-      sed &quot;s/^/$as_me: WARNING:     /&quot; &gt;&amp;2
+    { echo &quot;$as_me:$LINENO: WARNING: ${FREETDS_DIR}/include/tds.h: present but cannot be compiled&quot; &gt;&amp;5
+echo &quot;$as_me: WARNING: ${FREETDS_DIR}/include/tds.h: present but cannot be compiled&quot; &gt;&amp;2;}
+    { echo &quot;$as_me:$LINENO: WARNING: ${FREETDS_DIR}/include/tds.h:     check for missing prerequisite headers?&quot; &gt;&amp;5
+echo &quot;$as_me: WARNING: ${FREETDS_DIR}/include/tds.h:     check for missing prerequisite headers?&quot; &gt;&amp;2;}
+    { echo &quot;$as_me:$LINENO: WARNING: ${FREETDS_DIR}/include/tds.h: see the Autoconf documentation&quot; &gt;&amp;5
+echo &quot;$as_me: WARNING: ${FREETDS_DIR}/include/tds.h: see the Autoconf documentation&quot; &gt;&amp;2;}
+    { echo &quot;$as_me:$LINENO: WARNING: ${FREETDS_DIR}/include/tds.h:     section \&quot;Present But Cannot Be Compiled\&quot;&quot; &gt;&amp;5
+echo &quot;$as_me: WARNING: ${FREETDS_DIR}/include/tds.h:     section \&quot;Present But Cannot Be Compiled\&quot;&quot; &gt;&amp;2;}
+    { echo &quot;$as_me:$LINENO: WARNING: ${FREETDS_DIR}/include/tds.h: proceeding with the preprocessor's result&quot; &gt;&amp;5
+echo &quot;$as_me: WARNING: ${FREETDS_DIR}/include/tds.h: proceeding with the preprocessor's result&quot; &gt;&amp;2;}
+    { echo &quot;$as_me:$LINENO: WARNING: ${FREETDS_DIR}/include/tds.h: in the future, the compiler will take precedence&quot; &gt;&amp;5
+echo &quot;$as_me: WARNING: ${FREETDS_DIR}/include/tds.h: in the future, the compiler will take precedence&quot; &gt;&amp;2;}
+
     ;;
 esac
-echo &quot;$as_me:$LINENO: checking for ${tds_DIR}/include/tds.h&quot; &gt;&amp;5
-echo $ECHO_N &quot;checking for ${tds_DIR}/include/tds.h... $ECHO_C&quot; &gt;&amp;6
-if eval &quot;test \&quot;\${$as_ac_Header+set}\&quot; = set&quot;; then
+{ echo &quot;$as_me:$LINENO: checking for ${FREETDS_DIR}/include/tds.h&quot; &gt;&amp;5
+echo $ECHO_N &quot;checking for ${FREETDS_DIR}/include/tds.h... $ECHO_C&quot; &gt;&amp;6; }
+if { as_var=$as_ac_Header; eval &quot;test \&quot;\${$as_var+set}\&quot; = set&quot;; }; then
   echo $ECHO_N &quot;(cached) $ECHO_C&quot; &gt;&amp;6
 else
   eval &quot;$as_ac_Header=\$ac_header_preproc&quot;
 fi
-echo &quot;$as_me:$LINENO: result: `eval echo '${'$as_ac_Header'}'`&quot; &gt;&amp;5
-echo &quot;${ECHO_T}`eval echo '${'$as_ac_Header'}'`&quot; &gt;&amp;6
+ac_res=`eval echo '${'$as_ac_Header'}'`
+	       { echo &quot;$as_me:$LINENO: result: $ac_res&quot; &gt;&amp;5
+echo &quot;${ECHO_T}$ac_res&quot; &gt;&amp;6; }
 
 fi
 if test `eval echo '${'$as_ac_Header'}'` = yes; then
@@ -10761,17 +12258,17 @@
       else
 	 if test &quot;xtds.h&quot; != &quot;x&quot; ; then
             if test &quot;${ac_cv_header_tds_h+set}&quot; = set; then
-  echo &quot;$as_me:$LINENO: checking for tds.h&quot; &gt;&amp;5
-echo $ECHO_N &quot;checking for tds.h... $ECHO_C&quot; &gt;&amp;6
+  { echo &quot;$as_me:$LINENO: checking for tds.h&quot; &gt;&amp;5
+echo $ECHO_N &quot;checking for tds.h... $ECHO_C&quot; &gt;&amp;6; }
 if test &quot;${ac_cv_header_tds_h+set}&quot; = set; then
   echo $ECHO_N &quot;(cached) $ECHO_C&quot; &gt;&amp;6
 fi
-echo &quot;$as_me:$LINENO: result: $ac_cv_header_tds_h&quot; &gt;&amp;5
-echo &quot;${ECHO_T}$ac_cv_header_tds_h&quot; &gt;&amp;6
+{ echo &quot;$as_me:$LINENO: result: $ac_cv_header_tds_h&quot; &gt;&amp;5
+echo &quot;${ECHO_T}$ac_cv_header_tds_h&quot; &gt;&amp;6; }
 else
   # Is the header compilable?
-echo &quot;$as_me:$LINENO: checking tds.h usability&quot; &gt;&amp;5
-echo $ECHO_N &quot;checking tds.h usability... $ECHO_C&quot; &gt;&amp;6
+{ echo &quot;$as_me:$LINENO: checking tds.h usability&quot; &gt;&amp;5
+echo $ECHO_N &quot;checking tds.h usability... $ECHO_C&quot; &gt;&amp;6; }
 cat &gt;conftest.$ac_ext &lt;&lt;_ACEOF
 /* confdefs.h.  */
 _ACEOF
@@ -10808,15 +12305,16 @@
   echo &quot;$as_me: failed program was:&quot; &gt;&amp;5
 sed 's/^/| /' conftest.$ac_ext &gt;&amp;5
 
-ac_header_compiler=no
+	ac_header_compiler=no
 fi
+
 rm -f conftest.err conftest.$ac_objext conftest.$ac_ext
-echo &quot;$as_me:$LINENO: result: $ac_header_compiler&quot; &gt;&amp;5
-echo &quot;${ECHO_T}$ac_header_compiler&quot; &gt;&amp;6
+{ echo &quot;$as_me:$LINENO: result: $ac_header_compiler&quot; &gt;&amp;5
+echo &quot;${ECHO_T}$ac_header_compiler&quot; &gt;&amp;6; }
 
 # Is the header present?
-echo &quot;$as_me:$LINENO: checking tds.h presence&quot; &gt;&amp;5
-echo $ECHO_N &quot;checking tds.h presence... $ECHO_C&quot; &gt;&amp;6
+{ echo &quot;$as_me:$LINENO: checking tds.h presence&quot; &gt;&amp;5
+echo $ECHO_N &quot;checking tds.h presence... $ECHO_C&quot; &gt;&amp;6; }
 cat &gt;conftest.$ac_ext &lt;&lt;_ACEOF
 /* confdefs.h.  */
 _ACEOF
@@ -10850,9 +12348,10 @@
 
   ac_header_preproc=no
 fi
+
 rm -f conftest.err conftest.$ac_ext
-echo &quot;$as_me:$LINENO: result: $ac_header_preproc&quot; &gt;&amp;5
-echo &quot;${ECHO_T}$ac_header_preproc&quot; &gt;&amp;6
+{ echo &quot;$as_me:$LINENO: result: $ac_header_preproc&quot; &gt;&amp;5
+echo &quot;${ECHO_T}$ac_header_preproc&quot; &gt;&amp;6; }
 
 # So?  What about this header?
 case $ac_header_compiler:$ac_header_preproc:$ac_c_preproc_warn_flag in
@@ -10876,25 +12375,18 @@
 echo &quot;$as_me: WARNING: tds.h: proceeding with the preprocessor's result&quot; &gt;&amp;2;}
     { echo &quot;$as_me:$LINENO: WARNING: tds.h: in the future, the compiler will take precedence&quot; &gt;&amp;5
 echo &quot;$as_me: WARNING: tds.h: in the future, the compiler will take precedence&quot; &gt;&amp;2;}
-    (
-      cat &lt;&lt;\_ASBOX
-## ------------------------------------------ ##
-## Report this to the AC_PACKAGE_NAME lists.  ##
-## ------------------------------------------ ##
-_ASBOX
-    ) |
-      sed &quot;s/^/$as_me: WARNING:     /&quot; &gt;&amp;2
+
     ;;
 esac
-echo &quot;$as_me:$LINENO: checking for tds.h&quot; &gt;&amp;5
-echo $ECHO_N &quot;checking for tds.h... $ECHO_C&quot; &gt;&amp;6
+{ echo &quot;$as_me:$LINENO: checking for tds.h&quot; &gt;&amp;5
+echo $ECHO_N &quot;checking for tds.h... $ECHO_C&quot; &gt;&amp;6; }
 if test &quot;${ac_cv_header_tds_h+set}&quot; = set; then
   echo $ECHO_N &quot;(cached) $ECHO_C&quot; &gt;&amp;6
 else
   ac_cv_header_tds_h=$ac_header_preproc
 fi
-echo &quot;$as_me:$LINENO: result: $ac_cv_header_tds_h&quot; &gt;&amp;5
-echo &quot;${ECHO_T}$ac_cv_header_tds_h&quot; &gt;&amp;6
+{ echo &quot;$as_me:$LINENO: result: $ac_cv_header_tds_h&quot; &gt;&amp;5
+echo &quot;${ECHO_T}$ac_cv_header_tds_h&quot; &gt;&amp;6; }
 
 fi
 if test $ac_cv_header_tds_h = yes; then
@@ -10907,7 +12399,7 @@
 	 fi
       fi
       if test &quot;x${FREETDS_HEADER_FOUND}&quot; = &quot;x0&quot; ; then
-         if test ! -z &quot;${tds_MANDATORY}&quot; ;
+         if test ! -z &quot;${FREETDS_MANDATORY}&quot; ;
          then
             echo &quot; ***&quot;
             echo &quot; *** It appears that you do not have the tds development package installed.&quot;
@@ -10915,18 +12407,18 @@
             echo &quot; *** without explicitly specifying --with-tds&quot;
             exit 1
          fi
-         tds_LIB=&quot;&quot;
-         tds_INCLUDE=&quot;&quot;
-         PBX_LIBtds=0
+         FREETDS_LIB=&quot;&quot;
+         FREETDS_INCLUDE=&quot;&quot;
+         PBX_LIBFREETDS=0
       else
-         PBX_LIBtds=1
+         PBX_LIBFREETDS=1
 
 cat &gt;&gt;confdefs.h &lt;&lt;_ACEOF
 #define HAVE_FREETDS 1
 _ACEOF
 
       fi
-   elif test ! -z &quot;${tds_MANDATORY}&quot;;
+   elif test ! -z &quot;${FREETDS_MANDATORY}&quot;;
    then
       echo &quot;***&quot;
       echo &quot;*** The FreeTDS installation on this system appears to be broken.&quot;
@@ -10941,34 +12433,34 @@
 
 
 
-# Check whether --with-termcap or --without-termcap was given.
+# Check whether --with-termcap was given.
 if test &quot;${with_termcap+set}&quot; = set; then
-  withval=&quot;$with_termcap&quot;
-
+  withval=$with_termcap;
 case ${withval} in
      n|no)
-     USE_termcap=no
+     USE_TERMCAP=no
      ;;
      y|ye|yes)
-     termcap_MANDATORY=&quot;yes&quot;
+     TERMCAP_MANDATORY=&quot;yes&quot;
      ;;
      *)
-     termcap_DIR=&quot;${withval}&quot;
-     termcap_MANDATORY=&quot;yes&quot;
+     TERMCAP_DIR=&quot;${withval}&quot;
+     TERMCAP_MANDATORY=&quot;yes&quot;
      ;;
 esac
 
-fi;
+fi
 
-PBX_LIBtermcap=0
 
-if test &quot;${USE_termcap}&quot; != &quot;no&quot;; then
+PBX_LIBTERMCAP=0
+
+if test &quot;${USE_TERMCAP}&quot; != &quot;no&quot;; then
    pbxlibdir=&quot;&quot;
-   if test &quot;x${termcap_DIR}&quot; != &quot;x&quot;; then
+   if test &quot;x${TERMCAP_DIR}&quot; != &quot;x&quot;; then
       pbxlibdir=&quot;-L${termcap_DIR}/lib&quot;
    fi
-   echo &quot;$as_me:$LINENO: checking for tgetent in -ltermcap&quot; &gt;&amp;5
-echo $ECHO_N &quot;checking for tgetent in -ltermcap... $ECHO_C&quot; &gt;&amp;6
+   { echo &quot;$as_me:$LINENO: checking for tgetent in -ltermcap&quot; &gt;&amp;5
+echo $ECHO_N &quot;checking for tgetent in -ltermcap... $ECHO_C&quot; &gt;&amp;6; }
 if test &quot;${ac_cv_lib_termcap_tgetent+set}&quot; = set; then
   echo $ECHO_N &quot;(cached) $ECHO_C&quot; &gt;&amp;6
 else
@@ -10981,17 +12473,17 @@
 cat &gt;&gt;conftest.$ac_ext &lt;&lt;_ACEOF
 /* end confdefs.h.  */
 
-/* Override any gcc2 internal prototype to avoid an error.  */
+/* Override any GCC internal prototype to avoid an error.
+   Use char because int might match the return type of a GCC
+   builtin and then its argument prototype would still apply.  */
 #ifdef __cplusplus
 extern &quot;C&quot;
 #endif
-/* We use char because int might match the return type of a gcc2
-   builtin and then its argument prototype would still apply.  */
 char tgetent ();
 int
 main ()
 {
-tgetent ();
+return tgetent ();
   ;
   return 0;
 }
@@ -11023,39 +12515,43 @@
   echo &quot;$as_me: failed program was:&quot; &gt;&amp;5
 sed 's/^/| /' conftest.$ac_ext &gt;&amp;5
 
-ac_cv_lib_termcap_tgetent=no
+	ac_cv_lib_termcap_tgetent=no
 fi
+
 rm -f conftest.err conftest.$ac_objext \
       conftest$ac_exeext conftest.$ac_ext
 LIBS=$ac_check_lib_save_LIBS
 fi
-echo &quot;$as_me:$LINENO: result: $ac_cv_lib_termcap_tgetent&quot; &gt;&amp;5
-echo &quot;${ECHO_T}$ac_cv_lib_termcap_tgetent&quot; &gt;&amp;6
+{ echo &quot;$as_me:$LINENO: result: $ac_cv_lib_termcap_tgetent&quot; &gt;&amp;5
+echo &quot;${ECHO_T}$ac_cv_lib_termcap_tgetent&quot; &gt;&amp;6; }
 if test $ac_cv_lib_termcap_tgetent = yes; then
-  :
+  AST_TERMCAP_FOUND=yes
+else
+  AST_TERMCAP_FOUND=no
 fi
 
 
-   if test &quot;${ac_cv_lib_termcap_tgetent}&quot; = &quot;yes&quot;; then
-      termcap_LIB=&quot;-ltermcap &quot;
+   if test &quot;${AST_TERMCAP_FOUND}&quot; = &quot;yes&quot;; then
+      TERMCAP_LIB=&quot;-ltermcap &quot;
       TERMCAP_HEADER_FOUND=&quot;1&quot;
-      if test &quot;x${termcap_DIR}&quot; != &quot;x&quot;; then
-         termcap_LIB=&quot;${pbxlibdir} ${termcap_LIB}&quot;
-	 termcap_INCLUDE=&quot;-I${termcap_DIR}/include&quot;
+      if test &quot;x${TERMCAP_DIR}&quot; != &quot;x&quot;; then
+         TERMCAP_LIB=&quot;${pbxlibdir} ${TERMCAP_LIB}&quot;
+	 TERMCAP_INCLUDE=&quot;-I${TERMCAP_DIR}/include&quot;
 	 if test &quot;x&quot; != &quot;x&quot; ; then
-	    as_ac_Header=`echo &quot;ac_cv_header_${termcap_DIR}/include/&quot; | $as_tr_sh`
-if eval &quot;test \&quot;\${$as_ac_Header+set}\&quot; = set&quot;; then
-  echo &quot;$as_me:$LINENO: checking for ${termcap_DIR}/include/&quot; &gt;&amp;5
-echo $ECHO_N &quot;checking for ${termcap_DIR}/include/... $ECHO_C&quot; &gt;&amp;6
-if eval &quot;test \&quot;\${$as_ac_Header+set}\&quot; = set&quot;; then
+	    as_ac_Header=`echo &quot;ac_cv_header_${TERMCAP_DIR}/include/&quot; | $as_tr_sh`
+if { as_var=$as_ac_Header; eval &quot;test \&quot;\${$as_var+set}\&quot; = set&quot;; }; then
+  { echo &quot;$as_me:$LINENO: checking for ${TERMCAP_DIR}/include/&quot; &gt;&amp;5
+echo $ECHO_N &quot;checking for ${TERMCAP_DIR}/include/... $ECHO_C&quot; &gt;&amp;6; }
+if { as_var=$as_ac_Header; eval &quot;test \&quot;\${$as_var+set}\&quot; = set&quot;; }; then
   echo $ECHO_N &quot;(cached) $ECHO_C&quot; &gt;&amp;6
 fi
-echo &quot;$as_me:$LINENO: result: `eval echo '${'$as_ac_Header'}'`&quot; &gt;&amp;5
-echo &quot;${ECHO_T}`eval echo '${'$as_ac_Header'}'`&quot; &gt;&amp;6
+ac_res=`eval echo '${'$as_ac_Header'}'`
+	       { echo &quot;$as_me:$LINENO: result: $ac_res&quot; &gt;&amp;5
+echo &quot;${ECHO_T}$ac_res&quot; &gt;&amp;6; }
 else
   # Is the header compilable?
-echo &quot;$as_me:$LINENO: checking ${termcap_DIR}/include/ usability&quot; &gt;&amp;5
-echo $ECHO_N &quot;checking ${termcap_DIR}/include/ usability... $ECHO_C&quot; &gt;&amp;6
+{ echo &quot;$as_me:$LINENO: checking ${TERMCAP_DIR}/include/ usability&quot; &gt;&amp;5
+echo $ECHO_N &quot;checking ${TERMCAP_DIR}/include/ usability... $ECHO_C&quot; &gt;&amp;6; }
 cat &gt;conftest.$ac_ext &lt;&lt;_ACEOF
 /* confdefs.h.  */
 _ACEOF
@@ -11063,7 +12559,7 @@
 cat &gt;&gt;conftest.$ac_ext &lt;&lt;_ACEOF
 /* end confdefs.h.  */
 $ac_includes_default
-#include &lt;${termcap_DIR}/include/&gt;
+#include &lt;${TERMCAP_DIR}/include/&gt;
 _ACEOF
 rm -f conftest.$ac_objext
 if { (eval echo &quot;$as_me:$LINENO: \&quot;$ac_compile\&quot;&quot;) &gt;&amp;5
@@ -11092,22 +12588,23 @@
   echo &quot;$as_me: failed program was:&quot; &gt;&amp;5
 sed 's/^/| /' conftest.$ac_ext &gt;&amp;5
 
-ac_header_compiler=no
+	ac_header_compiler=no
 fi
+
 rm -f conftest.err conftest.$ac_objext conftest.$ac_ext
-echo &quot;$as_me:$LINENO: result: $ac_header_compiler&quot; &gt;&amp;5
-echo &quot;${ECHO_T}$ac_header_compiler&quot; &gt;&amp;6
+{ echo &quot;$as_me:$LINENO: result: $ac_header_compiler&quot; &gt;&amp;5
+echo &quot;${ECHO_T}$ac_header_compiler&quot; &gt;&amp;6; }
 
 # Is the header present?
-echo &quot;$as_me:$LINENO: checking ${termcap_DIR}/include/ presence&quot; &gt;&amp;5
-echo $ECHO_N &quot;checking ${termcap_DIR}/include/ presence... $ECHO_C&quot; &gt;&amp;6
+{ echo &quot;$as_me:$LINENO: checking ${TERMCAP_DIR}/include/ presence&quot; &gt;&amp;5
+echo $ECHO_N &quot;checking ${TERMCAP_DIR}/include/ presence... $ECHO_C&quot; &gt;&amp;6; }
 cat &gt;conftest.$ac_ext &lt;&lt;_ACEOF
 /* confdefs.h.  */
 _ACEOF
 cat confdefs.h &gt;&gt;conftest.$ac_ext
 cat &gt;&gt;conftest.$ac_ext &lt;&lt;_ACEOF
 /* end confdefs.h.  */
-#include &lt;${termcap_DIR}/include/&gt;
+#include &lt;${TERMCAP_DIR}/include/&gt;
 _ACEOF
 if { (eval echo &quot;$as_me:$LINENO: \&quot;$ac_cpp conftest.$ac_ext\&quot;&quot;) &gt;&amp;5
   (eval $ac_cpp conftest.$ac_ext) 2&gt;conftest.er1
@@ -11134,51 +12631,46 @@
 
   ac_header_preproc=no
 fi
+
 rm -f conftest.err conftest.$ac_ext
-echo &quot;$as_me:$LINENO: result: $ac_header_preproc&quot; &gt;&amp;5
-echo &quot;${ECHO_T}$ac_header_preproc&quot; &gt;&amp;6
+{ echo &quot;$as_me:$LINENO: result: $ac_header_preproc&quot; &gt;&amp;5
+echo &quot;${ECHO_T}$ac_header_preproc&quot; &gt;&amp;6; }
 
 # So?  What about this header?
 case $ac_header_compiler:$ac_header_preproc:$ac_c_preproc_warn_flag in
   yes:no: )
-    { echo &quot;$as_me:$LINENO: WARNING: ${termcap_DIR}/include/: accepted by the compiler, rejected by the preprocessor!&quot; &gt;&amp;5
-echo &quot;$as_me: WARNING: ${termcap_DIR}/include/: accepted by the compiler, rejected by the preprocessor!&quot; &gt;&amp;2;}
-    { echo &quot;$as_me:$LINENO: WARNING: ${termcap_DIR}/include/: proceeding with the compiler's result&quot; &gt;&amp;5
-echo &quot;$as_me: WARNING: ${termcap_DIR}/include/: proceeding with the compiler's result&quot; &gt;&amp;2;}
+    { echo &quot;$as_me:$LINENO: WARNING: ${TERMCAP_DIR}/include/: accepted by the compiler, rejected by the preprocessor!&quot; &gt;&amp;5
+echo &quot;$as_me: WARNING: ${TERMCAP_DIR}/include/: accepted by the compiler, rejected by the preprocessor!&quot; &gt;&amp;2;}
+    { echo &quot;$as_me:$LINENO: WARNING: ${TERMCAP_DIR}/include/: proceeding with the compiler's result&quot; &gt;&amp;5
+echo &quot;$as_me: WARNING: ${TERMCAP_DIR}/include/: proceeding with the compiler's result&quot; &gt;&amp;2;}
     ac_header_preproc=yes
     ;;
   no:yes:* )
-    { echo &quot;$as_me:$LINENO: WARNING: ${termcap_DIR}/include/: present but cannot be compiled&quot; &gt;&amp;5
-echo &quot;$as_me: WARNING: ${termcap_DIR}/include/: present but cannot be compiled&quot; &gt;&amp;2;}
-    { echo &quot;$as_me:$LINENO: WARNING: ${termcap_DIR}/include/:     check for missing prerequisite headers?&quot; &gt;&amp;5
-echo &quot;$as_me: WARNING: ${termcap_DIR}/include/:     check for missing prerequisite headers?&quot; &gt;&amp;2;}
-    { echo &quot;$as_me:$LINENO: WARNING: ${termcap_DIR}/include/: see the Autoconf documentation&quot; &gt;&amp;5
-echo &quot;$as_me: WARNING: ${termcap_DIR}/include/: see the Autoconf documentation&quot; &gt;&amp;2;}
-    { echo &quot;$as_me:$LINENO: WARNING: ${termcap_DIR}/include/:     section \&quot;Present But Cannot Be Compiled\&quot;&quot; &gt;&amp;5
-echo &quot;$as_me: WARNING: ${termcap_DIR}/include/:     section \&quot;Present But Cannot Be Compiled\&quot;&quot; &gt;&amp;2;}
-    { echo &quot;$as_me:$LINENO: WARNING: ${termcap_DIR}/include/: proceeding with the preprocessor's result&quot; &gt;&amp;5
-echo &quot;$as_me: WARNING: ${termcap_DIR}/include/: proceeding with the preprocessor's result&quot; &gt;&amp;2;}
-    { echo &quot;$as_me:$LINENO: WARNING: ${termcap_DIR}/include/: in the future, the compiler will take precedence&quot; &gt;&amp;5
-echo &quot;$as_me: WARNING: ${termcap_DIR}/include/: in the future, the compiler will take precedence&quot; &gt;&amp;2;}
-    (
-      cat &lt;&lt;\_ASBOX
-## ------------------------------------------ ##
-## Report this to the AC_PACKAGE_NAME lists.  ##
-## ------------------------------------------ ##
-_ASBOX
-    ) |
-      sed &quot;s/^/$as_me: WARNING:     /&quot; &gt;&amp;2
+    { echo &quot;$as_me:$LINENO: WARNING: ${TERMCAP_DIR}/include/: present but cannot be compiled&quot; &gt;&amp;5
+echo &quot;$as_me: WARNING: ${TERMCAP_DIR}/include/: present but cannot be compiled&quot; &gt;&amp;2;}
+    { echo &quot;$as_me:$LINENO: WARNING: ${TERMCAP_DIR}/include/:     check for missing prerequisite headers?&quot; &gt;&amp;5
+echo &quot;$as_me: WARNING: ${TERMCAP_DIR}/include/:     check for missing prerequisite headers?&quot; &gt;&amp;2;}
+    { echo &quot;$as_me:$LINENO: WARNING: ${TERMCAP_DIR}/include/: see the Autoconf documentation&quot; &gt;&amp;5
+echo &quot;$as_me: WARNING: ${TERMCAP_DIR}/include/: see the Autoconf documentation&quot; &gt;&amp;2;}
+    { echo &quot;$as_me:$LINENO: WARNING: ${TERMCAP_DIR}/include/:     section \&quot;Present But Cannot Be Compiled\&quot;&quot; &gt;&amp;5
+echo &quot;$as_me: WARNING: ${TERMCAP_DIR}/include/:     section \&quot;Present But Cannot Be Compiled\&quot;&quot; &gt;&amp;2;}
+    { echo &quot;$as_me:$LINENO: WARNING: ${TERMCAP_DIR}/include/: proceeding with the preprocessor's result&quot; &gt;&amp;5
+echo &quot;$as_me: WARNING: ${TERMCAP_DIR}/include/: proceeding with the preprocessor's result&quot; &gt;&amp;2;}
+    { echo &quot;$as_me:$LINENO: WARNING: ${TERMCAP_DIR}/include/: in the future, the compiler will take precedence&quot; &gt;&amp;5
+echo &quot;$as_me: WARNING: ${TERMCAP_DIR}/include/: in the future, the compiler will take precedence&quot; &gt;&amp;2;}
+
     ;;
 esac
-echo &quot;$as_me:$LINENO: checking for ${termcap_DIR}/include/&quot; &gt;&amp;5
-echo $ECHO_N &quot;checking for ${termcap_DIR}/include/... $ECHO_C&quot; &gt;&amp;6
-if eval &quot;test \&quot;\${$as_ac_Header+set}\&quot; = set&quot;; then
+{ echo &quot;$as_me:$LINENO: checking for ${TERMCAP_DIR}/include/&quot; &gt;&amp;5
+echo $ECHO_N &quot;checking for ${TERMCAP_DIR}/include/... $ECHO_C&quot; &gt;&amp;6; }
+if { as_var=$as_ac_Header; eval &quot;test \&quot;\${$as_var+set}\&quot; = set&quot;; }; then
   echo $ECHO_N &quot;(cached) $ECHO_C&quot; &gt;&amp;6
 else
   eval &quot;$as_ac_Header=\$ac_header_preproc&quot;
 fi
-echo &quot;$as_me:$LINENO: result: `eval echo '${'$as_ac_Header'}'`&quot; &gt;&amp;5
-echo &quot;${ECHO_T}`eval echo '${'$as_ac_Header'}'`&quot; &gt;&amp;6
+ac_res=`eval echo '${'$as_ac_Header'}'`
+	       { echo &quot;$as_me:$LINENO: result: $ac_res&quot; &gt;&amp;5
+echo &quot;${ECHO_T}$ac_res&quot; &gt;&amp;6; }
 
 fi
 if test `eval echo '${'$as_ac_Header'}'` = yes; then
@@ -11192,17 +12684,17 @@
       else
 	 if test &quot;x&quot; != &quot;x&quot; ; then
             if test &quot;${ac_cv_header_+set}&quot; = set; then
-  echo &quot;$as_me:$LINENO: checking for &quot; &gt;&amp;5
-echo $ECHO_N &quot;checking for ... $ECHO_C&quot; &gt;&amp;6
+  { echo &quot;$as_me:$LINENO: checking for &quot; &gt;&amp;5
+echo $ECHO_N &quot;checking for ... $ECHO_C&quot; &gt;&amp;6; }
 if test &quot;${ac_cv_header_+set}&quot; = set; then
   echo $ECHO_N &quot;(cached) $ECHO_C&quot; &gt;&amp;6
 fi
-echo &quot;$as_me:$LINENO: result: $ac_cv_header_&quot; &gt;&amp;5
-echo &quot;${ECHO_T}$ac_cv_header_&quot; &gt;&amp;6
+{ echo &quot;$as_me:$LINENO: result: $ac_cv_header_&quot; &gt;&amp;5
+echo &quot;${ECHO_T}$ac_cv_header_&quot; &gt;&amp;6; }
 else
   # Is the header compilable?
-echo &quot;$as_me:$LINENO: checking  usability&quot; &gt;&amp;5
-echo $ECHO_N &quot;checking  usability... $ECHO_C&quot; &gt;&amp;6
+{ echo &quot;$as_me:$LINENO: checking  usability&quot; &gt;&amp;5
+echo $ECHO_N &quot;checking  usability... $ECHO_C&quot; &gt;&amp;6; }
 cat &gt;conftest.$ac_ext &lt;&lt;_ACEOF
 /* confdefs.h.  */
 _ACEOF
@@ -11239,15 +12731,16 @@
   echo &quot;$as_me: failed program was:&quot; &gt;&amp;5
 sed 's/^/| /' conftest.$ac_ext &gt;&amp;5
 
-ac_header_compiler=no
+	ac_header_compiler=no
 fi
+
 rm -f conftest.err conftest.$ac_objext conftest.$ac_ext
-echo &quot;$as_me:$LINENO: result: $ac_header_compiler&quot; &gt;&amp;5
-echo &quot;${ECHO_T}$ac_header_compiler&quot; &gt;&amp;6
+{ echo &quot;$as_me:$LINENO: result: $ac_header_compiler&quot; &gt;&amp;5
+echo &quot;${ECHO_T}$ac_header_compiler&quot; &gt;&amp;6; }
 
 # Is the header present?
-echo &quot;$as_me:$LINENO: checking  presence&quot; &gt;&amp;5
-echo $ECHO_N &quot;checking  presence... $ECHO_C&quot; &gt;&amp;6
+{ echo &quot;$as_me:$LINENO: checking  presence&quot; &gt;&amp;5
+echo $ECHO_N &quot;checking  presence... $ECHO_C&quot; &gt;&amp;6; }
 cat &gt;conftest.$ac_ext &lt;&lt;_ACEOF
 /* confdefs.h.  */
 _ACEOF
@@ -11281,9 +12774,10 @@
 
   ac_header_preproc=no
 fi
+
 rm -f conftest.err conftest.$ac_ext
-echo &quot;$as_me:$LINENO: result: $ac_header_preproc&quot; &gt;&amp;5
-echo &quot;${ECHO_T}$ac_header_preproc&quot; &gt;&amp;6
+{ echo &quot;$as_me:$LINENO: result: $ac_header_preproc&quot; &gt;&amp;5
+echo &quot;${ECHO_T}$ac_header_preproc&quot; &gt;&amp;6; }
 
 # So?  What about this header?
 case $ac_header_compiler:$ac_header_preproc:$ac_c_preproc_warn_flag in
@@ -11307,25 +12801,18 @@
 echo &quot;$as_me: WARNING: : proceeding with the preprocessor's result&quot; &gt;&amp;2;}
     { echo &quot;$as_me:$LINENO: WARNING: : in the future, the compiler will take precedence&quot; &gt;&amp;5
 echo &quot;$as_me: WARNING: : in the future, the compiler will take precedence&quot; &gt;&amp;2;}
-    (
-      cat &lt;&lt;\_ASBOX
-## ------------------------------------------ ##
-## Report this to the AC_PACKAGE_NAME lists.  ##
-## ------------------------------------------ ##
-_ASBOX
-    ) |
-      sed &quot;s/^/$as_me: WARNING:     /&quot; &gt;&amp;2
+
     ;;
 esac
-echo &quot;$as_me:$LINENO: checking for &quot; &gt;&amp;5
-echo $ECHO_N &quot;checking for ... $ECHO_C&quot; &gt;&amp;6
+{ echo &quot;$as_me:$LINENO: checking for &quot; &gt;&amp;5
+echo $ECHO_N &quot;checking for ... $ECHO_C&quot; &gt;&amp;6; }
 if test &quot;${ac_cv_header_+set}&quot; = set; then
   echo $ECHO_N &quot;(cached) $ECHO_C&quot; &gt;&amp;6
 else
   ac_cv_header_=$ac_header_preproc
 fi
-echo &quot;$as_me:$LINENO: result: $ac_cv_header_&quot; &gt;&amp;5
-echo &quot;${ECHO_T}$ac_cv_header_&quot; &gt;&amp;6
+{ echo &quot;$as_me:$LINENO: result: $ac_cv_header_&quot; &gt;&amp;5
+echo &quot;${ECHO_T}$ac_cv_header_&quot; &gt;&amp;6; }
 
 fi
 if test $ac_cv_header_ = yes; then
@@ -11338,7 +12825,7 @@
 	 fi
       fi
       if test &quot;x${TERMCAP_HEADER_FOUND}&quot; = &quot;x0&quot; ; then
-         if test ! -z &quot;${termcap_MANDATORY}&quot; ;
+         if test ! -z &quot;${TERMCAP_MANDATORY}&quot; ;
          then
             echo &quot; ***&quot;
             echo &quot; *** It appears that you do not have the termcap development package installed.&quot;
@@ -11346,18 +12833,18 @@
             echo &quot; *** without explicitly specifying --with-termcap&quot;
             exit 1
          fi
-         termcap_LIB=&quot;&quot;
-         termcap_INCLUDE=&quot;&quot;
-         PBX_LIBtermcap=0
+         TERMCAP_LIB=&quot;&quot;
+         TERMCAP_INCLUDE=&quot;&quot;
+         PBX_LIBTERMCAP=0
       else
-         PBX_LIBtermcap=1
+         PBX_LIBTERMCAP=1
 
 cat &gt;&gt;confdefs.h &lt;&lt;_ACEOF
 #define HAVE_TERMCAP 1
 _ACEOF
 
       fi
-   elif test ! -z &quot;${termcap_MANDATORY}&quot;;
+   elif test ! -z &quot;${TERMCAP_MANDATORY}&quot;;
    then
       echo &quot;***&quot;
       echo &quot;*** The Termcap installation on this system appears to be broken.&quot;
@@ -11372,34 +12859,34 @@
 
 
 
-# Check whether --with-tinfo or --without-tinfo was given.
+# Check whether --with-tinfo was given.
 if test &quot;${with_tinfo+set}&quot; = set; then
-  withval=&quot;$with_tinfo&quot;
-
+  withval=$with_tinfo;
 case ${withval} in
      n|no)
-     USE_tinfo=no
+     USE_TINFO=no
      ;;
      y|ye|yes)
-     tinfo_MANDATORY=&quot;yes&quot;
+     TINFO_MANDATORY=&quot;yes&quot;
      ;;
      *)
-     tinfo_DIR=&quot;${withval}&quot;
-     tinfo_MANDATORY=&quot;yes&quot;
+     TINFO_DIR=&quot;${withval}&quot;
+     TINFO_MANDATORY=&quot;yes&quot;
      ;;
 esac
 
-fi;
+fi
 
-PBX_LIBtinfo=0
 
-if test &quot;${USE_tinfo}&quot; != &quot;no&quot;; then
+PBX_LIBTINFO=0
+
+if test &quot;${USE_TINFO}&quot; != &quot;no&quot;; then
    pbxlibdir=&quot;&quot;
-   if test &quot;x${tinfo_DIR}&quot; != &quot;x&quot;; then
+   if test &quot;x${TINFO_DIR}&quot; != &quot;x&quot;; then
       pbxlibdir=&quot;-L${tinfo_DIR}/lib&quot;
    fi
-   echo &quot;$as_me:$LINENO: checking for tgetent in -ltinfo&quot; &gt;&amp;5
-echo $ECHO_N &quot;checking for tgetent in -ltinfo... $ECHO_C&quot; &gt;&amp;6
+   { echo &quot;$as_me:$LINENO: checking for tgetent in -ltinfo&quot; &gt;&amp;5
+echo $ECHO_N &quot;checking for tgetent in -ltinfo... $ECHO_C&quot; &gt;&amp;6; }
 if test &quot;${ac_cv_lib_tinfo_tgetent+set}&quot; = set; then
   echo $ECHO_N &quot;(cached) $ECHO_C&quot; &gt;&amp;6
 else
@@ -11412,17 +12899,17 @@
 cat &gt;&gt;conftest.$ac_ext &lt;&lt;_ACEOF
 /* end confdefs.h.  */
 
-/* Override any gcc2 internal prototype to avoid an error.  */
+/* Override any GCC internal prototype to avoid an error.
+   Use char because int might match the return type of a GCC
+   builtin and then its argument prototype would still apply.  */
 #ifdef __cplusplus
 extern &quot;C&quot;
 #endif
-/* We use char because int might match the return type of a gcc2
-   builtin and then its argument prototype would still apply.  */
 char tgetent ();
 int
 main ()
 {
-tgetent ();
+return tgetent ();
   ;
   return 0;
 }
@@ -11454,39 +12941,43 @@
   echo &quot;$as_me: failed program was:&quot; &gt;&amp;5
 sed 's/^/| /' conftest.$ac_ext &gt;&amp;5
 
-ac_cv_lib_tinfo_tgetent=no
+	ac_cv_lib_tinfo_tgetent=no
 fi
+
 rm -f conftest.err conftest.$ac_objext \
       conftest$ac_exeext conftest.$ac_ext
 LIBS=$ac_check_lib_save_LIBS
 fi
-echo &quot;$as_me:$LINENO: result: $ac_cv_lib_tinfo_tgetent&quot; &gt;&amp;5
-echo &quot;${ECHO_T}$ac_cv_lib_tinfo_tgetent&quot; &gt;&amp;6
+{ echo &quot;$as_me:$LINENO: result: $ac_cv_lib_tinfo_tgetent&quot; &gt;&amp;5
+echo &quot;${ECHO_T}$ac_cv_lib_tinfo_tgetent&quot; &gt;&amp;6; }
 if test $ac_cv_lib_tinfo_tgetent = yes; then
-  :
+  AST_TINFO_FOUND=yes
+else
+  AST_TINFO_FOUND=no
 fi
 
 
-   if test &quot;${ac_cv_lib_tinfo_tgetent}&quot; = &quot;yes&quot;; then
-      tinfo_LIB=&quot;-ltinfo &quot;
+   if test &quot;${AST_TINFO_FOUND}&quot; = &quot;yes&quot;; then
+      TINFO_LIB=&quot;-ltinfo &quot;
       TINFO_HEADER_FOUND=&quot;1&quot;
-      if test &quot;x${tinfo_DIR}&quot; != &quot;x&quot;; then
-         tinfo_LIB=&quot;${pbxlibdir} ${tinfo_LIB}&quot;
-	 tinfo_INCLUDE=&quot;-I${tinfo_DIR}/include&quot;
+      if test &quot;x${TINFO_DIR}&quot; != &quot;x&quot;; then
+         TINFO_LIB=&quot;${pbxlibdir} ${TINFO_LIB}&quot;
+	 TINFO_INCLUDE=&quot;-I${TINFO_DIR}/include&quot;
 	 if test &quot;x&quot; != &quot;x&quot; ; then
-	    as_ac_Header=`echo &quot;ac_cv_header_${tinfo_DIR}/include/&quot; | $as_tr_sh`
-if eval &quot;test \&quot;\${$as_ac_Header+set}\&quot; = set&quot;; then
-  echo &quot;$as_me:$LINENO: checking for ${tinfo_DIR}/include/&quot; &gt;&amp;5
-echo $ECHO_N &quot;checking for ${tinfo_DIR}/include/... $ECHO_C&quot; &gt;&amp;6
-if eval &quot;test \&quot;\${$as_ac_Header+set}\&quot; = set&quot;; then
+	    as_ac_Header=`echo &quot;ac_cv_header_${TINFO_DIR}/include/&quot; | $as_tr_sh`
+if { as_var=$as_ac_Header; eval &quot;test \&quot;\${$as_var+set}\&quot; = set&quot;; }; then
+  { echo &quot;$as_me:$LINENO: checking for ${TINFO_DIR}/include/&quot; &gt;&amp;5
+echo $ECHO_N &quot;checking for ${TINFO_DIR}/include/... $ECHO_C&quot; &gt;&amp;6; }
+if { as_var=$as_ac_Header; eval &quot;test \&quot;\${$as_var+set}\&quot; = set&quot;; }; then
   echo $ECHO_N &quot;(cached) $ECHO_C&quot; &gt;&amp;6
 fi
-echo &quot;$as_me:$LINENO: result: `eval echo '${'$as_ac_Header'}'`&quot; &gt;&amp;5
-echo &quot;${ECHO_T}`eval echo '${'$as_ac_Header'}'`&quot; &gt;&amp;6
+ac_res=`eval echo '${'$as_ac_Header'}'`
+	       { echo &quot;$as_me:$LINENO: result: $ac_res&quot; &gt;&amp;5
+echo &quot;${ECHO_T}$ac_res&quot; &gt;&amp;6; }
 else
   # Is the header compilable?
-echo &quot;$as_me:$LINENO: checking ${tinfo_DIR}/include/ usability&quot; &gt;&amp;5
-echo $ECHO_N &quot;checking ${tinfo_DIR}/include/ usability... $ECHO_C&quot; &gt;&amp;6
+{ echo &quot;$as_me:$LINENO: checking ${TINFO_DIR}/include/ usability&quot; &gt;&amp;5
+echo $ECHO_N &quot;checking ${TINFO_DIR}/include/ usability... $ECHO_C&quot; &gt;&amp;6; }
 cat &gt;conftest.$ac_ext &lt;&lt;_ACEOF
 /* confdefs.h.  */
 _ACEOF
@@ -11494,7 +12985,7 @@
 cat &gt;&gt;conftest.$ac_ext &lt;&lt;_ACEOF
 /* end confdefs.h.  */
 $ac_includes_default
-#include &lt;${tinfo_DIR}/include/&gt;
+#include &lt;${TINFO_DIR}/include/&gt;
 _ACEOF
 rm -f conftest.$ac_objext
 if { (eval echo &quot;$as_me:$LINENO: \&quot;$ac_compile\&quot;&quot;) &gt;&amp;5
@@ -11523,22 +13014,23 @@
   echo &quot;$as_me: failed program was:&quot; &gt;&amp;5
 sed 's/^/| /' conftest.$ac_ext &gt;&amp;5
 
-ac_header_compiler=no
+	ac_header_compiler=no
 fi
+
 rm -f conftest.err conftest.$ac_objext conftest.$ac_ext
-echo &quot;$as_me:$LINENO: result: $ac_header_compiler&quot; &gt;&amp;5
-echo &quot;${ECHO_T}$ac_header_compiler&quot; &gt;&amp;6
+{ echo &quot;$as_me:$LINENO: result: $ac_header_compiler&quot; &gt;&amp;5
+echo &quot;${ECHO_T}$ac_header_compiler&quot; &gt;&amp;6; }
 
 # Is the header present?
-echo &quot;$as_me:$LINENO: checking ${tinfo_DIR}/include/ presence&quot; &gt;&amp;5
-echo $ECHO_N &quot;checking ${tinfo_DIR}/include/ presence... $ECHO_C&quot; &gt;&amp;6
+{ echo &quot;$as_me:$LINENO: checking ${TINFO_DIR}/include/ presence&quot; &gt;&amp;5
+echo $ECHO_N &quot;checking ${TINFO_DIR}/include/ presence... $ECHO_C&quot; &gt;&amp;6; }
 cat &gt;conftest.$ac_ext &lt;&lt;_ACEOF
 /* confdefs.h.  */
 _ACEOF
 cat confdefs.h &gt;&gt;conftest.$ac_ext
 cat &gt;&gt;conftest.$ac_ext &lt;&lt;_ACEOF
 /* end confdefs.h.  */
-#include &lt;${tinfo_DIR}/include/&gt;
+#include &lt;${TINFO_DIR}/include/&gt;
 _ACEOF
 if { (eval echo &quot;$as_me:$LINENO: \&quot;$ac_cpp conftest.$ac_ext\&quot;&quot;) &gt;&amp;5
   (eval $ac_cpp conftest.$ac_ext) 2&gt;conftest.er1
@@ -11565,51 +13057,46 @@
 
   ac_header_preproc=no
 fi
+
 rm -f conftest.err conftest.$ac_ext
-echo &quot;$as_me:$LINENO: result: $ac_header_preproc&quot; &gt;&amp;5
-echo &quot;${ECHO_T}$ac_header_preproc&quot; &gt;&amp;6
+{ echo &quot;$as_me:$LINENO: result: $ac_header_preproc&quot; &gt;&amp;5
+echo &quot;${ECHO_T}$ac_header_preproc&quot; &gt;&amp;6; }
 
 # So?  What about this header?
 case $ac_header_compiler:$ac_header_preproc:$ac_c_preproc_warn_flag in
   yes:no: )
-    { echo &quot;$as_me:$LINENO: WARNING: ${tinfo_DIR}/include/: accepted by the compiler, rejected by the preprocessor!&quot; &gt;&amp;5
-echo &quot;$as_me: WARNING: ${tinfo_DIR}/include/: accepted by the compiler, rejected by the preprocessor!&quot; &gt;&amp;2;}
-    { echo &quot;$as_me:$LINENO: WARNING: ${tinfo_DIR}/include/: proceeding with the compiler's result&quot; &gt;&amp;5
-echo &quot;$as_me: WARNING: ${tinfo_DIR}/include/: proceeding with the compiler's result&quot; &gt;&amp;2;}
+    { echo &quot;$as_me:$LINENO: WARNING: ${TINFO_DIR}/include/: accepted by the compiler, rejected by the preprocessor!&quot; &gt;&amp;5
+echo &quot;$as_me: WARNING: ${TINFO_DIR}/include/: accepted by the compiler, rejected by the preprocessor!&quot; &gt;&amp;2;}
+    { echo &quot;$as_me:$LINENO: WARNING: ${TINFO_DIR}/include/: proceeding with the compiler's result&quot; &gt;&amp;5
+echo &quot;$as_me: WARNING: ${TINFO_DIR}/include/: proceeding with the compiler's result&quot; &gt;&amp;2;}
     ac_header_preproc=yes
     ;;
   no:yes:* )
-    { echo &quot;$as_me:$LINENO: WARNING: ${tinfo_DIR}/include/: present but cannot be compiled&quot; &gt;&amp;5
-echo &quot;$as_me: WARNING: ${tinfo_DIR}/include/: present but cannot be compiled&quot; &gt;&amp;2;}
-    { echo &quot;$as_me:$LINENO: WARNING: ${tinfo_DIR}/include/:     check for missing prerequisite headers?&quot; &gt;&amp;5
-echo &quot;$as_me: WARNING: ${tinfo_DIR}/include/:     check for missing prerequisite headers?&quot; &gt;&amp;2;}
-    { echo &quot;$as_me:$LINENO: WARNING: ${tinfo_DIR}/include/: see the Autoconf documentation&quot; &gt;&amp;5
-echo &quot;$as_me: WARNING: ${tinfo_DIR}/include/: see the Autoconf documentation&quot; &gt;&amp;2;}
-    { echo &quot;$as_me:$LINENO: WARNING: ${tinfo_DIR}/include/:     section \&quot;Present But Cannot Be Compiled\&quot;&quot; &gt;&amp;5
-echo &quot;$as_me: WARNING: ${tinfo_DIR}/include/:     section \&quot;Present But Cannot Be Compiled\&quot;&quot; &gt;&amp;2;}
-    { echo &quot;$as_me:$LINENO: WARNING: ${tinfo_DIR}/include/: proceeding with the preprocessor's result&quot; &gt;&amp;5
-echo &quot;$as_me: WARNING: ${tinfo_DIR}/include/: proceeding with the preprocessor's result&quot; &gt;&amp;2;}
-    { echo &quot;$as_me:$LINENO: WARNING: ${tinfo_DIR}/include/: in the future, the compiler will take precedence&quot; &gt;&amp;5
-echo &quot;$as_me: WARNING: ${tinfo_DIR}/include/: in the future, the compiler will take precedence&quot; &gt;&amp;2;}
-    (
-      cat &lt;&lt;\_ASBOX
-## ------------------------------------------ ##
-## Report this to the AC_PACKAGE_NAME lists.  ##
-## ------------------------------------------ ##
-_ASBOX
-    ) |
-      sed &quot;s/^/$as_me: WARNING:     /&quot; &gt;&amp;2
+    { echo &quot;$as_me:$LINENO: WARNING: ${TINFO_DIR}/include/: present but cannot be compiled&quot; &gt;&amp;5
+echo &quot;$as_me: WARNING: ${TINFO_DIR}/include/: present but cannot be compiled&quot; &gt;&amp;2;}
+    { echo &quot;$as_me:$LINENO: WARNING: ${TINFO_DIR}/include/:     check for missing prerequisite headers?&quot; &gt;&amp;5
+echo &quot;$as_me: WARNING: ${TINFO_DIR}/include/:     check for missing prerequisite headers?&quot; &gt;&amp;2;}
+    { echo &quot;$as_me:$LINENO: WARNING: ${TINFO_DIR}/include/: see the Autoconf documentation&quot; &gt;&amp;5
+echo &quot;$as_me: WARNING: ${TINFO_DIR}/include/: see the Autoconf documentation&quot; &gt;&amp;2;}
+    { echo &quot;$as_me:$LINENO: WARNING: ${TINFO_DIR}/include/:     section \&quot;Present But Cannot Be Compiled\&quot;&quot; &gt;&amp;5
+echo &quot;$as_me: WARNING: ${TINFO_DIR}/include/:     section \&quot;Present But Cannot Be Compiled\&quot;&quot; &gt;&amp;2;}
+    { echo &quot;$as_me:$LINENO: WARNING: ${TINFO_DIR}/include/: proceeding with the preprocessor's result&quot; &gt;&amp;5
+echo &quot;$as_me: WARNING: ${TINFO_DIR}/include/: proceeding with the preprocessor's result&quot; &gt;&amp;2;}
+    { echo &quot;$as_me:$LINENO: WARNING: ${TINFO_DIR}/include/: in the future, the compiler will take precedence&quot; &gt;&amp;5
+echo &quot;$as_me: WARNING: ${TINFO_DIR}/include/: in the future, the compiler will take precedence&quot; &gt;&amp;2;}
+
     ;;
 esac
-echo &quot;$as_me:$LINENO: checking for ${tinfo_DIR}/include/&quot; &gt;&amp;5
-echo $ECHO_N &quot;checking for ${tinfo_DIR}/include/... $ECHO_C&quot; &gt;&amp;6
-if eval &quot;test \&quot;\${$as_ac_Header+set}\&quot; = set&quot;; then
+{ echo &quot;$as_me:$LINENO: checking for ${TINFO_DIR}/include/&quot; &gt;&amp;5
+echo $ECHO_N &quot;checking for ${TINFO_DIR}/include/... $ECHO_C&quot; &gt;&amp;6; }
+if { as_var=$as_ac_Header; eval &quot;test \&quot;\${$as_var+set}\&quot; = set&quot;; }; then
   echo $ECHO_N &quot;(cached) $ECHO_C&quot; &gt;&amp;6
 else
   eval &quot;$as_ac_Header=\$ac_header_preproc&quot;
 fi
-echo &quot;$as_me:$LINENO: result: `eval echo '${'$as_ac_Header'}'`&quot; &gt;&amp;5
-echo &quot;${ECHO_T}`eval echo '${'$as_ac_Header'}'`&quot; &gt;&amp;6
+ac_res=`eval echo '${'$as_ac_Header'}'`
+	       { echo &quot;$as_me:$LINENO: result: $ac_res&quot; &gt;&amp;5
+echo &quot;${ECHO_T}$ac_res&quot; &gt;&amp;6; }
 
 fi
 if test `eval echo '${'$as_ac_Header'}'` = yes; then
@@ -11623,17 +13110,17 @@
       else
 	 if test &quot;x&quot; != &quot;x&quot; ; then
             if test &quot;${ac_cv_header_+set}&quot; = set; then
-  echo &quot;$as_me:$LINENO: checking for &quot; &gt;&amp;5
-echo $ECHO_N &quot;checking for ... $ECHO_C&quot; &gt;&amp;6
+  { echo &quot;$as_me:$LINENO: checking for &quot; &gt;&amp;5
+echo $ECHO_N &quot;checking for ... $ECHO_C&quot; &gt;&amp;6; }
 if test &quot;${ac_cv_header_+set}&quot; = set; then
   echo $ECHO_N &quot;(cached) $ECHO_C&quot; &gt;&amp;6
 fi
-echo &quot;$as_me:$LINENO: result: $ac_cv_header_&quot; &gt;&amp;5
-echo &quot;${ECHO_T}$ac_cv_header_&quot; &gt;&amp;6
+{ echo &quot;$as_me:$LINENO: result: $ac_cv_header_&quot; &gt;&amp;5
+echo &quot;${ECHO_T}$ac_cv_header_&quot; &gt;&amp;6; }
 else
   # Is the header compilable?
-echo &quot;$as_me:$LINENO: checking  usability&quot; &gt;&amp;5
-echo $ECHO_N &quot;checking  usability... $ECHO_C&quot; &gt;&amp;6
+{ echo &quot;$as_me:$LINENO: checking  usability&quot; &gt;&amp;5
+echo $ECHO_N &quot;checking  usability... $ECHO_C&quot; &gt;&amp;6; }
 cat &gt;conftest.$ac_ext &lt;&lt;_ACEOF
 /* confdefs.h.  */
 _ACEOF
@@ -11670,15 +13157,16 @@
   echo &quot;$as_me: failed program was:&quot; &gt;&amp;5
 sed 's/^/| /' conftest.$ac_ext &gt;&amp;5
 
-ac_header_compiler=no
+	ac_header_compiler=no
 fi
+
 rm -f conftest.err conftest.$ac_objext conftest.$ac_ext
-echo &quot;$as_me:$LINENO: result: $ac_header_compiler&quot; &gt;&amp;5
-echo &quot;${ECHO_T}$ac_header_compiler&quot; &gt;&amp;6
+{ echo &quot;$as_me:$LINENO: result: $ac_header_compiler&quot; &gt;&amp;5
+echo &quot;${ECHO_T}$ac_header_compiler&quot; &gt;&amp;6; }
 
 # Is the header present?
-echo &quot;$as_me:$LINENO: checking  presence&quot; &gt;&amp;5
-echo $ECHO_N &quot;checking  presence... $ECHO_C&quot; &gt;&amp;6
+{ echo &quot;$as_me:$LINENO: checking  presence&quot; &gt;&amp;5
+echo $ECHO_N &quot;checking  presence... $ECHO_C&quot; &gt;&amp;6; }
 cat &gt;conftest.$ac_ext &lt;&lt;_ACEOF
 /* confdefs.h.  */
 _ACEOF
@@ -11712,9 +13200,10 @@
 
   ac_header_preproc=no
 fi
+
 rm -f conftest.err conftest.$ac_ext
-echo &quot;$as_me:$LINENO: result: $ac_header_preproc&quot; &gt;&amp;5
-echo &quot;${ECHO_T}$ac_header_preproc&quot; &gt;&amp;6
+{ echo &quot;$as_me:$LINENO: result: $ac_header_preproc&quot; &gt;&amp;5
+echo &quot;${ECHO_T}$ac_header_preproc&quot; &gt;&amp;6; }
 
 # So?  What about this header?
 case $ac_header_compiler:$ac_header_preproc:$ac_c_preproc_warn_flag in
@@ -11738,25 +13227,18 @@
 echo &quot;$as_me: WARNING: : proceeding with the preprocessor's result&quot; &gt;&amp;2;}
     { echo &quot;$as_me:$LINENO: WARNING: : in the future, the compiler will take precedence&quot; &gt;&amp;5
 echo &quot;$as_me: WARNING: : in the future, the compiler will take precedence&quot; &gt;&amp;2;}
-    (
-      cat &lt;&lt;\_ASBOX
-## ------------------------------------------ ##
-## Report this to the AC_PACKAGE_NAME lists.  ##
-## ------------------------------------------ ##
-_ASBOX
-    ) |
-      sed &quot;s/^/$as_me: WARNING:     /&quot; &gt;&amp;2
+
     ;;
 esac
-echo &quot;$as_me:$LINENO: checking for &quot; &gt;&amp;5
-echo $ECHO_N &quot;checking for ... $ECHO_C&quot; &gt;&amp;6
+{ echo &quot;$as_me:$LINENO: checking for &quot; &gt;&amp;5
+echo $ECHO_N &quot;checking for ... $ECHO_C&quot; &gt;&amp;6; }
 if test &quot;${ac_cv_header_+set}&quot; = set; then
   echo $ECHO_N &quot;(cached) $ECHO_C&quot; &gt;&amp;6
 else
   ac_cv_header_=$ac_header_preproc
 fi
-echo &quot;$as_me:$LINENO: result: $ac_cv_header_&quot; &gt;&amp;5
-echo &quot;${ECHO_T}$ac_cv_header_&quot; &gt;&amp;6
+{ echo &quot;$as_me:$LINENO: result: $ac_cv_header_&quot; &gt;&amp;5
+echo &quot;${ECHO_T}$ac_cv_header_&quot; &gt;&amp;6; }
 
 fi
 if test $ac_cv_header_ = yes; then
@@ -11769,7 +13251,7 @@
 	 fi
       fi
       if test &quot;x${TINFO_HEADER_FOUND}&quot; = &quot;x0&quot; ; then
-         if test ! -z &quot;${tinfo_MANDATORY}&quot; ;
+         if test ! -z &quot;${TINFO_MANDATORY}&quot; ;
          then
             echo &quot; ***&quot;
             echo &quot; *** It appears that you do not have the tinfo development package installed.&quot;
@@ -11777,18 +13259,18 @@
             echo &quot; *** without explicitly specifying --with-tinfo&quot;
             exit 1
          fi
-         tinfo_LIB=&quot;&quot;
-         tinfo_INCLUDE=&quot;&quot;
-         PBX_LIBtinfo=0
+         TINFO_LIB=&quot;&quot;
+         TINFO_INCLUDE=&quot;&quot;
+         PBX_LIBTINFO=0
       else
-         PBX_LIBtinfo=1
+         PBX_LIBTINFO=1
 
 cat &gt;&gt;confdefs.h &lt;&lt;_ACEOF
 #define HAVE_TINFO 1
 _ACEOF
 
       fi
-   elif test ! -z &quot;${tinfo_MANDATORY}&quot;;
+   elif test ! -z &quot;${TINFO_MANDATORY}&quot;;
    then
       echo &quot;***&quot;
       echo &quot;*** The Term Info installation on this system appears to be broken.&quot;
@@ -11803,34 +13285,34 @@
 
 
 
-# Check whether --with-vorbis or --without-vorbis was given.
+# Check whether --with-vorbis was given.
 if test &quot;${with_vorbis+set}&quot; = set; then
-  withval=&quot;$with_vorbis&quot;
-
+  withval=$with_vorbis;
 case ${withval} in
      n|no)
-     USE_vorbis=no
+     USE_VORBIS=no
      ;;
      y|ye|yes)
-     vorbis_MANDATORY=&quot;yes&quot;
+     VORBIS_MANDATORY=&quot;yes&quot;
      ;;
      *)
-     vorbis_DIR=&quot;${withval}&quot;
-     vorbis_MANDATORY=&quot;yes&quot;
+     VORBIS_DIR=&quot;${withval}&quot;
+     VORBIS_MANDATORY=&quot;yes&quot;
      ;;
 esac
 
-fi;
+fi
 
-PBX_LIBvorbis=0
 
-if test &quot;${USE_vorbis}&quot; != &quot;no&quot;; then
+PBX_LIBVORBIS=0
+
+if test &quot;${USE_VORBIS}&quot; != &quot;no&quot;; then
    pbxlibdir=&quot;&quot;
-   if test &quot;x${vorbis_DIR}&quot; != &quot;x&quot;; then
+   if test &quot;x${VORBIS_DIR}&quot; != &quot;x&quot;; then
       pbxlibdir=&quot;-L${vorbis_DIR}/lib&quot;
    fi
-   echo &quot;$as_me:$LINENO: checking for vorbis_info_init in -lvorbis&quot; &gt;&amp;5
-echo $ECHO_N &quot;checking for vorbis_info_init in -lvorbis... $ECHO_C&quot; &gt;&amp;6
+   { echo &quot;$as_me:$LINENO: checking for vorbis_info_init in -lvorbis&quot; &gt;&amp;5
+echo $ECHO_N &quot;checking for vorbis_info_init in -lvorbis... $ECHO_C&quot; &gt;&amp;6; }
 if test &quot;${ac_cv_lib_vorbis_vorbis_info_init+set}&quot; = set; then
   echo $ECHO_N &quot;(cached) $ECHO_C&quot; &gt;&amp;6
 else
@@ -11843,17 +13325,17 @@
 cat &gt;&gt;conftest.$ac_ext &lt;&lt;_ACEOF
 /* end confdefs.h.  */
 
-/* Override any gcc2 internal prototype to avoid an error.  */
+/* Override any GCC internal prototype to avoid an error.
+   Use char because int might match the return type of a GCC
+   builtin and then its argument prototype would still apply.  */
 #ifdef __cplusplus
 extern &quot;C&quot;
 #endif
-/* We use char because int might match the return type of a gcc2
-   builtin and then its argument prototype would still apply.  */
 char vorbis_info_init ();
 int
 main ()
 {
-vorbis_info_init ();
+return vorbis_info_init ();
   ;
   return 0;
 }
@@ -11885,39 +13367,43 @@
   echo &quot;$as_me: failed program was:&quot; &gt;&amp;5
 sed 's/^/| /' conftest.$ac_ext &gt;&amp;5
 
-ac_cv_lib_vorbis_vorbis_info_init=no
+	ac_cv_lib_vorbis_vorbis_info_init=no
 fi
+
 rm -f conftest.err conftest.$ac_objext \
       conftest$ac_exeext conftest.$ac_ext
 LIBS=$ac_check_lib_save_LIBS
 fi
-echo &quot;$as_me:$LINENO: result: $ac_cv_lib_vorbis_vorbis_info_init&quot; &gt;&amp;5
-echo &quot;${ECHO_T}$ac_cv_lib_vorbis_vorbis_info_init&quot; &gt;&amp;6
+{ echo &quot;$as_me:$LINENO: result: $ac_cv_lib_vorbis_vorbis_info_init&quot; &gt;&amp;5
+echo &quot;${ECHO_T}$ac_cv_lib_vorbis_vorbis_info_init&quot; &gt;&amp;6; }
 if test $ac_cv_lib_vorbis_vorbis_info_init = yes; then
-  :
+  AST_VORBIS_FOUND=yes
+else
+  AST_VORBIS_FOUND=no
 fi
 
 
-   if test &quot;${ac_cv_lib_vorbis_vorbis_info_init}&quot; = &quot;yes&quot;; then
-      vorbis_LIB=&quot;-lvorbis -lm -lvorbisenc&quot;
+   if test &quot;${AST_VORBIS_FOUND}&quot; = &quot;yes&quot;; then
+      VORBIS_LIB=&quot;-lvorbis -lm -lvorbisenc&quot;
       VORBIS_HEADER_FOUND=&quot;1&quot;
-      if test &quot;x${vorbis_DIR}&quot; != &quot;x&quot;; then
-         vorbis_LIB=&quot;${pbxlibdir} ${vorbis_LIB}&quot;
-	 vorbis_INCLUDE=&quot;-I${vorbis_DIR}/include&quot;
+      if test &quot;x${VORBIS_DIR}&quot; != &quot;x&quot;; then
+         VORBIS_LIB=&quot;${pbxlibdir} ${VORBIS_LIB}&quot;
+	 VORBIS_INCLUDE=&quot;-I${VORBIS_DIR}/include&quot;
 	 if test &quot;xvorbis/codec.h&quot; != &quot;x&quot; ; then
-	    as_ac_Header=`echo &quot;ac_cv_header_${vorbis_DIR}/include/vorbis/codec.h&quot; | $as_tr_sh`
-if eval &quot;test \&quot;\${$as_ac_Header+set}\&quot; = set&quot;; then
-  echo &quot;$as_me:$LINENO: checking for ${vorbis_DIR}/include/vorbis/codec.h&quot; &gt;&amp;5
-echo $ECHO_N &quot;checking for ${vorbis_DIR}/include/vorbis/codec.h... $ECHO_C&quot; &gt;&amp;6
-if eval &quot;test \&quot;\${$as_ac_Header+set}\&quot; = set&quot;; then
+	    as_ac_Header=`echo &quot;ac_cv_header_${VORBIS_DIR}/include/vorbis/codec.h&quot; | $as_tr_sh`
+if { as_var=$as_ac_Header; eval &quot;test \&quot;\${$as_var+set}\&quot; = set&quot;; }; then
+  { echo &quot;$as_me:$LINENO: checking for ${VORBIS_DIR}/include/vorbis/codec.h&quot; &gt;&amp;5
+echo $ECHO_N &quot;checking for ${VORBIS_DIR}/include/vorbis/codec.h... $ECHO_C&quot; &gt;&amp;6; }
+if { as_var=$as_ac_Header; eval &quot;test \&quot;\${$as_var+set}\&quot; = set&quot;; }; then
   echo $ECHO_N &quot;(cached) $ECHO_C&quot; &gt;&amp;6
 fi
-echo &quot;$as_me:$LINENO: result: `eval echo '${'$as_ac_Header'}'`&quot; &gt;&amp;5
-echo &quot;${ECHO_T}`eval echo '${'$as_ac_Header'}'`&quot; &gt;&amp;6
+ac_res=`eval echo '${'$as_ac_Header'}'`
+	       { echo &quot;$as_me:$LINENO: result: $ac_res&quot; &gt;&amp;5
+echo &quot;${ECHO_T}$ac_res&quot; &gt;&amp;6; }
 else
   # Is the header compilable?
-echo &quot;$as_me:$LINENO: checking ${vorbis_DIR}/include/vorbis/codec.h usability&quot; &gt;&amp;5
-echo $ECHO_N &quot;checking ${vorbis_DIR}/include/vorbis/codec.h usability... $ECHO_C&quot; &gt;&amp;6
+{ echo &quot;$as_me:$LINENO: checking ${VORBIS_DIR}/include/vorbis/codec.h usability&quot; &gt;&amp;5
+echo $ECHO_N &quot;checking ${VORBIS_DIR}/include/vorbis/codec.h usability... $ECHO_C&quot; &gt;&amp;6; }
 cat &gt;conftest.$ac_ext &lt;&lt;_ACEOF
 /* confdefs.h.  */
 _ACEOF
@@ -11925,7 +13411,7 @@
 cat &gt;&gt;conftest.$ac_ext &lt;&lt;_ACEOF
 /* end confdefs.h.  */
 $ac_includes_default
-#include &lt;${vorbis_DIR}/include/vorbis/codec.h&gt;
+#include &lt;${VORBIS_DIR}/include/vorbis/codec.h&gt;
 _ACEOF
 rm -f conftest.$ac_objext
 if { (eval echo &quot;$as_me:$LINENO: \&quot;$ac_compile\&quot;&quot;) &gt;&amp;5
@@ -11954,22 +13440,23 @@
   echo &quot;$as_me: failed program was:&quot; &gt;&amp;5
 sed 's/^/| /' conftest.$ac_ext &gt;&amp;5
 
-ac_header_compiler=no
+	ac_header_compiler=no
 fi
+
 rm -f conftest.err conftest.$ac_objext conftest.$ac_ext
-echo &quot;$as_me:$LINENO: result: $ac_header_compiler&quot; &gt;&amp;5
-echo &quot;${ECHO_T}$ac_header_compiler&quot; &gt;&amp;6
+{ echo &quot;$as_me:$LINENO: result: $ac_header_compiler&quot; &gt;&amp;5
+echo &quot;${ECHO_T}$ac_header_compiler&quot; &gt;&amp;6; }
 
 # Is the header present?
-echo &quot;$as_me:$LINENO: checking ${vorbis_DIR}/include/vorbis/codec.h presence&quot; &gt;&amp;5
-echo $ECHO_N &quot;checking ${vorbis_DIR}/include/vorbis/codec.h presence... $ECHO_C&quot; &gt;&amp;6
+{ echo &quot;$as_me:$LINENO: checking ${VORBIS_DIR}/include/vorbis/codec.h presence&quot; &gt;&amp;5
+echo $ECHO_N &quot;checking ${VORBIS_DIR}/include/vorbis/codec.h presence... $ECHO_C&quot; &gt;&amp;6; }
 cat &gt;conftest.$ac_ext &lt;&lt;_ACEOF
 /* confdefs.h.  */
 _ACEOF
 cat confdefs.h &gt;&gt;conftest.$ac_ext
 cat &gt;&gt;conftest.$ac_ext &lt;&lt;_ACEOF
 /* end confdefs.h.  */
-#include &lt;${vorbis_DIR}/include/vorbis/codec.h&gt;
+#include &lt;${VORBIS_DIR}/include/vorbis/codec.h&gt;
 _ACEOF
 if { (eval echo &quot;$as_me:$LINENO: \&quot;$ac_cpp conftest.$ac_ext\&quot;&quot;) &gt;&amp;5
   (eval $ac_cpp conftest.$ac_ext) 2&gt;conftest.er1
@@ -11996,51 +13483,46 @@
 
   ac_header_preproc=no
 fi
+
 rm -f conftest.err conftest.$ac_ext
-echo &quot;$as_me:$LINENO: result: $ac_header_preproc&quot; &gt;&amp;5
-echo &quot;${ECHO_T}$ac_header_preproc&quot; &gt;&amp;6
+{ echo &quot;$as_me:$LINENO: result: $ac_header_preproc&quot; &gt;&amp;5
+echo &quot;${ECHO_T}$ac_header_preproc&quot; &gt;&amp;6; }
 
 # So?  What about this header?
 case $ac_header_compiler:$ac_header_preproc:$ac_c_preproc_warn_flag in
   yes:no: )
-    { echo &quot;$as_me:$LINENO: WARNING: ${vorbis_DIR}/include/vorbis/codec.h: accepted by the compiler, rejected by the preprocessor!&quot; &gt;&amp;5
-echo &quot;$as_me: WARNING: ${vorbis_DIR}/include/vorbis/codec.h: accepted by the compiler, rejected by the preprocessor!&quot; &gt;&amp;2;}
-    { echo &quot;$as_me:$LINENO: WARNING: ${vorbis_DIR}/include/vorbis/codec.h: proceeding with the compiler's result&quot; &gt;&amp;5
-echo &quot;$as_me: WARNING: ${vorbis_DIR}/include/vorbis/codec.h: proceeding with the compiler's result&quot; &gt;&amp;2;}
+    { echo &quot;$as_me:$LINENO: WARNING: ${VORBIS_DIR}/include/vorbis/codec.h: accepted by the compiler, rejected by the preprocessor!&quot; &gt;&amp;5
+echo &quot;$as_me: WARNING: ${VORBIS_DIR}/include/vorbis/codec.h: accepted by the compiler, rejected by the preprocessor!&quot; &gt;&amp;2;}
+    { echo &quot;$as_me:$LINENO: WARNING: ${VORBIS_DIR}/include/vorbis/codec.h: proceeding with the compiler's result&quot; &gt;&amp;5
+echo &quot;$as_me: WARNING: ${VORBIS_DIR}/include/vorbis/codec.h: proceeding with the compiler's result&quot; &gt;&amp;2;}
     ac_header_preproc=yes
     ;;
   no:yes:* )
-    { echo &quot;$as_me:$LINENO: WARNING: ${vorbis_DIR}/include/vorbis/codec.h: present but cannot be compiled&quot; &gt;&amp;5
-echo &quot;$as_me: WARNING: ${vorbis_DIR}/include/vorbis/codec.h: present but cannot be compiled&quot; &gt;&amp;2;}
-    { echo &quot;$as_me:$LINENO: WARNING: ${vorbis_DIR}/include/vorbis/codec.h:     check for missing prerequisite headers?&quot; &gt;&amp;5
-echo &quot;$as_me: WARNING: ${vorbis_DIR}/include/vorbis/codec.h:     check for missing prerequisite headers?&quot; &gt;&amp;2;}
-    { echo &quot;$as_me:$LINENO: WARNING: ${vorbis_DIR}/include/vorbis/codec.h: see the Autoconf documentation&quot; &gt;&amp;5
-echo &quot;$as_me: WARNING: ${vorbis_DIR}/include/vorbis/codec.h: see the Autoconf documentation&quot; &gt;&amp;2;}
-    { echo &quot;$as_me:$LINENO: WARNING: ${vorbis_DIR}/include/vorbis/codec.h:     section \&quot;Present But Cannot Be Compiled\&quot;&quot; &gt;&amp;5
-echo &quot;$as_me: WARNING: ${vorbis_DIR}/include/vorbis/codec.h:     section \&quot;Present But Cannot Be Compiled\&quot;&quot; &gt;&amp;2;}
-    { echo &quot;$as_me:$LINENO: WARNING: ${vorbis_DIR}/include/vorbis/codec.h: proceeding with the preprocessor's result&quot; &gt;&amp;5
-echo &quot;$as_me: WARNING: ${vorbis_DIR}/include/vorbis/codec.h: proceeding with the preprocessor's result&quot; &gt;&amp;2;}
-    { echo &quot;$as_me:$LINENO: WARNING: ${vorbis_DIR}/include/vorbis/codec.h: in the future, the compiler will take precedence&quot; &gt;&amp;5
-echo &quot;$as_me: WARNING: ${vorbis_DIR}/include/vorbis/codec.h: in the future, the compiler will take precedence&quot; &gt;&amp;2;}
-    (
-      cat &lt;&lt;\_ASBOX
-## ------------------------------------------ ##
-## Report this to the AC_PACKAGE_NAME lists.  ##
-## ------------------------------------------ ##
-_ASBOX
-    ) |
-      sed &quot;s/^/$as_me: WARNING:     /&quot; &gt;&amp;2
+    { echo &quot;$as_me:$LINENO: WARNING: ${VORBIS_DIR}/include/vorbis/codec.h: present but cannot be compiled&quot; &gt;&amp;5
+echo &quot;$as_me: WARNING: ${VORBIS_DIR}/include/vorbis/codec.h: present but cannot be compiled&quot; &gt;&amp;2;}
+    { echo &quot;$as_me:$LINENO: WARNING: ${VORBIS_DIR}/include/vorbis/codec.h:     check for missing prerequisite headers?&quot; &gt;&amp;5
+echo &quot;$as_me: WARNING: ${VORBIS_DIR}/include/vorbis/codec.h:     check for missing prerequisite headers?&quot; &gt;&amp;2;}
+    { echo &quot;$as_me:$LINENO: WARNING: ${VORBIS_DIR}/include/vorbis/codec.h: see the Autoconf documentation&quot; &gt;&amp;5
+echo &quot;$as_me: WARNING: ${VORBIS_DIR}/include/vorbis/codec.h: see the Autoconf documentation&quot; &gt;&amp;2;}
+    { echo &quot;$as_me:$LINENO: WARNING: ${VORBIS_DIR}/include/vorbis/codec.h:     section \&quot;Present But Cannot Be Compiled\&quot;&quot; &gt;&amp;5
+echo &quot;$as_me: WARNING: ${VORBIS_DIR}/include/vorbis/codec.h:     section \&quot;Present But Cannot Be Compiled\&quot;&quot; &gt;&amp;2;}
+    { echo &quot;$as_me:$LINENO: WARNING: ${VORBIS_DIR}/include/vorbis/codec.h: proceeding with the preprocessor's result&quot; &gt;&amp;5
+echo &quot;$as_me: WARNING: ${VORBIS_DIR}/include/vorbis/codec.h: proceeding with the preprocessor's result&quot; &gt;&amp;2;}
+    { echo &quot;$as_me:$LINENO: WARNING: ${VORBIS_DIR}/include/vorbis/codec.h: in the future, the compiler will take precedence&quot; &gt;&amp;5
+echo &quot;$as_me: WARNING: ${VORBIS_DIR}/include/vorbis/codec.h: in the future, the compiler will take precedence&quot; &gt;&amp;2;}
+
     ;;
 esac
-echo &quot;$as_me:$LINENO: checking for ${vorbis_DIR}/include/vorbis/codec.h&quot; &gt;&amp;5
-echo $ECHO_N &quot;checking for ${vorbis_DIR}/include/vorbis/codec.h... $ECHO_C&quot; &gt;&amp;6
-if eval &quot;test \&quot;\${$as_ac_Header+set}\&quot; = set&quot;; then
+{ echo &quot;$as_me:$LINENO: checking for ${VORBIS_DIR}/include/vorbis/codec.h&quot; &gt;&amp;5
+echo $ECHO_N &quot;checking for ${VORBIS_DIR}/include/vorbis/codec.h... $ECHO_C&quot; &gt;&amp;6; }
+if { as_var=$as_ac_Header; eval &quot;test \&quot;\${$as_var+set}\&quot; = set&quot;; }; then
   echo $ECHO_N &quot;(cached) $ECHO_C&quot; &gt;&amp;6
 else
   eval &quot;$as_ac_Header=\$ac_header_preproc&quot;
 fi
-echo &quot;$as_me:$LINENO: result: `eval echo '${'$as_ac_Header'}'`&quot; &gt;&amp;5
-echo &quot;${ECHO_T}`eval echo '${'$as_ac_Header'}'`&quot; &gt;&amp;6
+ac_res=`eval echo '${'$as_ac_Header'}'`
+	       { echo &quot;$as_me:$LINENO: result: $ac_res&quot; &gt;&amp;5
+echo &quot;${ECHO_T}$ac_res&quot; &gt;&amp;6; }
 
 fi
 if test `eval echo '${'$as_ac_Header'}'` = yes; then
@@ -12054,17 +13536,17 @@
       else
 	 if test &quot;xvorbis/codec.h&quot; != &quot;x&quot; ; then
             if test &quot;${ac_cv_header_vorbis_codec_h+set}&quot; = set; then
-  echo &quot;$as_me:$LINENO: checking for vorbis/codec.h&quot; &gt;&amp;5
-echo $ECHO_N &quot;checking for vorbis/codec.h... $ECHO_C&quot; &gt;&amp;6
+  { echo &quot;$as_me:$LINENO: checking for vorbis/codec.h&quot; &gt;&amp;5
+echo $ECHO_N &quot;checking for vorbis/codec.h... $ECHO_C&quot; &gt;&amp;6; }
 if test &quot;${ac_cv_header_vorbis_codec_h+set}&quot; = set; then
   echo $ECHO_N &quot;(cached) $ECHO_C&quot; &gt;&amp;6
 fi
-echo &quot;$as_me:$LINENO: result: $ac_cv_header_vorbis_codec_h&quot; &gt;&amp;5
-echo &quot;${ECHO_T}$ac_cv_header_vorbis_codec_h&quot; &gt;&amp;6
+{ echo &quot;$as_me:$LINENO: result: $ac_cv_header_vorbis_codec_h&quot; &gt;&amp;5
+echo &quot;${ECHO_T}$ac_cv_header_vorbis_codec_h&quot; &gt;&amp;6; }
 else
   # Is the header compilable?
-echo &quot;$as_me:$LINENO: checking vorbis/codec.h usability&quot; &gt;&amp;5
-echo $ECHO_N &quot;checking vorbis/codec.h usability... $ECHO_C&quot; &gt;&amp;6
+{ echo &quot;$as_me:$LINENO: checking vorbis/codec.h usability&quot; &gt;&amp;5
+echo $ECHO_N &quot;checking vorbis/codec.h usability... $ECHO_C&quot; &gt;&amp;6; }
 cat &gt;conftest.$ac_ext &lt;&lt;_ACEOF
 /* confdefs.h.  */
 _ACEOF
@@ -12101,15 +13583,16 @@
   echo &quot;$as_me: failed program was:&quot; &gt;&amp;5
 sed 's/^/| /' conftest.$ac_ext &gt;&amp;5
 
-ac_header_compiler=no
+	ac_header_compiler=no
 fi
+
 rm -f conftest.err conftest.$ac_objext conftest.$ac_ext
-echo &quot;$as_me:$LINENO: result: $ac_header_compiler&quot; &gt;&amp;5
-echo &quot;${ECHO_T}$ac_header_compiler&quot; &gt;&amp;6
+{ echo &quot;$as_me:$LINENO: result: $ac_header_compiler&quot; &gt;&amp;5
+echo &quot;${ECHO_T}$ac_header_compiler&quot; &gt;&amp;6; }
 
 # Is the header present?
-echo &quot;$as_me:$LINENO: checking vorbis/codec.h presence&quot; &gt;&amp;5
-echo $ECHO_N &quot;checking vorbis/codec.h presence... $ECHO_C&quot; &gt;&amp;6
+{ echo &quot;$as_me:$LINENO: checking vorbis/codec.h presence&quot; &gt;&amp;5
+echo $ECHO_N &quot;checking vorbis/codec.h presence... $ECHO_C&quot; &gt;&amp;6; }
 cat &gt;conftest.$ac_ext &lt;&lt;_ACEOF
 /* confdefs.h.  */
 _ACEOF
@@ -12143,9 +13626,10 @@
 
   ac_header_preproc=no
 fi
+
 rm -f conftest.err conftest.$ac_ext
-echo &quot;$as_me:$LINENO: result: $ac_header_preproc&quot; &gt;&amp;5
-echo &quot;${ECHO_T}$ac_header_preproc&quot; &gt;&amp;6
+{ echo &quot;$as_me:$LINENO: result: $ac_header_preproc&quot; &gt;&amp;5
+echo &quot;${ECHO_T}$ac_header_preproc&quot; &gt;&amp;6; }
 
 # So?  What about this header?
 case $ac_header_compiler:$ac_header_preproc:$ac_c_preproc_warn_flag in
@@ -12169,25 +13653,18 @@
 echo &quot;$as_me: WARNING: vorbis/codec.h: proceeding with the preprocessor's result&quot; &gt;&amp;2;}
     { echo &quot;$as_me:$LINENO: WARNING: vorbis/codec.h: in the future, the compiler will take precedence&quot; &gt;&amp;5
 echo &quot;$as_me: WARNING: vorbis/codec.h: in the future, the compiler will take precedence&quot; &gt;&amp;2;}
-    (
-      cat &lt;&lt;\_ASBOX
-## ------------------------------------------ ##
-## Report this to the AC_PACKAGE_NAME lists.  ##
-## ------------------------------------------ ##
-_ASBOX
-    ) |
-      sed &quot;s/^/$as_me: WARNING:     /&quot; &gt;&amp;2
+
     ;;
 esac
-echo &quot;$as_me:$LINENO: checking for vorbis/codec.h&quot; &gt;&amp;5
-echo $ECHO_N &quot;checking for vorbis/codec.h... $ECHO_C&quot; &gt;&amp;6
+{ echo &quot;$as_me:$LINENO: checking for vorbis/codec.h&quot; &gt;&amp;5
+echo $ECHO_N &quot;checking for vorbis/codec.h... $ECHO_C&quot; &gt;&amp;6; }
 if test &quot;${ac_cv_header_vorbis_codec_h+set}&quot; = set; then
   echo $ECHO_N &quot;(cached) $ECHO_C&quot; &gt;&amp;6
 else
   ac_cv_header_vorbis_codec_h=$ac_header_preproc
 fi
-echo &quot;$as_me:$LINENO: result: $ac_cv_header_vorbis_codec_h&quot; &gt;&amp;5
-echo &quot;${ECHO_T}$ac_cv_header_vorbis_codec_h&quot; &gt;&amp;6
+{ echo &quot;$as_me:$LINENO: result: $ac_cv_header_vorbis_codec_h&quot; &gt;&amp;5
+echo &quot;${ECHO_T}$ac_cv_header_vorbis_codec_h&quot; &gt;&amp;6; }
 
 fi
 if test $ac_cv_header_vorbis_codec_h = yes; then
@@ -12200,7 +13677,7 @@
 	 fi
       fi
       if test &quot;x${VORBIS_HEADER_FOUND}&quot; = &quot;x0&quot; ; then
-         if test ! -z &quot;${vorbis_MANDATORY}&quot; ;
+         if test ! -z &quot;${VORBIS_MANDATORY}&quot; ;
          then
             echo &quot; ***&quot;
             echo &quot; *** It appears that you do not have the vorbis development package installed.&quot;
@@ -12208,18 +13685,18 @@
             echo &quot; *** without explicitly specifying --with-vorbis&quot;
             exit 1
          fi
-         vorbis_LIB=&quot;&quot;
-         vorbis_INCLUDE=&quot;&quot;
-         PBX_LIBvorbis=0
+         VORBIS_LIB=&quot;&quot;
+         VORBIS_INCLUDE=&quot;&quot;
+         PBX_LIBVORBIS=0
       else
-         PBX_LIBvorbis=1
+         PBX_LIBVORBIS=1
 
 cat &gt;&gt;confdefs.h &lt;&lt;_ACEOF
 #define HAVE_VORBIS 1
 _ACEOF
 
       fi
-   elif test ! -z &quot;${vorbis_MANDATORY}&quot;;
+   elif test ! -z &quot;${VORBIS_MANDATORY}&quot;;
    then
       echo &quot;***&quot;
       echo &quot;*** The Vorbis installation on this system appears to be broken.&quot;
@@ -12234,34 +13711,34 @@
 
 
 
-# Check whether --with-z or --without-z was given.
+# Check whether --with-z was given.
 if test &quot;${with_z+set}&quot; = set; then
-  withval=&quot;$with_z&quot;
-
+  withval=$with_z;
 case ${withval} in
      n|no)
-     USE_z=no
+     USE_ZLIB=no
      ;;
      y|ye|yes)
-     z_MANDATORY=&quot;yes&quot;
+     ZLIB_MANDATORY=&quot;yes&quot;
      ;;
      *)
-     z_DIR=&quot;${withval}&quot;
-     z_MANDATORY=&quot;yes&quot;
+     ZLIB_DIR=&quot;${withval}&quot;
+     ZLIB_MANDATORY=&quot;yes&quot;
      ;;
 esac
 
-fi;
+fi
 
-PBX_LIBz=0
 
-if test &quot;${USE_z}&quot; != &quot;no&quot;; then
+PBX_LIBZLIB=0
+
+if test &quot;${USE_ZLIB}&quot; != &quot;no&quot;; then
    pbxlibdir=&quot;&quot;
-   if test &quot;x${z_DIR}&quot; != &quot;x&quot;; then
+   if test &quot;x${ZLIB_DIR}&quot; != &quot;x&quot;; then
       pbxlibdir=&quot;-L${z_DIR}/lib&quot;
    fi
-   echo &quot;$as_me:$LINENO: checking for compress in -lz&quot; &gt;&amp;5
-echo $ECHO_N &quot;checking for compress in -lz... $ECHO_C&quot; &gt;&amp;6
+   { echo &quot;$as_me:$LINENO: checking for compress in -lz&quot; &gt;&amp;5
+echo $ECHO_N &quot;checking for compress in -lz... $ECHO_C&quot; &gt;&amp;6; }
 if test &quot;${ac_cv_lib_z_compress+set}&quot; = set; then
   echo $ECHO_N &quot;(cached) $ECHO_C&quot; &gt;&amp;6
 else
@@ -12274,17 +13751,17 @@
 cat &gt;&gt;conftest.$ac_ext &lt;&lt;_ACEOF
 /* end confdefs.h.  */
 
-/* Override any gcc2 internal prototype to avoid an error.  */
+/* Override any GCC internal prototype to avoid an error.
+   Use char because int might match the return type of a GCC
+   builtin and then its argument prototype would still apply.  */
 #ifdef __cplusplus
 extern &quot;C&quot;
 #endif
-/* We use char because int might match the return type of a gcc2
-   builtin and then its argument prototype would still apply.  */
 char compress ();
 int
 main ()
 {
-compress ();
+return compress ();
   ;
   return 0;
 }
@@ -12316,39 +13793,43 @@
   echo &quot;$as_me: failed program was:&quot; &gt;&amp;5
 sed 's/^/| /' conftest.$ac_ext &gt;&amp;5
 
-ac_cv_lib_z_compress=no
+	ac_cv_lib_z_compress=no
 fi
+
 rm -f conftest.err conftest.$ac_objext \
       conftest$ac_exeext conftest.$ac_ext
 LIBS=$ac_check_lib_save_LIBS
 fi
-echo &quot;$as_me:$LINENO: result: $ac_cv_lib_z_compress&quot; &gt;&amp;5
-echo &quot;${ECHO_T}$ac_cv_lib_z_compress&quot; &gt;&amp;6
+{ echo &quot;$as_me:$LINENO: result: $ac_cv_lib_z_compress&quot; &gt;&amp;5
+echo &quot;${ECHO_T}$ac_cv_lib_z_compress&quot; &gt;&amp;6; }
 if test $ac_cv_lib_z_compress = yes; then
-  :
+  AST_ZLIB_FOUND=yes
+else
+  AST_ZLIB_FOUND=no
 fi
 
 
-   if test &quot;${ac_cv_lib_z_compress}&quot; = &quot;yes&quot;; then
-      z_LIB=&quot;-lz &quot;
+   if test &quot;${AST_ZLIB_FOUND}&quot; = &quot;yes&quot;; then
+      ZLIB_LIB=&quot;-lz &quot;
       ZLIB_HEADER_FOUND=&quot;1&quot;
-      if test &quot;x${z_DIR}&quot; != &quot;x&quot;; then
-         z_LIB=&quot;${pbxlibdir} ${z_LIB}&quot;
-	 z_INCLUDE=&quot;-I${z_DIR}/include&quot;
+      if test &quot;x${ZLIB_DIR}&quot; != &quot;x&quot;; then
+         ZLIB_LIB=&quot;${pbxlibdir} ${ZLIB_LIB}&quot;
+	 ZLIB_INCLUDE=&quot;-I${ZLIB_DIR}/include&quot;
 	 if test &quot;xzlib.h&quot; != &quot;x&quot; ; then
-	    as_ac_Header=`echo &quot;ac_cv_header_${z_DIR}/include/zlib.h&quot; | $as_tr_sh`
-if eval &quot;test \&quot;\${$as_ac_Header+set}\&quot; = set&quot;; then
-  echo &quot;$as_me:$LINENO: checking for ${z_DIR}/include/zlib.h&quot; &gt;&amp;5
-echo $ECHO_N &quot;checking for ${z_DIR}/include/zlib.h... $ECHO_C&quot; &gt;&amp;6
-if eval &quot;test \&quot;\${$as_ac_Header+set}\&quot; = set&quot;; then
+	    as_ac_Header=`echo &quot;ac_cv_header_${ZLIB_DIR}/include/zlib.h&quot; | $as_tr_sh`
+if { as_var=$as_ac_Header; eval &quot;test \&quot;\${$as_var+set}\&quot; = set&quot;; }; then
+  { echo &quot;$as_me:$LINENO: checking for ${ZLIB_DIR}/include/zlib.h&quot; &gt;&amp;5
+echo $ECHO_N &quot;checking for ${ZLIB_DIR}/include/zlib.h... $ECHO_C&quot; &gt;&amp;6; }
+if { as_var=$as_ac_Header; eval &quot;test \&quot;\${$as_var+set}\&quot; = set&quot;; }; then
   echo $ECHO_N &quot;(cached) $ECHO_C&quot; &gt;&amp;6
 fi
-echo &quot;$as_me:$LINENO: result: `eval echo '${'$as_ac_Header'}'`&quot; &gt;&amp;5
-echo &quot;${ECHO_T}`eval echo '${'$as_ac_Header'}'`&quot; &gt;&amp;6
+ac_res=`eval echo '${'$as_ac_Header'}'`
+	       { echo &quot;$as_me:$LINENO: result: $ac_res&quot; &gt;&amp;5
+echo &quot;${ECHO_T}$ac_res&quot; &gt;&amp;6; }
 else
   # Is the header compilable?
-echo &quot;$as_me:$LINENO: checking ${z_DIR}/include/zlib.h usability&quot; &gt;&amp;5
-echo $ECHO_N &quot;checking ${z_DIR}/include/zlib.h usability... $ECHO_C&quot; &gt;&amp;6
+{ echo &quot;$as_me:$LINENO: checking ${ZLIB_DIR}/include/zlib.h usability&quot; &gt;&amp;5
+echo $ECHO_N &quot;checking ${ZLIB_DIR}/include/zlib.h usability... $ECHO_C&quot; &gt;&amp;6; }
 cat &gt;conftest.$ac_ext &lt;&lt;_ACEOF
 /* confdefs.h.  */
 _ACEOF
@@ -12356,7 +13837,7 @@
 cat &gt;&gt;conftest.$ac_ext &lt;&lt;_ACEOF
 /* end confdefs.h.  */
 $ac_includes_default
-#include &lt;${z_DIR}/include/zlib.h&gt;
+#include &lt;${ZLIB_DIR}/include/zlib.h&gt;
 _ACEOF
 rm -f conftest.$ac_objext
 if { (eval echo &quot;$as_me:$LINENO: \&quot;$ac_compile\&quot;&quot;) &gt;&amp;5
@@ -12385,22 +13866,23 @@
   echo &quot;$as_me: failed program was:&quot; &gt;&amp;5
 sed 's/^/| /' conftest.$ac_ext &gt;&amp;5
 
-ac_header_compiler=no
+	ac_header_compiler=no
 fi
+
 rm -f conftest.err conftest.$ac_objext conftest.$ac_ext
-echo &quot;$as_me:$LINENO: result: $ac_header_compiler&quot; &gt;&amp;5
-echo &quot;${ECHO_T}$ac_header_compiler&quot; &gt;&amp;6
+{ echo &quot;$as_me:$LINENO: result: $ac_header_compiler&quot; &gt;&amp;5
+echo &quot;${ECHO_T}$ac_header_compiler&quot; &gt;&amp;6; }
 
 # Is the header present?
-echo &quot;$as_me:$LINENO: checking ${z_DIR}/include/zlib.h presence&quot; &gt;&amp;5
-echo $ECHO_N &quot;checking ${z_DIR}/include/zlib.h presence... $ECHO_C&quot; &gt;&amp;6
+{ echo &quot;$as_me:$LINENO: checking ${ZLIB_DIR}/include/zlib.h presence&quot; &gt;&amp;5
+echo $ECHO_N &quot;checking ${ZLIB_DIR}/include/zlib.h presence... $ECHO_C&quot; &gt;&amp;6; }
 cat &gt;conftest.$ac_ext &lt;&lt;_ACEOF
 /* confdefs.h.  */
 _ACEOF
 cat confdefs.h &gt;&gt;conftest.$ac_ext
 cat &gt;&gt;conftest.$ac_ext &lt;&lt;_ACEOF
 /* end confdefs.h.  */
-#include &lt;${z_DIR}/include/zlib.h&gt;
+#include &lt;${ZLIB_DIR}/include/zlib.h&gt;
 _ACEOF
 if { (eval echo &quot;$as_me:$LINENO: \&quot;$ac_cpp conftest.$ac_ext\&quot;&quot;) &gt;&amp;5
   (eval $ac_cpp conftest.$ac_ext) 2&gt;conftest.er1
@@ -12427,51 +13909,46 @@
 
   ac_header_preproc=no
 fi
+
 rm -f conftest.err conftest.$ac_ext
-echo &quot;$as_me:$LINENO: result: $ac_header_preproc&quot; &gt;&amp;5
-echo &quot;${ECHO_T}$ac_header_preproc&quot; &gt;&amp;6
+{ echo &quot;$as_me:$LINENO: result: $ac_header_preproc&quot; &gt;&amp;5
+echo &quot;${ECHO_T}$ac_header_preproc&quot; &gt;&amp;6; }
 
 # So?  What about this header?
 case $ac_header_compiler:$ac_header_preproc:$ac_c_preproc_warn_flag in
   yes:no: )
-    { echo &quot;$as_me:$LINENO: WARNING: ${z_DIR}/include/zlib.h: accepted by the compiler, rejected by the preprocessor!&quot; &gt;&amp;5
-echo &quot;$as_me: WARNING: ${z_DIR}/include/zlib.h: accepted by the compiler, rejected by the preprocessor!&quot; &gt;&amp;2;}
-    { echo &quot;$as_me:$LINENO: WARNING: ${z_DIR}/include/zlib.h: proceeding with the compiler's result&quot; &gt;&amp;5
-echo &quot;$as_me: WARNING: ${z_DIR}/include/zlib.h: proceeding with the compiler's result&quot; &gt;&amp;2;}
+    { echo &quot;$as_me:$LINENO: WARNING: ${ZLIB_DIR}/include/zlib.h: accepted by the compiler, rejected by the preprocessor!&quot; &gt;&amp;5
+echo &quot;$as_me: WARNING: ${ZLIB_DIR}/include/zlib.h: accepted by the compiler, rejected by the preprocessor!&quot; &gt;&amp;2;}
+    { echo &quot;$as_me:$LINENO: WARNING: ${ZLIB_DIR}/include/zlib.h: proceeding with the compiler's result&quot; &gt;&amp;5
+echo &quot;$as_me: WARNING: ${ZLIB_DIR}/include/zlib.h: proceeding with the compiler's result&quot; &gt;&amp;2;}
     ac_header_preproc=yes
     ;;
   no:yes:* )
-    { echo &quot;$as_me:$LINENO: WARNING: ${z_DIR}/include/zlib.h: present but cannot be compiled&quot; &gt;&amp;5
-echo &quot;$as_me: WARNING: ${z_DIR}/include/zlib.h: present but cannot be compiled&quot; &gt;&amp;2;}
-    { echo &quot;$as_me:$LINENO: WARNING: ${z_DIR}/include/zlib.h:     check for missing prerequisite headers?&quot; &gt;&amp;5
-echo &quot;$as_me: WARNING: ${z_DIR}/include/zlib.h:     check for missing prerequisite headers?&quot; &gt;&amp;2;}
-    { echo &quot;$as_me:$LINENO: WARNING: ${z_DIR}/include/zlib.h: see the Autoconf documentation&quot; &gt;&amp;5
-echo &quot;$as_me: WARNING: ${z_DIR}/include/zlib.h: see the Autoconf documentation&quot; &gt;&amp;2;}
-    { echo &quot;$as_me:$LINENO: WARNING: ${z_DIR}/include/zlib.h:     section \&quot;Present But Cannot Be Compiled\&quot;&quot; &gt;&amp;5
-echo &quot;$as_me: WARNING: ${z_DIR}/include/zlib.h:     section \&quot;Present But Cannot Be Compiled\&quot;&quot; &gt;&amp;2;}
-    { echo &quot;$as_me:$LINENO: WARNING: ${z_DIR}/include/zlib.h: proceeding with the preprocessor's result&quot; &gt;&amp;5
-echo &quot;$as_me: WARNING: ${z_DIR}/include/zlib.h: proceeding with the preprocessor's result&quot; &gt;&amp;2;}
-    { echo &quot;$as_me:$LINENO: WARNING: ${z_DIR}/include/zlib.h: in the future, the compiler will take precedence&quot; &gt;&amp;5
-echo &quot;$as_me: WARNING: ${z_DIR}/include/zlib.h: in the future, the compiler will take precedence&quot; &gt;&amp;2;}
-    (
-      cat &lt;&lt;\_ASBOX
-## ------------------------------------------ ##
-## Report this to the AC_PACKAGE_NAME lists.  ##
-## ------------------------------------------ ##
-_ASBOX
-    ) |
-      sed &quot;s/^/$as_me: WARNING:     /&quot; &gt;&amp;2
+    { echo &quot;$as_me:$LINENO: WARNING: ${ZLIB_DIR}/include/zlib.h: present but cannot be compiled&quot; &gt;&amp;5
+echo &quot;$as_me: WARNING: ${ZLIB_DIR}/include/zlib.h: present but cannot be compiled&quot; &gt;&amp;2;}
+    { echo &quot;$as_me:$LINENO: WARNING: ${ZLIB_DIR}/include/zlib.h:     check for missing prerequisite headers?&quot; &gt;&amp;5
+echo &quot;$as_me: WARNING: ${ZLIB_DIR}/include/zlib.h:     check for missing prerequisite headers?&quot; &gt;&amp;2;}
+    { echo &quot;$as_me:$LINENO: WARNING: ${ZLIB_DIR}/include/zlib.h: see the Autoconf documentation&quot; &gt;&amp;5
+echo &quot;$as_me: WARNING: ${ZLIB_DIR}/include/zlib.h: see the Autoconf documentation&quot; &gt;&amp;2;}
+    { echo &quot;$as_me:$LINENO: WARNING: ${ZLIB_DIR}/include/zlib.h:     section \&quot;Present But Cannot Be Compiled\&quot;&quot; &gt;&amp;5
+echo &quot;$as_me: WARNING: ${ZLIB_DIR}/include/zlib.h:     section \&quot;Present But Cannot Be Compiled\&quot;&quot; &gt;&amp;2;}
+    { echo &quot;$as_me:$LINENO: WARNING: ${ZLIB_DIR}/include/zlib.h: proceeding with the preprocessor's result&quot; &gt;&amp;5
+echo &quot;$as_me: WARNING: ${ZLIB_DIR}/include/zlib.h: proceeding with the preprocessor's result&quot; &gt;&amp;2;}
+    { echo &quot;$as_me:$LINENO: WARNING: ${ZLIB_DIR}/include/zlib.h: in the future, the compiler will take precedence&quot; &gt;&amp;5
+echo &quot;$as_me: WARNING: ${ZLIB_DIR}/include/zlib.h: in the future, the compiler will take precedence&quot; &gt;&amp;2;}
+
     ;;
 esac
-echo &quot;$as_me:$LINENO: checking for ${z_DIR}/include/zlib.h&quot; &gt;&amp;5
-echo $ECHO_N &quot;checking for ${z_DIR}/include/zlib.h... $ECHO_C&quot; &gt;&amp;6
-if eval &quot;test \&quot;\${$as_ac_Header+set}\&quot; = set&quot;; then
+{ echo &quot;$as_me:$LINENO: checking for ${ZLIB_DIR}/include/zlib.h&quot; &gt;&amp;5
+echo $ECHO_N &quot;checking for ${ZLIB_DIR}/include/zlib.h... $ECHO_C&quot; &gt;&amp;6; }
+if { as_var=$as_ac_Header; eval &quot;test \&quot;\${$as_var+set}\&quot; = set&quot;; }; then
   echo $ECHO_N &quot;(cached) $ECHO_C&quot; &gt;&amp;6
 else
   eval &quot;$as_ac_Header=\$ac_header_preproc&quot;
 fi
-echo &quot;$as_me:$LINENO: result: `eval echo '${'$as_ac_Header'}'`&quot; &gt;&amp;5
-echo &quot;${ECHO_T}`eval echo '${'$as_ac_Header'}'`&quot; &gt;&amp;6
+ac_res=`eval echo '${'$as_ac_Header'}'`
+	       { echo &quot;$as_me:$LINENO: result: $ac_res&quot; &gt;&amp;5
+echo &quot;${ECHO_T}$ac_res&quot; &gt;&amp;6; }
 
 fi
 if test `eval echo '${'$as_ac_Header'}'` = yes; then
@@ -12485,17 +13962,17 @@
       else
 	 if test &quot;xzlib.h&quot; != &quot;x&quot; ; then
             if test &quot;${ac_cv_header_zlib_h+set}&quot; = set; then
-  echo &quot;$as_me:$LINENO: checking for zlib.h&quot; &gt;&amp;5
-echo $ECHO_N &quot;checking for zlib.h... $ECHO_C&quot; &gt;&amp;6
+  { echo &quot;$as_me:$LINENO: checking for zlib.h&quot; &gt;&amp;5
+echo $ECHO_N &quot;checking for zlib.h... $ECHO_C&quot; &gt;&amp;6; }
 if test &quot;${ac_cv_header_zlib_h+set}&quot; = set; then
   echo $ECHO_N &quot;(cached) $ECHO_C&quot; &gt;&amp;6
 fi
-echo &quot;$as_me:$LINENO: result: $ac_cv_header_zlib_h&quot; &gt;&amp;5
-echo &quot;${ECHO_T}$ac_cv_header_zlib_h&quot; &gt;&amp;6
+{ echo &quot;$as_me:$LINENO: result: $ac_cv_header_zlib_h&quot; &gt;&amp;5
+echo &quot;${ECHO_T}$ac_cv_header_zlib_h&quot; &gt;&amp;6; }
 else
   # Is the header compilable?
-echo &quot;$as_me:$LINENO: checking zlib.h usability&quot; &gt;&amp;5
-echo $ECHO_N &quot;checking zlib.h usability... $ECHO_C&quot; &gt;&amp;6
+{ echo &quot;$as_me:$LINENO: checking zlib.h usability&quot; &gt;&amp;5
+echo $ECHO_N &quot;checking zlib.h usability... $ECHO_C&quot; &gt;&amp;6; }
 cat &gt;conftest.$ac_ext &lt;&lt;_ACEOF
 /* confdefs.h.  */
 _ACEOF
@@ -12532,15 +14009,16 @@
   echo &quot;$as_me: failed program was:&quot; &gt;&amp;5
 sed 's/^/| /' conftest.$ac_ext &gt;&amp;5
 
-ac_header_compiler=no
+	ac_header_compiler=no
 fi
+
 rm -f conftest.err conftest.$ac_objext conftest.$ac_ext
-echo &quot;$as_me:$LINENO: result: $ac_header_compiler&quot; &gt;&amp;5
-echo &quot;${ECHO_T}$ac_header_compiler&quot; &gt;&amp;6
+{ echo &quot;$as_me:$LINENO: result: $ac_header_compiler&quot; &gt;&amp;5
+echo &quot;${ECHO_T}$ac_header_compiler&quot; &gt;&amp;6; }
 
 # Is the header present?
-echo &quot;$as_me:$LINENO: checking zlib.h presence&quot; &gt;&amp;5
-echo $ECHO_N &quot;checking zlib.h presence... $ECHO_C&quot; &gt;&amp;6
+{ echo &quot;$as_me:$LINENO: checking zlib.h presence&quot; &gt;&amp;5
+echo $ECHO_N &quot;checking zlib.h presence... $ECHO_C&quot; &gt;&amp;6; }
 cat &gt;conftest.$ac_ext &lt;&lt;_ACEOF
 /* confdefs.h.  */
 _ACEOF
@@ -12574,9 +14052,10 @@
 
   ac_header_preproc=no
 fi
+
 rm -f conftest.err conftest.$ac_ext
-echo &quot;$as_me:$LINENO: result: $ac_header_preproc&quot; &gt;&amp;5
-echo &quot;${ECHO_T}$ac_header_preproc&quot; &gt;&amp;6
+{ echo &quot;$as_me:$LINENO: result: $ac_header_preproc&quot; &gt;&amp;5
+echo &quot;${ECHO_T}$ac_header_preproc&quot; &gt;&amp;6; }
 
 # So?  What about this header?
 case $ac_header_compiler:$ac_header_preproc:$ac_c_preproc_warn_flag in
@@ -12600,25 +14079,18 @@
 echo &quot;$as_me: WARNING: zlib.h: proceeding with the preprocessor's result&quot; &gt;&amp;2;}
     { echo &quot;$as_me:$LINENO: WARNING: zlib.h: in the future, the compiler will take precedence&quot; &gt;&amp;5
 echo &quot;$as_me: WARNING: zlib.h: in the future, the compiler will take precedence&quot; &gt;&amp;2;}
-    (
-      cat &lt;&lt;\_ASBOX
-## ------------------------------------------ ##
-## Report this to the AC_PACKAGE_NAME lists.  ##
-## ------------------------------------------ ##
-_ASBOX
-    ) |
-      sed &quot;s/^/$as_me: WARNING:     /&quot; &gt;&amp;2
+
     ;;
 esac
-echo &quot;$as_me:$LINENO: checking for zlib.h&quot; &gt;&amp;5
-echo $ECHO_N &quot;checking for zlib.h... $ECHO_C&quot; &gt;&amp;6
+{ echo &quot;$as_me:$LINENO: checking for zlib.h&quot; &gt;&amp;5
+echo $ECHO_N &quot;checking for zlib.h... $ECHO_C&quot; &gt;&amp;6; }
 if test &quot;${ac_cv_header_zlib_h+set}&quot; = set; then
   echo $ECHO_N &quot;(cached) $ECHO_C&quot; &gt;&amp;6
 else
   ac_cv_header_zlib_h=$ac_header_preproc
 fi
-echo &quot;$as_me:$LINENO: result: $ac_cv_header_zlib_h&quot; &gt;&amp;5
-echo &quot;${ECHO_T}$ac_cv_header_zlib_h&quot; &gt;&amp;6
+{ echo &quot;$as_me:$LINENO: result: $ac_cv_header_zlib_h&quot; &gt;&amp;5
+echo &quot;${ECHO_T}$ac_cv_header_zlib_h&quot; &gt;&amp;6; }
 
 fi
 if test $ac_cv_header_zlib_h = yes; then
@@ -12631,7 +14103,7 @@
 	 fi
       fi
       if test &quot;x${ZLIB_HEADER_FOUND}&quot; = &quot;x0&quot; ; then
-         if test ! -z &quot;${z_MANDATORY}&quot; ;
+         if test ! -z &quot;${ZLIB_MANDATORY}&quot; ;
          then
             echo &quot; ***&quot;
             echo &quot; *** It appears that you do not have the z development package installed.&quot;
@@ -12639,18 +14111,18 @@
             echo &quot; *** without explicitly specifying --with-z&quot;
             exit 1
          fi
-         z_LIB=&quot;&quot;
-         z_INCLUDE=&quot;&quot;
-         PBX_LIBz=0
+         ZLIB_LIB=&quot;&quot;
+         ZLIB_INCLUDE=&quot;&quot;
+         PBX_LIBZLIB=0
       else
-         PBX_LIBz=1
+         PBX_LIBZLIB=1
 
 cat &gt;&gt;confdefs.h &lt;&lt;_ACEOF
 #define HAVE_ZLIB 1
 _ACEOF
 
       fi
-   elif test ! -z &quot;${z_MANDATORY}&quot;;
+   elif test ! -z &quot;${ZLIB_MANDATORY}&quot;;
    then
       echo &quot;***&quot;
       echo &quot;*** The zlib installation on this system appears to be broken.&quot;
@@ -12665,33 +14137,33 @@
 
 
 EDITLINE_LIBS=&quot;&quot;
-if test &quot;x$termcap_LIB&quot; != &quot;x&quot; ; then
-  EDITLINE_LIBS=&quot;$termcap_LIB&quot;
-elif test &quot;x$tinfo_LIB&quot; != &quot;x&quot; ; then
-  EDITLINE_LIBS=&quot;$tinfo_LIB&quot;
-elif test &quot;x$curses_LIB&quot; != &quot;x&quot; ; then
-  EDITLINE_LIBS=&quot;$curses_LIB&quot;
-elif test &quot;x$ncurses_LIB&quot; != &quot;x&quot; ; then
-  EDITLINE_LIBS=&quot;$ncurses_LIB&quot;
+if test &quot;x$TERMCAP_LIB&quot; != &quot;x&quot; ; then
+  EDITLINE_LIBS=&quot;$TERMCAP_LIB&quot;
+elif test &quot;x$TINFO_LIB&quot; != &quot;x&quot; ; then
+  EDITLINE_LIBS=&quot;$TINFO_LIB&quot;
+elif test &quot;x$CURSES_LIB&quot; != &quot;x&quot; ; then
+  EDITLINE_LIBS=&quot;$CURSES_LIB&quot;
+elif test &quot;x$NCURSES_LIB&quot; != &quot;x&quot; ; then
+  EDITLINE_LIBS=&quot;$NCURSES_LIB&quot;
 else
   echo &quot;*** termcap support not found&quot;
   exit 1
 fi
 
 
-PBX_LIBossaudio=0
+PBX_LIBOSS=0
 if test &quot;${ac_cv_header_linux_soundcard_h+set}&quot; = set; then
-  echo &quot;$as_me:$LINENO: checking for linux/soundcard.h&quot; &gt;&amp;5
-echo $ECHO_N &quot;checking for linux/soundcard.h... $ECHO_C&quot; &gt;&amp;6
+  { echo &quot;$as_me:$LINENO: checking for linux/soundcard.h&quot; &gt;&amp;5
+echo $ECHO_N &quot;checking for linux/soundcard.h... $ECHO_C&quot; &gt;&amp;6; }
 if test &quot;${ac_cv_header_linux_soundcard_h+set}&quot; = set; then
   echo $ECHO_N &quot;(cached) $ECHO_C&quot; &gt;&amp;6
 fi
-echo &quot;$as_me:$LINENO: result: $ac_cv_header_linux_soundcard_h&quot; &gt;&amp;5
-echo &quot;${ECHO_T}$ac_cv_header_linux_soundcard_h&quot; &gt;&amp;6
+{ echo &quot;$as_me:$LINENO: result: $ac_cv_header_linux_soundcard_h&quot; &gt;&amp;5
+echo &quot;${ECHO_T}$ac_cv_header_linux_soundcard_h&quot; &gt;&amp;6; }
 else
   # Is the header compilable?
-echo &quot;$as_me:$LINENO: checking linux/soundcard.h usability&quot; &gt;&amp;5
-echo $ECHO_N &quot;checking linux/soundcard.h usability... $ECHO_C&quot; &gt;&amp;6
+{ echo &quot;$as_me:$LINENO: checking linux/soundcard.h usability&quot; &gt;&amp;5
+echo $ECHO_N &quot;checking linux/soundcard.h usability... $ECHO_C&quot; &gt;&amp;6; }
 cat &gt;conftest.$ac_ext &lt;&lt;_ACEOF
 /* confdefs.h.  */
 _ACEOF
@@ -12728,15 +14200,16 @@
   echo &quot;$as_me: failed program was:&quot; &gt;&amp;5
 sed 's/^/| /' conftest.$ac_ext &gt;&amp;5
 
-ac_header_compiler=no
+	ac_header_compiler=no
 fi
+
 rm -f conftest.err conftest.$ac_objext conftest.$ac_ext
-echo &quot;$as_me:$LINENO: result: $ac_header_compiler&quot; &gt;&amp;5
-echo &quot;${ECHO_T}$ac_header_compiler&quot; &gt;&amp;6
+{ echo &quot;$as_me:$LINENO: result: $ac_header_compiler&quot; &gt;&amp;5
+echo &quot;${ECHO_T}$ac_header_compiler&quot; &gt;&amp;6; }
 
 # Is the header present?
-echo &quot;$as_me:$LINENO: checking linux/soundcard.h presence&quot; &gt;&amp;5
-echo $ECHO_N &quot;checking linux/soundcard.h presence... $ECHO_C&quot; &gt;&amp;6
+{ echo &quot;$as_me:$LINENO: checking linux/soundcard.h presence&quot; &gt;&amp;5
+echo $ECHO_N &quot;checking linux/soundcard.h presence... $ECHO_C&quot; &gt;&amp;6; }
 cat &gt;conftest.$ac_ext &lt;&lt;_ACEOF
 /* confdefs.h.  */
 _ACEOF
@@ -12770,9 +14243,10 @@
 
   ac_header_preproc=no
 fi
+
 rm -f conftest.err conftest.$ac_ext
-echo &quot;$as_me:$LINENO: result: $ac_header_preproc&quot; &gt;&amp;5
-echo &quot;${ECHO_T}$ac_header_preproc&quot; &gt;&amp;6
+{ echo &quot;$as_me:$LINENO: result: $ac_header_preproc&quot; &gt;&amp;5
+echo &quot;${ECHO_T}$ac_header_preproc&quot; &gt;&amp;6; }
 
 # So?  What about this header?
 case $ac_header_compiler:$ac_header_preproc:$ac_c_preproc_warn_flag in
@@ -12796,30 +14270,23 @@
 echo &quot;$as_me: WARNING: linux/soundcard.h: proceeding with the preprocessor's result&quot; &gt;&amp;2;}
     { echo &quot;$as_me:$LINENO: WARNING: linux/soundcard.h: in the future, the compiler will take precedence&quot; &gt;&amp;5
 echo &quot;$as_me: WARNING: linux/soundcard.h: in the future, the compiler will take precedence&quot; &gt;&amp;2;}
-    (
-      cat &lt;&lt;\_ASBOX
-## ------------------------------------------ ##
-## Report this to the AC_PACKAGE_NAME lists.  ##
-## ------------------------------------------ ##
-_ASBOX
-    ) |
-      sed &quot;s/^/$as_me: WARNING:     /&quot; &gt;&amp;2
+
     ;;
 esac
-echo &quot;$as_me:$LINENO: checking for linux/soundcard.h&quot; &gt;&amp;5
-echo $ECHO_N &quot;checking for linux/soundcard.h... $ECHO_C&quot; &gt;&amp;6
+{ echo &quot;$as_me:$LINENO: checking for linux/soundcard.h&quot; &gt;&amp;5
+echo $ECHO_N &quot;checking for linux/soundcard.h... $ECHO_C&quot; &gt;&amp;6; }
 if test &quot;${ac_cv_header_linux_soundcard_h+set}&quot; = set; then
   echo $ECHO_N &quot;(cached) $ECHO_C&quot; &gt;&amp;6
 else
   ac_cv_header_linux_soundcard_h=$ac_header_preproc
 fi
-echo &quot;$as_me:$LINENO: result: $ac_cv_header_linux_soundcard_h&quot; &gt;&amp;5
-echo &quot;${ECHO_T}$ac_cv_header_linux_soundcard_h&quot; &gt;&amp;6
+{ echo &quot;$as_me:$LINENO: result: $ac_cv_header_linux_soundcard_h&quot; &gt;&amp;5
+echo &quot;${ECHO_T}$ac_cv_header_linux_soundcard_h&quot; &gt;&amp;6; }
 
 fi
 if test $ac_cv_header_linux_soundcard_h = yes; then
 
-		PBX_LIBossaudio=1
+		PBX_LIBOSS=1
 
 cat &gt;&gt;confdefs.h &lt;&lt;_ACEOF
 #define HAVE_OSS 1
@@ -12829,19 +14296,19 @@
 fi
 
 
-if test &quot;$PBX_LIBossaudio&quot; = &quot;0&quot;; then
+if test &quot;$PBX_LIBOSS&quot; = &quot;0&quot;; then
    if test &quot;${ac_cv_header_sys_soundcard_h+set}&quot; = set; then
-  echo &quot;$as_me:$LINENO: checking for sys/soundcard.h&quot; &gt;&amp;5
-echo $ECHO_N &quot;checking for sys/soundcard.h... $ECHO_C&quot; &gt;&amp;6
+  { echo &quot;$as_me:$LINENO: checking for sys/soundcard.h&quot; &gt;&amp;5
+echo $ECHO_N &quot;checking for sys/soundcard.h... $ECHO_C&quot; &gt;&amp;6; }
 if test &quot;${ac_cv_header_sys_soundcard_h+set}&quot; = set; then
   echo $ECHO_N &quot;(cached) $ECHO_C&quot; &gt;&amp;6
 fi
-echo &quot;$as_me:$LINENO: result: $ac_cv_header_sys_soundcard_h&quot; &gt;&amp;5
-echo &quot;${ECHO_T}$ac_cv_header_sys_soundcard_h&quot; &gt;&amp;6
+{ echo &quot;$as_me:$LINENO: result: $ac_cv_header_sys_soundcard_h&quot; &gt;&amp;5
+echo &quot;${ECHO_T}$ac_cv_header_sys_soundcard_h&quot; &gt;&amp;6; }
 else
   # Is the header compilable?
-echo &quot;$as_me:$LINENO: checking sys/soundcard.h usability&quot; &gt;&amp;5
-echo $ECHO_N &quot;checking sys/soundcard.h usability... $ECHO_C&quot; &gt;&amp;6
+{ echo &quot;$as_me:$LINENO: checking sys/soundcard.h usability&quot; &gt;&amp;5
+echo $ECHO_N &quot;checking sys/soundcard.h usability... $ECHO_C&quot; &gt;&amp;6; }
 cat &gt;conftest.$ac_ext &lt;&lt;_ACEOF
 /* confdefs.h.  */
 _ACEOF
@@ -12878,15 +14345,16 @@
   echo &quot;$as_me: failed program was:&quot; &gt;&amp;5
 sed 's/^/| /' conftest.$ac_ext &gt;&amp;5
 
-ac_header_compiler=no
+	ac_header_compiler=no
 fi
+
 rm -f conftest.err conftest.$ac_objext conftest.$ac_ext
-echo &quot;$as_me:$LINENO: result: $ac_header_compiler&quot; &gt;&amp;5
-echo &quot;${ECHO_T}$ac_header_compiler&quot; &gt;&amp;6
+{ echo &quot;$as_me:$LINENO: result: $ac_header_compiler&quot; &gt;&amp;5
+echo &quot;${ECHO_T}$ac_header_compiler&quot; &gt;&amp;6; }
 
 # Is the header present?
-echo &quot;$as_me:$LINENO: checking sys/soundcard.h presence&quot; &gt;&amp;5
-echo $ECHO_N &quot;checking sys/soundcard.h presence... $ECHO_C&quot; &gt;&amp;6
+{ echo &quot;$as_me:$LINENO: checking sys/soundcard.h presence&quot; &gt;&amp;5
+echo $ECHO_N &quot;checking sys/soundcard.h presence... $ECHO_C&quot; &gt;&amp;6; }
 cat &gt;conftest.$ac_ext &lt;&lt;_ACEOF
 /* confdefs.h.  */
 _ACEOF
@@ -12920,9 +14388,10 @@
 
   ac_header_preproc=no
 fi
+
 rm -f conftest.err conftest.$ac_ext
-echo &quot;$as_me:$LINENO: result: $ac_header_preproc&quot; &gt;&amp;5
-echo &quot;${ECHO_T}$ac_header_preproc&quot; &gt;&amp;6
+{ echo &quot;$as_me:$LINENO: result: $ac_header_preproc&quot; &gt;&amp;5
+echo &quot;${ECHO_T}$ac_header_preproc&quot; &gt;&amp;6; }
 
 # So?  What about this header?
 case $ac_header_compiler:$ac_header_preproc:$ac_c_preproc_warn_flag in
@@ -12946,25 +14415,18 @@
 echo &quot;$as_me: WARNING: sys/soundcard.h: proceeding with the preprocessor's result&quot; &gt;&amp;2;}
     { echo &quot;$as_me:$LINENO: WARNING: sys/soundcard.h: in the future, the compiler will take precedence&quot; &gt;&amp;5
 echo &quot;$as_me: WARNING: sys/soundcard.h: in the future, the compiler will take precedence&quot; &gt;&amp;2;}
-    (
-      cat &lt;&lt;\_ASBOX
-## ------------------------------------------ ##
-## Report this to the AC_PACKAGE_NAME lists.  ##
-## ------------------------------------------ ##
-_ASBOX
-    ) |
-      sed &quot;s/^/$as_me: WARNING:     /&quot; &gt;&amp;2
+
     ;;
 esac
-echo &quot;$as_me:$LINENO: checking for sys/soundcard.h&quot; &gt;&amp;5
-echo $ECHO_N &quot;checking for sys/soundcard.h... $ECHO_C&quot; &gt;&amp;6
+{ echo &quot;$as_me:$LINENO: checking for sys/soundcard.h&quot; &gt;&amp;5
+echo $ECHO_N &quot;checking for sys/soundcard.h... $ECHO_C&quot; &gt;&amp;6; }
 if test &quot;${ac_cv_header_sys_soundcard_h+set}&quot; = set; then
   echo $ECHO_N &quot;(cached) $ECHO_C&quot; &gt;&amp;6
 else
   ac_cv_header_sys_soundcard_h=$ac_header_preproc
 fi
-echo &quot;$as_me:$LINENO: result: $ac_cv_header_sys_soundcard_h&quot; &gt;&amp;5
-echo &quot;${ECHO_T}$ac_cv_header_sys_soundcard_h&quot; &gt;&amp;6
+{ echo &quot;$as_me:$LINENO: result: $ac_cv_header_sys_soundcard_h&quot; &gt;&amp;5
+echo &quot;${ECHO_T}$ac_cv_header_sys_soundcard_h&quot; &gt;&amp;6; }
 
 fi
 if test $ac_cv_header_sys_soundcard_h = yes; then
@@ -12980,37 +14442,37 @@
 
 
 fi
-if test &quot;$PBX_LIBossaudio&quot; = &quot;0&quot;; then
+if test &quot;$PBX_LIBOSS&quot; = &quot;0&quot;; then
 
 
-# Check whether --with-ossaudio or --without-ossaudio was given.
+# Check whether --with-ossaudio was given.
 if test &quot;${with_ossaudio+set}&quot; = set; then
-  withval=&quot;$with_ossaudio&quot;
-
+  withval=$with_ossaudio;
 case ${withval} in
      n|no)
-     USE_ossaudio=no
+     USE_OSS=no
      ;;
      y|ye|yes)
-     ossaudio_MANDATORY=&quot;yes&quot;
+     OSS_MANDATORY=&quot;yes&quot;
      ;;
      *)
-     ossaudio_DIR=&quot;${withval}&quot;
-     ossaudio_MANDATORY=&quot;yes&quot;
+     OSS_DIR=&quot;${withval}&quot;
+     OSS_MANDATORY=&quot;yes&quot;
      ;;
 esac
 
-fi;
+fi
 
-PBX_LIBossaudio=0
 
-if test &quot;${USE_ossaudio}&quot; != &quot;no&quot;; then
+PBX_LIBOSS=0
+
+if test &quot;${USE_OSS}&quot; != &quot;no&quot;; then
    pbxlibdir=&quot;&quot;
-   if test &quot;x${ossaudio_DIR}&quot; != &quot;x&quot;; then
+   if test &quot;x${OSS_DIR}&quot; != &quot;x&quot;; then
       pbxlibdir=&quot;-L${ossaudio_DIR}/lib&quot;
    fi
-   echo &quot;$as_me:$LINENO: checking for oss_ioctl_mixer in -lossaudio&quot; &gt;&amp;5
-echo $ECHO_N &quot;checking for oss_ioctl_mixer in -lossaudio... $ECHO_C&quot; &gt;&amp;6
+   { echo &quot;$as_me:$LINENO: checking for oss_ioctl_mixer in -lossaudio&quot; &gt;&amp;5
+echo $ECHO_N &quot;checking for oss_ioctl_mixer in -lossaudio... $ECHO_C&quot; &gt;&amp;6; }
 if test &quot;${ac_cv_lib_ossaudio_oss_ioctl_mixer+set}&quot; = set; then
   echo $ECHO_N &quot;(cached) $ECHO_C&quot; &gt;&amp;6
 else
@@ -13023,17 +14485,17 @@
 cat &gt;&gt;conftest.$ac_ext &lt;&lt;_ACEOF
 /* end confdefs.h.  */
 
-/* Override any gcc2 internal prototype to avoid an error.  */
+/* Override any GCC internal prototype to avoid an error.
+   Use char because int might match the return type of a GCC
+   builtin and then its argument prototype would still apply.  */
 #ifdef __cplusplus
 extern &quot;C&quot;
 #endif
-/* We use char because int might match the return type of a gcc2
-   builtin and then its argument prototype would still apply.  */
 char oss_ioctl_mixer ();
 int
 main ()
 {
-oss_ioctl_mixer ();
+return oss_ioctl_mixer ();
   ;
   return 0;
 }
@@ -13065,39 +14527,43 @@
   echo &quot;$as_me: failed program was:&quot; &gt;&amp;5
 sed 's/^/| /' conftest.$ac_ext &gt;&amp;5
 
-ac_cv_lib_ossaudio_oss_ioctl_mixer=no
+	ac_cv_lib_ossaudio_oss_ioctl_mixer=no
 fi
+
 rm -f conftest.err conftest.$ac_objext \
       conftest$ac_exeext conftest.$ac_ext
 LIBS=$ac_check_lib_save_LIBS
 fi
-echo &quot;$as_me:$LINENO: result: $ac_cv_lib_ossaudio_oss_ioctl_mixer&quot; &gt;&amp;5
-echo &quot;${ECHO_T}$ac_cv_lib_ossaudio_oss_ioctl_mixer&quot; &gt;&amp;6
+{ echo &quot;$as_me:$LINENO: result: $ac_cv_lib_ossaudio_oss_ioctl_mixer&quot; &gt;&amp;5
+echo &quot;${ECHO_T}$ac_cv_lib_ossaudio_oss_ioctl_mixer&quot; &gt;&amp;6; }
 if test $ac_cv_lib_ossaudio_oss_ioctl_mixer = yes; then
-  :
+  AST_OSS_FOUND=yes
+else
+  AST_OSS_FOUND=no
 fi
 
 
-   if test &quot;${ac_cv_lib_ossaudio_oss_ioctl_mixer}&quot; = &quot;yes&quot;; then
-      ossaudio_LIB=&quot;-lossaudio &quot;
+   if test &quot;${AST_OSS_FOUND}&quot; = &quot;yes&quot;; then
+      OSS_LIB=&quot;-lossaudio &quot;
       OSS_HEADER_FOUND=&quot;1&quot;
-      if test &quot;x${ossaudio_DIR}&quot; != &quot;x&quot;; then
-         ossaudio_LIB=&quot;${pbxlibdir} ${ossaudio_LIB}&quot;
-	 ossaudio_INCLUDE=&quot;-I${ossaudio_DIR}/include&quot;
+      if test &quot;x${OSS_DIR}&quot; != &quot;x&quot;; then
+         OSS_LIB=&quot;${pbxlibdir} ${OSS_LIB}&quot;
+	 OSS_INCLUDE=&quot;-I${OSS_DIR}/include&quot;
 	 if test &quot;xsoundcard.h&quot; != &quot;x&quot; ; then
-	    as_ac_Header=`echo &quot;ac_cv_header_${ossaudio_DIR}/include/soundcard.h&quot; | $as_tr_sh`
-if eval &quot;test \&quot;\${$as_ac_Header+set}\&quot; = set&quot;; then
-  echo &quot;$as_me:$LINENO: checking for ${ossaudio_DIR}/include/soundcard.h&quot; &gt;&amp;5
-echo $ECHO_N &quot;checking for ${ossaudio_DIR}/include/soundcard.h... $ECHO_C&quot; &gt;&amp;6
-if eval &quot;test \&quot;\${$as_ac_Header+set}\&quot; = set&quot;; then
+	    as_ac_Header=`echo &quot;ac_cv_header_${OSS_DIR}/include/soundcard.h&quot; | $as_tr_sh`
+if { as_var=$as_ac_Header; eval &quot;test \&quot;\${$as_var+set}\&quot; = set&quot;; }; then
+  { echo &quot;$as_me:$LINENO: checking for ${OSS_DIR}/include/soundcard.h&quot; &gt;&amp;5
+echo $ECHO_N &quot;checking for ${OSS_DIR}/include/soundcard.h... $ECHO_C&quot; &gt;&amp;6; }
+if { as_var=$as_ac_Header; eval &quot;test \&quot;\${$as_var+set}\&quot; = set&quot;; }; then
   echo $ECHO_N &quot;(cached) $ECHO_C&quot; &gt;&amp;6
 fi
-echo &quot;$as_me:$LINENO: result: `eval echo '${'$as_ac_Header'}'`&quot; &gt;&amp;5
-echo &quot;${ECHO_T}`eval echo '${'$as_ac_Header'}'`&quot; &gt;&amp;6
+ac_res=`eval echo '${'$as_ac_Header'}'`
+	       { echo &quot;$as_me:$LINENO: result: $ac_res&quot; &gt;&amp;5
+echo &quot;${ECHO_T}$ac_res&quot; &gt;&amp;6; }
 else
   # Is the header compilable?
-echo &quot;$as_me:$LINENO: checking ${ossaudio_DIR}/include/soundcard.h usability&quot; &gt;&amp;5
-echo $ECHO_N &quot;checking ${ossaudio_DIR}/include/soundcard.h usability... $ECHO_C&quot; &gt;&amp;6
+{ echo &quot;$as_me:$LINENO: checking ${OSS_DIR}/include/soundcard.h usability&quot; &gt;&amp;5
+echo $ECHO_N &quot;checking ${OSS_DIR}/include/soundcard.h usability... $ECHO_C&quot; &gt;&amp;6; }
 cat &gt;conftest.$ac_ext &lt;&lt;_ACEOF
 /* confdefs.h.  */
 _ACEOF
@@ -13105,7 +14571,7 @@
 cat &gt;&gt;conftest.$ac_ext &lt;&lt;_ACEOF
 /* end confdefs.h.  */
 $ac_includes_default
-#include &lt;${ossaudio_DIR}/include/soundcard.h&gt;
+#include &lt;${OSS_DIR}/include/soundcard.h&gt;
 _ACEOF
 rm -f conftest.$ac_objext
 if { (eval echo &quot;$as_me:$LINENO: \&quot;$ac_compile\&quot;&quot;) &gt;&amp;5
@@ -13134,22 +14600,23 @@
   echo &quot;$as_me: failed program was:&quot; &gt;&amp;5
 sed 's/^/| /' conftest.$ac_ext &gt;&amp;5
 
-ac_header_compiler=no
+	ac_header_compiler=no
 fi
+
 rm -f conftest.err conftest.$ac_objext conftest.$ac_ext
-echo &quot;$as_me:$LINENO: result: $ac_header_compiler&quot; &gt;&amp;5
-echo &quot;${ECHO_T}$ac_header_compiler&quot; &gt;&amp;6
+{ echo &quot;$as_me:$LINENO: result: $ac_header_compiler&quot; &gt;&amp;5
+echo &quot;${ECHO_T}$ac_header_compiler&quot; &gt;&amp;6; }
 
 # Is the header present?
-echo &quot;$as_me:$LINENO: checking ${ossaudio_DIR}/include/soundcard.h presence&quot; &gt;&amp;5
-echo $ECHO_N &quot;checking ${ossaudio_DIR}/include/soundcard.h presence... $ECHO_C&quot; &gt;&amp;6
+{ echo &quot;$as_me:$LINENO: checking ${OSS_DIR}/include/soundcard.h presence&quot; &gt;&amp;5
+echo $ECHO_N &quot;checking ${OSS_DIR}/include/soundcard.h presence... $ECHO_C&quot; &gt;&amp;6; }
 cat &gt;conftest.$ac_ext &lt;&lt;_ACEOF
 /* confdefs.h.  */
 _ACEOF
 cat confdefs.h &gt;&gt;conftest.$ac_ext
 cat &gt;&gt;conftest.$ac_ext &lt;&lt;_ACEOF
 /* end confdefs.h.  */
-#include &lt;${ossaudio_DIR}/include/soundcard.h&gt;
+#include &lt;${OSS_DIR}/include/soundcard.h&gt;
 _ACEOF
 if { (eval echo &quot;$as_me:$LINENO: \&quot;$ac_cpp conftest.$ac_ext\&quot;&quot;) &gt;&amp;5
   (eval $ac_cpp conftest.$ac_ext) 2&gt;conftest.er1
@@ -13176,51 +14643,46 @@
 
   ac_header_preproc=no
 fi
+
 rm -f conftest.err conftest.$ac_ext
-echo &quot;$as_me:$LINENO: result: $ac_header_preproc&quot; &gt;&amp;5
-echo &quot;${ECHO_T}$ac_header_preproc&quot; &gt;&amp;6
+{ echo &quot;$as_me:$LINENO: result: $ac_header_preproc&quot; &gt;&amp;5
+echo &quot;${ECHO_T}$ac_header_preproc&quot; &gt;&amp;6; }
 
 # So?  What about this header?
 case $ac_header_compiler:$ac_header_preproc:$ac_c_preproc_warn_flag in
   yes:no: )
-    { echo &quot;$as_me:$LINENO: WARNING: ${ossaudio_DIR}/include/soundcard.h: accepted by the compiler, rejected by the preprocessor!&quot; &gt;&amp;5
-echo &quot;$as_me: WARNING: ${ossaudio_DIR}/include/soundcard.h: accepted by the compiler, rejected by the preprocessor!&quot; &gt;&amp;2;}
-    { echo &quot;$as_me:$LINENO: WARNING: ${ossaudio_DIR}/include/soundcard.h: proceeding with the compiler's result&quot; &gt;&amp;5
-echo &quot;$as_me: WARNING: ${ossaudio_DIR}/include/soundcard.h: proceeding with the compiler's result&quot; &gt;&amp;2;}
+    { echo &quot;$as_me:$LINENO: WARNING: ${OSS_DIR}/include/soundcard.h: accepted by the compiler, rejected by the preprocessor!&quot; &gt;&amp;5
+echo &quot;$as_me: WARNING: ${OSS_DIR}/include/soundcard.h: accepted by the compiler, rejected by the preprocessor!&quot; &gt;&amp;2;}
+    { echo &quot;$as_me:$LINENO: WARNING: ${OSS_DIR}/include/soundcard.h: proceeding with the compiler's result&quot; &gt;&amp;5
+echo &quot;$as_me: WARNING: ${OSS_DIR}/include/soundcard.h: proceeding with the compiler's result&quot; &gt;&amp;2;}
     ac_header_preproc=yes
     ;;
   no:yes:* )
-    { echo &quot;$as_me:$LINENO: WARNING: ${ossaudio_DIR}/include/soundcard.h: present but cannot be compiled&quot; &gt;&amp;5
-echo &quot;$as_me: WARNING: ${ossaudio_DIR}/include/soundcard.h: present but cannot be compiled&quot; &gt;&amp;2;}
-    { echo &quot;$as_me:$LINENO: WARNING: ${ossaudio_DIR}/include/soundcard.h:     check for missing prerequisite headers?&quot; &gt;&amp;5
-echo &quot;$as_me: WARNING: ${ossaudio_DIR}/include/soundcard.h:     check for missing prerequisite headers?&quot; &gt;&amp;2;}
-    { echo &quot;$as_me:$LINENO: WARNING: ${ossaudio_DIR}/include/soundcard.h: see the Autoconf documentation&quot; &gt;&amp;5
-echo &quot;$as_me: WARNING: ${ossaudio_DIR}/include/soundcard.h: see the Autoconf documentation&quot; &gt;&amp;2;}
-    { echo &quot;$as_me:$LINENO: WARNING: ${ossaudio_DIR}/include/soundcard.h:     section \&quot;Present But Cannot Be Compiled\&quot;&quot; &gt;&amp;5
-echo &quot;$as_me: WARNING: ${ossaudio_DIR}/include/soundcard.h:     section \&quot;Present But Cannot Be Compiled\&quot;&quot; &gt;&amp;2;}
-    { echo &quot;$as_me:$LINENO: WARNING: ${ossaudio_DIR}/include/soundcard.h: proceeding with the preprocessor's result&quot; &gt;&amp;5
-echo &quot;$as_me: WARNING: ${ossaudio_DIR}/include/soundcard.h: proceeding with the preprocessor's result&quot; &gt;&amp;2;}
-    { echo &quot;$as_me:$LINENO: WARNING: ${ossaudio_DIR}/include/soundcard.h: in the future, the compiler will take precedence&quot; &gt;&amp;5
-echo &quot;$as_me: WARNING: ${ossaudio_DIR}/include/soundcard.h: in the future, the compiler will take precedence&quot; &gt;&amp;2;}
-    (
-      cat &lt;&lt;\_ASBOX
-## ------------------------------------------ ##
-## Report this to the AC_PACKAGE_NAME lists.  ##
-## ------------------------------------------ ##
-_ASBOX
-    ) |
-      sed &quot;s/^/$as_me: WARNING:     /&quot; &gt;&amp;2
+    { echo &quot;$as_me:$LINENO: WARNING: ${OSS_DIR}/include/soundcard.h: present but cannot be compiled&quot; &gt;&amp;5
+echo &quot;$as_me: WARNING: ${OSS_DIR}/include/soundcard.h: present but cannot be compiled&quot; &gt;&amp;2;}
+    { echo &quot;$as_me:$LINENO: WARNING: ${OSS_DIR}/include/soundcard.h:     check for missing prerequisite headers?&quot; &gt;&amp;5
+echo &quot;$as_me: WARNING: ${OSS_DIR}/include/soundcard.h:     check for missing prerequisite headers?&quot; &gt;&amp;2;}
+    { echo &quot;$as_me:$LINENO: WARNING: ${OSS_DIR}/include/soundcard.h: see the Autoconf documentation&quot; &gt;&amp;5
+echo &quot;$as_me: WARNING: ${OSS_DIR}/include/soundcard.h: see the Autoconf documentation&quot; &gt;&amp;2;}
+    { echo &quot;$as_me:$LINENO: WARNING: ${OSS_DIR}/include/soundcard.h:     section \&quot;Present But Cannot Be Compiled\&quot;&quot; &gt;&amp;5
+echo &quot;$as_me: WARNING: ${OSS_DIR}/include/soundcard.h:     section \&quot;Present But Cannot Be Compiled\&quot;&quot; &gt;&amp;2;}
+    { echo &quot;$as_me:$LINENO: WARNING: ${OSS_DIR}/include/soundcard.h: proceeding with the preprocessor's result&quot; &gt;&amp;5
+echo &quot;$as_me: WARNING: ${OSS_DIR}/include/soundcard.h: proceeding with the preprocessor's result&quot; &gt;&amp;2;}
+    { echo &quot;$as_me:$LINENO: WARNING: ${OSS_DIR}/include/soundcard.h: in the future, the compiler will take precedence&quot; &gt;&amp;5
+echo &quot;$as_me: WARNING: ${OSS_DIR}/include/soundcard.h: in the future, the compiler will take precedence&quot; &gt;&amp;2;}
+
     ;;
 esac
-echo &quot;$as_me:$LINENO: checking for ${ossaudio_DIR}/include/soundcard.h&quot; &gt;&amp;5
-echo $ECHO_N &quot;checking for ${ossaudio_DIR}/include/soundcard.h... $ECHO_C&quot; &gt;&amp;6
-if eval &quot;test \&quot;\${$as_ac_Header+set}\&quot; = set&quot;; then
+{ echo &quot;$as_me:$LINENO: checking for ${OSS_DIR}/include/soundcard.h&quot; &gt;&amp;5
+echo $ECHO_N &quot;checking for ${OSS_DIR}/include/soundcard.h... $ECHO_C&quot; &gt;&amp;6; }
+if { as_var=$as_ac_Header; eval &quot;test \&quot;\${$as_var+set}\&quot; = set&quot;; }; then
   echo $ECHO_N &quot;(cached) $ECHO_C&quot; &gt;&amp;6
 else
   eval &quot;$as_ac_Header=\$ac_header_preproc&quot;
 fi
-echo &quot;$as_me:$LINENO: result: `eval echo '${'$as_ac_Header'}'`&quot; &gt;&amp;5
-echo &quot;${ECHO_T}`eval echo '${'$as_ac_Header'}'`&quot; &gt;&amp;6
+ac_res=`eval echo '${'$as_ac_Header'}'`
+	       { echo &quot;$as_me:$LINENO: result: $ac_res&quot; &gt;&amp;5
+echo &quot;${ECHO_T}$ac_res&quot; &gt;&amp;6; }
 
 fi
 if test `eval echo '${'$as_ac_Header'}'` = yes; then
@@ -13234,17 +14696,17 @@
       else
 	 if test &quot;xsoundcard.h&quot; != &quot;x&quot; ; then
             if test &quot;${ac_cv_header_soundcard_h+set}&quot; = set; then
-  echo &quot;$as_me:$LINENO: checking for soundcard.h&quot; &gt;&amp;5
-echo $ECHO_N &quot;checking for soundcard.h... $ECHO_C&quot; &gt;&amp;6
+  { echo &quot;$as_me:$LINENO: checking for soundcard.h&quot; &gt;&amp;5
+echo $ECHO_N &quot;checking for soundcard.h... $ECHO_C&quot; &gt;&amp;6; }
 if test &quot;${ac_cv_header_soundcard_h+set}&quot; = set; then
   echo $ECHO_N &quot;(cached) $ECHO_C&quot; &gt;&amp;6
 fi
-echo &quot;$as_me:$LINENO: result: $ac_cv_header_soundcard_h&quot; &gt;&amp;5
-echo &quot;${ECHO_T}$ac_cv_header_soundcard_h&quot; &gt;&amp;6
+{ echo &quot;$as_me:$LINENO: result: $ac_cv_header_soundcard_h&quot; &gt;&amp;5
+echo &quot;${ECHO_T}$ac_cv_header_soundcard_h&quot; &gt;&amp;6; }
 else
   # Is the header compilable?
-echo &quot;$as_me:$LINENO: checking soundcard.h usability&quot; &gt;&amp;5
-echo $ECHO_N &quot;checking soundcard.h usability... $ECHO_C&quot; &gt;&amp;6
+{ echo &quot;$as_me:$LINENO: checking soundcard.h usability&quot; &gt;&amp;5
+echo $ECHO_N &quot;checking soundcard.h usability... $ECHO_C&quot; &gt;&amp;6; }
 cat &gt;conftest.$ac_ext &lt;&lt;_ACEOF
 /* confdefs.h.  */
 _ACEOF
@@ -13281,15 +14743,16 @@
   echo &quot;$as_me: failed program was:&quot; &gt;&amp;5
 sed 's/^/| /' conftest.$ac_ext &gt;&amp;5
 
-ac_header_compiler=no
+	ac_header_compiler=no
 fi
+
 rm -f conftest.err conftest.$ac_objext conftest.$ac_ext
-echo &quot;$as_me:$LINENO: result: $ac_header_compiler&quot; &gt;&amp;5
-echo &quot;${ECHO_T}$ac_header_compiler&quot; &gt;&amp;6
+{ echo &quot;$as_me:$LINENO: result: $ac_header_compiler&quot; &gt;&amp;5
+echo &quot;${ECHO_T}$ac_header_compiler&quot; &gt;&amp;6; }
 
 # Is the header present?
-echo &quot;$as_me:$LINENO: checking soundcard.h presence&quot; &gt;&amp;5
-echo $ECHO_N &quot;checking soundcard.h presence... $ECHO_C&quot; &gt;&amp;6
+{ echo &quot;$as_me:$LINENO: checking soundcard.h presence&quot; &gt;&amp;5
+echo $ECHO_N &quot;checking soundcard.h presence... $ECHO_C&quot; &gt;&amp;6; }
 cat &gt;conftest.$ac_ext &lt;&lt;_ACEOF
 /* confdefs.h.  */
 _ACEOF
@@ -13323,9 +14786,10 @@
 
   ac_header_preproc=no
 fi
+
 rm -f conftest.err conftest.$ac_ext
-echo &quot;$as_me:$LINENO: result: $ac_header_preproc&quot; &gt;&amp;5
-echo &quot;${ECHO_T}$ac_header_preproc&quot; &gt;&amp;6
+{ echo &quot;$as_me:$LINENO: result: $ac_header_preproc&quot; &gt;&amp;5
+echo &quot;${ECHO_T}$ac_header_preproc&quot; &gt;&amp;6; }
 
 # So?  What about this header?
 case $ac_header_compiler:$ac_header_preproc:$ac_c_preproc_warn_flag in
@@ -13349,25 +14813,18 @@
 echo &quot;$as_me: WARNING: soundcard.h: proceeding with the preprocessor's result&quot; &gt;&amp;2;}
     { echo &quot;$as_me:$LINENO: WARNING: soundcard.h: in the future, the compiler will take precedence&quot; &gt;&amp;5
 echo &quot;$as_me: WARNING: soundcard.h: in the future, the compiler will take precedence&quot; &gt;&amp;2;}
-    (
-      cat &lt;&lt;\_ASBOX
-## ------------------------------------------ ##
-## Report this to the AC_PACKAGE_NAME lists.  ##
-## ------------------------------------------ ##
-_ASBOX
-    ) |
-      sed &quot;s/^/$as_me: WARNING:     /&quot; &gt;&amp;2
+
     ;;
 esac
-echo &quot;$as_me:$LINENO: checking for soundcard.h&quot; &gt;&amp;5
-echo $ECHO_N &quot;checking for soundcard.h... $ECHO_C&quot; &gt;&amp;6
+{ echo &quot;$as_me:$LINENO: checking for soundcard.h&quot; &gt;&amp;5
+echo $ECHO_N &quot;checking for soundcard.h... $ECHO_C&quot; &gt;&amp;6; }
 if test &quot;${ac_cv_header_soundcard_h+set}&quot; = set; then
   echo $ECHO_N &quot;(cached) $ECHO_C&quot; &gt;&amp;6
 else
   ac_cv_header_soundcard_h=$ac_header_preproc
 fi
-echo &quot;$as_me:$LINENO: result: $ac_cv_header_soundcard_h&quot; &gt;&amp;5
-echo &quot;${ECHO_T}$ac_cv_header_soundcard_h&quot; &gt;&amp;6
+{ echo &quot;$as_me:$LINENO: result: $ac_cv_header_soundcard_h&quot; &gt;&amp;5
+echo &quot;${ECHO_T}$ac_cv_header_soundcard_h&quot; &gt;&amp;6; }
 
 fi
 if test $ac_cv_header_soundcard_h = yes; then
@@ -13380,7 +14837,7 @@
 	 fi
       fi
       if test &quot;x${OSS_HEADER_FOUND}&quot; = &quot;x0&quot; ; then
-         if test ! -z &quot;${ossaudio_MANDATORY}&quot; ;
+         if test ! -z &quot;${OSS_MANDATORY}&quot; ;
          then
             echo &quot; ***&quot;
             echo &quot; *** It appears that you do not have the ossaudio development package installed.&quot;
@@ -13388,18 +14845,18 @@
             echo &quot; *** without explicitly specifying --with-ossaudio&quot;
             exit 1
          fi
-         ossaudio_LIB=&quot;&quot;
-         ossaudio_INCLUDE=&quot;&quot;
-         PBX_LIBossaudio=0
+         OSS_LIB=&quot;&quot;
+         OSS_INCLUDE=&quot;&quot;
+         PBX_LIBOSS=0
       else
-         PBX_LIBossaudio=1
+         PBX_LIBOSS=1
 
 cat &gt;&gt;confdefs.h &lt;&lt;_ACEOF
 #define HAVE_OSS 1
 _ACEOF
 
       fi
-   elif test ! -z &quot;${ossaudio_MANDATORY}&quot;;
+   elif test ! -z &quot;${OSS_MANDATORY}&quot;;
    then
       echo &quot;***&quot;
       echo &quot;*** The Open Sound System installation on this system appears to be broken.&quot;
@@ -13419,34 +14876,34 @@
 if test &quot;${PBX_OSTYPE}&quot; = &quot;Linux&quot; ; then
 
 
-# Check whether --with-tonezone or --without-tonezone was given.
+# Check whether --with-tonezone was given.
 if test &quot;${with_tonezone+set}&quot; = set; then
-  withval=&quot;$with_tonezone&quot;
-
+  withval=$with_tonezone;
 case ${withval} in
      n|no)
-     USE_tonezone=no
+     USE_ZAPTEL=no
      ;;
      y|ye|yes)
-     tonezone_MANDATORY=&quot;yes&quot;
+     ZAPTEL_MANDATORY=&quot;yes&quot;
      ;;
      *)
-     tonezone_DIR=&quot;${withval}&quot;
-     tonezone_MANDATORY=&quot;yes&quot;
+     ZAPTEL_DIR=&quot;${withval}&quot;
+     ZAPTEL_MANDATORY=&quot;yes&quot;
      ;;
 esac
 
-fi;
+fi
 
-PBX_LIBtonezone=0
 
-if test &quot;${USE_tonezone}&quot; != &quot;no&quot;; then
+PBX_LIBZAPTEL=0
+
+if test &quot;${USE_ZAPTEL}&quot; != &quot;no&quot;; then
    pbxlibdir=&quot;&quot;
-   if test &quot;x${tonezone_DIR}&quot; != &quot;x&quot;; then
+   if test &quot;x${ZAPTEL_DIR}&quot; != &quot;x&quot;; then
       pbxlibdir=&quot;-L${tonezone_DIR}/lib&quot;
    fi
-   echo &quot;$as_me:$LINENO: checking for tone_zone_find in -ltonezone&quot; &gt;&amp;5
-echo $ECHO_N &quot;checking for tone_zone_find in -ltonezone... $ECHO_C&quot; &gt;&amp;6
+   { echo &quot;$as_me:$LINENO: checking for tone_zone_find in -ltonezone&quot; &gt;&amp;5
+echo $ECHO_N &quot;checking for tone_zone_find in -ltonezone... $ECHO_C&quot; &gt;&amp;6; }
 if test &quot;${ac_cv_lib_tonezone_tone_zone_find+set}&quot; = set; then
   echo $ECHO_N &quot;(cached) $ECHO_C&quot; &gt;&amp;6
 else
@@ -13459,17 +14916,17 @@
 cat &gt;&gt;conftest.$ac_ext &lt;&lt;_ACEOF
 /* end confdefs.h.  */
 
-/* Override any gcc2 internal prototype to avoid an error.  */
+/* Override any GCC internal prototype to avoid an error.
+   Use char because int might match the return type of a GCC
+   builtin and then its argument prototype would still apply.  */
 #ifdef __cplusplus
 extern &quot;C&quot;
 #endif
-/* We use char because int might match the return type of a gcc2
-   builtin and then its argument prototype would still apply.  */
 char tone_zone_find ();
 int
 main ()
 {
-tone_zone_find ();
+return tone_zone_find ();
   ;
   return 0;
 }
@@ -13501,39 +14958,43 @@
   echo &quot;$as_me: failed program was:&quot; &gt;&amp;5
 sed 's/^/| /' conftest.$ac_ext &gt;&amp;5
 
-ac_cv_lib_tonezone_tone_zone_find=no
+	ac_cv_lib_tonezone_tone_zone_find=no
 fi
+
 rm -f conftest.err conftest.$ac_objext \
       conftest$ac_exeext conftest.$ac_ext
 LIBS=$ac_check_lib_save_LIBS
 fi
-echo &quot;$as_me:$LINENO: result: $ac_cv_lib_tonezone_tone_zone_find&quot; &gt;&amp;5
-echo &quot;${ECHO_T}$ac_cv_lib_tonezone_tone_zone_find&quot; &gt;&amp;6
+{ echo &quot;$as_me:$LINENO: result: $ac_cv_lib_tonezone_tone_zone_find&quot; &gt;&amp;5
+echo &quot;${ECHO_T}$ac_cv_lib_tonezone_tone_zone_find&quot; &gt;&amp;6; }
 if test $ac_cv_lib_tonezone_tone_zone_find = yes; then
-  :
+  AST_ZAPTEL_FOUND=yes
+else
+  AST_ZAPTEL_FOUND=no
 fi
 
 
-   if test &quot;${ac_cv_lib_tonezone_tone_zone_find}&quot; = &quot;yes&quot;; then
-      tonezone_LIB=&quot;-ltonezone &quot;
+   if test &quot;${AST_ZAPTEL_FOUND}&quot; = &quot;yes&quot;; then
+      ZAPTEL_LIB=&quot;-ltonezone &quot;
       ZAPTEL_HEADER_FOUND=&quot;1&quot;
-      if test &quot;x${tonezone_DIR}&quot; != &quot;x&quot;; then
-         tonezone_LIB=&quot;${pbxlibdir} ${tonezone_LIB}&quot;
-	 tonezone_INCLUDE=&quot;-I${tonezone_DIR}/include&quot;
+      if test &quot;x${ZAPTEL_DIR}&quot; != &quot;x&quot;; then
+         ZAPTEL_LIB=&quot;${pbxlibdir} ${ZAPTEL_LIB}&quot;
+	 ZAPTEL_INCLUDE=&quot;-I${ZAPTEL_DIR}/include&quot;
 	 if test &quot;xlinux/zaptel.h&quot; != &quot;x&quot; ; then
-	    as_ac_Header=`echo &quot;ac_cv_header_${tonezone_DIR}/include/linux/zaptel.h&quot; | $as_tr_sh`
-if eval &quot;test \&quot;\${$as_ac_Header+set}\&quot; = set&quot;; then
-  echo &quot;$as_me:$LINENO: checking for ${tonezone_DIR}/include/linux/zaptel.h&quot; &gt;&amp;5
-echo $ECHO_N &quot;checking for ${tonezone_DIR}/include/linux/zaptel.h... $ECHO_C&quot; &gt;&amp;6
-if eval &quot;test \&quot;\${$as_ac_Header+set}\&quot; = set&quot;; then
+	    as_ac_Header=`echo &quot;ac_cv_header_${ZAPTEL_DIR}/include/linux/zaptel.h&quot; | $as_tr_sh`
+if { as_var=$as_ac_Header; eval &quot;test \&quot;\${$as_var+set}\&quot; = set&quot;; }; then
+  { echo &quot;$as_me:$LINENO: checking for ${ZAPTEL_DIR}/include/linux/zaptel.h&quot; &gt;&amp;5
+echo $ECHO_N &quot;checking for ${ZAPTEL_DIR}/include/linux/zaptel.h... $ECHO_C&quot; &gt;&amp;6; }
+if { as_var=$as_ac_Header; eval &quot;test \&quot;\${$as_var+set}\&quot; = set&quot;; }; then
   echo $ECHO_N &quot;(cached) $ECHO_C&quot; &gt;&amp;6
 fi
-echo &quot;$as_me:$LINENO: result: `eval echo '${'$as_ac_Header'}'`&quot; &gt;&amp;5
-echo &quot;${ECHO_T}`eval echo '${'$as_ac_Header'}'`&quot; &gt;&amp;6
+ac_res=`eval echo '${'$as_ac_Header'}'`
+	       { echo &quot;$as_me:$LINENO: result: $ac_res&quot; &gt;&amp;5
+echo &quot;${ECHO_T}$ac_res&quot; &gt;&amp;6; }
 else
   # Is the header compilable?
-echo &quot;$as_me:$LINENO: checking ${tonezone_DIR}/include/linux/zaptel.h usability&quot; &gt;&amp;5
-echo $ECHO_N &quot;checking ${tonezone_DIR}/include/linux/zaptel.h usability... $ECHO_C&quot; &gt;&amp;6
+{ echo &quot;$as_me:$LINENO: checking ${ZAPTEL_DIR}/include/linux/zaptel.h usability&quot; &gt;&amp;5
+echo $ECHO_N &quot;checking ${ZAPTEL_DIR}/include/linux/zaptel.h usability... $ECHO_C&quot; &gt;&amp;6; }
 cat &gt;conftest.$ac_ext &lt;&lt;_ACEOF
 /* confdefs.h.  */
 _ACEOF
@@ -13541,7 +15002,7 @@
 cat &gt;&gt;conftest.$ac_ext &lt;&lt;_ACEOF
 /* end confdefs.h.  */
 $ac_includes_default
-#include &lt;${tonezone_DIR}/include/linux/zaptel.h&gt;
+#include &lt;${ZAPTEL_DIR}/include/linux/zaptel.h&gt;
 _ACEOF
 rm -f conftest.$ac_objext
 if { (eval echo &quot;$as_me:$LINENO: \&quot;$ac_compile\&quot;&quot;) &gt;&amp;5
@@ -13570,22 +15031,23 @@
   echo &quot;$as_me: failed program was:&quot; &gt;&amp;5
 sed 's/^/| /' conftest.$ac_ext &gt;&amp;5
 
-ac_header_compiler=no
+	ac_header_compiler=no
 fi
+
 rm -f conftest.err conftest.$ac_objext conftest.$ac_ext
-echo &quot;$as_me:$LINENO: result: $ac_header_compiler&quot; &gt;&amp;5
-echo &quot;${ECHO_T}$ac_header_compiler&quot; &gt;&amp;6
+{ echo &quot;$as_me:$LINENO: result: $ac_header_compiler&quot; &gt;&amp;5
+echo &quot;${ECHO_T}$ac_header_compiler&quot; &gt;&amp;6; }
 
 # Is the header present?
-echo &quot;$as_me:$LINENO: checking ${tonezone_DIR}/include/linux/zaptel.h presence&quot; &gt;&amp;5
-echo $ECHO_N &quot;checking ${tonezone_DIR}/include/linux/zaptel.h presence... $ECHO_C&quot; &gt;&amp;6
+{ echo &quot;$as_me:$LINENO: checking ${ZAPTEL_DIR}/include/linux/zaptel.h presence&quot; &gt;&amp;5
+echo $ECHO_N &quot;checking ${ZAPTEL_DIR}/include/linux/zaptel.h presence... $ECHO_C&quot; &gt;&amp;6; }
 cat &gt;conftest.$ac_ext &lt;&lt;_ACEOF
 /* confdefs.h.  */
 _ACEOF
 cat confdefs.h &gt;&gt;conftest.$ac_ext
 cat &gt;&gt;conftest.$ac_ext &lt;&lt;_ACEOF
 /* end confdefs.h.  */
-#include &lt;${tonezone_DIR}/include/linux/zaptel.h&gt;
+#include &lt;${ZAPTEL_DIR}/include/linux/zaptel.h&gt;
 _ACEOF
 if { (eval echo &quot;$as_me:$LINENO: \&quot;$ac_cpp conftest.$ac_ext\&quot;&quot;) &gt;&amp;5
   (eval $ac_cpp conftest.$ac_ext) 2&gt;conftest.er1
@@ -13612,51 +15074,46 @@
 
   ac_header_preproc=no
 fi
+
 rm -f conftest.err conftest.$ac_ext
-echo &quot;$as_me:$LINENO: result: $ac_header_preproc&quot; &gt;&amp;5
-echo &quot;${ECHO_T}$ac_header_preproc&quot; &gt;&amp;6
+{ echo &quot;$as_me:$LINENO: result: $ac_header_preproc&quot; &gt;&amp;5
+echo &quot;${ECHO_T}$ac_header_preproc&quot; &gt;&amp;6; }
 
 # So?  What about this header?
 case $ac_header_compiler:$ac_header_preproc:$ac_c_preproc_warn_flag in
   yes:no: )
-    { echo &quot;$as_me:$LINENO: WARNING: ${tonezone_DIR}/include/linux/zaptel.h: accepted by the compiler, rejected by the preprocessor!&quot; &gt;&amp;5
-echo &quot;$as_me: WARNING: ${tonezone_DIR}/include/linux/zaptel.h: accepted by the compiler, rejected by the preprocessor!&quot; &gt;&amp;2;}
-    { echo &quot;$as_me:$LINENO: WARNING: ${tonezone_DIR}/include/linux/zaptel.h: proceeding with the compiler's result&quot; &gt;&amp;5
-echo &quot;$as_me: WARNING: ${tonezone_DIR}/include/linux/zaptel.h: proceeding with the compiler's result&quot; &gt;&amp;2;}
+    { echo &quot;$as_me:$LINENO: WARNING: ${ZAPTEL_DIR}/include/linux/zaptel.h: accepted by the compiler, rejected by the preprocessor!&quot; &gt;&amp;5
+echo &quot;$as_me: WARNING: ${ZAPTEL_DIR}/include/linux/zaptel.h: accepted by the compiler, rejected by the preprocessor!&quot; &gt;&amp;2;}
+    { echo &quot;$as_me:$LINENO: WARNING: ${ZAPTEL_DIR}/include/linux/zaptel.h: proceeding with the compiler's result&quot; &gt;&amp;5
+echo &quot;$as_me: WARNING: ${ZAPTEL_DIR}/include/linux/zaptel.h: proceeding with the compiler's result&quot; &gt;&amp;2;}
     ac_header_preproc=yes
     ;;
   no:yes:* )
-    { echo &quot;$as_me:$LINENO: WARNING: ${tonezone_DIR}/include/linux/zaptel.h: present but cannot be compiled&quot; &gt;&amp;5
-echo &quot;$as_me: WARNING: ${tonezone_DIR}/include/linux/zaptel.h: present but cannot be compiled&quot; &gt;&amp;2;}
-    { echo &quot;$as_me:$LINENO: WARNING: ${tonezone_DIR}/include/linux/zaptel.h:     check for missing prerequisite headers?&quot; &gt;&amp;5
-echo &quot;$as_me: WARNING: ${tonezone_DIR}/include/linux/zaptel.h:     check for missing prerequisite headers?&quot; &gt;&amp;2;}
-    { echo &quot;$as_me:$LINENO: WARNING: ${tonezone_DIR}/include/linux/zaptel.h: see the Autoconf documentation&quot; &gt;&amp;5
-echo &quot;$as_me: WARNING: ${tonezone_DIR}/include/linux/zaptel.h: see the Autoconf documentation&quot; &gt;&amp;2;}
-    { echo &quot;$as_me:$LINENO: WARNING: ${tonezone_DIR}/include/linux/zaptel.h:     section \&quot;Present But Cannot Be Compiled\&quot;&quot; &gt;&amp;5
-echo &quot;$as_me: WARNING: ${tonezone_DIR}/include/linux/zaptel.h:     section \&quot;Present But Cannot Be Compiled\&quot;&quot; &gt;&amp;2;}
-    { echo &quot;$as_me:$LINENO: WARNING: ${tonezone_DIR}/include/linux/zaptel.h: proceeding with the preprocessor's result&quot; &gt;&amp;5
-echo &quot;$as_me: WARNING: ${tonezone_DIR}/include/linux/zaptel.h: proceeding with the preprocessor's result&quot; &gt;&amp;2;}
-    { echo &quot;$as_me:$LINENO: WARNING: ${tonezone_DIR}/include/linux/zaptel.h: in the future, the compiler will take precedence&quot; &gt;&amp;5
-echo &quot;$as_me: WARNING: ${tonezone_DIR}/include/linux/zaptel.h: in the future, the compiler will take precedence&quot; &gt;&amp;2;}
-    (
-      cat &lt;&lt;\_ASBOX
-## ------------------------------------------ ##
-## Report this to the AC_PACKAGE_NAME lists.  ##
-## ------------------------------------------ ##
-_ASBOX
-    ) |
-      sed &quot;s/^/$as_me: WARNING:     /&quot; &gt;&amp;2
+    { echo &quot;$as_me:$LINENO: WARNING: ${ZAPTEL_DIR}/include/linux/zaptel.h: present but cannot be compiled&quot; &gt;&amp;5
+echo &quot;$as_me: WARNING: ${ZAPTEL_DIR}/include/linux/zaptel.h: present but cannot be compiled&quot; &gt;&amp;2;}
+    { echo &quot;$as_me:$LINENO: WARNING: ${ZAPTEL_DIR}/include/linux/zaptel.h:     check for missing prerequisite headers?&quot; &gt;&amp;5
+echo &quot;$as_me: WARNING: ${ZAPTEL_DIR}/include/linux/zaptel.h:     check for missing prerequisite headers?&quot; &gt;&amp;2;}
+    { echo &quot;$as_me:$LINENO: WARNING: ${ZAPTEL_DIR}/include/linux/zaptel.h: see the Autoconf documentation&quot; &gt;&amp;5
+echo &quot;$as_me: WARNING: ${ZAPTEL_DIR}/include/linux/zaptel.h: see the Autoconf documentation&quot; &gt;&amp;2;}
+    { echo &quot;$as_me:$LINENO: WARNING: ${ZAPTEL_DIR}/include/linux/zaptel.h:     section \&quot;Present But Cannot Be Compiled\&quot;&quot; &gt;&amp;5
+echo &quot;$as_me: WARNING: ${ZAPTEL_DIR}/include/linux/zaptel.h:     section \&quot;Present But Cannot Be Compiled\&quot;&quot; &gt;&amp;2;}
+    { echo &quot;$as_me:$LINENO: WARNING: ${ZAPTEL_DIR}/include/linux/zaptel.h: proceeding with the preprocessor's result&quot; &gt;&amp;5
+echo &quot;$as_me: WARNING: ${ZAPTEL_DIR}/include/linux/zaptel.h: proceeding with the preprocessor's result&quot; &gt;&amp;2;}
+    { echo &quot;$as_me:$LINENO: WARNING: ${ZAPTEL_DIR}/include/linux/zaptel.h: in the future, the compiler will take precedence&quot; &gt;&amp;5
+echo &quot;$as_me: WARNING: ${ZAPTEL_DIR}/include/linux/zaptel.h: in the future, the compiler will take precedence&quot; &gt;&amp;2;}
+
     ;;
 esac
-echo &quot;$as_me:$LINENO: checking for ${tonezone_DIR}/include/linux/zaptel.h&quot; &gt;&amp;5
-echo $ECHO_N &quot;checking for ${tonezone_DIR}/include/linux/zaptel.h... $ECHO_C&quot; &gt;&amp;6
-if eval &quot;test \&quot;\${$as_ac_Header+set}\&quot; = set&quot;; then
+{ echo &quot;$as_me:$LINENO: checking for ${ZAPTEL_DIR}/include/linux/zaptel.h&quot; &gt;&amp;5
+echo $ECHO_N &quot;checking for ${ZAPTEL_DIR}/include/linux/zaptel.h... $ECHO_C&quot; &gt;&amp;6; }
+if { as_var=$as_ac_Header; eval &quot;test \&quot;\${$as_var+set}\&quot; = set&quot;; }; then
   echo $ECHO_N &quot;(cached) $ECHO_C&quot; &gt;&amp;6
 else
   eval &quot;$as_ac_Header=\$ac_header_preproc&quot;
 fi
-echo &quot;$as_me:$LINENO: result: `eval echo '${'$as_ac_Header'}'`&quot; &gt;&amp;5
-echo &quot;${ECHO_T}`eval echo '${'$as_ac_Header'}'`&quot; &gt;&amp;6
+ac_res=`eval echo '${'$as_ac_Header'}'`
+	       { echo &quot;$as_me:$LINENO: result: $ac_res&quot; &gt;&amp;5
+echo &quot;${ECHO_T}$ac_res&quot; &gt;&amp;6; }
 
 fi
 if test `eval echo '${'$as_ac_Header'}'` = yes; then
@@ -13670,17 +15127,17 @@
       else
 	 if test &quot;xlinux/zaptel.h&quot; != &quot;x&quot; ; then
             if test &quot;${ac_cv_header_linux_zaptel_h+set}&quot; = set; then
-  echo &quot;$as_me:$LINENO: checking for linux/zaptel.h&quot; &gt;&amp;5
-echo $ECHO_N &quot;checking for linux/zaptel.h... $ECHO_C&quot; &gt;&amp;6
+  { echo &quot;$as_me:$LINENO: checking for linux/zaptel.h&quot; &gt;&amp;5
+echo $ECHO_N &quot;checking for linux/zaptel.h... $ECHO_C&quot; &gt;&amp;6; }
 if test &quot;${ac_cv_header_linux_zaptel_h+set}&quot; = set; then
   echo $ECHO_N &quot;(cached) $ECHO_C&quot; &gt;&amp;6
 fi
-echo &quot;$as_me:$LINENO: result: $ac_cv_header_linux_zaptel_h&quot; &gt;&amp;5
-echo &quot;${ECHO_T}$ac_cv_header_linux_zaptel_h&quot; &gt;&amp;6
+{ echo &quot;$as_me:$LINENO: result: $ac_cv_header_linux_zaptel_h&quot; &gt;&amp;5
+echo &quot;${ECHO_T}$ac_cv_header_linux_zaptel_h&quot; &gt;&amp;6; }
 else
   # Is the header compilable?
-echo &quot;$as_me:$LINENO: checking linux/zaptel.h usability&quot; &gt;&amp;5
-echo $ECHO_N &quot;checking linux/zaptel.h usability... $ECHO_C&quot; &gt;&amp;6
+{ echo &quot;$as_me:$LINENO: checking linux/zaptel.h usability&quot; &gt;&amp;5
+echo $ECHO_N &quot;checking linux/zaptel.h usability... $ECHO_C&quot; &gt;&amp;6; }
 cat &gt;conftest.$ac_ext &lt;&lt;_ACEOF
 /* confdefs.h.  */
 _ACEOF
@@ -13717,15 +15174,16 @@
   echo &quot;$as_me: failed program was:&quot; &gt;&amp;5
 sed 's/^/| /' conftest.$ac_ext &gt;&amp;5
 
-ac_header_compiler=no
+	ac_header_compiler=no
 fi
+
 rm -f conftest.err conftest.$ac_objext conftest.$ac_ext
-echo &quot;$as_me:$LINENO: result: $ac_header_compiler&quot; &gt;&amp;5
-echo &quot;${ECHO_T}$ac_header_compiler&quot; &gt;&amp;6
+{ echo &quot;$as_me:$LINENO: result: $ac_header_compiler&quot; &gt;&amp;5
+echo &quot;${ECHO_T}$ac_header_compiler&quot; &gt;&amp;6; }
 
 # Is the header present?
-echo &quot;$as_me:$LINENO: checking linux/zaptel.h presence&quot; &gt;&amp;5
-echo $ECHO_N &quot;checking linux/zaptel.h presence... $ECHO_C&quot; &gt;&amp;6
+{ echo &quot;$as_me:$LINENO: checking linux/zaptel.h presence&quot; &gt;&amp;5
+echo $ECHO_N &quot;checking linux/zaptel.h presence... $ECHO_C&quot; &gt;&amp;6; }
 cat &gt;conftest.$ac_ext &lt;&lt;_ACEOF
 /* confdefs.h.  */
 _ACEOF
@@ -13759,9 +15217,10 @@
 
   ac_header_preproc=no
 fi
+
 rm -f conftest.err conftest.$ac_ext
-echo &quot;$as_me:$LINENO: result: $ac_header_preproc&quot; &gt;&amp;5
-echo &quot;${ECHO_T}$ac_header_preproc&quot; &gt;&amp;6
+{ echo &quot;$as_me:$LINENO: result: $ac_header_preproc&quot; &gt;&amp;5
+echo &quot;${ECHO_T}$ac_header_preproc&quot; &gt;&amp;6; }
 
 # So?  What about this header?
 case $ac_header_compiler:$ac_header_preproc:$ac_c_preproc_warn_flag in
@@ -13785,25 +15244,18 @@
 echo &quot;$as_me: WARNING: linux/zaptel.h: proceeding with the preprocessor's result&quot; &gt;&amp;2;}
     { echo &quot;$as_me:$LINENO: WARNING: linux/zaptel.h: in the future, the compiler will take precedence&quot; &gt;&amp;5
 echo &quot;$as_me: WARNING: linux/zaptel.h: in the future, the compiler will take precedence&quot; &gt;&amp;2;}
-    (
-      cat &lt;&lt;\_ASBOX
-## ------------------------------------------ ##
-## Report this to the AC_PACKAGE_NAME lists.  ##
-## ------------------------------------------ ##
-_ASBOX
-    ) |
-      sed &quot;s/^/$as_me: WARNING:     /&quot; &gt;&amp;2
+
     ;;
 esac
-echo &quot;$as_me:$LINENO: checking for linux/zaptel.h&quot; &gt;&amp;5
-echo $ECHO_N &quot;checking for linux/zaptel.h... $ECHO_C&quot; &gt;&amp;6
+{ echo &quot;$as_me:$LINENO: checking for linux/zaptel.h&quot; &gt;&amp;5
+echo $ECHO_N &quot;checking for linux/zaptel.h... $ECHO_C&quot; &gt;&amp;6; }
 if test &quot;${ac_cv_header_linux_zaptel_h+set}&quot; = set; then
   echo $ECHO_N &quot;(cached) $ECHO_C&quot; &gt;&amp;6
 else
   ac_cv_header_linux_zaptel_h=$ac_header_preproc
 fi
-echo &quot;$as_me:$LINENO: result: $ac_cv_header_linux_zaptel_h&quot; &gt;&amp;5
-echo &quot;${ECHO_T}$ac_cv_header_linux_zaptel_h&quot; &gt;&amp;6
+{ echo &quot;$as_me:$LINENO: result: $ac_cv_header_linux_zaptel_h&quot; &gt;&amp;5
+echo &quot;${ECHO_T}$ac_cv_header_linux_zaptel_h&quot; &gt;&amp;6; }
 
 fi
 if test $ac_cv_header_linux_zaptel_h = yes; then
@@ -13816,7 +15268,7 @@
 	 fi
       fi
       if test &quot;x${ZAPTEL_HEADER_FOUND}&quot; = &quot;x0&quot; ; then
-         if test ! -z &quot;${tonezone_MANDATORY}&quot; ;
+         if test ! -z &quot;${ZAPTEL_MANDATORY}&quot; ;
          then
             echo &quot; ***&quot;
             echo &quot; *** It appears that you do not have the tonezone development package installed.&quot;
@@ -13824,18 +15276,18 @@
             echo &quot; *** without explicitly specifying --with-tonezone&quot;
             exit 1
          fi
-         tonezone_LIB=&quot;&quot;
-         tonezone_INCLUDE=&quot;&quot;
-         PBX_LIBtonezone=0
+         ZAPTEL_LIB=&quot;&quot;
+         ZAPTEL_INCLUDE=&quot;&quot;
+         PBX_LIBZAPTEL=0
       else
-         PBX_LIBtonezone=1
+         PBX_LIBZAPTEL=1
 
 cat &gt;&gt;confdefs.h &lt;&lt;_ACEOF
 #define HAVE_ZAPTEL 1
 _ACEOF
 
       fi
-   elif test ! -z &quot;${tonezone_MANDATORY}&quot;;
+   elif test ! -z &quot;${ZAPTEL_MANDATORY}&quot;;
    then
       echo &quot;***&quot;
       echo &quot;*** The Zaptel installation on this system appears to be broken.&quot;
@@ -13851,34 +15303,34 @@
 else
 
 
-# Check whether --with-tonezone or --without-tonezone was given.
+# Check whether --with-tonezone was given.
 if test &quot;${with_tonezone+set}&quot; = set; then
-  withval=&quot;$with_tonezone&quot;
-
+  withval=$with_tonezone;
 case ${withval} in
      n|no)
-     USE_tonezone=no
+     USE_ZAPTEL=no
      ;;
      y|ye|yes)
-     tonezone_MANDATORY=&quot;yes&quot;
+     ZAPTEL_MANDATORY=&quot;yes&quot;
      ;;
      *)
-     tonezone_DIR=&quot;${withval}&quot;
-     tonezone_MANDATORY=&quot;yes&quot;
+     ZAPTEL_DIR=&quot;${withval}&quot;
+     ZAPTEL_MANDATORY=&quot;yes&quot;
      ;;
 esac
 
-fi;
+fi
 
-PBX_LIBtonezone=0
 
-if test &quot;${USE_tonezone}&quot; != &quot;no&quot;; then
+PBX_LIBZAPTEL=0
+
+if test &quot;${USE_ZAPTEL}&quot; != &quot;no&quot;; then
    pbxlibdir=&quot;&quot;
-   if test &quot;x${tonezone_DIR}&quot; != &quot;x&quot;; then
+   if test &quot;x${ZAPTEL_DIR}&quot; != &quot;x&quot;; then
       pbxlibdir=&quot;-L${tonezone_DIR}/lib&quot;
    fi
-   echo &quot;$as_me:$LINENO: checking for tone_zone_find in -ltonezone&quot; &gt;&amp;5
-echo $ECHO_N &quot;checking for tone_zone_find in -ltonezone... $ECHO_C&quot; &gt;&amp;6
+   { echo &quot;$as_me:$LINENO: checking for tone_zone_find in -ltonezone&quot; &gt;&amp;5
+echo $ECHO_N &quot;checking for tone_zone_find in -ltonezone... $ECHO_C&quot; &gt;&amp;6; }
 if test &quot;${ac_cv_lib_tonezone_tone_zone_find+set}&quot; = set; then
   echo $ECHO_N &quot;(cached) $ECHO_C&quot; &gt;&amp;6
 else
@@ -13891,17 +15343,17 @@
 cat &gt;&gt;conftest.$ac_ext &lt;&lt;_ACEOF
 /* end confdefs.h.  */
 
-/* Override any gcc2 internal prototype to avoid an error.  */
+/* Override any GCC internal prototype to avoid an error.
+   Use char because int might match the return type of a GCC
+   builtin and then its argument prototype would still apply.  */
 #ifdef __cplusplus
 extern &quot;C&quot;
 #endif
-/* We use char because int might match the return type of a gcc2
-   builtin and then its argument prototype would still apply.  */
 char tone_zone_find ();
 int
 main ()
 {
-tone_zone_find ();
+return tone_zone_find ();
   ;
   return 0;
 }
@@ -13933,39 +15385,43 @@
   echo &quot;$as_me: failed program was:&quot; &gt;&amp;5
 sed 's/^/| /' conftest.$ac_ext &gt;&amp;5
 
-ac_cv_lib_tonezone_tone_zone_find=no
+	ac_cv_lib_tonezone_tone_zone_find=no
 fi
+
 rm -f conftest.err conftest.$ac_objext \
       conftest$ac_exeext conftest.$ac_ext
 LIBS=$ac_check_lib_save_LIBS
 fi
-echo &quot;$as_me:$LINENO: result: $ac_cv_lib_tonezone_tone_zone_find&quot; &gt;&amp;5
-echo &quot;${ECHO_T}$ac_cv_lib_tonezone_tone_zone_find&quot; &gt;&amp;6
+{ echo &quot;$as_me:$LINENO: result: $ac_cv_lib_tonezone_tone_zone_find&quot; &gt;&amp;5
+echo &quot;${ECHO_T}$ac_cv_lib_tonezone_tone_zone_find&quot; &gt;&amp;6; }
 if test $ac_cv_lib_tonezone_tone_zone_find = yes; then
-  :
+  AST_ZAPTEL_FOUND=yes
+else
+  AST_ZAPTEL_FOUND=no
 fi
 
 
-   if test &quot;${ac_cv_lib_tonezone_tone_zone_find}&quot; = &quot;yes&quot;; then
-      tonezone_LIB=&quot;-ltonezone -lm&quot;
+   if test &quot;${AST_ZAPTEL_FOUND}&quot; = &quot;yes&quot;; then
+      ZAPTEL_LIB=&quot;-ltonezone -lm&quot;
       ZAPTEL_HEADER_FOUND=&quot;1&quot;
-      if test &quot;x${tonezone_DIR}&quot; != &quot;x&quot;; then
-         tonezone_LIB=&quot;${pbxlibdir} ${tonezone_LIB}&quot;
-	 tonezone_INCLUDE=&quot;-I${tonezone_DIR}/include&quot;
+      if test &quot;x${ZAPTEL_DIR}&quot; != &quot;x&quot;; then
+         ZAPTEL_LIB=&quot;${pbxlibdir} ${ZAPTEL_LIB}&quot;
+	 ZAPTEL_INCLUDE=&quot;-I${ZAPTEL_DIR}/include&quot;
 	 if test &quot;xzaptel.h&quot; != &quot;x&quot; ; then
-	    as_ac_Header=`echo &quot;ac_cv_header_${tonezone_DIR}/include/zaptel.h&quot; | $as_tr_sh`
-if eval &quot;test \&quot;\${$as_ac_Header+set}\&quot; = set&quot;; then
-  echo &quot;$as_me:$LINENO: checking for ${tonezone_DIR}/include/zaptel.h&quot; &gt;&amp;5
-echo $ECHO_N &quot;checking for ${tonezone_DIR}/include/zaptel.h... $ECHO_C&quot; &gt;&amp;6
-if eval &quot;test \&quot;\${$as_ac_Header+set}\&quot; = set&quot;; then
+	    as_ac_Header=`echo &quot;ac_cv_header_${ZAPTEL_DIR}/include/zaptel.h&quot; | $as_tr_sh`
+if { as_var=$as_ac_Header; eval &quot;test \&quot;\${$as_var+set}\&quot; = set&quot;; }; then
+  { echo &quot;$as_me:$LINENO: checking for ${ZAPTEL_DIR}/include/zaptel.h&quot; &gt;&amp;5
+echo $ECHO_N &quot;checking for ${ZAPTEL_DIR}/include/zaptel.h... $ECHO_C&quot; &gt;&amp;6; }
+if { as_var=$as_ac_Header; eval &quot;test \&quot;\${$as_var+set}\&quot; = set&quot;; }; then
   echo $ECHO_N &quot;(cached) $ECHO_C&quot; &gt;&amp;6
 fi
-echo &quot;$as_me:$LINENO: result: `eval echo '${'$as_ac_Header'}'`&quot; &gt;&amp;5
-echo &quot;${ECHO_T}`eval echo '${'$as_ac_Header'}'`&quot; &gt;&amp;6
+ac_res=`eval echo '${'$as_ac_Header'}'`
+	       { echo &quot;$as_me:$LINENO: result: $ac_res&quot; &gt;&amp;5
+echo &quot;${ECHO_T}$ac_res&quot; &gt;&amp;6; }
 else
   # Is the header compilable?
-echo &quot;$as_me:$LINENO: checking ${tonezone_DIR}/include/zaptel.h usability&quot; &gt;&amp;5
-echo $ECHO_N &quot;checking ${tonezone_DIR}/include/zaptel.h usability... $ECHO_C&quot; &gt;&amp;6
+{ echo &quot;$as_me:$LINENO: checking ${ZAPTEL_DIR}/include/zaptel.h usability&quot; &gt;&amp;5
+echo $ECHO_N &quot;checking ${ZAPTEL_DIR}/include/zaptel.h usability... $ECHO_C&quot; &gt;&amp;6; }
 cat &gt;conftest.$ac_ext &lt;&lt;_ACEOF
 /* confdefs.h.  */
 _ACEOF
@@ -13973,7 +15429,7 @@
 cat &gt;&gt;conftest.$ac_ext &lt;&lt;_ACEOF
 /* end confdefs.h.  */
 $ac_includes_default
-#include &lt;${tonezone_DIR}/include/zaptel.h&gt;
+#include &lt;${ZAPTEL_DIR}/include/zaptel.h&gt;
 _ACEOF
 rm -f conftest.$ac_objext
 if { (eval echo &quot;$as_me:$LINENO: \&quot;$ac_compile\&quot;&quot;) &gt;&amp;5
@@ -14002,22 +15458,23 @@
   echo &quot;$as_me: failed program was:&quot; &gt;&amp;5
 sed 's/^/| /' conftest.$ac_ext &gt;&amp;5
 
-ac_header_compiler=no
+	ac_header_compiler=no
 fi
+
 rm -f conftest.err conftest.$ac_objext conftest.$ac_ext
-echo &quot;$as_me:$LINENO: result: $ac_header_compiler&quot; &gt;&amp;5
-echo &quot;${ECHO_T}$ac_header_compiler&quot; &gt;&amp;6
+{ echo &quot;$as_me:$LINENO: result: $ac_header_compiler&quot; &gt;&amp;5
+echo &quot;${ECHO_T}$ac_header_compiler&quot; &gt;&amp;6; }
 
 # Is the header present?
-echo &quot;$as_me:$LINENO: checking ${tonezone_DIR}/include/zaptel.h presence&quot; &gt;&amp;5
-echo $ECHO_N &quot;checking ${tonezone_DIR}/include/zaptel.h presence... $ECHO_C&quot; &gt;&amp;6
+{ echo &quot;$as_me:$LINENO: checking ${ZAPTEL_DIR}/include/zaptel.h presence&quot; &gt;&amp;5
+echo $ECHO_N &quot;checking ${ZAPTEL_DIR}/include/zaptel.h presence... $ECHO_C&quot; &gt;&amp;6; }
 cat &gt;conftest.$ac_ext &lt;&lt;_ACEOF
 /* confdefs.h.  */
 _ACEOF
 cat confdefs.h &gt;&gt;conftest.$ac_ext
 cat &gt;&gt;conftest.$ac_ext &lt;&lt;_ACEOF
 /* end confdefs.h.  */
-#include &lt;${tonezone_DIR}/include/zaptel.h&gt;
+#include &lt;${ZAPTEL_DIR}/include/zaptel.h&gt;
 _ACEOF
 if { (eval echo &quot;$as_me:$LINENO: \&quot;$ac_cpp conftest.$ac_ext\&quot;&quot;) &gt;&amp;5
   (eval $ac_cpp conftest.$ac_ext) 2&gt;conftest.er1
@@ -14044,51 +15501,46 @@
 
   ac_header_preproc=no
 fi
+
 rm -f conftest.err conftest.$ac_ext
-echo &quot;$as_me:$LINENO: result: $ac_header_preproc&quot; &gt;&amp;5
-echo &quot;${ECHO_T}$ac_header_preproc&quot; &gt;&amp;6
+{ echo &quot;$as_me:$LINENO: result: $ac_header_preproc&quot; &gt;&amp;5
+echo &quot;${ECHO_T}$ac_header_preproc&quot; &gt;&amp;6; }
 
 # So?  What about this header?
 case $ac_header_compiler:$ac_header_preproc:$ac_c_preproc_warn_flag in
   yes:no: )
-    { echo &quot;$as_me:$LINENO: WARNING: ${tonezone_DIR}/include/zaptel.h: accepted by the compiler, rejected by the preprocessor!&quot; &gt;&amp;5
-echo &quot;$as_me: WARNING: ${tonezone_DIR}/include/zaptel.h: accepted by the compiler, rejected by the preprocessor!&quot; &gt;&amp;2;}
-    { echo &quot;$as_me:$LINENO: WARNING: ${tonezone_DIR}/include/zaptel.h: proceeding with the compiler's result&quot; &gt;&amp;5
-echo &quot;$as_me: WARNING: ${tonezone_DIR}/include/zaptel.h: proceeding with the compiler's result&quot; &gt;&amp;2;}
+    { echo &quot;$as_me:$LINENO: WARNING: ${ZAPTEL_DIR}/include/zaptel.h: accepted by the compiler, rejected by the preprocessor!&quot; &gt;&amp;5
+echo &quot;$as_me: WARNING: ${ZAPTEL_DIR}/include/zaptel.h: accepted by the compiler, rejected by the preprocessor!&quot; &gt;&amp;2;}
+    { echo &quot;$as_me:$LINENO: WARNING: ${ZAPTEL_DIR}/include/zaptel.h: proceeding with the compiler's result&quot; &gt;&amp;5
+echo &quot;$as_me: WARNING: ${ZAPTEL_DIR}/include/zaptel.h: proceeding with the compiler's result&quot; &gt;&amp;2;}
     ac_header_preproc=yes
     ;;
   no:yes:* )
-    { echo &quot;$as_me:$LINENO: WARNING: ${tonezone_DIR}/include/zaptel.h: present but cannot be compiled&quot; &gt;&amp;5
-echo &quot;$as_me: WARNING: ${tonezone_DIR}/include/zaptel.h: present but cannot be compiled&quot; &gt;&amp;2;}
-    { echo &quot;$as_me:$LINENO: WARNING: ${tonezone_DIR}/include/zaptel.h:     check for missing prerequisite headers?&quot; &gt;&amp;5
-echo &quot;$as_me: WARNING: ${tonezone_DIR}/include/zaptel.h:     check for missing prerequisite headers?&quot; &gt;&amp;2;}
-    { echo &quot;$as_me:$LINENO: WARNING: ${tonezone_DIR}/include/zaptel.h: see the Autoconf documentation&quot; &gt;&amp;5
-echo &quot;$as_me: WARNING: ${tonezone_DIR}/include/zaptel.h: see the Autoconf documentation&quot; &gt;&amp;2;}
-    { echo &quot;$as_me:$LINENO: WARNING: ${tonezone_DIR}/include/zaptel.h:     section \&quot;Present But Cannot Be Compiled\&quot;&quot; &gt;&amp;5
-echo &quot;$as_me: WARNING: ${tonezone_DIR}/include/zaptel.h:     section \&quot;Present But Cannot Be Compiled\&quot;&quot; &gt;&amp;2;}
-    { echo &quot;$as_me:$LINENO: WARNING: ${tonezone_DIR}/include/zaptel.h: proceeding with the preprocessor's result&quot; &gt;&amp;5
-echo &quot;$as_me: WARNING: ${tonezone_DIR}/include/zaptel.h: proceeding with the preprocessor's result&quot; &gt;&amp;2;}
-    { echo &quot;$as_me:$LINENO: WARNING: ${tonezone_DIR}/include/zaptel.h: in the future, the compiler will take precedence&quot; &gt;&amp;5
-echo &quot;$as_me: WARNING: ${tonezone_DIR}/include/zaptel.h: in the future, the compiler will take precedence&quot; &gt;&amp;2;}
-    (
-      cat &lt;&lt;\_ASBOX
-## ------------------------------------------ ##
-## Report this to the AC_PACKAGE_NAME lists.  ##
-## ------------------------------------------ ##
-_ASBOX
-    ) |
-      sed &quot;s/^/$as_me: WARNING:     /&quot; &gt;&amp;2
+    { echo &quot;$as_me:$LINENO: WARNING: ${ZAPTEL_DIR}/include/zaptel.h: present but cannot be compiled&quot; &gt;&amp;5
+echo &quot;$as_me: WARNING: ${ZAPTEL_DIR}/include/zaptel.h: present but cannot be compiled&quot; &gt;&amp;2;}
+    { echo &quot;$as_me:$LINENO: WARNING: ${ZAPTEL_DIR}/include/zaptel.h:     check for missing prerequisite headers?&quot; &gt;&amp;5
+echo &quot;$as_me: WARNING: ${ZAPTEL_DIR}/include/zaptel.h:     check for missing prerequisite headers?&quot; &gt;&amp;2;}
+    { echo &quot;$as_me:$LINENO: WARNING: ${ZAPTEL_DIR}/include/zaptel.h: see the Autoconf documentation&quot; &gt;&amp;5
+echo &quot;$as_me: WARNING: ${ZAPTEL_DIR}/include/zaptel.h: see the Autoconf documentation&quot; &gt;&amp;2;}
+    { echo &quot;$as_me:$LINENO: WARNING: ${ZAPTEL_DIR}/include/zaptel.h:     section \&quot;Present But Cannot Be Compiled\&quot;&quot; &gt;&amp;5
+echo &quot;$as_me: WARNING: ${ZAPTEL_DIR}/include/zaptel.h:     section \&quot;Present But Cannot Be Compiled\&quot;&quot; &gt;&amp;2;}
+    { echo &quot;$as_me:$LINENO: WARNING: ${ZAPTEL_DIR}/include/zaptel.h: proceeding with the preprocessor's result&quot; &gt;&amp;5
+echo &quot;$as_me: WARNING: ${ZAPTEL_DIR}/include/zaptel.h: proceeding with the preprocessor's result&quot; &gt;&amp;2;}
+    { echo &quot;$as_me:$LINENO: WARNING: ${ZAPTEL_DIR}/include/zaptel.h: in the future, the compiler will take precedence&quot; &gt;&amp;5
+echo &quot;$as_me: WARNING: ${ZAPTEL_DIR}/include/zaptel.h: in the future, the compiler will take precedence&quot; &gt;&amp;2;}
+
     ;;
 esac
-echo &quot;$as_me:$LINENO: checking for ${tonezone_DIR}/include/zaptel.h&quot; &gt;&amp;5
-echo $ECHO_N &quot;checking for ${tonezone_DIR}/include/zaptel.h... $ECHO_C&quot; &gt;&amp;6
-if eval &quot;test \&quot;\${$as_ac_Header+set}\&quot; = set&quot;; then
+{ echo &quot;$as_me:$LINENO: checking for ${ZAPTEL_DIR}/include/zaptel.h&quot; &gt;&amp;5
+echo $ECHO_N &quot;checking for ${ZAPTEL_DIR}/include/zaptel.h... $ECHO_C&quot; &gt;&amp;6; }
+if { as_var=$as_ac_Header; eval &quot;test \&quot;\${$as_var+set}\&quot; = set&quot;; }; then
   echo $ECHO_N &quot;(cached) $ECHO_C&quot; &gt;&amp;6
 else
   eval &quot;$as_ac_Header=\$ac_header_preproc&quot;
 fi
-echo &quot;$as_me:$LINENO: result: `eval echo '${'$as_ac_Header'}'`&quot; &gt;&amp;5
-echo &quot;${ECHO_T}`eval echo '${'$as_ac_Header'}'`&quot; &gt;&amp;6
+ac_res=`eval echo '${'$as_ac_Header'}'`
+	       { echo &quot;$as_me:$LINENO: result: $ac_res&quot; &gt;&amp;5
+echo &quot;${ECHO_T}$ac_res&quot; &gt;&amp;6; }
 
 fi
 if test `eval echo '${'$as_ac_Header'}'` = yes; then
@@ -14102,17 +15554,17 @@
       else
 	 if test &quot;xzaptel.h&quot; != &quot;x&quot; ; then
             if test &quot;${ac_cv_header_zaptel_h+set}&quot; = set; then
-  echo &quot;$as_me:$LINENO: checking for zaptel.h&quot; &gt;&amp;5
-echo $ECHO_N &quot;checking for zaptel.h... $ECHO_C&quot; &gt;&amp;6
+  { echo &quot;$as_me:$LINENO: checking for zaptel.h&quot; &gt;&amp;5
+echo $ECHO_N &quot;checking for zaptel.h... $ECHO_C&quot; &gt;&amp;6; }
 if test &quot;${ac_cv_header_zaptel_h+set}&quot; = set; then
   echo $ECHO_N &quot;(cached) $ECHO_C&quot; &gt;&amp;6
 fi
-echo &quot;$as_me:$LINENO: result: $ac_cv_header_zaptel_h&quot; &gt;&amp;5
-echo &quot;${ECHO_T}$ac_cv_header_zaptel_h&quot; &gt;&amp;6
+{ echo &quot;$as_me:$LINENO: result: $ac_cv_header_zaptel_h&quot; &gt;&amp;5
+echo &quot;${ECHO_T}$ac_cv_header_zaptel_h&quot; &gt;&amp;6; }
 else
   # Is the header compilable?
-echo &quot;$as_me:$LINENO: checking zaptel.h usability&quot; &gt;&amp;5
-echo $ECHO_N &quot;checking zaptel.h usability... $ECHO_C&quot; &gt;&amp;6
+{ echo &quot;$as_me:$LINENO: checking zaptel.h usability&quot; &gt;&amp;5
+echo $ECHO_N &quot;checking zaptel.h usability... $ECHO_C&quot; &gt;&amp;6; }
 cat &gt;conftest.$ac_ext &lt;&lt;_ACEOF
 /* confdefs.h.  */
 _ACEOF
@@ -14149,15 +15601,16 @@
   echo &quot;$as_me: failed program was:&quot; &gt;&amp;5
 sed 's/^/| /' conftest.$ac_ext &gt;&amp;5
 
-ac_header_compiler=no
+	ac_header_compiler=no
 fi
+
 rm -f conftest.err conftest.$ac_objext conftest.$ac_ext
-echo &quot;$as_me:$LINENO: result: $ac_header_compiler&quot; &gt;&amp;5
-echo &quot;${ECHO_T}$ac_header_compiler&quot; &gt;&amp;6
+{ echo &quot;$as_me:$LINENO: result: $ac_header_compiler&quot; &gt;&amp;5
+echo &quot;${ECHO_T}$ac_header_compiler&quot; &gt;&amp;6; }
 
 # Is the header present?
-echo &quot;$as_me:$LINENO: checking zaptel.h presence&quot; &gt;&amp;5
-echo $ECHO_N &quot;checking zaptel.h presence... $ECHO_C&quot; &gt;&amp;6
+{ echo &quot;$as_me:$LINENO: checking zaptel.h presence&quot; &gt;&amp;5
+echo $ECHO_N &quot;checking zaptel.h presence... $ECHO_C&quot; &gt;&amp;6; }
 cat &gt;conftest.$ac_ext &lt;&lt;_ACEOF
 /* confdefs.h.  */
 _ACEOF
@@ -14191,9 +15644,10 @@
 
   ac_header_preproc=no
 fi
+
 rm -f conftest.err conftest.$ac_ext
-echo &quot;$as_me:$LINENO: result: $ac_header_preproc&quot; &gt;&amp;5
-echo &quot;${ECHO_T}$ac_header_preproc&quot; &gt;&amp;6
+{ echo &quot;$as_me:$LINENO: result: $ac_header_preproc&quot; &gt;&amp;5
+echo &quot;${ECHO_T}$ac_header_preproc&quot; &gt;&amp;6; }
 
 # So?  What about this header?
 case $ac_header_compiler:$ac_header_preproc:$ac_c_preproc_warn_flag in
@@ -14217,25 +15671,18 @@
 echo &quot;$as_me: WARNING: zaptel.h: proceeding with the preprocessor's result&quot; &gt;&amp;2;}
     { echo &quot;$as_me:$LINENO: WARNING: zaptel.h: in the future, the compiler will take precedence&quot; &gt;&amp;5
 echo &quot;$as_me: WARNING: zaptel.h: in the future, the compiler will take precedence&quot; &gt;&amp;2;}
-    (
-      cat &lt;&lt;\_ASBOX
-## ------------------------------------------ ##
-## Report this to the AC_PACKAGE_NAME lists.  ##
-## ------------------------------------------ ##
-_ASBOX
-    ) |
-      sed &quot;s/^/$as_me: WARNING:     /&quot; &gt;&amp;2
+
     ;;
 esac
-echo &quot;$as_me:$LINENO: checking for zaptel.h&quot; &gt;&amp;5
-echo $ECHO_N &quot;checking for zaptel.h... $ECHO_C&quot; &gt;&amp;6
+{ echo &quot;$as_me:$LINENO: checking for zaptel.h&quot; &gt;&amp;5
+echo $ECHO_N &quot;checking for zaptel.h... $ECHO_C&quot; &gt;&amp;6; }
 if test &quot;${ac_cv_header_zaptel_h+set}&quot; = set; then
   echo $ECHO_N &quot;(cached) $ECHO_C&quot; &gt;&amp;6
 else
   ac_cv_header_zaptel_h=$ac_header_preproc
 fi
-echo &quot;$as_me:$LINENO: result: $ac_cv_header_zaptel_h&quot; &gt;&amp;5
-echo &quot;${ECHO_T}$ac_cv_header_zaptel_h&quot; &gt;&amp;6
+{ echo &quot;$as_me:$LINENO: result: $ac_cv_header_zaptel_h&quot; &gt;&amp;5
+echo &quot;${ECHO_T}$ac_cv_header_zaptel_h&quot; &gt;&amp;6; }
 
 fi
 if test $ac_cv_header_zaptel_h = yes; then
@@ -14248,7 +15695,7 @@
 	 fi
       fi
       if test &quot;x${ZAPTEL_HEADER_FOUND}&quot; = &quot;x0&quot; ; then
-         if test ! -z &quot;${tonezone_MANDATORY}&quot; ;
+         if test ! -z &quot;${ZAPTEL_MANDATORY}&quot; ;
          then
             echo &quot; ***&quot;
             echo &quot; *** It appears that you do not have the tonezone development package installed.&quot;
@@ -14256,18 +15703,18 @@
             echo &quot; *** without explicitly specifying --with-tonezone&quot;
             exit 1
          fi
-         tonezone_LIB=&quot;&quot;
-         tonezone_INCLUDE=&quot;&quot;
-         PBX_LIBtonezone=0
+         ZAPTEL_LIB=&quot;&quot;
+         ZAPTEL_INCLUDE=&quot;&quot;
+         PBX_LIBZAPTEL=0
       else
-         PBX_LIBtonezone=1
+         PBX_LIBZAPTEL=1
 
 cat &gt;&gt;confdefs.h &lt;&lt;_ACEOF
 #define HAVE_ZAPTEL 1
 _ACEOF
 
       fi
-   elif test ! -z &quot;${tonezone_MANDATORY}&quot;;
+   elif test ! -z &quot;${ZAPTEL_MANDATORY}&quot;;
    then
       echo &quot;***&quot;
       echo &quot;*** The Zaptel installation on this system appears to be broken.&quot;
@@ -14285,10 +15732,9 @@
 GSM_INTERNAL=&quot;yes&quot;
 GSM_SYSTEM=&quot;yes&quot;
 
-# Check whether --with-gsm or --without-gsm was given.
+# Check whether --with-gsm was given.
 if test &quot;${with_gsm+set}&quot; = set; then
-  withval=&quot;$with_gsm&quot;
-
+  withval=$with_gsm;
 case ${withval} in
      n|no)
      USE_GSM=no
@@ -14304,8 +15750,9 @@
      ;;
 esac
 
-fi;
+fi
 
+
 PBX_LIBgsm=0
 
 if test &quot;${USE_GSM}&quot; != &quot;no&quot;; then
@@ -14314,8 +15761,8 @@
       if test &quot;x${GSM_DIR}&quot; != &quot;x&quot;; then
          gsmlibdir=&quot;-L${GSM_DIR}/lib&quot;
       fi
-      echo &quot;$as_me:$LINENO: checking for gsm_create in -lgsm&quot; &gt;&amp;5
-echo $ECHO_N &quot;checking for gsm_create in -lgsm... $ECHO_C&quot; &gt;&amp;6
+      { echo &quot;$as_me:$LINENO: checking for gsm_create in -lgsm&quot; &gt;&amp;5
+echo $ECHO_N &quot;checking for gsm_create in -lgsm... $ECHO_C&quot; &gt;&amp;6; }
 if test &quot;${ac_cv_lib_gsm_gsm_create+set}&quot; = set; then
   echo $ECHO_N &quot;(cached) $ECHO_C&quot; &gt;&amp;6
 else
@@ -14328,17 +15775,17 @@
 cat &gt;&gt;conftest.$ac_ext &lt;&lt;_ACEOF
 /* end confdefs.h.  */
 
-/* Override any gcc2 internal prototype to avoid an error.  */
+/* Override any GCC internal prototype to avoid an error.
+   Use char because int might match the return type of a GCC
+   builtin and then its argument prototype would still apply.  */
 #ifdef __cplusplus
 extern &quot;C&quot;
 #endif
-/* We use char because int might match the return type of a gcc2
-   builtin and then its argument prototype would still apply.  */
 char gsm_create ();
 int
 main ()
 {
-gsm_create ();
+return gsm_create ();
   ;
   return 0;
 }
@@ -14370,14 +15817,15 @@
   echo &quot;$as_me: failed program was:&quot; &gt;&amp;5
 sed 's/^/| /' conftest.$ac_ext &gt;&amp;5
 
-ac_cv_lib_gsm_gsm_create=no
+	ac_cv_lib_gsm_gsm_create=no
 fi
+
 rm -f conftest.err conftest.$ac_objext \
       conftest$ac_exeext conftest.$ac_ext
 LIBS=$ac_check_lib_save_LIBS
 fi
-echo &quot;$as_me:$LINENO: result: $ac_cv_lib_gsm_gsm_create&quot; &gt;&amp;5
-echo &quot;${ECHO_T}$ac_cv_lib_gsm_gsm_create&quot; &gt;&amp;6
+{ echo &quot;$as_me:$LINENO: result: $ac_cv_lib_gsm_gsm_create&quot; &gt;&amp;5
+echo &quot;${ECHO_T}$ac_cv_lib_gsm_gsm_create&quot; &gt;&amp;6; }
 if test $ac_cv_lib_gsm_gsm_create = yes; then
 
 cat &gt;&gt;confdefs.h &lt;&lt;_ACEOF
@@ -14414,10 +15862,9 @@
 
 
 
-# Check whether --with-pq or --without-pq was given.
+# Check whether --with-pq was given.
 if test &quot;${with_pq+set}&quot; = set; then
-  withval=&quot;$with_pq&quot;
-
+  withval=$with_pq;
 case ${withval} in
      n|no)
      USE_PQ=no
@@ -14431,8 +15878,9 @@
      ;;
 esac
 
-fi;
+fi
 
+
 PBX_LIBpq=0
 PG_CONFIG=No
 if test &quot;${USE_PQ}&quot; != &quot;no&quot;; then
@@ -14440,8 +15888,8 @@
       if test -n &quot;$ac_tool_prefix&quot;; then
   # Extract the first word of &quot;${ac_tool_prefix}pg_config&quot;, so it can be a program name with args.
 set dummy ${ac_tool_prefix}pg_config; ac_word=$2
-echo &quot;$as_me:$LINENO: checking for $ac_word&quot; &gt;&amp;5
-echo $ECHO_N &quot;checking for $ac_word... $ECHO_C&quot; &gt;&amp;6
+{ echo &quot;$as_me:$LINENO: checking for $ac_word&quot; &gt;&amp;5
+echo $ECHO_N &quot;checking for $ac_word... $ECHO_C&quot; &gt;&amp;6; }
 if test &quot;${ac_cv_path_PG_CONFIG+set}&quot; = set; then
   echo $ECHO_N &quot;(cached) $ECHO_C&quot; &gt;&amp;6
 else
@@ -14456,34 +15904,35 @@
   IFS=$as_save_IFS
   test -z &quot;$as_dir&quot; &amp;&amp; as_dir=.
   for ac_exec_ext in '' $ac_executable_extensions; do
-  if $as_executable_p &quot;$as_dir/$ac_word$ac_exec_ext&quot;; then
+  if { test -f &quot;$as_dir/$ac_word$ac_exec_ext&quot; &amp;&amp; $as_executable_p &quot;$as_dir/$ac_word$ac_exec_ext&quot;; }; then
     ac_cv_path_PG_CONFIG=&quot;$as_dir/$ac_word$ac_exec_ext&quot;
     echo &quot;$as_me:$LINENO: found $as_dir/$ac_word$ac_exec_ext&quot; &gt;&amp;5
     break 2
   fi
 done
 done
+IFS=$as_save_IFS
 
   ;;
 esac
 fi
 PG_CONFIG=$ac_cv_path_PG_CONFIG
-
 if test -n &quot;$PG_CONFIG&quot;; then
-  echo &quot;$as_me:$LINENO: result: $PG_CONFIG&quot; &gt;&amp;5
-echo &quot;${ECHO_T}$PG_CONFIG&quot; &gt;&amp;6
+  { echo &quot;$as_me:$LINENO: result: $PG_CONFIG&quot; &gt;&amp;5
+echo &quot;${ECHO_T}$PG_CONFIG&quot; &gt;&amp;6; }
 else
-  echo &quot;$as_me:$LINENO: result: no&quot; &gt;&amp;5
-echo &quot;${ECHO_T}no&quot; &gt;&amp;6
+  { echo &quot;$as_me:$LINENO: result: no&quot; &gt;&amp;5
+echo &quot;${ECHO_T}no&quot; &gt;&amp;6; }
 fi
 
+
 fi
 if test -z &quot;$ac_cv_path_PG_CONFIG&quot;; then
   ac_pt_PG_CONFIG=$PG_CONFIG
   # Extract the first word of &quot;pg_config&quot;, so it can be a program name with args.
 set dummy pg_config; ac_word=$2
-echo &quot;$as_me:$LINENO: checking for $ac_word&quot; &gt;&amp;5
-echo $ECHO_N &quot;checking for $ac_word... $ECHO_C&quot; &gt;&amp;6
+{ echo &quot;$as_me:$LINENO: checking for $ac_word&quot; &gt;&amp;5
+echo $ECHO_N &quot;checking for $ac_word... $ECHO_C&quot; &gt;&amp;6; }
 if test &quot;${ac_cv_path_ac_pt_PG_CONFIG+set}&quot; = set; then
   echo $ECHO_N &quot;(cached) $ECHO_C&quot; &gt;&amp;6
 else
@@ -14498,29 +15947,42 @@
   IFS=$as_save_IFS
   test -z &quot;$as_dir&quot; &amp;&amp; as_dir=.
   for ac_exec_ext in '' $ac_executable_extensions; do
-  if $as_executable_p &quot;$as_dir/$ac_word$ac_exec_ext&quot;; then
+  if { test -f &quot;$as_dir/$ac_word$ac_exec_ext&quot; &amp;&amp; $as_executable_p &quot;$as_dir/$ac_word$ac_exec_ext&quot;; }; then
     ac_cv_path_ac_pt_PG_CONFIG=&quot;$as_dir/$ac_word$ac_exec_ext&quot;
     echo &quot;$as_me:$LINENO: found $as_dir/$ac_word$ac_exec_ext&quot; &gt;&amp;5
     break 2
   fi
 done
 done
+IFS=$as_save_IFS
 
-  test -z &quot;$ac_cv_path_ac_pt_PG_CONFIG&quot; &amp;&amp; ac_cv_path_ac_pt_PG_CONFIG=&quot;No&quot;
   ;;
 esac
 fi
 ac_pt_PG_CONFIG=$ac_cv_path_ac_pt_PG_CONFIG
-
 if test -n &quot;$ac_pt_PG_CONFIG&quot;; then
-  echo &quot;$as_me:$LINENO: result: $ac_pt_PG_CONFIG&quot; &gt;&amp;5
-echo &quot;${ECHO_T}$ac_pt_PG_CONFIG&quot; &gt;&amp;6
+  { echo &quot;$as_me:$LINENO: result: $ac_pt_PG_CONFIG&quot; &gt;&amp;5
+echo &quot;${ECHO_T}$ac_pt_PG_CONFIG&quot; &gt;&amp;6; }
 else
-  echo &quot;$as_me:$LINENO: result: no&quot; &gt;&amp;5
-echo &quot;${ECHO_T}no&quot; &gt;&amp;6
+  { echo &quot;$as_me:$LINENO: result: no&quot; &gt;&amp;5
+echo &quot;${ECHO_T}no&quot; &gt;&amp;6; }
 fi
 
-  PG_CONFIG=$ac_pt_PG_CONFIG
+  if test &quot;x$ac_pt_PG_CONFIG&quot; = x; then
+    PG_CONFIG=&quot;No&quot;
+  else
+    case $cross_compiling:$ac_tool_warned in
+yes:)
+{ echo &quot;$as_me:$LINENO: WARNING: In the future, Autoconf will not detect cross-tools
+whose name does not start with the host triplet.  If you think this
+configuration is useful to you, please write to <A HREF="https://lists.berlios.de/mailman/listinfo/solid-pbx-svn">autoconf at gnu.org.</A>&quot; &gt;&amp;5
+echo &quot;$as_me: WARNING: In the future, Autoconf will not detect cross-tools
+whose name does not start with the host triplet.  If you think this
+configuration is useful to you, please write to <A HREF="https://lists.berlios.de/mailman/listinfo/solid-pbx-svn">autoconf at gnu.org.</A>&quot; &gt;&amp;2;}
+ac_tool_warned=yes ;;
+esac
+    PG_CONFIG=$ac_pt_PG_CONFIG
+  fi
 else
   PG_CONFIG=&quot;$ac_cv_path_PG_CONFIG&quot;
 fi
@@ -14537,8 +15999,8 @@
       if test -n &quot;$ac_tool_prefix&quot;; then
   # Extract the first word of &quot;${ac_tool_prefix}pg_config&quot;, so it can be a program name with args.
 set dummy ${ac_tool_prefix}pg_config; ac_word=$2
-echo &quot;$as_me:$LINENO: checking for $ac_word&quot; &gt;&amp;5
-echo $ECHO_N &quot;checking for $ac_word... $ECHO_C&quot; &gt;&amp;6
+{ echo &quot;$as_me:$LINENO: checking for $ac_word&quot; &gt;&amp;5
+echo $ECHO_N &quot;checking for $ac_word... $ECHO_C&quot; &gt;&amp;6; }
 if test &quot;${ac_cv_path_PG_CONFIG+set}&quot; = set; then
   echo $ECHO_N &quot;(cached) $ECHO_C&quot; &gt;&amp;6
 else
@@ -14553,34 +16015,35 @@
   IFS=$as_save_IFS
   test -z &quot;$as_dir&quot; &amp;&amp; as_dir=.
   for ac_exec_ext in '' $ac_executable_extensions; do
-  if $as_executable_p &quot;$as_dir/$ac_word$ac_exec_ext&quot;; then
+  if { test -f &quot;$as_dir/$ac_word$ac_exec_ext&quot; &amp;&amp; $as_executable_p &quot;$as_dir/$ac_word$ac_exec_ext&quot;; }; then
     ac_cv_path_PG_CONFIG=&quot;$as_dir/$ac_word$ac_exec_ext&quot;
     echo &quot;$as_me:$LINENO: found $as_dir/$ac_word$ac_exec_ext&quot; &gt;&amp;5
     break 2
   fi
 done
 done
+IFS=$as_save_IFS
 
   ;;
 esac
 fi
 PG_CONFIG=$ac_cv_path_PG_CONFIG
-
 if test -n &quot;$PG_CONFIG&quot;; then
-  echo &quot;$as_me:$LINENO: result: $PG_CONFIG&quot; &gt;&amp;5
-echo &quot;${ECHO_T}$PG_CONFIG&quot; &gt;&amp;6
+  { echo &quot;$as_me:$LINENO: result: $PG_CONFIG&quot; &gt;&amp;5
+echo &quot;${ECHO_T}$PG_CONFIG&quot; &gt;&amp;6; }
 else
-  echo &quot;$as_me:$LINENO: result: no&quot; &gt;&amp;5
-echo &quot;${ECHO_T}no&quot; &gt;&amp;6
+  { echo &quot;$as_me:$LINENO: result: no&quot; &gt;&amp;5
+echo &quot;${ECHO_T}no&quot; &gt;&amp;6; }
 fi
 
+
 fi
 if test -z &quot;$ac_cv_path_PG_CONFIG&quot;; then
   ac_pt_PG_CONFIG=$PG_CONFIG
   # Extract the first word of &quot;pg_config&quot;, so it can be a program name with args.
 set dummy pg_config; ac_word=$2
-echo &quot;$as_me:$LINENO: checking for $ac_word&quot; &gt;&amp;5
-echo $ECHO_N &quot;checking for $ac_word... $ECHO_C&quot; &gt;&amp;6
+{ echo &quot;$as_me:$LINENO: checking for $ac_word&quot; &gt;&amp;5
+echo $ECHO_N &quot;checking for $ac_word... $ECHO_C&quot; &gt;&amp;6; }
 if test &quot;${ac_cv_path_ac_pt_PG_CONFIG+set}&quot; = set; then
   echo $ECHO_N &quot;(cached) $ECHO_C&quot; &gt;&amp;6
 else
@@ -14595,29 +16058,42 @@
   IFS=$as_save_IFS
   test -z &quot;$as_dir&quot; &amp;&amp; as_dir=.
   for ac_exec_ext in '' $ac_executable_extensions; do
-  if $as_executable_p &quot;$as_dir/$ac_word$ac_exec_ext&quot;; then
+  if { test -f &quot;$as_dir/$ac_word$ac_exec_ext&quot; &amp;&amp; $as_executable_p &quot;$as_dir/$ac_word$ac_exec_ext&quot;; }; then
     ac_cv_path_ac_pt_PG_CONFIG=&quot;$as_dir/$ac_word$ac_exec_ext&quot;
     echo &quot;$as_me:$LINENO: found $as_dir/$ac_word$ac_exec_ext&quot; &gt;&amp;5
     break 2
   fi
 done
 done
+IFS=$as_save_IFS
 
-  test -z &quot;$ac_cv_path_ac_pt_PG_CONFIG&quot; &amp;&amp; ac_cv_path_ac_pt_PG_CONFIG=&quot;No&quot;
   ;;
 esac
 fi
 ac_pt_PG_CONFIG=$ac_cv_path_ac_pt_PG_CONFIG
-
 if test -n &quot;$ac_pt_PG_CONFIG&quot;; then
-  echo &quot;$as_me:$LINENO: result: $ac_pt_PG_CONFIG&quot; &gt;&amp;5
-echo &quot;${ECHO_T}$ac_pt_PG_CONFIG&quot; &gt;&amp;6
+  { echo &quot;$as_me:$LINENO: result: $ac_pt_PG_CONFIG&quot; &gt;&amp;5
+echo &quot;${ECHO_T}$ac_pt_PG_CONFIG&quot; &gt;&amp;6; }
 else
-  echo &quot;$as_me:$LINENO: result: no&quot; &gt;&amp;5
-echo &quot;${ECHO_T}no&quot; &gt;&amp;6
+  { echo &quot;$as_me:$LINENO: result: no&quot; &gt;&amp;5
+echo &quot;${ECHO_T}no&quot; &gt;&amp;6; }
 fi
 
-  PG_CONFIG=$ac_pt_PG_CONFIG
+  if test &quot;x$ac_pt_PG_CONFIG&quot; = x; then
+    PG_CONFIG=&quot;No&quot;
+  else
+    case $cross_compiling:$ac_tool_warned in
+yes:)
+{ echo &quot;$as_me:$LINENO: WARNING: In the future, Autoconf will not detect cross-tools
+whose name does not start with the host triplet.  If you think this
+configuration is useful to you, please write to <A HREF="https://lists.berlios.de/mailman/listinfo/solid-pbx-svn">autoconf at gnu.org.</A>&quot; &gt;&amp;5
+echo &quot;$as_me: WARNING: In the future, Autoconf will not detect cross-tools
+whose name does not start with the host triplet.  If you think this
+configuration is useful to you, please write to <A HREF="https://lists.berlios.de/mailman/listinfo/solid-pbx-svn">autoconf at gnu.org.</A>&quot; &gt;&amp;2;}
+ac_tool_warned=yes ;;
+esac
+    PG_CONFIG=$ac_pt_PG_CONFIG
+  fi
 else
   PG_CONFIG=&quot;$ac_cv_path_PG_CONFIG&quot;
 fi
@@ -14629,8 +16105,8 @@
    PQ_libdir=`pg_config --libdir`
    PQ_includedir=`pg_config --includedir`
 
-   echo &quot;$as_me:$LINENO: checking for PQexec in -lpq&quot; &gt;&amp;5
-echo $ECHO_N &quot;checking for PQexec in -lpq... $ECHO_C&quot; &gt;&amp;6
+   { echo &quot;$as_me:$LINENO: checking for PQexec in -lpq&quot; &gt;&amp;5
+echo $ECHO_N &quot;checking for PQexec in -lpq... $ECHO_C&quot; &gt;&amp;6; }
 if test &quot;${ac_cv_lib_pq_PQexec+set}&quot; = set; then
   echo $ECHO_N &quot;(cached) $ECHO_C&quot; &gt;&amp;6
 else
@@ -14643,17 +16119,17 @@
 cat &gt;&gt;conftest.$ac_ext &lt;&lt;_ACEOF
 /* end confdefs.h.  */
 
-/* Override any gcc2 internal prototype to avoid an error.  */
+/* Override any GCC internal prototype to avoid an error.
+   Use char because int might match the return type of a GCC
+   builtin and then its argument prototype would still apply.  */
 #ifdef __cplusplus
 extern &quot;C&quot;
 #endif
-/* We use char because int might match the return type of a gcc2
-   builtin and then its argument prototype would still apply.  */
 char PQexec ();
 int
 main ()
 {
-PQexec ();
+return PQexec ();
   ;
   return 0;
 }
@@ -14685,14 +16161,15 @@
   echo &quot;$as_me: failed program was:&quot; &gt;&amp;5
 sed 's/^/| /' conftest.$ac_ext &gt;&amp;5
 
-ac_cv_lib_pq_PQexec=no
+	ac_cv_lib_pq_PQexec=no
 fi
+
 rm -f conftest.err conftest.$ac_objext \
       conftest$ac_exeext conftest.$ac_ext
 LIBS=$ac_check_lib_save_LIBS
 fi
-echo &quot;$as_me:$LINENO: result: $ac_cv_lib_pq_PQexec&quot; &gt;&amp;5
-echo &quot;${ECHO_T}$ac_cv_lib_pq_PQexec&quot; &gt;&amp;6
+{ echo &quot;$as_me:$LINENO: result: $ac_cv_lib_pq_PQexec&quot; &gt;&amp;5
+echo &quot;${ECHO_T}$ac_cv_lib_pq_PQexec&quot; &gt;&amp;6; }
 if test $ac_cv_lib_pq_PQexec = yes; then
 
 cat &gt;&gt;confdefs.h &lt;&lt;_ACEOF
@@ -16673,9 +18150,10 @@
 
   ac_header_preproc=no
 fi
+
 rm -f conftest.err conftest.$ac_ext
-echo &quot;$as_me:$LINENO: result: $ac_header_preproc&quot; &gt;&amp;5
-echo &quot;${ECHO_T}$ac_header_preproc&quot; &gt;&amp;6
+{ echo &quot;$as_me:$LINENO: result: $ac_header_preproc&quot; &gt;&amp;5
+echo &quot;${ECHO_T}$ac_header_preproc&quot; &gt;&amp;6; }
 
 # So?  What about this header?
 case $ac_header_compiler:$ac_header_preproc:$ac_c_preproc_warn_flag in
@@ -18639,30 +20117,24 @@
 
 #undef $ac_func
 
-/* Override any gcc2 internal prototype to avoid an error.  */
+/* Override any GCC internal prototype to avoid an error.
+   Use char because int might match the return type of a GCC
+   builtin and then its argument prototype would still apply.  */
 #ifdef __cplusplus
 extern &quot;C&quot;
-{
 #endif
-/* We use char because int might match the return type of a gcc2
-   builtin and then its argument prototype would still apply.  */
 char $ac_func ();
 /* The GNU C library defines this for functions which it implements
     to always fail with ENOSYS.  Some functions are actually named
     something starting with __ and the normal name is an alias.  */
-#if defined (__stub_$ac_func) || defined (__stub___$ac_func)
+#if defined __stub_$ac_func || defined __stub___$ac_func
 choke me
-#else
-char (*f) () = $ac_func;
 #endif
-#ifdef __cplusplus
-}
-#endif
 
 int
 main ()
 {
-return f != $ac_func;
+return $ac_func ();
   ;
   return 0;
 }
@@ -19224,18 +20696,19 @@
 for ac_header in stdlib.h
 do
 as_ac_Header=`echo &quot;ac_cv_header_$ac_header&quot; | $as_tr_sh`
-if eval &quot;test \&quot;\${$as_ac_Header+set}\&quot; = set&quot;; then
-  echo &quot;$as_me:$LINENO: checking for $ac_header&quot; &gt;&amp;5
-echo $ECHO_N &quot;checking for $ac_header... $ECHO_C&quot; &gt;&amp;6
-if eval &quot;test \&quot;\${$as_ac_Header+set}\&quot; = set&quot;; then
+if { as_var=$as_ac_Header; eval &quot;test \&quot;\${$as_var+set}\&quot; = set&quot;; }; then
+  { echo &quot;$as_me:$LINENO: checking for $ac_header&quot; &gt;&amp;5
+echo $ECHO_N &quot;checking for $ac_header... $ECHO_C&quot; &gt;&amp;6; }
+if { as_var=$as_ac_Header; eval &quot;test \&quot;\${$as_var+set}\&quot; = set&quot;; }; then
   echo $ECHO_N &quot;(cached) $ECHO_C&quot; &gt;&amp;6
 fi
-echo &quot;$as_me:$LINENO: result: `eval echo '${'$as_ac_Header'}'`&quot; &gt;&amp;5
-echo &quot;${ECHO_T}`eval echo '${'$as_ac_Header'}'`&quot; &gt;&amp;6
+ac_res=`eval echo '${'$as_ac_Header'}'`
+	       { echo &quot;$as_me:$LINENO: result: $ac_res&quot; &gt;&amp;5
+echo &quot;${ECHO_T}$ac_res&quot; &gt;&amp;6; }
 else
   # Is the header compilable?
-echo &quot;$as_me:$LINENO: checking $ac_header usability&quot; &gt;&amp;5
-echo $ECHO_N &quot;checking $ac_header usability... $ECHO_C&quot; &gt;&amp;6
+{ echo &quot;$as_me:$LINENO: checking $ac_header usability&quot; &gt;&amp;5
+echo $ECHO_N &quot;checking $ac_header usability... $ECHO_C&quot; &gt;&amp;6; }
 cat &gt;conftest.$ac_ext &lt;&lt;_ACEOF
 /* confdefs.h.  */
 _ACEOF
@@ -19272,15 +20745,16 @@
   echo &quot;$as_me: failed program was:&quot; &gt;&amp;5
 sed 's/^/| /' conftest.$ac_ext &gt;&amp;5
 
-ac_header_compiler=no
+	ac_header_compiler=no
 fi
+
 rm -f conftest.err conftest.$ac_objext conftest.$ac_ext
-echo &quot;$as_me:$LINENO: result: $ac_header_compiler&quot; &gt;&amp;5
-echo &quot;${ECHO_T}$ac_header_compiler&quot; &gt;&amp;6
+{ echo &quot;$as_me:$LINENO: result: $ac_header_compiler&quot; &gt;&amp;5
+echo &quot;${ECHO_T}$ac_header_compiler&quot; &gt;&amp;6; }
 
 # Is the header present?
-echo &quot;$as_me:$LINENO: checking $ac_header presence&quot; &gt;&amp;5
-echo $ECHO_N &quot;checking $ac_header presence... $ECHO_C&quot; &gt;&amp;6
+{ echo &quot;$as_me:$LINENO: checking $ac_header presence&quot; &gt;&amp;5
+echo $ECHO_N &quot;checking $ac_header presence... $ECHO_C&quot; &gt;&amp;6; }
 cat &gt;conftest.$ac_ext &lt;&lt;_ACEOF
 /* confdefs.h.  */
 _ACEOF
@@ -19314,9 +20788,10 @@
 
   ac_header_preproc=no
 fi
+
 rm -f conftest.err conftest.$ac_ext
-echo &quot;$as_me:$LINENO: result: $ac_header_preproc&quot; &gt;&amp;5
-echo &quot;${ECHO_T}$ac_header_preproc&quot; &gt;&amp;6
+{ echo &quot;$as_me:$LINENO: result: $ac_header_preproc&quot; &gt;&amp;5
+echo &quot;${ECHO_T}$ac_header_preproc&quot; &gt;&amp;6; }
 
 # So?  What about this header?
 case $ac_header_compiler:$ac_header_preproc:$ac_c_preproc_warn_flag in
@@ -19340,25 +20815,19 @@
 echo &quot;$as_me: WARNING: $ac_header: proceeding with the preprocessor's result&quot; &gt;&amp;2;}
     { echo &quot;$as_me:$LINENO: WARNING: $ac_header: in the future, the compiler will take precedence&quot; &gt;&amp;5
 echo &quot;$as_me: WARNING: $ac_header: in the future, the compiler will take precedence&quot; &gt;&amp;2;}
-    (
-      cat &lt;&lt;\_ASBOX
-## ------------------------------------------ ##
-## Report this to the AC_PACKAGE_NAME lists.  ##
-## ------------------------------------------ ##
-_ASBOX
-    ) |
-      sed &quot;s/^/$as_me: WARNING:     /&quot; &gt;&amp;2
+
     ;;
 esac
-echo &quot;$as_me:$LINENO: checking for $ac_header&quot; &gt;&amp;5
-echo $ECHO_N &quot;checking for $ac_header... $ECHO_C&quot; &gt;&amp;6
-if eval &quot;test \&quot;\${$as_ac_Header+set}\&quot; = set&quot;; then
+{ echo &quot;$as_me:$LINENO: checking for $ac_header&quot; &gt;&amp;5
+echo $ECHO_N &quot;checking for $ac_header... $ECHO_C&quot; &gt;&amp;6; }
+if { as_var=$as_ac_Header; eval &quot;test \&quot;\${$as_var+set}\&quot; = set&quot;; }; then
   echo $ECHO_N &quot;(cached) $ECHO_C&quot; &gt;&amp;6
 else
   eval &quot;$as_ac_Header=\$ac_header_preproc&quot;
 fi
-echo &quot;$as_me:$LINENO: result: `eval echo '${'$as_ac_Header'}'`&quot; &gt;&amp;5
-echo &quot;${ECHO_T}`eval echo '${'$as_ac_Header'}'`&quot; &gt;&amp;6
+ac_res=`eval echo '${'$as_ac_Header'}'`
+	       { echo &quot;$as_me:$LINENO: result: $ac_res&quot; &gt;&amp;5
+echo &quot;${ECHO_T}$ac_res&quot; &gt;&amp;6; }
 
 fi
 if test `eval echo '${'$as_ac_Header'}'` = yes; then
@@ -20976,7 +22445,9 @@
   echo &quot;$as_me: failed program was:&quot; &gt;&amp;5
 sed 's/^/| /' conftest.$ac_ext &gt;&amp;5
 
+
 fi
+
 rm -f conftest.err conftest.$ac_objext conftest.$ac_ext
   done
  done
@@ -21925,7 +23396,7 @@
   echo &quot;$as_me: failed program was:&quot; &gt;&amp;5
 sed 's/^/| /' conftest.$ac_ext &gt;&amp;5
 
-cat &gt;conftest.$ac_ext &lt;&lt;_ACEOF
+	cat &gt;conftest.$ac_ext &lt;&lt;_ACEOF
 /* confdefs.h.  */
 _ACEOF
 cat confdefs.h &gt;&gt;conftest.$ac_ext
@@ -22488,9 +23959,9 @@
 for ac_func in atexit bzero dup2 endpwent floor ftruncate getcwd gethostbyname gethostname gettimeofday inet_ntoa isascii localtime_r memchr memmove memset mkdir munmap pow putenv re_comp regcomp rint select setenv socket sqrt strcasecmp strchr strcspn strdup strerror strncasecmp strndup strrchr strsep strspn strstr strtol unsetenv utime strtoq strcasestr asprintf vasprintf
 do
 as_ac_var=`echo &quot;ac_cv_func_$ac_func&quot; | $as_tr_sh`
-echo &quot;$as_me:$LINENO: checking for $ac_func&quot; &gt;&amp;5
-echo $ECHO_N &quot;checking for $ac_func... $ECHO_C&quot; &gt;&amp;6
-if eval &quot;test \&quot;\${$as_ac_var+set}\&quot; = set&quot;; then
+{ echo &quot;$as_me:$LINENO: checking for $ac_func&quot; &gt;&amp;5
+echo $ECHO_N &quot;checking for $ac_func... $ECHO_C&quot; &gt;&amp;6; }
+if { as_var=$as_ac_var; eval &quot;test \&quot;\${$as_var+set}\&quot; = set&quot;; }; then
   echo $ECHO_N &quot;(cached) $ECHO_C&quot; &gt;&amp;6
 else
   cat &gt;conftest.$ac_ext &lt;&lt;_ACEOF
@@ -22516,30 +23987,24 @@
 
 #undef $ac_func
 
-/* Override any gcc2 internal prototype to avoid an error.  */
+/* Override any GCC internal prototype to avoid an error.
+   Use char because int might match the return type of a GCC
+   builtin and then its argument prototype would still apply.  */
 #ifdef __cplusplus
 extern &quot;C&quot;
-{
 #endif
-/* We use char because int might match the return type of a gcc2
-   builtin and then its argument prototype would still apply.  */
 char $ac_func ();
 /* The GNU C library defines this for functions which it implements
     to always fail with ENOSYS.  Some functions are actually named
     something starting with __ and the normal name is an alias.  */
-#if defined (__stub_$ac_func) || defined (__stub___$ac_func)
+#if defined __stub_$ac_func || defined __stub___$ac_func
 choke me
-#else
-char (*f) () = $ac_func;
 #endif
-#ifdef __cplusplus
-}
-#endif
 
 int
 main ()
 {
-return f != $ac_func;
+return $ac_func ();
   ;
   return 0;
 }
@@ -22642,7 +24107,7 @@
 done
 
 
-                    ac_config_files=&quot;$ac_config_files build_tools/menuselect-deps makeopts&quot;
+ac_config_files=&quot;$ac_config_files build_tools/menuselect-deps makeopts&quot;
 
 cat &gt;confcache &lt;&lt;\_ACEOF
 # This file is a shell script that caches the results of configure
@@ -22662,39 +24127,58 @@
 
 # The following way of writing the cache mishandles newlines in values,
 # but we know of no workaround that is simple, portable, and efficient.
-# So, don't put newlines in cache variables' values.
+# So, we kill variables containing newlines.
 # Ultrix sh set writes to stderr and can't be redirected directly,
 # and sets the high bit in the cache file unless we assign to the vars.
-{
+(
+  for ac_var in `(set) 2&gt;&amp;1 | sed -n 's/^\([a-zA-Z_][a-zA-Z0-9_]*\)=.*/\1/p'`; do
+    eval ac_val=\$$ac_var
+    case $ac_val in #(
+    *${as_nl}*)
+      case $ac_var in #(
+      *_cv_*) { echo &quot;$as_me:$LINENO: WARNING: Cache variable $ac_var contains a newline.&quot; &gt;&amp;5
+echo &quot;$as_me: WARNING: Cache variable $ac_var contains a newline.&quot; &gt;&amp;2;} ;;
+      esac
+      case $ac_var in #(
+      _ | IFS | as_nl) ;; #(
+      *) $as_unset $ac_var ;;
+      esac ;;
+    esac
+  done
+
   (set) 2&gt;&amp;1 |
-    case `(ac_space=' '; set | grep ac_space) 2&gt;&amp;1` in
-    *ac_space=\ *)
+    case $as_nl`(ac_space=' '; set) 2&gt;&amp;1` in #(
+    *${as_nl}ac_space=\ *)
       # `set' does not quote correctly, so add quotes (double-quote
       # substitution turns \\\\ into \\, and sed turns \\ into \).
       sed -n \
 	&quot;s/'/'\\\\''/g;
 	  s/^\\([_$as_cr_alnum]*_cv_[_$as_cr_alnum]*\\)=\\(.*\\)/\\1='\\2'/p&quot;
-      ;;
+      ;; #(
     *)
       # `set' quotes correctly as required by POSIX, so do not add quotes.
-      sed -n \
-	&quot;s/^\\([_$as_cr_alnum]*_cv_[_$as_cr_alnum]*\\)=\\(.*\\)/\\1=\\2/p&quot;
+      sed -n &quot;/^[_$as_cr_alnum]*_cv_[_$as_cr_alnum]*=/p&quot;
       ;;
-    esac;
-} |
+    esac |
+    sort
+) |
   sed '
+     /^ac_cv_env_/b end
      t clear
-     : clear
+     :clear
      s/^\([^=]*\)=\(.*[{}].*\)$/test &quot;${\1+set}&quot; = set || &amp;/
      t end
-     /^ac_cv_env/!s/^\([^=]*\)=\(.*\)$/\1=${\1=\2}/
-     : end' &gt;&gt;confcache
+     s/^\([^=]*\)=\(.*\)$/\1=${\1=\2}/
+     :end' &gt;&gt;confcache
 if diff $cache_file confcache &gt;/dev/null 2&gt;&amp;1; then :; else
   if test -w $cache_file; then
-    test &quot;x$cache_file&quot; != &quot;x/dev/null&quot; &amp;&amp; echo &quot;updating cache $cache_file&quot;
+    test &quot;x$cache_file&quot; != &quot;x/dev/null&quot; &amp;&amp;
+      { echo &quot;$as_me:$LINENO: updating cache $cache_file&quot; &gt;&amp;5
+echo &quot;$as_me: updating cache $cache_file&quot; &gt;&amp;6;}
     cat confcache &gt;$cache_file
   else
-    echo &quot;not updating unwritable cache $cache_file&quot;
+    { echo &quot;$as_me:$LINENO: not updating unwritable cache $cache_file&quot; &gt;&amp;5
+echo &quot;$as_me: not updating unwritable cache $cache_file&quot; &gt;&amp;6;}
   fi
 fi
 rm -f confcache
@@ -22703,32 +24187,18 @@
 # Let make expand exec_prefix.
 test &quot;x$exec_prefix&quot; = xNONE &amp;&amp; exec_prefix='${prefix}'
 
-# VPATH may cause trouble with some makes, so we remove $(srcdir),
-# ${srcdir} and @srcdir@ from VPATH if srcdir is &quot;.&quot;, strip leading and
-# trailing colons and then remove the whole line if VPATH becomes empty
-# (actually we leave an empty line to preserve line numbers).
-if test &quot;x$srcdir&quot; = x.; then
-  ac_vpsub='/^[	 ]*VPATH[	 ]*=/{
-s/:*\$(srcdir):*/:/;
-s/:*\${srcdir}:*/:/;
-s/:*@srcdir@:*/:/;
-s/^\([^=]*=[	 ]*\):*/\1/;
-s/:*$//;
-s/^[^=]*=[	 ]*$//;
-}'
-fi
-
 DEFS=-DHAVE_CONFIG_H
 
 ac_libobjs=
 ac_ltlibobjs=
 for ac_i in : $LIBOBJS; do test &quot;x$ac_i&quot; = x: &amp;&amp; continue
   # 1. Remove the extension, and $U if already installed.
-  ac_i=`echo &quot;$ac_i&quot; |
-	 sed 's/\$U\././;s/\.o$//;s/\.obj$//'`
-  # 2. Add them.
-  ac_libobjs=&quot;$ac_libobjs $ac_i\$U.$ac_objext&quot;
-  ac_ltlibobjs=&quot;$ac_ltlibobjs $ac_i&quot;'$U.lo'
+  ac_script='s/\$U\././;s/\.o$//;s/\.obj$//'
+  ac_i=`echo &quot;$ac_i&quot; | sed &quot;$ac_script&quot;`
+  # 2. Prepend LIBOBJDIR.  When used with automake&gt;=1.10 LIBOBJDIR
+  #    will be set to the directory where LIBOBJS objects are built.
+  ac_libobjs=&quot;$ac_libobjs \${LIBOBJDIR}$ac_i\$U.$ac_objext&quot;
+  ac_ltlibobjs=&quot;$ac_ltlibobjs \${LIBOBJDIR}$ac_i&quot;'$U.lo'
 done
 LIBOBJS=$ac_libobjs
 
@@ -22766,11 +24236,35 @@
   # Zsh 3.x and 4.x performs word splitting on ${1+&quot;$@&quot;}, which
   # is contrary to our usage.  Disable this feature.
   alias -g '${1+&quot;$@&quot;}'='&quot;$@&quot;'
-elif test -n &quot;${BASH_VERSION+set}&quot; &amp;&amp; (set -o posix) &gt;/dev/null 2&gt;&amp;1; then
-  set -o posix
+  setopt NO_GLOB_SUBST
+else
+  case `(set -o) 2&gt;/dev/null` in *posix*) set -o posix;; esac
 fi
+BIN_SH=xpg4; export BIN_SH # for Tru64
 DUALCASE=1; export DUALCASE # for MKS sh
 
+
+# PATH needs CR
+# Avoid depending upon Character Ranges.
+as_cr_letters='abcdefghijklmnopqrstuvwxyz'
+as_cr_LETTERS='ABCDEFGHIJKLMNOPQRSTUVWXYZ'
+as_cr_Letters=$as_cr_letters$as_cr_LETTERS
+as_cr_digits='0123456789'
+as_cr_alnum=$as_cr_Letters$as_cr_digits
+
+# The user is always right.
+if test &quot;${PATH_SEPARATOR+set}&quot; != set; then
+  echo &quot;#! /bin/sh&quot; &gt;conf$$.sh
+  echo  &quot;exit 0&quot;   &gt;&gt;conf$$.sh
+  chmod +x conf$$.sh
+  if (PATH=&quot;/nonexistent;.&quot;; conf$$.sh) &gt;/dev/null 2&gt;&amp;1; then
+    PATH_SEPARATOR=';'
+  else
+    PATH_SEPARATOR=:
+  fi
+  rm -f conf$$.sh
+fi
+
 # Support unset when possible.
 if ( (MAIL=60; unset MAIL) || exit) &gt;/dev/null 2&gt;&amp;1; then
   as_unset=unset
@@ -22779,8 +24273,43 @@
 fi
 
 
+# IFS
+# We need space, tab and new line, in precisely that order.  Quoting is
+# there to prevent editors from complaining about space-tab.
+# (If _AS_PATH_WALK were called with IFS unset, it would disable word
+# splitting by setting IFS to empty value.)
+as_nl='
+'
+IFS=&quot; &quot;&quot;	$as_nl&quot;
+
+# Find who we are.  Look in the path if we contain no directory separator.
+case $0 in
+  *[\\/]* ) as_myself=$0 ;;
+  *) as_save_IFS=$IFS; IFS=$PATH_SEPARATOR
+for as_dir in $PATH
+do
+  IFS=$as_save_IFS
+  test -z &quot;$as_dir&quot; &amp;&amp; as_dir=.
+  test -r &quot;$as_dir/$0&quot; &amp;&amp; as_myself=$as_dir/$0 &amp;&amp; break
+done
+IFS=$as_save_IFS
+
+     ;;
+esac
+# We did not find ourselves, most probably we were run as `sh COMMAND'
+# in which case we are not to be found in the path.
+if test &quot;x$as_myself&quot; = x; then
+  as_myself=$0
+fi
+if test ! -f &quot;$as_myself&quot;; then
+  echo &quot;$as_myself: error: cannot find myself; rerun with an absolute file name&quot; &gt;&amp;2
+  { (exit 1); exit 1; }
+fi
+
 # Work around bugs in pre-3.0 UWIN ksh.
-$as_unset ENV MAIL MAILPATH
+for as_var in ENV MAIL MAILPATH
+do ($as_unset $as_var) &gt;/dev/null 2&gt;&amp;1 &amp;&amp; $as_unset $as_var
+done
 PS1='$ '
 PS2='&gt; '
 PS4='+ '
@@ -22794,18 +24323,19 @@
   if (set +x; test -z &quot;`(eval $as_var=C; export $as_var) 2&gt;&amp;1`&quot;); then
     eval $as_var=C; export $as_var
   else
-    $as_unset $as_var
+    ($as_unset $as_var) &gt;/dev/null 2&gt;&amp;1 &amp;&amp; $as_unset $as_var
   fi
 done
 
 # Required to use basename.
-if expr a : '\(a\)' &gt;/dev/null 2&gt;&amp;1; then
+if expr a : '\(a\)' &gt;/dev/null 2&gt;&amp;1 &amp;&amp;
+   test &quot;X`expr 00001 : '.*\(...\)'`&quot; = X001; then
   as_expr=expr
 else
   as_expr=false
 fi
 
-if (basename /) &gt;/dev/null 2&gt;&amp;1 &amp;&amp; test &quot;X`basename / 2&gt;&amp;1`&quot; = &quot;X/&quot;; then
+if (basename -- /) &gt;/dev/null 2&gt;&amp;1 &amp;&amp; test &quot;X`basename -- / 2&gt;&amp;1`&quot; = &quot;X/&quot;; then
   as_basename=basename
 else
   as_basename=false
@@ -22813,159 +24343,120 @@
 
 
 # Name of the executable.
-as_me=`$as_basename &quot;$0&quot; ||
+as_me=`$as_basename -- &quot;$0&quot; ||
 $as_expr X/&quot;$0&quot; : '.*/\([^/][^/]*\)/*$' \| \
 	 X&quot;$0&quot; : 'X\(//\)$' \| \
-	 X&quot;$0&quot; : 'X\(/\)$' \| \
-	 .     : '\(.\)' 2&gt;/dev/null ||
+	 X&quot;$0&quot; : 'X\(/\)' \| . 2&gt;/dev/null ||
 echo X/&quot;$0&quot; |
-    sed '/^.*\/\([^/][^/]*\)\/*$/{ s//\1/; q; }
-  	  /^X\/\(\/\/\)$/{ s//\1/; q; }
-  	  /^X\/\(\/\).*/{ s//\1/; q; }
-  	  s/.*/./; q'`
+    sed '/^.*\/\([^/][^/]*\)\/*$/{
+	    s//\1/
+	    q
+	  }
+	  /^X\/\(\/\/\)$/{
+	    s//\1/
+	    q
+	  }
+	  /^X\/\(\/\).*/{
+	    s//\1/
+	    q
+	  }
+	  s/.*/./; q'`
 
+# CDPATH.
+$as_unset CDPATH
 
-# PATH needs CR, and LINENO needs CR and PATH.
-# Avoid depending upon Character Ranges.
-as_cr_letters='abcdefghijklmnopqrstuvwxyz'
-as_cr_LETTERS='ABCDEFGHIJKLMNOPQRSTUVWXYZ'
-as_cr_Letters=$as_cr_letters$as_cr_LETTERS
-as_cr_digits='0123456789'
-as_cr_alnum=$as_cr_Letters$as_cr_digits
 
-# The user is always right.
-if test &quot;${PATH_SEPARATOR+set}&quot; != set; then
-  echo &quot;#! /bin/sh&quot; &gt;conf$$.sh
-  echo  &quot;exit 0&quot;   &gt;&gt;conf$$.sh
-  chmod +x conf$$.sh
-  if (PATH=&quot;/nonexistent;.&quot;; conf$$.sh) &gt;/dev/null 2&gt;&amp;1; then
-    PATH_SEPARATOR=';'
-  else
-    PATH_SEPARATOR=:
-  fi
-  rm -f conf$$.sh
-fi
 
-
   as_lineno_1=$LINENO
   as_lineno_2=$LINENO
-  as_lineno_3=`(expr $as_lineno_1 + 1) 2&gt;/dev/null`
   test &quot;x$as_lineno_1&quot; != &quot;x$as_lineno_2&quot; &amp;&amp;
-  test &quot;x$as_lineno_3&quot;  = &quot;x$as_lineno_2&quot;  || {
-  # Find who we are.  Look in the path if we contain no path at all
-  # relative or not.
-  case $0 in
-    *[\\/]* ) as_myself=$0 ;;
-    *) as_save_IFS=$IFS; IFS=$PATH_SEPARATOR
-for as_dir in $PATH
-do
-  IFS=$as_save_IFS
-  test -z &quot;$as_dir&quot; &amp;&amp; as_dir=.
-  test -r &quot;$as_dir/$0&quot; &amp;&amp; as_myself=$as_dir/$0 &amp;&amp; break
-done
+  test &quot;x`expr $as_lineno_1 + 1`&quot; = &quot;x$as_lineno_2&quot; || {
 
-       ;;
-  esac
-  # We did not find ourselves, most probably we were run as `sh COMMAND'
-  # in which case we are not to be found in the path.
-  if test &quot;x$as_myself&quot; = x; then
-    as_myself=$0
-  fi
-  if test ! -f &quot;$as_myself&quot;; then
-    { { echo &quot;$as_me:$LINENO: error: cannot find myself; rerun with an absolute path&quot; &gt;&amp;5
-echo &quot;$as_me: error: cannot find myself; rerun with an absolute path&quot; &gt;&amp;2;}
-   { (exit 1); exit 1; }; }
-  fi
-  case $CONFIG_SHELL in
-  '')
-    as_save_IFS=$IFS; IFS=$PATH_SEPARATOR
-for as_dir in /bin$PATH_SEPARATOR/usr/bin$PATH_SEPARATOR$PATH
-do
-  IFS=$as_save_IFS
-  test -z &quot;$as_dir&quot; &amp;&amp; as_dir=.
-  for as_base in sh bash ksh sh5; do
-	 case $as_dir in
-	 /*)
-	   if (&quot;$as_dir/$as_base&quot; -c '
-  as_lineno_1=$LINENO
-  as_lineno_2=$LINENO
-  as_lineno_3=`(expr $as_lineno_1 + 1) 2&gt;/dev/null`
-  test &quot;x$as_lineno_1&quot; != &quot;x$as_lineno_2&quot; &amp;&amp;
-  test &quot;x$as_lineno_3&quot;  = &quot;x$as_lineno_2&quot; ') 2&gt;/dev/null; then
-	     $as_unset BASH_ENV || test &quot;${BASH_ENV+set}&quot; != set || { BASH_ENV=; export BASH_ENV; }
-	     $as_unset ENV || test &quot;${ENV+set}&quot; != set || { ENV=; export ENV; }
-	     CONFIG_SHELL=$as_dir/$as_base
-	     export CONFIG_SHELL
-	     exec &quot;$CONFIG_SHELL&quot; &quot;$0&quot; ${1+&quot;$@&quot;}
-	   fi;;
-	 esac
-       done
-done
-;;
-  esac
-
   # Create $as_me.lineno as a copy of $as_myself, but with $LINENO
   # uniformly replaced by the line number.  The first 'sed' inserts a
-  # line-number line before each line; the second 'sed' does the real
-  # work.  The second script uses 'N' to pair each line-number line
-  # with the numbered line, and appends trailing '-' during
-  # substitution so that $LINENO is not a special case at line end.
+  # line-number line after each line using $LINENO; the second 'sed'
+  # does the real work.  The second script uses 'N' to pair each
+  # line-number line with the line containing $LINENO, and appends
+  # trailing '-' during substitution so that $LINENO is not a special
+  # case at line end.
   # (Raja R Harinath suggested sed '=', and Paul Eggert wrote the
-  # second 'sed' script.  Blame Lee E. McMahon for sed's syntax.  :-)
-  sed '=' &lt;$as_myself |
+  # scripts with optimization help from Paolo Bonzini.  Blame Lee
+  # E. McMahon (1931-1989) for sed's syntax.  :-)
+  sed -n '
+    p
+    /[$]LINENO/=
+  ' &lt;$as_myself |
     sed '
+      s/[$]LINENO.*/&amp;-/
+      t lineno
+      b
+      :lineno
       N
-      s,$,-,
-      : loop
-      s,^\(['$as_cr_digits']*\)\(.*\)[$]LINENO\([^'$as_cr_alnum'_]\),\1\2\1\3,
+      :loop
+      s/[$]LINENO\([^'$as_cr_alnum'_].*\n\)\(.*\)/\2\1\2/
       t loop
-      s,-$,,
-      s,^['$as_cr_digits']*\n,,
+      s/-\n.*//
     ' &gt;$as_me.lineno &amp;&amp;
-  chmod +x $as_me.lineno ||
-    { { echo &quot;$as_me:$LINENO: error: cannot create $as_me.lineno; rerun with a POSIX shell&quot; &gt;&amp;5
-echo &quot;$as_me: error: cannot create $as_me.lineno; rerun with a POSIX shell&quot; &gt;&amp;2;}
+  chmod +x &quot;$as_me.lineno&quot; ||
+    { echo &quot;$as_me: error: cannot create $as_me.lineno; rerun with a POSIX shell&quot; &gt;&amp;2
    { (exit 1); exit 1; }; }
 
   # Don't try to exec as it changes $[0], causing all sort of problems
   # (the dirname of $[0] is not the place where we might find the
-  # original and so on.  Autoconf is especially sensible to this).
-  . ./$as_me.lineno
+  # original and so on.  Autoconf is especially sensitive to this).
+  . &quot;./$as_me.lineno&quot;
   # Exit status is that of the last command.
   exit
 }
 
 
-case `echo &quot;testing\c&quot;; echo 1,2,3`,`echo -n testing; echo 1,2,3` in
-  *c*,-n*) ECHO_N= ECHO_C='
-' ECHO_T='	' ;;
-  *c*,*  ) ECHO_N=-n ECHO_C= ECHO_T= ;;
-  *)       ECHO_N= ECHO_C='\c' ECHO_T= ;;
+if (dirname -- /) &gt;/dev/null 2&gt;&amp;1; then
+  as_dirname=dirname
+else
+  as_dirname=false
+fi
+
+ECHO_C= ECHO_N= ECHO_T=
+case `echo -n x` in
+-n*)
+  case `echo 'x\c'` in
+  *c*) ECHO_T='	';;	# ECHO_T is single tab character.
+  *)   ECHO_C='\c';;
+  esac;;
+*)
+  ECHO_N='-n';;
 esac
 
-if expr a : '\(a\)' &gt;/dev/null 2&gt;&amp;1; then
+if expr a : '\(a\)' &gt;/dev/null 2&gt;&amp;1 &amp;&amp;
+   test &quot;X`expr 00001 : '.*\(...\)'`&quot; = X001; then
   as_expr=expr
 else
   as_expr=false
 fi
 
 rm -f conf$$ conf$$.exe conf$$.file
+if test -d conf$$.dir; then
+  rm -f conf$$.dir/conf$$.file
+else
+  rm -f conf$$.dir
+  mkdir conf$$.dir
+fi
 echo &gt;conf$$.file
 if ln -s conf$$.file conf$$ 2&gt;/dev/null; then
-  # We could just check for DJGPP; but this test a) works b) is more generic
-  # and c) will remain valid once DJGPP supports symlinks (DJGPP 2.04).
-  if test -f conf$$.exe; then
-    # Don't use ln at all; we don't have any links
+  as_ln_s='ln -s'
+  # ... but there are two gotchas:
+  # 1) On MSYS, both `ln -s file dir' and `ln file dir' fail.
+  # 2) DJGPP &lt; 2.04 has no symlinks; `ln -s' creates a wrapper executable.
+  # In both cases, we have to default to `cp -p'.
+  ln -s conf$$.file conf$$.dir 2&gt;/dev/null &amp;&amp; test ! -f conf$$.exe ||
     as_ln_s='cp -p'
-  else
-    as_ln_s='ln -s'
-  fi
 elif ln conf$$.file conf$$ 2&gt;/dev/null; then
   as_ln_s=ln
 else
   as_ln_s='cp -p'
 fi
-rm -f conf$$ conf$$.exe conf$$.file
+rm -f conf$$ conf$$.exe conf$$.dir/conf$$.file conf$$.file
+rmdir conf$$.dir 2&gt;/dev/null
 
 if mkdir -p . 2&gt;/dev/null; then
   as_mkdir_p=:
@@ -22974,7 +24465,19 @@
   as_mkdir_p=false
 fi
 
-as_executable_p=&quot;test -f&quot;
+# Find out whether ``test -x'' works.  Don't use a zero-byte file, as
+# systems may use methods other than mode bits to determine executability.
+cat &gt;conf$$.file &lt;&lt;_ASEOF
+#! /bin/sh
+exit 0
+_ASEOF
+chmod +x conf$$.file
+if test -x conf$$.file &gt;/dev/null 2&gt;&amp;1; then
+  as_executable_p=&quot;test -x&quot;
+else
+  as_executable_p=:
+fi
+rm -f conf$$.file
 
 # Sed expression to map a string onto a valid CPP name.
 as_tr_cpp=&quot;eval sed 'y%*$as_cr_letters%P$as_cr_LETTERS%;s%[^_$as_cr_alnum]%_%g'&quot;
@@ -22983,31 +24486,14 @@
 as_tr_sh=&quot;eval sed 'y%*+%pp%;s%[^_$as_cr_alnum]%_%g'&quot;
 
 
-# IFS
-# We need space, tab and new line, in precisely that order.
-as_nl='
-'
-IFS=&quot; 	$as_nl&quot;
-
-# CDPATH.
-$as_unset CDPATH
-
 exec 6&gt;&amp;1
 
-# Open the log real soon, to keep \$[0] and so on meaningful, and to
+# Save the log message, to keep $[0] and so on meaningful, and to
 # report actual input values of CONFIG_FILES etc. instead of their
-# values after options handling.  Logging --version etc. is OK.
-exec 5&gt;&gt;config.log
-{
-  echo
-  sed 'h;s/./-/g;s/^.../## /;s/...$/ ##/;p;x;p;x' &lt;&lt;_ASBOX
-## Running $as_me. ##
-_ASBOX
-} &gt;&amp;5
-cat &gt;&amp;5 &lt;&lt;_CSEOF
-
+# values after options handling.
+ac_log=&quot;
 This file was extended by $as_me, which was
-generated by GNU Autoconf 2.59.  Invocation command line was
+generated by GNU Autoconf 2.59d.  Invocation command line was
 
   CONFIG_FILES    = $CONFIG_FILES
   CONFIG_HEADERS  = $CONFIG_HEADERS
@@ -23015,30 +24501,19 @@
   CONFIG_COMMANDS = $CONFIG_COMMANDS
   $ $0 $@
 
-_CSEOF
-echo &quot;on `(hostname || uname -n) 2&gt;/dev/null | sed 1q`&quot; &gt;&amp;5
-echo &gt;&amp;5
+on `(hostname || uname -n) 2&gt;/dev/null | sed 1q`
+&quot;
+
 _ACEOF
 
+cat &gt;&gt;$CONFIG_STATUS &lt;&lt;_ACEOF
 # Files that config.status was made for.
-if test -n &quot;$ac_config_files&quot;; then
-  echo &quot;config_files=\&quot;$ac_config_files\&quot;&quot; &gt;&gt;$CONFIG_STATUS
-fi
+config_files=&quot;$ac_config_files&quot;
+config_headers=&quot;$ac_config_headers&quot;
 
-if test -n &quot;$ac_config_headers&quot;; then
-  echo &quot;config_headers=\&quot;$ac_config_headers\&quot;&quot; &gt;&gt;$CONFIG_STATUS
-fi
+_ACEOF
 
-if test -n &quot;$ac_config_links&quot;; then
-  echo &quot;config_links=\&quot;$ac_config_links\&quot;&quot; &gt;&gt;$CONFIG_STATUS
-fi
-
-if test -n &quot;$ac_config_commands&quot;; then
-  echo &quot;config_commands=\&quot;$ac_config_commands\&quot;&quot; &gt;&gt;$CONFIG_STATUS
-fi
-
 cat &gt;&gt;$CONFIG_STATUS &lt;&lt;\_ACEOF
-
 ac_cs_usage=&quot;\
 \`$as_me' instantiates files from templates according to the
 current configuration.
@@ -23062,19 +24537,21 @@
 $config_headers
 
 Report bugs to &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/solid-pbx-svn">bug-autoconf at gnu.org</A>&gt;.&quot;
+
 _ACEOF
-
 cat &gt;&gt;$CONFIG_STATUS &lt;&lt;_ACEOF
 ac_cs_version=&quot;\\
 config.status
-configured by $0, generated by GNU Autoconf 2.59,
+configured by $0, generated by GNU Autoconf 2.59d,
   with options \\&quot;`echo &quot;$ac_configure_args&quot; | sed 's/[\\&quot;&quot;\`\$]/\\\\&amp;/g'`\\&quot;
 
-Copyright (C) 2003 Free Software Foundation, Inc.
+Copyright (C) 2006 Free Software Foundation, Inc.
 This config.status script is free software; the Free Software Foundation
 gives unlimited permission to copy, distribute and modify it.&quot;
-srcdir=$srcdir
-INSTALL=&quot;$INSTALL&quot;
+
+ac_pwd='$ac_pwd'
+srcdir='$srcdir'
+INSTALL='$INSTALL'
 _ACEOF
 
 cat &gt;&gt;$CONFIG_STATUS &lt;&lt;\_ACEOF
@@ -23085,39 +24562,24 @@
 do
   case $1 in
   --*=*)
-    ac_option=`expr &quot;x$1&quot; : 'x\([^=]*\)='`
-    ac_optarg=`expr &quot;x$1&quot; : 'x[^=]*=\(.*\)'`
+    ac_option=`expr &quot;X$1&quot; : 'X\([^=]*\)='`
+    ac_optarg=`expr &quot;X$1&quot; : 'X[^=]*=\(.*\)'`
     ac_shift=:
     ;;
-  -*)
+  *)
     ac_option=$1
     ac_optarg=$2
     ac_shift=shift
     ;;
-  *) # This is not an option, so the user has probably given explicit
-     # arguments.
-     ac_option=$1
-     ac_need_defaults=false;;
   esac
 
   case $ac_option in
   # Handling of the options.
-_ACEOF
-cat &gt;&gt;$CONFIG_STATUS &lt;&lt;\_ACEOF
   -recheck | --recheck | --rechec | --reche | --rech | --rec | --re | --r)
     ac_cs_recheck=: ;;
-  --version | --vers* | -V )
-    echo &quot;$ac_cs_version&quot;; exit 0 ;;
-  --he | --h)
-    # Conflict between --help and --header
-    { { echo &quot;$as_me:$LINENO: error: ambiguous option: $1
-Try \`$0 --help' for more information.&quot; &gt;&amp;5
-echo &quot;$as_me: error: ambiguous option: $1
-Try \`$0 --help' for more information.&quot; &gt;&amp;2;}
-   { (exit 1); exit 1; }; };;
-  --help | --hel | -h )
-    echo &quot;$ac_cs_usage&quot;; exit 0 ;;
-  --debug | --d* | -d )
+  --version | --versio | --versi | --vers | --ver | --ve | --v | -V )
+    echo &quot;$ac_cs_version&quot;; exit ;;
+  --debug | --debu | --deb | --de | --d | -d )
     debug=: ;;
   --file | --fil | --fi | --f )
     $ac_shift
@@ -23127,18 +24589,24 @@
     $ac_shift
     CONFIG_HEADERS=&quot;$CONFIG_HEADERS $ac_optarg&quot;
     ac_need_defaults=false;;
+  --he | --h)
+    # Conflict between --help and --header
+    { echo &quot;$as_me: error: ambiguous option: $1
+Try \`$0 --help' for more information.&quot; &gt;&amp;2
+   { (exit 1); exit 1; }; };;
+  --help | --hel | -h )
+    echo &quot;$ac_cs_usage&quot;; exit ;;
   -q | -quiet | --quiet | --quie | --qui | --qu | --q \
   | -silent | --silent | --silen | --sile | --sil | --si | --s)
     ac_cs_silent=: ;;
 
   # This is an error.
-  -*) { { echo &quot;$as_me:$LINENO: error: unrecognized option: $1
-Try \`$0 --help' for more information.&quot; &gt;&amp;5
-echo &quot;$as_me: error: unrecognized option: $1
-Try \`$0 --help' for more information.&quot; &gt;&amp;2;}
+  -*) { echo &quot;$as_me: error: unrecognized option: $1
+Try \`$0 --help' for more information.&quot; &gt;&amp;2
    { (exit 1); exit 1; }; } ;;
 
-  *) ac_config_targets=&quot;$ac_config_targets $1&quot; ;;
+  *) ac_config_targets=&quot;$ac_config_targets $1&quot;
+     ac_need_defaults=false ;;
 
   esac
   shift
@@ -23154,30 +24622,44 @@
 _ACEOF
 cat &gt;&gt;$CONFIG_STATUS &lt;&lt;_ACEOF
 if \$ac_cs_recheck; then
-  echo &quot;running $SHELL $0 &quot; $ac_configure_args \$ac_configure_extra_args &quot; --no-create --no-recursion&quot; &gt;&amp;6
-  exec $SHELL $0 $ac_configure_args \$ac_configure_extra_args --no-create --no-recursion
+  echo &quot;running CONFIG_SHELL=$SHELL $SHELL $0 &quot; $ac_configure_args \$ac_configure_extra_args &quot; --no-create --no-recursion&quot; &gt;&amp;6
+  CONFIG_SHELL=$SHELL
+  export CONFIG_SHELL
+  exec $SHELL &quot;$0&quot; $ac_configure_args \$ac_configure_extra_args --no-create --no-recursion
 fi
 
 _ACEOF
+cat &gt;&gt;$CONFIG_STATUS &lt;&lt;\_ACEOF
+exec 5&gt;&gt;config.log
+{
+  echo
+  sed 'h;s/./-/g;s/^.../## /;s/...$/ ##/;p;x;p;x' &lt;&lt;_ASBOX
+## Running $as_me. ##
+_ASBOX
+  echo &quot;$ac_log&quot;
+} &gt;&amp;5
 
+_ACEOF
+cat &gt;&gt;$CONFIG_STATUS &lt;&lt;_ACEOF
+_ACEOF
 
+cat &gt;&gt;$CONFIG_STATUS &lt;&lt;\_ACEOF
 
-
-
-cat &gt;&gt;$CONFIG_STATUS &lt;&lt;\_ACEOF
+# Handling of arguments.
 for ac_config_target in $ac_config_targets
 do
-  case &quot;$ac_config_target&quot; in
-  # Handling of arguments.
-  &quot;build_tools/menuselect-deps&quot; ) CONFIG_FILES=&quot;$CONFIG_FILES build_tools/menuselect-deps&quot; ;;
-  &quot;makeopts&quot; ) CONFIG_FILES=&quot;$CONFIG_FILES makeopts&quot; ;;
-  &quot;include/autoconfig.h&quot; ) CONFIG_HEADERS=&quot;$CONFIG_HEADERS include/autoconfig.h&quot; ;;
+  case $ac_config_target in
+    &quot;include/autoconfig.h&quot;) CONFIG_HEADERS=&quot;$CONFIG_HEADERS include/autoconfig.h&quot; ;;
+    &quot;build_tools/menuselect-deps&quot;) CONFIG_FILES=&quot;$CONFIG_FILES build_tools/menuselect-deps&quot; ;;
+    &quot;makeopts&quot;) CONFIG_FILES=&quot;$CONFIG_FILES makeopts&quot; ;;
+
   *) { { echo &quot;$as_me:$LINENO: error: invalid argument: $ac_config_target&quot; &gt;&amp;5
 echo &quot;$as_me: error: invalid argument: $ac_config_target&quot; &gt;&amp;2;}
    { (exit 1); exit 1; }; };;
   esac
 done
 
+
 # If the user did not use the arguments to specify the items to instantiate,
 # then the envvar interface is used.  Set only those that are not.
 # We use the long form for the default assignment because of an extremely

Modified: trunk/configure.ac
===================================================================
--- trunk/configure.ac	2006-05-25 20:48:20 UTC (rev 180)
+++ trunk/configure.ac	2006-05-26 21:12:24 UTC (rev 181)
@@ -190,6 +190,7 @@
 
 AST_EXT_LIB([asound], [snd_spcm_init], [alsa/asoundlib.h], [ALSA], [Advanced Linux Sound Architecture], [-lm -ldl])
 AST_EXT_LIB([curses], [initscr], [curses.h], [CURSES], [curses], [])
+AST_EXT_LIB([iksemel], [iks_start_sasl], [iksemel.h], [IKSEMEL], [Iksemel Jabber Library])
 AST_EXT_LIB([nbs], [nbs_connect], [nbs.h], [NBS], [Network Broadcast Sound])
 AST_EXT_LIB([ncurses], [initscr], [curses.h], [NCURSES], [ncurses], [])
 AST_EXT_LIB([newt], [newtBell], [newt.h], [NEWT], [newt])
@@ -198,6 +199,7 @@
 AST_EXT_LIB([osptk], [OSPPCryptoDecrypt], [osp/osp.h], [OSPTK], [OSP Toolkit], [-lcrypto -lssl])
 AST_EXT_LIB([popt], [poptStrerror], [popt.h], [POPT], [popt])
 AST_EXT_LIB([pri], [pri_call], [libpri.h], [LIBPRI], [ISDN PRI])
+AST_EXT_LIB([radiusclient-ng], [rc_read_config], [radiusclient-ng.h], [RADIUSCLIENT], [Radius Client])
 AST_EXT_LIB([speex], [speex_encode], [speex/speex.h], [SPEEX], [Speex], [-lm])
 AST_EXT_LIB([sqlite], [sqlite_exec], [sqlite.h], [SQLITE], [SQLite])
 AST_EXT_LIB([ssl], [ssl2_connect], [openssl/ssl.h], [OPENSSL], [OpenSSL], [-lcrypto])
@@ -208,38 +210,38 @@
 AST_EXT_LIB([z], [compress], [zlib.h], [ZLIB], [zlib])
 
 EDITLINE_LIBS=&quot;&quot;
-if test &quot;x$termcap_LIB&quot; != &quot;x&quot; ; then
-  EDITLINE_LIBS=&quot;$termcap_LIB&quot;
-elif test &quot;x$tinfo_LIB&quot; != &quot;x&quot; ; then
-  EDITLINE_LIBS=&quot;$tinfo_LIB&quot;
-elif test &quot;x$curses_LIB&quot; != &quot;x&quot; ; then
-  EDITLINE_LIBS=&quot;$curses_LIB&quot;
-elif test &quot;x$ncurses_LIB&quot; != &quot;x&quot; ; then
-  EDITLINE_LIBS=&quot;$ncurses_LIB&quot;
+if test &quot;x$TERMCAP_LIB&quot; != &quot;x&quot; ; then
+  EDITLINE_LIBS=&quot;$TERMCAP_LIB&quot;
+elif test &quot;x$TINFO_LIB&quot; != &quot;x&quot; ; then
+  EDITLINE_LIBS=&quot;$TINFO_LIB&quot;
+elif test &quot;x$CURSES_LIB&quot; != &quot;x&quot; ; then
+  EDITLINE_LIBS=&quot;$CURSES_LIB&quot;
+elif test &quot;x$NCURSES_LIB&quot; != &quot;x&quot; ; then
+  EDITLINE_LIBS=&quot;$NCURSES_LIB&quot;
 else
   echo &quot;*** termcap support not found&quot;
   exit 1
 fi
 AC_SUBST(EDITLINE_LIBS)
 
-PBX_LIBossaudio=0
+PBX_LIBOSS=0
 AC_CHECK_HEADER([linux/soundcard.h],
 	        [
-		PBX_LIBossaudio=1
+		PBX_LIBOSS=1
                 AC_DEFINE_UNQUOTED([HAVE_OSS], 1, [Define to indicate the Open Sound System library])
 		])
-if test &quot;$PBX_LIBossaudio&quot; = &quot;0&quot;; then
+if test &quot;$PBX_LIBOSS&quot; = &quot;0&quot;; then
    AC_CHECK_HEADER([sys/soundcard.h],
                    [
 		   PBX_LIBossaudio=1
 		   AC_DEFINE_UNQUOTED([HAVE_OSS], 1, [Define to indicate the Open Sound System library])
 		   ])
 fi
-if test &quot;$PBX_LIBossaudio&quot; = &quot;0&quot;; then
+if test &quot;$PBX_LIBOSS&quot; = &quot;0&quot;; then
    AST_EXT_LIB([ossaudio], [oss_ioctl_mixer], [soundcard.h], [OSS], [Open Sound System])
 fi
 
-AC_SUBST([PBX_LIBossaudio])
+AC_SUBST([PBX_LIBOSS])
 
 if test &quot;${PBX_OSTYPE}&quot; = &quot;Linux&quot; ; then
   AST_EXT_LIB([tonezone], [tone_zone_find], [linux/zaptel.h], [ZAPTEL], [Zaptel])

Modified: trunk/doc/cdrdriver.txt
===================================================================
--- trunk/doc/cdrdriver.txt	2006-05-25 20:48:20 UTC (rev 180)
+++ trunk/doc/cdrdriver.txt	2006-05-26 21:12:24 UTC (rev 181)
@@ -166,6 +166,4 @@
 
 SQLLITE:
 
--------------------------------------------------------------------------------
-
-08/02/2004 : Duane Cox &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/solid-pbx-svn">dcox at illicom.net</A>&gt; - added mssql information
+RADIUS:		See doc/radius.txt for more information on cdr_radius	

Modified: trunk/doc/channelvariables.txt
===================================================================
--- trunk/doc/channelvariables.txt	2006-05-25 20:48:20 UTC (rev 180)
+++ trunk/doc/channelvariables.txt	2006-05-26 21:12:24 UTC (rev 181)
@@ -602,6 +602,7 @@
 instead of, as in Asterisk 1.0, changing the dial plan priority (+101).
 For the various status values, see each application's help text.
 
+${AGISTATUS}			* agi()
 ${AQMSTATUS}			* addqueuemember()
 ${AVAILSTATUS}			* chanisavail()
 ${CHECKGROUPSTATUS}		* checkgroup()

Modified: trunk/funcs/func_channel.c
===================================================================
--- trunk/funcs/func_channel.c	2006-05-25 20:48:20 UTC (rev 180)
+++ trunk/funcs/func_channel.c	2006-05-26 21:12:24 UTC (rev 181)
@@ -51,6 +51,12 @@
 		ast_channel_unlock(chan); \
 	} while (0)
 
+char *transfercapability_table[0x20] = {
+	&quot;SPEECH&quot;, &quot;UNK&quot;, &quot;UNK&quot;, &quot;UNK&quot;, &quot;UNK&quot;, &quot;UNK&quot;, &quot;UNK&quot;, &quot;UNK&quot;,
+	&quot;DIGITAL&quot;, &quot;RESTRICTED_DIGITAL&quot;, &quot;UNK&quot;, &quot;UNK&quot;, &quot;UNK&quot;, &quot;UNK&quot;, &quot;UNK&quot;, &quot;UNK&quot;,
+	&quot;3K1AUDIO&quot;, &quot;DIGITAL_W_TONES&quot;, &quot;UNK&quot;, &quot;UNK&quot;, &quot;UNK&quot;, &quot;UNK&quot;, &quot;UNK&quot;, &quot;UNK&quot;,
+	&quot;VIDEO&quot;, &quot;UNK&quot;, &quot;UNK&quot;, &quot;UNK&quot;, &quot;UNK&quot;, &quot;UNK&quot;, &quot;UNK&quot;, &quot;UNK&quot;, };
+
 static int func_channel_read(struct ast_channel *chan, char *function,
 			     char *data, char *buf, size_t len)
 {
@@ -78,6 +84,8 @@
 		locked_copy_string(chan, buf, ast_state2str(chan-&gt;_state), len);
 	else if (!strcasecmp(data, &quot;channeltype&quot;))
 		locked_copy_string(chan, buf, chan-&gt;tech-&gt;type, len);
+	else if (!strcasecmp(data, &quot;transfercapability&quot;))
+		locked_copy_string(chan, buf, transfercapability_table[chan-&gt;transfercapability &amp; 0x1f], len);
 	else if (!strcasecmp(data, &quot;callgroup&quot;)) {
 		char groupbuf[256];
 		locked_copy_string(chan, buf,  ast_print_group(groupbuf, sizeof(groupbuf), chan-&gt;callgroup), len);
@@ -107,7 +115,15 @@
 		ast_channel_setoption(chan, AST_OPTION_TXGAIN, &amp;gainset, sizeof(gainset), 0);
 	} else if (!strcasecmp(data, &quot;rxgain&quot;)) {
 		sscanf(value, &quot;%hhd&quot;, &amp;gainset);
-		ast_channel_setoption(chan, AST_OPTION_RXGAIN, &amp;gainset, sizeof(gainset), 0);	
+		ast_channel_setoption(chan, AST_OPTION_RXGAIN, &amp;gainset, sizeof(gainset), 0);
+	} else if (!strcasecmp(data, &quot;transfercapability&quot;)) {
+		unsigned short i;
+		for (i = 0; i &lt; 0x20; i++) {
+			if (!strcasecmp(transfercapability_table[i], value) &amp;&amp; strcmp(value, &quot;UNK&quot;)) {
+				chan-&gt;transfercapability = i;
+				break;
+			}
+		}
 	} else if (!chan-&gt;tech-&gt;func_channel_write
 		 || chan-&gt;tech-&gt;func_channel_write(chan, function, data, value)) {
 		ast_log(LOG_WARNING, &quot;Unknown or unavailable item requested: '%s'\n&quot;,

Modified: trunk/funcs/func_db.c
===================================================================
--- trunk/funcs/func_db.c	2006-05-25 20:48:20 UTC (rev 180)
+++ trunk/funcs/func_db.c	2006-05-26 21:12:24 UTC (rev 181)
@@ -159,6 +159,53 @@
 	.read = function_db_exists,
 };
 
+static int function_db_delete(struct ast_channel *chan, char* cmd,
+			      char *parse, char *buf, size_t len)
+{
+	AST_DECLARE_APP_ARGS(args,
+			     AST_APP_ARG(family);
+			     AST_APP_ARG(key);
+	);
+
+	buf[0] = '\0';
+
+	if (ast_strlen_zero(parse)) {
+		ast_log(LOG_WARNING, &quot;DB_DELETE requires an argument, DB_DELETE(&lt;family&gt;/&lt;key&gt;)\n&quot;);
+		return -1;
+	}
+
+	AST_NONSTANDARD_APP_ARGS(args, parse, '/');
+
+	if (args.argc &lt; 2) {
+		ast_log(LOG_WARNING, &quot;DB_DELETE requires an argument, DB_DELETE(&lt;family&gt;/&lt;key&gt;)\n&quot;);
+		return -1;
+	}
+
+	if (ast_db_get(args.family, args.key, buf, len - 1)) {
+		ast_log(LOG_DEBUG, &quot;DB_DELETE: %s/%s not found in database.\n&quot;, args.family, args.key);
+	} else {
+		if (ast_db_del(args.family, args.key)) {
+			ast_log(LOG_DEBUG, &quot;DB_DELETE: %s/%s could not be deleted from the database\n&quot;, 
+				args.family, args.key);
+		}
+	}
+	pbx_builtin_setvar_helper(chan, &quot;DB_RESULT&quot;, buf);
+
+	return 0;
+}
+
+
+static struct ast_custom_function db_delete_function = {
+	.name = &quot;DB_DELETE&quot;,
+	.synopsis = &quot;Return a value from the database and delete it&quot;,
+	.syntax = &quot;DB_DELETE(&lt;family&gt;/&lt;key&gt;)&quot;,
+	.desc =
+		&quot;This function will retrieve a value from the Asterisk database\n&quot;
+		&quot; and then remove that key from the database.  DB_RESULT\n&quot;
+		&quot;will be set to the key's value if it exists.\n&quot;,
+	.read = function_db_delete,
+};
+
 static char *tdesc = &quot;Database (astdb) related dialplan functions&quot;;
 
 static int unload_module(void *mod)
@@ -167,6 +214,7 @@
 
 	res |= ast_custom_function_unregister(&amp;db_function);
 	res |= ast_custom_function_unregister(&amp;db_exists_function);
+	res |= ast_custom_function_unregister(&amp;db_delete_function);
 
 	return res;
 }
@@ -177,6 +225,7 @@
 
 	res |= ast_custom_function_register(&amp;db_function);
 	res |= ast_custom_function_register(&amp;db_exists_function);
+	res |= ast_custom_function_register(&amp;db_delete_function);
 
 	return res;
 }

Modified: trunk/funcs/func_odbc.c
===================================================================
--- trunk/funcs/func_odbc.c	2006-05-25 20:48:20 UTC (rev 180)
+++ trunk/funcs/func_odbc.c	2006-05-26 21:12:24 UTC (rev 181)
@@ -53,11 +53,16 @@
 
 static char *config = &quot;func_odbc.conf&quot;;
 
+enum {
+	OPT_ESCAPECOMMAS =	(1 &lt;&lt; 0),
+} odbc_option_flags;
+
 struct acf_odbc_query {
 	AST_LIST_ENTRY(acf_odbc_query) list;
 	char dsn[30];
 	char sql_read[2048];
 	char sql_write[2048];
+	unsigned int flags;
 	struct ast_custom_function *acf;
 };
 
@@ -230,7 +235,7 @@
 	struct odbc_obj *obj;
 	struct acf_odbc_query *query;
 	char sql[2048] = &quot;&quot;, varname[15];
-	int res, x, buflen = 0;
+	int res, x, buflen = 0, escapecommas;
 	AST_DECLARE_APP_ARGS(args,
 		AST_APP_ARG(field)[100];
 	);
@@ -282,6 +287,9 @@
 		pbx_builtin_setvar_helper(chan, varname, NULL);
 	}
 
+	/* Save this flag, so we can release the lock */
+	escapecommas = ast_test_flag(query, OPT_ESCAPECOMMAS);
+
 	AST_LIST_UNLOCK(&amp;queries);
 
 	res = SQLAllocHandle (SQL_HANDLE_STMT, obj-&gt;con, &amp;stmt);
@@ -345,7 +353,7 @@
 
 		/* Copy data, encoding '\' and ',' for the argument parser */
 		for (i = 0; i &lt; sizeof(coldata); i++) {
-			if (coldata[i] == '\\' || coldata[i] == ',') {
+			if (escapecommas &amp;&amp; (coldata[i] == '\\' || coldata[i] == ',')) {
 				buf[buflen++] = '\\';
 			}
 			buf[buflen++] = coldata[i];
@@ -420,6 +428,13 @@
 		ast_copy_string((*query)-&gt;sql_write, tmp, sizeof((*query)-&gt;sql_write));
 	}
 
+	/* Allow escaping of embedded commas in fields to be turned off */
+	ast_set_flag((*query), OPT_ESCAPECOMMAS);
+	if ((tmp = ast_variable_retrieve(cfg, catg, &quot;escapecommas&quot;))) {
+		if (ast_false(tmp))
+			ast_clear_flag((*query), OPT_ESCAPECOMMAS);
+	}
+
 	(*query)-&gt;acf = ast_calloc(1, sizeof(struct ast_custom_function));
 	if (! (*query)-&gt;acf) {
 		free(*query);

Modified: trunk/funcs/func_realtime.c
===================================================================
--- trunk/funcs/func_realtime.c	2006-05-25 20:48:20 UTC (rev 180)
+++ trunk/funcs/func_realtime.c	2006-05-26 21:12:24 UTC (rev 181)
@@ -32,7 +32,7 @@
 
 #include &quot;asterisk.h&quot;
 
-/* ASTERISK_FILE_VERSION(__FILE__, &quot;$Revision$&quot;) */
+ASTERISK_FILE_VERSION(__FILE__, &quot;$Revision$&quot;)
 
 #include &quot;asterisk/file.h&quot;
 #include &quot;asterisk/channel.h&quot;

Modified: trunk/include/asterisk/app.h
===================================================================
--- trunk/include/asterisk/app.h	2006-05-25 20:48:20 UTC (rev 180)
+++ trunk/include/asterisk/app.h	2006-05-26 21:12:24 UTC (rev 181)
@@ -120,6 +120,27 @@
 int ast_safe_system(const char *s);
 
 /*!
+ * \brief Replace the SIGCHLD handler
+ *
+ * Normally, Asterisk has a SIGCHLD handler that is cleaning up all zombie
+ * processes from forking elsewhere in Asterisk.  However, if you want to
+ * wait*() on the process to retrieve information about it's exit status,
+ * then this signal handler needs to be temporaraly replaced.
+ *
+ * Code that executes this function *must* call ast_unreplace_sigchld()
+ * after it is finished doing the wait*().
+ */
+void ast_replace_sigchld(void);
+
+/*!
+ * \brief Restore the SIGCHLD handler
+ *
+ * This function is called after a call to ast_replace_sigchld.  It restores
+ * the SIGCHLD handler that cleans up any zombie processes.
+ */
+void ast_unreplace_sigchld(void);
+
+/*!
   \brief Send DTMF to a channel
 
   \param chan    The channel that will receive the DTMF frames

Modified: trunk/include/asterisk/channel.h
===================================================================
--- trunk/include/asterisk/channel.h	2006-05-25 20:48:20 UTC (rev 180)
+++ trunk/include/asterisk/channel.h	2006-05-26 21:12:24 UTC (rev 181)
@@ -474,6 +474,7 @@
 #define AST_FEATURE_DISCONNECT		(1 &lt;&lt; 2)
 #define AST_FEATURE_ATXFER		(1 &lt;&lt; 3)
 #define AST_FEATURE_AUTOMON		(1 &lt;&lt; 4)
+#define AST_FEATURE_PARKCALL		(1 &lt;&lt; 5)
 
 #define AST_FEATURE_FLAG_NEEDSDTMF	(1 &lt;&lt; 0)
 #define AST_FEATURE_FLAG_CALLEE		(1 &lt;&lt; 1)

Modified: trunk/include/asterisk/devicestate.h
===================================================================
--- trunk/include/asterisk/devicestate.h	2006-05-25 20:48:20 UTC (rev 180)
+++ trunk/include/asterisk/devicestate.h	2006-05-26 21:12:24 UTC (rev 181)
@@ -41,6 +41,8 @@
 #define AST_DEVICE_UNAVAILABLE	5
 /*! Device is ringing */
 #define AST_DEVICE_RINGING	6
+/*! Device is ringing *and* in use */
+#define AST_DEVICE_RINGINUSE	7
 
 typedef int (*ast_devstate_cb_type)(const char *dev, int state, void *data);
 

Modified: trunk/include/asterisk/linkedlists.h
===================================================================
--- trunk/include/asterisk/linkedlists.h	2006-05-25 20:48:20 UTC (rev 180)
+++ trunk/include/asterisk/linkedlists.h	2006-05-26 21:12:24 UTC (rev 181)
@@ -360,6 +360,19 @@
 #define AST_LIST_TRAVERSE_SAFE_END  }
 
 /*!
+  \brief Initializes a list head structure.
+  \param head This is a pointer to the list head structure
+
+  This macro initializes a list head structure by setting the head
+  entry to \a NULL (empty list) and recreating the embedded lock.
+*/
+#define AST_LIST_HEAD_INIT(head) {					\
+	(head)-&gt;first = NULL;						\
+	(head)-&gt;last = NULL;						\
+	ast_mutex_init(&amp;(head)-&gt;lock);					\
+}
+
+/*!
   \brief Destroys a list head structure.
   \param head This is a pointer to the list head structure
 

Modified: trunk/include/asterisk/lock.h
===================================================================
--- trunk/include/asterisk/lock.h	2006-05-25 20:48:20 UTC (rev 180)
+++ trunk/include/asterisk/lock.h	2006-05-26 21:12:24 UTC (rev 181)
@@ -149,6 +149,13 @@
 
 typedef pthread_cond_t ast_cond_t;
 
+static pthread_mutex_t empty_mutex;
+
+static void __attribute__((constructor)) init_empty_mutex(void)
+{
+	memset(&amp;empty_mutex, 0, sizeof(empty_mutex));
+}
+
 static inline int __ast_pthread_mutex_init_attr(const char *filename, int lineno, const char *func,
 						const char *mutex_name, ast_mutex_t *t,
 						pthread_mutexattr_t *attr) 
@@ -157,14 +164,16 @@
 	int canlog = strcmp(filename, &quot;logger.c&quot;);
 
 	if ((t-&gt;mutex) != ((pthread_mutex_t) PTHREAD_MUTEX_INITIALIZER)) {
-		__ast_mutex_logger(&quot;%s line %d (%s): Error: mutex '%s' is already initialized.\n&quot;,
-				   filename, lineno, func, mutex_name);
-		__ast_mutex_logger(&quot;%s line %d (%s): Error: previously initialization of mutex '%s'.\n&quot;,
-				   t-&gt;file[0], t-&gt;lineno[0], t-&gt;func[0], mutex_name);
+		if ((t-&gt;mutex) != (empty_mutex)) {
+			__ast_mutex_logger(&quot;%s line %d (%s): Error: mutex '%s' is already initialized.\n&quot;,
+					   filename, lineno, func, mutex_name);
+			__ast_mutex_logger(&quot;%s line %d (%s): Error: previously initialization of mutex '%s'.\n&quot;,
+					   t-&gt;file[0], t-&gt;lineno[0], t-&gt;func[0], mutex_name);
 #ifdef THREAD_CRASH
-		DO_THREAD_CRASH;
+			DO_THREAD_CRASH;
 #endif
-		return 0;
+			return 0;
+		}
 	}
 #endif
 

Modified: trunk/include/autoconfig.h.in
===================================================================
--- trunk/include/autoconfig.h.in	2006-05-25 20:48:20 UTC (rev 180)
+++ trunk/include/autoconfig.h.in	2006-05-26 21:12:24 UTC (rev 181)
@@ -112,6 +112,9 @@
 /* Define if your system has the GTK libraries. */
 #undef HAVE_GTK
 
+/* Define to indicate the Iksemel Jabber Library library */
+#undef HAVE_IKSEMEL
+
 /* Define to 1 if you have the `inet_ntoa' function. */
 #undef HAVE_INET_NTOA
 
@@ -218,6 +221,9 @@
 /* Define to 1 if you have the `putenv' function. */
 #undef HAVE_PUTENV
 
+/* Define to indicate the Radius Client library */
+#undef HAVE_RADIUSCLIENT
+
 /* Define to 1 if your system has a GNU libc compatible `realloc' function,
    and to 0 otherwise. */
 #undef HAVE_REALLOC
@@ -480,7 +486,7 @@
 
 /* If using the C implementation of alloca, define if you know the
    direction of stack growth for your system; otherwise it will be
-   automatically deduced at run-time.
+   automatically deduced at runtime.
 	STACK_DIRECTION &gt; 0 =&gt; grows toward higher addresses
 	STACK_DIRECTION &lt; 0 =&gt; grows toward lower addresses
 	STACK_DIRECTION = 0 =&gt; direction of growth unknown */
@@ -539,7 +545,7 @@
 /* Define to `int' if &lt;sys/types.h&gt; does not define. */
 #undef mode_t
 
-/* Define to `long' if &lt;sys/types.h&gt; does not define. */
+/* Define to `long int' if &lt;sys/types.h&gt; does not define. */
 #undef off_t
 
 /* Define to `int' if &lt;sys/types.h&gt; does not define. */
@@ -548,7 +554,7 @@
 /* Define to rpl_realloc if the replacement function should be used. */
 #undef realloc
 
-/* Define to `unsigned' if &lt;sys/types.h&gt; does not define. */
+/* Define to `unsigned int' if &lt;sys/types.h&gt; does not define. */
 #undef size_t
 
 /* Define to `int' if &lt;sys/types.h&gt; doesn't define. */

Modified: trunk/logger.c
===================================================================
--- trunk/logger.c	2006-05-25 20:48:20 UTC (rev 180)
+++ trunk/logger.c	2006-05-26 21:12:24 UTC (rev 181)
@@ -385,6 +385,7 @@
 	FILE *myf;
 	int x, res = 0;
 
+	ast_mutex_lock(&amp;msglist_lock);	/* to avoid deadlock */
 	ast_mutex_lock(&amp;loglock);
 	if (eventlog) 
 		fclose(eventlog);
@@ -491,6 +492,7 @@
 		}
 	}
 	ast_mutex_unlock(&amp;loglock);
+	ast_mutex_unlock(&amp;msglist_lock);
 
 	return res;
 }

Modified: trunk/makeopts.in
===================================================================
--- trunk/makeopts.in	2006-05-25 20:48:20 UTC (rev 180)
+++ trunk/makeopts.in	2006-05-26 21:12:24 UTC (rev 181)
@@ -37,63 +37,66 @@
 
 AST_DEVMODE=@AST_DEVMODE@
 
-OGG_LIB=@ogg_LIB@
-OGG_INCLUDE=@ogg_INCLUDE@
+OGG_LIB=@OGG_LIB@
+OGG_INCLUDE=@OGG_INCLUDE@
 
-VORBIS_LIB=@vorbis_LIB@
-VORBIS_INCLUDE=@vorbis_INCLUDE@
+VORBIS_LIB=@VORBIS_LIB@
+VORBIS_INCLUDE=@VORBIS_INCLUDE@
 
-ASOUND_LIB=@asound_LIB@
-ASOUND_INCLUDE=@asound_INCLUDE@
+ASOUND_LIB=@ALSA_LIB@
+ASOUND_INCLUDE=@ALSA_INCLUDE@
 
-NBS_LIB=@nbs_LIB@
-NBS_INCLUDE=@nbs_INCLUDE@
+NBS_LIB=@NBS_LIB@
+NBS_INCLUDE=@NBS_INCLUDE@
 
-OSSAUDIO_LIB=@ossaudio_LIB@
-OSSAUDIO_INCLUDE=@ossaudio_INCLUDE@
+OSSAUDIO_LIB=@OSS_LIB@
+OSSAUDIO_INCLUDE=@OSS_INCLUDE@
 
-SPEEX_LIB=@speex_LIB@
-SPEEX_INCLUDE=@speex_INCLUDE@
+SPEEX_LIB=@SPEEX_LIB@
+SPEEX_INCLUDE=@SPEEX_INCLUDE@
 
-ZAPTEL_LIB=@tonezone_LIB@
-ZAPTEL_INCLUDE=@tonezone_INCLUDE@
+ZAPTEL_LIB=@ZAPTEL_LIB@
+ZAPTEL_INCLUDE=@ZAPTEL_INCLUDE@
 
 VPB_LIB=@VPB_LIB@
 VPB_INCLUDE=@VPB_INCLUDE@
 
-PRI_LIB=@pri_LIB@
-PRI_INCLUDE=@pri_INCLUDE@
+PRI_LIB=@LIBPRI_LIB@
+PRI_INCLUDE=@LIBPRI_INCLUDE@
 
-OSPTK_LIB=@osptk_LIB@
-OSPTK_INCLUDE=@osptk_INCLUDE@
+OSPTK_LIB=@OSPTK_LIB@
+OSPTK_INCLUDE=@OSPTK_INCLUDE@
 
-ODBC_LIB=@odbc_LIB@
-ODBC_INCLUDE=@odbc_INCLUDE@
+ODBC_LIB=@UNIXODBC_LIB@
+ODBC_INCLUDE=@UNIXODBC_INCLUDE@
 
 PGSQL_LIB=@pq_LIB@
 PGSQL_INCLUDE=@pq_INCLUDE@
 
-SQLITE_LIB=@sqlite_LIB@
-SQLITE_INCLUDE=@sqlite_INCLUDE@
+SQLITE_LIB=@SQLITE_LIB@
+SQLITE_INCLUDE=@SQLITE_INCLUDE@
 
-TDS_LIB=@tds_LIB@
-TDS_INCLUDE=@tds_INCLUDE@
+TDS_LIB=@FREETDS_LIB@
+TDS_INCLUDE=@FREETDS_INCLUDE@
 
-POPT_LIB=@popt_LIB@
-POPT_INCLUDE=@popt_INCLUDE@
+POPT_LIB=@POPT_LIB@
+POPT_INCLUDE=@POPT_INCLUDE@
 
-NEWT_LIB=@newt_LIB@
-NEWT_INCLUDE=@newt_INCLUDE@
+NEWT_LIB=@NEWT_LIB@
+NEWT_INCLUDE=@NEWT_INCLUDE@
 
 PWLIB_LIB=@PWLIB_LIB@
 PWLIB_INCLUDE=@PWLIB_INCLUDE@
 
-SSL_LIB=@ssl_LIB@
-SSL_INCLUDE=@ssl_INCLUDE@
+IKSEMEL_LIB=@IKSEMEL_LIB@
+IKSEMEL_INCLUDE=@IKSEMEL_INCLUDE@
 
-Z_LIB=@z_LIB@
-Z_INCLUDE=@z_INCLUDE@
+SSL_LIB=@OPENSSL_LIB@
+SSL_INCLUDE=@OPENSSL_INCLUDE@
 
+Z_LIB=@ZLIB_LIB@
+Z_INCLUDE=@ZLIB_INCLUDE@
+
 QT_LIB=@QT_LIB@
 QT_INCLUDE=@QT_INCLUDE@
 
@@ -109,11 +112,13 @@
 GSM_LIB=@gsm_LIB@
 GSM_INCLUDE=@gsm_INCLUDE@
 
-CURSES_LIB=@curses_LIB@
-CURSES_INCLUDE=@curses_INCLUDE@
+CURSES_LIB=@CURSES_LIB@
+CURSES_INCLUDE=@CURSES_INCLUDE@
 
-NCURSES_LIB=@ncurses_LIB@
-NCURSES_INCLUDE=@ncurses_INCLUDE@
+NCURSES_LIB=@NCURSES_LIB@
+NCURSES_INCLUDE=@NCURSES_INCLUDE@
 
 EDITLINE_LIBS=@EDITLINE_LIBS@
 
+RADIUSCLIENT_LIB=@RADIUSCLIENT_LIB@
+RADIUSCLIENT_INCLUDE=@RADIUSCLIENT_INCLUDE@

Modified: trunk/manager.c
===================================================================
--- trunk/manager.c	2006-05-25 20:48:20 UTC (rev 180)
+++ trunk/manager.c	2006-05-26 21:12:24 UTC (rev 181)
@@ -1631,6 +1631,31 @@
 	return ret;
 }
 
+static char mandescr_userevent[] =
+&quot;Description: Send an event to manager sessions.\n&quot;
+&quot;Variables: (Names marked with * are required)\n&quot;
+&quot;       *UserEvent: EventStringToSend\n&quot;
+&quot;       Header1: Content1\n&quot;
+&quot;       HeaderN: ContentN\n&quot;;
+
+static int action_userevent(struct mansession *s, struct message *m)
+{
+	char *event = astman_get_header(m, &quot;UserEvent&quot;);
+	char body[2048] = &quot;&quot;;
+	int x, bodylen = 0;
+	for (x = 0; x &lt; m-&gt;hdrcount; x++) {
+		if (strncasecmp(&quot;UserEvent:&quot;, m-&gt;headers[x], strlen(&quot;UserEvent:&quot;))) {
+			ast_copy_string(body + bodylen, m-&gt;headers[x], sizeof(body) - bodylen - 3);
+			bodylen += strlen(m-&gt;headers[x]);
+			ast_copy_string(body + bodylen, &quot;\r\n&quot;, 3);
+			bodylen += 2;
+		}
+	}
+
+	manager_event(EVENT_FLAG_USER, &quot;UserEvent&quot;, &quot;UserEvent: %s\r\n%s&quot;, event, body);
+	return 0;
+}
+
 static int process_message(struct mansession *s, struct message *m)
 {
 	char action[80] = &quot;&quot;;
@@ -2327,6 +2352,7 @@
 		ast_manager_register2(&quot;MailboxStatus&quot;, EVENT_FLAG_CALL, action_mailboxstatus, &quot;Check Mailbox&quot;, mandescr_mailboxstatus );
 		ast_manager_register2(&quot;MailboxCount&quot;, EVENT_FLAG_CALL, action_mailboxcount, &quot;Check Mailbox Message Count&quot;, mandescr_mailboxcount );
 		ast_manager_register2(&quot;ListCommands&quot;, 0, action_listcommands, &quot;List available manager commands&quot;, mandescr_listcommands);
+		ast_manager_register2(&quot;UserEvent&quot;, EVENT_FLAG_USER, action_userevent, &quot;Send an arbitrary event&quot;, mandescr_userevent);
 		ast_manager_register2(&quot;WaitEvent&quot;, 0, action_waitevent, &quot;Wait for an event to occur&quot;, mandescr_waitevent);
 
 		ast_cli_register(&amp;show_mancmd_cli);

Modified: trunk/pbx/Makefile
===================================================================
--- trunk/pbx/Makefile	2006-05-25 20:48:20 UTC (rev 180)
+++ trunk/pbx/Makefile	2006-05-26 21:12:24 UTC (rev 181)
@@ -26,6 +26,7 @@
 
 clean: clean-depend
 	rm -f *.so *.o
+	rm -f ael/*.o
 
 pbx_gtkconsole.o: pbx_gtkconsole.c
 	$(CC) $(CFLAGS) $(GTK_FLAGS) -c -o $@ $&lt;

Modified: trunk/pbx/pbx_spool.c
===================================================================
--- trunk/pbx/pbx_spool.c	2006-05-25 20:48:20 UTC (rev 180)
+++ trunk/pbx/pbx_spool.c	2006-05-26 21:12:24 UTC (rev 181)
@@ -58,10 +58,13 @@
 	 * maximum number of retries is exceeded, even if the
 	 * modification time of the call file is in the future.
 	 */
-	SPOOL_FLAG_ALWAYS_DELETE = (1 &lt;&lt; 0)
+	SPOOL_FLAG_ALWAYS_DELETE = (1 &lt;&lt; 0),
+	/* Don't unlink the call file after processing, move in qdonedir */
+	SPOOL_FLAG_ARCHIVE = (1 &lt;&lt; 1)
 };
 
 static char qdir[255];
+static char qdonedir[255];
 
 struct outgoing {
 	char fn[256];
@@ -228,6 +231,8 @@
 					ast_copy_string(o-&gt;account, c, sizeof(o-&gt;account));
 				} else if (!strcasecmp(buf, &quot;alwaysdelete&quot;)) {
 					ast_set2_flag(&amp;o-&gt;options, ast_true(c), SPOOL_FLAG_ALWAYS_DELETE);
+				} else if (!strcasecmp(buf, &quot;archive&quot;)) {
+					ast_set2_flag(&amp;o-&gt;options, ast_true(c), SPOOL_FLAG_ARCHIVE);
 				} else {
 					ast_log(LOG_WARNING, &quot;Unknown keyword '%s' at line %d of %s\n&quot;, buf, lineno, fn);
 				}
@@ -264,17 +269,59 @@
 	}
 }
 
-static void check_unlink(struct outgoing *o)
+/*!
+ * \brief Remove a call file from the outgoing queue optionally moving it in the archive dir
+ *
+ * \param o the pointer to outgoing struct
+ * \param status the exit status of the call. Can be &quot;Completed&quot;, &quot;Failed&quot; or &quot;Expired&quot;
+ */
+static int remove_from_queue(struct outgoing *o, const char *status)
 {
-	if (ast_test_flag(&amp;o-&gt;options, SPOOL_FLAG_ALWAYS_DELETE))
-		unlink(o-&gt;fn);
-	else {
+	int fd;
+	FILE *f;
+	char newfn[256];
+	const char *bname;
+
+	if (!ast_test_flag(&amp;o-&gt;options, SPOOL_FLAG_ALWAYS_DELETE)) {
 		struct stat current_file_status;
-	
+
 		if (!stat(o-&gt;fn, &amp;current_file_status))
-			if (time(NULL) &gt;= current_file_status.st_mtime)
-				unlink(o-&gt;fn);
+			if (time(NULL) &lt; current_file_status.st_mtime)
+				return 0;
 	}
+
+	if (!ast_test_flag(&amp;o-&gt;options, SPOOL_FLAG_ARCHIVE)) {
+		unlink(o-&gt;fn);
+		return 0;
+	}
+	if (mkdir(qdonedir, 0700) &amp;&amp; (errno != EEXIST)) {
+		ast_log(LOG_WARNING, &quot;Unable to create queue directory %s -- outgoing spool archiving disabled\n&quot;, qdonedir);
+		unlink(o-&gt;fn);
+		return -1;
+	}
+	fd = open(o-&gt;fn, O_WRONLY|O_APPEND);
+	if (fd &gt; -1) {
+		f = fdopen(fd, &quot;a&quot;);
+		if (f) {
+			fprintf(f, &quot;Status: %s\n&quot;, status);
+			fclose(f);
+		} else
+			close(fd);
+	}
+
+	bname = strrchr(o-&gt;fn,'/');
+	if (bname == NULL) 
+		bname = o-&gt;fn;
+	else 
+		bname++;	
+	snprintf(newfn, sizeof(newfn), &quot;%s/%s&quot;, qdonedir, bname);
+	/* a existing call file the archive dir is overwritten */
+	unlink(newfn);
+	if (rename(o-&gt;fn, newfn) != 0) {
+		unlink(o-&gt;fn);
+		return -1;
+	} else
+		return 0;
 }
 
 static void *attempt_thread(void *data)
@@ -295,7 +342,7 @@
 		if (o-&gt;retries &gt;= o-&gt;maxretries + 1) {
 			/* Max retries exceeded */
 			ast_log(LOG_EVENT, &quot;Queued call to %s/%s expired without completion after %d attempt%s\n&quot;, o-&gt;tech, o-&gt;dest, o-&gt;retries - 1, ((o-&gt;retries - 1) != 1) ? &quot;s&quot; : &quot;&quot;);
-			check_unlink(o);
+			remove_from_queue(o, &quot;Expired&quot;);
 		} else {
 			/* Notate that the call is still active */
 			safe_append(o, time(NULL), &quot;EndRetry&quot;);
@@ -303,7 +350,7 @@
 	} else {
 		ast_log(LOG_NOTICE, &quot;Call completed to %s/%s\n&quot;, o-&gt;tech, o-&gt;dest);
 		ast_log(LOG_EVENT, &quot;Queued call to %s/%s completed\n&quot;, o-&gt;tech, o-&gt;dest);
-		check_unlink(o);
+		remove_from_queue(o, &quot;Completed&quot;);
 	}
 	free_outgoing(o);
 	return NULL;
@@ -357,19 +404,19 @@
 				} else {
 					ast_log(LOG_EVENT, &quot;Queued call to %s/%s expired without completion after %d attempt%s\n&quot;, o-&gt;tech, o-&gt;dest, o-&gt;retries - 1, ((o-&gt;retries - 1) != 1) ? &quot;s&quot; : &quot;&quot;);
 					free_outgoing(o);
-					unlink(fn);
+					remove_from_queue(o, &quot;Expired&quot;);
 					return 0;
 				}
 			} else {
 				free_outgoing(o);
 				ast_log(LOG_WARNING, &quot;Invalid file contents in %s, deleting\n&quot;, fn);
 				fclose(f);
-				unlink(fn);
+				remove_from_queue(o, &quot;Failed&quot;);
 			}
 		} else {
 			free_outgoing(o);
 			ast_log(LOG_WARNING, &quot;Unable to open %s: %s, deleting\n&quot;, fn, strerror(errno));
-			unlink(fn);
+			remove_from_queue(o, &quot;Failed&quot;);
 		}
 	} else
 		ast_log(LOG_WARNING, &quot;Out of memory :(\n&quot;);
@@ -445,6 +492,7 @@
 		ast_log(LOG_WARNING, &quot;Unable to create queue directory %s -- outgoing spool disabled\n&quot;, qdir);
 		return 0;
 	}
+	snprintf(qdonedir, sizeof(qdir), &quot;%s/%s&quot;, ast_config_AST_SPOOL_DIR, &quot;outgoing_done&quot;);
 	pthread_attr_init(&amp;attr);
  	pthread_attr_setdetachstate(&amp;attr, PTHREAD_CREATE_DETACHED);
 	if ((ret = ast_pthread_create(&amp;thread,&amp;attr,scan_thread, NULL)) != 0) {

Modified: trunk/pbx.c
===================================================================
--- trunk/pbx.c	2006-05-25 20:48:20 UTC (rev 180)
+++ trunk/pbx.c	2006-05-26 21:12:24 UTC (rev 181)
@@ -296,7 +296,7 @@
 
 	{ &quot;Congestion&quot;, pbx_builtin_congestion,
 	&quot;Indicate the Congestion condition&quot;,
-	&quot;  Congestion([timeout]): This application will indicate the congenstion\n&quot;
+	&quot;  Congestion([timeout]): This application will indicate the congestion\n&quot;
 	&quot;condition to the calling channel. If the optional timeout is specified, the\n&quot;
 	&quot;calling channel will be hung up after the specified number of seconds.\n&quot;
 	&quot;Otherwise, this application will wait until the calling channel hangs up.\n&quot;
@@ -1783,6 +1783,12 @@
 			allunavailable = 0;
 			allfree = 0;
 			break;
+		case AST_DEVICE_RINGINUSE:
+			inuse = 1;
+			ring = 1;
+			allunavailable = 0;
+			allfree = 0;
+			break;
 		case AST_DEVICE_BUSY:
 			allunavailable = 0;
 			allfree = 0;

Modified: trunk/res/Makefile
===================================================================
--- trunk/res/Makefile	2006-05-25 20:48:20 UTC (rev 180)
+++ trunk/res/Makefile	2006-05-26 21:12:24 UTC (rev 181)
@@ -73,6 +73,12 @@
 res_odbc.o: res_odbc.c
 	$(CC) -c -o $@ $(CFLAGS) $(ODBC_INCLUDE) $&lt;
 
+res_jabber.o: res_jabber.c
+	$(CC) -c -o $@ $(CFLAGS) $(IKSEMEL_INCLUDE) $&lt;
+
+res_jabber.so: res_jabber.o
+	$(CC) $(SOLINK) -o $@ $&lt; $(IKSEMEL_LIB) 
+
 res_osp.so: res_osp.o
 	$(CC) $(SOLINK) -o $@ $&lt; $(OSPTK_LIB)
 

Modified: trunk/res/res_agi.c
===================================================================
--- trunk/res/res_agi.c	2006-05-25 20:48:20 UTC (rev 180)
+++ trunk/res/res_agi.c	2006-05-26 21:12:24 UTC (rev 181)
@@ -39,6 +39,7 @@
 #include &lt;stdio.h&gt;
 #include &lt;fcntl.h&gt;
 #include &lt;errno.h&gt;
+#include &lt;sys/wait.h&gt;
 
 #include &quot;asterisk.h&quot;
 
@@ -86,11 +87,18 @@
 &quot;written in any language to control a telephony channel, play audio,\n&quot;
 &quot;read DTMF digits, etc. by communicating with the AGI protocol on stdin\n&quot;
 &quot;and stdout.\n&quot;
-&quot;Returns -1 on hangup (except for DeadAGI) or if application requested\n&quot;
-&quot; hangup, or 0 on non-hangup exit. \n&quot;
-&quot;Using 'EAGI' provides enhanced AGI, with incoming audio available out of band\n&quot;
+&quot;  This channel will stop dialplan execution on hangup inside of this\n&quot;
+&quot;application, except when using DeadAGI.  Otherwise, dialplan execution\n&quot;
+&quot;will continue normally.\n&quot;
+&quot;  A locally executed AGI script will receive SIGHUP on hangup from the channel\n&quot;
+&quot;except when using DeadAGI. This can be disabled by setting the AGISIGHUP channel\n&quot;
+&quot;variable to \&quot;no\&quot; before executing the AGI application.\n&quot;
+&quot;  Using 'EAGI' provides enhanced AGI, with incoming audio available out of band\n&quot;
 &quot;on file descriptor 3\n\n&quot;
-&quot;Use the CLI command 'show agi' to list available agi commands\n&quot;;
+&quot;  Use the CLI command 'show agi' to list available agi commands\n&quot;
+&quot;  This application sets the following channel variable upon completion:\n&quot;
+&quot;     AGISTATUS      The status of the attempt to the run the AGI script\n&quot;
+&quot;                    text string, one of SUCCESS | FAILED | HANGUP\n&quot;;
 
 static int agidebug = 0;
 
@@ -103,6 +111,12 @@
 
 #define AGI_PORT 4573
 
+enum agi_result {
+	AGI_RESULT_SUCCESS,
+	AGI_RESULT_FAILURE,
+	AGI_RESULT_HANGUP
+};
+
 static void agi_debug_cli(int fd, char *fmt, ...)
 {
 	char *stuff;
@@ -124,7 +138,7 @@
 
 /* launch_netscript: The fastagi handler.
 	FastAGI defaults to port 4573 */
-static int launch_netscript(char *agiurl, char *argv[], int *fds, int *efd, int *opid)
+static enum agi_result launch_netscript(char *agiurl, char *argv[], int *fds, int *efd, int *opid)
 {
 	int s;
 	int flags;
@@ -181,7 +195,7 @@
 	if (connect(s, (struct sockaddr *)&amp;sin, sizeof(sin)) &amp;&amp; (errno != EINPROGRESS)) {
 		ast_log(LOG_WARNING, &quot;Connect failed with unexpected error: %s\n&quot;, strerror(errno));
 		close(s);
-		return -1;
+		return AGI_RESULT_FAILURE;
 	}
 
 	pfds[0].fd = s;
@@ -190,7 +204,7 @@
 		if (errno != EINTR) {
 			ast_log(LOG_WARNING, &quot;Connect to '%s' failed: %s\n&quot;, agiurl, strerror(errno));
 			close(s);
-			return -1;
+			return AGI_RESULT_FAILURE;
 		}
 	}
 	/* XXX in theory should check for partial writes... */
@@ -198,7 +212,7 @@
 		if (errno != EINTR) {
 			ast_log(LOG_WARNING, &quot;Connect to '%s' failed: %s\n&quot;, agiurl, strerror(errno));
 			close(s);
-			return -1;
+			return AGI_RESULT_FAILURE;
 		}
 	}
 
@@ -211,10 +225,10 @@
 	fds[0] = s;
 	fds[1] = s;
 	*opid = -1;
-	return 0;
+	return AGI_RESULT_SUCCESS;
 }
 
-static int launch_script(char *script, char *argv[], int *fds, int *efd, int *opid)
+static enum agi_result launch_script(char *script, char *argv[], int *fds, int *efd, int *opid)
 {
 	char tmp[256];
 	int pid;
@@ -234,13 +248,13 @@
 	}
 	if (pipe(toast)) {
 		ast_log(LOG_WARNING, &quot;Unable to create toast pipe: %s\n&quot;,strerror(errno));
-		return -1;
+		return AGI_RESULT_FAILURE;
 	}
 	if (pipe(fromast)) {
 		ast_log(LOG_WARNING, &quot;unable to create fromast pipe: %s\n&quot;, strerror(errno));
 		close(toast[0]);
 		close(toast[1]);
-		return -1;
+		return AGI_RESULT_FAILURE;
 	}
 	if (efd) {
 		if (pipe(audio)) {
@@ -249,7 +263,7 @@
 			close(fromast[1]);
 			close(toast[0]);
 			close(toast[1]);
-			return -1;
+			return AGI_RESULT_FAILURE;
 		}
 		res = fcntl(audio[1], F_GETFL);
 		if (res &gt; -1) 
@@ -262,13 +276,15 @@
 			close(toast[1]);
 			close(audio[0]);
 			close(audio[1]);
-			return -1;
+			return AGI_RESULT_FAILURE;
 		}
 	}
+	ast_replace_sigchld();
 	pid = fork();
 	if (pid &lt; 0) {
 		ast_log(LOG_WARNING, &quot;Failed to fork(): %s\n&quot;, strerror(errno));
-		return -1;
+		ast_unreplace_sigchld();
+		return AGI_RESULT_FAILURE;
 	}
 	if (!pid) {
 		/* Pass paths to AGI via environmental variables */
@@ -324,13 +340,11 @@
 	close(toast[1]);
 	close(fromast[0]);
 
-	if (efd) {
-		/* [PHM 12/18/03] */
+	if (efd)
 		close(audio[0]);
-	}
 
 	*opid = pid;
-	return 0;
+	return AGI_RESULT_SUCCESS;
 		
 }
 
@@ -902,6 +916,9 @@
 			return RESULT_FAILURE;
 		}
 		
+		/* Request a video update */
+		ast_indicate(chan, AST_CONTROL_VIDUPDATE);
+	
 		chan-&gt;stream = fs;
 		ast_applystream(chan,fs);
 		/* really should have checks */
@@ -965,6 +982,9 @@
                                         }
                             	}
 				break;
+			case AST_FRAME_VIDEO:
+				ast_writestream(fs, f);
+				break;
 			}
 			ast_frfree(f);
 			if (gotsilence)
@@ -1767,12 +1787,12 @@
 	return 0;
 }
 #define RETRY	3
-static int run_agi(struct ast_channel *chan, char *request, AGI *agi, int pid, int dead)
+static enum agi_result run_agi(struct ast_channel *chan, char *request, AGI *agi, int pid, int *status, int dead)
 {
 	struct ast_channel *c;
 	int outfd;
 	int ms;
-	int returnstatus = 0;
+	enum agi_result returnstatus = AGI_RESULT_SUCCESS;
 	struct ast_frame *f;
 	char buf[2048];
 	FILE *readf;
@@ -1785,7 +1805,7 @@
 		if (pid &gt; -1)
 			kill(pid, SIGHUP);
 		close(agi-&gt;ctrl);
-		return -1;
+		return AGI_RESULT_FAILURE;
 	}
 	setlinebuf(readf);
 	setup_env(chan, request, agi-&gt;fd, (agi-&gt;audio &gt; -1));
@@ -1798,7 +1818,7 @@
 			f = ast_read(c);
 			if (!f) {
 				ast_log(LOG_DEBUG, &quot;%s hungup\n&quot;, chan-&gt;name);
-				returnstatus = -1;
+				returnstatus = AGI_RESULT_HANGUP;
 				break;
 			} else {
 				/* If it's voice, write it to the audio pipe */
@@ -1816,6 +1836,7 @@
 					returnstatus = -1;
 				if (option_verbose &gt; 2) 
 					ast_verbose(VERBOSE_PREFIX_3 &quot;AGI Script %s completed, returning %d\n&quot;, request, returnstatus);
+				waitpid(pid, status, 0);
 				/* No need to kill the pid anymore, since they closed us */
 				pid = -1;
 				break;
@@ -1833,15 +1854,18 @@
 		} else {
 			if (--retry &lt;= 0) {
 				ast_log(LOG_WARNING, &quot;No channel, no fd?\n&quot;);
-				returnstatus = -1;
+				returnstatus = AGI_RESULT_FAILURE;
 				break;
 			}
 		}
 	}
 	/* Notify process */
 	if (pid &gt; -1) {
-		if (kill(pid, SIGHUP))
-			ast_log(LOG_WARNING, &quot;unable to send SIGHUP to AGI process %d: %s\n&quot;, pid, strerror(errno));
+		const char *sighup = pbx_builtin_getvar_helper(chan, &quot;AGISIGHUP&quot;);
+		if (ast_strlen_zero(sighup) || !ast_false(sighup)) {
+			if (kill(pid, SIGHUP))
+				ast_log(LOG_WARNING, &quot;unable to send SIGHUP to AGI process %d: %s\n&quot;, pid, strerror(errno));
+		}
 	}
 	fclose(readf);
 	return returnstatus;
@@ -1927,7 +1951,7 @@
 
 static int agi_exec_full(struct ast_channel *chan, void *data, int enhanced, int dead)
 {
-	int res=0;
+	enum agi_result res;
 	struct localuser *u;
 	char *argv[MAX_ARGS];
 	char buf[2048]=&quot;&quot;;
@@ -1961,17 +1985,35 @@
 	}
 #endif
 	res = launch_script(argv[0], argv, fds, enhanced ? &amp;efd : NULL, &amp;pid);
-	if (!res) {
+	if (res == AGI_RESULT_SUCCESS) {
+		int status = 0;
 		agi.fd = fds[1];
 		agi.ctrl = fds[0];
 		agi.audio = efd;
-		res = run_agi(chan, argv[0], &amp;agi, pid, dead);
+		res = run_agi(chan, argv[0], &amp;agi, pid, &amp;status, dead);
+		/* If the fork'd process returns non-zero, set AGISTATUS to FAILURE */
+		if (res == AGI_RESULT_SUCCESS &amp;&amp; status)
+			res = AGI_RESULT_FAILURE;
 		close(fds[1]);
 		if (efd &gt; -1)
 			close(efd);
+		ast_unreplace_sigchld();
 	}
 	ast_localuser_remove(me, u);
-	return res;
+
+	switch (res) {
+	case AGI_RESULT_SUCCESS:
+		pbx_builtin_setvar_helper(chan, &quot;AGISTATUS&quot;, &quot;SUCCESS&quot;);
+		break;
+	case AGI_RESULT_FAILURE:
+		pbx_builtin_setvar_helper(chan, &quot;AGISTATUS&quot;, &quot;FAILURE&quot;);
+		break;
+	case AGI_RESULT_HANGUP:
+		pbx_builtin_setvar_helper(chan, &quot;AGISTATUS&quot;, &quot;HANGUP&quot;);
+		return -1;
+	}
+
+	return 0;
 }
 
 static int agi_exec(struct ast_channel *chan, void *data)

Modified: trunk/res/res_features.c
===================================================================
--- trunk/res/res_features.c	2006-05-25 20:48:20 UTC (rev 180)
+++ trunk/res/res_features.c	2006-05-26 21:12:24 UTC (rev 181)
@@ -70,6 +70,7 @@
 #define DEFAULT_PARK_TIME 45000
 #define DEFAULT_TRANSFER_DIGIT_TIMEOUT 3000
 #define DEFAULT_FEATURE_DIGIT_TIMEOUT 500
+#define DEFAULT_NOANSWER_TIMEOUT_ATTENDED_TRANSFER 15000
 
 #define AST_MAX_WATCHERS 256
 
@@ -96,6 +97,8 @@
 static int transferdigittimeout;
 static int featuredigittimeout;
 
+static int atxfernoanswertimeout;
+
 static char *registrar = &quot;res_features&quot;;		/*!&lt; Registrar for operations */
 
 /* module and CLI command definitions */
@@ -426,6 +429,37 @@
 	}
 }
 
+static int builtin_parkcall(struct ast_channel *chan, struct ast_channel *peer, struct ast_bridge_config *config, char *code, int sense)
+{
+	struct ast_channel *parker;
+        struct ast_channel *parkee;
+
+	int res=0;
+	struct localuser *u;
+	LOCAL_USER_ADD(u);
+
+	set_peers(&amp;parker, &amp;parkee, peer, chan, sense);
+	/* Setup the exten/priority to be s/1 since we don't know
+	   where this call should return */
+	strcpy(chan-&gt;exten, &quot;s&quot;);
+	chan-&gt;priority = 1;
+	if (chan-&gt;_state != AST_STATE_UP)
+		res = ast_answer(chan);
+	if (!res)
+		res = ast_safe_sleep(chan, 1000);
+	if (!res)
+		res = ast_park_call(parkee, parker, 0, NULL);
+	LOCAL_USER_REMOVE(u);
+	if (!res) {
+		if (sense == FEATURE_SENSE_CHAN)
+			res = AST_PBX_NO_HANGUP_PEER;
+		else
+			res = AST_PBX_KEEPALIVE;
+	}
+	return res;
+
+}
+
 static int builtin_automonitor(struct ast_channel *chan, struct ast_channel *peer, struct ast_bridge_config *config, char *code, int sense)
 {
 	char *caller_chan_id = NULL, *callee_chan_id = NULL, *args = NULL, *touch_filename = NULL;
@@ -607,7 +641,7 @@
 		if (option_verbose &gt; 2)	
 			ast_verbose(VERBOSE_PREFIX_3 &quot;Unable to find extension '%s' in context '%s'\n&quot;, xferto, transferer_real_context);
 	}
-	if (ast_stream_and_wait(transferer, xferfailsound, transferee-&gt;language, AST_DIGIT_ANY) &lt; 0 ) {
+	if (ast_stream_and_wait(transferer, xferfailsound, transferer-&gt;language, AST_DIGIT_ANY) &lt; 0 ) {
 		finishup(transferee);
 		return -1;
 	}
@@ -691,7 +725,7 @@
 	l = strlen(xferto);
 	snprintf(xferto + l, sizeof(xferto) - l, &quot;@%s/n&quot;, transferer_real_context);	/* append context */
 	newchan = ast_feature_request_and_dial(transferer, &quot;Local&quot;, ast_best_codec(transferer-&gt;nativeformats),
-		xferto, 15000, &amp;outstate, transferer-&gt;cid.cid_num, transferer-&gt;cid.cid_name);
+		xferto, atxfernoanswertimeout, &amp;outstate, transferer-&gt;cid.cid_num, transferer-&gt;cid.cid_name);
 	ast_indicate(transferer, -1);
 	if (!newchan) {
 		finishup(transferee);
@@ -779,6 +813,7 @@
 	{ AST_FEATURE_REDIRECT, &quot;Attended Transfer&quot;, &quot;atxfer&quot;, &quot;&quot;, &quot;&quot;, builtin_atxfer, AST_FEATURE_FLAG_NEEDSDTMF },
 	{ AST_FEATURE_AUTOMON, &quot;One Touch Monitor&quot;, &quot;automon&quot;, &quot;&quot;, &quot;&quot;, builtin_automonitor, AST_FEATURE_FLAG_NEEDSDTMF },
 	{ AST_FEATURE_DISCONNECT, &quot;Disconnect Call&quot;, &quot;disconnect&quot;, &quot;*&quot;, &quot;*&quot;, builtin_disconnect, AST_FEATURE_FLAG_NEEDSDTMF },
+	{ AST_FEATURE_PARKCALL, &quot;Park Call&quot;, &quot;parkcall&quot;, &quot;&quot;, &quot;&quot;, builtin_parkcall, AST_FEATURE_FLAG_NEEDSDTMF },
 };
 
 
@@ -860,8 +895,12 @@
 	if (app) {
 		struct ast_channel *work = ast_test_flag(feature,AST_FEATURE_FLAG_CALLEE) ? peer : chan;
 		res = pbx_exec(work, app, feature-&gt;app_args);
-		if (res &lt; 0)
-			return res; 
+		if (res == AST_PBX_KEEPALIVE)
+			return FEATURE_RETURN_PBX_KEEPALIVE;
+		else if (res == AST_PBX_NO_HANGUP_PEER)
+			return FEATURE_RETURN_NO_HANGUP_PEER;
+		else if (res)
+			return FEATURE_RETURN_SUCCESSBREAK;
 	} else {
 		ast_log(LOG_WARNING, &quot;Could not find application (%s)\n&quot;, feature-&gt;app);
 		return -2;
@@ -935,7 +974,10 @@
 				if (!strcmp(feature-&gt;exten, code)) {
 					if (option_verbose &gt; 2)
 						ast_verbose(VERBOSE_PREFIX_3 &quot; Feature Found: %s exten: %s\n&quot;,feature-&gt;sname, tok);
-					res = feature-&gt;operation(chan, peer, config, code, sense);
+					if (sense == FEATURE_SENSE_CHAN)
+						res = feature-&gt;operation(chan, peer, config, code, sense);
+					else
+						res = feature-&gt;operation(peer, chan, config, code, sense);
 					break;
 				} else if (!strncmp(feature-&gt;exten, code, strlen(code))) {
 					res = FEATURE_RETURN_STOREDIGITS;
@@ -1324,6 +1366,9 @@
 			 * \todo XXX how do we guarantee the latter ?
 			 */
 			featurecode[strlen(featurecode)] = f-&gt;subclass;
+			/* Get rid of the frame before we start doing &quot;stuff&quot; with the channels */
+			ast_frfree(f);
+			f = NULL;
 			config-&gt;feature_timer = backup_config.feature_timer;
 			res = ast_feature_interpret(chan, peer, config, featurecode, sense);
 			switch(res) {
@@ -1336,10 +1381,8 @@
 			}
 			if (res &gt;= FEATURE_RETURN_PASSDIGITS) {
 				res = 0;
-			} else {
-				ast_frfree(f);
+			} else 
 				break;
-			}
 			hasfeatures = !ast_strlen_zero(chan_featurecode) || !ast_strlen_zero(peer_featurecode);
 			if (hadfeatures &amp;&amp; !hasfeatures) {
 				/* Restore backup */
@@ -1946,6 +1989,7 @@
 
 	transferdigittimeout = DEFAULT_TRANSFER_DIGIT_TIMEOUT;
 	featuredigittimeout = DEFAULT_FEATURE_DIGIT_TIMEOUT;
+	atxfernoanswertimeout = DEFAULT_NOANSWER_TIMEOUT_ATTENDED_TRANSFER;
 
 	cfg = ast_config_load(&quot;features.conf&quot;);
 	if (cfg) {
@@ -1982,6 +2026,12 @@
 					ast_log(LOG_WARNING, &quot;%s is not a valid featuredigittimeout\n&quot;, var-&gt;value);
 					featuredigittimeout = DEFAULT_FEATURE_DIGIT_TIMEOUT;
 				}
+			} else if (!strcasecmp(var-&gt;name, &quot;atxfernoanswertimeout&quot;)) {
+				if ((sscanf(var-&gt;value, &quot;%d&quot;, &amp;atxfernoanswertimeout) != 1) || (atxfernoanswertimeout &lt; 1)) {
+					ast_log(LOG_WARNING, &quot;%s is not a valid atxfernoanswertimeout\n&quot;, var-&gt;value);
+					atxfernoanswertimeout = DEFAULT_NOANSWER_TIMEOUT_ATTENDED_TRANSFER;
+				} else
+					atxfernoanswertimeout = atxfernoanswertimeout * 1000;
 			} else if (!strcasecmp(var-&gt;name, &quot;courtesytone&quot;)) {
 				ast_copy_string(courtesytone, var-&gt;value, sizeof(courtesytone));
 			}  else if (!strcasecmp(var-&gt;name, &quot;parkedplay&quot;)) {

Modified: trunk/sample.call
===================================================================
--- trunk/sample.call	2006-05-25 20:48:20 UTC (rev 180)
+++ trunk/sample.call	2006-05-26 21:12:24 UTC (rev 181)
@@ -69,3 +69,12 @@
 #Set: file2=/tmp/msg
 #Set: timestamp=20021023104500
 #Set: CDR(userfield|r)=42
+
+#
+# Setting Archive to yes the call file is never deleted, but is moved
+# in the subdir &quot;outgoing_done&quot; of the spool directory. In this case 
+# will be appended a line with &quot;Status: value&quot;, where value can be 
+# Completed, Expired or Failed.
+#
+#Archive: yes
+

Modified: trunk/utils/Makefile
===================================================================
--- trunk/utils/Makefile	2006-05-25 20:48:20 UTC (rev 180)
+++ trunk/utils/Makefile	2006-05-26 21:12:24 UTC (rev 181)
@@ -92,9 +92,9 @@
 	$(CC) $(CFLAGS) -c -g  -o ael_main1.o ael_main.c
 
 testexpr2s: ../ast_expr2f.c ../ast_expr2.c ../ast_expr2.h
-	gcc -g -c -I../include -DSTANDALONE ../ast_expr2f.c -o ast_expr2f.o
-	gcc -g -c -I../include -DSTANDALONE ../ast_expr2.c -o ast_expr2.o
-	gcc -g -o testexpr2s ast_expr2f.o ast_expr2.o
+	$(CC) -g -c -I../include -DSTANDALONE ../ast_expr2f.c -o ast_expr2f.o
+	$(CC) -g -c -I../include -DSTANDALONE ../ast_expr2.c -o ast_expr2.o
+	$(CC) -g -o testexpr2s ast_expr2f.o ast_expr2.o
 	rm ast_expr2.o ast_expr2f.o 
 	./testexpr2s expr2.testinput
 

Modified: trunk/utils/ael_main.c
===================================================================
--- trunk/utils/ael_main.c	2006-05-25 20:48:20 UTC (rev 180)
+++ trunk/utils/ael_main.c	2006-05-26 21:12:24 UTC (rev 181)
@@ -1,6 +1,7 @@
 #include &lt;sys/types.h&gt;
 #include &lt;stdio.h&gt;
 #include &lt;stdlib.h&gt;
+#include &lt;stdarg.h&gt;
 #include &lt;string.h&gt;
 #include &lt;locale.h&gt;
 #include &lt;ctype.h&gt;
@@ -12,10 +13,7 @@
 #include &lt;limits.h&gt;
 
 #include &quot;asterisk/ast_expr.h&quot;
-#include &quot;asterisk/logger.h&quot;
 #include &quot;asterisk/module.h&quot;
-#include &quot;asterisk/channel.h&quot;
-#include &quot;asterisk/app.h&quot;
 #include &quot;asterisk/ael_structs.h&quot;
 
 #define AST_CONFIG_MAX_PATH 255
@@ -25,6 +23,7 @@
 char ast_config_AST_CONFIG_DIR[AST_CONFIG_MAX_PATH];
 char ast_config_AST_VAR_DIR[AST_CONFIG_MAX_PATH];
 
+void ast_add_profile(void);
 void ast_cli_register_multiple(void);
 void ast_register_file_version(void);
 void ast_unregister_file_version(void);
@@ -54,6 +53,12 @@
 	return (struct ast_app*)1; /* so as not to trigger an error */
 }
 
+void ast_add_profile(void)
+{
+	if (!no_comp)
+		printf(&quot;Executed ast_add_profile();\n&quot;);
+}
+
 void ast_cli_register_multiple(void)
 {
 	if(!no_comp)


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="000175.html">[solid-pbx-svn] r180 - in trunk: . apps channels pbx
</A></li>
	<LI>Next message: <A HREF="000177.html">[solid-pbx-svn] r182 - in trunk: cdr channels configs contrib doc include/asterisk res
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#176">[ date ]</a>
              <a href="thread.html#176">[ thread ]</a>
              <a href="subject.html#176">[ subject ]</a>
              <a href="author.html#176">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.berlios.de/mailman/listinfo/solid-pbx-svn">More information about the solid-pbx-svn
mailing list</a><br>
</body></html>
