<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [solid-pbx-svn] r33 - in trunk: channels pbx/ael
   </TITLE>
   <LINK REL="Index" HREF="http://lists.berlios.de/pipermail/solid-pbx-svn/2006-May/index.html" >
   <LINK REL="made" HREF="mailto:solid-pbx-svn%40lists.berlios.de?Subject=Re%3A%20%5Bsolid-pbx-svn%5D%20r33%20-%20in%20trunk%3A%20channels%20pbx/ael&In-Reply-To=%3C200605021518.k42FIL3G028925%40sheep.berlios.de%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="000029.html">
   <LINK REL="Next"  HREF="000031.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[solid-pbx-svn] r33 - in trunk: channels pbx/ael</H1>
    <B>solid-pbx-svn-admin at lists.berlios.de</B> 
    <A HREF="mailto:solid-pbx-svn%40lists.berlios.de?Subject=Re%3A%20%5Bsolid-pbx-svn%5D%20r33%20-%20in%20trunk%3A%20channels%20pbx/ael&In-Reply-To=%3C200605021518.k42FIL3G028925%40sheep.berlios.de%3E"
       TITLE="[solid-pbx-svn] r33 - in trunk: channels pbx/ael">solid-pbx-svn-admin at lists.berlios.de
       </A><BR>
    <I>Tue May  2 17:18:21 CEST 2006</I>
    <P><UL>
        <LI>Previous message: <A HREF="000029.html">[solid-pbx-svn] r32 - trunk/channels
</A></li>
        <LI>Next message: <A HREF="000031.html">[solid-pbx-svn] r34 - in trunk: . utils
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#30">[ date ]</a>
              <a href="thread.html#30">[ thread ]</a>
              <a href="subject.html#30">[ subject ]</a>
              <a href="author.html#30">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Author: casper2
Date: 2006-05-02 17:18:15 +0200 (Tue, 02 May 2006)
New Revision: 33

Modified:
   trunk/channels/chan_misdn.c
   trunk/pbx/ael/ael.tab.c
   trunk/pbx/ael/ael.y
Log:
Update to Asterisk SVN trunk r24202

------------------------------------------------------------------------
r24173 | rizzo | 2006-05-02 16:08:18 +0200 (Tue, 02 May 2006) | 4 lines

correct linku1() to handle the case tail = NULL correctly.
Now the function can be used to simplify other conditional blocks.


------------------------------------------------------------------------
r24174 | rizzo | 2006-05-02 16:12:01 +0200 (Tue, 02 May 2006) | 2 lines

more simplifications involving linku1

------------------------------------------------------------------------
r24175 | rizzo | 2006-05-02 16:25:01 +0200 (Tue, 02 May 2006) | 4 lines

more usage of nword(). I think the references to source
line/columns are also correct now.


------------------------------------------------------------------------
r24177 | crichter | 2006-05-02 16:26:40 +0200 (Tue, 02 May 2006) | 1 line

use set_callerid to update callerid with prefix
------------------------------------------------------------------------
r24178 | rizzo | 2006-05-02 16:27:19 +0200 (Tue, 02 May 2006) | 3 lines

remove some unneeded local variables.


------------------------------------------------------------------------


Modified: trunk/channels/chan_misdn.c
===================================================================
--- trunk/channels/chan_misdn.c	2006-05-02 14:18:07 UTC (rev 32)
+++ trunk/channels/chan_misdn.c	2006-05-02 15:18:15 UTC (rev 33)
@@ -1508,9 +1508,7 @@
 			ast_copy_string(ast-&gt;exten, bc-&gt;dad, sizeof(ast-&gt;exten));
 		}
 		
-		if ( !ast-&gt;cid.cid_num) {
-			ast_set_callerid(ast, bc-&gt;oad, NULL, bc-&gt;oad);
-		}
+		ast_set_callerid(ast, bc-&gt;oad, NULL, bc-&gt;oad);
 		
 		if ( !ast_strlen_zero(bc-&gt;rad) ) {
 			if (ast-&gt;cid.cid_rdnis)

Modified: trunk/pbx/ael/ael.tab.c
===================================================================
--- trunk/pbx/ael/ael.tab.c	2006-05-02 14:18:07 UTC (rev 32)
+++ trunk/pbx/ael/ael.tab.c	2006-05-02 15:18:15 UTC (rev 33)
@@ -562,22 +562,22 @@
 /* YYRLINE[YYN] -- source line where rule number YYN was defined.  */
 static const unsigned short int yyrline[] =
 {
-       0,   176,   176,   179,   180,   191,   194,   195,   196,   197,
-     200,   201,   204,   212,   213,   216,   219,   222,   226,   231,
-     234,   238,   239,   240,   243,   243,   249,   250,   254,   257,
-     258,   261,   262,   263,   266,   269,   270,   271,   272,   273,
-     274,   274,   278,   279,   282,   287,   291,   296,   301,   310,
-     311,   314,   317,   317,   322,   322,   327,   340,   356,   357,
-     364,   365,   370,   378,   379,   383,   389,   389,   397,   400,
-     400,   404,   407,   410,   413,   414,   415,   413,   421,   421,
-     425,   427,   430,   432,   434,   437,   437,   470,   471,   472,
-     473,   477,   481,   485,   488,   489,   494,   495,   498,   501,
-     505,   509,   513,   520,   523,   526,   533,   540,   547,   556,
-     556,   561,   569,   569,   580,   587,   590,   591,   594,   595,
-     598,   604,   605,   610,   614,   618,   622,   625,   628,   633,
-     634,   639,   640,   646,   651,   656,   657,   660,   663,   668,
-     671,   674,   688,   697,   702,   717,   729,   732,   733,   736,
-     739
+       0,   176,   176,   179,   180,   181,   184,   185,   186,   187,
+     190,   191,   194,   202,   203,   206,   209,   212,   216,   221,
+     224,   228,   229,   230,   233,   233,   239,   240,   241,   244,
+     245,   248,   249,   250,   251,   254,   255,   256,   257,   258,
+     259,   259,   263,   264,   267,   272,   276,   281,   286,   295,
+     296,   297,   300,   300,   305,   305,   310,   323,   339,   340,
+     347,   348,   353,   361,   362,   366,   372,   372,   380,   383,
+     383,   387,   390,   393,   396,   397,   398,   396,   404,   404,
+     408,   410,   413,   415,   417,   420,   420,   453,   454,   455,
+     456,   460,   464,   468,   471,   472,   477,   478,   481,   484,
+     488,   492,   496,   503,   506,   509,   513,   517,   521,   527,
+     527,   532,   540,   540,   551,   558,   561,   562,   565,   566,
+     569,   572,   573,   576,   580,   584,   588,   591,   594,   599,
+     600,   603,   604,   610,   615,   620,   621,   624,   625,   626,
+     629,   630,   643,   651,   652,   666,   677,   680,   681,   684,
+     687
 };
 #endif
 
@@ -1941,56 +1941,47 @@
     break;
 
   case 4:
-#line 181 &quot;ael.y&quot;
-    {
-			if ( (yyvsp[-1].pval) &amp;&amp; (yyvsp[0].pval) ) {
-				(yyval.pval)=(yyvsp[-1].pval);
-				linku1((yyval.pval),(yyvsp[0].pval));
-			} else if ( (yyvsp[-1].pval) ) {
-				(yyval.pval)=(yyvsp[-1].pval);
-			} else if ( (yyvsp[0].pval) ) {
-				(yyval.pval)=(yyvsp[0].pval);
-			}
-		;}
+#line 180 &quot;ael.y&quot;
+    { (yyval.pval) = linku1((yyvsp[-1].pval), (yyvsp[0].pval)); ;}
     break;
 
   case 5:
-#line 191 &quot;ael.y&quot;
+#line 181 &quot;ael.y&quot;
     {(yyval.pval)=(yyvsp[-1].pval);;}
     break;
 
   case 6:
-#line 194 &quot;ael.y&quot;
+#line 184 &quot;ael.y&quot;
     {(yyval.pval)=(yyvsp[0].pval);;}
     break;
 
   case 7:
-#line 195 &quot;ael.y&quot;
+#line 185 &quot;ael.y&quot;
     {(yyval.pval)=(yyvsp[0].pval);;}
     break;
 
   case 8:
-#line 196 &quot;ael.y&quot;
+#line 186 &quot;ael.y&quot;
     {(yyval.pval)=(yyvsp[0].pval);;}
     break;
 
   case 9:
-#line 197 &quot;ael.y&quot;
+#line 187 &quot;ael.y&quot;
     {(yyval.pval)=0;/* allow older docs to be read */;}
     break;
 
   case 10:
-#line 200 &quot;ael.y&quot;
+#line 190 &quot;ael.y&quot;
     { (yyval.str) = (yyvsp[0].str); ;}
     break;
 
   case 11:
-#line 201 &quot;ael.y&quot;
+#line 191 &quot;ael.y&quot;
     { (yyval.str) = strdup(&quot;default&quot;); ;}
     break;
 
   case 12:
-#line 204 &quot;ael.y&quot;
+#line 194 &quot;ael.y&quot;
     {
 		(yyval.pval) = npval2(PV_CONTEXT, &amp;(yylsp[-3]), &amp;(yylsp[0]));
 		(yyval.pval)-&gt;u1.str = (yyvsp[-1].str);
@@ -1999,31 +1990,31 @@
     break;
 
   case 13:
-#line 212 &quot;ael.y&quot;
+#line 202 &quot;ael.y&quot;
     { (yyval.intval) = 1; ;}
     break;
 
   case 14:
-#line 213 &quot;ael.y&quot;
+#line 203 &quot;ael.y&quot;
     { (yyval.intval) = 0; ;}
     break;
 
   case 15:
-#line 216 &quot;ael.y&quot;
+#line 206 &quot;ael.y&quot;
     {
 		(yyval.pval) = npval2(PV_MACRO, &amp;(yylsp[-7]), &amp;(yylsp[0]));
 		(yyval.pval)-&gt;u1.str = (yyvsp[-6].str); (yyval.pval)-&gt;u2.arglist = (yyvsp[-4].pval); (yyval.pval)-&gt;u3.macro_statements = (yyvsp[-1].pval); ;}
     break;
 
   case 16:
-#line 219 &quot;ael.y&quot;
+#line 209 &quot;ael.y&quot;
     {
 		(yyval.pval) = npval2(PV_MACRO, &amp;(yylsp[-6]), &amp;(yylsp[0]));
 		(yyval.pval)-&gt;u1.str = (yyvsp[-5].str); (yyval.pval)-&gt;u2.arglist = (yyvsp[-3].pval); ;}
     break;
 
   case 17:
-#line 222 &quot;ael.y&quot;
+#line 212 &quot;ael.y&quot;
     {
 		(yyval.pval) = npval2(PV_MACRO, &amp;(yylsp[-6]), &amp;(yylsp[0]));
 		(yyval.pval)-&gt;u1.str = (yyvsp[-5].str);
@@ -2031,47 +2022,47 @@
     break;
 
   case 18:
-#line 226 &quot;ael.y&quot;
+#line 216 &quot;ael.y&quot;
     {
 		(yyval.pval) = npval2(PV_MACRO, &amp;(yylsp[-5]), &amp;(yylsp[0]));
 		(yyval.pval)-&gt;u1.str = (yyvsp[-4].str); ;}
     break;
 
   case 19:
-#line 231 &quot;ael.y&quot;
+#line 221 &quot;ael.y&quot;
     {
 		(yyval.pval) = npval2(PV_GLOBALS, &amp;(yylsp[-3]), &amp;(yylsp[0]));
 		(yyval.pval)-&gt;u1.statements = (yyvsp[-1].pval);;}
     break;
 
   case 20:
-#line 234 &quot;ael.y&quot;
+#line 224 &quot;ael.y&quot;
     { /* empty globals is OK */
 		(yyval.pval) = npval2(PV_GLOBALS, &amp;(yylsp[-2]), &amp;(yylsp[0])); ;}
     break;
 
   case 21:
-#line 238 &quot;ael.y&quot;
+#line 228 &quot;ael.y&quot;
     {(yyval.pval)=(yyvsp[0].pval);;}
     break;
 
   case 22:
-#line 239 &quot;ael.y&quot;
-    {(yyval.pval)=(yyvsp[-1].pval); linku1((yyval.pval),(yyvsp[0].pval));;}
+#line 229 &quot;ael.y&quot;
+    {(yyval.pval) = linku1((yyvsp[-1].pval), (yyvsp[0].pval)); ;}
     break;
 
   case 23:
-#line 240 &quot;ael.y&quot;
+#line 230 &quot;ael.y&quot;
     {(yyval.pval)=(yyvsp[-1].pval);;}
     break;
 
   case 24:
-#line 243 &quot;ael.y&quot;
+#line 233 &quot;ael.y&quot;
     { reset_semicount(parseio-&gt;scanner); ;}
     break;
 
   case 25:
-#line 243 &quot;ael.y&quot;
+#line 233 &quot;ael.y&quot;
     {
 		(yyval.pval) = npval2(PV_VARDEC, &amp;(yylsp[-4]), &amp;(yylsp[0]));
 		(yyval.pval)-&gt;u1.str = (yyvsp[-4].str);
@@ -2079,87 +2070,82 @@
     break;
 
   case 26:
-#line 249 &quot;ael.y&quot;
-    { (yyval.pval)= nword((yyvsp[0].str), &amp;(yylsp[0])); ;}
+#line 239 &quot;ael.y&quot;
+    { (yyval.pval) = nword((yyvsp[0].str), &amp;(yylsp[0])); ;}
     break;
 
   case 27:
-#line 250 &quot;ael.y&quot;
-    {
-		pval *z = npval2(PV_WORD, &amp;(yylsp[-2]), &amp;(yylsp[0]));
-		z-&gt;u1.str = (yyvsp[0].str);
-		(yyval.pval) = linku1((yyvsp[-2].pval),z); ;}
+#line 240 &quot;ael.y&quot;
+    { (yyval.pval) = linku1((yyvsp[-2].pval), nword((yyvsp[0].str), &amp;(yylsp[0]))); ;}
     break;
 
   case 28:
-#line 254 &quot;ael.y&quot;
+#line 241 &quot;ael.y&quot;
     {(yyval.pval)=(yyvsp[-1].pval);;}
     break;
 
   case 29:
-#line 257 &quot;ael.y&quot;
+#line 244 &quot;ael.y&quot;
     { (yyval.pval) = NULL; ;}
     break;
 
   case 30:
-#line 258 &quot;ael.y&quot;
+#line 245 &quot;ael.y&quot;
     { (yyval.pval) = (yyvsp[-1].pval); ;}
     break;
 
   case 31:
-#line 261 &quot;ael.y&quot;
+#line 248 &quot;ael.y&quot;
     { (yyval.pval)=(yyvsp[0].pval);;}
     break;
 
   case 32:
-#line 262 &quot;ael.y&quot;
+#line 249 &quot;ael.y&quot;
     {(yyval.pval)=0;;}
     break;
 
   case 33:
-#line 263 &quot;ael.y&quot;
-    { if ( (yyvsp[-1].pval) &amp;&amp; (yyvsp[0].pval) ) {(yyval.pval)=(yyvsp[-1].pval); linku1((yyval.pval),(yyvsp[0].pval));}
-				else if ( (yyvsp[-1].pval) ) {(yyval.pval)=(yyvsp[-1].pval);}
-				else if ( (yyvsp[0].pval) ) {(yyval.pval)=(yyvsp[0].pval);} ;}
+#line 250 &quot;ael.y&quot;
+    { (yyval.pval) = linku1((yyvsp[-1].pval), (yyvsp[0].pval)); ;}
     break;
 
   case 34:
-#line 266 &quot;ael.y&quot;
+#line 251 &quot;ael.y&quot;
     { (yyval.pval)=(yyvsp[-1].pval);;}
     break;
 
   case 35:
-#line 269 &quot;ael.y&quot;
+#line 254 &quot;ael.y&quot;
     {(yyval.pval)=(yyvsp[0].pval);;}
     break;
 
   case 36:
-#line 270 &quot;ael.y&quot;
+#line 255 &quot;ael.y&quot;
     {(yyval.pval)=(yyvsp[0].pval);;}
     break;
 
   case 37:
-#line 271 &quot;ael.y&quot;
+#line 256 &quot;ael.y&quot;
     {(yyval.pval)=(yyvsp[0].pval);;}
     break;
 
   case 38:
-#line 272 &quot;ael.y&quot;
+#line 257 &quot;ael.y&quot;
     {(yyval.pval)=(yyvsp[0].pval);;}
     break;
 
   case 39:
-#line 273 &quot;ael.y&quot;
+#line 258 &quot;ael.y&quot;
     {(yyval.pval)=(yyvsp[0].pval);;}
     break;
 
   case 40:
-#line 274 &quot;ael.y&quot;
+#line 259 &quot;ael.y&quot;
     { reset_semicount(parseio-&gt;scanner); ;}
     break;
 
   case 41:
-#line 274 &quot;ael.y&quot;
+#line 259 &quot;ael.y&quot;
     {
 		(yyval.pval) = npval2(PV_VARDEC, &amp;(yylsp[-4]), &amp;(yylsp[0]));
 		(yyval.pval)-&gt;u1.str = (yyvsp[-4].str);
@@ -2167,24 +2153,24 @@
     break;
 
   case 42:
-#line 278 &quot;ael.y&quot;
+#line 263 &quot;ael.y&quot;
     {free((yyvsp[-1].str)); (yyval.pval)=0;;}
     break;
 
   case 43:
-#line 279 &quot;ael.y&quot;
+#line 264 &quot;ael.y&quot;
     {(yyval.pval)=0;/* allow older docs to be read */;}
     break;
 
   case 44:
-#line 282 &quot;ael.y&quot;
+#line 267 &quot;ael.y&quot;
     {
 		(yyval.pval) = npval2(PV_IGNOREPAT, &amp;(yylsp[-3]), &amp;(yylsp[0]));
 		(yyval.pval)-&gt;u1.str = (yyvsp[-1].str);;}
     break;
 
   case 45:
-#line 287 &quot;ael.y&quot;
+#line 272 &quot;ael.y&quot;
     {
 		(yyval.pval) = npval2(PV_EXTENSION, &amp;(yylsp[-2]), &amp;(yylsp[0]));
 		(yyval.pval)-&gt;u1.str = (yyvsp[-2].str);
@@ -2192,7 +2178,7 @@
     break;
 
   case 46:
-#line 291 &quot;ael.y&quot;
+#line 276 &quot;ael.y&quot;
     {
 		(yyval.pval) = npval2(PV_EXTENSION, &amp;(yylsp[-3]), &amp;(yylsp[0]));
 		(yyval.pval)-&gt;u1.str = (yyvsp[-2].str);
@@ -2201,7 +2187,7 @@
     break;
 
   case 47:
-#line 296 &quot;ael.y&quot;
+#line 281 &quot;ael.y&quot;
     {
 		(yyval.pval) = npval2(PV_EXTENSION, &amp;(yylsp[-6]), &amp;(yylsp[0]));
 		(yyval.pval)-&gt;u1.str = (yyvsp[-2].str);
@@ -2210,7 +2196,7 @@
     break;
 
   case 48:
-#line 301 &quot;ael.y&quot;
+#line 286 &quot;ael.y&quot;
     {
 		(yyval.pval) = npval2(PV_EXTENSION, &amp;(yylsp[-7]), &amp;(yylsp[0]));
 		(yyval.pval)-&gt;u1.str = (yyvsp[-2].str);
@@ -2220,51 +2206,49 @@
     break;
 
   case 49:
-#line 310 &quot;ael.y&quot;
+#line 295 &quot;ael.y&quot;
     {(yyval.pval)=(yyvsp[0].pval);;}
     break;
 
   case 50:
-#line 311 &quot;ael.y&quot;
-    {if ( (yyvsp[-1].pval) &amp;&amp; (yyvsp[0].pval) ) {(yyval.pval)=(yyvsp[-1].pval); linku1((yyval.pval),(yyvsp[0].pval));}
-						 else if ( (yyvsp[-1].pval) ) {(yyval.pval)=(yyvsp[-1].pval);}
-						 else if ( (yyvsp[0].pval) ) {(yyval.pval)=(yyvsp[0].pval);} ;}
+#line 296 &quot;ael.y&quot;
+    { (yyval.pval) = linku1((yyvsp[-1].pval), (yyvsp[0].pval)); ;}
     break;
 
   case 51:
-#line 314 &quot;ael.y&quot;
+#line 297 &quot;ael.y&quot;
     {(yyval.pval)=(yyvsp[-1].pval);;}
     break;
 
   case 52:
-#line 317 &quot;ael.y&quot;
+#line 300 &quot;ael.y&quot;
     { reset_parencount(parseio-&gt;scanner); ;}
     break;
 
   case 53:
-#line 317 &quot;ael.y&quot;
+#line 300 &quot;ael.y&quot;
     {
 		(yyval.pval)= npval2(PV_IF, &amp;(yylsp[-4]), &amp;(yylsp[0]));
 		(yyval.pval)-&gt;u1.str = (yyvsp[-1].str); ;}
     break;
 
   case 54:
-#line 322 &quot;ael.y&quot;
+#line 305 &quot;ael.y&quot;
     { reset_parencount(parseio-&gt;scanner); ;}
     break;
 
   case 55:
-#line 322 &quot;ael.y&quot;
+#line 305 &quot;ael.y&quot;
     {
 		(yyval.pval) = npval2(PV_RANDOM, &amp;(yylsp[-4]), &amp;(yylsp[0]));
 		(yyval.pval)-&gt;u1.str=(yyvsp[-1].str);;}
     break;
 
   case 56:
-#line 328 &quot;ael.y&quot;
+#line 311 &quot;ael.y&quot;
     {
-		(yyval.pval) = npval2(PV_IFTIME, &amp;(yylsp[-13]), &amp;(yylsp[-9])); /* XXX really @5 or more ? */
-		(yyval.pval)-&gt;u1.list = npval2(PV_WORD, &amp;(yylsp[-11]), &amp;(yylsp[-11]));
+		(yyval.pval) = npval2(PV_IFTIME, &amp;(yylsp[-13]), &amp;(yylsp[-13]));
+		(yyval.pval)-&gt;u1.list = npval2(PV_WORD, &amp;(yylsp[-11]), &amp;(yylsp[-7]));
 		asprintf(&amp;((yyval.pval)-&gt;u1.list-&gt;u1.str), &quot;%s:%s:%s&quot;, (yyvsp[-11].str), (yyvsp[-9].str), (yyvsp[-7].str));
 		free((yyvsp[-11].str));
 		free((yyvsp[-9].str));
@@ -2277,7 +2261,7 @@
     break;
 
   case 57:
-#line 340 &quot;ael.y&quot;
+#line 323 &quot;ael.y&quot;
     {
 		(yyval.pval) = npval2(PV_IFTIME, &amp;(yylsp[-9]), &amp;(yylsp[-5])); /* XXX @5 or greater ? */
 		(yyval.pval)-&gt;u1.list = nword((yyvsp[-7].str), &amp;(yylsp[-7]));
@@ -2289,12 +2273,12 @@
     break;
 
   case 58:
-#line 356 &quot;ael.y&quot;
+#line 339 &quot;ael.y&quot;
     { (yyval.str) = (yyvsp[0].str);;}
     break;
 
   case 59:
-#line 357 &quot;ael.y&quot;
+#line 340 &quot;ael.y&quot;
     {
 		asprintf(&amp;((yyval.str)), &quot;%s%s&quot;, (yyvsp[-1].str), (yyvsp[0].str));
 		free((yyvsp[-1].str));
@@ -2303,12 +2287,12 @@
     break;
 
   case 60:
-#line 364 &quot;ael.y&quot;
+#line 347 &quot;ael.y&quot;
     { (yyval.str) = (yyvsp[0].str);;}
     break;
 
   case 61:
-#line 365 &quot;ael.y&quot;
+#line 348 &quot;ael.y&quot;
     {
 		asprintf(&amp;((yyval.str)), &quot;%s%s&quot;, (yyvsp[-1].str), (yyvsp[0].str));
 		free((yyvsp[-1].str));
@@ -2317,7 +2301,7 @@
     break;
 
   case 62:
-#line 370 &quot;ael.y&quot;
+#line 353 &quot;ael.y&quot;
     {
 		asprintf(&amp;((yyval.str)), &quot;%s%s%s&quot;, (yyvsp[-2].str), (yyvsp[-1].str), (yyvsp[0].str));
 		free((yyvsp[-2].str));
@@ -2327,12 +2311,12 @@
     break;
 
   case 63:
-#line 378 &quot;ael.y&quot;
+#line 361 &quot;ael.y&quot;
     { (yyval.str) = (yyvsp[0].str);;}
     break;
 
   case 64:
-#line 379 &quot;ael.y&quot;
+#line 362 &quot;ael.y&quot;
     {
 		asprintf(&amp;((yyval.str)), &quot;%s%s&quot;, (yyvsp[-1].str), (yyvsp[0].str));
 		free((yyvsp[-1].str));
@@ -2340,7 +2324,7 @@
     break;
 
   case 65:
-#line 383 &quot;ael.y&quot;
+#line 366 &quot;ael.y&quot;
     {
 		asprintf(&amp;((yyval.str)), &quot;%s:%s&quot;, (yyvsp[-2].str), (yyvsp[0].str));
 		free((yyvsp[-2].str));
@@ -2348,31 +2332,31 @@
     break;
 
   case 66:
-#line 389 &quot;ael.y&quot;
+#line 372 &quot;ael.y&quot;
     { reset_parencount(parseio-&gt;scanner); ;}
     break;
 
   case 67:
-#line 389 &quot;ael.y&quot;
+#line 372 &quot;ael.y&quot;
     {
 		(yyval.pval) = npval2(PV_SWITCH, &amp;(yylsp[-5]), &amp;(yylsp[0]));
 		(yyval.pval)-&gt;u1.str = (yyvsp[-2].str); ;}
     break;
 
   case 68:
-#line 397 &quot;ael.y&quot;
+#line 380 &quot;ael.y&quot;
     {
 		(yyval.pval) = npval2(PV_STATEMENTBLOCK, &amp;(yylsp[-2]), &amp;(yylsp[0]));
 		(yyval.pval)-&gt;u1.list = (yyvsp[-1].pval); ;}
     break;
 
   case 69:
-#line 400 &quot;ael.y&quot;
+#line 383 &quot;ael.y&quot;
     {reset_semicount(parseio-&gt;scanner);;}
     break;
 
   case 70:
-#line 400 &quot;ael.y&quot;
+#line 383 &quot;ael.y&quot;
     {
 		(yyval.pval) = npval2(PV_VARDEC, &amp;(yylsp[-4]), &amp;(yylsp[0]));
 		(yyval.pval)-&gt;u1.str = (yyvsp[-4].str);
@@ -2380,43 +2364,43 @@
     break;
 
   case 71:
-#line 404 &quot;ael.y&quot;
+#line 387 &quot;ael.y&quot;
     {
 		(yyval.pval) = npval2(PV_GOTO, &amp;(yylsp[-2]), &amp;(yylsp[0]));
 		(yyval.pval)-&gt;u1.list = (yyvsp[-1].pval);;}
     break;
 
   case 72:
-#line 407 &quot;ael.y&quot;
+#line 390 &quot;ael.y&quot;
     {
 		(yyval.pval) = npval2(PV_GOTO, &amp;(yylsp[-2]), &amp;(yylsp[0]));
 		(yyval.pval)-&gt;u1.list = (yyvsp[-1].pval);;}
     break;
 
   case 73:
-#line 410 &quot;ael.y&quot;
+#line 393 &quot;ael.y&quot;
     {
 		(yyval.pval) = npval2(PV_LABEL, &amp;(yylsp[-1]), &amp;(yylsp[0]));
 		(yyval.pval)-&gt;u1.str = (yyvsp[-1].str); ;}
     break;
 
   case 74:
-#line 413 &quot;ael.y&quot;
+#line 396 &quot;ael.y&quot;
     {reset_semicount(parseio-&gt;scanner);;}
     break;
 
   case 75:
-#line 414 &quot;ael.y&quot;
+#line 397 &quot;ael.y&quot;
     {reset_semicount(parseio-&gt;scanner);;}
     break;
 
   case 76:
-#line 415 &quot;ael.y&quot;
+#line 398 &quot;ael.y&quot;
     {reset_parencount(parseio-&gt;scanner);;}
     break;
 
   case 77:
-#line 415 &quot;ael.y&quot;
+#line 398 &quot;ael.y&quot;
     {
 		(yyval.pval) = npval2(PV_FOR, &amp;(yylsp[-11]), &amp;(yylsp[0]));
 		(yyval.pval)-&gt;u1.for_init = (yyvsp[-8].str);
@@ -2426,12 +2410,12 @@
     break;
 
   case 78:
-#line 421 &quot;ael.y&quot;
+#line 404 &quot;ael.y&quot;
     {reset_parencount(parseio-&gt;scanner);;}
     break;
 
   case 79:
-#line 421 &quot;ael.y&quot;
+#line 404 &quot;ael.y&quot;
     {
 		(yyval.pval) = npval2(PV_WHILE, &amp;(yylsp[-5]), &amp;(yylsp[0]));
 		(yyval.pval)-&gt;u1.str = (yyvsp[-2].str);
@@ -2439,44 +2423,44 @@
     break;
 
   case 80:
-#line 425 &quot;ael.y&quot;
+#line 408 &quot;ael.y&quot;
     {
 		(yyval.pval) = update_last((yyvsp[-1].pval), &amp;(yylsp[0])); ;}
     break;
 
   case 81:
-#line 427 &quot;ael.y&quot;
+#line 410 &quot;ael.y&quot;
     {
 		(yyval.pval) = update_last((yyvsp[-2].pval), &amp;(yylsp[0]));
 		(yyval.pval)-&gt;u2.statements = (yyvsp[-1].pval);;}
     break;
 
   case 82:
-#line 430 &quot;ael.y&quot;
+#line 413 &quot;ael.y&quot;
     {
 		(yyval.pval) = update_last((yyvsp[-1].pval), &amp;(yylsp[-1])); ;}
     break;
 
   case 83:
-#line 432 &quot;ael.y&quot;
+#line 415 &quot;ael.y&quot;
     {
 		(yyval.pval) = update_last((yyvsp[-1].pval), &amp;(yylsp[0])); ;}
     break;
 
   case 84:
-#line 434 &quot;ael.y&quot;
+#line 417 &quot;ael.y&quot;
     {
 		(yyval.pval)= npval2(PV_APPLICATION_CALL, &amp;(yylsp[-1]), &amp;(yylsp[0]));
 		(yyval.pval)-&gt;u1.str = (yyvsp[-1].str);;}
     break;
 
   case 85:
-#line 437 &quot;ael.y&quot;
+#line 420 &quot;ael.y&quot;
     {reset_semicount(parseio-&gt;scanner);;}
     break;
 
   case 86:
-#line 437 &quot;ael.y&quot;
+#line 420 &quot;ael.y&quot;
     {
 		char *bufx;
 		int tot=0;
@@ -2513,22 +2497,22 @@
     break;
 
   case 87:
-#line 470 &quot;ael.y&quot;
+#line 453 &quot;ael.y&quot;
     { (yyval.pval) = npval2(PV_BREAK, &amp;(yylsp[-1]), &amp;(yylsp[0])); ;}
     break;
 
   case 88:
-#line 471 &quot;ael.y&quot;
+#line 454 &quot;ael.y&quot;
     { (yyval.pval) = npval2(PV_RETURN, &amp;(yylsp[-1]), &amp;(yylsp[0])); ;}
     break;
 
   case 89:
-#line 472 &quot;ael.y&quot;
+#line 455 &quot;ael.y&quot;
     { (yyval.pval) = npval2(PV_CONTINUE, &amp;(yylsp[-1]), &amp;(yylsp[0])); ;}
     break;
 
   case 90:
-#line 473 &quot;ael.y&quot;
+#line 456 &quot;ael.y&quot;
     {
 		(yyval.pval) = update_last((yyvsp[-2].pval), &amp;(yylsp[-1])); /* XXX probably @3... */
 		(yyval.pval)-&gt;u2.statements = (yyvsp[-1].pval);
@@ -2536,7 +2520,7 @@
     break;
 
   case 91:
-#line 477 &quot;ael.y&quot;
+#line 460 &quot;ael.y&quot;
     {
 		(yyval.pval) = update_last((yyvsp[-2].pval), &amp;(yylsp[-1])); /* XXX probably @3... */
 		(yyval.pval)-&gt;u2.statements = (yyvsp[-1].pval);
@@ -2544,7 +2528,7 @@
     break;
 
   case 92:
-#line 481 &quot;ael.y&quot;
+#line 464 &quot;ael.y&quot;
     {
 		(yyval.pval) = update_last((yyvsp[-2].pval), &amp;(yylsp[-1])); /* XXX probably @3... */
 		(yyval.pval)-&gt;u2.statements = (yyvsp[-1].pval);
@@ -2552,41 +2536,41 @@
     break;
 
   case 93:
-#line 485 &quot;ael.y&quot;
+#line 468 &quot;ael.y&quot;
     { (yyval.pval)=0; ;}
     break;
 
   case 94:
-#line 488 &quot;ael.y&quot;
+#line 471 &quot;ael.y&quot;
     { (yyval.pval) = (yyvsp[0].pval); ;}
     break;
 
   case 95:
-#line 489 &quot;ael.y&quot;
+#line 472 &quot;ael.y&quot;
     { (yyval.pval) = NULL ; ;}
     break;
 
   case 96:
-#line 494 &quot;ael.y&quot;
+#line 477 &quot;ael.y&quot;
     { (yyval.pval) = nword((yyvsp[0].str), &amp;(yylsp[0])); ;}
     break;
 
   case 97:
-#line 495 &quot;ael.y&quot;
+#line 478 &quot;ael.y&quot;
     {
 		(yyval.pval) = nword((yyvsp[-2].str), &amp;(yylsp[-2]));
 		(yyval.pval)-&gt;next = nword((yyvsp[0].str), &amp;(yylsp[0])); ;}
     break;
 
   case 98:
-#line 498 &quot;ael.y&quot;
+#line 481 &quot;ael.y&quot;
     {
 		(yyval.pval) = nword((yyvsp[-2].str), &amp;(yylsp[-2]));
 		(yyval.pval)-&gt;next = nword((yyvsp[0].str), &amp;(yylsp[0])); ;}
     break;
 
   case 99:
-#line 501 &quot;ael.y&quot;
+#line 484 &quot;ael.y&quot;
     {
 		(yyval.pval) = nword((yyvsp[-4].str), &amp;(yylsp[-4]));
 		(yyval.pval)-&gt;next = nword((yyvsp[-2].str), &amp;(yylsp[-2]));
@@ -2594,7 +2578,7 @@
     break;
 
   case 100:
-#line 505 &quot;ael.y&quot;
+#line 488 &quot;ael.y&quot;
     {
 		(yyval.pval) = nword((yyvsp[-4].str), &amp;(yylsp[-4]));
 		(yyval.pval)-&gt;next = nword((yyvsp[-2].str), &amp;(yylsp[-2]));
@@ -2602,7 +2586,7 @@
     break;
 
   case 101:
-#line 509 &quot;ael.y&quot;
+#line 492 &quot;ael.y&quot;
     {
 		(yyval.pval) = nword(strdup(&quot;default&quot;), &amp;(yylsp[-4]));
 		(yyval.pval)-&gt;next = nword((yyvsp[-2].str), &amp;(yylsp[-2]));
@@ -2610,7 +2594,7 @@
     break;
 
   case 102:
-#line 513 &quot;ael.y&quot;
+#line 496 &quot;ael.y&quot;
     {
 		(yyval.pval) = nword(strdup(&quot;default&quot;), &amp;(yylsp[-4]));
 		(yyval.pval)-&gt;next = nword((yyvsp[-2].str), &amp;(yylsp[-2]));
@@ -2618,70 +2602,58 @@
     break;
 
   case 103:
-#line 520 &quot;ael.y&quot;
+#line 503 &quot;ael.y&quot;
     {
 		(yyval.pval) = nword((yyvsp[0].str), &amp;(yylsp[0]));
 		(yyval.pval)-&gt;next = nword(strdup(&quot;1&quot;), &amp;(yylsp[0])); ;}
     break;
 
   case 104:
-#line 523 &quot;ael.y&quot;
+#line 506 &quot;ael.y&quot;
     {
 		(yyval.pval) = nword((yyvsp[-2].str), &amp;(yylsp[-2]));
 		(yyval.pval)-&gt;next = nword((yyvsp[0].str), &amp;(yylsp[0])); ;}
     break;
 
   case 105:
-#line 526 &quot;ael.y&quot;
-    {
-		(yyval.pval) = npval2(PV_WORD, &amp;(yylsp[-4]), &amp;(yylsp[-4]));
-		(yyval.pval)-&gt;u1.str = (yyvsp[0].str);	/* XXX must check this */
-		(yyval.pval)-&gt;next = npval2(PV_WORD, &amp;(yylsp[-2]), &amp;(yylsp[-2]));
-		(yyval.pval)-&gt;next-&gt;u1.str = (yyvsp[-4].str);
-		(yyval.pval)-&gt;next-&gt;next = npval2(PV_WORD, &amp;(yylsp[0]), &amp;(yylsp[0]));
-		(yyval.pval)-&gt;next-&gt;next-&gt;u1.str = (yyvsp[-2].str); ;}
+#line 509 &quot;ael.y&quot;
+    {	/* XXX they are stored in a different order */
+		(yyval.pval) = nword((yyvsp[0].str), &amp;(yylsp[0]));
+		(yyval.pval)-&gt;next = nword((yyvsp[-4].str), &amp;(yylsp[-4]));
+		(yyval.pval)-&gt;next-&gt;next = nword((yyvsp[-2].str), &amp;(yylsp[-2])); ;}
     break;
 
   case 106:
-#line 533 &quot;ael.y&quot;
+#line 513 &quot;ael.y&quot;
     {
-		(yyval.pval) = npval2(PV_WORD, &amp;(yylsp[-2]), &amp;(yylsp[-2]));
-		(yyval.pval)-&gt;u1.str = (yyvsp[0].str);
-		(yyval.pval)-&gt;next = npval2(PV_WORD, &amp;(yylsp[0]), &amp;(yylsp[0]));
-		(yyval.pval)-&gt;next-&gt;u1.str = (yyvsp[-2].str);
-		(yyval.pval)-&gt;next-&gt;next = npval2(PV_WORD, &amp;(yylsp[0]), &amp;(yylsp[0]));
-		(yyval.pval)-&gt;next-&gt;next-&gt;u1.str = strdup(&quot;1&quot;); ;}
+		(yyval.pval) = nword((yyvsp[0].str), &amp;(yylsp[0]));
+		(yyval.pval)-&gt;next = nword((yyvsp[-2].str), &amp;(yylsp[-2]));
+		(yyval.pval)-&gt;next-&gt;next = nword(strdup(&quot;1&quot;), &amp;(yylsp[0])); ;}
     break;
 
   case 107:
-#line 540 &quot;ael.y&quot;
+#line 517 &quot;ael.y&quot;
     {
-		(yyval.pval) = npval2(PV_WORD, &amp;(yylsp[-4]), &amp;(yylsp[-4]));
-		(yyval.pval)-&gt;u1.str = strdup(&quot;default&quot;);
-		(yyval.pval)-&gt;next = npval2(PV_WORD, &amp;(yylsp[-2]), &amp;(yylsp[-2]));
-		(yyval.pval)-&gt;next-&gt;u1.str = (yyvsp[-4].str);
-		(yyval.pval)-&gt;next-&gt;next = npval2(PV_WORD, &amp;(yylsp[0]), &amp;(yylsp[0]));
-		(yyval.pval)-&gt;next-&gt;next-&gt;u1.str = (yyvsp[-2].str); ;}
+		(yyval.pval) = nword(strdup(&quot;default&quot;), &amp;(yylsp[-4]));
+		(yyval.pval)-&gt;next = nword((yyvsp[-4].str), &amp;(yylsp[-4]));
+		(yyval.pval)-&gt;next-&gt;next = nword((yyvsp[-2].str), &amp;(yylsp[-2])); ;}
     break;
 
   case 108:
-#line 547 &quot;ael.y&quot;
+#line 521 &quot;ael.y&quot;
     {
-		(yyval.pval) = npval2(PV_WORD, &amp;(yylsp[-2]), &amp;(yylsp[-2]));
-		(yyval.pval)-&gt;u1.str = strdup(&quot;default&quot;);
-		(yyval.pval)-&gt;next = npval2(PV_WORD, &amp;(yylsp[0]), &amp;(yylsp[0]));
-		(yyval.pval)-&gt;next-&gt;u1.str = (yyvsp[-2].str);
-		(yyval.pval)-&gt;next-&gt;next = npval2(PV_WORD, &amp;(yylsp[0]), &amp;(yylsp[0]));
-		(yyval.pval)-&gt;next-&gt;next-&gt;u1.str = strdup(&quot;1&quot;); ;}
+		(yyval.pval) = nword(strdup(&quot;default&quot;), &amp;(yylsp[-2]));
+		(yyval.pval)-&gt;next = nword((yyvsp[-2].str), &amp;(yylsp[0]));
+		(yyval.pval)-&gt;next-&gt;next = nword( strdup(&quot;1&quot;), &amp;(yylsp[0])); ;}
     break;
 
   case 109:
-#line 556 &quot;ael.y&quot;
+#line 527 &quot;ael.y&quot;
     {reset_argcount(parseio-&gt;scanner);;}
     break;
 
   case 110:
-#line 556 &quot;ael.y&quot;
+#line 527 &quot;ael.y&quot;
     {
 		/* XXX original code had @2 but i think we need @5 */
 		(yyval.pval) = npval2(PV_MACRO_CALL, &amp;(yylsp[-4]), &amp;(yylsp[0]));
@@ -2690,19 +2662,19 @@
     break;
 
   case 111:
-#line 561 &quot;ael.y&quot;
+#line 532 &quot;ael.y&quot;
     {
 		(yyval.pval)= npval2(PV_MACRO_CALL, &amp;(yylsp[-2]), &amp;(yylsp[0]));
 		(yyval.pval)-&gt;u1.str = (yyvsp[-2].str); ;}
     break;
 
   case 112:
-#line 569 &quot;ael.y&quot;
+#line 540 &quot;ael.y&quot;
     {reset_argcount(parseio-&gt;scanner);;}
     break;
 
   case 113:
-#line 569 &quot;ael.y&quot;
+#line 540 &quot;ael.y&quot;
     {
 		if (strcasecmp((yyvsp[-2].str),&quot;goto&quot;) == 0) {
 			(yyval.pval) = npval2(PV_GOTO, &amp;(yylsp[-2]), &amp;(yylsp[-1]));
@@ -2715,7 +2687,7 @@
     break;
 
   case 114:
-#line 580 &quot;ael.y&quot;
+#line 551 &quot;ael.y&quot;
     {
 		(yyval.pval) = update_last((yyvsp[-2].pval), &amp;(yylsp[0]));
  		if( (yyval.pval)-&gt;type == PV_GOTO )
@@ -2726,54 +2698,49 @@
     break;
 
   case 115:
-#line 587 &quot;ael.y&quot;
+#line 558 &quot;ael.y&quot;
     { (yyval.pval) = update_last((yyvsp[-1].pval), &amp;(yylsp[0])); ;}
     break;
 
   case 116:
-#line 590 &quot;ael.y&quot;
+#line 561 &quot;ael.y&quot;
     { (yyval.str) = (yyvsp[0].str) ;}
     break;
 
   case 117:
-#line 591 &quot;ael.y&quot;
+#line 562 &quot;ael.y&quot;
     { (yyval.str) = strdup(&quot;&quot;); ;}
     break;
 
   case 118:
-#line 594 &quot;ael.y&quot;
+#line 565 &quot;ael.y&quot;
     { (yyval.pval) = nword((yyvsp[0].str), &amp;(yylsp[0])); ;}
     break;
 
   case 119:
-#line 595 &quot;ael.y&quot;
+#line 566 &quot;ael.y&quot;
     {
 		(yyval.pval)= npval(PV_WORD,0/*@1.first_line*/,0/*@1.last_line*/,0/* @1.first_column*/, 0/*@1.last_column*/);
 		(yyval.pval)-&gt;u1.str = strdup(&quot;&quot;); ;}
     break;
 
   case 120:
-#line 598 &quot;ael.y&quot;
-    {
-		pval *z = nword((yyvsp[0].str), &amp;(yylsp[0]));
-		(yyval.pval) = (yyvsp[-2].pval);
-		linku1((yyvsp[-2].pval),z); ;}
+#line 569 &quot;ael.y&quot;
+    { (yyval.pval) = linku1((yyvsp[-2].pval), nword((yyvsp[0].str), &amp;(yylsp[0]))); ;}
     break;
 
   case 121:
-#line 604 &quot;ael.y&quot;
+#line 572 &quot;ael.y&quot;
     {(yyval.pval)=(yyvsp[0].pval);;}
     break;
 
   case 122:
-#line 605 &quot;ael.y&quot;
-    { if ( (yyvsp[-1].pval) &amp;&amp; (yyvsp[0].pval) ) {(yyval.pval)=(yyvsp[-1].pval); linku1((yyval.pval),(yyvsp[0].pval));}
-						 else if ( (yyvsp[-1].pval) ) {(yyval.pval)=(yyvsp[-1].pval);}
-						 else if ( (yyvsp[0].pval) ) {(yyval.pval)=(yyvsp[0].pval);} ;}
+#line 573 &quot;ael.y&quot;
+    { (yyval.pval) = linku1((yyvsp[-1].pval), (yyvsp[0].pval)); ;}
     break;
 
   case 123:
-#line 610 &quot;ael.y&quot;
+#line 576 &quot;ael.y&quot;
     {
 		(yyval.pval) = npval2(PV_CASE, &amp;(yylsp[-3]), &amp;(yylsp[-1])); /* XXX 3 or 4 ? */
 		(yyval.pval)-&gt;u1.str = (yyvsp[-2].str);
@@ -2781,7 +2748,7 @@
     break;
 
   case 124:
-#line 614 &quot;ael.y&quot;
+#line 580 &quot;ael.y&quot;
     {
 		(yyval.pval) = npval2(PV_DEFAULT, &amp;(yylsp[-2]), &amp;(yylsp[0]));
 		(yyval.pval)-&gt;u1.str = NULL;
@@ -2789,7 +2756,7 @@
     break;
 
   case 125:
-#line 618 &quot;ael.y&quot;
+#line 584 &quot;ael.y&quot;
     {
 		(yyval.pval) = npval2(PV_PATTERN, &amp;(yylsp[-3]), &amp;(yylsp[0])); /* <A HREF="https://lists.berlios.de/mailman/listinfo/solid-pbx-svn">XXX at 3</A> or @4 ? */
 		(yyval.pval)-&gt;u1.str = (yyvsp[-2].str);
@@ -2797,45 +2764,43 @@
     break;
 
   case 126:
-#line 622 &quot;ael.y&quot;
+#line 588 &quot;ael.y&quot;
     {
 		(yyval.pval) = npval2(PV_CASE, &amp;(yylsp[-2]), &amp;(yylsp[0]));
 		(yyval.pval)-&gt;u1.str = (yyvsp[-1].str);;}
     break;
 
   case 127:
-#line 625 &quot;ael.y&quot;
+#line 591 &quot;ael.y&quot;
     {
 		(yyval.pval) = npval2(PV_DEFAULT, &amp;(yylsp[-1]), &amp;(yylsp[0]));
 		(yyval.pval)-&gt;u1.str = NULL;;}
     break;
 
   case 128:
-#line 628 &quot;ael.y&quot;
+#line 594 &quot;ael.y&quot;
     {
 		(yyval.pval) = npval2(PV_PATTERN, &amp;(yylsp[-2]), &amp;(yylsp[0]));
 		(yyval.pval)-&gt;u1.str = (yyvsp[-1].str);;}
     break;
 
   case 129:
-#line 633 &quot;ael.y&quot;
+#line 599 &quot;ael.y&quot;
     {(yyval.pval) = (yyvsp[0].pval);;}
     break;
 
   case 130:
-#line 634 &quot;ael.y&quot;
-    { if ( (yyvsp[-1].pval) &amp;&amp; (yyvsp[0].pval) ) {(yyval.pval)=(yyvsp[-1].pval); linku1((yyval.pval),(yyvsp[0].pval));}
-						 else if ( (yyvsp[-1].pval) ) {(yyval.pval)=(yyvsp[-1].pval);}
-						 else if ( (yyvsp[0].pval) ) {(yyval.pval)=(yyvsp[0].pval);} ;}
+#line 600 &quot;ael.y&quot;
+    { (yyval.pval) = linku1((yyvsp[-1].pval), (yyvsp[0].pval)); ;}
     break;
 
   case 131:
-#line 639 &quot;ael.y&quot;
+#line 603 &quot;ael.y&quot;
     {(yyval.pval)=(yyvsp[0].pval);;}
     break;
 
   case 132:
-#line 640 &quot;ael.y&quot;
+#line 604 &quot;ael.y&quot;
     {
 		(yyval.pval) = npval2(PV_CATCH, &amp;(yylsp[-4]), &amp;(yylsp[0]));
 		(yyval.pval)-&gt;u1.str = (yyvsp[-3].str);
@@ -2843,62 +2808,53 @@
     break;
 
   case 133:
-#line 646 &quot;ael.y&quot;
+#line 610 &quot;ael.y&quot;
     {
 		(yyval.pval) = npval2(PV_SWITCHES, &amp;(yylsp[-1]), &amp;(yylsp[0]));
 		(yyval.pval)-&gt;u1.list = (yyvsp[0].pval); ;}
     break;
 
   case 134:
-#line 651 &quot;ael.y&quot;
+#line 615 &quot;ael.y&quot;
     {
 		(yyval.pval) = npval2(PV_ESWITCHES, &amp;(yylsp[-1]), &amp;(yylsp[0]));
 		(yyval.pval)-&gt;u1.list = (yyvsp[0].pval); ;}
     break;
 
   case 135:
-#line 656 &quot;ael.y&quot;
+#line 620 &quot;ael.y&quot;
     { (yyval.pval) = (yyvsp[-1].pval); ;}
     break;
 
   case 136:
-#line 657 &quot;ael.y&quot;
+#line 621 &quot;ael.y&quot;
     { (yyval.pval) = NULL; ;}
     break;
 
   case 137:
-#line 660 &quot;ael.y&quot;
-    {
-		(yyval.pval) = npval2(PV_WORD, &amp;(yylsp[-1]), &amp;(yylsp[0]));
-		(yyval.pval)-&gt;u1.str = (yyvsp[-1].str);;}
+#line 624 &quot;ael.y&quot;
+    { (yyval.pval) = nword((yyvsp[-1].str), &amp;(yylsp[-1])); ;}
     break;
 
   case 138:
-#line 663 &quot;ael.y&quot;
-    {
-		pval *z = npval2(PV_WORD, &amp;(yylsp[-1]), &amp;(yylsp[0]));
-		z-&gt;u1.str = (yyvsp[-1].str);
-		(yyval.pval)=(yyvsp[-2].pval);
-		linku1((yyval.pval),z); ;}
+#line 625 &quot;ael.y&quot;
+    { (yyval.pval) = linku1((yyvsp[-2].pval), nword((yyvsp[-1].str), &amp;(yylsp[-1]))); ;}
     break;
 
   case 139:
-#line 668 &quot;ael.y&quot;
+#line 626 &quot;ael.y&quot;
     {(yyval.pval)=(yyvsp[-1].pval);;}
     break;
 
   case 140:
-#line 671 &quot;ael.y&quot;
-    {
-		(yyval.pval) = npval2(PV_WORD, &amp;(yylsp[-1]), &amp;(yylsp[0]));
-		(yyval.pval)-&gt;u1.str = (yyvsp[-1].str);;}
+#line 629 &quot;ael.y&quot;
+    { (yyval.pval) = nword((yyvsp[-1].str), &amp;(yylsp[-1])); ;}
     break;
 
   case 141:
-#line 675 &quot;ael.y&quot;
+#line 631 &quot;ael.y&quot;
     {
-		(yyval.pval) = npval2(PV_WORD, &amp;(yylsp[-13]), &amp;(yylsp[-12]));
-		(yyval.pval)-&gt;u1.str = (yyvsp[-13].str);
+		(yyval.pval) = nword((yyvsp[-13].str), &amp;(yylsp[-13]));
 		(yyval.pval)-&gt;u2.arglist = npval2(PV_WORD, &amp;(yylsp[-11]), &amp;(yylsp[-7]));
 		asprintf( &amp;((yyval.pval)-&gt;u2.arglist-&gt;u1.str), &quot;%s:%s:%s&quot;, (yyvsp[-11].str), (yyvsp[-9].str), (yyvsp[-7].str));
 		free((yyvsp[-11].str));
@@ -2912,10 +2868,9 @@
     break;
 
   case 142:
-#line 688 &quot;ael.y&quot;
+#line 643 &quot;ael.y&quot;
     {
-		(yyval.pval) = npval2(PV_WORD, &amp;(yylsp[-9]), &amp;(yylsp[-8]));
-		(yyval.pval)-&gt;u1.str = (yyvsp[-9].str);
+		(yyval.pval) = nword((yyvsp[-9].str), &amp;(yylsp[-9]));
 		(yyval.pval)-&gt;u2.arglist = nword((yyvsp[-7].str), &amp;(yylsp[-7]));
 		(yyval.pval)-&gt;u2.arglist-&gt;next = nword((yyvsp[-5].str), &amp;(yylsp[-5]));
 		(yyval.pval)-&gt;u2.arglist-&gt;next-&gt;next = nword((yyvsp[-3].str), &amp;(yylsp[-3]));
@@ -2925,21 +2880,16 @@
     break;
 
   case 143:
-#line 697 &quot;ael.y&quot;
-    {
-		pval *z = npval2(PV_WORD, &amp;(yylsp[-1]), &amp;(yylsp[0])); /* XXX don't we need @<A HREF="https://lists.berlios.de/mailman/listinfo/solid-pbx-svn">1- at 3</A> ?*/
-		(yyval.pval)=(yyvsp[-2].pval);
-		z-&gt;u1.str = (yyvsp[-1].str);
-		linku1((yyval.pval),z); ;}
+#line 651 &quot;ael.y&quot;
+    { (yyval.pval) = linku1((yyvsp[-2].pval), nword((yyvsp[-1].str), &amp;(yylsp[-1]))); ;}
     break;
 
   case 144:
-#line 703 &quot;ael.y&quot;
+#line 653 &quot;ael.y&quot;
     {
-		pval *z = npval2(PV_WORD, &amp;(yylsp[-13]), &amp;(yylsp[-12]));
-		(yyval.pval)=(yyvsp[-14].pval); z-&gt;u1.str = (yyvsp[-13].str);
-		linku1((yyval.pval),z);
-		z-&gt;u2.arglist = npval2(PV_WORD, &amp;(yylsp[-11]), &amp;(yylsp[-11]));
+		pval *z = nword((yyvsp[-13].str), &amp;(yylsp[-13]));
+		(yyval.pval) = linku1((yyvsp[-14].pval), z);
+		z-&gt;u2.arglist = npval2(PV_WORD, &amp;(yylsp[-11]), &amp;(yylsp[-7]));
 		asprintf( &amp;((yyval.pval)-&gt;u2.arglist-&gt;u1.str), &quot;%s:%s:%s&quot;, (yyvsp[-11].str), (yyvsp[-9].str), (yyvsp[-7].str));
 		free((yyvsp[-11].str));
 		free((yyvsp[-9].str));
@@ -2952,11 +2902,10 @@
     break;
 
   case 145:
-#line 717 &quot;ael.y&quot;
+#line 666 &quot;ael.y&quot;
     {
 		pval *z = npval2(PV_WORD, &amp;(yylsp[-9]), &amp;(yylsp[-8]));
-		(yyval.pval)=(yyvsp[-10].pval);
-		linku1((yyval.pval),z);
+		(yyval.pval) = linku1((yyvsp[-10].pval), z);
 		(yyval.pval)-&gt;u2.arglist-&gt;u1.str = (yyvsp[-7].str);			/* XXX maybe too early ? */
 		z-&gt;u1.str = (yyvsp[-9].str);
 		z-&gt;u2.arglist = npval2(PV_WORD, &amp;(yylsp[-7]), &amp;(yylsp[-7]));	/* XXX is this correct ? */
@@ -2968,29 +2917,29 @@
     break;
 
   case 146:
-#line 729 &quot;ael.y&quot;
+#line 677 &quot;ael.y&quot;
     {(yyval.pval)=(yyvsp[-1].pval);;}
     break;
 
   case 147:
-#line 732 &quot;ael.y&quot;
+#line 680 &quot;ael.y&quot;
     { (yyval.str) = (yyvsp[0].str);;}
     break;
 
   case 148:
-#line 733 &quot;ael.y&quot;
+#line 681 &quot;ael.y&quot;
     {(yyval.str)=strdup(&quot;default&quot;);;}
     break;
 
   case 149:
-#line 736 &quot;ael.y&quot;
+#line 684 &quot;ael.y&quot;
     {
 		(yyval.pval) = npval2(PV_INCLUDES, &amp;(yylsp[-3]), &amp;(yylsp[0]));
 		(yyval.pval)-&gt;u1.list = (yyvsp[-1].pval);;}
     break;
 
   case 150:
-#line 739 &quot;ael.y&quot;
+#line 687 &quot;ael.y&quot;
     {
 		(yyval.pval) = npval2(PV_INCLUDES, &amp;(yylsp[-2]), &amp;(yylsp[0]));;}
     break;
@@ -3000,7 +2949,7 @@
     }
 
 /* Line 1126 of yacc.c.  */
-#line 3004 &quot;ael.tab.c&quot;
+#line 2953 &quot;ael.tab.c&quot;
 
   yyvsp -= yylen;
   yyssp -= yylen;
@@ -3275,7 +3224,7 @@
 }
 
 
-#line 744 &quot;ael.y&quot;
+#line 692 &quot;ael.y&quot;
 
 
 static char *token_equivs1[] =
@@ -3455,13 +3404,14 @@
 {
 	if (!head)
 		return tail;
-	if (!head-&gt;next) {
-		head-&gt;next = tail;
-	} else {
-		head-&gt;u1_last-&gt;next = tail;
+	if (tail) {
+		if (!head-&gt;next) {
+			head-&gt;next = tail;
+		} else {
+			head-&gt;u1_last-&gt;next = tail;
+		}
+		head-&gt;u1_last = tail;
 	}
-	head-&gt;u1_last = tail;
 	return head;
 }
 
-

Modified: trunk/pbx/ael/ael.y
===================================================================
--- trunk/pbx/ael/ael.y	2006-05-02 14:18:07 UTC (rev 32)
+++ trunk/pbx/ael/ael.y	2006-05-02 15:18:15 UTC (rev 33)
@@ -177,17 +177,7 @@
 	;
 
 objects : object {$$=$1;}
-	| objects object
-		{
-			if ( $1 &amp;&amp; $2 ) {
-				$$=$1;
-				linku1($$,$2);
-			} else if ( $1 ) {
-				$$=$1;
-			} else if ( $2 ) {
-				$$=$2;
-			}
-		}
+	| objects object { $$ = linku1($1, $2); }
 	| objects error {$$=$1;}
 	;
 
@@ -236,7 +226,7 @@
 	;
 
 global_statements : global_statement {$$=$1;}
-	| global_statements global_statement {$$=$1; linku1($$,$2);}
+	| global_statements global_statement {$$ = linku1($1, $2); }
 	| global_statements error {$$=$1;}
 	;
 
@@ -246,11 +236,8 @@
 		$$-&gt;u2.val = $4; }
 	;
 
-arglist : word { $$= nword($1, &amp;@1); }
-	| arglist COMMA word {
-		pval *z = npval2(PV_WORD, &amp;@1, &amp;@3);
-		z-&gt;u1.str = $3;
-		$$ = linku1($1,z); }
+arglist : word { $$ = nword($1, &amp;@1); }
+	| arglist COMMA word { $$ = linku1($1, nword($3, &amp;@3)); }
 	| arglist error {$$=$1;}
 	;
 
@@ -260,9 +247,7 @@
 
 elements : element { $$=$1;}
 	| error {$$=0;}
-	| elements element { if ( $1 &amp;&amp; $2 ) {$$=$1; linku1($$,$2);}
-				else if ( $1 ) {$$=$1;}
-				else if ( $2 ) {$$=$2;} }
+	| elements element { $$ = linku1($1, $2); }
 	| elements error   { $$=$1;}
 	;
 
@@ -308,9 +293,7 @@
 	;
 
 statements : statement {$$=$1;}
-	| statements statement {if ( $1 &amp;&amp; $2 ) {$$=$1; linku1($$,$2);}
-						 else if ( $1 ) {$$=$1;}
-						 else if ( $2 ) {$$=$2;} }
+	| statements statement { $$ = linku1($1, $2); }
 	| statements error {$$=$1;}
 	;
 
@@ -326,8 +309,8 @@
 
 iftime_head : KW_IFTIME LP word3_list COLON word3_list COLON word3_list
 		BAR word3_list BAR word3_list BAR word3_list RP {
-		$$ = npval2(PV_IFTIME, &amp;@1, &amp;@5); /* XXX really @5 or more ? */
-		$$-&gt;u1.list = npval2(PV_WORD, &amp;@3, &amp;@3);
+		$$ = npval2(PV_IFTIME, &amp;@1, &amp;@1);
+		$$-&gt;u1.list = npval2(PV_WORD, &amp;@3, &amp;@7);
 		asprintf(&amp;($$-&gt;u1.list-&gt;u1.str), &quot;%s:%s:%s&quot;, $3, $5, $7);
 		free($3);
 		free($5);
@@ -523,34 +506,22 @@
 	| goto_word COMMA goto_word {
 		$$ = nword($1, &amp;@1);
 		$$-&gt;next = nword($3, &amp;@3); }
-	| goto_word COMMA word AT word {
-		$$ = npval2(PV_WORD, &amp;@1, &amp;@1);
-		$$-&gt;u1.str = $5;	/* XXX must check this */
-		$$-&gt;next = npval2(PV_WORD, &amp;@3, &amp;@3);
-		$$-&gt;next-&gt;u1.str = $1;
-		$$-&gt;next-&gt;next = npval2(PV_WORD, &amp;@5, &amp;@5);
-		$$-&gt;next-&gt;next-&gt;u1.str = $3; }
+	| goto_word COMMA word AT word {	/* XXX they are stored in a different order */
+		$$ = nword($5, &amp;@5);
+		$$-&gt;next = nword($1, &amp;@1);
+		$$-&gt;next-&gt;next = nword($3, &amp;@3); }
 	| goto_word AT goto_word {
-		$$ = npval2(PV_WORD, &amp;@1, &amp;@1);
-		$$-&gt;u1.str = $3;
-		$$-&gt;next = npval2(PV_WORD, &amp;@3, &amp;@3);
-		$$-&gt;next-&gt;u1.str = $1;
-		$$-&gt;next-&gt;next = npval2(PV_WORD, &amp;@3, &amp;@3);
-		$$-&gt;next-&gt;next-&gt;u1.str = strdup(&quot;1&quot;); }
+		$$ = nword($3, &amp;@3);
+		$$-&gt;next = nword($1, &amp;@1);
+		$$-&gt;next-&gt;next = nword(strdup(&quot;1&quot;), &amp;@3); }
 	| goto_word COMMA word AT KW_DEFAULT {
-		$$ = npval2(PV_WORD, &amp;@1, &amp;@1);
-		$$-&gt;u1.str = strdup(&quot;default&quot;);
-		$$-&gt;next = npval2(PV_WORD, &amp;@3, &amp;@3);
-		$$-&gt;next-&gt;u1.str = $1;
-		$$-&gt;next-&gt;next = npval2(PV_WORD, &amp;@5, &amp;@5);
-		$$-&gt;next-&gt;next-&gt;u1.str = $3; }
+		$$ = nword(strdup(&quot;default&quot;), &amp;@1);
+		$$-&gt;next = nword($1, &amp;@1);
+		$$-&gt;next-&gt;next = nword($3, &amp;@3); }
 	| goto_word AT KW_DEFAULT {
-		$$ = npval2(PV_WORD, &amp;@1, &amp;@1);
-		$$-&gt;u1.str = strdup(&quot;default&quot;);
-		$$-&gt;next = npval2(PV_WORD, &amp;@3, &amp;@3);
-		$$-&gt;next-&gt;u1.str = $1;
-		$$-&gt;next-&gt;next = npval2(PV_WORD, &amp;@3, &amp;@3);
-		$$-&gt;next-&gt;next-&gt;u1.str = strdup(&quot;1&quot;); }
+		$$ = nword(strdup(&quot;default&quot;), &amp;@1);
+		$$-&gt;next = nword($1, &amp;@3);
+		$$-&gt;next-&gt;next = nword( strdup(&quot;1&quot;), &amp;@3); }
 	;
 
 macro_call : word LP {reset_argcount(parseio-&gt;scanner);} eval_arglist RP {
@@ -595,16 +566,11 @@
 	| /*nothing! */   {
 		$$= npval(PV_WORD,0/*@1.first_line*/,0/*@1.last_line*/,0/* @1.first_column*/, 0/*@1.last_column*/);
 		$$-&gt;u1.str = strdup(&quot;&quot;); }
-	| eval_arglist COMMA  opt_word {
-		pval *z = nword($3, &amp;@3);
-		$$ = $1;
-		linku1($1,z); }
+	| eval_arglist COMMA  opt_word { $$ = linku1($1, nword($3, &amp;@3)); }
 	;
 
 case_statements: case_statement {$$=$1;}
-	| case_statements case_statement { if ( $1 &amp;&amp; $2 ) {$$=$1; linku1($$,$2);}
-						 else if ( $1 ) {$$=$1;}
-						 else if ( $2 ) {$$=$2;} }
+	| case_statements case_statement { $$ = linku1($1, $2); }
 	;
 
 case_statement: KW_CASE word COLON statements {
@@ -631,9 +597,7 @@
 	;
 
 macro_statements: macro_statement {$$ = $1;}
-	| macro_statements macro_statement { if ( $1 &amp;&amp; $2 ) {$$=$1; linku1($$,$2);}
-						 else if ( $1 ) {$$=$1;}
-						 else if ( $2 ) {$$=$2;} }
+	| macro_statements macro_statement { $$ = linku1($1, $2); }
 	;
 
 macro_statement : statement {$$=$1;}
@@ -657,24 +621,15 @@
 	| LC RC { $$ = NULL; }
 	;
 
-switchlist : word SEMI {
-		$$ = npval2(PV_WORD, &amp;@1, &amp;@2);
-		$$-&gt;u1.str = $1;}
-	| switchlist word SEMI {
-		pval *z = npval2(PV_WORD, &amp;@2, &amp;@3);
-		z-&gt;u1.str = $2;
-		$$=$1;
-		linku1($$,z); }
+switchlist : word SEMI { $$ = nword($1, &amp;@1); }
+	| switchlist word SEMI { $$ = linku1($1, nword($2, &amp;@2)); }
 	| switchlist error {$$=$1;}
 	;
 
-includeslist : includedname SEMI {
-		$$ = npval2(PV_WORD, &amp;@1, &amp;@2);
-		$$-&gt;u1.str = $1;}
+includeslist : includedname SEMI { $$ = nword($1, &amp;@1); }
 	| includedname BAR word3_list COLON word3_list COLON word3_list
 			BAR word3_list BAR word3_list BAR word3_list SEMI {
-		$$ = npval2(PV_WORD, &amp;@1, &amp;@2);
-		$$-&gt;u1.str = $1;
+		$$ = nword($1, &amp;@1);
 		$$-&gt;u2.arglist = npval2(PV_WORD, &amp;@3, &amp;@7);
 		asprintf( &amp;($$-&gt;u2.arglist-&gt;u1.str), &quot;%s:%s:%s&quot;, $3, $5, $7);
 		free($3);
@@ -686,25 +641,19 @@
 		prev_word=0;
 	}
 	| includedname BAR word BAR word3_list BAR word3_list BAR word3_list SEMI {
-		$$ = npval2(PV_WORD, &amp;@1, &amp;@2);
-		$$-&gt;u1.str = $1;
+		$$ = nword($1, &amp;@1);
 		$$-&gt;u2.arglist = nword($3, &amp;@3);
 		$$-&gt;u2.arglist-&gt;next = nword($5, &amp;@5);
 		$$-&gt;u2.arglist-&gt;next-&gt;next = nword($7, &amp;@7);
 		$$-&gt;u2.arglist-&gt;next-&gt;next-&gt;next = nword($9, &amp;@9);
 		prev_word=0;
 	}
-	| includeslist includedname SEMI {
-		pval *z = npval2(PV_WORD, &amp;@2, &amp;@3); /* XXX don't we need @<A HREF="https://lists.berlios.de/mailman/listinfo/solid-pbx-svn">1- at 3</A> ?*/
-		$$=$1;
-		z-&gt;u1.str = $2;
-		linku1($$,z); }
+	| includeslist includedname SEMI { $$ = linku1($1, nword($2, &amp;@2)); }
 	| includeslist includedname BAR word3_list COLON word3_list COLON word3_list
 			BAR word3_list BAR word3_list BAR word3_list SEMI {
-		pval *z = npval2(PV_WORD, &amp;@2, &amp;@3);
-		$$=$1; z-&gt;u1.str = $2;
-		linku1($$,z);
-		z-&gt;u2.arglist = npval2(PV_WORD, &amp;@4, &amp;@4);
+		pval *z = nword($2, &amp;@2);
+		$$ = linku1($1, z);
+		z-&gt;u2.arglist = npval2(PV_WORD, &amp;@4, &amp;@8);
 		asprintf( &amp;($$-&gt;u2.arglist-&gt;u1.str), &quot;%s:%s:%s&quot;, $4, $6, $8);
 		free($4);
 		free($6);
@@ -716,8 +665,7 @@
 	}
 	| includeslist includedname BAR word BAR word3_list BAR word3_list BAR word3_list SEMI {
 		pval *z = npval2(PV_WORD, &amp;@2, &amp;@3);
-		$$=$1;
-		linku1($$,z);
+		$$ = linku1($1, z);
 		$$-&gt;u2.arglist-&gt;u1.str = $4;			/* XXX maybe too early ? */
 		z-&gt;u1.str = $2;
 		z-&gt;u2.arglist = npval2(PV_WORD, &amp;@4, &amp;@4);	/* XXX is this correct ? */
@@ -920,12 +868,13 @@
 {
 	if (!head)
 		return tail;
-	if (!head-&gt;next) {
-		head-&gt;next = tail;
-	} else {
-		head-&gt;u1_last-&gt;next = tail;
+	if (tail) {
+		if (!head-&gt;next) {
+			head-&gt;next = tail;
+		} else {
+			head-&gt;u1_last-&gt;next = tail;
+		}
+		head-&gt;u1_last = tail;
 	}
-	head-&gt;u1_last = tail;
 	return head;
 }
-


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="000029.html">[solid-pbx-svn] r32 - trunk/channels
</A></li>
	<LI>Next message: <A HREF="000031.html">[solid-pbx-svn] r34 - in trunk: . utils
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#30">[ date ]</a>
              <a href="thread.html#30">[ thread ]</a>
              <a href="subject.html#30">[ subject ]</a>
              <a href="author.html#30">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.berlios.de/mailman/listinfo/solid-pbx-svn">More information about the solid-pbx-svn
mailing list</a><br>
</body></html>
