<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [solid-pbx-svn] r15 - in trunk: . apps cdr channels db1-ast doc editline include/asterisk pbx pbx/ael utils
   </TITLE>
   <LINK REL="Index" HREF="http://lists.berlios.de/pipermail/solid-pbx-svn/2006-April/index.html" >
   <LINK REL="made" HREF="mailto:solid-pbx-svn%40lists.berlios.de?Subject=Re%3A%20%5Bsolid-pbx-svn%5D%20r15%20-%20in%20trunk%3A%20.%20apps%20cdr%20channels%20db1-ast%20doc%20editline%20include/asterisk%20pbx%20pbx/ael%20utils&In-Reply-To=%3C200604301543.k3UFh8Qs032286%40sheep.berlios.de%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="000010.html">
   <LINK REL="Next"  HREF="000013.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[solid-pbx-svn] r15 - in trunk: . apps cdr channels db1-ast doc editline include/asterisk pbx pbx/ael utils</H1>
    <B>solid-pbx-svn-admin at lists.berlios.de</B> 
    <A HREF="mailto:solid-pbx-svn%40lists.berlios.de?Subject=Re%3A%20%5Bsolid-pbx-svn%5D%20r15%20-%20in%20trunk%3A%20.%20apps%20cdr%20channels%20db1-ast%20doc%20editline%20include/asterisk%20pbx%20pbx/ael%20utils&In-Reply-To=%3C200604301543.k3UFh8Qs032286%40sheep.berlios.de%3E"
       TITLE="[solid-pbx-svn] r15 - in trunk: . apps cdr channels db1-ast doc editline include/asterisk pbx pbx/ael utils">solid-pbx-svn-admin at lists.berlios.de
       </A><BR>
    <I>Sun Apr 30 17:43:08 CEST 2006</I>
    <P><UL>
        <LI>Previous message: <A HREF="000010.html">[solid-pbx-svn] r14 - trunk/mxml
</A></li>
        <LI>Next message: <A HREF="000013.html">[solid-pbx-svn] r16 - trunk/channels
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#12">[ date ]</a>
              <a href="thread.html#12">[ thread ]</a>
              <a href="subject.html#12">[ subject ]</a>
              <a href="author.html#12">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Author: casper2
Date: 2006-04-30 17:42:56 +0200 (Sun, 30 Apr 2006)
New Revision: 15

Modified:
   trunk/Makefile
   trunk/UPGRADE.txt
   trunk/apps/Makefile
   trunk/asterisk.c
   trunk/cdr.c
   trunk/cdr/Makefile
   trunk/channels/Makefile
   trunk/channels/chan_zap.c
   trunk/configure.ac
   trunk/db1-ast/Makefile
   trunk/doc/asterisk-conf.txt
   trunk/editline/configure
   trunk/editline/makelist
   trunk/include/asterisk/options.h
   trunk/pbx/Makefile
   trunk/pbx/ael/ael.flex
   trunk/pbx/ael/ael.tab.c
   trunk/pbx/ael/ael.tab.h
   trunk/pbx/ael/ael.y
   trunk/pbx/ael/ael_lex.c
   trunk/pbx/pbx_ael.c
   trunk/utils/Makefile
Log:
Update to Asterisk SVN trunk r23704
------------------------------------------------------------------------
r23557 | rizzo | 2006-04-30 11:24:04 +0200 (Sun, 30 Apr 2006) | 2 lines

more comments

------------------------------------------------------------------------
r23581 | kpfleming | 2006-04-30 13:20:09 +0200 (Sun, 30 Apr 2006) | 10 lines

Merged revisions 23580 via svnmerge from 
<A HREF="https://origsvn.digium.com/svn/asterisk/branches/1.2">https://origsvn.digium.com/svn/asterisk/branches/1.2</A>

.......
r23580 | kpfleming | 2006-04-30 06:19:04 -0500 (Sun, 30 Apr 2006) | 2 lines

ensure that the script output is correctly generated when the system's character set does not use the English lowercase/uppercase character groups

.......

------------------------------------------------------------------------
r23582 | kpfleming | 2006-04-30 13:40:06 +0200 (Sun, 30 Apr 2006) | 4 lines

simplify CFLAGS handling for subdirectories
don't put paths into the include search path when they are not needed
don't auto-rebuild the AEL bison/flex output based on make dependencies (the generated files are already checked in, and the timestamps generated by a checkout will usually cause them to be overwritten)

------------------------------------------------------------------------
r23611 | rizzo | 2006-04-30 14:12:39 +0200 (Sun, 30 Apr 2006) | 2 lines

simplify updating the token position markers

------------------------------------------------------------------------
r23612 | rizzo | 2006-04-30 14:14:33 +0200 (Sun, 30 Apr 2006) | 3 lines

remove some commented-out code


------------------------------------------------------------------------
r23613 | rizzo | 2006-04-30 14:30:08 +0200 (Sun, 30 Apr 2006) | 6 lines

make destroy_pval able to handle a NULL value
(the warning should be removed);
define a 'elements_block' rule to simplify some other rules
removing duplicated code - runtests seems happy with this.


------------------------------------------------------------------------
r23614 | rizzo | 2006-04-30 14:44:54 +0200 (Sun, 30 Apr 2006) | 3 lines

more merge of common blocks through intermediate rules.


------------------------------------------------------------------------
r23615 | rizzo | 2006-04-30 14:46:15 +0200 (Sun, 30 Apr 2006) | 2 lines

another client for switchlist_block

------------------------------------------------------------------------
r23637 | kpfleming | 2006-04-30 15:39:49 +0200 (Sun, 30 Apr 2006) | 11 lines

Merged revisions 23636 via svnmerge from 
<A HREF="https://origsvn.digium.com/svn/asterisk/branches/1.2">https://origsvn.digium.com/svn/asterisk/branches/1.2</A>

.......
r23636 | kpfleming | 2006-04-30 08:38:22 -0500 (Sun, 30 Apr 2006) | 4 lines

remove extraneous -m64 flag that is not needed
(these are coming from Debian patches &lt;G&gt;)

.......

------------------------------------------------------------------------
r23639 | kpfleming | 2006-04-30 15:56:37 +0200 (Sun, 30 Apr 2006) | 10 lines

Merged revisions 23638 via svnmerge from 
<A HREF="https://origsvn.digium.com/svn/asterisk/branches/1.2">https://origsvn.digium.com/svn/asterisk/branches/1.2</A>

.......
r23638 | kpfleming | 2006-04-30 08:55:59 -0500 (Sun, 30 Apr 2006) | 2 lines

let the compiler determine whether hardware or software floating point should be used (like we do in the editline subdirectory)

.......

------------------------------------------------------------------------
r23640 | rizzo | 2006-04-30 15:57:08 +0200 (Sun, 30 Apr 2006) | 5 lines

introduce a new frontend to npval for the very common case
of creating an object for a tring value PV_WORD.
Start using it.


------------------------------------------------------------------------
r23669 | rizzo | 2006-04-30 16:06:04 +0200 (Sun, 30 Apr 2006) | 3 lines

more nword() usages, and mark some dubious places.


------------------------------------------------------------------------
r23670 | kpfleming | 2006-04-30 16:09:13 +0200 (Sun, 30 Apr 2006) | 2 lines

remove unusable MFC/R2 support

------------------------------------------------------------------------
r23671 | kpfleming | 2006-04-30 16:10:48 +0200 (Sun, 30 Apr 2006) | 2 lines

document the removal of MFC/R2 support

------------------------------------------------------------------------
r23672 | russell | 2006-04-30 16:12:14 +0200 (Sun, 30 Apr 2006) | 2 lines

fix up the app_rpt.o target.  oops!  (Thanks to Denis Smirnov on the -dev list)

------------------------------------------------------------------------
r23674 | kpfleming | 2006-04-30 16:28:25 +0200 (Sun, 30 Apr 2006) | 10 lines

Merged revisions 23673 via svnmerge from 
<A HREF="https://origsvn.digium.com/svn/asterisk/branches/1.2">https://origsvn.digium.com/svn/asterisk/branches/1.2</A>

.......
r23673 | kpfleming | 2006-04-30 09:27:56 -0500 (Sun, 30 Apr 2006) | 2 lines

allow top-level OPTIMIZE setting to affect builds in these subdirectories too

.......

------------------------------------------------------------------------
r23675 | kpfleming | 2006-04-30 16:55:05 +0200 (Sun, 30 Apr 2006) | 3 lines

add a command-line flag and option to force forking, even with -v or -d
rename a flag to have the proper name

------------------------------------------------------------------------
r23704 | russell | 2006-04-30 17:29:38 +0200 (Sun, 30 Apr 2006) | 2 lines

fix a libtonezone detection issue on FreeBSD

------------------------------------------------------------------------


Modified: trunk/Makefile
===================================================================
--- trunk/Makefile	2006-04-30 14:54:24 UTC (rev 14)
+++ trunk/Makefile	2006-04-30 15:42:56 UTC (rev 15)
@@ -196,8 +196,9 @@
 endif
 
 ASTCFLAGS+=$(MENUSELECT_CFLAGS)
-TOPDIR_CFLAGS=-include include/autoconfig.h
-MOD_SUBDIR_CFLAGS=-include ../include/autoconfig.h
+TOPDIR_CFLAGS=-include include/autoconfig.h -Iinclude
+MOD_SUBDIR_CFLAGS=-include ../include/autoconfig.h -I../include -I..
+OTHER_SUBDIR_CFLAGS=-include ../include/autoconfig.h -I../include -I..
 
 #   *CLI&gt; show memory allocations [filename]
 #   *CLI&gt; show memory summary [filename]
@@ -213,7 +214,6 @@
     # You must have GCC 3.4 to use k8, otherwise use athlon
     PROC=k8
     #PROC=athlon
-    OPTIONS+=-m64
   endif
 
   ifeq ($(PROC),sparc64)
@@ -234,9 +234,9 @@
       OPTIONS+=-fsigned-char -mcpu=ep9312
     else
       ifeq ($(SUB_PROC),xscale)
-        OPTIONS+=-fsigned-char -msoft-float -mcpu=xscale
+        OPTIONS+=-fsigned-char -mcpu=xscale
       else
-        OPTIONS+=-fsigned-char -msoft-float 
+        OPTIONS+=-fsigned-char 
       endif
     endif
   endif
@@ -252,7 +252,6 @@
   ID=/usr/xpg4/bin/id
 endif
 
-INCLUDE+=-Iinclude -I../include -I..
 ASTCFLAGS+=-pipe  -Wall -Wstrict-prototypes -Wmissing-prototypes -Wmissing-declarations $(DEBUG) $(INCLUDE) #-DMAKE_VALGRIND_HAPPY
 ASTCFLAGS+=$(OPTIMIZE)
 
@@ -465,10 +464,10 @@
 endif
 
 editline/config.h:
-	cd editline &amp;&amp; unset CFLAGS LIBS &amp;&amp; ./configure ; \
+	cd editline &amp;&amp; unset CFLAGS LIBS &amp;&amp; CFLAGS=&quot;$(OPTIMIZE)&quot; ./configure ; \
 
 editline/libedit.a:
-	cd editline &amp;&amp; unset CFLAGS LIBS &amp;&amp; test -f config.h || ./configure
+	cd editline &amp;&amp; unset CFLAGS LIBS &amp;&amp; test -f config.h || CFLAGS=&quot;$(OPTIMIZE)&quot; ./configure
 	$(MAKE) -C editline libedit.a
 
 db1-ast/libdb1.a:
@@ -545,8 +544,8 @@
 
 subdirs: 
 	for x in $(MOD_SUBDIRS); do CFLAGS=&quot;$(ASTCFLAGS) $(MOD_SUBDIR_CFLAGS)&quot; $(MAKE) -C $$x || exit 1 ; done
-	CFLAGS=&quot;$(ASTCFLAGS)&quot; $(MAKE) -C utils
-	CFLAGS=&quot;$(ASTCFLAGS) -include ../include/autoconfig.h&quot; $(MAKE) -C agi
+	CFLAGS=&quot;$(ASTCFLAGS) $(OTHER_SUBDIR_CFLAGS)&quot; $(MAKE) -C utils
+	CFLAGS=&quot;$(ASTCFLAGS) $(OTHER_SUBDIR_CFLAGS)&quot; $(MAKE) -C agi
 
 clean-depend:
 	for x in $(SUBDIRS); do $(MAKE) -C $$x clean-depend || exit 1 ; done

Modified: trunk/UPGRADE.txt
===================================================================
--- trunk/UPGRADE.txt	2006-04-30 14:54:24 UTC (rev 14)
+++ trunk/UPGRADE.txt	2006-04-30 15:42:56 UTC (rev 15)
@@ -122,6 +122,11 @@
   option in sip.conf is removed to osp.conf as authpolicy. allowguest option
   in sip.conf cannot be set as osp anymore. 
 
+The Zap channel:
+
+* Support for MFC/R2 has been removed, as it has not been functional for some time
+  and it has no maintainer.
+
 Installation:
 
 * On BSD systems, the installation directories have changed to more &quot;FreeBSDish&quot; directories. On startup, Asterisk will look for the main configuration in /usr/local/etc/asterisk/asterisk.conf

Modified: trunk/apps/Makefile
===================================================================
--- trunk/apps/Makefile	2006-04-30 14:54:24 UTC (rev 14)
+++ trunk/apps/Makefile	2006-04-30 15:42:56 UTC (rev 15)
@@ -41,7 +41,7 @@
 	$(CC) $(SOLINK) -o $@ $&lt; $(ZAPTEL_LIB)
 
 app_rpt.o: app_rpt.c
-	$(CC) $(SOLINK) -o $@ $&lt; $(ZAPTEL_INCLUDE)
+	$(CC) -c -o $@ $(CFLAGS) $(ZAPTEL_INCLUDE) $&lt;
 
 install: all
 	for x in $(MODS); do $(INSTALL) -m 755 $$x $(DESTDIR)$(MODULES_DIR) ; done

Modified: trunk/asterisk.c
===================================================================
--- trunk/asterisk.c	2006-04-30 14:54:24 UTC (rev 14)
+++ trunk/asterisk.c	2006-04-30 15:42:56 UTC (rev 15)
@@ -2179,6 +2179,9 @@
 		/* Disable forking (-f at startup) */
 		} else if (!strcasecmp(v-&gt;name, &quot;nofork&quot;)) {
 			ast_set2_flag(&amp;ast_options, ast_true(v-&gt;value), AST_OPT_FLAG_NO_FORK);
+		/* Always fork, even if verbose or debug are enabled (-F at startup) */
+		} else if (!strcasecmp(v-&gt;name, &quot;alwaysfork&quot;)) {
+			ast_set2_flag(&amp;ast_options, ast_true(v-&gt;value), AST_OPT_FLAG_ALWAYS_FORK);
 		/* Run quietly (-q at startup ) */
 		} else if (!strcasecmp(v-&gt;name, &quot;quiet&quot;)) {
 			ast_set2_flag(&amp;ast_options, ast_true(v-&gt;value), AST_OPT_FLAG_QUIET);
@@ -2289,6 +2292,9 @@
 	/* Check for options */
 	while ((c = getopt(argc, argv, &quot;tThfdvVqprRgciInx:U:G:C:L:M:&quot;)) != -1) {
 		switch (c) {
+		case 'F':
+			ast_set_flag(&amp;ast_options, AST_OPT_FLAG_ALWAYS_FORK);
+			break;
 		case 'd':
 			option_debug++;
 			ast_set_flag(&amp;ast_options, AST_OPT_FLAG_NO_FORK);
@@ -2366,6 +2372,11 @@
 		}
 	}
 
+	if (ast_opt_always_fork &amp;&amp; (ast_opt_remote || ast_opt_console)) {
+		ast_log(LOG_WARNING, &quot;'alwaysfork' is not compatible with console or remote console mode; ignored\n&quot;);
+		ast_clear_flag(&amp;ast_options, AST_OPT_FLAG_ALWAYS_FORK);
+	}
+
 	/* For remote connections, change the name of the remote connection.
 	 * We do this for the benefit of init scripts (which need to know if/when
 	 * the main asterisk process has died yet). */
@@ -2506,7 +2517,7 @@
 	} else
 		ast_log(LOG_WARNING, &quot;Unable to open pid file '%s': %s\n&quot;, ast_config_AST_PID, strerror(errno));
 
-	if (!option_verbose &amp;&amp; !option_debug &amp;&amp; !ast_opt_no_fork &amp;&amp; !ast_opt_console) {
+	if (ast_opt_always_fork || !ast_opt_no_fork) {
 		daemon(0, 0);
 		/* Blindly re-write pid file since we are forking */
 		unlink(ast_config_AST_PID);

Modified: trunk/cdr/Makefile
===================================================================
--- trunk/cdr/Makefile	2006-04-30 14:54:24 UTC (rev 14)
+++ trunk/cdr/Makefile	2006-04-30 15:42:56 UTC (rev 15)
@@ -20,7 +20,7 @@
 #the default as we now have a better instruction set to work with. - Belgarath
 ifeq ($(PROC),sparc64)
   PROC=ultrasparc
-  CFLAGS += -mtune=$(PROC) -O3 -pipe -fomit-frame-pointer -mcpu=v8
+  CFLAGS += -mtune=$(PROC) -pipe -fomit-frame-pointer -mcpu=v8
 endif
 
 ifneq ($(TDS_LIB),)

Modified: trunk/cdr.c
===================================================================
--- trunk/cdr.c	2006-04-30 14:54:24 UTC (rev 14)
+++ trunk/cdr.c	2006-04-30 15:42:56 UTC (rev 15)
@@ -1087,7 +1087,7 @@
 				batchtime = cfg_time;
 		}
 		if ((end_before_h_value = ast_variable_retrieve(config, &quot;general&quot;, &quot;endbeforehexten&quot;)))
-			ast_set2_flag(&amp;ast_options, ast_true(end_before_h_value), AST_OPT_END_CDR_BEFORE_H_EXTEN);
+			ast_set2_flag(&amp;ast_options, ast_true(end_before_h_value), AST_OPT_FLAG_END_CDR_BEFORE_H_EXTEN);
 	}
 
 	if (enabled &amp;&amp; !batchmode) {

Modified: trunk/channels/Makefile
===================================================================
--- trunk/channels/Makefile	2006-04-30 14:54:24 UTC (rev 14)
+++ trunk/channels/Makefile	2006-04-30 15:42:56 UTC (rev 15)
@@ -26,7 +26,7 @@
 
 ifeq ($(PROC),sparc64)
   PROC=ultrasparc
-  CFLAGS += -mtune=$(PROC) -O3 -pipe -fomit-frame-pointer -mcpu=v8
+  CFLAGS += -mtune=$(PROC) -pipe -fomit-frame-pointer -mcpu=v8
 endif
 
 ifeq ($(OSARCH),FreeBSD)
@@ -117,7 +117,7 @@
 	$(CC) $(SOLINK) -o $@ $&lt; iax2-parser.o iax2-provision.o
 
 chan_zap.so: chan_zap.o
-	$(CC) $(SOLINK) -o $@ $&lt; $(PRI_LIB) $(MFCR2_LIB) $(ZAPTEL_LIB)
+	$(CC) $(SOLINK) -o $@ $&lt; $(PRI_LIB) $(ZAPTEL_LIB)
 
 chan_zap.o: chan_zap.c
 	$(CC) -c -o $@ $(CFLAGS) $(ZAPTEL_INCLUDE) $&lt;

Modified: trunk/channels/chan_zap.c
===================================================================
--- trunk/channels/chan_zap.c	2006-04-30 14:54:24 UTC (rev 14)
+++ trunk/channels/chan_zap.c	2006-04-30 15:42:56 UTC (rev 15)
@@ -73,9 +73,6 @@
 #error &quot;You need newer libpri&quot;
 #endif
 #endif
-#ifdef HAVE_MFCR2
-#include &lt;libmfcr2.h&gt;
-#endif
 
 ASTERISK_FILE_VERSION(__FILE__, &quot;$Revision: 22932 $&quot;)
 
@@ -157,9 +154,6 @@
 #ifdef HAVE_LIBPRI
                &quot; w/PRI&quot;
 #endif
-#ifdef HAVE_MFCR2
-               &quot; w/R2&quot;
-#endif
 ;
 
 static const char config[] = &quot;zapata.conf&quot;;
@@ -180,7 +174,6 @@
 #define SIG_FXOGS	ZT_SIG_FXOGS
 #define SIG_FXOKS	ZT_SIG_FXOKS
 #define SIG_PRI		ZT_SIG_CLEAR
-#define SIG_R2		ZT_SIG_CAS
 #define	SIG_SF		ZT_SIG_SF
 #define SIG_SFWINK 	(0x0100000 | ZT_SIG_SF)
 #define SIG_SF_FEATD	(0x0200000 | ZT_SIG_SF)
@@ -400,11 +393,6 @@
 
 struct zt_pvt;
 
-
-#ifdef HAVE_MFCR2
-static int r2prot = -1;
-#endif
-
 static int ringt_base = DEFAULT_RINGT;
 
 #ifdef HAVE_LIBPRI
@@ -608,11 +596,6 @@
 	unsigned int resetting:1;
 	unsigned int setup_ack:1;
 #endif
-#if defined(HAVE_MFCR2)
-	unsigned int hasr2call:1;
-	unsigned int r2blocked:1;
-	unsigned int sigchecked:1;
-#endif
 #ifdef WITH_SMDI
 	unsigned int use_smdi:1;		/* Whether to use SMDI on this channel */
 	struct ast_smdi_interface *smdi_iface;	/* The serial port to listen for SMDI data on */
@@ -698,10 +681,6 @@
 	int prioffset;
 	int logicalspan;
 #endif	
-#ifdef HAVE_MFCR2
-	int r2prot;
-	mfcr2_t *r2;
-#endif	
 	int polarity;
 	int dsp_features;
 
@@ -1132,22 +1111,6 @@
 }
 #endif
 
-#ifdef HAVE_MFCR2
-static int str2r2prot(char *swtype)
-{
-	 if (!strcasecmp(swtype, &quot;ar&quot;))
-		  return MFCR2_PROT_ARGENTINA;
-	 /*endif*/
-	 if (!strcasecmp(swtype, &quot;cn&quot;))
-		  return MFCR2_PROT_CHINA;
-	 /*endif*/
-	 if (!strcasecmp(swtype, &quot;kr&quot;))
-		  return MFCR2_PROT_KOREA;
-	 /*endif*/
-	 return -1;
-}
-#endif
-
 static char *zap_sig2str(int sig)
 {
 	static char buf[256];
@@ -1186,8 +1149,6 @@
 		return &quot;FXO Kewlstart&quot;;
 	case SIG_PRI:
 		return &quot;PRI Signalling&quot;;
-	case SIG_R2:
-		return &quot;R2 Signalling&quot;;
 	case SIG_SF:
 		return &quot;SF (Tone) Signalling Immediate&quot;;
 	case SIG_SFWINK:
@@ -2596,18 +2557,7 @@
 			}
 		}
 #endif
-#ifdef HAVE_MFCR2
-		if (p-&gt;sig == SIG_R2) {
-			if (p-&gt;hasr2call) {
-				mfcr2_DropCall(p-&gt;r2, NULL, UC_NORMAL_CLEARING);
-				p-&gt;hasr2call = 0;
-				res = 0;
-			} else
-				res = 0;
-
-		}
-#endif
-		if (p-&gt;sig &amp;&amp; (p-&gt;sig != SIG_PRI) &amp;&amp; (p-&gt;sig != SIG_R2))
+		if (p-&gt;sig &amp;&amp; (p-&gt;sig != SIG_PRI))
 			res = zt_set_hook(p-&gt;subs[SUB_REAL].zfd, ZT_ONHOOK);
 		if (res &lt; 0) {
 			ast_log(LOG_WARNING, &quot;Unable to hangup line %s\n&quot;, ast-&gt;name);
@@ -2786,13 +2736,6 @@
 		}
 		break;
 #endif
-#ifdef HAVE_MFCR2
-	case SIG_R2:
-		res = mfcr2_AnswerCall(p-&gt;r2, NULL);
-		if (res)
-			ast_log(LOG_WARNING, &quot;R2 Answer call failed :( on %s\n&quot;, ast-&gt;name);
-		break;
-#endif			
 	case 0:
 		ast_mutex_unlock(&amp;p-&gt;lock);
 		return 0;
@@ -3499,78 +3442,6 @@
 	return 0;
 }
 
-#ifdef HAVE_MFCR2
-static struct ast_frame *handle_r2_event(struct zt_pvt *p, mfcr2_event_t *e, int index)
-{
-	struct ast_frame *f;
-	f = &amp;p-&gt;subs[index].f;
-	if (!p-&gt;r2) {
-		ast_log(LOG_WARNING, &quot;Huh?  No R2 structure :(\n&quot;);
-		return NULL;
-	}
-	switch(e-&gt;e) {
-	case MFCR2_EVENT_BLOCKED:
-		if (option_verbose &gt; 2)
-			ast_verbose(VERBOSE_PREFIX_3 &quot;Channel %d blocked\n&quot;, p-&gt;channel);
-		break;
-	case MFCR2_EVENT_UNBLOCKED:
-		if (option_verbose &gt; 2)
-			ast_verbose(VERBOSE_PREFIX_3 &quot;Channel %d unblocked\n&quot;, p-&gt;channel);
-		break;
-	case MFCR2_EVENT_CONFIG_ERR:
-		if (option_verbose &gt; 2)
-			ast_verbose(VERBOSE_PREFIX_3 &quot;Config error on channel %d\n&quot;, p-&gt;channel);
-		break;
-	case MFCR2_EVENT_RING:
-		if (option_verbose &gt; 2)
-			ast_verbose(VERBOSE_PREFIX_3 &quot;Ring on channel %d\n&quot;, p-&gt;channel);
-		break;
-	case MFCR2_EVENT_HANGUP:
-		if (option_verbose &gt; 2)
-			ast_verbose(VERBOSE_PREFIX_3 &quot;Hangup on channel %d\n&quot;, p-&gt;channel);
-		break;
-	case MFCR2_EVENT_RINGING:
-		if (option_verbose &gt; 2)
-			ast_verbose(VERBOSE_PREFIX_3 &quot;Ringing on channel %d\n&quot;, p-&gt;channel);
-		break;
-	case MFCR2_EVENT_ANSWER:
-		if (option_verbose &gt; 2)
-			ast_verbose(VERBOSE_PREFIX_3 &quot;Answer on channel %d\n&quot;, p-&gt;channel);
-		break;
-	case MFCR2_EVENT_HANGUP_ACK:
-		if (option_verbose &gt; 2)
-			ast_verbose(VERBOSE_PREFIX_3 &quot;Hangup ACK on channel %d\n&quot;, p-&gt;channel);
-		break;
-	case MFCR2_EVENT_IDLE:
-		if (option_verbose &gt; 2)
-			ast_verbose(VERBOSE_PREFIX_3 &quot;Idle on channel %d\n&quot;, p-&gt;channel);
-		break;
-	default:
-		ast_log(LOG_WARNING, &quot;Unknown MFC/R2 event %d\n&quot;, e-&gt;e);
-		break;
-	}
-	return f;
-}
-
-static mfcr2_event_t *r2_get_event_bits(struct zt_pvt *p)
-{
-	int x;
-	int res;
-	mfcr2_event_t *e;
-	res = ioctl(p-&gt;subs[SUB_REAL].zfd, ZT_GETRXBITS, &amp;x);
-	if (res) {
-		ast_log(LOG_WARNING, &quot;Unable to check received bits\n&quot;);
-		return NULL;
-	}
-	if (!p-&gt;r2) {
-		ast_log(LOG_WARNING, &quot;Odd, no R2 structure on channel %d\n&quot;, p-&gt;channel);
-		return NULL;
-	}
-	e = mfcr2_cas_signaling_event(p-&gt;r2, x);
-	return e;
-}
-#endif
-
 static int check_for_conference(struct zt_pvt *p)
 {
 	ZT_CONFINFO ci;
@@ -3690,18 +3561,6 @@
 			break;
 #endif
 		case ZT_EVENT_BITSCHANGED:
-			if (p-&gt;sig == SIG_R2) {
-#ifdef HAVE_MFCR2
-				struct ast_frame  *f = &amp;p-&gt;subs[index].f;
-				mfcr2_event_t *e;
-				e = r2_get_event_bits(p);
-				if (e)
-					f = handle_r2_event(p, e, index);
-				return f;
-#else				
-				break;
-#endif
-			}
 			ast_log(LOG_WARNING, &quot;Recieved bits changed on %s signalling?\n&quot;, sig2str(p-&gt;sig));
 		case ZT_EVENT_PULSE_START:
 			/* Stop tone if there's a pulse start and the PBX isn't started */
@@ -6450,50 +6309,6 @@
 	return NULL;
 }
 
-#ifdef HAVE_MFCR2
-static int handle_init_r2_event(struct zt_pvt *i, mfcr2_event_t *e)
-{
-	struct ast_channel *chan;
-	
-	switch(e-&gt;e) {
-	case MFCR2_EVENT_UNBLOCKED:
-		i-&gt;r2blocked = 0;
-		if (option_verbose &gt; 2)
-			ast_verbose(VERBOSE_PREFIX_3 &quot;R2 Channel %d unblocked\n&quot;, i-&gt;channel);
-		break;
-	case MFCR2_EVENT_BLOCKED:
-		i-&gt;r2blocked = 1;
-		if (option_verbose &gt; 2)
-			ast_verbose(VERBOSE_PREFIX_3 &quot;R2 Channel %d unblocked\n&quot;, i-&gt;channel);
-		break;
-	case MFCR2_EVENT_IDLE:
-		if (option_verbose &gt; 2)
-			ast_verbose(VERBOSE_PREFIX_3 &quot;R2 Channel %d idle\n&quot;, i-&gt;channel);
-		break;
-	case MFCR2_EVENT_RINGING:
-			/* This is what Asterisk refers to as a &quot;RING&quot; event. For some reason they're reversed in
-			   Steve's code */
-			/* Check for callerid, digits, etc */
-			i-&gt;hasr2call = 1;
-			chan = zt_new(i, AST_STATE_RING, 0, SUB_REAL, 0, 0);
-			if (!chan) {
-				ast_log(LOG_WARNING, &quot;Unable to create channel for channel %d\n&quot;, i-&gt;channel);
-				mfcr2_DropCall(i-&gt;r2, NULL, UC_NETWORK_CONGESTION);
-				i-&gt;hasr2call = 0;
-			}
-			if (ast_pbx_start(chan)) {
-				ast_log(LOG_WARNING, &quot;Unable to start PBX on channel %s\n&quot;, chan-&gt;name);
-				ast_hangup(chan);
-			}
-			break;
-	default:
-		ast_log(LOG_WARNING, &quot;Don't know how to handle initial R2 event %s on channel %d\n&quot;, mfcr2_event2str(e-&gt;e), i-&gt;channel);	
-		return -1;
-	}
-	return 0;
-}
-#endif
-
 static int handle_init_event(struct zt_pvt *i, int event)
 {
 	int res;
@@ -6506,16 +6321,6 @@
 	switch(event) {
 	case ZT_EVENT_NONE:
 	case ZT_EVENT_BITSCHANGED:
-		if (i-&gt;radio) break;
-#ifdef HAVE_MFCR2
-		if (i-&gt;r2) {
-			mfcr2_event_t *e;
-			e = r2_get_event_bits(i);
-			i-&gt;sigchecked = 1;
-			if (e)
-				handle_init_r2_event(i, e);
-		}
-#endif		
 		break;
 	case ZT_EVENT_WINKFLASH:
 	case ZT_EVENT_RINGOFFHOOK:
@@ -6743,11 +6548,7 @@
 					pfds[count].events = POLLPRI;
 					pfds[count].revents = 0;
 					/* Message waiting or r2 channels also get watched for reading */
-#ifdef HAVE_MFCR2
-					if (i-&gt;cidspill || i-&gt;r2)
-#else					
 					if (i-&gt;cidspill)
-#endif					
 						pfds[count].events |= POLLIN;
 					count++;
 				}
@@ -6844,22 +6645,6 @@
 						i = i-&gt;next;
 						continue;
 					}
-#ifdef HAVE_MFCR2
-					if (i-&gt;r2) {
-						/* If it's R2 signalled, we always have to check for events */
-						mfcr2_event_t *e;
-						e = mfcr2_check_event(i-&gt;r2);
-						if (e)
-							handle_init_r2_event(i, e);
-						else {
-							e = mfcr2_schedule_run(i-&gt;r2);
-							if (e)
-								handle_init_r2_event(i, e);
-						}
-						i = i-&gt;next;
-						continue;
-					}
-#endif
 					if (!i-&gt;cidspill) {
 						ast_log(LOG_WARNING, &quot;Whoa....  I'm reading but have no cidspill (%d)...\n&quot;, i-&gt;subs[SUB_REAL].zfd);
 						i = i-&gt;next;
@@ -6893,12 +6678,7 @@
 					handle_init_event(i, res);
 					ast_mutex_lock(&amp;iflock);	
 				}
-#ifdef HAVE_MFCR2
-				if ((pollres &amp; POLLPRI) || (i-&gt;r2 &amp;&amp; !i-&gt;sigchecked)) 
-#else				
-				if (pollres &amp; POLLPRI) 
-#endif				
-				{
+				if (pollres &amp; POLLPRI) {
 					if (i-&gt;owner || i-&gt;subs[SUB_REAL].owner) {
 #ifdef HAVE_LIBPRI
 						if (!i-&gt;pri)
@@ -7293,26 +7073,6 @@
 				tmp-&gt;prioffset = 0;
 			}
 #endif
-#ifdef HAVE_MFCR2
-			if (signalling == SIG_R2) {
-				if (r2prot &lt; 0) {
-					ast_log(LOG_WARNING, &quot;R2 Country not specified for channel %d -- Assuming China\n&quot;, tmp-&gt;channel);
-					tmp-&gt;r2prot = MFCR2_PROT_CHINA;
-				} else
-					tmp-&gt;r2prot = r2prot;
-				tmp-&gt;r2 = mfcr2_new(tmp-&gt;subs[SUB_REAL].zfd, tmp-&gt;r2prot, 1);
-				if (!tmp-&gt;r2) {
-					ast_log(LOG_WARNING, &quot;Unable to create r2 call :(\n&quot;);
-					zt_close(tmp-&gt;subs[SUB_REAL].zfd);
-					destroy_zt_pvt(&amp;tmp);
-					return NULL;
-				}
-			} else {
-				if (tmp-&gt;r2) 
-					mfcr2_free(tmp-&gt;r2);
-				tmp-&gt;r2 = NULL;
-			}
-#endif
 		} else {
 			signalling = tmp-&gt;sig;
 			radio = tmp-&gt;radio;
@@ -7484,7 +7244,7 @@
 				ast_dsp_digitmode(tmp-&gt;dsp, DSP_DIGITMODE_DTMF | tmp-&gt;dtmfrelax);
 			update_conf(tmp);
 			if (!here) {
-				if ((signalling != SIG_PRI) &amp;&amp; (signalling != SIG_R2))
+				if (signalling != SIG_PRI)
 					/* Hang it up to be sure it's good */
 					zt_set_hook(tmp-&gt;subs[SUB_REAL].zfd, ZT_ONHOOK);
 			}
@@ -7598,15 +7358,6 @@
 				return 1;
 		}
 #endif
-#ifdef HAVE_MFCR2
-		/* Trust R2 as well */
-		if (p-&gt;r2) {
-			if (p-&gt;hasr2call || p-&gt;r2blocked)
-				return 0;
-			else
-				return 1;
-		}
-#endif
 		if (!(p-&gt;radio || (p-&gt;oprmode &lt; 0)))
 		{
 			if (!p-&gt;sig || (p-&gt;sig == SIG_FXSLS))
@@ -9742,85 +9493,6 @@
 
 #endif /* HAVE_LIBPRI */
 
-
-#ifdef HAVE_MFCR2
-static int handle_r2_no_debug(int fd, int argc, char *argv[])
-{
-	int chan;
-	struct zt_pvt *tmp = NULL;;
-	if (argc &lt; 5)
-		return RESULT_SHOWUSAGE;
-	chan = atoi(argv[4]);
-	if ((chan &lt; 1) || (chan &gt; NUM_SPANS)) {
-		ast_cli(fd, &quot;Invalid channel %s.  Should be a number greater than 0\n&quot;, argv[4]);
-		return RESULT_SUCCESS;
-	}
-	tmp = iflist;
-	while(tmp) {
-		if (tmp-&gt;channel == chan) {
-			if (tmp-&gt;r2) {
-				mfcr2_set_debug(tmp-&gt;r2, 0);
-				ast_cli(fd, &quot;Disabled R2 debugging on channel %d\n&quot;, chan);
-				return RESULT_SUCCESS;
-			}
-			break;
-		}
-		tmp = tmp-&gt;next;
-	}
-	if (tmp) 
-		ast_cli(fd, &quot;No R2 running on channel %d\n&quot;, chan);
-	else
-		ast_cli(fd, &quot;No such zap channel %d\n&quot;, chan);
-	return RESULT_SUCCESS;
-}
-
-static int handle_r2_debug(int fd, int argc, char *argv[])
-{
-	int chan;
-	struct zt_pvt *tmp = NULL;;
-	if (argc &lt; 4) {
-		return RESULT_SHOWUSAGE;
-	}
-	chan = atoi(argv[3]);
-	if ((chan &lt; 1) || (chan &gt; NUM_SPANS)) {
-		ast_cli(fd, &quot;Invalid channel %s.  Should be a number greater than 0\n&quot;, argv[3]);
-		return RESULT_SUCCESS;
-	}
-	tmp = iflist;
-	while(tmp) {
-		if (tmp-&gt;channel == chan) {
-			if (tmp-&gt;r2) {
-				mfcr2_set_debug(tmp-&gt;r2, 0xFFFFFFFF);
-				ast_cli(fd, &quot;Enabled R2 debugging on channel %d\n&quot;, chan);
-				return RESULT_SUCCESS;
-			}
-			break;
-		}
-		tmp = tmp-&gt;next;
-	}
-	if (tmp) 
-		ast_cli(fd, &quot;No R2 running on channel %d\n&quot;, chan);
-	else
-		ast_cli(fd, &quot;No such zap channel %d\n&quot;, chan);
-	return RESULT_SUCCESS;
-}
-static char r2_debug_help[] = 
-	&quot;Usage: r2 debug channel &lt;channel&gt;\n&quot;
-	&quot;       Enables R2 protocol level debugging on a given channel\n&quot;;
-	
-static char r2_no_debug_help[] = 
-	&quot;Usage: r2 no debug channel &lt;channel&gt;\n&quot;
-	&quot;       Enables R2 protocol level debugging on a given channel\n&quot;;
-
-static struct ast_cli_entry zap_r2_cli[] = {
-	{ { &quot;r2&quot;, &quot;debug&quot;, &quot;channel&quot;, NULL }, handle_r2_debug,
-	  &quot;Enables R2 debugging on a channel&quot;, r2_debug_help },
-	{ { &quot;r2&quot;, &quot;no&quot;, &quot;debug&quot;, &quot;channel&quot;, NULL }, handle_r2_no_debug,
-	  &quot;Disables R2 debugging on a channel&quot;, r2_no_debug_help },
-};
-
-#endif
-
 static int zap_destroy_channel(int fd, int argc, char **argv)
 {
 	int channel = 0;
@@ -10048,16 +9720,6 @@
 			}
 				
 #endif
-#ifdef HAVE_MFCR2
-			if (tmp-&gt;r2) {
-				ast_cli(fd, &quot;R2 Flags: &quot;);
-				if (tmp-&gt;r2blocked)
-					ast_cli(fd, &quot;Blocked &quot;);
-				if (tmp-&gt;hasr2call)
-					ast_cli(fd, &quot;Call &quot;);
-				ast_cli(fd, &quot;\n&quot;);
-			}
-#endif
 			memset(&amp;ci, 0, sizeof(ci));
 			ps.channo = tmp-&gt;channel;
 			if (tmp-&gt;subs[SUB_REAL].zfd &gt; -1) {
@@ -10406,9 +10068,6 @@
 	ast_cli_unregister_multiple(zap_pri_cli, sizeof(zap_pri_cli) / sizeof(zap_pri_cli[0]));
 	ast_unregister_application(zap_send_keypad_facility_app);
 #endif
-#ifdef HAVE_MFCR2
-	ast_cli_unregister_multiple(zap_r2_cli, sizeof(zap_r2_cli) / sizeof(zap_r2_cli[0]));
-#endif
 	ast_cli_unregister_multiple(zap_cli, sizeof(zap_cli) / sizeof(zap_cli[0]));
 	ast_manager_unregister( &quot;ZapDialOffhook&quot; );
 	ast_manager_unregister( &quot;ZapHangup&quot; );
@@ -10982,11 +10641,6 @@
 					cur_radio = 0;
 					pritype = PRI_CPE;
 #endif
-#ifdef HAVE_MFCR2
-				} else if (!strcasecmp(v-&gt;value, &quot;r2&quot;)) {
-					cur_signalling = SIG_R2;
-					cur_radio = 0;
-#endif			
 				} else {
 					ast_log(LOG_ERROR, &quot;Unknown signalling method '%s'\n&quot;, v-&gt;value);
 				}
@@ -11026,13 +10680,6 @@
 				} else {
 					ast_log(LOG_ERROR, &quot;Unknown signalling method '%s'\n&quot;, v-&gt;value);
 				}
-#ifdef HAVE_MFCR2
-			} else if (!strcasecmp(v-&gt;name, &quot;r2country&quot;)) {
-				r2prot = str2r2prot(v-&gt;value);
-				if (r2prot &lt; 0) {
-					ast_log(LOG_WARNING, &quot;Unknown R2 Country '%s' at line %d.\n&quot;, v-&gt;value, v-&gt;lineno);
-				}
-#endif
 #ifdef HAVE_LIBPRI
 			} else if (!strcasecmp(v-&gt;name, &quot;pridialplan&quot;)) {
 				if (!strcasecmp(v-&gt;value, &quot;national&quot;)) {
@@ -11370,9 +11017,6 @@
 	ast_string_field_set(&amp;inuse, name, &quot;GR-303InUse&quot;);
 	ast_cli_register_multiple(zap_pri_cli, sizeof(zap_pri_cli) / sizeof(zap_pri_cli[0]));
 #endif	
-#ifdef HAVE_MFCR2
-	ast_cli_register_multiple(zap_r2_cli, sizeof(zap_r2_cli) / sizeof(zap_r2_cli[0]));
-#endif	
 	ast_cli_register_multiple(zap_cli, sizeof(zap_cli) / sizeof(zap_cli[0]));
 	
 	memset(round_robin, 0, sizeof(round_robin));
@@ -11504,9 +11148,6 @@
 #ifdef ZAPATA_PRI
                &quot; w/PRI&quot;
 #endif
-#ifdef ZAPATA_R2
-               &quot; w/R2&quot;
-#endif
 	;
 }
 

Modified: trunk/configure.ac
===================================================================
--- trunk/configure.ac	2006-04-30 14:54:24 UTC (rev 14)
+++ trunk/configure.ac	2006-04-30 15:42:56 UTC (rev 15)
@@ -159,7 +159,6 @@
 
 AST_EXT_LIB([asound], [snd_spcm_init], [alsa/asoundlib.h], [ALSA], [Advanced Linux Sound Architecture], [-lm -ldl])
 AST_EXT_LIB([curses], [initscr], [curses.h], [CURSES], [curses], [])
-AST_EXT_LIB([mfcr2], [mfcr2_MakeCall], [libmfcr2.h], [MFCR2], [MFCR2])
 AST_EXT_LIB([nbs], [nbs_connect], [nbs.h], [NBS], [Network Broadcast Sound])
 AST_EXT_LIB([ncurses], [initscr], [curses.h], [NCURSES], [ncurses], [])
 AST_EXT_LIB([newt], [newtBell], [newt.h], [NEWT], [newt])
@@ -186,7 +185,7 @@
 if test &quot;x${PBX_OSTYPE}&quot; = &quot;xLinux&quot; ; then
    AST_EXT_LIB([tonezone], [tone_zone_find], [linux/zaptel.h], [ZAPTEL], [Zaptel])
 else
-   AST_EXT_LIB([tonezone], [tone_zone_find], [zaptel.h], [ZAPTEL], [Zaptel])
+   AST_EXT_LIB([tonezone], [tone_zone_find], [zaptel.h], [ZAPTEL], [Zaptel], [-lm])
 fi
 
 GSM_INTERNAL=&quot;yes&quot;

Modified: trunk/db1-ast/Makefile
===================================================================
--- trunk/db1-ast/Makefile	2006-04-30 14:54:24 UTC (rev 14)
+++ trunk/db1-ast/Makefile	2006-04-30 15:42:56 UTC (rev 15)
@@ -10,7 +10,7 @@
 #Added support for UltraSparc - Belgarath
 ifeq ($(ARCH),sparc64)
 PROC=ultrasparc
-CFLAGS += -mtune=$(PROC) -O3 -pipe -fomit-frame-pointer -mcpu=v8
+CFLAGS += -mtune=$(PROC) -pipe -fomit-frame-pointer -mcpu=v8
 endif
 
 ifeq ($(OSARCH),Darwin)

Modified: trunk/doc/asterisk-conf.txt
===================================================================
--- trunk/doc/asterisk-conf.txt	2006-04-30 14:54:24 UTC (rev 14)
+++ trunk/doc/asterisk-conf.txt	2006-04-30 15:42:56 UTC (rev 15)
@@ -42,6 +42,7 @@
 verbose = 0					; Verbosity level for logging (-v)
 debug = 3					; Debug: &quot;No&quot; or value (1-4)
 nofork=yes | no					; Background execution disabled (-f)
+alwaysfork=yes | no				; Always background, even with -v or -d (-F)
 console= yes | no				; Console mode (-c)
 highpriority = yes | no				; Execute with high priority (-p)
 initcrypto = yes | no				; Initialize crypto at startup (-i)

Modified: trunk/editline/configure
===================================================================
--- trunk/editline/configure	2006-04-30 14:54:24 UTC (rev 14)
+++ trunk/editline/configure	2006-04-30 15:42:56 UTC (rev 15)
@@ -1923,8 +1923,6 @@
 if test &quot;x$enable_debug&quot; = &quot;xyes&quot; ; then
   CPPFLAGS=&quot;$CPPFLAGS -DDEBUG_TTY -DDEBUG_KEY -DDEBUG_READ -DDEBUG&quot;
   CPPFLAGS=&quot;$CPPFLAGS -DDEBUG_REFRESH -DDEBUG_PASTE&quot;
-else
-  CFLAGS=&quot;$CFLAGS -O&quot;
 fi
 
 

Modified: trunk/editline/makelist
===================================================================
--- trunk/editline/makelist	2006-04-30 14:54:24 UTC (rev 14)
+++ trunk/editline/makelist	2006-04-30 15:42:56 UTC (rev 15)
@@ -145,7 +145,7 @@
 #
 -fh)
     cat $FILES | $AWK '/el_action_t/ { print $3 }' | \
-    sort | tr '[a-z]' '[A-Z]' | $AWK '
+    sort | tr '[:lower:]' '[:upper:]' | $AWK '
 	BEGIN {
 	    printf(&quot;/* Automatically generated file, do not edit */\n&quot;);
 	    printf(&quot;#ifndef _h_fcns_c\n#define _h_fcns_c\n&quot;);

Modified: trunk/include/asterisk/options.h
===================================================================
--- trunk/include/asterisk/options.h	2006-04-30 14:54:24 UTC (rev 14)
+++ trunk/include/asterisk/options.h	2006-04-30 15:42:56 UTC (rev 15)
@@ -71,9 +71,11 @@
 	/*! Suppress some warnings */
 	AST_OPT_FLAG_DONT_WARN = (1 &lt;&lt; 18),
 	/*! End CDRs before the 'h' extension */
-	AST_OPT_END_CDR_BEFORE_H_EXTEN = (1 &lt;&lt; 19),
+	AST_OPT_FLAG_END_CDR_BEFORE_H_EXTEN = (1 &lt;&lt; 19),
 	/*! Use Zaptel Timing for generators if available */
-	AST_OPT_FLAG_INTERNAL_TIMING = (1 &lt;&lt; 20)
+	AST_OPT_FLAG_INTERNAL_TIMING = (1 &lt;&lt; 20),
+	/*! Always fork, even if verbose or debug settings are non-zero */
+	AST_OPT_FLAG_ALWAYS_FORK = (1 &lt;&lt; 21),
 };
 
 /*! These are the options that set by default when Asterisk starts */
@@ -98,8 +100,9 @@
 #define ast_opt_reconnect		ast_test_flag(&amp;ast_options, AST_OPT_FLAG_RECONNECT)
 #define ast_opt_transmit_silence	ast_test_flag(&amp;ast_options, AST_OPT_FLAG_TRANSMIT_SILENCE)
 #define ast_opt_dont_warn		ast_test_flag(&amp;ast_options, AST_OPT_FLAG_DONT_WARN)
-#define ast_opt_end_cdr_before_h_exten	ast_test_flag(&amp;ast_options, AST_OPT_END_CDR_BEFORE_H_EXTEN)
+#define ast_opt_end_cdr_before_h_exten	ast_test_flag(&amp;ast_options, AST_OPT_FLAG_END_CDR_BEFORE_H_EXTEN)
 #define ast_opt_internal_timing		ast_test_flag(&amp;ast_options, AST_OPT_FLAG_INTERNAL_TIMING)
+#define ast_opt_always_fork		ast_test_flag(&amp;ast_options, AST_OPT_FLAG_ALWAYS_FORK)
 
 extern struct ast_flags ast_options;
 

Modified: trunk/pbx/Makefile
===================================================================
--- trunk/pbx/Makefile	2006-04-30 14:54:24 UTC (rev 14)
+++ trunk/pbx/Makefile	2006-04-30 15:42:56 UTC (rev 15)
@@ -59,10 +59,10 @@
 ael/aelbison.o: ael/ael.tab.c ael/ael.tab.h ../include/asterisk/ael_structs.h
 	$(CC) $(CFLAGS) -I. -c -o ael/aelbison.o ael/ael.tab.c
 
-ael/ael_lex.c: ael/ael.flex
+ael/ael_lex.c:
 	(cd ael; flex ael.flex)
 
-ael/ael.tab.c ael/ael.tab.h: ael/ael.y
+ael/ael.tab.c ael/ael.tab.h:
 	(cd ael; bison -v -d ael.y)
 
 %.moc : %.h

Modified: trunk/pbx/ael/ael.flex
===================================================================
--- trunk/pbx/ael/ael.flex	2006-04-30 14:54:24 UTC (rev 14)
+++ trunk/pbx/ael/ael.flex	2006-04-30 15:42:56 UTC (rev 15)
@@ -70,6 +70,8 @@
  */
 static char pbcstack[400];	/* XXX missing size checks */
 static int pbcpos = 0;
+static void pbcpush(char x);
+static int pbcpop(char x);
 
 static int parencount = 0;
 static int commaout = 0;
@@ -94,8 +96,6 @@
 void ael_yyset_column (int  column_no , yyscan_t yyscanner);
 
 int ael_yyparse (struct parse_io *);
-static void pbcpush(char x);
-static int pbcpop(char x);
 
 /*
  * A stack to process include files.
@@ -240,8 +240,7 @@
 		} else {
 			STORE_LOC;
 			yylval-&gt;str = strdup(yytext);
-			*(yylval-&gt;str+strlen(yylval-&gt;str)-1)=0;
-			/* printf(&quot;Got paren word %s\n&quot;, yylval-&gt;str); */
+			yylval-&gt;str[strlen(yylval-&gt;str)-1] = '\0'; /* trim trailing ')' */
 			unput(')');
 			BEGIN(0);
 			return word;
@@ -293,7 +292,7 @@
 			STORE_LOC;
 			yylval-&gt;str = strdup(yytext);
 			if(yyleng &gt; 1 )
-				*(yylval-&gt;str+yyleng-1)=0;
+				yylval-&gt;str[yyleng-1] = '\0'; /* trim trailing ')' */
 			BEGIN(0);
 			if ( !strcmp(yylval-&gt;str,&quot;)&quot;) ) {
 				free(yylval-&gt;str);

Modified: trunk/pbx/ael/ael.tab.c
===================================================================
--- trunk/pbx/ael/ael.tab.c	2006-04-30 14:54:24 UTC (rev 14)
+++ trunk/pbx/ael/ael.tab.c	2006-04-30 15:42:56 UTC (rev 15)
@@ -181,10 +181,6 @@
 #include &quot;asterisk/utils.h&quot;		/* ast_calloc() */
 #include &quot;asterisk/ael_structs.h&quot;
 
-/* create a new object with start-end marker */
-static pval *npval(pvaltype type, int first_line, int last_line,
-	int first_column, int last_column);
-
 static pval * linku1(pval *head, pval *tail);
 
 void reset_parencount(yyscan_t yyscanner);
@@ -221,13 +217,14 @@
 #endif
 
 #if ! defined (YYSTYPE) &amp;&amp; ! defined (YYSTYPE_IS_DECLARED)
-#line 53 &quot;ael.y&quot;
+#line 49 &quot;ael.y&quot;
 typedef union YYSTYPE {
-	char *str;
-	struct pval *pval;
+	int	intval;		/* integer value, typically flags */
+	char	*str;		/* strings */
+	struct pval *pval;	/* full objects */
 } YYSTYPE;
 /* Line 196 of yacc.c.  */
-#line 231 &quot;ael.tab.c&quot;
+#line 228 &quot;ael.tab.c&quot;
 # define yystype YYSTYPE /* obsolescent; will be withdrawn */
 # define YYSTYPE_IS_DECLARED 1
 # define YYSTYPE_IS_TRIVIAL 1
@@ -248,20 +245,30 @@
 
 
 /* Copy the second part of user declarations.  */
-#line 58 &quot;ael.y&quot;
+#line 55 &quot;ael.y&quot;
 
 	/* declaring these AFTER the union makes things a lot simpler! */
 void yyerror(YYLTYPE *locp, struct parse_io *parseio, char const *s);
 int ael_yylex (YYSTYPE * yylval_param, YYLTYPE * yylloc_param , void * yyscanner);
 
+/* create a new object with start-end marker */
+static pval *npval(pvaltype type, int first_line, int last_line,
+	int first_column, int last_column);
+
 /* create a new object with start-end marker, simplified interface.
  * Must be declared here because YYLTYPE is not known before
  */
 static pval *npval2(pvaltype type, YYLTYPE *first, YYLTYPE *last);
 
+/* another frontend for npval, this time for a string */
+static pval *nword(char *string, YYLTYPE *pos);
 
+/* update end position of an object, return the object */
+static pval *update_last(pval *, YYLTYPE *);
+
+
 /* Line 219 of yacc.c.  */
-#line 265 &quot;ael.tab.c&quot;
+#line 272 &quot;ael.tab.c&quot;
 
 #if ! defined (YYSIZE_T) &amp;&amp; defined (__SIZE_TYPE__)
 # define YYSIZE_T __SIZE_TYPE__
@@ -412,18 +419,18 @@
 #endif
 
 /* YYFINAL -- State number of the termination state. */
-#define YYFINAL  18
+#define YYFINAL  14
 /* YYLAST -- Last index in YYTABLE.  */
 #define YYLAST   505
 
 /* YYNTOKENS -- Number of terminals. */
 #define YYNTOKENS  42
 /* YYNNTS -- Number of nonterminals. */
-#define YYNNTS  55
+#define YYNNTS  58
 /* YYNRULES -- Number of rules. */
-#define YYNRULES  149
+#define YYNRULES  150
 /* YYNRULES -- Number of states. */
-#define YYNSTATES  346
+#define YYNSTATES  340
 
 /* YYTRANSLATE(YYLEX) -- Bison symbol number corresponding to YYLEX.  */
 #define YYUNDEFTOK  2
@@ -473,105 +480,105 @@
 static const unsigned short int yyprhs[] =
 {
        0,     0,     3,     5,     7,    10,    13,    15,    17,    19,
-      21,    23,    25,    31,    36,    43,    49,    58,    66,    74,
-      81,    86,    90,    92,    95,    98,    99,   105,   107,   111,
-     114,   116,   118,   121,   124,   126,   128,   130,   132,   134,
-     135,   141,   144,   146,   151,   155,   160,   168,   177,   179,
-     182,   185,   186,   192,   193,   199,   214,   225,   227,   230,
-     232,   235,   239,   241,   244,   248,   249,   256,   260,   261,
-     267,   271,   275,   278,   279,   280,   281,   294,   295,   302,
-     305,   309,   313,   316,   319,   320,   326,   329,   332,   335,
-     339,   343,   347,   349,   352,   353,   355,   359,   363,   369,
-     375,   381,   387,   389,   393,   399,   403,   409,   413,   414,
-     420,   424,   425,   429,   433,   436,   438,   439,   441,   442,
-     446,   448,   451,   456,   460,   465,   469,   472,   476,   478,
-     481,   483,   489,   494,   498,   503,   507,   510,   514,   517,
-     520,   535,   546,   550,   566,   578,   581,   583,   585,   590
+      21,    23,    25,    30,    32,    33,    42,    50,    58,    65,
+      70,    74,    76,    79,    82,    83,    89,    91,    95,    98,
+     101,   105,   107,   109,   112,   115,   117,   119,   121,   123,
+     125,   126,   132,   135,   137,   142,   146,   151,   159,   168,
+     170,   173,   176,   177,   183,   184,   190,   205,   216,   218,
+     221,   223,   226,   230,   232,   235,   239,   240,   247,   251,
+     252,   258,   262,   266,   269,   270,   271,   272,   285,   286,
+     293,   296,   300,   304,   307,   310,   311,   317,   320,   323,
+     326,   330,   334,   338,   340,   343,   344,   346,   350,   354,
+     360,   366,   372,   378,   380,   384,   390,   394,   400,   404,
+     405,   411,   415,   416,   420,   424,   427,   429,   430,   432,
+     433,   437,   439,   442,   447,   451,   456,   460,   463,   467,
+     469,   472,   474,   480,   483,   486,   490,   493,   496,   500,
+     503,   506,   521,   532,   536,   552,   564,   567,   569,   571,
+     576
 };
 
 /* YYRHS -- A `-1'-separated list of the rules' RHS. */
 static const yysigned_char yyrhs[] =
 {
       43,     0,    -1,    44,    -1,    45,    -1,    44,    45,    -1,
-      44,     1,    -1,    47,    -1,    48,    -1,    49,    -1,     8,
-      -1,    41,    -1,    36,    -1,     3,    46,     4,    54,     5,
-      -1,     3,    46,     4,     5,    -1,    23,     3,    46,     4,
-      54,     5,    -1,    23,     3,    46,     4,     5,    -1,    15,
-      41,     6,    53,     7,     4,    89,     5,    -1,    15,    41,
-       6,    53,     7,     4,     5,    -1,    15,    41,     6,     7,
-       4,    89,     5,    -1,    15,    41,     6,     7,     4,     5,
-      -1,    16,     4,    50,     5,    -1,    16,     4,     5,    -1,
-      51,    -1,    50,    51,    -1,    50,     1,    -1,    -1,    41,
-       9,    52,    41,     8,    -1,    41,    -1,    53,    10,    41,
-      -1,    53,     1,    -1,    55,    -1,     1,    -1,    54,    55,
-      -1,    54,     1,    -1,    58,    -1,    96,    -1,    91,    -1,
-      92,    -1,    57,    -1,    -1,    41,     9,    56,    41,     8,
-      -1,    41,     1,    -1,     8,    -1,    17,    24,    41,     8,
-      -1,    41,    24,    70,    -1,    30,    41,    24,    70,    -1,
-      31,     6,    66,     7,    41,    24,    70,    -1,    30,    31,
-       6,    66,     7,    41,    24,    70,    -1,    70,    -1,    59,
-      70,    -1,    59,     1,    -1,    -1,    19,     6,    61,    65,
-       7,    -1,    -1,    22,     6,    63,    65,     7,    -1,    20,
-       6,    66,    11,    66,    11,    66,    13,    66,    13,    66,
-      13,    66,     7,    -1,    20,     6,    41,    13,    66,    13,
-      66,    13,    66,     7,    -1,    41,    -1,    41,    41,    -1,
-      41,    -1,    41,    41,    -1,    41,    41,    41,    -1,    41,
-      -1,    41,    41,    -1,    41,    11,    41,    -1,    -1,    18,
-       6,    69,    41,     7,     4,    -1,     4,    59,     5,    -1,
-      -1,    41,     9,    71,    41,     8,    -1,    25,    78,     8,
-      -1,    26,    79,     8,    -1,    41,    11,    -1,    -1,    -1,
-      -1,    32,     6,    72,    41,     8,    73,    41,     8,    74,
-      41,     7,    70,    -1,    -1,    33,     6,    75,    41,     7,
-      70,    -1,    68,     5,    -1,    68,    87,     5,    -1,    12,
-      80,     8,    -1,    84,     8,    -1,    41,     8,    -1,    -1,
-      84,     9,    76,    41,     8,    -1,    28,     8,    -1,    27,
-       8,    -1,    29,     8,    -1,    62,    70,    77,    -1,    60,
-      70,    77,    -1,    64,    70,    77,    -1,     8,    -1,    21,
-      70,    -1,    -1,    67,    -1,    67,    13,    67,    -1,    67,
-      10,    67,    -1,    67,    13,    67,    13,    67,    -1,    67,
-      10,    67,    10,    67,    -1,    36,    13,    67,    13,    67,
-      -1,    36,    10,    67,    10,    67,    -1,    67,    -1,    67,
-      10,    67,    -1,    67,    10,    41,    14,    41,    -1,    67,
-      14,    67,    -1,    67,    10,    41,    14,    36,    -1,    67,
-      14,    36,    -1,    -1,    41,     6,    81,    86,     7,    -1,
-      41,     6,     7,    -1,    -1,    41,    83,     6,    -1,    82,
-      86,     7,    -1,    82,     7,    -1,    41,    -1,    -1,    65,
-      -1,    -1,    86,    10,    85,    -1,    88,    -1,    87,    88,
-      -1,    34,    41,    11,    59,    -1,    36,    11,    59,    -1,
-      35,    41,    11,    59,    -1,    34,    41,    11,    -1,    36,
-      11,    -1,    35,    41,    11,    -1,    90,    -1,    89,    90,
-      -1,    70,    -1,    37,    41,     4,    59,     5,    -1,    38,
-       4,    93,     5,    -1,    38,     4,     5,    -1,    39,     4,
-      93,     5,    -1,    39,     4,     5,    -1,    41,     8,    -1,
-      93,    41,     8,    -1,    93,     1,    -1,    95,     8,    -1,
-      95,    13,    66,    11,    66,    11,    66,    13,    66,    13,
-      66,    13,    66,     8,    -1,    95,    13,    41,    13,    66,
-      13,    66,    13,    66,     8,    -1,    94,    95,     8,    -1,
-      94,    95,    13,    66,    11,    66,    11,    66,    13,    66,
-      13,    66,    13,    66,     8,    -1,    94,    95,    13,    41,
-      13,    66,    13,    66,    13,    66,     8,    -1,    94,     1,
-      -1,    41,    -1,    36,    -1,    40,     4,    94,     5,    -1,
-      40,     4,     5,    -1
+      44,     1,    -1,    47,    -1,    49,    -1,    50,    -1,     8,
+      -1,    41,    -1,    36,    -1,    48,     3,    46,    55,    -1,
+      23,    -1,    -1,    15,    41,     6,    54,     7,     4,    91,
+       5,    -1,    15,    41,     6,    54,     7,     4,     5,    -1,
+      15,    41,     6,     7,     4,    91,     5,    -1,    15,    41,
+       6,     7,     4,     5,    -1,    16,     4,    51,     5,    -1,
+      16,     4,     5,    -1,    52,    -1,    51,    52,    -1,    51,
+       1,    -1,    -1,    41,     9,    53,    41,     8,    -1,    41,
+      -1,    54,    10,    41,    -1,    54,     1,    -1,     4,     5,
+      -1,     4,    56,     5,    -1,    57,    -1,     1,    -1,    56,
+      57,    -1,    56,     1,    -1,    60,    -1,    99,    -1,    93,
+      -1,    94,    -1,    59,    -1,    -1,    41,     9,    58,    41,
+       8,    -1,    41,     1,    -1,     8,    -1,    17,    24,    41,
+       8,    -1,    41,    24,    72,    -1,    30,    41,    24,    72,
+      -1,    31,     6,    68,     7,    41,    24,    72,    -1,    30,
+      31,     6,    68,     7,    41,    24,    72,    -1,    72,    -1,
+      61,    72,    -1,    61,     1,    -1,    -1,    19,     6,    63,
+      67,     7,    -1,    -1,    22,     6,    65,    67,     7,    -1,
+      20,     6,    68,    11,    68,    11,    68,    13,    68,    13,
+      68,    13,    68,     7,    -1,    20,     6,    41,    13,    68,
+      13,    68,    13,    68,     7,    -1,    41,    -1,    41,    41,
+      -1,    41,    -1,    41,    41,    -1,    41,    41,    41,    -1,
+      41,    -1,    41,    41,    -1,    41,    11,    41,    -1,    -1,
+      18,     6,    71,    41,     7,     4,    -1,     4,    61,     5,
+      -1,    -1,    41,     9,    73,    41,     8,    -1,    25,    80,
+       8,    -1,    26,    81,     8,    -1,    41,    11,    -1,    -1,
+      -1,    -1,    32,     6,    74,    41,     8,    75,    41,     8,
+      76,    41,     7,    72,    -1,    -1,    33,     6,    77,    41,
+       7,    72,    -1,    70,     5,    -1,    70,    89,     5,    -1,
+      12,    82,     8,    -1,    86,     8,    -1,    41,     8,    -1,
+      -1,    86,     9,    78,    41,     8,    -1,    28,     8,    -1,
+      27,     8,    -1,    29,     8,    -1,    64,    72,    79,    -1,
+      62,    72,    79,    -1,    66,    72,    79,    -1,     8,    -1,
+      21,    72,    -1,    -1,    69,    -1,    69,    13,    69,    -1,
+      69,    10,    69,    -1,    69,    13,    69,    13,    69,    -1,
+      69,    10,    69,    10,    69,    -1,    36,    13,    69,    13,
+      69,    -1,    36,    10,    69,    10,    69,    -1,    69,    -1,
+      69,    10,    69,    -1,    69,    10,    41,    14,    41,    -1,
+      69,    14,    69,    -1,    69,    10,    41,    14,    36,    -1,
+      69,    14,    36,    -1,    -1,    41,     6,    83,    88,     7,
+      -1,    41,     6,     7,    -1,    -1,    41,    85,     6,    -1,
+      84,    88,     7,    -1,    84,     7,    -1,    41,    -1,    -1,
+      67,    -1,    -1,    88,    10,    87,    -1,    90,    -1,    89,
+      90,    -1,    34,    41,    11,    61,    -1,    36,    11,    61,
+      -1,    35,    41,    11,    61,    -1,    34,    41,    11,    -1,
+      36,    11,    -1,    35,    41,    11,    -1,    92,    -1,    91,
+      92,    -1,    72,    -1,    37,    41,     4,    61,     5,    -1,
+      38,    95,    -1,    39,    95,    -1,     4,    96,     5,    -1,
+       4,     5,    -1,    41,     8,    -1,    96,    41,     8,    -1,
+      96,     1,    -1,    98,     8,    -1,    98,    13,    68,    11,
+      68,    11,    68,    13,    68,    13,    68,    13,    68,     8,
+      -1,    98,    13,    41,    13,    68,    13,    68,    13,    68,
+       8,    -1,    97,    98,     8,    -1,    97,    98,    13,    68,
+      11,    68,    11,    68,    13,    68,    13,    68,    13,    68,
+       8,    -1,    97,    98,    13,    41,    13,    68,    13,    68,
+      13,    68,     8,    -1,    97,     1,    -1,    41,    -1,    36,
+      -1,    40,     4,    97,     5,    -1,    40,     4,     5,    -1
 };
 
 /* YYRLINE[YYN] -- source line where rule number YYN was defined.  */
 static const unsigned short int yyrline[] =
 {
-       0,   165,   165,   168,   169,   180,   183,   184,   185,   186,
-     189,   190,   193,   197,   200,   205,   229,   232,   235,   239,
-     244,   247,   251,   252,   253,   256,   256,   262,   265,   269,
-     272,   273,   274,   277,   280,   281,   282,   283,   284,   285,
-     285,   289,   290,   293,   298,   302,   307,   312,   321,   322,
-     325,   328,   328,   333,   333,   338,   354,   374,   375,   382,
-     383,   388,   396,   397,   401,   407,   407,   415,   418,   418,
-     422,   425,   428,   431,   432,   433,   431,   439,   439,   443,
-     447,   452,   456,   460,   463,   463,   496,   497,   498,   499,
-     513,   527,   541,   544,   545,   550,   552,   557,   562,   569,
-     576,   583,   592,   597,   602,   609,   616,   623,   632,   632,
-     637,   642,   642,   652,   658,   661,   662,   665,   668,   671,
-     685,   686,   691,   695,   699,   703,   706,   709,   714,   715,
-     720,   721,   727,   730,   734,   737,   741,   744,   749,   752,
-     755,   772,   785,   790,   808,   823,   826,   827,   830,   833
+       0,   177,   177,   180,   181,   192,   195,   196,   197,   198,
+     201,   202,   205,   213,   214,   217,   220,   223,   227,   232,
+     235,   239,   240,   241,   244,   244,   250,   251,   255,   258,
+     259,   262,   263,   264,   267,   270,   271,   272,   273,   274,
+     275,   275,   279,   280,   283,   288,   292,   297,   302,   311,
+     312,   315,   318,   318,   323,   323,   328,   341,   357,   358,
+     365,   366,   371,   379,   380,   384,   390,   390,   398,   401,
+     401,   405,   408,   411,   414,   415,   416,   414,   422,   422,
+     426,   428,   431,   433,   435,   438,   438,   471,   472,   473,
+     474,   478,   482,   486,   489,   490,   495,   496,   499,   502,
+     506,   510,   514,   521,   524,   527,   534,   541,   548,   557,
+     557,   562,   567,   567,   577,   584,   587,   588,   591,   592,
+     595,   601,   602,   607,   611,   615,   619,   622,   625,   630,
+     631,   636,   637,   643,   648,   653,   654,   657,   660,   665,
+     668,   671,   685,   694,   699,   714,   726,   729,   730,   733,
+     736
 };
 #endif
 
@@ -587,15 +594,16 @@
   &quot;KW_RETURN&quot;, &quot;KW_BREAK&quot;, &quot;KW_CONTINUE&quot;, &quot;KW_REGEXTEN&quot;, &quot;KW_HINT&quot;,
   &quot;KW_FOR&quot;, &quot;KW_WHILE&quot;, &quot;KW_CASE&quot;, &quot;KW_PATTERN&quot;, &quot;KW_DEFAULT&quot;, &quot;KW_CATCH&quot;,
   &quot;KW_SWITCHES&quot;, &quot;KW_ESWITCHES&quot;, &quot;KW_INCLUDES&quot;, &quot;word&quot;, &quot;$accept&quot;, &quot;file&quot;,
-  &quot;objects&quot;, &quot;object&quot;, &quot;word_or_default&quot;, &quot;context&quot;, &quot;macro&quot;, &quot;globals&quot;,
-  &quot;global_statements&quot;, &quot;global_statement&quot;, &quot;@1&quot;, &quot;arglist&quot;, &quot;elements&quot;,
-  &quot;element&quot;, &quot;@2&quot;, &quot;ignorepat&quot;, &quot;extension&quot;, &quot;statements&quot;, &quot;if_head&quot;, &quot;@3&quot;,
-  &quot;random_head&quot;, &quot;@4&quot;, &quot;iftime_head&quot;, &quot;word_list&quot;, &quot;word3_list&quot;,
-  &quot;goto_word&quot;, &quot;switch_head&quot;, &quot;@5&quot;, &quot;statement&quot;, &quot;@6&quot;, &quot;@7&quot;, &quot;@8&quot;, &quot;@9&quot;,
-  &quot;@10&quot;, &quot;@11&quot;, &quot;opt_else&quot;, &quot;target&quot;, &quot;jumptarget&quot;, &quot;macro_call&quot;, &quot;@12&quot;,
-  &quot;application_call_head&quot;, &quot;@13&quot;, &quot;application_call&quot;, &quot;opt_word&quot;,
-  &quot;eval_arglist&quot;, &quot;case_statements&quot;, &quot;case_statement&quot;, &quot;macro_statements&quot;,
-  &quot;macro_statement&quot;, &quot;switches&quot;, &quot;eswitches&quot;, &quot;switchlist&quot;, &quot;includeslist&quot;,
+  &quot;objects&quot;, &quot;object&quot;, &quot;word_or_default&quot;, &quot;context&quot;, &quot;opt_abstract&quot;,
+  &quot;macro&quot;, &quot;globals&quot;, &quot;global_statements&quot;, &quot;global_statement&quot;, &quot;@1&quot;,
+  &quot;arglist&quot;, &quot;elements_block&quot;, &quot;elements&quot;, &quot;element&quot;, &quot;@2&quot;, &quot;ignorepat&quot;,
+  &quot;extension&quot;, &quot;statements&quot;, &quot;if_head&quot;, &quot;@3&quot;, &quot;random_head&quot;, &quot;@4&quot;,
+  &quot;iftime_head&quot;, &quot;word_list&quot;, &quot;word3_list&quot;, &quot;goto_word&quot;, &quot;switch_head&quot;,
+  &quot;@5&quot;, &quot;statement&quot;, &quot;@6&quot;, &quot;@7&quot;, &quot;@8&quot;, &quot;@9&quot;, &quot;@10&quot;, &quot;@11&quot;, &quot;opt_else&quot;,
+  &quot;target&quot;, &quot;jumptarget&quot;, &quot;macro_call&quot;, &quot;@12&quot;, &quot;application_call_head&quot;,
+  &quot;@13&quot;, &quot;application_call&quot;, &quot;opt_word&quot;, &quot;eval_arglist&quot;, &quot;case_statements&quot;,
+  &quot;case_statement&quot;, &quot;macro_statements&quot;, &quot;macro_statement&quot;, &quot;switches&quot;,
+  &quot;eswitches&quot;, &quot;switchlist_block&quot;, &quot;switchlist&quot;, &quot;includeslist&quot;,
   &quot;includedname&quot;, &quot;includes&quot;, 0
 };
 #endif
@@ -617,40 +625,42 @@
 static const unsigned char yyr1[] =
 {
        0,    42,    43,    44,    44,    44,    45,    45,    45,    45,
-      46,    46,    47,    47,    47,    47,    48,    48,    48,    48,
-      49,    49,    50,    50,    50,    52,    51,    53,    53,    53,
-      54,    54,    54,    54,    55,    55,    55,    55,    55,    56,
-      55,    55,    55,    57,    58,    58,    58,    58,    59,    59,
-      59,    61,    60,    63,    62,    64,    64,    65,    65,    66,
-      66,    66,    67,    67,    67,    69,    68,    70,    71,    70,
-      70,    70,    70,    72,    73,    74,    70,    75,    70,    70,
-      70,    70,    70,    70,    76,    70,    70,    70,    70,    70,
-      70,    70,    70,    77,    77,    78,    78,    78,    78,    78,
-      78,    78,    79,    79,    79,    79,    79,    79,    81,    80,
-      80,    83,    82,    84,    84,    85,    85,    86,    86,    86,
-      87,    87,    88,    88,    88,    88,    88,    88,    89,    89,
-      90,    90,    91,    91,    92,    92,    93,    93,    93,    94,
-      94,    94,    94,    94,    94,    94,    95,    95,    96,    96
+      46,    46,    47,    48,    48,    49,    49,    49,    49,    50,
+      50,    51,    51,    51,    53,    52,    54,    54,    54,    55,
+      55,    56,    56,    56,    56,    57,    57,    57,    57,    57,
+      58,    57,    57,    57,    59,    60,    60,    60,    60,    61,
+      61,    61,    63,    62,    65,    64,    66,    66,    67,    67,
+      68,    68,    68,    69,    69,    69,    71,    70,    72,    73,
+      72,    72,    72,    72,    74,    75,    76,    72,    77,    72,
+      72,    72,    72,    72,    72,    78,    72,    72,    72,    72,
+      72,    72,    72,    72,    79,    79,    80,    80,    80,    80,
+      80,    80,    80,    81,    81,    81,    81,    81,    81,    83,
+      82,    82,    85,    84,    86,    86,    87,    87,    88,    88,
+      88,    89,    89,    90,    90,    90,    90,    90,    90,    91,
+      91,    92,    92,    93,    94,    95,    95,    96,    96,    96,
+      97,    97,    97,    97,    97,    97,    97,    98,    98,    99,
+      99
 };
 
 /* YYR2[YYN] -- Number of symbols composing right hand side of rule YYN.  */
 static const unsigned char yyr2[] =
 {
        0,     2,     1,     1,     2,     2,     1,     1,     1,     1,
-       1,     1,     5,     4,     6,     5,     8,     7,     7,     6,
-       4,     3,     1,     2,     2,     0,     5,     1,     3,     2,
-       1,     1,     2,     2,     1,     1,     1,     1,     1,     0,
-       5,     2,     1,     4,     3,     4,     7,     8,     1,     2,
-       2,     0,     5,     0,     5,    14,    10,     1,     2,     1,
-       2,     3,     1,     2,     3,     0,     6,     3,     0,     5,
-       3,     3,     2,     0,     0,     0,    12,     0,     6,     2,
-       3,     3,     2,     2,     0,     5,     2,     2,     2,     3,
-       3,     3,     1,     2,     0,     1,     3,     3,     5,     5,
-       5,     5,     1,     3,     5,     3,     5,     3,     0,     5,
-       3,     0,     3,     3,     2,     1,     0,     1,     0,     3,
-       1,     2,     4,     3,     4,     3,     2,     3,     1,     2,
-       1,     5,     4,     3,     4,     3,     2,     3,     2,     2,
-      14,    10,     3,    15,    11,     2,     1,     1,     4,     3
+       1,     1,     4,     1,     0,     8,     7,     7,     6,     4,
+       3,     1,     2,     2,     0,     5,     1,     3,     2,     2,
+       3,     1,     1,     2,     2,     1,     1,     1,     1,     1,
+       0,     5,     2,     1,     4,     3,     4,     7,     8,     1,
+       2,     2,     0,     5,     0,     5,    14,    10,     1,     2,
+       1,     2,     3,     1,     2,     3,     0,     6,     3,     0,
+       5,     3,     3,     2,     0,     0,     0,    12,     0,     6,
+       2,     3,     3,     2,     2,     0,     5,     2,     2,     2,
+       3,     3,     3,     1,     2,     0,     1,     3,     3,     5,
+       5,     5,     5,     1,     3,     5,     3,     5,     3,     0,
+       5,     3,     0,     3,     3,     2,     1,     0,     1,     0,
+       3,     1,     2,     4,     3,     4,     3,     2,     3,     1,
+       2,     1,     5,     2,     2,     3,     2,     2,     3,     2,
+       2,    14,    10,     3,    15,    11,     2,     1,     1,     4,
+       3
 };
 
 /* YYDEFACT[STATE-NAME] -- Default rule to reduce with in state
@@ -658,261 +668,258 @@
    means the default is an error.  */
 static const unsigned char yydefact[] =
 {
-       0,     0,     9,     0,     0,     0,     0,     0,     3,     6,
-       7,     8,    11,    10,     0,     0,     0,     0,     1,     5,
-       4,     0,     0,    21,     0,     0,    22,     0,    31,    13,
-      42,     0,     0,     0,     0,     0,     0,     0,     0,    30,
-      38,    34,    36,    37,    35,     0,    27,     0,    25,    24,
-      20,    23,     0,     0,     0,     0,     0,     0,     0,     0,
-      41,    39,     0,    33,    12,    32,     0,    29,     0,     0,
-       0,    15,     0,     0,     0,     0,    59,     0,   133,     0,
-       0,   135,     0,   149,   147,   146,     0,     0,     0,     0,
-      92,     0,     0,     0,     0,     0,     0,     0,     0,     0,
-       0,     0,     0,   111,     0,     0,     0,     0,    44,   118,
-       0,    19,     0,   130,     0,   128,     0,    28,     0,    14,
-      43,     0,    45,    60,     0,   136,   138,   132,     0,   134,
-     145,   148,     0,   139,     0,     0,     0,    48,     0,     0,
-      65,    51,     0,    53,     0,    62,    95,     0,   102,     0,
-      87,    86,    88,    73,    77,    83,    68,    72,     0,    94,
-      94,    94,    79,     0,     0,     0,     0,   120,   114,    57,
-     117,     0,    82,    84,     0,    18,   129,    17,     0,    26,
-       0,    61,     0,   137,   142,     0,    59,     0,    40,    50,
-      67,    49,   108,    81,     0,     0,    59,     0,     0,     0,
-       0,     0,    63,     0,     0,    70,     0,     0,    71,     0,
-       0,     0,   112,     0,    90,    89,    91,     0,     0,   126,
-      80,   121,    58,   113,   116,     0,     0,    16,     0,     0,
-      59,     0,     0,     0,   110,   118,     0,     0,     0,     0,
-       0,     0,     0,    64,    97,    96,    62,   103,   107,   105,
-       0,     0,     0,    93,   125,   127,     0,   115,   119,     0,
-       0,     0,    46,     0,     0,     0,     0,     0,     0,    52,
-       0,     0,    54,     0,     0,     0,     0,     0,    74,     0,
-      69,     0,     0,    85,   131,    47,     0,     0,     0,     0,
-     109,    66,     0,     0,   101,   100,    99,    98,   106,   104,
-       0,    78,     0,     0,     0,     0,     0,     0,     0,     0,
-       0,     0,     0,     0,     0,    75,     0,     0,     0,     0,
-       0,     0,     0,     0,     0,   141,     0,    56,     0,     0,
-     144,     0,     0,     0,     0,     0,     0,     0,    76,     0,
-       0,     0,     0,   140,    55,   143
+      14,     9,     0,     0,    13,     0,     0,     3,     6,     0,
+       7,     8,     0,     0,     1,     5,     4,     0,     0,    20,
+       0,     0,    21,    11,    10,     0,     0,    26,     0,    24,
+      23,    19,    22,     0,    12,     0,    28,     0,     0,     0,
+      32,    29,    43,     0,     0,     0,     0,     0,     0,     0,
+       0,    31,    39,    35,    37,    38,    36,     0,    18,    93,
+       0,     0,     0,     0,     0,     0,     0,     0,     0,     0,
+       0,     0,     0,   112,     0,     0,     0,     0,   131,   119,
+       0,     0,   129,     0,    27,     0,     0,     0,     0,     0,
+       0,   133,   134,     0,    42,    40,     0,    34,    30,    33,
+       0,    49,     0,     0,    66,    52,     0,    54,     0,    63,
+      96,     0,   103,     0,    88,    87,    89,    74,    78,     0,
+      84,    69,    73,     0,    95,    95,    95,    80,     0,     0,
+       0,     0,   121,   115,    58,   118,     0,    83,    85,    17,
+     130,    16,     0,    25,     0,     0,     0,    60,     0,   136,
+       0,     0,   150,   148,   147,     0,     0,     0,    45,    51,
+      68,    50,   109,    82,     0,     0,    60,     0,     0,     0,
+       0,     0,    64,     0,     0,    71,     0,     0,    72,     0,
+       0,     0,     0,   113,     0,    91,    90,    92,     0,     0,
+     127,    81,   122,    59,   114,   117,     0,    15,    44,     0,
+      46,    61,     0,   137,   139,   135,     0,   146,   149,     0,
+     140,     0,     0,   111,   119,     0,     0,     0,     0,     0,
+       0,     0,    65,    98,    97,    63,   104,   108,   106,     0,
+       0,     0,     0,    94,   126,   128,     0,   116,   120,     0,
+       0,    62,     0,   138,   143,     0,    60,     0,    41,     0,
+       0,    53,     0,     0,    55,     0,     0,     0,     0,     0,
+      75,     0,   132,    70,     0,     0,    86,     0,     0,    60,
+       0,     0,     0,   110,    67,     0,     0,   102,   101,   100,
+      99,   107,   105,     0,    79,     0,    47,     0,     0,     0,
+       0,     0,     0,     0,    48,     0,     0,     0,     0,     0,
+       0,    76,     0,     0,     0,     0,     0,     0,     0,     0,
+       0,     0,     0,    57,     0,     0,     0,     0,     0,     0,
+       0,     0,     0,     0,   142,     0,     0,    77,   145,     0,
+       0,     0,     0,     0,    56,     0,     0,     0,   141,   144
 };
 
 /* YYDEFGOTO[NTERM-NUM]. */
 static const short int yydefgoto[] =
 {
-      -1,     6,     7,     8,    14,     9,    10,    11,    25,    26,
-      70,    47,    38,    39,    88,    40,    41,   136,   104,   195,
-     105,   198,   106,   170,    77,   146,   107,   194,   137,   211,
-     209,   300,   322,   210,   225,   214,   147,   149,   139,   235,
-     109,   158,   110,   258,   171,   166,   167,   114,   115,    42,
-      43,    80,    86,    87,    44
+      -1,     5,     6,     7,    25,     8,     9,    10,    11,    21,
+      22,    39,    28,    34,    50,    51,   157,    52,    53,   100,
+      74,   165,    75,   168,    76,   135,   148,   110,    77,   164,
+     101,   182,   179,   283,   308,   180,   196,   185,   111,   113,
+     103,   214,    79,   123,    80,   238,   136,   131,   132,    81,
+      82,    54,    55,    91,   151,   155,   156,    56
 };
 
 /* YYPACT[STATE-NUM] -- Index in YYTABLE of the portion describing
    STATE-NUM.  */
-#define YYPACT_NINF -193
+#define YYPACT_NINF -180
 static const short int yypact[] =
 {
-     121,   117,  -193,   -38,    84,    17,    95,   343,  -193,  -193,
-    -193,  -193,  -193,  -193,    98,   122,     9,   117,  -193,  -193,
-    -193,   151,    53,  -193,   110,    14,  -193,   167,  -193,  -193,
-    -193,   102,    39,   182,   200,   214,   218,   184,   204,  -193,
-    -193,  -193,  -193,  -193,  -193,   219,  -193,   196,  -193,  -193,
-    -193,  -193,   280,   183,   221,   207,   187,    23,    44,    20,
-    -193,  -193,   461,  -193,  -193,  -193,   357,  -193,   228,   192,
-     195,  -193,   333,   229,   187,   461,   197,   234,  -193,   238,
-      16,  -193,    46,  -193,  -193,  -193,     5,   147,   206,   461,
-    -193,   211,   249,   250,   251,   252,   125,   220,   254,   256,
-     258,   253,   261,   104,   461,   461,   461,   129,  -193,    60,
-      50,  -193,   230,  -193,   383,  -193,   409,  -193,   262,  -193,
-    -193,   270,  -193,   239,   242,  -193,  -193,  -193,   276,  -193,
-    -193,  -193,   149,  -193,   246,   281,   274,  -193,   263,   282,
-    -193,  -193,   257,  -193,   173,     7,   201,   283,    63,   287,
-    -193,  -193,  -193,  -193,  -193,  -193,  -193,  -193,   298,   292,
-     292,   292,  -193,   273,   284,   306,   138,  -193,  -193,   286,
-    -193,   120,  -193,  -193,   324,  -193,  -193,  -193,   435,  -193,
-     294,  -193,   236,  -193,  -193,   299,    -6,   328,  -193,  -193,
-    -193,  -193,   335,  -193,   307,   308,    40,   336,   308,   220,
-     220,   311,  -193,   220,   220,  -193,   312,   166,  -193,   313,
-     314,   315,  -193,   461,  -193,  -193,  -193,   346,   349,   461,
-    -193,  -193,  -193,  -193,   326,   327,   461,  -193,   354,   461,
-      65,   359,   187,   187,  -193,   308,   373,   374,   187,   187,
-     385,   386,   380,  -193,   387,   391,   109,  -193,  -193,  -193,
-     392,   399,   410,  -193,   461,   461,     4,  -193,  -193,   411,
-     304,   461,  -193,   187,   187,   394,   388,   177,   418,  -193,
-     412,   415,  -193,   220,   220,   220,   220,   174,  -193,   461,
-    -193,    64,   113,  -193,  -193,  -193,   417,   421,   187,   187,
-    -193,  -193,   187,   187,  -193,  -193,  -193,  -193,  -193,  -193,
-     382,  -193,   187,   187,   420,   431,   432,   436,   440,   438,
-     439,   187,   187,   187,   187,  -193,   187,   187,   448,   445,
-     452,   453,   429,   463,   462,  -193,   187,  -193,   187,   467,
-    -193,   187,   464,   465,   461,   469,   187,   187,  -193,   187,
-     476,   478,   483,  -193,  -193,  -193
+     132,  -180,   -31,    19,  -180,    16,   105,  -180,  -180,    30,
+    -180,  -180,    29,     8,  -180,  -180,  -180,   -10,    11,  -180,
+      67,     3,  -180,  -180,  -180,    66,    68,  -180,    20,  -180,
+    -180,  -180,  -180,   283,  -180,   360,  -180,    78,    71,    75,
+    -180,  -180,  -180,    94,   -16,   131,   141,   141,   146,    95,
+     336,  -180,  -180,  -180,  -180,  -180,  -180,   464,  -180,  -180,
+     116,   152,   158,   159,   173,    -7,   143,   177,   178,   179,
+     182,   183,   149,   163,   464,   464,   464,    23,  -180,    12,
+      81,   386,  -180,   412,  -180,   184,   150,   189,   174,   156,
+       9,  -180,  -180,     1,  -180,  -180,   464,  -180,  -180,  -180,
+     277,  -180,   193,   192,  -180,  -180,   161,  -180,    56,    13,
+      70,   199,    22,   202,  -180,  -180,  -180,  -180,  -180,   211,
+    -180,  -180,  -180,   210,   198,   198,   198,  -180,   180,   186,
+     213,    63,  -180,  -180,   187,  -180,   124,  -180,  -180,  -180,
+    -180,  -180,   438,  -180,   217,   156,   464,   195,   227,  -180,
+     229,     4,  -180,  -180,  -180,     2,   101,   197,  -180,  -180,
+    -180,  -180,   235,  -180,   204,   205,    60,   237,   205,   143,
+     143,   208,  -180,   143,   143,  -180,   212,    74,  -180,   214,
+     215,   464,   219,  -180,   464,  -180,  -180,  -180,   241,   243,
+     464,  -180,  -180,  -180,  -180,   221,   222,  -180,  -180,   262,
+    -180,   236,   238,  -180,  -180,  -180,   268,  -180,  -180,   114,
+    -180,   242,   279,  -180,   205,   263,   285,   156,   156,   286,
+     280,   281,  -180,   288,   294,     6,  -180,  -180,  -180,   293,
+     309,   307,   312,  -180,   464,   464,    59,  -180,  -180,   320,
+     276,  -180,   306,  -180,  -180,   290,    61,   327,  -180,   166,
+     338,  -180,   330,   334,  -180,   143,   143,   143,   143,   100,
+    -180,   464,  -180,  -180,   134,   239,  -180,   322,   464,    62,
+     339,   156,   156,  -180,  -180,   156,   156,  -180,  -180,  -180,
+    -180,  -180,  -180,   308,  -180,   464,  -180,   156,   156,   341,
+     340,   342,   343,   344,  -180,   345,   346,   156,   156,   156,
+     156,  -180,   156,   156,   347,   348,   352,   349,   328,   350,
+     357,   156,   156,  -180,   156,   364,   156,   156,   365,   368,
+     370,   464,   376,   382,  -180,   156,   156,  -180,  -180,   156,
+     383,   392,   387,   156,  -180,   156,   394,   395,  -180,  -180
 };
 
 /* YYPGOTO[NTERM-NUM].  */
 static const short int yypgoto[] =
 {
-    -193,  -193,  -193,   485,   479,  -193,  -193,  -193,  -193,   470,
-    -193,  -193,   446,    37,  -193,  -193,  -193,  -192,  -193,  -193,
-    -193,  -193,  -193,    18,   -63,   -96,  -193,  -193,   -62,  -193,
-    -193,  -193,  -193,  -193,  -193,    35,  -193,  -193,  -193,  -193,
-    -193,  -193,  -193,  -193,   264,  -193,   331,   384,  -112,  -193,
-    -193,   443,  -193,   419,  -193
+    -180,  -180,  -180,   401,  -180,  -180,  -180,  -180,  -180,  -180,
+     326,  -180,  -180,  -180,  -180,   359,  -180,  -180,  -180,  -179,
+    -180,  -180,  -180,  -180,  -180,    15,   -94,   -44,  -180,  -180,
+     -35,  -180,  -180,  -180,  -180,  -180,  -180,    18,  -180,  -180,
+    -180,  -180,  -180,  -180,  -180,  -180,   196,  -180,   291,   353,
+     -80,  -180,  -180,   374,  -180,  -180,   270,  -180
 };
 
 /* YYTABLE[YYPACT[STATE-NUM]].  What to do in state STATE-NUM.  If
    positive, shift that token.  If negative, reduce the rule which
    number is the opposite.  If zero, do what YYDEFACT says.
    If YYTABLE_NINF, syntax error.  */
-#define YYTABLE_NINF -125
+#define YYTABLE_NINF -126
 static const short int yytable[] =
 {
-     108,   148,   176,    15,   113,   189,   130,   232,    89,  -123,
-     131,   121,    90,   122,    23,    49,    91,   126,   201,    50,
-      17,   127,    92,    93,    94,    83,    95,   256,    78,    96,
-      97,    98,    99,   100,   260,   123,   101,   102,  -123,  -123,
-    -123,    84,   159,   160,   161,   103,    85,   126,   202,    81,
-      24,   129,   113,   238,   113,    24,    84,   128,   172,   173,
-      45,    85,   281,   282,    79,   189,   176,   168,    89,  -122,
-      54,   187,    90,   206,   191,    65,    91,   207,   263,   197,
-      55,   123,    92,    93,    94,    79,    95,   128,    16,    96,
-      97,    98,    99,   100,    46,    18,   101,   102,  -122,  -122,
-    -122,   169,    21,   241,   242,   103,   123,   244,   245,    65,
-     247,   249,   155,   156,   189,   157,   113,    89,  -124,    48,
-     201,    90,   231,   277,     1,    91,    53,   223,    22,     2,
-     224,    92,    93,    94,   162,    95,     3,     4,    96,    97,
-      98,    99,   100,   220,     5,   101,   102,  -124,  -124,  -124,
-     202,   253,    28,    12,   103,   133,    29,   184,    13,    30,
-     134,   144,   185,   163,   164,   165,   145,   262,    31,   265,
-     266,    52,   163,   164,   165,   270,   271,   294,   295,   296,
-     297,    32,    33,   199,   290,    60,   200,   224,    56,    34,
-      35,    36,    37,    61,   191,   215,   216,    67,   191,   285,
-     286,   287,   248,    68,    57,    63,    69,   145,    62,    64,
-     298,   203,    30,   237,   204,   299,   240,   301,    58,   191,
-     191,    31,    59,    66,    73,   304,   305,    74,    76,   306,
-     307,    75,   116,   117,    32,    33,   118,   120,   123,   309,
-     310,   124,    34,    35,    36,    37,   125,   135,   318,   319,
-     320,   321,   138,   323,   324,   140,   141,   142,   143,   153,
-     229,   145,   150,   332,   151,   333,   152,   154,   335,   192,
-     179,   174,   338,   340,   341,   189,   342,   180,    89,   190,
-     181,    28,    90,   182,   183,    71,    91,   186,    30,   188,
-     193,   205,    92,    93,    94,   208,    95,    31,   196,    96,
-      97,    98,    99,   100,   212,   189,   101,   102,    89,   284,
-      32,    33,    90,   213,   217,   103,    91,   219,    34,    35,
-      36,    37,    92,    93,    94,   218,    95,   222,   226,    96,
-      97,    98,    99,   100,    63,   228,   101,   102,   119,   233,
-     230,    30,   234,    -2,    19,   103,     1,   239,   236,   169,
-      31,     2,   243,   246,   250,   251,   252,   254,     3,     4,
-     255,    89,   111,    32,    33,    90,     5,   257,   259,    91,
-     264,    34,    35,    36,    37,    92,    93,    94,   261,    95,
-     268,   269,    96,    97,    98,    99,   100,    89,   175,   101,
-     102,    90,   272,   274,   112,    91,   273,   275,   103,   289,
-     278,    92,    93,    94,   276,    95,   279,   288,    96,    97,
-      98,    99,   100,    89,   177,   101,   102,    90,   280,   283,
-     112,    91,   291,   308,   103,   292,   293,    92,    93,    94,
-     302,    95,   303,   311,    96,    97,    98,    99,   100,    89,
-     227,   101,   102,    90,   312,   313,   112,    91,   315,   314,
-     103,   316,   317,    92,    93,    94,   325,    95,   326,   327,
-      96,    97,    98,    99,   100,    89,   328,   101,   102,    90,
-     329,   330,   112,    91,   334,   331,   103,   336,   337,    92,
-      93,    94,   339,    95,   343,   344,    96,    97,    98,    99,
-     100,   345,    20,   101,   102,    51,    27,   221,    72,   267,
-     178,    82,   103,     0,     0,   132
+      78,   140,   231,   207,    30,   204,   152,   208,    31,   205,
+      12,   236,   167,    19,   149,    87,    14,   171,    26,   133,
+     259,    36,   112,    13,   171,    88,    23,    37,   127,   108,
+      38,    24,   176,    17,   109,    18,   177,   153,   153,   124,
+     125,   126,   154,   154,    20,   206,    78,   172,    78,    20,
+     150,   199,    27,   134,   172,   264,   265,   128,   129,   130,
+     159,   158,   140,    57,  -124,   161,   169,    59,   191,   170,
+      33,    60,    35,   217,   271,   287,    29,    61,    62,    63,
+     173,    64,    83,   174,    65,    66,    67,    68,    69,   137,
+     138,    70,    71,  -124,  -124,  -124,    94,   128,   129,   130,
+      73,   201,   201,   201,    95,    -2,    15,    78,   -14,   210,
+     227,   200,    84,     1,   211,   109,    85,   247,    86,    96,
+       2,     3,   244,   252,   253,   220,   221,   245,     4,   223,
+     224,   194,   226,   228,   195,   159,   281,    89,    57,  -123,
+       1,   282,    59,   186,   187,    90,    60,     2,     3,   233,
+      93,   270,    61,    62,    63,     4,    64,   102,   104,    65,
+      66,    67,    68,    69,   105,   106,    70,    71,  -123,  -123,
+    -123,   120,   121,   273,   122,    73,   195,   289,   290,   107,
+     216,   291,   292,   219,   109,   114,   115,   116,   117,   118,
+     119,   144,   143,   295,   296,   145,   161,   147,   146,   162,
+     163,   161,   166,   304,   305,   306,   307,   175,   309,   310,
+     178,   277,   278,   279,   280,   181,   183,   318,   319,   184,
+     320,   188,   322,   323,   190,   198,   284,   189,   193,   161,
+     161,   330,   331,   286,   202,   332,   201,   203,   212,   336,
+     159,   337,   213,    57,  -125,   215,   134,    59,   218,   222,
+     294,    60,   234,   225,   235,   229,   230,    61,    62,    63,
+     232,    64,   237,   239,    65,    66,    67,    68,    69,   240,
+     250,    70,    71,  -125,  -125,  -125,   243,   241,   159,   242,
+      73,    57,   160,   246,    40,    59,   327,   248,    41,    60,
+     255,    42,   251,   254,   256,    61,    62,    63,   257,    64,
+      43,   260,    65,    66,    67,    68,    69,   258,   159,    70,
+      71,    57,   262,    44,    45,    59,   261,   267,    73,    60,
+     263,    46,    47,    48,    49,    61,    62,    63,   266,    64,
+     268,   269,    65,    66,    67,    68,    69,    97,   272,    70,
+      71,    98,   274,   275,    42,   276,   285,    32,    73,   293,
+     288,   298,   301,    43,   297,   299,   300,   303,   302,   313,
+     311,   312,   314,   316,    57,    58,    44,    45,    59,   315,
+     317,   321,    60,   324,    46,    47,    48,    49,    61,    62,
+      63,   325,    64,   326,   328,    65,    66,    67,    68,    69,
+      57,   139,    70,    71,    59,   329,   333,    72,    60,   334,
+     335,    73,   338,   339,    61,    62,    63,    16,    64,    99,
+     249,    65,    66,    67,    68,    69,    57,   141,    70,    71,
+      59,    92,   192,    72,    60,   209,     0,    73,     0,     0,
+      61,    62,    63,     0,    64,     0,   142,    65,    66,    67,
+      68,    69,    57,   197,    70,    71,    59,     0,     0,    72,
+      60,     0,     0,    73,     0,     0,    61,    62,    63,     0,
+      64,     0,     0,    65,    66,    67,    68,    69,    57,     0,
+      70,    71,    59,     0,     0,    72,    60,     0,     0,    73,
+       0,     0,    61,    62,    63,     0,    64,     0,     0,    65,
+      66,    67,    68,    69,     0,     0,    70,    71,     0,     0,
+       0,     0,     0,     0,     0,    73
 };
 
 static const short int yycheck[] =
 {
-      62,    97,   114,    41,    66,     1,     1,    13,     4,     5,
-       5,    74,     8,    75,     5,     1,    12,     1,    11,     5,
-       3,     5,    18,    19,    20,     5,    22,   219,     5,    25,
-      26,    27,    28,    29,   226,    41,    32,    33,    34,    35,
-      36,    36,   104,   105,   106,    41,    41,     1,    41,     5,
-      41,     5,   114,    13,   116,    41,    36,    41,     8,     9,
-       7,    41,   254,   255,    41,     1,   178,     7,     4,     5,
-      31,   134,     8,    10,   136,    38,    12,    14,    13,   142,
-      41,    41,    18,    19,    20,    41,    22,    41,     4,    25,
-      26,    27,    28,    29,    41,     0,    32,    33,    34,    35,
-      36,    41,     4,   199,   200,    41,    41,   203,   204,    72,
-     206,   207,     8,     9,     1,    11,   178,     4,     5,     9,
-      11,     8,   185,    14,     3,    12,    24,     7,     6,     8,
-      10,    18,    19,    20,     5,    22,    15,    16,    25,    26,
-      27,    28,    29,     5,    23,    32,    33,    34,    35,    36,
-      41,   213,     1,    36,    41,     8,     5,     8,    41,     8,
-      13,    36,    13,    34,    35,    36,    41,   229,    17,   232,
-     233,     4,    34,    35,    36,   238,   239,   273,   274,   275,
-     276,    30,    31,    10,     7,     1,    13,    10,     6,    38,
-      39,    40,    41,     9,   256,   160,   161,     1,   260,   261,
-     263,   264,    36,     7,     4,     1,    10,    41,    24,     5,
-      36,    10,     8,   195,    13,    41,   198,   279,     4,   281,
-     282,    17,     4,     4,    41,   288,   289,     6,    41,   292,
-     293,    24,     4,    41,    30,    31,    41,     8,    41,   302,
-     303,     7,    38,    39,    40,    41,     8,    41,   311,   312,
-     313,   314,    41,   316,   317,     6,     6,     6,     6,     6,
-      24,    41,     8,   326,     8,   328,     8,     6,   331,     6,
-       8,    41,   334,   336,   337,     1,   339,     7,     4,     5,
-      41,     1,     8,    41,     8,     5,    12,    41,     8,     8,
-       8,     8,    18,    19,    20,     8,    22,    17,    41,    25,
-      26,    27,    28,    29,     6,     1,    32,    33,     4,     5,
-      30,    31,     8,    21,    41,    41,    12,    11,    38,    39,
-      40,    41,    18,    19,    20,    41,    22,    41,     4,    25,
-      26,    27,    28,    29,     1,    41,    32,    33,     5,    11,
-      41,     8,     7,     0,     1,    41,     3,    11,    41,    41,
-      17,     8,    41,    41,    41,    41,    41,    11,    15,    16,
-      11,     4,     5,    30,    31,     8,    23,    41,    41,    12,
-      11,    38,    39,    40,    41,    18,    19,    20,    24,    22,
-       7,     7,    25,    26,    27,    28,    29,     4,     5,    32,
-      33,     8,     7,    13,    37,    12,    10,    10,    41,    11,
-       8,    18,    19,    20,    13,    22,     7,    13,    25,    26,
-      27,    28,    29,     4,     5,    32,    33,     8,     8,     8,
-      37,    12,     4,    41,    41,    13,    11,    18,    19,    20,
-      13,    22,    11,    13,    25,    26,    27,    28,    29,     4,
-       5,    32,    33,     8,    13,    13,    37,    12,     8,    13,
-      41,    13,    13,    18,    19,    20,     8,    22,    13,     7,
-      25,    26,    27,    28,    29,     4,    13,    32,    33,     8,
-      41,     8,    37,    12,     7,    13,    41,    13,    13,    18,
-      19,    20,    13,    22,     8,     7,    25,    26,    27,    28,
-      29,     8,     7,    32,    33,    25,    17,   166,    52,   235,
-     116,    58,    41,    -1,    -1,    86
+      35,    81,   181,     1,     1,     1,     5,     5,     5,     5,
+      41,   190,   106,     5,     5,    31,     0,    11,     7,     7,
+      14,     1,    66,     4,    11,    41,    36,     7,     5,    36,
+      10,    41,    10,     3,    41,     6,    14,    36,    36,    74,
+      75,    76,    41,    41,    41,    41,    81,    41,    83,    41,
+      41,   145,    41,    41,    41,   234,   235,    34,    35,    36,
+       1,    96,   142,     4,     5,   100,    10,     8,     5,    13,
+       4,    12,     4,    13,    13,    13,     9,    18,    19,    20,
+      10,    22,     4,    13,    25,    26,    27,    28,    29,     8,
+       9,    32,    33,    34,    35,    36,     1,    34,    35,    36,
+      41,    41,    41,    41,     9,     0,     1,   142,     3,     8,
+      36,   146,    41,     8,    13,    41,    41,   211,    24,    24,
+      15,    16,     8,   217,   218,   169,   170,    13,    23,   173,
+     174,     7,   176,   177,    10,     1,    36,     6,     4,     5,
+       8,    41,     8,   125,   126,     4,    12,    15,    16,   184,
+       4,   245,    18,    19,    20,    23,    22,    41,     6,    25,
+      26,    27,    28,    29,     6,     6,    32,    33,    34,    35,
+      36,     8,     9,     7,    11,    41,    10,   271,   272,     6,
+     165,   275,   276,   168,    41,     8,     8,     8,     6,     6,
+      41,    41,     8,   287,   288,     6,   231,    41,    24,     6,
+       8,   236,    41,   297,   298,   299,   300,     8,   302,   303,
+       8,   255,   256,   257,   258,     4,     6,   311,   312,    21,
+     314,    41,   316,   317,    11,     8,   261,    41,    41,   264,
+     265,   325,   326,   268,     7,   329,    41,     8,    41,   333,
+       1,   335,     7,     4,     5,    41,    41,     8,    11,    41,
+     285,    12,    11,    41,    11,    41,    41,    18,    19,    20,
+      41,    22,    41,    41,    25,    26,    27,    28,    29,     7,
+       7,    32,    33,    34,    35,    36,     8,    41,     1,    41,
+      41,     4,     5,    41,     1,     8,   321,     8,     5,    12,
+      10,     8,     7,     7,    13,    18,    19,    20,    10,    22,
+      17,     8,    25,    26,    27,    28,    29,    13,     1,    32,
+      33,     4,     5,    30,    31,     8,     7,    41,    41,    12,
+       8,    38,    39,    40,    41,    18,    19,    20,     8,    22,
+      24,    41,    25,    26,    27,    28,    29,     1,    11,    32,
+      33,     5,     4,    13,     8,    11,    24,    21,    41,    41,
+      11,    11,     8,    17,    13,    13,    13,    11,    13,     7,
+      13,    13,    13,    13,     4,     5,    30,    31,     8,    41,
+      13,     7,    12,     8,    38,    39,    40,    41,    18,    19,
+      20,    13,    22,    13,     8,    25,    26,    27,    28,    29,
+       4,     5,    32,    33,     8,    13,    13,    37,    12,     7,
+      13,    41,     8,     8,    18,    19,    20,     6,    22,    50,
+     214,    25,    26,    27,    28,    29,     4,     5,    32,    33,
+       8,    47,   131,    37,    12,   155,    -1,    41,    -1,    -1,
+      18,    19,    20,    -1,    22,    -1,    83,    25,    26,    27,
+      28,    29,     4,     5,    32,    33,     8,    -1,    -1,    37,
+      12,    -1,    -1,    41,    -1,    -1,    18,    19,    20,    -1,
+      22,    -1,    -1,    25,    26,    27,    28,    29,     4,    -1,
+      32,    33,     8,    -1,    -1,    37,    12,    -1,    -1,    41,
+      -1,    -1,    18,    19,    20,    -1,    22,    -1,    -1,    25,
+      26,    27,    28,    29,    -1,    -1,    32,    33,    -1,    -1,
+      -1,    -1,    -1,    -1,    -1,    41
 };
 
 /* YYSTOS[STATE-NUM] -- The (internal number of the) accessing
    symbol of state STATE-NUM.  */
 static const unsigned char yystos[] =
 {
-       0,     3,     8,    15,    16,    23,    43,    44,    45,    47,
-      48,    49,    36,    41,    46,    41,     4,     3,     0,     1,
-      45,     4,     6,     5,    41,    50,    51,    46,     1,     5,
-       8,    17,    30,    31,    38,    39,    40,    41,    54,    55,
-      57,    58,    91,    92,    96,     7,    41,    53,     9,     1,
-       5,    51,     4,    24,    31,    41,     6,     4,     4,     4,
-       1,     9,    24,     1,     5,    55,     4,     1,     7,    10,
-      52,     5,    54,    41,     6,    24,    41,    66,     5,    41,
-      93,     5,    93,     5,    36,    41,    94,    95,    56,     4,
-       8,    12,    18,    19,    20,    22,    25,    26,    27,    28,
-      29,    32,    33,    41,    60,    62,    64,    68,    70,    82,
-      84,     5,    37,    70,    89,    90,     4,    41,    41,     5,
-       8,    66,    70,    41,     7,     8,     1,     5,    41,     5,
-       1,     5,    95,     8,    13,    41,    59,    70,    41,    80,
-       6,     6,     6,     6,    36,    41,    67,    78,    67,    79,
-       8,     8,     8,     6,     6,     8,     9,    11,    83,    70,
-      70,    70,     5,    34,    35,    36,    87,    88,     7,    41,
-      65,    86,     8,     9,    41,     5,    90,     5,    89,     8,
-       7,    41,    41,     8,     8,    13,    41,    66,     8,     1,
-       5,    70,     6,     8,    69,    61,    41,    66,    63,    10,
-      13,    11,    41,    10,    13,     8,    10,    14,     8,    72,
-      75,    71,     6,    21,    77,    77,    77,    41,    41,    11,
-       5,    88,    41,     7,    10,    76,     4,     5,    41,    24,
-      41,    66,    13,    11,     7,    81,    41,    65,    13,    11,
-      65,    67,    67,    41,    67,    67,    41,    67,    36,    67,
-      41,    41,    41,    70,    11,    11,    59,    41,    85,    41,
-      59,    24,    70,    13,    11,    66,    66,    86,     7,     7,
-      66,    66,     7,    10,    13,    10,    13,    14,     8,     7,
-       8,    59,    59,     8,     5,    70,    66,    66,    13,    11,
-       7,     4,    13,    11,    67,    67,    67,    67,    36,    41,
-      73,    70,    13,    11,    66,    66,    66,    66,    41,    66,
-      66,    13,    13,    13,    13,     8,    13,    13,    66,    66,
-      66,    66,    74,    66,    66,     8,    13,     7,    13,    41,
-       8,    13,    66,    66,     7,    66,    13,    13,    70,    13,
-      66,    66,    66,     8,     7,     8
+       0,     8,    15,    16,    23,    43,    44,    45,    47,    48,
+      49,    50,    41,     4,     0,     1,    45,     3,     6,     5,
+      41,    51,    52,    36,    41,    46,     7,    41,    54,     9,
+       1,     5,    52,     4,    55,     4,     1,     7,    10,    53,
+       1,     5,     8,    17,    30,    31,    38,    39,    40,    41,
+      56,    57,    59,    60,    93,    94,    99,     4,     5,     8,
+      12,    18,    19,    20,    22,    25,    26,    27,    28,    29,
+      32,    33,    37,    41,    62,    64,    66,    70,    72,    84,
+      86,    91,    92,     4,    41,    41,    24,    31,    41,     6,
+       4,    95,    95,     4,     1,     9,    24,     1,     5,    57,
+      61,    72,    41,    82,     6,     6,     6,     6,    36,    41,
+      69,    80,    69,    81,     8,     8,     8,     6,     6,    41,
+       8,     9,    11,    85,    72,    72,    72,     5,    34,    35,
+      36,    89,    90,     7,    41,    67,    88,     8,     9,     5,
+      92,     5,    91,     8,    41,     6,    24,    41,    68,     5,
+      41,    96,     5,    36,    41,    97,    98,    58,    72,     1,
+       5,    72,     6,     8,    71,    63,    41,    68,    65,    10,
+      13,    11,    41,    10,    13,     8,    10,    14,     8,    74,
+      77,     4,    73,     6,    21,    79,    79,    79,    41,    41,
+      11,     5,    90,    41,     7,    10,    78,     5,     8,    68,
+      72,    41,     7,     8,     1,     5,    41,     1,     5,    98,
+       8,    13,    41,     7,    83,    41,    67,    13,    11,    67,
+      69,    69,    41,    69,    69,    41,    69,    36,    69,    41,
+      41,    61,    41,    72,    11,    11,    61,    41,    87,    41,
+       7,    41,    41,     8,     8,    13,    41,    68,     8,    88,
+       7,     7,    68,    68,     7,    10,    13,    10,    13,    14,
+       8,     7,     5,     8,    61,    61,     8,    41,    24,    41,
+      68,    13,    11,     7,     4,    13,    11,    69,    69,    69,
+      69,    36,    41,    75,    72,    24,    72,    13,    11,    68,
+      68,    68,    68,    41,    72,    68,    68,    13,    11,    13,
+      13,     8,    13,    11,    68,    68,    68,    68,    76,    68,
+      68,    13,    13,     7,    13,    41,    13,    13,    68,    68,
+      68,     7,    68,    68,     8,    13,    13,    72,     8,    13,
+      68,    68,    68,    13,     7,    13,    68,    68,     8,     8
 };
 
 #define yyerrok		(yyerrstatus = 0)
@@ -1288,311 +1295,327 @@
   switch (yytype)
     {
       case 41: /* &quot;word&quot; */
-#line 160 &quot;ael.y&quot;
+#line 172 &quot;ael.y&quot;
         { free((yyvaluep-&gt;str));};
-#line 1294 &quot;ael.tab.c&quot;
+#line 1301 &quot;ael.tab.c&quot;
         break;
       case 44: /* &quot;objects&quot; */
-#line 148 &quot;ael.y&quot;
+#line 159 &quot;ael.y&quot;
         {
 		destroy_pval((yyvaluep-&gt;pval));
 		prev_word=0;
 	};
-#line 1302 &quot;ael.tab.c&quot;
+#line 1309 &quot;ael.tab.c&quot;
         break;
       case 45: /* &quot;object&quot; */
-#line 148 &quot;ael.y&quot;
+#line 159 &quot;ael.y&quot;
         {
 		destroy_pval((yyvaluep-&gt;pval));
 		prev_word=0;
 	};
-#line 1310 &quot;ael.tab.c&quot;
+#line 1317 &quot;ael.tab.c&quot;
         break;
       case 46: /* &quot;word_or_default&quot; */
-#line 160 &quot;ael.y&quot;
+#line 172 &quot;ael.y&quot;
         { free((yyvaluep-&gt;str));};
-#line 1315 &quot;ael.tab.c&quot;
+#line 1322 &quot;ael.tab.c&quot;
         break;
       case 47: /* &quot;context&quot; */
-#line 148 &quot;ael.y&quot;
+#line 159 &quot;ael.y&quot;
         {
 		destroy_pval((yyvaluep-&gt;pval));
 		prev_word=0;
 	};
-#line 1323 &quot;ael.tab.c&quot;
+#line 1330 &quot;ael.tab.c&quot;
         break;
-      case 48: /* &quot;macro&quot; */
-#line 148 &quot;ael.y&quot;
+      case 49: /* &quot;macro&quot; */
+#line 159 &quot;ael.y&quot;
         {
 		destroy_pval((yyvaluep-&gt;pval));
 		prev_word=0;
 	};
-#line 1331 &quot;ael.tab.c&quot;
+#line 1338 &quot;ael.tab.c&quot;
         break;
-      case 49: /* &quot;globals&quot; */
-#line 148 &quot;ael.y&quot;
+      case 50: /* &quot;globals&quot; */
+#line 159 &quot;ael.y&quot;
         {
 		destroy_pval((yyvaluep-&gt;pval));
 		prev_word=0;
 	};
-#line 1339 &quot;ael.tab.c&quot;
+#line 1346 &quot;ael.tab.c&quot;
         break;
-      case 50: /* &quot;global_statements&quot; */
-#line 148 &quot;ael.y&quot;
+      case 51: /* &quot;global_statements&quot; */
+#line 159 &quot;ael.y&quot;
         {
 		destroy_pval((yyvaluep-&gt;pval));
 		prev_word=0;
 	};
-#line 1347 &quot;ael.tab.c&quot;
+#line 1354 &quot;ael.tab.c&quot;
         break;
-      case 51: /* &quot;global_statement&quot; */
-#line 148 &quot;ael.y&quot;
+      case 52: /* &quot;global_statement&quot; */
+#line 159 &quot;ael.y&quot;
         {
 		destroy_pval((yyvaluep-&gt;pval));
 		prev_word=0;
 	};
-#line 1355 &quot;ael.tab.c&quot;
+#line 1362 &quot;ael.tab.c&quot;
         break;
-      case 53: /* &quot;arglist&quot; */
-#line 148 &quot;ael.y&quot;
+      case 54: /* &quot;arglist&quot; */
+#line 159 &quot;ael.y&quot;
         {
 		destroy_pval((yyvaluep-&gt;pval));
 		prev_word=0;
 	};
-#line 1363 &quot;ael.tab.c&quot;
+#line 1370 &quot;ael.tab.c&quot;
         break;
-      case 54: /* &quot;elements&quot; */
-#line 148 &quot;ael.y&quot;
+      case 55: /* &quot;elements_block&quot; */
+#line 159 &quot;ael.y&quot;
         {
 		destroy_pval((yyvaluep-&gt;pval));
 		prev_word=0;
 	};
-#line 1371 &quot;ael.tab.c&quot;
+#line 1378 &quot;ael.tab.c&quot;
         break;
-      case 55: /* &quot;element&quot; */
-#line 148 &quot;ael.y&quot;
+      case 56: /* &quot;elements&quot; */
+#line 159 &quot;ael.y&quot;
         {
 		destroy_pval((yyvaluep-&gt;pval));
 		prev_word=0;
 	};
-#line 1379 &quot;ael.tab.c&quot;
+#line 1386 &quot;ael.tab.c&quot;
         break;
-      case 57: /* &quot;ignorepat&quot; */
-#line 148 &quot;ael.y&quot;
+      case 57: /* &quot;element&quot; */
+#line 159 &quot;ael.y&quot;
         {
 		destroy_pval((yyvaluep-&gt;pval));
 		prev_word=0;
 	};
-#line 1387 &quot;ael.tab.c&quot;
+#line 1394 &quot;ael.tab.c&quot;
         break;
-      case 58: /* &quot;extension&quot; */
-#line 148 &quot;ael.y&quot;
+      case 59: /* &quot;ignorepat&quot; */
+#line 159 &quot;ael.y&quot;
         {
 		destroy_pval((yyvaluep-&gt;pval));
 		prev_word=0;
 	};
-#line 1395 &quot;ael.tab.c&quot;
+#line 1402 &quot;ael.tab.c&quot;
         break;
-      case 59: /* &quot;statements&quot; */
-#line 148 &quot;ael.y&quot;
+      case 60: /* &quot;extension&quot; */
+#line 159 &quot;ael.y&quot;
         {
 		destroy_pval((yyvaluep-&gt;pval));
 		prev_word=0;
 	};
-#line 1403 &quot;ael.tab.c&quot;
+#line 1410 &quot;ael.tab.c&quot;
         break;
-      case 60: /* &quot;if_head&quot; */
-#line 148 &quot;ael.y&quot;
+      case 61: /* &quot;statements&quot; */
+#line 159 &quot;ael.y&quot;
         {
 		destroy_pval((yyvaluep-&gt;pval));
 		prev_word=0;
 	};
-#line 1411 &quot;ael.tab.c&quot;
+#line 1418 &quot;ael.tab.c&quot;
         break;
-      case 62: /* &quot;random_head&quot; */
-#line 148 &quot;ael.y&quot;
+      case 62: /* &quot;if_head&quot; */
+#line 159 &quot;ael.y&quot;
         {
 		destroy_pval((yyvaluep-&gt;pval));
 		prev_word=0;
 	};
-#line 1419 &quot;ael.tab.c&quot;
+#line 1426 &quot;ael.tab.c&quot;
         break;
-      case 64: /* &quot;iftime_head&quot; */
-#line 148 &quot;ael.y&quot;
+      case 64: /* &quot;random_head&quot; */
+#line 159 &quot;ael.y&quot;
         {
 		destroy_pval((yyvaluep-&gt;pval));
 		prev_word=0;
 	};
-#line 1427 &quot;ael.tab.c&quot;
+#line 1434 &quot;ael.tab.c&quot;
         break;
-      case 65: /* &quot;word_list&quot; */
-#line 160 &quot;ael.y&quot;
+      case 66: /* &quot;iftime_head&quot; */
+#line 159 &quot;ael.y&quot;
+        {
+		destroy_pval((yyvaluep-&gt;pval));
+		prev_word=0;
+	};
+#line 1442 &quot;ael.tab.c&quot;
+        break;
+      case 67: /* &quot;word_list&quot; */
+#line 172 &quot;ael.y&quot;
         { free((yyvaluep-&gt;str));};
-#line 1432 &quot;ael.tab.c&quot;
+#line 1447 &quot;ael.tab.c&quot;
         break;
-      case 66: /* &quot;word3_list&quot; */
-#line 160 &quot;ael.y&quot;
+      case 68: /* &quot;word3_list&quot; */
+#line 172 &quot;ael.y&quot;
         { free((yyvaluep-&gt;str));};
-#line 1437 &quot;ael.tab.c&quot;
+#line 1452 &quot;ael.tab.c&quot;
         break;
-      case 67: /* &quot;goto_word&quot; */
-#line 160 &quot;ael.y&quot;
+      case 69: /* &quot;goto_word&quot; */
+#line 172 &quot;ael.y&quot;
         { free((yyvaluep-&gt;str));};
-#line 1442 &quot;ael.tab.c&quot;
+#line 1457 &quot;ael.tab.c&quot;
         break;
-      case 68: /* &quot;switch_head&quot; */
-#line 148 &quot;ael.y&quot;
+      case 70: /* &quot;switch_head&quot; */
+#line 159 &quot;ael.y&quot;
         {
 		destroy_pval((yyvaluep-&gt;pval));
 		prev_word=0;
 	};
-#line 1450 &quot;ael.tab.c&quot;
+#line 1465 &quot;ael.tab.c&quot;
         break;
-      case 70: /* &quot;statement&quot; */
-#line 148 &quot;ael.y&quot;
+      case 72: /* &quot;statement&quot; */
+#line 159 &quot;ael.y&quot;
         {
 		destroy_pval((yyvaluep-&gt;pval));
 		prev_word=0;
 	};
-#line 1458 &quot;ael.tab.c&quot;
+#line 1473 &quot;ael.tab.c&quot;
         break;
-      case 77: /* &quot;opt_else&quot; */
-#line 148 &quot;ael.y&quot;
+      case 79: /* &quot;opt_else&quot; */
+#line 159 &quot;ael.y&quot;
         {
 		destroy_pval((yyvaluep-&gt;pval));
 		prev_word=0;
 	};
-#line 1466 &quot;ael.tab.c&quot;
+#line 1481 &quot;ael.tab.c&quot;
         break;
-      case 78: /* &quot;target&quot; */
-#line 148 &quot;ael.y&quot;
+      case 80: /* &quot;target&quot; */
+#line 159 &quot;ael.y&quot;
         {
 		destroy_pval((yyvaluep-&gt;pval));
 		prev_word=0;
 	};
-#line 1474 &quot;ael.tab.c&quot;
+#line 1489 &quot;ael.tab.c&quot;
         break;
-      case 79: /* &quot;jumptarget&quot; */
-#line 148 &quot;ael.y&quot;
+      case 81: /* &quot;jumptarget&quot; */
+#line 159 &quot;ael.y&quot;
         {
 		destroy_pval((yyvaluep-&gt;pval));
 		prev_word=0;
 	};
-#line 1482 &quot;ael.tab.c&quot;
+#line 1497 &quot;ael.tab.c&quot;
         break;
-      case 80: /* &quot;macro_call&quot; */
-#line 148 &quot;ael.y&quot;
+      case 82: /* &quot;macro_call&quot; */
+#line 159 &quot;ael.y&quot;
         {
 		destroy_pval((yyvaluep-&gt;pval));
 		prev_word=0;
 	};
-#line 1490 &quot;ael.tab.c&quot;
+#line 1505 &quot;ael.tab.c&quot;
         break;
-      case 82: /* &quot;application_call_head&quot; */
-#line 148 &quot;ael.y&quot;
+      case 84: /* &quot;application_call_head&quot; */
+#line 159 &quot;ael.y&quot;
         {
 		destroy_pval((yyvaluep-&gt;pval));
 		prev_word=0;
 	};
-#line 1498 &quot;ael.tab.c&quot;
+#line 1513 &quot;ael.tab.c&quot;
         break;
-      case 84: /* &quot;application_call&quot; */
-#line 148 &quot;ael.y&quot;
+      case 86: /* &quot;application_call&quot; */
+#line 159 &quot;ael.y&quot;
         {
 		destroy_pval((yyvaluep-&gt;pval));
 		prev_word=0;
 	};
-#line 1506 &quot;ael.tab.c&quot;
+#line 1521 &quot;ael.tab.c&quot;
         break;
-      case 85: /* &quot;opt_word&quot; */
-#line 160 &quot;ael.y&quot;
+      case 87: /* &quot;opt_word&quot; */
+#line 172 &quot;ael.y&quot;
         { free((yyvaluep-&gt;str));};
-#line 1511 &quot;ael.tab.c&quot;
+#line 1526 &quot;ael.tab.c&quot;
         break;
-      case 86: /* &quot;eval_arglist&quot; */
-#line 148 &quot;ael.y&quot;
+      case 88: /* &quot;eval_arglist&quot; */
+#line 159 &quot;ael.y&quot;
         {
 		destroy_pval((yyvaluep-&gt;pval));
 		prev_word=0;
 	};
-#line 1519 &quot;ael.tab.c&quot;
+#line 1534 &quot;ael.tab.c&quot;
         break;
-      case 87: /* &quot;case_statements&quot; */
-#line 148 &quot;ael.y&quot;
+      case 89: /* &quot;case_statements&quot; */
+#line 159 &quot;ael.y&quot;
         {
 		destroy_pval((yyvaluep-&gt;pval));
 		prev_word=0;
 	};
-#line 1527 &quot;ael.tab.c&quot;
+#line 1542 &quot;ael.tab.c&quot;
         break;
-      case 88: /* &quot;case_statement&quot; */
-#line 148 &quot;ael.y&quot;
+      case 90: /* &quot;case_statement&quot; */
+#line 159 &quot;ael.y&quot;
         {
 		destroy_pval((yyvaluep-&gt;pval));
 		prev_word=0;
 	};
-#line 1535 &quot;ael.tab.c&quot;
+#line 1550 &quot;ael.tab.c&quot;
         break;
-      case 89: /* &quot;macro_statements&quot; */
-#line 148 &quot;ael.y&quot;
+      case 91: /* &quot;macro_statements&quot; */
+#line 159 &quot;ael.y&quot;
         {
 		destroy_pval((yyvaluep-&gt;pval));
 		prev_word=0;
 	};
-#line 1543 &quot;ael.tab.c&quot;
+#line 1558 &quot;ael.tab.c&quot;
         break;
-      case 90: /* &quot;macro_statement&quot; */
-#line 148 &quot;ael.y&quot;
+      case 92: /* &quot;macro_statement&quot; */
+#line 159 &quot;ael.y&quot;
         {
 		destroy_pval((yyvaluep-&gt;pval));
 		prev_word=0;
 	};
-#line 1551 &quot;ael.tab.c&quot;
+#line 1566 &quot;ael.tab.c&quot;
         break;
-      case 91: /* &quot;switches&quot; */
-#line 148 &quot;ael.y&quot;
+      case 93: /* &quot;switches&quot; */
+#line 159 &quot;ael.y&quot;
         {
 		destroy_pval((yyvaluep-&gt;pval));
 		prev_word=0;
 	};
-#line 1559 &quot;ael.tab.c&quot;
+#line 1574 &quot;ael.tab.c&quot;
         break;
-      case 92: /* &quot;eswitches&quot; */
-#line 148 &quot;ael.y&quot;
+      case 94: /* &quot;eswitches&quot; */
+#line 159 &quot;ael.y&quot;
         {
 		destroy_pval((yyvaluep-&gt;pval));
 		prev_word=0;
 	};
-#line 1567 &quot;ael.tab.c&quot;
+#line 1582 &quot;ael.tab.c&quot;
         break;
-      case 93: /* &quot;switchlist&quot; */
-#line 148 &quot;ael.y&quot;
+      case 95: /* &quot;switchlist_block&quot; */
+#line 159 &quot;ael.y&quot;
         {
 		destroy_pval((yyvaluep-&gt;pval));
 		prev_word=0;
 	};
-#line 1575 &quot;ael.tab.c&quot;
+#line 1590 &quot;ael.tab.c&quot;
         break;
-      case 94: /* &quot;includeslist&quot; */
-#line 148 &quot;ael.y&quot;
+      case 96: /* &quot;switchlist&quot; */
+#line 159 &quot;ael.y&quot;
         {
 		destroy_pval((yyvaluep-&gt;pval));
 		prev_word=0;
 	};
-#line 1583 &quot;ael.tab.c&quot;
+#line 1598 &quot;ael.tab.c&quot;
         break;
-      case 95: /* &quot;includedname&quot; */
-#line 160 &quot;ael.y&quot;
+      case 97: /* &quot;includeslist&quot; */
+#line 159 &quot;ael.y&quot;
+        {
+		destroy_pval((yyvaluep-&gt;pval));
+		prev_word=0;
+	};
+#line 1606 &quot;ael.tab.c&quot;
+        break;
+      case 98: /* &quot;includedname&quot; */
+#line 172 &quot;ael.y&quot;
         { free((yyvaluep-&gt;str));};
-#line 1588 &quot;ael.tab.c&quot;
+#line 1611 &quot;ael.tab.c&quot;
         break;
-      case 96: /* &quot;includes&quot; */
-#line 148 &quot;ael.y&quot;
+      case 99: /* &quot;includes&quot; */
+#line 159 &quot;ael.y&quot;
         {
 		destroy_pval((yyvaluep-&gt;pval));
 		prev_word=0;
 	};
-#line 1596 &quot;ael.tab.c&quot;
+#line 1619 &quot;ael.tab.c&quot;
         break;
 
       default:
@@ -1909,17 +1932,17 @@
   switch (yyn)
     {
         case 2:
-#line 165 &quot;ael.y&quot;
+#line 177 &quot;ael.y&quot;
     { (yyval.pval) = parseio-&gt;pval = (yyvsp[0].pval); ;}
     break;
 
   case 3:
-#line 168 &quot;ael.y&quot;
+#line 180 &quot;ael.y&quot;
     {(yyval.pval)=(yyvsp[0].pval);;}
     break;
 
   case 4:
-#line 170 &quot;ael.y&quot;
+#line 182 &quot;ael.y&quot;
     {
 			if ( (yyvsp[-1].pval) &amp;&amp; (yyvsp[0].pval) ) {
 				(yyval.pval)=(yyvsp[-1].pval);
@@ -1933,249 +1956,244 @@
     break;
 
   case 5:
-#line 180 &quot;ael.y&quot;
+#line 192 &quot;ael.y&quot;
     {(yyval.pval)=(yyvsp[-1].pval);;}
     break;
 
   case 6:
-#line 183 &quot;ael.y&quot;
+#line 195 &quot;ael.y&quot;
     {(yyval.pval)=(yyvsp[0].pval);;}
     break;
 
   case 7:
-#line 184 &quot;ael.y&quot;
+#line 196 &quot;ael.y&quot;
     {(yyval.pval)=(yyvsp[0].pval);;}
     break;
 
   case 8:
-#line 185 &quot;ael.y&quot;
+#line 197 &quot;ael.y&quot;
     {(yyval.pval)=(yyvsp[0].pval);;}
     break;
 
   case 9:
-#line 186 &quot;ael.y&quot;
+#line 198 &quot;ael.y&quot;
     {(yyval.pval)=0;/* allow older docs to be read */;}
     break;
 
   case 10:
-#line 189 &quot;ael.y&quot;
+#line 201 &quot;ael.y&quot;
     { (yyval.str) = (yyvsp[0].str); ;}
     break;
 
   case 11:
-#line 190 &quot;ael.y&quot;
+#line 202 &quot;ael.y&quot;
     { (yyval.str) = strdup(&quot;default&quot;); ;}
     break;
 
   case 12:
-#line 193 &quot;ael.y&quot;
+#line 205 &quot;ael.y&quot;
     {
-		(yyval.pval) = npval2(PV_CONTEXT, &amp;(yylsp[-4]), &amp;(yylsp[0]));
-		(yyval.pval)-&gt;u1.str = (yyvsp[-3].str);
-		(yyval.pval)-&gt;u2.statements = (yyvsp[-1].pval); ;}
+		(yyval.pval) = npval2(PV_CONTEXT, &amp;(yylsp[-3]), &amp;(yylsp[0]));
+		(yyval.pval)-&gt;u1.str = (yyvsp[-1].str);
+		(yyval.pval)-&gt;u2.statements = (yyvsp[0].pval);
+		(yyval.pval)-&gt;u3.abstract = (yyvsp[-3].intval); ;}
     break;
 
   case 13:
-#line 197 &quot;ael.y&quot;
-    {
-		(yyval.pval) = npval2(PV_CONTEXT, &amp;(yylsp[-3]), &amp;(yylsp[0]));
-		(yyval.pval)-&gt;u1.str = (yyvsp[-2].str); ;}
+#line 213 &quot;ael.y&quot;
+    { (yyval.intval) = 1; ;}
     break;
 
   case 14:
-#line 200 &quot;ael.y&quot;
-    {
-		(yyval.pval) = npval2(PV_CONTEXT, &amp;(yylsp[-5]), &amp;(yylsp[0]));
-		(yyval.pval)-&gt;u1.str = (yyvsp[-3].str);
-		(yyval.pval)-&gt;u2.statements = (yyvsp[-1].pval);
-		(yyval.pval)-&gt;u3.abstract = 1; ;}
+#line 214 &quot;ael.y&quot;
+    { (yyval.intval) = 0; ;}
     break;
 
   case 15:
-#line 205 &quot;ael.y&quot;
+#line 217 &quot;ael.y&quot;
     {
-		(yyval.pval) = npval2(PV_CONTEXT, &amp;(yylsp[-4]), &amp;(yylsp[0]));
-		(yyval.pval)-&gt;u1.str = (yyvsp[-2].str);
-		(yyval.pval)-&gt;u3.abstract = 1; ;}
-    break;
-
-  case 16:
-#line 229 &quot;ael.y&quot;
-    {
 		(yyval.pval) = npval2(PV_MACRO, &amp;(yylsp[-7]), &amp;(yylsp[0]));
 		(yyval.pval)-&gt;u1.str = (yyvsp[-6].str); (yyval.pval)-&gt;u2.arglist = (yyvsp[-4].pval); (yyval.pval)-&gt;u3.macro_statements = (yyvsp[-1].pval); ;}
     break;
 
-  case 17:
-#line 232 &quot;ael.y&quot;
+  case 16:
+#line 220 &quot;ael.y&quot;
     {
 		(yyval.pval) = npval2(PV_MACRO, &amp;(yylsp[-6]), &amp;(yylsp[0]));
 		(yyval.pval)-&gt;u1.str = (yyvsp[-5].str); (yyval.pval)-&gt;u2.arglist = (yyvsp[-3].pval); ;}
     break;
 
-  case 18:
-#line 235 &quot;ael.y&quot;
+  case 17:
+#line 223 &quot;ael.y&quot;
     {
 		(yyval.pval) = npval2(PV_MACRO, &amp;(yylsp[-6]), &amp;(yylsp[0]));
 		(yyval.pval)-&gt;u1.str = (yyvsp[-5].str);
 		(yyval.pval)-&gt;u3.macro_statements = (yyvsp[-1].pval); ;}
     break;
 
-  case 19:
-#line 239 &quot;ael.y&quot;
+  case 18:
+#line 227 &quot;ael.y&quot;
     {
 		(yyval.pval) = npval2(PV_MACRO, &amp;(yylsp[-5]), &amp;(yylsp[0]));
 		(yyval.pval)-&gt;u1.str = (yyvsp[-4].str); ;}
     break;
 
-  case 20:
-#line 244 &quot;ael.y&quot;
+  case 19:
+#line 232 &quot;ael.y&quot;
     {
 		(yyval.pval) = npval2(PV_GLOBALS, &amp;(yylsp[-3]), &amp;(yylsp[0]));
 		(yyval.pval)-&gt;u1.statements = (yyvsp[-1].pval);;}
     break;
 
-  case 21:
-#line 247 &quot;ael.y&quot;
+  case 20:
+#line 235 &quot;ael.y&quot;
     { /* empty globals is OK */
 		(yyval.pval) = npval2(PV_GLOBALS, &amp;(yylsp[-2]), &amp;(yylsp[0])); ;}
     break;
 
-  case 22:
-#line 251 &quot;ael.y&quot;
+  case 21:
+#line 239 &quot;ael.y&quot;
     {(yyval.pval)=(yyvsp[0].pval);;}
     break;
 
-  case 23:
-#line 252 &quot;ael.y&quot;
+  case 22:
+#line 240 &quot;ael.y&quot;
     {(yyval.pval)=(yyvsp[-1].pval); linku1((yyval.pval),(yyvsp[0].pval));;}
     break;
 
-  case 24:
-#line 253 &quot;ael.y&quot;
+  case 23:
+#line 241 &quot;ael.y&quot;
     {(yyval.pval)=(yyvsp[-1].pval);;}
     break;
 
-  case 25:
-#line 256 &quot;ael.y&quot;
+  case 24:
+#line 244 &quot;ael.y&quot;
     { reset_semicount(parseio-&gt;scanner); ;}
     break;
 
-  case 26:
-#line 256 &quot;ael.y&quot;
+  case 25:
+#line 244 &quot;ael.y&quot;
     {
 		(yyval.pval) = npval2(PV_VARDEC, &amp;(yylsp[-4]), &amp;(yylsp[0]));
 		(yyval.pval)-&gt;u1.str = (yyvsp[-4].str);
 		(yyval.pval)-&gt;u2.val = (yyvsp[-1].str); ;}
     break;
 
-  case 27:
-#line 262 &quot;ael.y&quot;
-    {
-		(yyval.pval)= npval2(PV_WORD, &amp;(yylsp[0]), &amp;(yylsp[0]));
-		(yyval.pval)-&gt;u1.str = (yyvsp[0].str); ;}
+  case 26:
+#line 250 &quot;ael.y&quot;
+    { (yyval.pval)= nword((yyvsp[0].str), &amp;(yylsp[0])); ;}
     break;
 
-  case 28:
-#line 265 &quot;ael.y&quot;
+  case 27:
+#line 251 &quot;ael.y&quot;
     {
 		pval *z = npval2(PV_WORD, &amp;(yylsp[-2]), &amp;(yylsp[0]));
 		z-&gt;u1.str = (yyvsp[0].str);
 		(yyval.pval) = linku1((yyvsp[-2].pval),z); ;}
     break;
 
-  case 29:
-#line 269 &quot;ael.y&quot;
+  case 28:
+#line 255 &quot;ael.y&quot;
     {(yyval.pval)=(yyvsp[-1].pval);;}
     break;
 
+  case 29:
+#line 258 &quot;ael.y&quot;
+    { (yyval.pval) = NULL; ;}
+    break;
+
   case 30:
-#line 272 &quot;ael.y&quot;
-    { (yyval.pval)=(yyvsp[0].pval);;}
+#line 259 &quot;ael.y&quot;
+    { (yyval.pval) = (yyvsp[-1].pval); ;}
     break;
 
   case 31:
-#line 273 &quot;ael.y&quot;
-    {(yyval.pval)=0;;}
+#line 262 &quot;ael.y&quot;
+    { (yyval.pval)=(yyvsp[0].pval);;}
     break;
 
   case 32:
-#line 274 &quot;ael.y&quot;
+#line 263 &quot;ael.y&quot;
+    {(yyval.pval)=0;;}
+    break;
+
+  case 33:
+#line 264 &quot;ael.y&quot;
     { if ( (yyvsp[-1].pval) &amp;&amp; (yyvsp[0].pval) ) {(yyval.pval)=(yyvsp[-1].pval); linku1((yyval.pval),(yyvsp[0].pval));}
 				else if ( (yyvsp[-1].pval) ) {(yyval.pval)=(yyvsp[-1].pval);}
 				else if ( (yyvsp[0].pval) ) {(yyval.pval)=(yyvsp[0].pval);} ;}
     break;
 
-  case 33:
-#line 277 &quot;ael.y&quot;
+  case 34:
+#line 267 &quot;ael.y&quot;
     { (yyval.pval)=(yyvsp[-1].pval);;}
     break;
 
-  case 34:
-#line 280 &quot;ael.y&quot;
-    {(yyval.pval)=(yyvsp[0].pval);;}
-    break;
-
   case 35:
-#line 281 &quot;ael.y&quot;
+#line 270 &quot;ael.y&quot;
     {(yyval.pval)=(yyvsp[0].pval);;}
     break;
 
   case 36:
-#line 282 &quot;ael.y&quot;
+#line 271 &quot;ael.y&quot;
     {(yyval.pval)=(yyvsp[0].pval);;}
     break;
 
   case 37:
-#line 283 &quot;ael.y&quot;
+#line 272 &quot;ael.y&quot;
     {(yyval.pval)=(yyvsp[0].pval);;}
     break;
 
   case 38:
-#line 284 &quot;ael.y&quot;
+#line 273 &quot;ael.y&quot;
     {(yyval.pval)=(yyvsp[0].pval);;}
     break;
 
   case 39:
-#line 285 &quot;ael.y&quot;
-    { reset_semicount(parseio-&gt;scanner); ;}
+#line 274 &quot;ael.y&quot;
+    {(yyval.pval)=(yyvsp[0].pval);;}
     break;
 
   case 40:
-#line 285 &quot;ael.y&quot;
+#line 275 &quot;ael.y&quot;
+    { reset_semicount(parseio-&gt;scanner); ;}
+    break;
+
+  case 41:
+#line 275 &quot;ael.y&quot;
     {
 		(yyval.pval) = npval2(PV_VARDEC, &amp;(yylsp[-4]), &amp;(yylsp[0]));
 		(yyval.pval)-&gt;u1.str = (yyvsp[-4].str);
 		(yyval.pval)-&gt;u2.val = (yyvsp[-1].str); ;}
     break;
 
-  case 41:
-#line 289 &quot;ael.y&quot;
+  case 42:
+#line 279 &quot;ael.y&quot;
     {free((yyvsp[-1].str)); (yyval.pval)=0;;}
     break;
 
-  case 42:
-#line 290 &quot;ael.y&quot;
+  case 43:
+#line 280 &quot;ael.y&quot;
     {(yyval.pval)=0;/* allow older docs to be read */;}
     break;
 
-  case 43:
-#line 293 &quot;ael.y&quot;
+  case 44:
+#line 283 &quot;ael.y&quot;
     {
 		(yyval.pval) = npval2(PV_IGNOREPAT, &amp;(yylsp[-3]), &amp;(yylsp[0]));
 		(yyval.pval)-&gt;u1.str = (yyvsp[-1].str);;}
     break;
 
-  case 44:
-#line 298 &quot;ael.y&quot;
+  case 45:
+#line 288 &quot;ael.y&quot;
     {
 		(yyval.pval) = npval2(PV_EXTENSION, &amp;(yylsp[-2]), &amp;(yylsp[0]));
 		(yyval.pval)-&gt;u1.str = (yyvsp[-2].str);
 		(yyval.pval)-&gt;u2.statements = (yyvsp[0].pval); ;}
     break;
 
-  case 45:
-#line 302 &quot;ael.y&quot;
+  case 46:
+#line 292 &quot;ael.y&quot;
     {
 		(yyval.pval) = npval2(PV_EXTENSION, &amp;(yylsp[-3]), &amp;(yylsp[0]));
 		(yyval.pval)-&gt;u1.str = (yyvsp[-2].str);
@@ -2183,8 +2201,8 @@
 		(yyval.pval)-&gt;u4.regexten=1;;}
     break;
 
-  case 46:
-#line 307 &quot;ael.y&quot;
+  case 47:
+#line 297 &quot;ael.y&quot;
     {
 		(yyval.pval) = npval2(PV_EXTENSION, &amp;(yylsp[-6]), &amp;(yylsp[0]));
 		(yyval.pval)-&gt;u1.str = (yyvsp[-2].str);
@@ -2192,8 +2210,8 @@
 		(yyval.pval)-&gt;u3.hints = (yyvsp[-4].str);;}
     break;
 
-  case 47:
-#line 312 &quot;ael.y&quot;
+  case 48:
+#line 302 &quot;ael.y&quot;
     {
 		(yyval.pval) = npval2(PV_EXTENSION, &amp;(yylsp[-7]), &amp;(yylsp[0]));
 		(yyval.pval)-&gt;u1.str = (yyvsp[-2].str);
@@ -2202,49 +2220,49 @@
 		(yyval.pval)-&gt;u3.hints = (yyvsp[-4].str);;}
     break;
 
-  case 48:
-#line 321 &quot;ael.y&quot;
+  case 49:
+#line 311 &quot;ael.y&quot;
     {(yyval.pval)=(yyvsp[0].pval);;}
     break;
 
-  case 49:
-#line 322 &quot;ael.y&quot;
+  case 50:
+#line 312 &quot;ael.y&quot;
     {if ( (yyvsp[-1].pval) &amp;&amp; (yyvsp[0].pval) ) {(yyval.pval)=(yyvsp[-1].pval); linku1((yyval.pval),(yyvsp[0].pval));}
 						 else if ( (yyvsp[-1].pval) ) {(yyval.pval)=(yyvsp[-1].pval);}
 						 else if ( (yyvsp[0].pval) ) {(yyval.pval)=(yyvsp[0].pval);} ;}
     break;
 
-  case 50:
-#line 325 &quot;ael.y&quot;
+  case 51:
+#line 315 &quot;ael.y&quot;
     {(yyval.pval)=(yyvsp[-1].pval);;}
     break;
 
-  case 51:
-#line 328 &quot;ael.y&quot;
+  case 52:
+#line 318 &quot;ael.y&quot;
     { reset_parencount(parseio-&gt;scanner); ;}
     break;
 
-  case 52:
-#line 328 &quot;ael.y&quot;
+  case 53:
+#line 318 &quot;ael.y&quot;
     {
 		(yyval.pval)= npval2(PV_IF, &amp;(yylsp[-4]), &amp;(yylsp[0]));
 		(yyval.pval)-&gt;u1.str = (yyvsp[-1].str); ;}
     break;
 
-  case 53:
-#line 333 &quot;ael.y&quot;
+  case 54:
+#line 323 &quot;ael.y&quot;
     { reset_parencount(parseio-&gt;scanner); ;}
     break;
 
-  case 54:
-#line 333 &quot;ael.y&quot;
+  case 55:
+#line 323 &quot;ael.y&quot;
     {
 		(yyval.pval) = npval2(PV_RANDOM, &amp;(yylsp[-4]), &amp;(yylsp[0]));
 		(yyval.pval)-&gt;u1.str=(yyvsp[-1].str);;}
     break;
 
-  case 55:
-#line 339 &quot;ael.y&quot;
+  case 56:
+#line 329 &quot;ael.y&quot;
     {
 		(yyval.pval) = npval2(PV_IFTIME, &amp;(yylsp[-13]), &amp;(yylsp[-9])); /* XXX really @5 or more ? */
 		(yyval.pval)-&gt;u1.list = npval2(PV_WORD, &amp;(yylsp[-11]), &amp;(yylsp[-11]));
@@ -2252,39 +2270,32 @@
 		free((yyvsp[-11].str));
 		free((yyvsp[-9].str));
 		free((yyvsp[-7].str));
-		(yyval.pval)-&gt;u1.list-&gt;next = npval2(PV_WORD, &amp;(yylsp[-5]), &amp;(yylsp[-5]));
-		(yyval.pval)-&gt;u1.list-&gt;next-&gt;u1.str = (yyvsp[-5].str);
-		(yyval.pval)-&gt;u1.list-&gt;next-&gt;next = npval2(PV_WORD, &amp;(yylsp[-3]), &amp;(yylsp[-3]));
-		(yyval.pval)-&gt;u1.list-&gt;next-&gt;next-&gt;u1.str = (yyvsp[-3].str);
-		(yyval.pval)-&gt;u1.list-&gt;next-&gt;next-&gt;next = npval2(PV_WORD, &amp;(yylsp[-1]), &amp;(yylsp[-1]));
-		(yyval.pval)-&gt;u1.list-&gt;next-&gt;next-&gt;next-&gt;u1.str = (yyvsp[-1].str);
+		(yyval.pval)-&gt;u1.list-&gt;next = nword((yyvsp[-5].str), &amp;(yylsp[-5]));
+		(yyval.pval)-&gt;u1.list-&gt;next-&gt;next = nword((yyvsp[-3].str), &amp;(yylsp[-3]));
+		(yyval.pval)-&gt;u1.list-&gt;next-&gt;next-&gt;next = nword((yyvsp[-1].str), &amp;(yylsp[-1]));
 		prev_word = 0;
 	;}
     break;
 
-  case 56:
-#line 354 &quot;ael.y&quot;
+  case 57:
+#line 341 &quot;ael.y&quot;
     {
 		(yyval.pval) = npval2(PV_IFTIME, &amp;(yylsp[-9]), &amp;(yylsp[-5])); /* XXX @5 or greater ? */
-		(yyval.pval)-&gt;u1.list = npval2(PV_WORD, &amp;(yylsp[-7]), &amp;(yylsp[-7]));
-		(yyval.pval)-&gt;u1.list-&gt;u1.str = (yyvsp[-7].str);
-		(yyval.pval)-&gt;u1.list-&gt;next = npval2(PV_WORD, &amp;(yylsp[-5]), &amp;(yylsp[-5]));
-		(yyval.pval)-&gt;u1.list-&gt;next-&gt;u1.str = (yyvsp[-5].str);
-		(yyval.pval)-&gt;u1.list-&gt;next-&gt;next = npval2(PV_WORD, &amp;(yylsp[-3]), &amp;(yylsp[-3]));
-		(yyval.pval)-&gt;u1.list-&gt;next-&gt;next-&gt;u1.str = (yyvsp[-3].str);
-		(yyval.pval)-&gt;u1.list-&gt;next-&gt;next-&gt;next = npval2(PV_WORD, &amp;(yylsp[-1]), &amp;(yylsp[-1]));
-		(yyval.pval)-&gt;u1.list-&gt;next-&gt;next-&gt;next-&gt;u1.str = (yyvsp[-1].str);
+		(yyval.pval)-&gt;u1.list = nword((yyvsp[-7].str), &amp;(yylsp[-7]));
+		(yyval.pval)-&gt;u1.list-&gt;next = nword((yyvsp[-5].str), &amp;(yylsp[-5]));
+		(yyval.pval)-&gt;u1.list-&gt;next-&gt;next = nword((yyvsp[-3].str), &amp;(yylsp[-3]));
+		(yyval.pval)-&gt;u1.list-&gt;next-&gt;next-&gt;next = nword((yyvsp[-1].str), &amp;(yylsp[-1]));
 		prev_word = 0;
 	;}
     break;
 
-  case 57:
-#line 374 &quot;ael.y&quot;
+  case 58:
+#line 357 &quot;ael.y&quot;
     { (yyval.str) = (yyvsp[0].str);;}
     break;
 
-  case 58:
-#line 375 &quot;ael.y&quot;
+  case 59:
+#line 358 &quot;ael.y&quot;
     {
 		asprintf(&amp;((yyval.str)), &quot;%s%s&quot;, (yyvsp[-1].str), (yyvsp[0].str));
 		free((yyvsp[-1].str));
@@ -2292,13 +2303,13 @@
 		prev_word = (yyval.str);;}
     break;
 
-  case 59:
-#line 382 &quot;ael.y&quot;
+  case 60:
+#line 365 &quot;ael.y&quot;
     { (yyval.str) = (yyvsp[0].str);;}
     break;
 
-  case 60:
-#line 383 &quot;ael.y&quot;
+  case 61:
+#line 366 &quot;ael.y&quot;
     {
 		asprintf(&amp;((yyval.str)), &quot;%s%s&quot;, (yyvsp[-1].str), (yyvsp[0].str));
 		free((yyvsp[-1].str));
@@ -2306,8 +2317,8 @@
 		prev_word = (yyval.str);;}
     break;
 
-  case 61:
-#line 388 &quot;ael.y&quot;
+  case 62:
+#line 371 &quot;ael.y&quot;
     {
 		asprintf(&amp;((yyval.str)), &quot;%s%s%s&quot;, (yyvsp[-2].str), (yyvsp[-1].str), (yyvsp[0].str));
 		free((yyvsp[-2].str));
@@ -2316,97 +2327,97 @@
 		prev_word=(yyval.str);;}
     break;
 
-  case 62:
-#line 396 &quot;ael.y&quot;
+  case 63:
+#line 379 &quot;ael.y&quot;
     { (yyval.str) = (yyvsp[0].str);;}
     break;
 
-  case 63:
-#line 397 &quot;ael.y&quot;
+  case 64:
+#line 380 &quot;ael.y&quot;
     {
 		asprintf(&amp;((yyval.str)), &quot;%s%s&quot;, (yyvsp[-1].str), (yyvsp[0].str));
 		free((yyvsp[-1].str));
 		free((yyvsp[0].str));;}
     break;
 
-  case 64:
-#line 401 &quot;ael.y&quot;
+  case 65:
+#line 384 &quot;ael.y&quot;
     {
 		asprintf(&amp;((yyval.str)), &quot;%s:%s&quot;, (yyvsp[-2].str), (yyvsp[0].str));
 		free((yyvsp[-2].str));
 		free((yyvsp[0].str));;}
     break;
 
-  case 65:
-#line 407 &quot;ael.y&quot;
+  case 66:
+#line 390 &quot;ael.y&quot;
     { reset_parencount(parseio-&gt;scanner); ;}
     break;
 
-  case 66:
-#line 407 &quot;ael.y&quot;
+  case 67:
+#line 390 &quot;ael.y&quot;
     {
 		(yyval.pval) = npval2(PV_SWITCH, &amp;(yylsp[-5]), &amp;(yylsp[0]));
 		(yyval.pval)-&gt;u1.str = (yyvsp[-2].str); ;}
     break;
 
-  case 67:
-#line 415 &quot;ael.y&quot;
+  case 68:
+#line 398 &quot;ael.y&quot;
     {
 		(yyval.pval) = npval2(PV_STATEMENTBLOCK, &amp;(yylsp[-2]), &amp;(yylsp[0]));
 		(yyval.pval)-&gt;u1.list = (yyvsp[-1].pval); ;}
     break;
 
-  case 68:
-#line 418 &quot;ael.y&quot;
+  case 69:
+#line 401 &quot;ael.y&quot;
     {reset_semicount(parseio-&gt;scanner);;}
     break;
 
-  case 69:
-#line 418 &quot;ael.y&quot;
+  case 70:
+#line 401 &quot;ael.y&quot;
     {
 		(yyval.pval) = npval2(PV_VARDEC, &amp;(yylsp[-4]), &amp;(yylsp[0]));
 		(yyval.pval)-&gt;u1.str = (yyvsp[-4].str);
 		(yyval.pval)-&gt;u2.val = (yyvsp[-1].str); ;}
     break;
 
-  case 70:
-#line 422 &quot;ael.y&quot;
+  case 71:
+#line 405 &quot;ael.y&quot;
     {
 		(yyval.pval) = npval2(PV_GOTO, &amp;(yylsp[-2]), &amp;(yylsp[0]));
 		(yyval.pval)-&gt;u1.list = (yyvsp[-1].pval);;}
     break;
 
-  case 71:
-#line 425 &quot;ael.y&quot;
+  case 72:
+#line 408 &quot;ael.y&quot;
     {
 		(yyval.pval) = npval2(PV_GOTO, &amp;(yylsp[-2]), &amp;(yylsp[0]));
 		(yyval.pval)-&gt;u1.list = (yyvsp[-1].pval);;}
     break;
 
-  case 72:
-#line 428 &quot;ael.y&quot;
+  case 73:
+#line 411 &quot;ael.y&quot;
     {
 		(yyval.pval) = npval2(PV_LABEL, &amp;(yylsp[-1]), &amp;(yylsp[0]));
 		(yyval.pval)-&gt;u1.str = (yyvsp[-1].str); ;}
     break;
 
-  case 73:
-#line 431 &quot;ael.y&quot;
+  case 74:
+#line 414 &quot;ael.y&quot;
     {reset_semicount(parseio-&gt;scanner);;}
     break;
 
-  case 74:
-#line 432 &quot;ael.y&quot;
+  case 75:
+#line 415 &quot;ael.y&quot;
     {reset_semicount(parseio-&gt;scanner);;}
     break;
 
-  case 75:
-#line 433 &quot;ael.y&quot;
+  case 76:
+#line 416 &quot;ael.y&quot;
     {reset_parencount(parseio-&gt;scanner);;}
     break;
 
-  case 76:
-#line 433 &quot;ael.y&quot;
+  case 77:
+#line 416 &quot;ael.y&quot;
     {
 		(yyval.pval) = npval2(PV_FOR, &amp;(yylsp[-11]), &amp;(yylsp[0]));
 		(yyval.pval)-&gt;u1.for_init = (yyvsp[-8].str);
@@ -2415,66 +2426,58 @@
 		(yyval.pval)-&gt;u4.for_statements = (yyvsp[0].pval);;}
     break;
 
-  case 77:
-#line 439 &quot;ael.y&quot;
+  case 78:
+#line 422 &quot;ael.y&quot;
     {reset_parencount(parseio-&gt;scanner);;}
     break;
 
-  case 78:
-#line 439 &quot;ael.y&quot;
+  case 79:
+#line 422 &quot;ael.y&quot;
     {
 		(yyval.pval) = npval2(PV_WHILE, &amp;(yylsp[-5]), &amp;(yylsp[0]));
 		(yyval.pval)-&gt;u1.str = (yyvsp[-2].str);
 		(yyval.pval)-&gt;u2.statements = (yyvsp[0].pval); ;}
     break;
 
-  case 79:
-#line 443 &quot;ael.y&quot;
-    {
-		(yyval.pval)=(yyvsp[-1].pval);
-		(yyval.pval)-&gt;endline = (yylsp[0]).last_line;
-		(yyval.pval)-&gt;endcol = (yylsp[0]).last_column;;}
-    break;
-
   case 80:
-#line 447 &quot;ael.y&quot;
+#line 426 &quot;ael.y&quot;
     {
-		(yyval.pval)=(yyvsp[-2].pval);
-		(yyval.pval)-&gt;u2.statements = (yyvsp[-1].pval);
-		(yyval.pval)-&gt;endline = (yylsp[0]).last_line;
-		(yyval.pval)-&gt;endcol = (yylsp[0]).last_column;;}
+		(yyval.pval) = update_last((yyvsp[-1].pval), &amp;(yylsp[0])); ;}
     break;
 
   case 81:
-#line 452 &quot;ael.y&quot;
+#line 428 &quot;ael.y&quot;
     {
-		(yyval.pval) = (yyvsp[-1].pval);
-		(yyval.pval)-&gt;endline = (yylsp[-1]).last_line;
-		(yyval.pval)-&gt;endcol = (yylsp[-1]).last_column;;}
+		(yyval.pval) = update_last((yyvsp[-2].pval), &amp;(yylsp[0]));
+		(yyval.pval)-&gt;u2.statements = (yyvsp[-1].pval);;}
     break;
 
   case 82:
-#line 456 &quot;ael.y&quot;
+#line 431 &quot;ael.y&quot;
     {
-		(yyval.pval) = (yyvsp[-1].pval);
-		(yyval.pval)-&gt;endline = (yylsp[0]).last_line;
-		(yyval.pval)-&gt;endcol = (yylsp[0]).last_column;;}
+		(yyval.pval) = update_last((yyvsp[-1].pval), &amp;(yylsp[-1])); ;}
     break;
 
   case 83:
-#line 460 &quot;ael.y&quot;
+#line 433 &quot;ael.y&quot;
     {
+		(yyval.pval) = update_last((yyvsp[-1].pval), &amp;(yylsp[0])); ;}
+    break;
+
+  case 84:
+#line 435 &quot;ael.y&quot;
+    {
 		(yyval.pval)= npval2(PV_APPLICATION_CALL, &amp;(yylsp[-1]), &amp;(yylsp[0]));
 		(yyval.pval)-&gt;u1.str = (yyvsp[-1].str);;}
     break;
 
-  case 84:
-#line 463 &quot;ael.y&quot;
+  case 85:
+#line 438 &quot;ael.y&quot;
     {reset_semicount(parseio-&gt;scanner);;}
     break;
 
-  case 85:
-#line 463 &quot;ael.y&quot;
+  case 86:
+#line 438 &quot;ael.y&quot;
     {
 		char *bufx;
 		int tot=0;
@@ -2510,165 +2513,138 @@
 	;}
     break;
 
-  case 86:
-#line 496 &quot;ael.y&quot;
+  case 87:
+#line 471 &quot;ael.y&quot;
     { (yyval.pval) = npval2(PV_BREAK, &amp;(yylsp[-1]), &amp;(yylsp[0])); ;}
     break;
 
-  case 87:
-#line 497 &quot;ael.y&quot;
+  case 88:
+#line 472 &quot;ael.y&quot;
     { (yyval.pval) = npval2(PV_RETURN, &amp;(yylsp[-1]), &amp;(yylsp[0])); ;}
     break;
 
-  case 88:
-#line 498 &quot;ael.y&quot;
+  case 89:
+#line 473 &quot;ael.y&quot;
     { (yyval.pval) = npval2(PV_CONTINUE, &amp;(yylsp[-1]), &amp;(yylsp[0])); ;}
     break;
 
-  case 89:
-#line 499 &quot;ael.y&quot;
-    {
-		(yyval.pval)=(yyvsp[-2].pval);
-		(yyval.pval)-&gt;u2.statements = (yyvsp[-1].pval);
-		(yyval.pval)-&gt;endline = (yylsp[-1]).last_line;
-		(yyval.pval)-&gt;u3.else_statements = (yyvsp[0].pval);
-		(yyval.pval)-&gt;endcol = (yylsp[-1]).last_column;;}
-    break;
-
   case 90:
-#line 513 &quot;ael.y&quot;
+#line 474 &quot;ael.y&quot;
     {
-		(yyval.pval)=(yyvsp[-2].pval);
+		(yyval.pval) = update_last((yyvsp[-2].pval), &amp;(yylsp[-1])); /* XXX probably @3... */
 		(yyval.pval)-&gt;u2.statements = (yyvsp[-1].pval);
-		(yyval.pval)-&gt;endline = (yylsp[-1]).last_line;
-		(yyval.pval)-&gt;u3.else_statements = (yyvsp[0].pval);
-		(yyval.pval)-&gt;endcol = (yylsp[-1]).last_column;;}
+		(yyval.pval)-&gt;u3.else_statements = (yyvsp[0].pval);;}
     break;
 
   case 91:
-#line 527 &quot;ael.y&quot;
+#line 478 &quot;ael.y&quot;
     {
-		(yyval.pval)=(yyvsp[-2].pval);
+		(yyval.pval) = update_last((yyvsp[-2].pval), &amp;(yylsp[-1])); /* XXX probably @3... */
 		(yyval.pval)-&gt;u2.statements = (yyvsp[-1].pval);
-		(yyval.pval)-&gt;endline = (yylsp[-1]).last_line;
-		(yyval.pval)-&gt;u3.else_statements = (yyvsp[0].pval);
-		(yyval.pval)-&gt;endcol = (yylsp[-1]).last_column;;}
+		(yyval.pval)-&gt;u3.else_statements = (yyvsp[0].pval);;}
     break;
 
   case 92:
-#line 541 &quot;ael.y&quot;
-    { (yyval.pval)=0; ;}
+#line 482 &quot;ael.y&quot;
+    {
+		(yyval.pval) = update_last((yyvsp[-2].pval), &amp;(yylsp[-1])); /* XXX probably @3... */
+		(yyval.pval)-&gt;u2.statements = (yyvsp[-1].pval);
+		(yyval.pval)-&gt;u3.else_statements = (yyvsp[0].pval);;}
     break;
 
   case 93:
-#line 544 &quot;ael.y&quot;
-    { (yyval.pval) = (yyvsp[0].pval); ;}
+#line 486 &quot;ael.y&quot;
+    { (yyval.pval)=0; ;}
     break;
 
   case 94:
-#line 545 &quot;ael.y&quot;
-    { (yyval.pval) = NULL ; ;}
+#line 489 &quot;ael.y&quot;
+    { (yyval.pval) = (yyvsp[0].pval); ;}
     break;
 
   case 95:
-#line 550 &quot;ael.y&quot;
-    { (yyval.pval) = npval2(PV_WORD, &amp;(yylsp[0]), &amp;(yylsp[0]));
-		(yyval.pval)-&gt;u1.str = (yyvsp[0].str);;}
+#line 490 &quot;ael.y&quot;
+    { (yyval.pval) = NULL ; ;}
     break;
 
   case 96:
-#line 552 &quot;ael.y&quot;
-    {
-		(yyval.pval) = npval2(PV_WORD, &amp;(yylsp[-2]), &amp;(yylsp[-2]));
-		(yyval.pval)-&gt;u1.str = (yyvsp[-2].str);
-		(yyval.pval)-&gt;next = npval2(PV_WORD, &amp;(yylsp[0]), &amp;(yylsp[0]));
-		(yyval.pval)-&gt;next-&gt;u1.str = (yyvsp[0].str);;}
+#line 495 &quot;ael.y&quot;
+    { (yyval.pval) = nword((yyvsp[0].str), &amp;(yylsp[0])); ;}
     break;
 
   case 97:
-#line 557 &quot;ael.y&quot;
+#line 496 &quot;ael.y&quot;
     {
-		(yyval.pval) = npval2(PV_WORD, &amp;(yylsp[-2]), &amp;(yylsp[-2]));
-		(yyval.pval)-&gt;u1.str = (yyvsp[-2].str);
-		(yyval.pval)-&gt;next = npval2(PV_WORD, &amp;(yylsp[0]), &amp;(yylsp[0]));
-		(yyval.pval)-&gt;next-&gt;u1.str = (yyvsp[0].str);;}
+		(yyval.pval) = nword((yyvsp[-2].str), &amp;(yylsp[-2]));
+		(yyval.pval)-&gt;next = nword((yyvsp[0].str), &amp;(yylsp[0])); ;}
     break;
 
   case 98:
-#line 562 &quot;ael.y&quot;
+#line 499 &quot;ael.y&quot;
     {
-		(yyval.pval) = npval2(PV_WORD, &amp;(yylsp[-4]), &amp;(yylsp[-4]));
-		(yyval.pval)-&gt;u1.str = (yyvsp[-4].str);
-		(yyval.pval)-&gt;next = npval2(PV_WORD, &amp;(yylsp[-2]), &amp;(yylsp[-2]));
-		(yyval.pval)-&gt;next-&gt;u1.str = (yyvsp[-2].str);
-		(yyval.pval)-&gt;next-&gt;next = npval2(PV_WORD, &amp;(yylsp[0]), &amp;(yylsp[0]));
-		(yyval.pval)-&gt;next-&gt;next-&gt;u1.str = (yyvsp[0].str); ;}
+		(yyval.pval) = nword((yyvsp[-2].str), &amp;(yylsp[-2]));
+		(yyval.pval)-&gt;next = nword((yyvsp[0].str), &amp;(yylsp[0])); ;}
     break;
 
   case 99:
-#line 569 &quot;ael.y&quot;
+#line 502 &quot;ael.y&quot;
     {
-		(yyval.pval) = npval2(PV_WORD, &amp;(yylsp[-4]), &amp;(yylsp[-4]));
-		(yyval.pval)-&gt;u1.str = (yyvsp[-4].str);
-		(yyval.pval)-&gt;next = npval2(PV_WORD, &amp;(yylsp[-2]), &amp;(yylsp[-2]));
-		(yyval.pval)-&gt;next-&gt;u1.str = (yyvsp[-2].str);
-		(yyval.pval)-&gt;next-&gt;next = npval2(PV_WORD, &amp;(yylsp[0]), &amp;(yylsp[0]));
-		(yyval.pval)-&gt;next-&gt;next-&gt;u1.str = (yyvsp[0].str); ;}
+		(yyval.pval) = nword((yyvsp[-4].str), &amp;(yylsp[-4]));
+		(yyval.pval)-&gt;next = nword((yyvsp[-2].str), &amp;(yylsp[-2]));
+		(yyval.pval)-&gt;next-&gt;next = nword((yyvsp[0].str), &amp;(yylsp[0])); ;}
     break;
 
   case 100:
-#line 576 &quot;ael.y&quot;
+#line 506 &quot;ael.y&quot;
     {
-		(yyval.pval) = npval2(PV_WORD, &amp;(yylsp[-4]), &amp;(yylsp[-4]));
-		(yyval.pval)-&gt;u1.str = strdup(&quot;default&quot;);
-		(yyval.pval)-&gt;next = npval2(PV_WORD, &amp;(yylsp[-2]), &amp;(yylsp[-2]));
-		(yyval.pval)-&gt;next-&gt;u1.str = (yyvsp[-2].str);
-		(yyval.pval)-&gt;next-&gt;next = npval2(PV_WORD, &amp;(yylsp[0]), &amp;(yylsp[0]));
-		(yyval.pval)-&gt;next-&gt;next-&gt;u1.str = (yyvsp[0].str); ;}
+		(yyval.pval) = nword((yyvsp[-4].str), &amp;(yylsp[-4]));
+		(yyval.pval)-&gt;next = nword((yyvsp[-2].str), &amp;(yylsp[-2]));
+		(yyval.pval)-&gt;next-&gt;next = nword((yyvsp[0].str), &amp;(yylsp[0])); ;}
     break;
 
   case 101:
-#line 583 &quot;ael.y&quot;
+#line 510 &quot;ael.y&quot;
     {
-		(yyval.pval) = npval2(PV_WORD, &amp;(yylsp[-4]), &amp;(yylsp[-4]));
-		(yyval.pval)-&gt;u1.str = strdup(&quot;default&quot;);
-		(yyval.pval)-&gt;next = npval2(PV_WORD, &amp;(yylsp[-2]), &amp;(yylsp[-2]));
-		(yyval.pval)-&gt;next-&gt;u1.str = (yyvsp[-2].str);
-		(yyval.pval)-&gt;next-&gt;next = npval2(PV_WORD, &amp;(yylsp[0]), &amp;(yylsp[0]));
-		(yyval.pval)-&gt;next-&gt;next-&gt;u1.str = (yyvsp[0].str); ;}
+		(yyval.pval) = nword(strdup(&quot;default&quot;), &amp;(yylsp[-4]));
+		(yyval.pval)-&gt;next = nword((yyvsp[-2].str), &amp;(yylsp[-2]));
+		(yyval.pval)-&gt;next-&gt;next = nword((yyvsp[0].str), &amp;(yylsp[0])); ;}
     break;
 
   case 102:
-#line 592 &quot;ael.y&quot;
+#line 514 &quot;ael.y&quot;
     {
-		(yyval.pval) = npval2(PV_WORD, &amp;(yylsp[0]), &amp;(yylsp[0]));
-		(yyval.pval)-&gt;u1.str = (yyvsp[0].str);
-		(yyval.pval)-&gt;next = npval2(PV_WORD, &amp;(yylsp[0]), &amp;(yylsp[0])); /* XXX not really @1 */
-		(yyval.pval)-&gt;next-&gt;u1.str = strdup(&quot;1&quot;);;}
+		(yyval.pval) = nword(strdup(&quot;default&quot;), &amp;(yylsp[-4]));
+		(yyval.pval)-&gt;next = nword((yyvsp[-2].str), &amp;(yylsp[-2]));
+		(yyval.pval)-&gt;next-&gt;next = nword((yyvsp[0].str), &amp;(yylsp[0])); ;}
     break;
 
   case 103:
-#line 597 &quot;ael.y&quot;
+#line 521 &quot;ael.y&quot;
     {
-		(yyval.pval) = npval2(PV_WORD, &amp;(yylsp[-2]), &amp;(yylsp[-2]));
-		(yyval.pval)-&gt;u1.str = (yyvsp[-2].str);
-		(yyval.pval)-&gt;next = npval2(PV_WORD, &amp;(yylsp[0]), &amp;(yylsp[0]));
-		(yyval.pval)-&gt;next-&gt;u1.str = (yyvsp[0].str);;}
+		(yyval.pval) = nword((yyvsp[0].str), &amp;(yylsp[0]));
+		(yyval.pval)-&gt;next = nword(strdup(&quot;1&quot;), &amp;(yylsp[0])); ;}
     break;
 
   case 104:
-#line 602 &quot;ael.y&quot;
+#line 524 &quot;ael.y&quot;
     {
+		(yyval.pval) = nword((yyvsp[-2].str), &amp;(yylsp[-2]));
+		(yyval.pval)-&gt;next = nword((yyvsp[0].str), &amp;(yylsp[0])); ;}
+    break;
+
+  case 105:
+#line 527 &quot;ael.y&quot;
+    {
 		(yyval.pval) = npval2(PV_WORD, &amp;(yylsp[-4]), &amp;(yylsp[-4]));
-		(yyval.pval)-&gt;u1.str = (yyvsp[0].str);
+		(yyval.pval)-&gt;u1.str = (yyvsp[0].str);	/* XXX must check this */
 		(yyval.pval)-&gt;next = npval2(PV_WORD, &amp;(yylsp[-2]), &amp;(yylsp[-2]));
 		(yyval.pval)-&gt;next-&gt;u1.str = (yyvsp[-4].str);
 		(yyval.pval)-&gt;next-&gt;next = npval2(PV_WORD, &amp;(yylsp[0]), &amp;(yylsp[0]));
 		(yyval.pval)-&gt;next-&gt;next-&gt;u1.str = (yyvsp[-2].str); ;}
     break;
 
-  case 105:
-#line 609 &quot;ael.y&quot;
+  case 106:
+#line 534 &quot;ael.y&quot;
     {
 		(yyval.pval) = npval2(PV_WORD, &amp;(yylsp[-2]), &amp;(yylsp[-2]));
 		(yyval.pval)-&gt;u1.str = (yyvsp[0].str);
@@ -2678,8 +2654,8 @@
 		(yyval.pval)-&gt;next-&gt;next-&gt;u1.str = strdup(&quot;1&quot;); ;}
     break;
 
-  case 106:
-#line 616 &quot;ael.y&quot;
+  case 107:
+#line 541 &quot;ael.y&quot;
     {
 		(yyval.pval) = npval2(PV_WORD, &amp;(yylsp[-4]), &amp;(yylsp[-4]));
 		(yyval.pval)-&gt;u1.str = strdup(&quot;default&quot;);
@@ -2689,8 +2665,8 @@
 		(yyval.pval)-&gt;next-&gt;next-&gt;u1.str = (yyvsp[-2].str); ;}
     break;
 
-  case 107:
-#line 623 &quot;ael.y&quot;
+  case 108:
+#line 548 &quot;ael.y&quot;
     {
 		(yyval.pval) = npval2(PV_WORD, &amp;(yylsp[-2]), &amp;(yylsp[-2]));
 		(yyval.pval)-&gt;u1.str = strdup(&quot;default&quot;);
@@ -2700,13 +2676,13 @@
 		(yyval.pval)-&gt;next-&gt;next-&gt;u1.str = strdup(&quot;1&quot;); ;}
     break;
 
-  case 108:
-#line 632 &quot;ael.y&quot;
+  case 109:
+#line 557 &quot;ael.y&quot;
     {reset_argcount(parseio-&gt;scanner);;}
     break;
 
-  case 109:
-#line 632 &quot;ael.y&quot;
+  case 110:
+#line 557 &quot;ael.y&quot;
     {
 		/* XXX original code had @2 but i think we need @5 */
 		(yyval.pval) = npval2(PV_MACRO_CALL, &amp;(yylsp[-4]), &amp;(yylsp[0]));
@@ -2714,20 +2690,20 @@
 		(yyval.pval)-&gt;u2.arglist = (yyvsp[-1].pval);;}
     break;
 
-  case 110:
-#line 637 &quot;ael.y&quot;
+  case 111:
+#line 562 &quot;ael.y&quot;
     {
 		(yyval.pval)= npval2(PV_MACRO_CALL, &amp;(yylsp[-2]), &amp;(yylsp[0]));
 		(yyval.pval)-&gt;u1.str = (yyvsp[-2].str); ;}
     break;
 
-  case 111:
-#line 642 &quot;ael.y&quot;
+  case 112:
+#line 567 &quot;ael.y&quot;
     {reset_argcount(parseio-&gt;scanner);;}
     break;
 
-  case 112:
-#line 642 &quot;ael.y&quot;
+  case 113:
+#line 567 &quot;ael.y&quot;
     {
 		if (strcasecmp((yyvsp[-2].str),&quot;goto&quot;) == 0) {
 			(yyval.pval)= npval2(PV_GOTO, &amp;(yylsp[-2]), &amp;(yylsp[0]));
@@ -2738,171 +2714,167 @@
 		(yyval.pval)-&gt;u1.str = (yyvsp[-2].str); ;}
     break;
 
-  case 113:
-#line 652 &quot;ael.y&quot;
-    {(yyval.pval) = (yyvsp[-2].pval);
+  case 114:
+#line 577 &quot;ael.y&quot;
+    {
+		(yyval.pval) = update_last((yyvsp[-2].pval), &amp;(yylsp[0]));
  		if( (yyval.pval)-&gt;type == PV_GOTO )
 			(yyval.pval)-&gt;u1.list = (yyvsp[-1].pval);
 	 	else
 			(yyval.pval)-&gt;u2.arglist = (yyvsp[-1].pval);
- 		(yyval.pval)-&gt;endline = (yylsp[0]).last_line; (yyval.pval)-&gt;endcol = (yylsp[0]).last_column;;}
+	;}
     break;
 
-  case 114:
-#line 658 &quot;ael.y&quot;
-    {(yyval.pval)=(yyvsp[-1].pval);(yyval.pval)-&gt;endline = (yylsp[0]).last_line; (yyval.pval)-&gt;endcol = (yylsp[0]).last_column;;}
-    break;
-
   case 115:
-#line 661 &quot;ael.y&quot;
-    { (yyval.str) = (yyvsp[0].str) ;}
+#line 584 &quot;ael.y&quot;
+    { (yyval.pval) = update_last((yyvsp[-1].pval), &amp;(yylsp[0])); ;}
     break;
 
   case 116:
-#line 662 &quot;ael.y&quot;
-    { (yyval.str) = strdup(&quot;&quot;); ;}
+#line 587 &quot;ael.y&quot;
+    { (yyval.str) = (yyvsp[0].str) ;}
     break;
 
   case 117:
-#line 665 &quot;ael.y&quot;
-    { 
-		(yyval.pval)= npval2(PV_WORD, &amp;(yylsp[0]), &amp;(yylsp[0]));
-		(yyval.pval)-&gt;u1.str = (yyvsp[0].str);;}
+#line 588 &quot;ael.y&quot;
+    { (yyval.str) = strdup(&quot;&quot;); ;}
     break;
 
   case 118:
-#line 668 &quot;ael.y&quot;
+#line 591 &quot;ael.y&quot;
+    { (yyval.pval) = nword((yyvsp[0].str), &amp;(yylsp[0])); ;}
+    break;
+
+  case 119:
+#line 592 &quot;ael.y&quot;
     {
 		(yyval.pval)= npval(PV_WORD,0/*@1.first_line*/,0/*@1.last_line*/,0/* @1.first_column*/, 0/*@1.last_column*/);
 		(yyval.pval)-&gt;u1.str = strdup(&quot;&quot;); ;}
     break;
 
-  case 119:
-#line 671 &quot;ael.y&quot;
+  case 120:
+#line 595 &quot;ael.y&quot;
     {
-		pval *z = npval2(PV_WORD, &amp;(yylsp[0]), &amp;(yylsp[0]));
+		pval *z = nword((yyvsp[0].str), &amp;(yylsp[0]));
 		(yyval.pval) = (yyvsp[-2].pval);
-		linku1((yyvsp[-2].pval),z);
-		z-&gt;u1.str = (yyvsp[0].str);;}
+		linku1((yyvsp[-2].pval),z); ;}
     break;
 
-  case 120:
-#line 685 &quot;ael.y&quot;
+  case 121:
+#line 601 &quot;ael.y&quot;
     {(yyval.pval)=(yyvsp[0].pval);;}
     break;
 
-  case 121:
-#line 686 &quot;ael.y&quot;
+  case 122:
+#line 602 &quot;ael.y&quot;
     { if ( (yyvsp[-1].pval) &amp;&amp; (yyvsp[0].pval) ) {(yyval.pval)=(yyvsp[-1].pval); linku1((yyval.pval),(yyvsp[0].pval));}
 						 else if ( (yyvsp[-1].pval) ) {(yyval.pval)=(yyvsp[-1].pval);}
 						 else if ( (yyvsp[0].pval) ) {(yyval.pval)=(yyvsp[0].pval);} ;}
     break;
 
-  case 122:
-#line 691 &quot;ael.y&quot;
+  case 123:
+#line 607 &quot;ael.y&quot;
     {
 		(yyval.pval) = npval2(PV_CASE, &amp;(yylsp[-3]), &amp;(yylsp[-1])); /* XXX 3 or 4 ? */
 		(yyval.pval)-&gt;u1.str = (yyvsp[-2].str);
 		(yyval.pval)-&gt;u2.statements = (yyvsp[0].pval);;}
     break;
 
-  case 123:
-#line 695 &quot;ael.y&quot;
+  case 124:
+#line 611 &quot;ael.y&quot;
     {
 		(yyval.pval) = npval2(PV_DEFAULT, &amp;(yylsp[-2]), &amp;(yylsp[0]));
 		(yyval.pval)-&gt;u1.str = NULL;
 		(yyval.pval)-&gt;u2.statements = (yyvsp[0].pval);;}
     break;
 
-  case 124:
-#line 699 &quot;ael.y&quot;
+  case 125:
+#line 615 &quot;ael.y&quot;
     {
 		(yyval.pval) = npval2(PV_PATTERN, &amp;(yylsp[-3]), &amp;(yylsp[0])); /* <A HREF="https://lists.berlios.de/mailman/listinfo/solid-pbx-svn">XXX at 3</A> or @4 ? */
 		(yyval.pval)-&gt;u1.str = (yyvsp[-2].str);
 		(yyval.pval)-&gt;u2.statements = (yyvsp[0].pval);;}
     break;
 
-  case 125:
-#line 703 &quot;ael.y&quot;
+  case 126:
+#line 619 &quot;ael.y&quot;
     {
 		(yyval.pval) = npval2(PV_CASE, &amp;(yylsp[-2]), &amp;(yylsp[0]));
 		(yyval.pval)-&gt;u1.str = (yyvsp[-1].str);;}
     break;
 
-  case 126:
-#line 706 &quot;ael.y&quot;
+  case 127:
+#line 622 &quot;ael.y&quot;
     {
 		(yyval.pval) = npval2(PV_DEFAULT, &amp;(yylsp[-1]), &amp;(yylsp[0]));
 		(yyval.pval)-&gt;u1.str = NULL;;}
     break;
 
-  case 127:
-#line 709 &quot;ael.y&quot;
+  case 128:
+#line 625 &quot;ael.y&quot;
     {
 		(yyval.pval) = npval2(PV_PATTERN, &amp;(yylsp[-2]), &amp;(yylsp[0]));
 		(yyval.pval)-&gt;u1.str = (yyvsp[-1].str);;}
     break;
 
-  case 128:
-#line 714 &quot;ael.y&quot;
+  case 129:
+#line 630 &quot;ael.y&quot;
     {(yyval.pval) = (yyvsp[0].pval);;}
     break;
 
-  case 129:
-#line 715 &quot;ael.y&quot;
+  case 130:
+#line 631 &quot;ael.y&quot;
     { if ( (yyvsp[-1].pval) &amp;&amp; (yyvsp[0].pval) ) {(yyval.pval)=(yyvsp[-1].pval); linku1((yyval.pval),(yyvsp[0].pval));}
 						 else if ( (yyvsp[-1].pval) ) {(yyval.pval)=(yyvsp[-1].pval);}
 						 else if ( (yyvsp[0].pval) ) {(yyval.pval)=(yyvsp[0].pval);} ;}
     break;
 
-  case 130:
-#line 720 &quot;ael.y&quot;
+  case 131:
+#line 636 &quot;ael.y&quot;
     {(yyval.pval)=(yyvsp[0].pval);;}
     break;
 
-  case 131:
-#line 721 &quot;ael.y&quot;
+  case 132:
+#line 637 &quot;ael.y&quot;
     {
 		(yyval.pval) = npval2(PV_CATCH, &amp;(yylsp[-4]), &amp;(yylsp[0]));
 		(yyval.pval)-&gt;u1.str = (yyvsp[-3].str);
 		(yyval.pval)-&gt;u2.statements = (yyvsp[-1].pval);;}
     break;
 
-  case 132:
-#line 727 &quot;ael.y&quot;
-    {
-		(yyval.pval) = npval2(PV_SWITCHES, &amp;(yylsp[-3]), &amp;(yylsp[0]));
-		(yyval.pval)-&gt;u1.list = (yyvsp[-1].pval); ;}
-    break;
-
   case 133:
-#line 730 &quot;ael.y&quot;
+#line 643 &quot;ael.y&quot;
     {
-		(yyval.pval) = npval2(PV_SWITCHES, &amp;(yylsp[-2]), &amp;(yylsp[0])); ;}
+		(yyval.pval) = npval2(PV_SWITCHES, &amp;(yylsp[-1]), &amp;(yylsp[0]));
+		(yyval.pval)-&gt;u1.list = (yyvsp[0].pval); ;}
     break;
 
   case 134:
-#line 734 &quot;ael.y&quot;
+#line 648 &quot;ael.y&quot;
     {
-		(yyval.pval) = npval2(PV_ESWITCHES, &amp;(yylsp[-3]), &amp;(yylsp[0]));
-		(yyval.pval)-&gt;u1.list = (yyvsp[-1].pval); ;}
+		(yyval.pval) = npval2(PV_ESWITCHES, &amp;(yylsp[-1]), &amp;(yylsp[0]));
+		(yyval.pval)-&gt;u1.list = (yyvsp[0].pval); ;}
     break;
 
   case 135:
-#line 737 &quot;ael.y&quot;
-    { /* empty switch list OK */
-		(yyval.pval) = npval2(PV_ESWITCHES, &amp;(yylsp[-2]), &amp;(yylsp[0])); ;}
+#line 653 &quot;ael.y&quot;
+    { (yyval.pval) = (yyvsp[-1].pval); ;}
     break;
 
   case 136:
-#line 741 &quot;ael.y&quot;
+#line 654 &quot;ael.y&quot;
+    { (yyval.pval) = NULL; ;}
+    break;
+
+  case 137:
+#line 657 &quot;ael.y&quot;
     {
 		(yyval.pval) = npval2(PV_WORD, &amp;(yylsp[-1]), &amp;(yylsp[0]));
 		(yyval.pval)-&gt;u1.str = (yyvsp[-1].str);;}
     break;
 
-  case 137:
-#line 744 &quot;ael.y&quot;
+  case 138:
+#line 660 &quot;ael.y&quot;
     {
 		pval *z = npval2(PV_WORD, &amp;(yylsp[-1]), &amp;(yylsp[0]));
 		z-&gt;u1.str = (yyvsp[-1].str);
@@ -2910,20 +2882,20 @@
 		linku1((yyval.pval),z); ;}
     break;
 
-  case 138:
-#line 749 &quot;ael.y&quot;
+  case 139:
+#line 665 &quot;ael.y&quot;
     {(yyval.pval)=(yyvsp[-1].pval);;}
     break;
 
-  case 139:
-#line 752 &quot;ael.y&quot;
+  case 140:
+#line 668 &quot;ael.y&quot;
     {
 		(yyval.pval) = npval2(PV_WORD, &amp;(yylsp[-1]), &amp;(yylsp[0]));
 		(yyval.pval)-&gt;u1.str = (yyvsp[-1].str);;}
     break;
 
-  case 140:
-#line 756 &quot;ael.y&quot;
+  case 141:
+#line 672 &quot;ael.y&quot;
     {
 		(yyval.pval) = npval2(PV_WORD, &amp;(yylsp[-13]), &amp;(yylsp[-12]));
 		(yyval.pval)-&gt;u1.str = (yyvsp[-13].str);
@@ -2932,35 +2904,28 @@
 		free((yyvsp[-11].str));
 		free((yyvsp[-9].str));
 		free((yyvsp[-7].str));
-		(yyval.pval)-&gt;u2.arglist-&gt;next = npval2(PV_WORD, &amp;(yylsp[-5]), &amp;(yylsp[-5]));
-		(yyval.pval)-&gt;u2.arglist-&gt;next-&gt;u1.str = (yyvsp[-5].str);
-		(yyval.pval)-&gt;u2.arglist-&gt;next-&gt;next = npval2(PV_WORD, &amp;(yylsp[-3]), &amp;(yylsp[-3]));
-		(yyval.pval)-&gt;u2.arglist-&gt;next-&gt;next-&gt;u1.str = (yyvsp[-3].str);
-		(yyval.pval)-&gt;u2.arglist-&gt;next-&gt;next-&gt;next = npval2(PV_WORD, &amp;(yylsp[-1]), &amp;(yylsp[-1]));
-		(yyval.pval)-&gt;u2.arglist-&gt;next-&gt;next-&gt;next-&gt;u1.str = (yyvsp[-1].str);
+		(yyval.pval)-&gt;u2.arglist-&gt;next = nword((yyvsp[-5].str), &amp;(yylsp[-5]));
+		(yyval.pval)-&gt;u2.arglist-&gt;next-&gt;next = nword((yyvsp[-3].str), &amp;(yylsp[-3]));
+		(yyval.pval)-&gt;u2.arglist-&gt;next-&gt;next-&gt;next = nword((yyvsp[-1].str), &amp;(yylsp[-1]));
 		prev_word=0;
 	;}
     break;
 
-  case 141:
-#line 772 &quot;ael.y&quot;
+  case 142:
+#line 685 &quot;ael.y&quot;
     {
 		(yyval.pval) = npval2(PV_WORD, &amp;(yylsp[-9]), &amp;(yylsp[-8]));
 		(yyval.pval)-&gt;u1.str = (yyvsp[-9].str);
-		(yyval.pval)-&gt;u2.arglist = npval2(PV_WORD, &amp;(yylsp[-7]), &amp;(yylsp[-7]));
-		(yyval.pval)-&gt;u2.arglist-&gt;u1.str = (yyvsp[-7].str);
-		(yyval.pval)-&gt;u2.arglist-&gt;next = npval2(PV_WORD, &amp;(yylsp[-5]), &amp;(yylsp[-5]));
-		(yyval.pval)-&gt;u2.arglist-&gt;next-&gt;u1.str = (yyvsp[-5].str);
-		(yyval.pval)-&gt;u2.arglist-&gt;next-&gt;next = npval2(PV_WORD, &amp;(yylsp[-3]), &amp;(yylsp[-3]));
-		(yyval.pval)-&gt;u2.arglist-&gt;next-&gt;next-&gt;u1.str = (yyvsp[-3].str);
-		(yyval.pval)-&gt;u2.arglist-&gt;next-&gt;next-&gt;next = npval2(PV_WORD, &amp;(yylsp[-1]), &amp;(yylsp[-1]));
-		(yyval.pval)-&gt;u2.arglist-&gt;next-&gt;next-&gt;next-&gt;u1.str = (yyvsp[-1].str);
+		(yyval.pval)-&gt;u2.arglist = nword((yyvsp[-7].str), &amp;(yylsp[-7]));
+		(yyval.pval)-&gt;u2.arglist-&gt;next = nword((yyvsp[-5].str), &amp;(yylsp[-5]));
+		(yyval.pval)-&gt;u2.arglist-&gt;next-&gt;next = nword((yyvsp[-3].str), &amp;(yylsp[-3]));
+		(yyval.pval)-&gt;u2.arglist-&gt;next-&gt;next-&gt;next = nword((yyvsp[-1].str), &amp;(yylsp[-1]));
 		prev_word=0;
 	;}
     break;
 
-  case 142:
-#line 785 &quot;ael.y&quot;
+  case 143:
+#line 694 &quot;ael.y&quot;
     {
 		pval *z = npval2(PV_WORD, &amp;(yylsp[-1]), &amp;(yylsp[0])); /* XXX don't we need @<A HREF="https://lists.berlios.de/mailman/listinfo/solid-pbx-svn">1- at 3</A> ?*/
 		(yyval.pval)=(yyvsp[-2].pval);
@@ -2968,8 +2933,8 @@
 		linku1((yyval.pval),z); ;}
     break;
 
-  case 143:
-#line 791 &quot;ael.y&quot;
+  case 144:
+#line 700 &quot;ael.y&quot;
     {
 		pval *z = npval2(PV_WORD, &amp;(yylsp[-13]), &amp;(yylsp[-12]));
 		(yyval.pval)=(yyvsp[-14].pval); z-&gt;u1.str = (yyvsp[-13].str);
@@ -2979,59 +2944,53 @@
 		free((yyvsp[-11].str));
 		free((yyvsp[-9].str));
 		free((yyvsp[-7].str));
-		z-&gt;u2.arglist-&gt;next = npval2(PV_WORD, &amp;(yylsp[-5]), &amp;(yylsp[-5]));
-		z-&gt;u2.arglist-&gt;next-&gt;u1.str = (yyvsp[-5].str);
-		z-&gt;u2.arglist-&gt;next-&gt;next = npval2(PV_WORD, &amp;(yylsp[-3]), &amp;(yylsp[-3]));
-		z-&gt;u2.arglist-&gt;next-&gt;next-&gt;u1.str = (yyvsp[-3].str);
-		z-&gt;u2.arglist-&gt;next-&gt;next-&gt;next = npval2(PV_WORD, &amp;(yylsp[-1]), &amp;(yylsp[-1]));
-		z-&gt;u2.arglist-&gt;next-&gt;next-&gt;next-&gt;u1.str = (yyvsp[-1].str);
+		z-&gt;u2.arglist-&gt;next = nword((yyvsp[-5].str), &amp;(yylsp[-5]));
+		z-&gt;u2.arglist-&gt;next-&gt;next = nword((yyvsp[-3].str), &amp;(yylsp[-3]));
+		z-&gt;u2.arglist-&gt;next-&gt;next-&gt;next = nword((yyvsp[-1].str), &amp;(yylsp[-1]));
 		prev_word=0;
 	;}
     break;
 
-  case 144:
-#line 808 &quot;ael.y&quot;
+  case 145:
+#line 714 &quot;ael.y&quot;
     {
 		pval *z = npval2(PV_WORD, &amp;(yylsp[-9]), &amp;(yylsp[-8]));
 		(yyval.pval)=(yyvsp[-10].pval);
 		linku1((yyval.pval),z);
-		(yyval.pval)-&gt;u2.arglist-&gt;u1.str = (yyvsp[-7].str);
+		(yyval.pval)-&gt;u2.arglist-&gt;u1.str = (yyvsp[-7].str);			/* XXX maybe too early ? */
 		z-&gt;u1.str = (yyvsp[-9].str);
 		z-&gt;u2.arglist = npval2(PV_WORD, &amp;(yylsp[-7]), &amp;(yylsp[-7]));	/* XXX is this correct ? */
-		z-&gt;u2.arglist-&gt;next = npval2(PV_WORD, &amp;(yylsp[-5]), &amp;(yylsp[-5]));
-		z-&gt;u2.arglist-&gt;next-&gt;u1.str = (yyvsp[-5].str);
-		z-&gt;u2.arglist-&gt;next-&gt;next = npval2(PV_WORD, &amp;(yylsp[-3]), &amp;(yylsp[-3]));
-		z-&gt;u2.arglist-&gt;next-&gt;next-&gt;u1.str = (yyvsp[-3].str);
-		z-&gt;u2.arglist-&gt;next-&gt;next-&gt;next = npval2(PV_WORD, &amp;(yylsp[-1]), &amp;(yylsp[-1]));
-		z-&gt;u2.arglist-&gt;next-&gt;next-&gt;next-&gt;u1.str = (yyvsp[-1].str);
+		z-&gt;u2.arglist-&gt;next = nword((yyvsp[-5].str), &amp;(yylsp[-5]));
+		z-&gt;u2.arglist-&gt;next-&gt;next = nword((yyvsp[-3].str), &amp;(yylsp[-3]));
+		z-&gt;u2.arglist-&gt;next-&gt;next-&gt;next = nword((yyvsp[-1].str), &amp;(yylsp[-1]));
 		prev_word=0;
 	;}
     break;
 
-  case 145:
-#line 823 &quot;ael.y&quot;
+  case 146:
+#line 726 &quot;ael.y&quot;
     {(yyval.pval)=(yyvsp[-1].pval);;}
     break;
 
-  case 146:
-#line 826 &quot;ael.y&quot;
+  case 147:
+#line 729 &quot;ael.y&quot;
     { (yyval.str) = (yyvsp[0].str);;}
     break;
 
-  case 147:
-#line 827 &quot;ael.y&quot;
+  case 148:
+#line 730 &quot;ael.y&quot;
     {(yyval.str)=strdup(&quot;default&quot;);;}
     break;
 
-  case 148:
-#line 830 &quot;ael.y&quot;
+  case 149:
+#line 733 &quot;ael.y&quot;
     {
 		(yyval.pval) = npval2(PV_INCLUDES, &amp;(yylsp[-3]), &amp;(yylsp[0]));
 		(yyval.pval)-&gt;u1.list = (yyvsp[-1].pval);;}
     break;
 
-  case 149:
-#line 833 &quot;ael.y&quot;
+  case 150:
+#line 736 &quot;ael.y&quot;
     {
 		(yyval.pval) = npval2(PV_INCLUDES, &amp;(yylsp[-2]), &amp;(yylsp[0]));;}
     break;
@@ -3041,7 +3000,7 @@
     }
 
 /* Line 1126 of yacc.c.  */
-#line 3045 &quot;ael.tab.c&quot;
+#line 3004 &quot;ael.tab.c&quot;
 
   yyvsp -= yylen;
   yyssp -= yylen;
@@ -3316,7 +3275,7 @@
 }
 
 
-#line 838 &quot;ael.y&quot;
+#line 741 &quot;ael.y&quot;
 
 
 static char *token_equivs1[] =
@@ -3475,6 +3434,22 @@
 			first-&gt;first_column, last-&gt;last_column);
 }
 
+static struct pval *update_last(pval *obj, YYLTYPE *last)
+{
+	obj-&gt;endline = last-&gt;last_line;
+	obj-&gt;endcol = last-&gt;last_column;
+	return obj;
+}
+
+/* frontend for npval to create a PV_WORD string from the given token */
+static pval *nword(char *string, YYLTYPE *pos)
+{
+	pval *p = npval2(PV_WORD, pos, pos);
+	if (p)
+		p-&gt;u1.str = string;
+	return p;
+}
+
 /* append second element to the list in the first one */
 static pval * linku1(pval *head, pval *tail)
 {

Modified: trunk/pbx/ael/ael.tab.h
===================================================================
--- trunk/pbx/ael/ael.tab.h	2006-04-30 14:54:24 UTC (rev 14)
+++ trunk/pbx/ael/ael.tab.h	2006-04-30 15:42:56 UTC (rev 15)
@@ -115,13 +115,14 @@
 
 
 #if ! defined (YYSTYPE) &amp;&amp; ! defined (YYSTYPE_IS_DECLARED)
-#line 53 &quot;ael.y&quot;
+#line 49 &quot;ael.y&quot;
 typedef union YYSTYPE {
-	char *str;
-	struct pval *pval;
+	int	intval;		/* integer value, typically flags */
+	char	*str;		/* strings */
+	struct pval *pval;	/* full objects */
 } YYSTYPE;
 /* Line 1447 of yacc.c.  */
-#line 125 &quot;ael.tab.h&quot;
+#line 126 &quot;ael.tab.h&quot;
 # define yystype YYSTYPE /* obsolescent; will be withdrawn */
 # define YYSTYPE_IS_DECLARED 1
 # define YYSTYPE_IS_TRIVIAL 1

Modified: trunk/pbx/ael/ael.y
===================================================================
--- trunk/pbx/ael/ael.y	2006-04-30 14:54:24 UTC (rev 14)
+++ trunk/pbx/ael/ael.y	2006-04-30 15:42:56 UTC (rev 15)
@@ -28,10 +28,6 @@
 #include &quot;asterisk/utils.h&quot;		/* ast_calloc() */
 #include &quot;asterisk/ael_structs.h&quot;
 
-/* create a new object with start-end marker */
-static pval *npval(pvaltype type, int first_line, int last_line,
-	int first_column, int last_column);
-
 static pval * linku1(pval *head, pval *tail);
 
 void reset_parencount(yyscan_t yyscanner);
@@ -51,8 +47,9 @@
 
 
 %union {
-	char *str;
-	struct pval *pval;
+	int	intval;		/* integer value, typically flags */
+	char	*str;		/* strings */
+	struct pval *pval;	/* full objects */
 }
 
 %{
@@ -60,10 +57,20 @@
 void yyerror(YYLTYPE *locp, struct parse_io *parseio, char const *s);
 int ael_yylex (YYSTYPE * yylval_param, YYLTYPE * yylloc_param , void * yyscanner);
 
+/* create a new object with start-end marker */
+static pval *npval(pvaltype type, int first_line, int last_line,
+	int first_column, int last_column);
+
 /* create a new object with start-end marker, simplified interface.
  * Must be declared here because YYLTYPE is not known before
  */
 static pval *npval2(pvaltype type, YYLTYPE *first, YYLTYPE *last);
+
+/* another frontend for npval, this time for a string */
+static pval *nword(char *string, YYLTYPE *pos);
+
+/* update end position of an object, return the object */
+static pval *update_last(pval *, YYLTYPE *);
 %}
 
 
@@ -113,6 +120,8 @@
 %type &lt;pval&gt;file
 /* XXX lr changes */
 %type &lt;pval&gt;opt_else
+%type &lt;pval&gt;elements_block
+%type &lt;pval&gt;switchlist_block
 
 %type &lt;str&gt;opt_word
 %type &lt;str&gt;word_or_default
@@ -122,6 +131,8 @@
 %type &lt;str&gt;word3_list
 %type &lt;str&gt;includedname
 
+%type &lt;intval&gt;opt_abstract
+
 /*
  * OPTIONS
  */
@@ -156,6 +167,7 @@
 		ignorepat element elements arglist global_statement
 		global_statements globals macro context object objects
 		opt_else
+		elements_block switchlist_block
 
 %destructor { free($$);}  word word_list goto_word word3_list includedname opt_word word_or_default
 
@@ -190,42 +202,18 @@
 	| KW_DEFAULT { $$ = strdup(&quot;default&quot;); }
 	;
 
-context : KW_CONTEXT word_or_default LC elements RC {
-		$$ = npval2(PV_CONTEXT, &amp;@1, &amp;@5);
-		$$-&gt;u1.str = $2;
-		$$-&gt;u2.statements = $4; }
-	| KW_CONTEXT word_or_default LC RC /* empty context OK */ {
+context : opt_abstract KW_CONTEXT word_or_default elements_block {
 		$$ = npval2(PV_CONTEXT, &amp;@1, &amp;@4);
-		$$-&gt;u1.str = $2; }
-	| KW_ABSTRACT KW_CONTEXT word_or_default LC elements RC {
-		$$ = npval2(PV_CONTEXT, &amp;@1, &amp;@6);
 		$$-&gt;u1.str = $3;
-		$$-&gt;u2.statements = $5;
-		$$-&gt;u3.abstract = 1; }
-	| KW_ABSTRACT KW_CONTEXT word_or_default LC RC /* empty context OK */ {
-		$$ = npval2(PV_CONTEXT, &amp;@1, &amp;@5);
-		$$-&gt;u1.str = $3;
-		$$-&gt;u3.abstract = 1; }
-/*
-	| KW_CONTEXT KW_DEFAULT LC elements RC {
-		$$ = npval2(PV_CONTEXT, &amp;@1, &amp;@5);
-		$$-&gt;u1.str = strdup(&quot;default&quot;);
-		$$-&gt;u2.statements = $4; }
-	| KW_CONTEXT KW_DEFAULT LC RC {
-		$$ = npval2(PV_CONTEXT, &amp;@1, &amp;@4);
-		$$-&gt;u1.str = strdup(&quot;default&quot;); }
-	| KW_ABSTRACT KW_CONTEXT KW_DEFAULT LC elements RC  {
-		$$ = npval2(PV_CONTEXT, &amp;@1, &amp;@6);
-		$$-&gt;u1.str = strdup(&quot;default&quot;);
-		$$-&gt;u2.statements = $5;
-		$$-&gt;u3.abstract = 1; }
-	| KW_ABSTRACT KW_CONTEXT KW_DEFAULT LC RC {
-		$$ = npval2(PV_CONTEXT, &amp;@1, &amp;@5);
-		$$-&gt;u1.str = strdup(&quot;default&quot;);
-		$$-&gt;u3.abstract = 1; }
-*/
+		$$-&gt;u2.statements = $4;
+		$$-&gt;u3.abstract = $1; }
 	;
 
+/* optional &quot;abstract&quot; keyword */
+opt_abstract: KW_ABSTRACT { $$ = 1; }
+	| /* nothing */ { $$ = 0; }
+	;
+
 macro : KW_MACRO word LP arglist RP LC macro_statements RC {
 		$$ = npval2(PV_MACRO, &amp;@1, &amp;@8);
 		$$-&gt;u1.str = $2; $$-&gt;u2.arglist = $4; $$-&gt;u3.macro_statements = $7; }
@@ -259,9 +247,7 @@
 		$$-&gt;u2.val = $4; }
 	;
 
-arglist : word {
-		$$= npval2(PV_WORD, &amp;@1, &amp;@1);
-		$$-&gt;u1.str = $1; }
+arglist : word { $$= nword($1, &amp;@1); }
 	| arglist COMMA word {
 		pval *z = npval2(PV_WORD, &amp;@1, &amp;@3);
 		z-&gt;u1.str = $3;
@@ -269,6 +255,10 @@
 	| arglist error {$$=$1;}
 	;
 
+elements_block : LC RC	{ $$ = NULL; }
+	| LC elements RC { $$ = $2; }
+	;
+
 elements : element { $$=$1;}
 	| error {$$=0;}
 	| elements element { if ( $1 &amp;&amp; $2 ) {$$=$1; linku1($$,$2);}
@@ -343,24 +333,17 @@
 		free($3);
 		free($5);
 		free($7);
-		$$-&gt;u1.list-&gt;next = npval2(PV_WORD, &amp;@9, &amp;@9);
-		$$-&gt;u1.list-&gt;next-&gt;u1.str = $9;
-		$$-&gt;u1.list-&gt;next-&gt;next = npval2(PV_WORD, &amp;@11, &amp;@11);
-		$$-&gt;u1.list-&gt;next-&gt;next-&gt;u1.str = $11;
-		$$-&gt;u1.list-&gt;next-&gt;next-&gt;next = npval2(PV_WORD, &amp;@13, &amp;@13);
-		$$-&gt;u1.list-&gt;next-&gt;next-&gt;next-&gt;u1.str = $13;
+		$$-&gt;u1.list-&gt;next = nword($9, &amp;@9);
+		$$-&gt;u1.list-&gt;next-&gt;next = nword($11, &amp;@11);
+		$$-&gt;u1.list-&gt;next-&gt;next-&gt;next = nword($13, &amp;@13);
 		prev_word = 0;
 	}
 	| KW_IFTIME LP word BAR word3_list BAR word3_list BAR word3_list RP {
 		$$ = npval2(PV_IFTIME, &amp;@1, &amp;@5); /* XXX @5 or greater ? */
-		$$-&gt;u1.list = npval2(PV_WORD, &amp;@3, &amp;@3);
-		$$-&gt;u1.list-&gt;u1.str = $3;
-		$$-&gt;u1.list-&gt;next = npval2(PV_WORD, &amp;@5, &amp;@5);
-		$$-&gt;u1.list-&gt;next-&gt;u1.str = $5;
-		$$-&gt;u1.list-&gt;next-&gt;next = npval2(PV_WORD, &amp;@7, &amp;@7);
-		$$-&gt;u1.list-&gt;next-&gt;next-&gt;u1.str = $7;
-		$$-&gt;u1.list-&gt;next-&gt;next-&gt;next = npval2(PV_WORD, &amp;@9, &amp;@9);
-		$$-&gt;u1.list-&gt;next-&gt;next-&gt;next-&gt;u1.str = $9;
+		$$-&gt;u1.list = nword($3, &amp;@3);
+		$$-&gt;u1.list-&gt;next = nword($5, &amp;@5);
+		$$-&gt;u1.list-&gt;next-&gt;next = nword($7, &amp;@7);
+		$$-&gt;u1.list-&gt;next-&gt;next-&gt;next = nword($9, &amp;@9);
 		prev_word = 0;
 	}
 
@@ -441,22 +424,14 @@
 		$$-&gt;u1.str = $4;
 		$$-&gt;u2.statements = $6; }
 	| switch_head RC /* empty list OK */ {
-		$$=$1;
-		$$-&gt;endline = @2.last_line;
-		$$-&gt;endcol = @2.last_column;}
+		$$ = update_last($1, &amp;@2); }
 	| switch_head case_statements RC {
-		$$=$1;
-		$$-&gt;u2.statements = $2;
-		$$-&gt;endline = @3.last_line;
-		$$-&gt;endcol = @3.last_column;}
+		$$ = update_last($1, &amp;@3);
+		$$-&gt;u2.statements = $2;}
 	| AMPER macro_call SEMI {
-		$$ = $2;
-		$$-&gt;endline = @2.last_line;
-		$$-&gt;endcol = @2.last_column;}
+		$$ = update_last($2, &amp;@2); }
 	| application_call SEMI {
-		$$ = $1;
-		$$-&gt;endline = @2.last_line;
-		$$-&gt;endcol = @2.last_column;}
+		$$ = update_last($1, &amp;@2); }
 	| word SEMI {
 		$$= npval2(PV_APPLICATION_CALL, &amp;@1, &amp;@2);
 		$$-&gt;u1.str = $1;}
@@ -497,47 +472,17 @@
 	| KW_RETURN SEMI { $$ = npval2(PV_RETURN, &amp;@1, &amp;@2); }
 	| KW_CONTINUE SEMI { $$ = npval2(PV_CONTINUE, &amp;@1, &amp;@2); }
 	| random_head statement opt_else {
-		$$=$1;
+		$$ = update_last($1, &amp;@2); /* XXX probably @3... */
 		$$-&gt;u2.statements = $2;
-		$$-&gt;endline = @2.last_line;
-		$$-&gt;u3.else_statements = $3;
-		$$-&gt;endcol = @2.last_column;}
-/*
-	| random_head statement KW_ELSE statement {
-		$$=$1;
-		$$-&gt;u2.statements = $2;
-		$$-&gt;endline = @2.last_line;
-		$$-&gt;endcol = @2.last_column;
-		$$-&gt;u3.else_statements = $4;}
-*/
+		$$-&gt;u3.else_statements = $3;}
 	| if_head statement opt_else {
-		$$=$1;
+		$$ = update_last($1, &amp;@2); /* XXX probably @3... */
 		$$-&gt;u2.statements = $2;
-		$$-&gt;endline = @2.last_line;
-		$$-&gt;u3.else_statements = $3;
-		$$-&gt;endcol = @2.last_column;}
-/*
-	| if_head statement KW_ELSE statement {
-		$$=$1;
-		$$-&gt;u2.statements = $2;
-		$$-&gt;endline = @2.last_line;
-		$$-&gt;endcol = @2.last_column;
-	$$-&gt;u3.else_statements = $4;}
-*/
+		$$-&gt;u3.else_statements = $3;}
 	| iftime_head statement opt_else {
-		$$=$1;
+		$$ = update_last($1, &amp;@2); /* XXX probably @3... */
 		$$-&gt;u2.statements = $2;
-		$$-&gt;endline = @2.last_line;
-		$$-&gt;u3.else_statements = $3;
-		$$-&gt;endcol = @2.last_column;}
-/*
-	| iftime_head statement KW_ELSE statement {
-		$$=$1;
-		$$-&gt;u2.statements = $2;
-		$$-&gt;endline = @2.last_line;
-		$$-&gt;endcol = @2.last_column;
-		$$-&gt;u3.else_statements = $4;}
-*/
+		$$-&gt;u3.else_statements = $3;}
 	| SEMI { $$=0; }
 	;
 
@@ -547,61 +492,41 @@
 /* XXX unused */
 bar_or_comma: BAR | COMMA ;
 
-target : goto_word { $$ = npval2(PV_WORD, &amp;@1, &amp;@1);
-		$$-&gt;u1.str = $1;}
+target : goto_word { $$ = nword($1, &amp;@1); }
 	| goto_word BAR goto_word {
-		$$ = npval2(PV_WORD, &amp;@1, &amp;@1);
-		$$-&gt;u1.str = $1;
-		$$-&gt;next = npval2(PV_WORD, &amp;@3, &amp;@3);
-		$$-&gt;next-&gt;u1.str = $3;}
+		$$ = nword($1, &amp;@1);
+		$$-&gt;next = nword($3, &amp;@3); }
 	| goto_word COMMA goto_word {
-		$$ = npval2(PV_WORD, &amp;@1, &amp;@1);
-		$$-&gt;u1.str = $1;
-		$$-&gt;next = npval2(PV_WORD, &amp;@3, &amp;@3);
-		$$-&gt;next-&gt;u1.str = $3;}
+		$$ = nword($1, &amp;@1);
+		$$-&gt;next = nword($3, &amp;@3); }
 	| goto_word BAR goto_word BAR goto_word {
-		$$ = npval2(PV_WORD, &amp;@1, &amp;@1);
-		$$-&gt;u1.str = $1;
-		$$-&gt;next = npval2(PV_WORD, &amp;@3, &amp;@3);
-		$$-&gt;next-&gt;u1.str = $3;
-		$$-&gt;next-&gt;next = npval2(PV_WORD, &amp;@5, &amp;@5);
-		$$-&gt;next-&gt;next-&gt;u1.str = $5; }
+		$$ = nword($1, &amp;@1);
+		$$-&gt;next = nword($3, &amp;@3);
+		$$-&gt;next-&gt;next = nword($5, &amp;@5); }
 	| goto_word COMMA goto_word COMMA goto_word {
-		$$ = npval2(PV_WORD, &amp;@1, &amp;@1);
-		$$-&gt;u1.str = $1;
-		$$-&gt;next = npval2(PV_WORD, &amp;@3, &amp;@3);
-		$$-&gt;next-&gt;u1.str = $3;
-		$$-&gt;next-&gt;next = npval2(PV_WORD, &amp;@5, &amp;@5);
-		$$-&gt;next-&gt;next-&gt;u1.str = $5; }
+		$$ = nword($1, &amp;@1);
+		$$-&gt;next = nword($3, &amp;@3);
+		$$-&gt;next-&gt;next = nword($5, &amp;@5); }
 	| KW_DEFAULT BAR goto_word BAR goto_word {
-		$$ = npval2(PV_WORD, &amp;@1, &amp;@1);
-		$$-&gt;u1.str = strdup(&quot;default&quot;);
-		$$-&gt;next = npval2(PV_WORD, &amp;@3, &amp;@3);
-		$$-&gt;next-&gt;u1.str = $3;
-		$$-&gt;next-&gt;next = npval2(PV_WORD, &amp;@5, &amp;@5);
-		$$-&gt;next-&gt;next-&gt;u1.str = $5; }
+		$$ = nword(strdup(&quot;default&quot;), &amp;@1);
+		$$-&gt;next = nword($3, &amp;@3);
+		$$-&gt;next-&gt;next = nword($5, &amp;@5); }
 	| KW_DEFAULT COMMA goto_word COMMA goto_word {
-		$$ = npval2(PV_WORD, &amp;@1, &amp;@1);
-		$$-&gt;u1.str = strdup(&quot;default&quot;);
-		$$-&gt;next = npval2(PV_WORD, &amp;@3, &amp;@3);
-		$$-&gt;next-&gt;u1.str = $3;
-		$$-&gt;next-&gt;next = npval2(PV_WORD, &amp;@5, &amp;@5);
-		$$-&gt;next-&gt;next-&gt;u1.str = $5; }
+		$$ = nword(strdup(&quot;default&quot;), &amp;@1);
+		$$-&gt;next = nword($3, &amp;@3);
+		$$-&gt;next-&gt;next = nword($5, &amp;@5); }
 	;
 
+/* XXX please document the form of jumptarget */
 jumptarget : goto_word {
-		$$ = npval2(PV_WORD, &amp;@1, &amp;@1);
-		$$-&gt;u1.str = $1;
-		$$-&gt;next = npval2(PV_WORD, &amp;@1, &amp;@1); /* XXX not really @1 */
-		$$-&gt;next-&gt;u1.str = strdup(&quot;1&quot;);}  /*  jump extension[,priority][@context] */
+		$$ = nword($1, &amp;@1);
+		$$-&gt;next = nword(strdup(&quot;1&quot;), &amp;@1); }  /*  jump extension[,priority][@context] */
 	| goto_word COMMA goto_word {
-		$$ = npval2(PV_WORD, &amp;@1, &amp;@1);
-		$$-&gt;u1.str = $1;
-		$$-&gt;next = npval2(PV_WORD, &amp;@3, &amp;@3);
-		$$-&gt;next-&gt;u1.str = $3;}
+		$$ = nword($1, &amp;@1);
+		$$-&gt;next = nword($3, &amp;@3); }
 	| goto_word COMMA word AT word {
 		$$ = npval2(PV_WORD, &amp;@1, &amp;@1);
-		$$-&gt;u1.str = $5;
+		$$-&gt;u1.str = $5;	/* XXX must check this */
 		$$-&gt;next = npval2(PV_WORD, &amp;@3, &amp;@3);
 		$$-&gt;next-&gt;u1.str = $1;
 		$$-&gt;next-&gt;next = npval2(PV_WORD, &amp;@5, &amp;@5);
@@ -649,37 +574,28 @@
 		$$-&gt;u1.str = $1; }
 	;
 
-application_call : application_call_head eval_arglist RP {$$ = $1;
+application_call : application_call_head eval_arglist RP {
+		$$ = update_last($1, &amp;@3);
  		if( $$-&gt;type == PV_GOTO )
 			$$-&gt;u1.list = $2;
 	 	else
 			$$-&gt;u2.arglist = $2;
- 		$$-&gt;endline = @3.last_line; $$-&gt;endcol = @3.last_column;}
-	| application_call_head RP {$$=$1;$$-&gt;endline = @2.last_line; $$-&gt;endcol = @2.last_column;}
+	}
+	| application_call_head RP { $$ = update_last($1, &amp;@2); }
 	;
 
 opt_word : word { $$ = $1 }
 	| { $$ = strdup(&quot;&quot;); }
 	;
 
-eval_arglist :  word_list { 
-		$$= npval2(PV_WORD, &amp;@1, &amp;@1);
-		$$-&gt;u1.str = $1;}
+eval_arglist :  word_list { $$ = nword($1, &amp;@1); }
 	| /*nothing! */   {
 		$$= npval(PV_WORD,0/*@1.first_line*/,0/*@1.last_line*/,0/* @1.first_column*/, 0/*@1.last_column*/);
 		$$-&gt;u1.str = strdup(&quot;&quot;); }
 	| eval_arglist COMMA  opt_word {
-		pval *z = npval2(PV_WORD, &amp;@3, &amp;@3);
+		pval *z = nword($3, &amp;@3);
 		$$ = $1;
-		linku1($1,z);
-		z-&gt;u1.str = $3;}
-/*
-	| eval_arglist COMMA {
-		pval *z = npval2(PV_WORD, &amp;@2, &amp;@2);
-		$$ = $1;
-		linku1($1,z);
-		z-&gt;u1.str = strdup(&quot;&quot;);}
-*/
+		linku1($1,z); }
 	;
 
 case_statements: case_statement {$$=$1;}
@@ -724,20 +640,20 @@
 		$$-&gt;u2.statements = $4;}
 	;
 
-switches : KW_SWITCHES LC switchlist RC {
-		$$ = npval2(PV_SWITCHES, &amp;@1, &amp;@4);
-		$$-&gt;u1.list = $3; }
-	| KW_SWITCHES LC RC /* empty switch list OK */ {
-		$$ = npval2(PV_SWITCHES, &amp;@1, &amp;@3); }
+switches : KW_SWITCHES switchlist_block {
+		$$ = npval2(PV_SWITCHES, &amp;@1, &amp;@2);
+		$$-&gt;u1.list = $2; }
 	;
 
-eswitches : KW_ESWITCHES LC switchlist RC {
-		$$ = npval2(PV_ESWITCHES, &amp;@1, &amp;@4);
-		$$-&gt;u1.list = $3; }
-	| KW_ESWITCHES LC  RC { /* empty switch list OK */
-		$$ = npval2(PV_ESWITCHES, &amp;@1, &amp;@3); } /* if there's nothing to declare, why include it? */
+eswitches : KW_ESWITCHES switchlist_block {
+		$$ = npval2(PV_ESWITCHES, &amp;@1, &amp;@2);
+		$$-&gt;u1.list = $2; }
 	;
 
+switchlist_block : LC switchlist RC { $$ = $2; }
+	| LC RC { $$ = NULL; }
+	;
+
 switchlist : word SEMI {
 		$$ = npval2(PV_WORD, &amp;@1, &amp;@2);
 		$$-&gt;u1.str = $1;}
@@ -761,25 +677,18 @@
 		free($3);
 		free($5);
 		free($7);
-		$$-&gt;u2.arglist-&gt;next = npval2(PV_WORD, &amp;@9, &amp;@9);
-		$$-&gt;u2.arglist-&gt;next-&gt;u1.str = $9;
-		$$-&gt;u2.arglist-&gt;next-&gt;next = npval2(PV_WORD, &amp;@11, &amp;@11);
-		$$-&gt;u2.arglist-&gt;next-&gt;next-&gt;u1.str = $11;
-		$$-&gt;u2.arglist-&gt;next-&gt;next-&gt;next = npval2(PV_WORD, &amp;@13, &amp;@13);
-		$$-&gt;u2.arglist-&gt;next-&gt;next-&gt;next-&gt;u1.str = $13;
+		$$-&gt;u2.arglist-&gt;next = nword($9, &amp;@9);
+		$$-&gt;u2.arglist-&gt;next-&gt;next = nword($11, &amp;@11);
+		$$-&gt;u2.arglist-&gt;next-&gt;next-&gt;next = nword($13, &amp;@13);
 		prev_word=0;
 	}
 	| includedname BAR word BAR word3_list BAR word3_list BAR word3_list SEMI {
 		$$ = npval2(PV_WORD, &amp;@1, &amp;@2);
 		$$-&gt;u1.str = $1;
-		$$-&gt;u2.arglist = npval2(PV_WORD, &amp;@3, &amp;@3);
-		$$-&gt;u2.arglist-&gt;u1.str = $3;
-		$$-&gt;u2.arglist-&gt;next = npval2(PV_WORD, &amp;@5, &amp;@5);
-		$$-&gt;u2.arglist-&gt;next-&gt;u1.str = $5;
-		$$-&gt;u2.arglist-&gt;next-&gt;next = npval2(PV_WORD, &amp;@7, &amp;@7);
-		$$-&gt;u2.arglist-&gt;next-&gt;next-&gt;u1.str = $7;
-		$$-&gt;u2.arglist-&gt;next-&gt;next-&gt;next = npval2(PV_WORD, &amp;@9, &amp;@9);
-		$$-&gt;u2.arglist-&gt;next-&gt;next-&gt;next-&gt;u1.str = $9;
+		$$-&gt;u2.arglist = nword($3, &amp;@3);
+		$$-&gt;u2.arglist-&gt;next = nword($5, &amp;@5);
+		$$-&gt;u2.arglist-&gt;next-&gt;next = nword($7, &amp;@7);
+		$$-&gt;u2.arglist-&gt;next-&gt;next-&gt;next = nword($9, &amp;@9);
 		prev_word=0;
 	}
 	| includeslist includedname SEMI {
@@ -797,27 +706,21 @@
 		free($4);
 		free($6);
 		free($8);
-		z-&gt;u2.arglist-&gt;next = npval2(PV_WORD, &amp;@10, &amp;@10);
-		z-&gt;u2.arglist-&gt;next-&gt;u1.str = $10;
-		z-&gt;u2.arglist-&gt;next-&gt;next = npval2(PV_WORD, &amp;@12, &amp;@12);
-		z-&gt;u2.arglist-&gt;next-&gt;next-&gt;u1.str = $12;
-		z-&gt;u2.arglist-&gt;next-&gt;next-&gt;next = npval2(PV_WORD, &amp;@14, &amp;@14);
-		z-&gt;u2.arglist-&gt;next-&gt;next-&gt;next-&gt;u1.str = $14;
+		z-&gt;u2.arglist-&gt;next = nword($10, &amp;@10);
+		z-&gt;u2.arglist-&gt;next-&gt;next = nword($12, &amp;@12);
+		z-&gt;u2.arglist-&gt;next-&gt;next-&gt;next = nword($14, &amp;@14);
 		prev_word=0;
 	}
 	| includeslist includedname BAR word BAR word3_list BAR word3_list BAR word3_list SEMI {
 		pval *z = npval2(PV_WORD, &amp;@2, &amp;@3);
 		$$=$1;
 		linku1($$,z);
-		$$-&gt;u2.arglist-&gt;u1.str = $4;
+		$$-&gt;u2.arglist-&gt;u1.str = $4;			/* XXX maybe too early ? */
 		z-&gt;u1.str = $2;
 		z-&gt;u2.arglist = npval2(PV_WORD, &amp;@4, &amp;@4);	/* XXX is this correct ? */
-		z-&gt;u2.arglist-&gt;next = npval2(PV_WORD, &amp;@6, &amp;@6);
-		z-&gt;u2.arglist-&gt;next-&gt;u1.str = $6;
-		z-&gt;u2.arglist-&gt;next-&gt;next = npval2(PV_WORD, &amp;@8, &amp;@8);
-		z-&gt;u2.arglist-&gt;next-&gt;next-&gt;u1.str = $8;
-		z-&gt;u2.arglist-&gt;next-&gt;next-&gt;next = npval2(PV_WORD, &amp;@10, &amp;@10);
-		z-&gt;u2.arglist-&gt;next-&gt;next-&gt;next-&gt;u1.str = $10;
+		z-&gt;u2.arglist-&gt;next = nword($6, &amp;@6);
+		z-&gt;u2.arglist-&gt;next-&gt;next = nword($8, &amp;@8);
+		z-&gt;u2.arglist-&gt;next-&gt;next-&gt;next = nword($10, &amp;@10);
 		prev_word=0;
 	}
 	| includeslist error {$$=$1;}
@@ -993,6 +896,22 @@
 			first-&gt;first_column, last-&gt;last_column);
 }
 
+static struct pval *update_last(pval *obj, YYLTYPE *last)
+{
+	obj-&gt;endline = last-&gt;last_line;
+	obj-&gt;endcol = last-&gt;last_column;
+	return obj;
+}
+
+/* frontend for npval to create a PV_WORD string from the given token */
+static pval *nword(char *string, YYLTYPE *pos)
+{
+	pval *p = npval2(PV_WORD, pos, pos);
+	if (p)
+		p-&gt;u1.str = string;
+	return p;
+}
+
 /* append second element to the list in the first one */
 static pval * linku1(pval *head, pval *tail)
 {

Modified: trunk/pbx/ael/ael_lex.c
===================================================================
--- trunk/pbx/ael/ael_lex.c	2006-04-30 14:54:24 UTC (rev 14)
+++ trunk/pbx/ael/ael_lex.c	2006-04-30 15:42:56 UTC (rev 15)
@@ -686,6 +686,8 @@
  */
 static char pbcstack[400];	/* XXX missing size checks */
 static int pbcpos = 0;
+static void pbcpush(char x);
+static int pbcpop(char x);
 
 static int parencount = 0;
 static int commaout = 0;
@@ -710,8 +712,6 @@
 void ael_yyset_column (int  column_no , yyscan_t yyscanner);
 
 int ael_yyparse (struct parse_io *);
-static void pbcpush(char x);
-static int pbcpop(char x);
 
 /*
  * A stack to process include files.
@@ -1348,8 +1348,7 @@
 		} else {
 			STORE_LOC;
 			yylval-&gt;str = strdup(yytext);
-			*(yylval-&gt;str+strlen(yylval-&gt;str)-1)=0;
-			/* printf(&quot;Got paren word %s\n&quot;, yylval-&gt;str); */
+			yylval-&gt;str[strlen(yylval-&gt;str)-1] = '\0'; /* trim trailing ')' */
 			unput(')');
 			BEGIN(0);
 			return word;
@@ -1359,7 +1358,7 @@
 case 45:
 /* rule 45 can match eol */
 YY_RULE_SETUP
-#line 251 &quot;ael.flex&quot;
+#line 250 &quot;ael.flex&quot;
 {
 		char c = yytext[yyleng-1];
 		if (c == '(')
@@ -1371,7 +1370,7 @@
 case 46:
 /* rule 46 can match eol */
 YY_RULE_SETUP
-#line 259 &quot;ael.flex&quot;
+#line 258 &quot;ael.flex&quot;
 {
 		char c = yytext[yyleng-1];
 		if ( pbcpop(c))  { /* error */
@@ -1388,7 +1387,7 @@
 case 47:
 /* rule 47 can match eol */
 YY_RULE_SETUP
-#line 272 &quot;ael.flex&quot;
+#line 271 &quot;ael.flex&quot;
 {
 		char c = yytext[yyleng-1];
 		if (c == '(')
@@ -1400,7 +1399,7 @@
 case 48:
 /* rule 48 can match eol */
 YY_RULE_SETUP
-#line 280 &quot;ael.flex&quot;
+#line 279 &quot;ael.flex&quot;
 {
 		if ( pbcpop(')') ) { /* error */
 			STORE_LOC;
@@ -1417,7 +1416,7 @@
 			STORE_LOC;
 			yylval-&gt;str = strdup(yytext);
 			if(yyleng &gt; 1 )
-				*(yylval-&gt;str+yyleng-1)=0;
+				yylval-&gt;str[yyleng-1] = '\0'; /* trim trailing ')' */
 			BEGIN(0);
 			if ( !strcmp(yylval-&gt;str,&quot;)&quot;) ) {
 				free(yylval-&gt;str);
@@ -1434,7 +1433,7 @@
 case 49:
 /* rule 49 can match eol */
 YY_RULE_SETUP
-#line 310 &quot;ael.flex&quot;
+#line 309 &quot;ael.flex&quot;
 {
 		if( parencount != 0) { /* printf(&quot;Folding in a comma!\n&quot;); */
 			yymore();
@@ -1464,7 +1463,7 @@
 case 50:
 /* rule 50 can match eol */
 YY_RULE_SETUP
-#line 336 &quot;ael.flex&quot;
+#line 335 &quot;ael.flex&quot;
 {
 		char c = yytext[yyleng-1];
 		if ( pbcpop(c) ) { /* error */
@@ -1480,7 +1479,7 @@
 case 51:
 /* rule 51 can match eol */
 YY_RULE_SETUP
-#line 350 &quot;ael.flex&quot;
+#line 349 &quot;ael.flex&quot;
 {
 		char c = yytext[yyleng-1];
 		yymore();
@@ -1490,7 +1489,7 @@
 case 52:
 /* rule 52 can match eol */
 YY_RULE_SETUP
-#line 356 &quot;ael.flex&quot;
+#line 355 &quot;ael.flex&quot;
 {
 		char c = yytext[yyleng-1];
 		if ( pbcpop(c) ) { /* error */
@@ -1506,7 +1505,7 @@
 case 53:
 /* rule 53 can match eol */
 YY_RULE_SETUP
-#line 368 &quot;ael.flex&quot;
+#line 367 &quot;ael.flex&quot;
 {
 		STORE_LOC;
 		yylval-&gt;str = strdup(yytext);
@@ -1520,7 +1519,7 @@
 case 54:
 /* rule 54 can match eol */
 YY_RULE_SETUP
-#line 378 &quot;ael.flex&quot;
+#line 377 &quot;ael.flex&quot;
 {
 		FILE *in1;
 		char fnamebuf[1024],*p1,*p2;
@@ -1587,7 +1586,7 @@
 case YY_STATE_EOF(paren):
 case YY_STATE_EOF(semic):
 case YY_STATE_EOF(argg):
-#line 440 &quot;ael.flex&quot;
+#line 439 &quot;ael.flex&quot;
 {
 		if ( --include_stack_index &lt; 0 ) {
 			yyterminate();
@@ -1603,10 +1602,10 @@
 	YY_BREAK
 case 55:
 YY_RULE_SETUP
-#line 453 &quot;ael.flex&quot;
+#line 452 &quot;ael.flex&quot;
 ECHO;
 	YY_BREAK
-#line 1610 &quot;ael_lex.c&quot;
+#line 1609 &quot;ael_lex.c&quot;
 
 	case YY_END_OF_BUFFER:
 		{
@@ -2736,7 +2735,7 @@
 
 #define YYTABLES_NAME &quot;yytables&quot;
 
-#line 453 &quot;ael.flex&quot;
+#line 452 &quot;ael.flex&quot;
 
 
 

Modified: trunk/pbx/pbx_ael.c
===================================================================
--- trunk/pbx/pbx_ael.c	2006-04-30 14:54:24 UTC (rev 14)
+++ trunk/pbx/pbx_ael.c	2006-04-30 15:42:56 UTC (rev 15)
@@ -3554,6 +3554,11 @@
 
 void destroy_pval_item(pval *item)
 {
+	if (item == NULL) {
+		ast_log(LOG_WARNING, &quot;null item\n&quot;);
+		return;
+	}
+
 	if (item-&gt;filename)
 		free(item-&gt;filename);
 	

Modified: trunk/utils/Makefile
===================================================================
--- trunk/utils/Makefile	2006-04-30 14:54:24 UTC (rev 14)
+++ trunk/utils/Makefile	2006-04-30 15:42:56 UTC (rev 15)
@@ -49,10 +49,10 @@
 	rm -f ast_expr2.o ast_expr2f.o
 
 astman.o: astman.c
-	$(CC) $(CFLAGS) -include ../include/autoconfig.h -c -o $@ $&lt;
+	$(CC) $(CFLAGS) -c -o $@ $&lt;
 
 astman: astman.o ../md5.o
-	$(CC) -D_GNU_SOURCE -o $@ $&lt; ../md5.o -lnewt
+	$(CC) $(CFLAGS) -o $@ $&lt; ../md5.o -lnewt
 
 stereorize: stereorize.o frame.o
 	$(CC) $(CFLAGS) -o stereorize stereorize.o frame.o -lm
@@ -60,10 +60,10 @@
 .PHONY: ../ast_expr2.c ../ast_expr2f.c ../pbx/ael/aelflex.o ../pbx/ael/aelbison.o ../pbx/pbx_ael.o
 
 ast_expr2.o: ../ast_expr2.c
-	gcc  $(CFLAGS) -include ../include/autoconfig.h -c -o $@ $&lt;
+	gcc  $(CFLAGS) -c -o $@ $&lt;
 
 ast_expr2f.o: ../ast_expr2f.c
-	gcc  $(CFLAGS) -include ../include/autoconfig.h -c -DSTANDALONE -o $@ $&lt;
+	gcc  $(CFLAGS) -c -DSTANDALONE -o $@ $&lt;
 
 check_expr: check_expr.c ast_expr2.o ast_expr2f.o
 	$(CC) $(CFLAGS) -o $@ $^
@@ -72,7 +72,7 @@
 	$(CC) $(CFLAGS) -g -o aelparse ../pbx/ael/aelflex.o ../pbx/ael/aelbison.o ael_main.o ../pbx/pbx_ael.o ../ast_expr2f.o ../ast_expr2.o
 
 ael_main.o : ael_main.c ../include/asterisk/ael_structs.h
-	$(CC) $(CFLAGS) -include ../include/autoconfig.h -c -g -o ael_main.o ael_main.c
+	$(CC) $(CFLAGS) -c -g -o ael_main.o ael_main.c
 
 ael_main1.o : ael_main.c ../include/asterisk/ael_structs.h
 	$(CC) $(CFLAGS) -c -g  -o ael_main1.o ael_main.c
@@ -85,7 +85,7 @@
 	./testexpr2s expr2.testinput
 
 smsq.o: smsq.c
-	$(CC) $(CFLAGS) -include ../include/autoconfig.h -c -o $@ $&lt;
+	$(CC) $(CFLAGS) -c -o $@ $&lt;
 
 smsq: smsq.o
 	$(CC) $(CFLAGS) -o smsq ${SOL} smsq.o -lpopt


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="000010.html">[solid-pbx-svn] r14 - trunk/mxml
</A></li>
	<LI>Next message: <A HREF="000013.html">[solid-pbx-svn] r16 - trunk/channels
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#12">[ date ]</a>
              <a href="thread.html#12">[ thread ]</a>
              <a href="subject.html#12">[ subject ]</a>
              <a href="author.html#12">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.berlios.de/mailman/listinfo/solid-pbx-svn">More information about the solid-pbx-svn
mailing list</a><br>
</body></html>
